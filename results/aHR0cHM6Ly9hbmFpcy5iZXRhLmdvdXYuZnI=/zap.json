{
	"@programName": "OWASP ZAP",
	"@version": "2.12.0",
	"@generated": "Sun, 18 Dec 2022 08:03:34",
	"site":[ 
		{
			"@name": "https://anais.beta.gouv.fr",
			"@host": "anais.beta.gouv.fr",
			"@port": "443",
			"@ssl": "true",
			"alerts": [ 
				{
					"pluginid": "10038",
					"alertRef": "10038",
					"alert": "Content Security Policy (CSP) Header Not Set",
					"name": "Content Security Policy (CSP) Header Not Set",
					"riskcode": "2",
					"confidence": "3",
					"riskdesc": "Medium (High)",
					"desc": "<p>Content Security Policy (CSP) is an added layer of security that helps to detect and mitigate certain types of attacks, including Cross Site Scripting (XSS) and data injection attacks. These attacks are used for everything from data theft to site defacement or distribution of malware. CSP provides a set of standard HTTP headers that allow website owners to declare approved sources of content that browsers should be allowed to load on that page \u2014 covered types are JavaScript, CSS, HTML frames, fonts, images and embeddable objects such as Java applets, ActiveX, audio and video files.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/maps/osmfr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						}
					],
					"count": "5",
					"solution": "<p>Ensure that your web server, application server, load balancer, etc. is configured to set the Content-Security-Policy header, to achieve optimal browser support: \"Content-Security-Policy\" for Chrome 25+, Firefox 23+ and Safari 7+, \"X-Content-Security-Policy\" for Firefox 4.0+ and Internet Explorer 10+, and \"X-WebKit-CSP\" for Chrome 14+ and Safari 6+.</p>",
					"otherinfo": "",
					"reference": "<p>https://developer.mozilla.org/en-US/docs/Web/Security/CSP/Introducing_Content_Security_Policy</p><p>https://cheatsheetseries.owasp.org/cheatsheets/Content_Security_Policy_Cheat_Sheet.html</p><p>http://www.w3.org/TR/CSP/</p><p>http://w3c.github.io/webappsec/specs/content-security-policy/csp-specification.dev.html</p><p>http://www.html5rocks.com/en/tutorials/security/content-security-policy/</p><p>http://caniuse.com/#feat=contentsecuritypolicy</p><p>http://content-security-policy.com/</p>",
					"cweid": "693",
					"wascid": "15",
					"sourceid": "1"
				},
				{
					"pluginid": "10110",
					"alertRef": "10110",
					"alert": "Dangerous JS Functions",
					"name": "Dangerous JS Functions",
					"riskcode": "1",
					"confidence": "1",
					"riskdesc": "Low (Low)",
					"desc": "<p>A dangerous JS function seems to be in use that would leave the site vulnerable.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "bypassSecurityTrustHtml"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es5.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "bypassSecurityTrustHtml"
						}
					],
					"count": "2",
					"solution": "<p>See the references for security advice on the use of these functions.</p>",
					"otherinfo": "",
					"reference": "<p>https://angular.io/guide/security</p>",
					"cweid": "749",
					"wascid": "-1",
					"sourceid": "36"
				},
				{
					"pluginid": "10009",
					"alertRef": "10009",
					"alert": "In Page Banner Information Leak",
					"name": "In Page Banner Information Leak",
					"riskcode": "1",
					"confidence": "3",
					"riskdesc": "Low (High)",
					"desc": "<p>The server returned a version banner string in the response content. Such information leaks may allow attackers to further target specific issues impacting the product and version in use.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/maps/osmfr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "Apache/2.4.29"
						}
					],
					"count": "1",
					"solution": "<p>Configure the server to prevent such information leaks. For example:</p><p>Under Tomcat this is done via the \"server\" directive and implementation of custom error pages.</p><p>Under Apache this is done via the \"ServerSignature\" and \"ServerTokens\" directives.</p>",
					"otherinfo": "<p>There is a chance that the highlight in the finding is on a value in the headers, versus the actual matched string in the response body.</p>",
					"reference": "<p>https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/08-Testing_for_Error_Handling/</p>",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "42"
				},
				{
					"pluginid": "10063",
					"alertRef": "10063-1",
					"alert": "Permissions Policy Header Not Set",
					"name": "Permissions Policy Header Not Set",
					"riskcode": "1",
					"confidence": "2",
					"riskdesc": "Low (Medium)",
					"desc": "<p>Permissions Policy Header is an added layer of security that helps to restrict from unauthorized access or usage of browser/client features by web resources. This policy ensures the user privacy by limiting or specifying the features of the browsers can be used by the web resources. Permissions Policy provides a set of standard HTTP headers that allow website owners to limit which features of browsers can be used by the page such as camera, microphone, location, full screen etc.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/assets/settings.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/maps/osmfr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.ec173abd055e5a8effac.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.a6999adc4bcd02f5ccca.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es2015.8b9bafcb46d0324464ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es5.8b9bafcb46d0324464ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": ""
						}
					],
					"count": "11",
					"solution": "<p>Ensure that your web server, application server, load balancer, etc. is configured to set the Permissions-Policy header.</p>",
					"otherinfo": "",
					"reference": "<p>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy</p><p>https://developers.google.com/web/updates/2018/06/feature-policy</p><p>https://scotthelme.co.uk/a-new-security-header-feature-policy/</p><p>https://w3c.github.io/webappsec-feature-policy/</p><p>https://www.smashingmagazine.com/2018/12/feature-policy/</p>",
					"cweid": "693",
					"wascid": "15",
					"sourceid": "1"
				},
				{
					"pluginid": "10036",
					"alertRef": "10036",
					"alert": "Server Leaks Version Information via \"Server\" HTTP Response Header Field",
					"name": "Server Leaks Version Information via \"Server\" HTTP Response Header Field",
					"riskcode": "1",
					"confidence": "3",
					"riskdesc": "Low (High)",
					"desc": "<p>The web/application server is leaking version information via the \"Server\" HTTP response header. Access to such information may facilitate attackers identifying other vulnerabilities your web/application server is subject to.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/assets/images/favicon_anais.png",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/assets/settings.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.ec173abd055e5a8effac.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.a6999adc4bcd02f5ccca.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es2015.8b9bafcb46d0324464ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es5.8b9bafcb46d0324464ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						},
						{
							"uri": "https://anais.beta.gouv.fr/styles.c57454709e6ae053f58e.css",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "nginx/1.21.6"
						}
					],
					"count": "11",
					"solution": "<p>Ensure that your web server, application server, load balancer, etc. is configured to suppress the \"Server\" header or provide generic details.</p>",
					"otherinfo": "",
					"reference": "<p>http://httpd.apache.org/docs/current/mod/core.html#servertokens</p><p>http://msdn.microsoft.com/en-us/library/ff648552.aspx#ht_urlscan_007</p><p>http://blogs.msdn.com/b/varunm/archive/2013/04/23/remove-unwanted-http-response-headers.aspx</p><p>http://www.troyhunt.com/2012/02/shhh-dont-let-your-response-headers.html</p>",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "1"
				},
				{
					"pluginid": "10096",
					"alertRef": "10096",
					"alert": "Timestamp Disclosure - Unix",
					"name": "Timestamp Disclosure - Unix",
					"riskcode": "1",
					"confidence": "1",
					"riskdesc": "Low (Low)",
					"desc": "<p>A timestamp was disclosed by the application/web server - Unix</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "1358797613"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "1431655765"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "1431655768"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es5.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "1358797613"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es5.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "1431655765"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es5.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "1431655768"
						}
					],
					"count": "6",
					"solution": "<p>Manually confirm that the timestamp data is not sensitive, and that the data cannot be aggregated to disclose exploitable patterns.</p>",
					"otherinfo": "<p>1358797613, which evaluates to: 2013-01-21 19:46:53</p>",
					"reference": "<p>http://projects.webappsec.org/w/page/13246936/Information%20Leakage</p>",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "36"
				},
				{
					"pluginid": "10094",
					"alertRef": "10094",
					"alert": "Base64 Disclosure",
					"name": "Base64 Disclosure",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>Base64 encoded data was disclosed by the application/web server. Note: in the interests of performance not all base64 strings in the response were analyzed individually, the entire response should be looked at by the analyst/security team/developer(s).</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es5.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.ec173abd055e5a8effac.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.a6999adc4bcd02f5ccca.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"
						}
					],
					"count": "4",
					"solution": "<p>Manually confirm that the Base64 data does not leak sensitive information, and that the data cannot be aggregated/used to exploit other vulnerabilities.</p>",
					"otherinfo": "<p>\\x0000\\x0010\uFFFD\\x0010Q\uFFFD \uFFFD\uFFFD0\u04CFA\\x0014\uFFFDQU\uFFFDa\uFFFD\uFFFDq\u05DF\uFFFD\\x0018\uFFFD\uFFFDY\uFFFD\uFFFD\uFFFD\uFFFD\uFFFD\u06EF\uFFFD\\x001c\uFFFD\uFFFD]\uFFFD\u37BB\uFFFD\u07FF</p>",
					"reference": "<p>http://projects.webappsec.org/w/page/13246936/Information%20Leakage</p>",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "36"
				},
				{
					"pluginid": "10027",
					"alertRef": "10027",
					"alert": "Information Disclosure - Suspicious Comments",
					"name": "Information Disclosure - Suspicious Comments",
					"riskcode": "0",
					"confidence": "1",
					"riskdesc": "Informational (Low)",
					"desc": "<p>The response appears to contain suspicious comments which may help an attacker. Note: Matches made within script blocks or files are against the entire content not only comments.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "Bug"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es5.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "Bug"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.ec173abd055e5a8effac.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "from"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.a6999adc4bcd02f5ccca.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "select"
						}
					],
					"count": "4",
					"solution": "<p>Remove all comments that return information that may help an attacker and fix any underlying problems they refer to.</p>",
					"otherinfo": "<p>The following pattern was used: \\bBUG\\b and was detected in the element starting with: \"var MSt=Object.defineProperty,TSt=Object.defineProperties,kSt=Object.getOwnPropertyDescriptors,vpe=Object.getOwnPropertySymbols,\", see evidence field for the suspicious comment/snippet.</p>",
					"reference": "",
					"cweid": "200",
					"wascid": "13",
					"sourceid": "36"
				},
				{
					"pluginid": "10109",
					"alertRef": "10109",
					"alert": "Modern Web Application",
					"name": "Modern Web Application",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>The application appears to be a modern web application. If you need to explore it automatically then the Ajax Spider may well be more effective than the standard one.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<noscript><link rel=\"stylesheet\" href=\"styles.c57454709e6ae053f58e.css\"></noscript>"
						},
						{
							"uri": "https://anais.beta.gouv.fr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<noscript><link rel=\"stylesheet\" href=\"styles.c57454709e6ae053f58e.css\"></noscript>"
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es2015.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<a>>>0)){r=0;break}o=o+1|0}else r=0}while(0);o=0==(0|r)}else o=0;if(u=0|ve(a+1|0,0,52),r=0|x()|-15728641&e,Mt(e=(u|t)&~(e=0|ve(7,0,0|(l=3*(14-a|0)|0))),a=r&~(0|x()),i,n),r=n+(h<<3)|0,!o)return Mt((u=0|ve(1,0,0|l))|e,0|x()|a,i,r),u=r+(h<<3)|0,Mt((c=0|ve(2,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(3,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(4,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(5,0,0|l))|e,0|x()|a,i,u),void Mt((c=0|ve(6,0,0|l))|e,0|x()|a,i,u+(h<<3)|0);o=r+(h<<3)|0,(0|c)>6&&(we(0|r,0,8+(u=(o>>>0>(c=r+8|0)>>>0?o:c)+-1+(0-r)|0)&-8|0),r=c+(u>>>3<<3)|0),Mt((u=0|ve(2,0,0|l))|e,0|x()|a,i,r),u=r+(h<<3)|0,Mt((c=0|ve(3,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(4,0,0|l))|e,0|x()|a,i,u),u=u+(h<<3)|0,Mt((c=0|ve(5,0,0|l))|e,0|x()|a,i,u),Mt((c=0|ve(6,0,0|l))|e,0|x()|a,i,u+(h<<3)|0)}}function Tt(t,e){var i=0,n=0,s=0;if(s=0|Ae(0|(t|=0),0|(e|=0),45),x(),!(0|F(127&s)))return 0;s=0|Ae(0|t,0|e,52),x(),s&=15;t:do{if(s)for(n=1;;){if(i=0|Ae(0|t,0|e,3*(15-n|0)|0),x(),0|(i&=7))break t;if(!(n>>>0<s>>>0)){i=0;break}n=n+1|0}else i=0}while(0);return 0|0==(0|i)&1}function It(t,e){var i=0,n=0,s=0;if(s=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(s&=15))return 0;for(n=1;;){if(i=0|Ae(0|t,0|e,3*(15-n|0)|0),x(),0|(i&=7)){n=5;break}if(!(n>>>0<s>>>0)){i=0,n=5;break}n=n+1|0}return 5==(0|n)?0|i:0}function Pt(t,e){var i=0,n=0,s=0,r=0,o=0,a=0,l=0;if(l=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(l&=15))return l=t,w(0|(a=e)),0|l;for(a=1,i=0;;){n=0|ve(7,0,0|(r=3*(15-a|0)|0)),s=0|x(),o=0|Ae(0|t,0|e,0|r),x(),t=(r=0|ve(0|at(7&o),0,0|r))|t&~n,e=(o=0|x())|e&~s;t:do{if(!i)if(0==(r&n|0)&0==(o&s|0))i=0;else if(n=0|Ae(0|t,0|e,52),x(),n&=15,n){i=1;e:for(;;){switch(o=0|Ae(0|t,0|e,3*(15-i|0)|0),x(),7&o){case 1:break e;case 0:break;default:i=1;break t}if(!(i>>>0<n>>>0)){i=1;break t}i=i+1|0}for(i=1;;){if(s=0|Ae(0|t,0|e,0|(o=3*(15-i|0)|0)),x(),r=0|ve(7,0,0|o),e&=~(0|x()),t=t&~r|(o=0|ve(0|at(7&s),0,0|o)),e=0|e|x(),!(i>>>0<n>>>0)){i=1;break}i=i+1|0}}else i=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return w(0|e),0|t}function Ot(t,e){var i=0,n=0,s=0,r=0,o=0;if(n=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(n&=15))return n=t,w(0|(i=e)),0|n;for(i=1;o=0|Ae(0|t,0|e,0|(r=3*(15-i|0)|0)),x(),s=0|ve(7,0,0|r),e&=~(0|x()),t=(r=0|ve(0|at(7&o),0,0|r))|t&~s,e=0|x()|e,i>>>0<n>>>0;)i=i+1|0;return w(0|e),0|t}function Rt(t,e){var i=0,n=0,s=0,r=0,o=0,a=0,l=0;if(l=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(l&=15))return l=t,w(0|(a=e)),0|l;for(a=1,i=0;;){n=0|ve(7,0,0|(r=3*(15-a|0)|0)),s=0|x(),o=0|Ae(0|t,0|e,0|r),x(),t=(r=0|ve(0|lt(7&o),0,0|r))|t&~n,e=(o=0|x())|e&~s;t:do{if(!i)if(0==(r&n|0)&0==(o&s|0))i=0;else if(n=0|Ae(0|t,0|e,52),x(),n&=15,n){i=1;e:for(;;){switch(o=0|Ae(0|t,0|e,3*(15-i|0)|0),x(),7&o){case 1:break e;case 0:break;default:i=1;break t}if(!(i>>>0<n>>>0)){i=1;break t}i=i+1|0}for(i=1;;){if(r=0|ve(7,0,0|(s=3*(15-i|0)|0)),o=e&~(0|x()),e=0|Ae(0|t,0|e,0|s),x(),t=t&~r|(e=0|ve(0|lt(7&e),0,0|s)),e=0|o|x(),!(i>>>0<n>>>0)){i=1;break}i=i+1|0}}else i=1}while(0);if(!(a>>>0<l>>>0))break;a=a+1|0}return w(0|e),0|t}function Dt(t,e){var i=0,n=0,s=0,r=0,o=0;if(n=0|Ae(0|(t|=0),0|(e|=0),52),x(),!(n&=15))return n=t,w(0|(i=e)),0|n;for(i=1;r=0|ve(7,0,0|(o=3*(15-i|0)|0)),s=e&~(0|x()),e=0|Ae(0|t,0|e,0|o),x(),t=(e=0|ve(0|lt(7&e),0,0|o))|t&~r,e=0|x()|s,i>>>0<n>>>0;)i=i+1|0;return w(0|e),0|t}function Lt(t){return 0|(0|(t|=0))%2}function Ft(t,e){var i,n;return t|=0,n=I,I=I+16|0,i=n,(e|=0)>>>0<=15&&2146435072!=(2146435072&s[t+4>>2]|0)&&2146435072!=(2146435072&s[t+8+4>>2]|0)?(function(t,e,i){var n,o;n=I,I=I+16|0,function(t,e,i,n){e|=0,i|=0,n|=0;var o,a=0,l=0,c=0,h=0;if(o=I,I=I+32|0,function(t,e){e|=0;var i,n,s=0;i=+u(+(s=+r[(t|=0)>>3])),s=+d(+s),r[e+16>>3]=s,n=i*+u(+(s=+r[t+8>>3])),r[e>>3]=n,s=i*+d(+s),r[e+8>>3]=s}(t|=0,l=o),s[i>>2]=0,a=+ie(15888,l),(c=+ie(15912,l))<a&&(s[i>>2]=1,a=c),(c=+ie(15936,l))<a&&(s[i>>2]=2,a=c),(c=+ie(15960,l))<a&&(s[i>>2]=3,a=c),(c=+ie(15984,l))<a&&(s[i>>2]=4,a=c),(c=+ie(16008,l))<a&&(s[i>>2]=5,a=c),(c=+ie(16032,l))<a&&(s[i>>2]=6,a=c),(c=+ie(16056,l))<a&&(s[i>>2]=7,a=c),(c=+ie(16080,l))<a&&(s[i>>2]=8,a=c),(c=+ie(16104,l))<a&&(s[i>>2]=9,a=c),(c=+ie(16128,l))<a&&(s[i>>2]=10,a=c),(c=+ie(16152,l))<a&&(s[i>>2]=11,a=c),(c=+ie(16176,l))<a&&(s[i>>2]=12,a=c),(c=+ie(16200,l))<a&&(s[i>>2]=13,a=c),(c=+ie(16224,l))<a&&(s[i>>2]=14,a=c),(c=+ie(16248,l))<a&&(s[i>>2]=15,a=c),(c=+ie(16272,l))<a&&(s[i>>2]=16,a=c),(c=+ie(16296,l))<a&&(s[i>>2]=17,a=c),(c=+ie(16320,l))<a&&(s[i>>2]=18,a=c),(c=+ie(16344,l))<a&&(s[i>>2]=19,a=c),(c=+f(+(1-.5*a)))<1e-16)return s[n>>2]=0,s[n+4>>2]=0,s[n+8>>2]=0,s[n+12>>2]=0,void(I=o);if(a=+yt((a=+r[16368+(24*(i=0|s[i>>2])|0)>>3])-+yt(+function(t,e){var i,n,s,o,a;return t|=0,a=(n=+u(+(o=+r[(e|=0)>>3])))*+d(+(s=+r[e+8>>3]-+r[t+8>>3])),i=+r[t>>3],+ +A(+a,+(+d(+o)*+u(+i)-+u(+s)*(n*+d(+i))))}(15568+(i<<4)|0,t))),h=0|Lt(e)?+yt(a+-.3334731722518321):a,a=+p(+c)/.381966011250105,(0|e)>0){l=0;do{a*=2.6457513110645907,l=l+1|0}while((0|l)!=(0|e))}c=+u(+h)*a,r[n>>3]=c,h=+d(+h)*a,r[n+8>>3]=h,I=o}(t|=0,e|=0,i|=0,o=n),function(t,e){t|=0;var i,n,o,a,c=0,h=0,u=0,d=0,p=0,f=0,m=0;s[(a=8+(e|=0)|0)>>2]=0,d=+l(+(n=+r[t>>3])),d+=.5*(p=+l(+(o=+r[t+8>>3]))/.8660254037844386),d-=+(0|(c=~~d)),p-=+(0|(t=~~p));do{if(d<.5){if(d<.3333333333333333){if(s[e>>2]=c,p<.5*(d+1)){s[e+4>>2]=t;break}s[e+4>>2]=t=t+1|0;break}if(s[e+4>>2]=t=(1&!(p<(m=1-d)))+t|0,m<=p&p<2*d){s[e>>2]=c=c+1|0;break}s[e>>2]=c;break}if(!(d<.6666666666666666)){if(s[e>>2]=c=c+1|0,p<.5*d){s[e+4>>2]=t;break}s[e+4>>2]=t=t+1|0;break}if(p<1-d){if(s[e+4>>2]=t,2*d-1<p){s[e>>2]=c;break}}else s[e+4>>2]=t=t+1|0;s[e>>2]=c=c+1|0}while(0);do{if(n<0){if(1&t){c=~~(+(0|c)-(2*(+((f=0|fe(0|c,((0|c)<0)<<31>>31|0,0|(f=(t+1|0)/2|0),((0|f)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))+1)),s[e>>2]=c;break}c=~~(+(0|c)-2*(+((f=0|fe(0|c,((0|c)<0)<<31>>31|0,0|(f=(0|t)/2|0),((0|f)<0)<<31>>31|0))>>>0)+4294967296*+(0|x()))),s[e>>2]=c;break}}while(0);f=e+4|0,o<0&&(s[e>>2]=c=c-((1|t<<1)/2|0)|0,s[f>>2]=t=0-t|0),h=t-c|0,(0|c)<0?(u=0-c|0,s[f>>2]=h,s[a>>2]=u,s[e>>2]=0,t=h,c=0):u=0,(0|t)<0&&(s[e>>2]=c=c-t|0,s[a>>2]=u=u-t|0,s[f>>2]=0,t=0),i=c-u|0,h=t-u|0,(0|u)<0&&(s[e>>2]=i,s[f>>2]=h,s[a>>2]=0,t=h,c=i,u=0),!((0|(h=(0|u)<(0|(h=(0|t)<(0|c)?t:c))?u:h))<=0)&&(s[e>>2]=c-h,s[f>>2]=t-h,s[a>>2]=u-h)}(o,i+4|0),I=n}(t,e,i),e=0|function(t,e){t|=0;var i,n=0,r=0,o=0,a=0,l=0,c=0,h=0,u=0;if(i=I,I=I+64|0,c=i+40|0,r=i+24|0,o=i+12|0,a=i,ve(0|(e|=0),0,52),n=134225919|x(),!e)return(0|s[t+4>>2])>2||(0|s[t+8>>2])>2||(0|s[t+12>>2])>2?(c=0,w(0|(l=0)),I=i,0|c):(ve(0|B(t),0,45),l=0|x()|n,c=-1,w(0|l),I=i,0|c);if(s[c>>2]=s[t>>2],s[c+4>>2]=s[t+4>>2],s[c+8>>2]=s[t+8>>2],s[c+12>>2]=s[t+12>>2],l=c+4|0,(0|e)>0)for(t=-1;s[r>>2]=s[l>>2],s[r+4>>2]=s[l+4>>2],s[r+8>>2]=s[l+8>>2],1&e?(tt(l),s[o>>2]=s[l>>2],s[o+4>>2]=s[l+4>>2],s[o+8>>2]=s[l+8>>2],it(o)):(et(l),s[o>>2]=s[l>>2],s[o+4>>2]=s[l+4>>2],s[o+8>>2]=s[l+8>>2],nt(o)),X(r,o,a),Y(a),h=0|ve(7,0,0|(u=3*(15-e|0)|0)),n&=~(0|x()),t=(u=0|ve(0|J(a),0,0|u))|t&~h,n=0|x()|n,(0|e)>1;)e=e+-1|0;else t=-1;t:do{if((0|s[l>>2])<=2&&(0|s[c+8>>2])<=2&&(0|s[c+12>>2])<=2){if(e=0|ve(0|(r=0|B(c)),0,45),e|=t,t=0|x()|-1040385&n,a=0|z(c),!(0|F(r))){if((0|a)<=0)break;for(o=0;;){if(r=0|Ae(0|e,0|t,52),x(),r&=15)for(n=1;c=0|Ae(0|e,0|t,0|(u=3*(15-n|0)|0)),x(),h=0|ve(7,0,0|u),t&=~(0|x()),e=e&~h|(u=0|ve(0|at(7&c),0,0|u)),t=0|t|x(),n>>>0<r>>>0;)n=n+1|0;if((0|(o=o+1|0))==(0|a))break t}}o=0|Ae(0|e,0|t,52),x(),o&=15;e:do{if(o){n=1;i:for(;;){switch(u=0|Ae(0|e,0|t,3*(15-n|0)|0),x(),7&u){case 1:break i;case 0:break;default:break e}if(!(n>>>0<o>>>0))break e;n=n+1|0}if(0|V(r,0|s[c>>2]))for(n=1;h=0|ve(7,0,0|(c=3*(15-n|0)|0)),u=t&~(0|x()),t=0|Ae(0|e,0|t,0|c),x(),e=e&~h|(t=0|ve(0|lt(7&t),0,0|c)),t=0|u|x(),n>>>0<o>>>0;)n=n+1|0;else for(n=1;c=0|Ae(0|e,0|t,0|(u=3*(15-n|0)|0)),x(),h=0|ve(7,0,0|u),t&=~(0|x()),e=e&~h|(u=0|ve(0|at(7&c),0,0|u)),t=0|t|x(),n>>>0<o>>>0;)n=n+1|0}}while(0);if((0|a)>0){n=0;do{e=0|Pt(e,t),t=0|x(),n=n+1|0}while((0|n)!=(0|a))}}else e=0,t=0}while(0);return u=e,w(0|(h=t)),I=i,0|u}(i,e),t=0|x()):(t=0,e=0),w(0|t),I=n,0|e}function Nt(t,e,i){var n,r=0,o=0,a=0;if(n=4+(i|=0)|0,o=0|Ae(0|(t|=0),0|(e|=0),52),x(),o&=15,a=0|Ae(0|t,0|e,45),x(),r=0==(0|o),0|F(127&a)){if(r)return 1;r=1}else{if(r)return 0;r=0==(0|s[n>>2])&&0==(0|s[i+8>>2])?0!=(0|s[i+12>>2])&1:1}for(i=1;1&i?it(n):nt(n),a=0|Ae(0|t,0|e,3*(15-i|0)|0),x(),st(n,7&a),i>>>0<o>>>0;)i=i+1|0;return 0|r}function Bt(t,e,i){i|=0;var n,r,o=0,a=0,l=0,c=0,h=0,u=0;r=I,I=I+16|0,n=r,u=0|Ae(0|(t|=0),0|(e|=0),45),x(),u&=127;t:do{if(0!=(0|F(u))&&(l=0|Ae(0|t,0|e,52),x(),l&=15,0!=(0|l))){o=1;e:for(;;){switch(h=0|Ae(0|t,0|e,3*(15-o|0)|0),x(),7&h){case 5:break e;case 0:break;default:o=e;break t}if(!(o>>>0<l>>>0)){o=e;break t}o=o+1|0}for(a=1,o=e;c=0|ve(7,0,0|(e=3*(15-a|0)|0)),h=o&~(0|x()),o=0|Ae(0|t,0|o,0|e),x(),t=t&~c|(o=0|ve(0|lt(7&o),0,0|e)),o=0|h|x(),a>>>0<l>>>0;)a=a+1|0}else o=e}while(0);if(s[i>>2]=s[(h=7728+(28*u|0)|0)>>2],s[i+4>>2]=s[h+4>>2],s[i+8>>2]=s[h+8>>2],s[i+12>>2]=s[h+12>>2],0|Nt(t,o,i)){if(s[n>>2]=s[(c=i+4|0)>>2],s[n+4>>2]=s[c+4>>2],s[n+8>>2]=s[c+8>>2],l=0|Ae(0|t,0|o,52),x(),h=15&l,1&l?(nt(c),l=h+1|0):l=h,0|F(u)){t:do{if(h)for(e=1;;){if(a=0|Ae(0|t,0|o,3*(15-e|0)|0),x(),0|(a&=7)){o=a;break t}if(!(e>>>0<h>>>0)){o=0;break}e=e+1|0}else o=0}while(0);o=4==(0|o)&1}else o=0;if(0|At(i,l,o,0)){if(0|F(u))do{}while(0!=(0|At(i,l,0,0)));(0|l)!=(0|h)&&et(c)}else(0|l)!=(0|h)&&(s[c>>2]=s[n>>2],s[c+4>>2]=s[n+4>>2],s[c+8>>2]=s[n+8>>2]);I=r}else I=r}function zt(t,e,i){var n,r;i|=0,n=I,I=I+16|0,Bt(t|=0,e|=0,r=n),e=0|Ae(0|t,0|e,52),x(),function(t,e,i){var n,r;e|=0,i|=0,n=I,I=I+16|0,Z(4+(t|=0)|0,r=n),ft(r,0|s[t>>2],e,0,i),I=n}(r,15&e,i),I=n}function Vt(t,e,i){i|=0;var n,s,r=0,o=0;s=I,I=I+16|0,Bt(t|=0,e|=0,n=s),r=0|Ae(0|t,0|e,45),x(),r=0==(0|F(127&r)),o=0|Ae(0|t,0|e,52),x(),o&=15;t:do{if(!r){if(0|o)for(r=1;;){if(!(0==((0|ve(7,0,3*(15-r|0)|0))&t|0)&0==((0|x())&e|0)))break t;if(!(r>>>0<o>>>0))break;r=r+1|0}return mt(n,o,0,5,i),void(I=s)}}while(0);_t(n,o,0,6,i),I=s}function $t(t,e){e|=0;var i,n=0,r=0,o=0,a=0,l=0,c=0;if(ve(0|(t|=0),0,52),i=134225919|x(),(0|t)<1){r=0,n=0;do{0|F(r)&&(ve(0|r,0,45),l=0|i|x(),s[(t=e+(n<<3)|0)>>2]=-1,s[t+4>>2]=l,n=n+1|0),r=r+1|0}while(122!=(0|r))}else{l=0,n=0;do{if(0|F(l)){for(ve(0|l,0,45),r=1,o=-1,a=0|i|x();o&=~(c=0|ve(7,0,3*(15-r|0)|0)),a&=~(0|x()),(0|r)!=(0|t);)r=r+1|0;s[(c=e+(n<<3)|0)>>2]=o,s[c+4>>2]=a,n=n+1|0}l=l+1|0}while(122!=(0|l))}}function Ut(t,e,i,n){var r,o=0,a=0,l=0,c=0,h=0;if(r=I,I=I+64|0,l=r,(0|(t|=0))==(0|(i|=0))&(0|(e|=0))==(0|(n|=0))|!1|134217728!=(2013265920&e|0)|!1|134217728!=(2013265920&n|0)||(o=0|Ae(0|t,0|e,52),x(),o&=15,a=0|Ae(0|i,0|n,52),x(),(0|o)!=(15&a|0)))return I=r,0;if(a=o+-1|0,o>>>0>1&&(h=0|Et(t,e,a),c=0|x(),(0|h)==(0|(a=0|Et(i,n,a)))&(0|c)==(0|x()))&&(o=0|Ae(0|t,0|e,0|(a=3*(15^o)|0)),x(),o&=7,a=0|Ae(0|i,0|n,0|a),x(),0==(0|o)|0==(0|(a&=7))||(0|s[21136+(o<<2)>>2])==(0|a)||(0|s[21168+(o<<2)>>2])==(0|a)))return I=r,1;a=(o=l)+56|0;do{s[o>>2]=0,o=o+4|0}while((0|o)<(0|a));return P(t,e,1,l),o=(0|s[(h=l)>>2])==(0|i)&&(0|s[h+4>>2])==(0|n)||(0|s[(h=l+8|0)>>2])==(0|i)&&(0|s[h+4>>2])==(0|n)||(0|s[(h=l+16|0)>>2])==(0|i)&&(0|s[h+4>>2])==(0|n)||(0|s[(h=l+24|0)>>2])==(0|i)&&(0|s[h+4>>2])==(0|n)||(0|s[(h=l+32|0)>>2])==(0|i)&&(0|s[h+4>>2])==(0|n)||(0|s[(h=l+40|0)>>2])==(0|i)&&(0|s[h+4>>2])==(0|n)?1:1&((0|s[(o=l+48|0)>>2])==(0|i)?(0|s[o+4>>2])==(0|n):0),I=r,0|o}function jt(t,e,i){i|=0;var n,r,o,a,l=0;if(o=I,I=I+16|0,r=o,l=0|Ae(0|(t|=0),0|(e|=0),56),x(),-1==(0|(e=0|function(t,e,i){i|=0;var n=0,r=0;return n=0|Tt(t|=0,e|=0),(i+-1|0)>>>0>5||1==(0|i)&(r=0!=(0|n))?0|(i=-1):(n=0|function(t,e){var i,n,r,o=0,a=0,l=0,c=0,h=0;if(r=I,I=I+32|0,n=r,Bt(t|=0,e|=0,i=r+16|0),l=0|Ct(t,e),h=0|It(t,e),function(t,e){s[(e|=0)>>2]=s[(t=7728+(28*(t|=0)|0)|0)>>2],s[e+4>>2]=s[t+4>>2],s[e+8>>2]=s[t+8>>2],s[e+12>>2]=s[t+12>>2]}(l,n),e=0|function(t,e){t|=0;var i=0,n=0;if((e|=0)>>>0>20)return-1;do{if((0|s[11152+(216*e|0)>>2])!=(0|t))if((0|s[11152+(216*e|0)+8>>2])!=(0|t))if((0|s[11152+(216*e|0)+16>>2])!=(0|t))if((0|s[11152+(216*e|0)+24>>2])!=(0|t))if((0|s[11152+(216*e|0)+32>>2])!=(0|t))if((0|s[11152+(216*e|0)+40>>2])!=(0|t))if((0|s[11152+(216*e|0)+48>>2])!=(0|t))if((0|s[11152+(216*e|0)+56>>2])!=(0|t))if((0|s[11152+(216*e|0)+64>>2])!=(0|t))if((0|s[11152+(216*e|0)+72>>2])!=(0|t))if((0|s[11152+(216*e|0)+80>>2])!=(0|t))if((0|s[11152+(216*e|0)+88>>2])!=(0|t))if((0|s[11152+(216*e|0)+96>>2])!=(0|t))if((0|s[11152+(216*e|0)+104>>2])!=(0|t))if((0|s[11152+(216*e|0)+112>>2])!=(0|t))if((0|s[11152+(216*e|0)+120>>2])!=(0|t))if((0|s[11152+(216*e|0)+128>>2])!=(0|t)){if((0|s[11152+(216*e|0)+136>>2])!=(0|t)){if((0|s[11152+(216*e|0)+144>>2])==(0|t)){t=0,i=2,n=0;break}if((0|s[11152+(216*e|0)+152>>2])==(0|t)){t=0,i=2,n=1;break}if((0|s[11152+(216*e|0)+160>>2])==(0|t)){t=0,i=2,n=2;break}if((0|s[11152+(216*e|0)+168>>2])==(0|t)){t=1,i=2,n=0;break}if((0|s[11152+(216*e|0)+176>>2])==(0|t)){t=1,i=2,n=1;break}if((0|s[11152+(216*e|0)+184>>2])==(0|t)){t=1,i=2,n=2;break}if((0|s[11152+(216*e|0)+192>>2])==(0|t)){t=2,i=2,n=0;break}if((0|s[11152+(216*e|0)+200>>2])==(0|t)){t=2,i=2,n=1;break}if((0|s[11152+(216*e|0)+208>>2])==(0|t)){t=2,i=2,n=2;break}return-1}t=2,i=1,n=2}else t=2,i=1,n=1;else t=2,i=1,n=0;else t=1,i=1,n=2;else t=1,i=1,n=1;else t=1,i=1,n=0;else t=0,i=1,n=2;else t=0,i=1,n=1;else t=0,i=1,n=0;else t=2,i=0,n=2;else t=2,i=0,n=1;else t=2,i=0,n=0;else t=1,i=0,n=2;else t=1,i=0,n=1;else t=1,i=0,n=0;else t=0,i=0,n=2;else t=0,i=0,n=1;else t=0,i=0,n=0}while(0);return 0|s[11152+(216*e|0)+(72*i|0)+(24*t|0)+(n<<3)+4>>2]}(l,0|s[i>>2]),!(0|F(l)))return I=r,0|e;switch(0|l){case 4:t=0,o=14;break;case 14:t=1,o=14;break;case 24:t=2,o=14;break;case 38:t=3,o=14;break;case 49:t=4,o=14;break;case 58:t=5,o=14;break;case 63:t=6,o=14;break;case 72:t=7,o=14;break;case 83:t=8,o=14;break;case 97:t=9,o=14;break;case 107:t=10,o=14;break;case 117:t=11,o=14;break;default:c=0,a=0}return 14==(0|o)&&(c=0|s[22096+(24*t|0)+8>>2],a=0|s[22096+(24*t|0)+16>>2]),(0|(t=0|s[i>>2]))!=(0|s[n>>2])&&(l=0|N(l))|(0|(t=0|s[i>>2]))==(0|a)&&(e=(e+1|0)%6|0),3==(0|h)&(0|t)==(0|a)?(I=r,0|(h=(e+5|0)%6|0)):5==(0|h)&(0|t)==(0|c)?(I=r,0|(h=(e+1|0)%6|0)):(I=r,0|(h=e))}(t,e),r?0|(i=(5-n+(0|s[22384+(i<<2)>>2])|0)%5|0):0|(i=(6-n+(0|s[22416+(i<<2)>>2])|0)%6|0))}(n=(a=!0&268435456==(2013265920&e|0))?t:0,t=a?-2130706433&e|134217728:0,7&l))))return s[i>>2]=0,void(I=o);Bt(n,t,r),l=0|Ae(0|n,0|t,52),x(),l&=15,0|Tt(n,t)?mt(r,l,e,2,i):_t(r,l,e,2,i),I=o}function Ht(t){t|=0;var e,i,n=0;return(e=0|pe(1,12))||S(22691,22646,49,22704),0|(n=0|s[(i=t+4|0)>>2])?(s[(n=n+8|0)>>2]=e,s[i>>2]=e,0|e):(0|s[t>>2]&&S(22721,22646,61,22744),s[(n=t)>>2]=e,s[i>>2]=e,0|e)}function Gt(t,e){var i,n;return t|=0,e|=0,(n=0|ue(24))||S(22758,22646,78,22772),s[n>>2]=s[e>>2],s[n+4>>2]=s[e+4>>2],s[n+8>>2]=s[e+8>>2],s[n+12>>2]=s[e+12>>2],s[n+16>>2]=0,0|(i=0|s[(e=t+4|0)>>2])?(s[i+16>>2]=n,s[e>>2]=n,0|n):(0|s[t>>2]&&S(22787,22646,82,22772),s[t>>2]=n,s[e>>2]=n,0|n)}function Wt(t){var e,i,n=0,o=0,a=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0,y=0,w=0,x=0,C=0,k=0,E=0,M=0,T=0,I=0,P=0,O=0,R=0,D=0,L=0,F=0;if(0|s[(c=8+(t|=0)|0)>>2])return 1;if(!(a=0|s[t>>2]))return 0;n=a,o=0;do{o=o+1|0,n=0|s[n+8>>2]}while(0!=(0|n));if(o>>>0<2)return 0;(i=0|ue(o<<2))||S(22807,22646,317,22826),(e=0|ue(o<<5))||S(22848,22646,321,22826),s[t>>2]=0,s[(M=t+4|0)>>2]=0,s[c>>2]=0,o=0,D=0,E=0,g=0;t:for(;;){if(m=0|s[a>>2]){h=0,u=m;do{if(n=u,+l(+((p=+r[u+8>>3])-(d=+r[(c=(f=0==(0|(u=0|s[u+16>>2])))?m:u)+8>>3])))>3.141592653589793){F=14;break}h+=(d-p)*(+r[n>>3]+ +r[c>>3])}while(!f);if(14==(0|F)){F=0,h=0,n=m;do{h+=(+r[n>>3]+ +r[(O=0==(0|(O=0|s[(R=n+16|0)>>2]))?m:O)>>3])*(((C=+r[O+8>>3])<0?C+6.283185307179586:C)-((k=+r[n+8>>3])<0?k+6.283185307179586:k)),n=0|s[(0==(0|n)?a:R)>>2]}while(0!=(0|n))}h>0?(s[i+(D<<2)>>2]=a,D=D+1|0,c=E,n=g):F=19}else F=19;if(19==(0|F)){F=0;do{if(!o){if(g){c=M,u=g+8|0,n=a,o=t;break}if(0|s[t>>2]){F=27;break t}c=M,u=t,n=a,o=t;break}if(0|s[(n=o+8|0)>>2]){F=21;break t}if(!(o=0|pe(1,12))){F=23;break t}s[n>>2]=o,c=o+4|0,u=o,n=g}while(0);if(s[u>>2]=a,s[c>>2]=a,u=e+(E<<5)|0,f=0|s[a>>2]){for(r[(m=e+(E<<5)+8|0)>>3]=17976931348623157e292,r[(g=e+(E<<5)+24|0)>>3]=17976931348623157e292,r[u>>3]=-17976931348623157e292,r[(A=e+(E<<5)+16|0)>>3]=-17976931348623157e292,w=17976931348623157e292,x=-17976931348623157e292,c=0,v=f,p=17976931348623157e292,b=17976931348623157e292,y=-17976931348623157e292,d=-17976931348623157e292;h=+r[v>>3],k=+r[v+8>>3],C=+r[((_=0==(0|(v=0|s[v+16>>2])))?f:v)+8>>3],h<p&&(r[m>>3]=h,p=h),k<b&&(r[g>>3]=k,b=k),h>y?r[u>>3]=h:h=y,k>d&&(r[A>>3]=k,d=k),w=k>0&k<w?k:w,x=k<0&k>x?k:x,c|=+l(+(k-C))>3.141592653589793,!_;)y=h;c&&(r[A>>3]=x,r[g>>3]=w)}else s[u>>2]=0,s[u+4>>2]=0,s[u+8>>2]=0,s[u+12>>2]=0,s[u+16>>2]=0,s[u+20>>2]=0,s[u+24>>2]=0,s[u+28>>2]=0;c=E+1|0}if(a=0|s[(R=a+8|0)>>2],s[R>>2]=0,!a){F=45;break}E=c,g=n}if(21==(0|F))S(22624,22646,35,22658);else if(23==(0|F))S(22678,22646,37,22658);else if(27==(0|F))S(22721,22646,61,22744);else if(45==(0|F)){t:do{if((0|D)>0){for(R=0==(0|c),P=c<<2,O=0==(0|t),I=0,n=0;;){if(T=0|s[i+(I<<2)>>2],R)F=73;else{if(!(E=0|ue(P))){F=50;break}if(!(M=0|ue(P))){F=52;break}e:do{if(O)o=0;else{for(c=0,o=0,u=t;0|qt(0|s[u>>2],a=e+(c<<5)|0,0|s[T>>2])?(s[E+(o<<2)>>2]=u,s[M+(o<<2)>>2]=a,_=o+1|0):_=o,u=0|s[u+8>>2];)c=c+1|0,o=_;if((0|_)>0)if(a=0|s[E>>2],1==(0|_))o=a;else for(A=0,v=-1,o=a,g=a;;){for(f=0|s[g>>2],a=0,u=0;m=(0|(c=0|s[s[E+(u<<2)>>2]>>2]))==(0|f)?a:a+(1&(0|qt(c,0|s[M+(u<<2)>>2],0|s[f>>2])))|0,(0|(u=u+1|0))!=(0|_);)a=m;if(o=(c=(0|m)>(0|v))?g:o,(0|(a=A+1|0))==(0|_))break e;A=a,v=c?m:v,g=0|s[E+(a<<2)>>2]}else o=0}}while(0);if(de(E),de(M),o){if(a=0|s[(c=o+4|0)>>2])o=a+8|0;else if(0|s[o>>2]){F=70;break}s[o>>2]=T,s[c>>2]=T}else F=73}if(73==(0|F)){if(F=0,0|(n=0|s[T>>2]))do{M=n,n=0|s[n+16>>2],de(M)}while(0!=(0|n));de(T),n=2}if((0|(I=I+1|0))>=(0|D)){L=n;break t}}50==(0|F)?S(22863,22646,249,22882):52==(0|F)?S(22901,22646,252,22882):70==(0|F)&&S(22721,22646,61,22744)}else L=0}while(0);return de(i),de(e),0|L}return 0}function qt(t,e,i){t|=0;var n=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0;if(!(0|H(e|=0,i|=0)&&(e=0|j(e),u=+r[i>>3],n=+r[i+8>>3],n=e&n<0?n+6.283185307179586:n,t=0|s[t>>2],t)))return 0;if(e){e=0,i=t;t:for(;;){for(;l=+r[i>>3],h=+r[i+8>>3],o=+r[(d=0==(0|(d=0|s[(i=i+16|0)>>2]))?t:d)+8>>3],l>(a=+r[d>>3])?(c=l,l=h):(c=a,a=l,l=o,o=h),u<a|u>c;)if(!(i=0|s[i>>2])){i=22;break t}if(n=(l=l<0?l+6.283185307179586:l)==n|(h=o<0?o+6.283185307179586:o)==n?n+-2220446049250313e-31:n,((h+=(u-a)/(c-a)*(l-h))<0?h+6.283185307179586:h)>n&&(e^=1),!(i=0|s[i>>2])){i=22;break}}if(22==(0|i))return 0|e}else{e=0,i=t;t:for(;;){for(;l=+r[i>>3],h=+r[i+8>>3],o=+r[(d=0==(0|(d=0|s[(i=i+16|0)>>2]))?t:d)+8>>3],l>(a=+r[d>>3])?(c=l,l=h):(c=a,a=l,l=o,o=h),u<a|u>c;)if(!(i=0|s[i>>2])){i=22;break t}if(o+(u-a)/(c-a)*(l-o)>(n=l==n|o==n?n+-2220446049250313e-31:n)&&(e^=1),!(i=0|s[i>>2])){i=22;break}}if(22==(0|i))return 0|e}return 0}function Yt(t,e,i,r,o){i|=0,r|=0,o|=0;var a,l,c,h,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0;if(h=I,I=I+32|0,b=h+16|0,c=h,u=0|Ae(0|(t|=0),0|(e|=0),52),x(),u&=15,A=0|Ae(0|i,0|r,52),x(),(0|u)!=(15&A|0))return I=h,1;if(m=0|Ae(0|t,0|e,45),x(),m&=127,g=0|Ae(0|i,0|r,45),x(),A=(0|m)!=(0|(g&=127))){if(7==(0|(p=0|U(m,g))))return I=h,2;7==(0|(f=0|U(g,m)))?S(22925,22949,151,22959):(v=p,d=f)}else v=0,d=0;a=0|F(m),l=0|F(g),s[b>>2]=0,s[b+4>>2]=0,s[b+8>>2]=0,s[b+12>>2]=0;do{if(v){if(p=(0|(g=0|s[4304+(28*m|0)+(v<<2)>>2]))>0,l)if(p){m=0,f=i,p=r;do{f=0|Rt(f,p),p=0|x(),1==(0|(d=0|lt(d)))&&(d=0|lt(1)),m=m+1|0}while((0|m)!=(0|g));g=d,m=f,f=p}else g=d,m=i,f=r;else if(p){m=0,f=i,p=r;do{f=0|Dt(f,p),p=0|x(),d=0|lt(d),m=m+1|0}while((0|m)!=(0|g));g=d,m=f,f=p}else g=d,m=i,f=r;if(Nt(m,f,b),A||S(22972,22949,181,22959),(p=0!=(0|a))&(d=0!=(0|l))&&S(22999,22949,182,22959),p){if(d=0|It(t,e),0|n[22032+(7*d|0)+v>>0]){u=3;break}m=f=0|s[21200+(28*d|0)+(v<<2)>>2],_=26}else if(d){if(d=0|It(m,f),0|n[22032+(7*d|0)+g>>0]){u=4;break}m=0,f=0|s[21200+(28*g|0)+(d<<2)>>2],_=26}else d=0;if(26==(0|_))if((0|f)<=-1&&S(23030,22949,212,22959),(0|m)<=-1&&S(23053,22949,213,22959),(0|f)>0){p=b+4|0,d=0;do{ot(p),d=d+1|0}while((0|d)!=(0|f));d=m}else d=m;if(s[c>>2]=0,s[c+4>>2]=0,s[c+8>>2]=0,st(c,v),0|u)for(;0|Lt(u)?it(c):nt(c),(0|u)>1;)u=u+-1|0;if((0|d)>0){u=0;do{ot(c),u=u+1|0}while((0|u)!=(0|d))}K(_=b+4|0,c,_),Y(_),_=50}else if(Nt(i,r,b),0!=(0|a)&0!=(0|l))if((0|g)!=(0|m)&&S(23077,22949,243,22959),d=0|It(t,e),u=0|It(i,r),0|n[22032+(7*d|0)+u>>0])u=5;else if((0|(d=0|s[21200+(28*d|0)+(u<<2)>>2]))>0){p=b+4|0,u=0;do{ot(p),u=u+1|0}while((0|u)!=(0|d));_=50}else _=50;else _=50}while(0);return 50==(0|_)&&(s[o>>2]=s[(u=b+4|0)>>2],s[o+4>>2]=s[u+4>>2],s[o+8>>2]=s[u+8>>2],u=0),I=h,0|u}function Zt(t,e,i,n){i|=0,n|=0;var r,o,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0;if(o=I,I=I+48|0,c=o+36|0,h=o+24|0,u=o+12|0,d=o,l=0|Ae(0|(t|=0),0|(e|=0),52),x(),l&=15,f=0|Ae(0|t,0|e,45),x(),r=0|F(f&=127),ve(0|l,0,52),A=134225919|x(),s[(g=n)>>2]=-1,s[g+4>>2]=A,!l)return(0|s[i>>2])>1||(0|s[i+4>>2])>1||(0|s[i+8>>2])>1||127==(0|(a=0|$(f,0|J(i))))?(I=o,0|(A=1)):(m=0|ve(0|a,0,45),g=0|x(),g|=-1040385&s[(f=n)+4>>2],s[(A=n)>>2]=s[f>>2]|m,s[A+4>>2]=g,I=o,0|(A=0));for(s[c>>2]=s[i>>2],s[c+4>>2]=s[i+4>>2],s[c+8>>2]=s[i+8>>2];s[h>>2]=s[c>>2],s[h+4>>2]=s[c+4>>2],s[h+8>>2]=s[c+8>>2],0|Lt(l)?(tt(c),s[u>>2]=s[c>>2],s[u+4>>2]=s[c+4>>2],s[u+8>>2]=s[c+8>>2],it(u)):(et(c),s[u>>2]=s[c>>2],s[u+4>>2]=s[c+4>>2],s[u+8>>2]=s[c+8>>2],nt(u)),X(h,u,d),Y(d),v=0|s[(g=n)>>2],g=0|s[g+4>>2],i=0|ve(7,0,0|(_=3*(15-l|0)|0)),g&=~(0|x()),_=0|ve(0|J(d),0,0|_),g=0|x()|g,s[(A=n)>>2]=_|v&~i,s[A+4>>2]=g,(0|l)>1;)l=l+-1|0;t:do{if((0|s[c>>2])<=1&&(0|s[c+4>>2])<=1&&(0|s[c+8>>2])<=1){d=127==(0|(h=0|$(f,l=0|J(c))))?0:0|F(h);e:do{if(l){if(r){if(c=21408+(28*(0|It(t,e))|0)+(l<<2)|0,(0|(c=0|s[c>>2]))>0){i=0;do{l=0|at(l),i=i+1|0}while((0|i)!=(0|c))}if(1==(0|l)){a=3;break t}127==(0|(i=0|$(f,l)))&&S(23104,22949,376,23134),0|F(i)?S(23147,22949,377,23134):(m=c,p=l,a=i)}else m=0,p=l,a=h;if((0|(u=0|s[4304+(28*f|0)+(p<<2)>>2]))<=-1&&S(23178,22949,384,23134),!d){if((0|m)<=-1&&S(23030,22949,417,23134),0|m){l=0,i=0|s[(c=n)>>2],c=0|s[c+4>>2];do{i=0|Ot(i,c),c=0|x(),s[(_=n)>>2]=i,s[_+4>>2]=c,l=l+1|0}while((0|l)<(0|m))}if((0|u)<=0){l=54;break}for(l=0,i=0|s[(c=n)>>2],c=0|s[c+4>>2];;)if(i=0|Ot(i,c),c=0|x(),s[(_=n)>>2]=i,s[_+4>>2]=c,(0|(l=l+1|0))==(0|u)){l=54;break e}}if(7==(0|(h=0|U(a,f)))&&S(22925,22949,393,23134),i=0|s[(l=n)>>2],l=0|s[l+4>>2],(0|u)>0){c=0;do{i=0|Ot(i,l),l=0|x(),s[(_=n)>>2]=i,s[_+4>>2]=l,c=c+1|0}while((0|c)!=(0|u))}if(i=0|It(i,l),_=0|N(a),(0|(i=0|s[(_?21824:21616)+(28*h|0)+(i<<2)>>2]))<=-1&&S(23030,22949,412,23134),i){l=0,c=0|s[(h=n)>>2],h=0|s[h+4>>2];do{c=0|Pt(c,h),h=0|x(),s[(_=n)>>2]=c,s[_+4>>2]=h,l=l+1|0}while((0|l)<(0|i));l=54}else l=54}else if(0!=(0|r)&0!=(0|d))if(_=0|It(t,e),l=n,l=21408+(28*_|0)+((0|It(0|s[l>>2],0|s[l+4>>2]))<<2)|0,l=0|s[l>>2],(0|l)<=-1&&S(23201,22949,433,23134),l){a=0,i=0|s[(c=n)>>2],c=0|s[c+4>>2];do{i=0|Ot(i,c),c=0|x(),s[(_=n)>>2]=i,s[_+4>>2]=c,a=a+1|0}while((0|a)<(0|l));a=h,l=54}else a=h,l=55;else a=h,l=54}while(0);if(54==(0|l)&&d&&(l=55),55==(0|l)&&1==(0|It(0|s[(_=n)>>2],0|s[_+4>>2]))){a=4;break}A=0|s[(_=n)>>2],_=-1040385&s[_+4>>2],v=0|ve(0|a,0,45),_=0|_|x(),s[(a=n)>>2]=A|v,s[a+4>>2]=_,a=0}else a=2}while(0);return I=o,0|a}function Kt(t,e){var i=0;if(!(e|=0))return 1;i=t|=0,t=1;do{t=0|_(0==(1&e|0)?1:i,t),e>>=1,i=0|_(i,i)}while(0!=(0|e));return 0|t}function Xt(t,e,i){t|=0;var n,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0;if(!(0|H(e|=0,i|=0))||(e=0|j(e),f=+r[i>>3],o=e&(o=+r[i+8>>3])<0?o+6.283185307179586:o,(0|(p=0|s[t>>2]))<=0))return 0;if(n=0|s[t+4>>2],e){e=0,i=-1,t=0;t:for(;;){for(d=t;u=+r[n+(d<<4)+8>>3],a=+r[n+((t=(i+2|0)%(0|p)|0)<<4)+8>>3],(c=+r[n+(d<<4)>>3])>(l=+r[n+(t<<4)>>3])?(h=c,c=u):(h=l,l=c,c=a,a=u),f<l|f>h;){if(!((0|(i=d+1|0))<(0|p))){i=22;break t}t=d,d=i,i=t}if(o=(c=c<0?c+6.283185307179586:c)==o|(u=a<0?a+6.283185307179586:a)==o?o+-2220446049250313e-31:o,((u+=(f-l)/(h-l)*(c-u))<0?u+6.283185307179586:u)>o&&(e^=1),(0|(t=d+1|0))>=(0|p)){i=22;break}i=d}if(22==(0|i))return 0|e}else{e=0,i=-1,t=0;t:for(;;){for(d=t;u=+r[n+(d<<4)+8>>3],a=+r[n+((t=(i+2|0)%(0|p)|0)<<4)+8>>3],(c=+r[n+(d<<4)>>3])>(l=+r[n+(t<<4)>>3])?(h=c,c=u):(h=l,l=c,c=a,a=u),f<l|f>h;){if(!((0|(i=d+1|0))<(0|p))){i=22;break t}t=d,d=i,i=t}if(a+(f-l)/(h-l)*(c-a)>(o=c==o|a==o?o+-2220446049250313e-31:o)&&(e^=1),(0|(t=d+1|0))>=(0|p)){i=22;break}i=d}if(22==(0|i))return 0|e}return 0}function Qt(t,e){e|=0;var i,n,o,a,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0,y=0;if(!(i=0|s[(t|=0)>>2]))return s[e>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+24>>2]=0,void(s[e+28>>2]=0);if(r[(n=e+8|0)>>3]=17976931348623157e292,r[(o=e+24|0)>>3]=17976931348623157e292,r[e>>3]=-17976931348623157e292,r[(a=e+16|0)>>3]=-17976931348623157e292,!((0|i)<=0)){for(_=0|s[t+4>>2],g=17976931348623157e292,A=-17976931348623157e292,v=0,t=-1,d=17976931348623157e292,p=17976931348623157e292,m=-17976931348623157e292,h=-17976931348623157e292,b=0;f=+r[_+(b<<4)+8>>3],u=+r[_+(((0|(t=t+2|0))==(0|i)?0:t)<<4)+8>>3],(c=+r[_+(b<<4)>>3])<d&&(r[n>>3]=c,d=c),f<p&&(r[o>>3]=f,p=f),c>m?r[e>>3]=c:c=m,f>h&&(r[a>>3]=f,h=f),g=f>0&f<g?f:g,A=f<0&f>A?f:A,v|=+l(+(f-u))>3.141592653589793,(0|(t=b+1|0))!=(0|i);)y=b,m=c,b=t,t=y;!v||(r[a>>3]=A,r[o>>3]=g)}}function Jt(t,e,i){var n=0,r=0;if(!(0|Xt(t|=0,e|=0,i|=0)))return 0;if((0|s[(r=t+8|0)>>2])<=0)return 1;for(n=t+12|0,t=0;;){if(0|Xt((0|s[n>>2])+(t<<3)|0,e+((t=t+1|0)<<5)|0,i)){t=0,n=6;break}if((0|t)>=(0|s[r>>2])){t=1,n=6;break}}return 6==(0|n)?0|t:0}function te(t,e,i,n,s){var o,a,l,c,h,u,d,p=0;r[(s|=0)>>3]=(c=+r[(t|=0)>>3])+(l=+r[(e|=0)>>3]-c)*(p=((p=+r[(n|=0)>>3]-(u=+r[(i|=0)>>3]))*((a=+r[t+8>>3])-(d=+r[i+8>>3]))-(c-u)*(h=+r[n+8>>3]-d))/(l*h-(o=+r[e+8>>3]-a)*p)),r[s+8>>3]=a+o*p}function ee(t,e){return+r[(t|=0)>>3]!=+r[(e|=0)>>3]?0|(e=0):0|(e=+r[t+8>>3]==+r[e+8>>3])}function ie(t,e){var i,n,s;return+((s=+r[(t|=0)>>3]-+r[(e|=0)>>3])*s+(n=+r[t+8>>3]-+r[e+8>>3])*n+(i=+r[t+16>>3]-+r[e+16>>3])*i)}function ne(t,e,i){t|=0,i|=0;var n=0;(0|(e|=0))>0?(n=0|pe(e,4),s[t>>2]=n,n||S(23230,23253,40,23267)):s[t>>2]=0,s[t+4>>2]=e,s[t+8>>2]=0,s[t+12>>2]=i}function se(t){var e,i,n,o=0,a=0,c=0,u=0;e=4+(t|=0)|0,i=t+12|0,n=t+8|0;t:for(;;){for(a=0|s[e>>2],o=0;;){if((0|o)>=(0|a))break t;if(u=0|s[(c=0|s[t>>2])+(o<<2)>>2])break;o=o+1|0}o=c+(~~(+l(+ +h(10,+ +(15-(0|s[i>>2])|0))*(+r[u>>3]+ +r[u+8>>3]))%+(0|a))>>>0<<2)|0,a=0|s[o>>2];e:do{if(0|a){if(c=u+32|0,(0|a)==(0|u))s[o>>2]=s[c>>2];else{if(!(o=0|s[(a=a+32|0)>>2]))break;for(;(0|o)!=(0|u);)if(!(o=0|s[(a=o+32|0)>>2]))break e;s[a>>2]=s[c>>2]}de(u),s[n>>2]=(0|s[n>>2])-1}}while(0)}de(0|s[t>>2])}function re(t){var e,i=0,n=0;for(e=0|s[4+(t|=0)>>2],n=0;;){if((0|n)>=(0|e)){i=0,n=4;break}if(i=0|s[(0|s[t>>2])+(n<<2)>>2]){n=4;break}n=n+1|0}return 4==(0|n)?0|i:0}function oe(t,e){e|=0;var i=0,n=0,o=0,a=0;if(i=~~(+l(+ +h(10,+ +(15-(0|s[12+(t|=0)>>2])|0))*(+r[e>>3]+ +r[e+8>>3]))%+(0|s[t+4>>2]))>>>0,!(n=0|s[(i=(0|s[t>>2])+(i<<2)|0)>>2]))return 1;a=e+32|0;do{if((0|n)!=(0|e)){if(!(i=0|s[n+32>>2]))return 1;for(o=i;;){if((0|o)==(0|e)){o=8;break}if(!(i=0|s[o+32>>2])){i=1,o=10;break}n=o,o=i}if(8==(0|o)){s[n+32>>2]=s[a>>2];break}if(10==(0|o))return 0|i}else s[i>>2]=s[a>>2]}while(0);return de(e),s[(a=t+8|0)>>2]=(0|s[a>>2])-1,0}function ae(t,e,i){t|=0,e|=0,i|=0;var n,o=0,a=0,c=0;(n=0|ue(40))||S(23283,23253,98,23296),s[n>>2]=s[e>>2],s[n+4>>2]=s[e+4>>2],s[n+8>>2]=s[e+8>>2],s[n+12>>2]=s[e+12>>2],s[(a=n+16|0)>>2]=s[i>>2],s[a+4>>2]=s[i+4>>2],s[a+8>>2]=s[i+8>>2],s[a+12>>2]=s[i+12>>2],s[n+32>>2]=0,a=~~(+l(+ +h(10,+ +(15-(0|s[t+12>>2])|0))*(+r[e>>3]+ +r[e+8>>3]))%+(0|s[t+4>>2]))>>>0,o=0|s[(a=(0|s[t>>2])+(a<<2)|0)>>2];do{if(o){for(;!(0|wt(o,e)&&0|wt(o+16|0,i));)if(!(0|s[(o=0==(0|(a=0|s[o+32>>2]))?o:a)+32>>2])){c=10;break}if(10==(0|c)){s[o+32>>2]=n;break}return de(n),0|o}s[a>>2]=n}while(0);return s[(c=t+8|0)>>2]=1+(0|s[c>>2]),0|n}function le(t,e,i){e|=0,i|=0;var n=0,o=0;if(o=~~(+l(+ +h(10,+ +(15-(0|s[12+(t|=0)>>2])|0))*(+r[e>>3]+ +r[e+8>>3]))%+(0|s[t+4>>2]))>>>0,!(o=0|s[(0|s[t>>2])+(o<<2)>>2]))return 0;if(!i){for(t=o;;){if(0|wt(t,e)){n=10;break}if(!(t=0|s[t+32>>2])){t=0,n=10;break}}if(10==(0|n))return 0|t}for(t=o;;){if(0|wt(t,e)&&0|wt(t+16|0,i)){n=10;break}if(!(t=0|s[t+32>>2])){t=0,n=10;break}}return 10==(0|n)?0|t:0}function ce(t,e){e|=0;var i=0;if(i=~~(+l(+ +h(10,+ +(15-(0|s[12+(t|=0)>>2])|0))*(+r[e>>3]+ +r[e+8>>3]))%+(0|s[t+4>>2]))>>>0,!(t=0|s[(0|s[t>>2])+(i<<2)>>2]))return 0;for(;;){if(0|wt(t,e)){e=5;break}if(!(t=0|s[t+32>>2])){t=0,e=5;break}}return 5==(0|e)?0|t:0}function he(t){return 0|~~+function(t){return+ +xe(+(t=+t))}(t=+t)}function ue(t){t|=0;var e,i=0,n=0,r=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0,y=0,w=0;e=I,I=I+16|0,f=e;do{if(t>>>0<245){if(3&(n=(p=0|s[5829])>>>(t=(u=t>>>0<11?16:t+11&-8)>>>3))|0)return(0|(a=0|s[(o=8+(r=0|s[(n=8+(t=23356+((i=(1&n^1)+t|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|t)?s[5829]=p&~(1<<i):(s[a+12>>2]=t,s[n>>2]=a),s[r+4>>2]=3|(w=i<<3),s[(w=r+w+4|0)>>2]=1|s[w>>2],I=e,0|o;if(u>>>0>(d=0|s[5831])>>>0){if(0|n)return i=((i=n<<t&((i=2<<t)|0-i))&0-i)-1|0,(0|(n=0|s[(c=8+(a=0|s[(t=8+(i=23356+((r=((n=(i>>>=c=i>>>12&16)>>>5&8)|c|(a=(i>>>=n)>>>2&4)|(t=(i>>>=a)>>>1&2)|(r=(i>>>=t)>>>1&1))+(i>>>r)|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|i)?s[5829]=t=p&~(1<<r):(s[n+12>>2]=i,s[t>>2]=n,t=p),l=(w=r<<3)-u|0,s[a+4>>2]=3|u,s[4+(o=a+u|0)>>2]=1|l,s[a+w>>2]=l,0|d&&(r=0|s[5834],n=23356+((i=d>>>3)<<1<<2)|0,t&(i=1<<i)?i=0|s[(t=n+8|0)>>2]:(s[5829]=t|i,i=n,t=n+8|0),s[t>>2]=r,s[i+12>>2]=r,s[r+8>>2]=i,s[r+12>>2]=n),s[5831]=l,s[5834]=o,I=e,0|c;if(a=0|s[5830]){for(n=(a&0-a)-1|0,n=h=0|s[23620+(((r=(n>>>=o=n>>>12&16)>>>5&8)|o|(l=(n>>>=r)>>>2&4)|(c=(n>>>=l)>>>1&2)|(h=(n>>>=c)>>>1&1))+(n>>>h)<<2)>>2],c=h,h=(-8&s[h+4>>2])-u|0;(t=0|s[n+16>>2])||(t=0|s[n+20>>2]);)n=t,c=(o=(l=(-8&s[t+4>>2])-u|0)>>>0<h>>>0)?t:c,h=o?l:h;if((l=c+u|0)>>>0>c>>>0){o=0|s[c+24>>2],i=0|s[c+12>>2];do{if((0|i)==(0|c)){if(!(i=0|s[(t=c+20|0)>>2])&&!(i=0|s[(t=c+16|0)>>2])){n=0;break}for(;;)if(n=0|s[(r=i+20|0)>>2])i=n,t=r;else{if(!(n=0|s[(r=i+16|0)>>2]))break;i=n,t=r}s[t>>2]=0,n=i}else s[12+(n=0|s[c+8>>2])>>2]=i,s[i+8>>2]=n,n=i}while(0);do{if(0|o){if((0|c)==(0|s[(t=23620+((i=0|s[c+28>>2])<<2)|0)>>2])){if(s[t>>2]=n,!n){s[5830]=a&~(1<<i);break}}else if(s[((0|s[(w=o+16|0)>>2])==(0|c)?w:o+20|0)>>2]=n,!n)break;s[n+24>>2]=o,0|(i=0|s[c+16>>2])&&(s[n+16>>2]=i,s[i+24>>2]=n),0|(i=0|s[c+20>>2])&&(s[n+20>>2]=i,s[i+24>>2]=n)}}while(0);return h>>>0<16?(s[c+4>>2]=3|(w=h+u|0),s[(w=c+w+4|0)>>2]=1|s[w>>2]):(s[c+4>>2]=3|u,s[l+4>>2]=1|h,s[l+h>>2]=h,0|d&&(r=0|s[5834],n=23356+((i=d>>>3)<<1<<2)|0,(i=1<<i)&p?i=0|s[(t=n+8|0)>>2]:(s[5829]=i|p,i=n,t=n+8|0),s[t>>2]=r,s[i+12>>2]=r,s[r+8>>2]=i,s[r+12>>2]=n),s[5831]=h,s[5834]=l),I=e,0|c+8}p=u}else p=u}else p=u}else if(t>>>0<=4294967231)if(u=-8&(t=t+11|0),r=0|s[5830]){o=0-u|0,h=(t>>>=8)?u>>>0>16777215?31:u>>>(7+(h=14-((c=(520192+(A=t<<(p=(t+1048320|0)>>>16&8))|0)>>>16&4)|p|(h=(245760+(A<<=c)|0)>>>16&2))+(A<<h>>>15)|0)|0)&1|h<<1:0,n=0|s[23620+(h<<2)>>2];t:do{if(n)for(t=0,c=u<<(31==(0|h)?0:25-(h>>>1)|0),a=0;;){if((l=(-8&s[n+4>>2])-u|0)>>>0<o>>>0){if(!l){t=n,o=0,A=65;break t}t=n,o=l}if(a=0==(0|(A=0|s[n+20>>2]))|(0|A)==(0|(n=0|s[n+16+(c>>>31<<2)>>2]))?a:A,!n){n=a,A=61;break}c<<=1}else n=0,t=0,A=61}while(0);if(61==(0|A)){if(0==(0|n)&0==(0|t)){if(!(t=((t=2<<h)|0-t)&r)){p=u;break}p=(t&0-t)-1|0,t=0,n=0|s[23620+(((a=(p>>>=l=p>>>12&16)>>>5&8)|l|(c=(p>>>=a)>>>2&4)|(h=(p>>>=c)>>>1&2)|(n=(p>>>=h)>>>1&1))+(p>>>n)<<2)>>2]}n?A=65:(c=t,l=o)}if(65==(0|A))for(a=n;;){if(o=(n=(p=(-8&s[a+4>>2])-u|0)>>>0<o>>>0)?p:o,t=n?a:t,(n=0|s[a+16>>2])||(n=0|s[a+20>>2]),!n){c=t,l=o;break}a=n}if(0!=(0|c)&&l>>>0<((0|s[5831])-u|0)>>>0&&(d=c+u|0)>>>0>c>>>0){a=0|s[c+24>>2],i=0|s[c+12>>2];do{if((0|i)==(0|c)){if(!(i=0|s[(t=c+20|0)>>2])&&!(i=0|s[(t=c+16|0)>>2])){i=0;break}for(;;)if(n=0|s[(o=i+20|0)>>2])i=n,t=o;else{if(!(n=0|s[(o=i+16|0)>>2]))break;i=n,t=o}s[t>>2]=0}else s[12+(w=0|s[c+8>>2])>>2]=i,s[i+8>>2]=w}while(0);do{if(a){if((0|c)==(0|s[(n=23620+((t=0|s[c+28>>2])<<2)|0)>>2])){if(s[n>>2]=i,!i){s[5830]=r&=~(1<<t);break}}else if(s[((0|s[(w=a+16|0)>>2])==(0|c)?w:a+20|0)>>2]=i,!i)break;s[i+24>>2]=a,0|(t=0|s[c+16>>2])&&(s[i+16>>2]=t,s[t+24>>2]=i),(t=0|s[c+20>>2])&&(s[i+20>>2]=t,s[t+24>>2]=i)}}while(0);t:do{if(l>>>0<16)w=l+u|0,s[c+4>>2]=3|w,w=c+w+4|0,s[w>>2]=1|s[w>>2];else{if(s[c+4>>2]=3|u,s[d+4>>2]=1|l,s[d+l>>2]=l,i=l>>>3,l>>>0<256){n=23356+(i<<1<<2)|0,(t=0|s[5829])&(i=1<<i)?i=0|s[(t=n+8|0)>>2]:(s[5829]=t|i,i=n,t=n+8|0),s[t>>2]=d,s[i+12>>2]=d,s[d+8>>2]=i,s[d+12>>2]=n;break}if(n=(i=l>>>8)?l>>>0>16777215?31:l>>>(7+(n=14-((b=(520192+(w=i<<(y=(i+1048320|0)>>>16&8))|0)>>>16&4)|y|(n=(245760+(w<<=b)|0)>>>16&2))+(w<<n>>>15)|0)|0)&1|n<<1:0,i=23620+(n<<2)|0,s[d+28>>2]=n,s[4+(t=d+16|0)>>2]=0,s[t>>2]=0,!(r&(t=1<<n))){s[5830]=r|t,s[i>>2]=d,s[d+24>>2]=i,s[d+12>>2]=d,s[d+8>>2]=d;break}i=0|s[i>>2];e:do{if((-8&s[i+4>>2]|0)!=(0|l)){for(r=l<<(31==(0|n)?0:25-(n>>>1)|0);t=0|s[(n=i+16+(r>>>31<<2)|0)>>2];){if((-8&s[t+4>>2]|0)==(0|l)){i=t;break e}r<<=1,i=t}s[n>>2]=d,s[d+24>>2]=i,s[d+12>>2]=d,s[d+8>>2]=d;break t}}while(0);s[12+(w=0|s[(y=i+8|0)>>2])>>2]=d,s[y>>2]=d,s[d+8>>2]=w,s[d+12>>2]=i,s[d+24>>2]=0}}while(0);return I=e,0|c+8}p=u}else p=u;else p=-1}while(0);if((n=0|s[5831])>>>0>=p>>>0)return t=0|s[5834],(i=n-p|0)>>>0>15?(s[5834]=w=t+p|0,s[5831]=i,s[w+4>>2]=1|i,s[t+n>>2]=i,s[t+4>>2]=3|p):(s[5831]=0,s[5834]=0,s[t+4>>2]=3|n,s[(w=t+n+4|0)>>2]=1|s[w>>2]),I=e,0|t+8;if((l=0|s[5832])>>>0>p>>>0)return s[5832]=b=l-p|0,s[5835]=y=(w=0|s[5835])+p|0,s[y+4>>2]=1|b,s[w+4>>2]=3|p,I=e,0|w+8;if(0|s[5947]?t=0|s[5949]:(s[5949]=4096,s[5948]=4096,s[5950]=-1,s[5951]=-1,s[5952]=0,s[5940]=0,s[5947]=-16&f^1431655768,t=4096),c=p+48|0,(u=(a=t+(h=p+47|0)|0)&(o=0-t|0))>>>0<=p>>>0||0|(t=0|s[5939])&&(f=(d=0|s[5937])+u|0)>>>0<=d>>>0|f>>>0>t>>>0)return I=e,0;t:do{if(4&s[5940])i=0,A=143;else{n=0|s[5835];e:do{if(n){for(r=23764;!((f=0|s[r>>2])>>>0<=n>>>0&&(f+(0|s[r+4>>2])|0)>>>0>n>>>0);){if(!(t=0|s[r+8>>2])){A=128;break e}r=t}if((i=a-l&o)>>>0<2147483647)if((0|(t=0|Se(0|i)))==((0|s[r>>2])+(0|s[r+4>>2])|0)){if(-1!=(0|t)){l=i,a=t,A=145;break t}}else r=t,A=136;else i=0}else A=128}while(0);do{if(128==(0|A))if(-1!=(0|(n=0|Se(0)))&&(g=(i=(0==((g=(m=0|s[5948])-1|0)&(i=n)|0)?0:(g+i&0-m)-i|0)+u|0)+(m=0|s[5937])|0,i>>>0>p>>>0&i>>>0<2147483647)){if(0|(f=0|s[5939])&&g>>>0<=m>>>0|g>>>0>f>>>0){i=0;break}if((0|(t=0|Se(0|i)))==(0|n)){l=i,a=n,A=145;break t}r=t,A=136}else i=0}while(0);do{if(136==(0|A)){if(n=0-i|0,!(c>>>0>i>>>0&i>>>0<2147483647&-1!=(0|r))){if(-1==(0|r)){i=0;break}l=i,a=r,A=145;break t}if((t=h-i+(t=0|s[5949])&0-t)>>>0>=2147483647){l=i,a=r,A=145;break t}if(-1==(0|Se(0|t))){Se(0|n),i=0;break}l=t+i|0,a=r,A=145;break t}}while(0);s[5940]=4|s[5940],A=143}}while(0);if((143==(0|A)&&u>>>0<2147483647?!(-1==(0|(b=0|Se(0|u)))|1^(_=(v=(g=0|Se(0))-b|0)>>>0>(p+40|0)>>>0)|b>>>0<g>>>0&-1!=(0|b)&-1!=(0|g)^1):0)&&(l=_?v:i,a=b,A=145),145==(0|A)){s[5937]=i=(0|s[5937])+l|0,i>>>0>(0|s[5938])>>>0&&(s[5938]=i),h=0|s[5835];t:do{if(h){for(i=23764;;){if((0|a)==((t=0|s[i>>2])+(n=0|s[i+4>>2])|0)){A=154;break}if(!(r=0|s[i+8>>2]))break;i=r}if(154==(0|A)&&(y=i+4|0,0==(8&s[i+12>>2]|0))&&a>>>0>h>>>0&t>>>0<=h>>>0){s[y>>2]=n+l,y=h+(b=0==(7&(b=h+8|0)|0)?0:0-b&7)|0,b=(w=(0|s[5832])+l|0)-b|0,s[5835]=y,s[5832]=b,s[y+4>>2]=1|b,s[h+w+4>>2]=40,s[5836]=s[5951];break}for(a>>>0<(0|s[5833])>>>0&&(s[5833]=a),n=a+l|0,i=23764;;){if((0|s[i>>2])==(0|n)){A=162;break}if(!(t=0|s[i+8>>2]))break;i=t}if(162==(0|A)&&0==(8&s[i+12>>2]|0)){s[i>>2]=a,s[(d=i+4|0)>>2]=(0|s[d>>2])+l,u=(d=a+(0==(7&(d=a+8|0)|0)?0:0-d&7)|0)+p|0,c=(i=n+(0==(7&(i=n+8|0)|0)?0:0-i&7)|0)-d-p|0,s[d+4>>2]=3|p;e:do{if((0|h)==(0|i))w=(0|s[5832])+c|0,s[5832]=w,s[5835]=u,s[u+4>>2]=1|w;else{if((0|s[5834])==(0|i)){s[5831]=w=(0|s[5831])+c|0,s[5834]=u,s[u+4>>2]=1|w,s[u+w>>2]=w;break}if(1==(3&(t=0|s[i+4>>2])|0)){l=-8&t,r=t>>>3;i:do{if(t>>>0<256){if((0|(n=0|s[i+12>>2]))==(0|(t=0|s[i+8>>2]))){s[5829]=s[5829]&~(1<<r);break}s[t+12>>2]=n,s[n+8>>2]=t;break}a=0|s[i+24>>2],t=0|s[i+12>>2];do{if((0|t)==(0|i)){if(t=0|s[(r=4+(n=i+16|0)|0)>>2])n=r;else if(!(t=0|s[n>>2])){t=0;break}for(;;)if(r=0|s[(o=t+20|0)>>2])t=r,n=o;else{if(!(r=0|s[(o=t+16|0)>>2]))break;t=r,n=o}s[n>>2]=0}else s[12+(w=0|s[i+8>>2])>>2]=t,s[t+8>>2]=w}while(0);if(!a)break;r=23620+((n=0|s[i+28>>2])<<2)|0;do{if((0|s[r>>2])==(0|i)){if(s[r>>2]=t,0|t)break;s[5830]=s[5830]&~(1<<n);break i}if(s[((0|s[(w=a+16|0)>>2])==(0|i)?w:a+20|0)>>2]=t,!t)break i}while(0);if(s[t+24>>2]=a,0|(r=0|s[(n=i+16|0)>>2])&&(s[t+16>>2]=r,s[r+24>>2]=t),!(n=0|s[n+4>>2]))break;s[t+20>>2]=n,s[n+24>>2]=t}while(0);i=i+l|0,o=l+c|0}else o=c;if(s[(i=i+4|0)>>2]=-2&s[i>>2],s[u+4>>2]=1|o,s[u+o>>2]=o,i=o>>>3,o>>>0<256){n=23356+(i<<1<<2)|0,(t=0|s[5829])&(i=1<<i)?i=0|s[(t=n+8|0)>>2]:(s[5829]=t|i,i=n,t=n+8|0),s[t>>2]=u,s[i+12>>2]=u,s[u+8>>2]=i,s[u+12>>2]=n;break}i=o>>>8;do{if(i){if(o>>>0>16777215){r=31;break}r=o>>>(7+(r=14-((b=(520192+(w=i<<(y=(i+1048320|0)>>>16&8))|0)>>>16&4)|y|(r=(245760+(w<<=b)|0)>>>16&2))+(w<<r>>>15)|0)|0)&1|r<<1}else r=0}while(0);if(i=23620+(r<<2)|0,s[u+28>>2]=r,s[4+(t=u+16|0)>>2]=0,s[t>>2]=0,!((t=0|s[5830])&(n=1<<r))){s[5830]=t|n,s[i>>2]=u,s[u+24>>2]=i,s[u+12>>2]=u,s[u+8>>2]=u;break}i=0|s[i>>2];i:do{if((-8&s[i+4>>2]|0)!=(0|o)){for(r=o<<(31==(0|r)?0:25-(r>>>1)|0);t=0|s[(n=i+16+(r>>>31<<2)|0)>>2];){if((-8&s[t+4>>2]|0)==(0|o)){i=t;break i}r<<=1,i=t}s[n>>2]=u,s[u+24>>2]=i,s[u+12>>2]=u,s[u+8>>2]=u;break e}}while(0);s[12+(w=0|s[(y=i+8|0)>>2])>>2]=u,s[y>>2]=u,s[u+8>>2]=w,s[u+12>>2]=i,s[u+24>>2]=0}}while(0);return I=e,0|d+8}for(i=23764;!((t=0|s[i>>2])>>>0<=h>>>0&&(w=t+(0|s[i+4>>2])|0,w>>>0>h>>>0));)i=0|s[i+8>>2];i=(t=(t=(o=w+-47|0)+(0==(7&(t=o+8|0)|0)?0:0-t&7)|0)>>>0<(o=h+16|0)>>>0?h:t)+8|0,y=a+(b=0==(7&(b=a+8|0)|0)?0:0-b&7)|0,b=(n=l+-40|0)-b|0,s[5835]=y,s[5832]=b,s[y+4>>2]=1|b,s[a+n+4>>2]=40,s[5836]=s[5951],s[(n=t+4|0)>>2]=27,s[i>>2]=s[5941],s[i+4>>2]=s[5942],s[i+8>>2]=s[5943],s[i+12>>2]=s[5944],s[5941]=a,s[5942]=l,s[5944]=0,s[5943]=i,i=t+24|0;do{y=i,s[(i=i+4|0)>>2]=7}while((y+8|0)>>>0<w>>>0);if((0|t)!=(0|h)){if(a=t-h|0,s[n>>2]=-2&s[n>>2],s[h+4>>2]=1|a,s[t>>2]=a,i=a>>>3,a>>>0<256){n=23356+(i<<1<<2)|0,(t=0|s[5829])&(i=1<<i)?i=0|s[(t=n+8|0)>>2]:(s[5829]=t|i,i=n,t=n+8|0),s[t>>2]=h,s[i+12>>2]=h,s[h+8>>2]=i,s[h+12>>2]=n;break}if(n=23620+((r=(i=a>>>8)?a>>>0>16777215?31:a>>>(7+(r=14-((b=(520192+(w=i<<(y=(i+1048320|0)>>>16&8))|0)>>>16&4)|y|(r=(245760+(w<<=b)|0)>>>16&2))+(w<<r>>>15)|0)|0)&1|r<<1:0)<<2)|0,s[h+28>>2]=r,s[h+20>>2]=0,s[o>>2]=0,!((i=0|s[5830])&(t=1<<r))){s[5830]=i|t,s[n>>2]=h,s[h+24>>2]=n,s[h+12>>2]=h,s[h+8>>2]=h;break}i=0|s[n>>2];e:do{if((-8&s[i+4>>2]|0)!=(0|a)){for(r=a<<(31==(0|r)?0:25-(r>>>1)|0);t=0|s[(n=i+16+(r>>>31<<2)|0)>>2];){if((-8&s[t+4>>2]|0)==(0|a)){i=t;break e}r<<=1,i=t}s[n>>2]=h,s[h+24>>2]=i,s[h+12>>2]=h,s[h+8>>2]=h;break t}}while(0);s[12+(w=0|s[(y=i+8|0)>>2])>>2]=h,s[y>>2]=h,s[h+8>>2]=w,s[h+12>>2]=i,s[h+24>>2]=0}}else w=0|s[5833],0==(0|w)|a>>>0<w>>>0&&(s[5833]=a),s[5941]=a,s[5942]=l,s[5944]=0,s[5838]=s[5947],s[5837]=-1,s[5842]=23356,s[5841]=23356,s[5844]=23364,s[5843]=23364,s[5846]=23372,s[5845]=23372,s[5848]=23380,s[5847]=23380,s[5850]=23388,s[5849]=23388,s[5852]=23396,s[5851]=23396,s[5854]=23404,s[5853]=23404,s[5856]=23412,s[5855]=23412,s[5858]=23420,s[5857]=23420,s[5860]=23428,s[5859]=23428,s[5862]=23436,s[5861]=23436,s[5864]=23444,s[5863]=23444,s[5866]=23452,s[5865]=23452,s[5868]=23460,s[5867]=23460,s[5870]=23468,s[5869]=23468,s[5872]=23476,s[5871]=23476,s[5874]=23484,s[5873]=23484,s[5876]=23492,s[5875]=23492,s[5878]=23500,s[5877]=23500,s[5880]=23508,s[5879]=23508,s[5882]=23516,s[5881]=23516,s[5884]=23524,s[5883]=23524,s[5886]=23532,s[5885]=23532,s[5888]=23540,s[5887]=23540,s[5890]=23548,s[5889]=23548,s[5892]=23556,s[5891]=23556,s[5894]=23564,s[5893]=23564,s[5896]=23572,s[5895]=23572,s[5898]=23580,s[5897]=23580,s[5900]=23588,s[5899]=23588,s[5902]=23596,s[5901]=23596,s[5904]=23604,s[5903]=23604,w=l+-40|0,b=a+8|0,b=0==(7&b|0)?0:0-b&7,y=a+b|0,b=w-b|0,s[5835]=y,s[5832]=b,s[y+4>>2]=1|b,s[a+w+4>>2]=40,s[5836]=s[5951]}while(0);if((i=0|s[5832])>>>0>p>>>0)return s[5832]=b=i-p|0,s[5835]=y=(w=0|s[5835])+p|0,s[y+4>>2]=1|b,s[w+4>>2]=3|p,I=e,0|w+8}return s[(w=23312)>>2]=12,I=e,0}function de(t){var e=0,i=0,n=0,r=0,o=0,a=0,l=0,c=0;if(t|=0){r=0|s[5833],c=(i=t+-8|0)+(e=-8&(t=0|s[t+-4>>2]))|0;do{if(1&t)l=i,a=i;else{if(n=0|s[i>>2],!(3&t)||(o=n+e|0,(a=i+(0-n)|0)>>>0<r>>>0))return;if((0|s[5834])==(0|a)){if(3!=(3&(e=0|s[(t=c+4|0)>>2])|0)){l=a,e=o;break}return s[5831]=o,s[t>>2]=-2&e,s[a+4>>2]=1|o,void(s[a+o>>2]=o)}if(i=n>>>3,n>>>0<256){if((0|(e=0|s[a+12>>2]))==(0|(t=0|s[a+8>>2]))){s[5829]=s[5829]&~(1<<i),l=a,e=o;break}s[t+12>>2]=e,s[e+8>>2]=t,l=a,e=o;break}r=0|s[a+24>>2],t=0|s[a+12>>2];do{if((0|t)==(0|a)){if(t=0|s[(i=4+(e=a+16|0)|0)>>2])e=i;else if(!(t=0|s[e>>2])){t=0;break}for(;;)if(i=0|s[(n=t+20|0)>>2])t=i,e=n;else{if(!(i=0|s[(n=t+16|0)>>2]))break;t=i,e=n}s[e>>2]=0}else s[12+(l=0|s[a+8>>2])>>2]=t,s[t+8>>2]=l}while(0);if(r){if((0|s[(i=23620+((e=0|s[a+28>>2])<<2)|0)>>2])==(0|a)){if(s[i>>2]=t,!t){s[5830]=s[5830]&~(1<<e),l=a,e=o;break}}else if(s[((0|s[(l=r+16|0)>>2])==(0|a)?l:r+20|0)>>2]=t,!t){l=a,e=o;break}s[t+24>>2]=r,0|(i=0|s[(e=a+16|0)>>2])&&(s[t+16>>2]=i,s[i+24>>2]=t),(e=0|s[e+4>>2])?(s[t+20>>2]=e,s[e+24>>2]=t,l=a,e=o):(l=a,e=o)}else l=a,e=o}}while(0);if(!(a>>>0>=c>>>0)&&1&(n=0|s[(t=c+4|0)>>2])){if(2&n)s[t>>2]=-2&n,s[l+4>>2]=1|e,s[a+e>>2]=e,r=e;else{if((0|s[5835])==(0|c)){if(s[5832]=c=(0|s[5832])+e|0,s[5835]=l,s[l+4>>2]=1|c,(0|l)!=(0|s[5834]))return;return s[5834]=0,void(s[5831]=0)}if((0|s[5834])==(0|c))return s[5831]=c=(0|s[5831])+e|0,s[5834]=a,s[l+4>>2]=1|c,void(s[a+c>>2]=c);r=(-8&n)+e|0,i=n>>>3;do{if(n>>>0<256){if((0|(t=0|s[c+12>>2]))==(0|(e=0|s[c+8>>2]))){s[5829]=s[5829]&~(1<<i);break}s[e+12>>2]=t,s[t+8>>2]=e;break}o=0|s[c+24>>2],t=0|s[c+12>>2];do{if((0|t)==(0|c)){if(t=0|s[(i=4+(e=c+16|0)|0)>>2])e=i;else if(!(t=0|s[e>>2])){i=0;break}for(;;)if(i=0|s[(n=t+20|0)>>2])t=i,e=n;else{if(!(i=0|s[(n=t+16|0)>>2]))break;t=i,e=n}s[e>>2]=0,i=t}else s[12+(i=0|s[c+8>>2])>>2]=t,s[t+8>>2]=i,i=t}while(0);if(0|o){if((0|s[(e=23620+((t=0|s[c+28>>2])<<2)|0)>>2])==(0|c)){if(s[e>>2]=i,!i){s[5830]=s[5830]&~(1<<t);break}}else if(s[((0|s[(n=o+16|0)>>2])==(0|c)?n:o+20|0)>>2]=i,!i)break;s[i+24>>2]=o,0|(e=0|s[(t=c+16|0)>>2])&&(s[i+16>>2]=e,s[e+24>>2]=i),0|(t=0|s[t+4>>2])&&(s[i+20>>2]=t,s[t+24>>2]=i)}}while(0);if(s[l+4>>2]=1|r,s[a+r>>2]=r,(0|l)==(0|s[5834]))return void(s[5831]=r)}if(t=r>>>3,r>>>0<256)return i=23356+(t<<1<<2)|0,(e=0|s[5829])&(t=1<<t)?t=0|s[(e=i+8|0)>>2]:(s[5829]=e|t,t=i,e=i+8|0),s[e>>2]=l,s[t+12>>2]=l,s[l+8>>2]=t,void(s[l+12>>2]=i);n=(t=r>>>8)?r>>>0>16777215?31:r>>>(7+(n=14-((o=(520192+(c=t<<(a=(t+1048320|0)>>>16&8))|0)>>>16&4)|a|(n=(245760+(c<<=o)|0)>>>16&2))+(c<<n>>>15)|0)|0)&1|n<<1:0,t=23620+(n<<2)|0,s[l+28>>2]=n,s[l+20>>2]=0,s[l+16>>2]=0,e=0|s[5830],i=1<<n;t:do{if(e&i){t=0|s[t>>2];e:do{if((-8&s[t+4>>2]|0)!=(0|r)){for(n=r<<(31==(0|n)?0:25-(n>>>1)|0);e=0|s[(i=t+16+(n>>>31<<2)|0)>>2];){if((-8&s[e+4>>2]|0)==(0|r)){t=e;break e}n<<=1,t=e}s[i>>2]=l,s[l+24>>2]=t,s[l+12>>2]=l,s[l+8>>2]=l;break t}}while(0);s[12+(c=0|s[(a=t+8|0)>>2])>>2]=l,s[a>>2]=l,s[l+8>>2]=c,s[l+12>>2]=t,s[l+24>>2]=0}else s[5830]=e|i,s[t>>2]=l,s[l+24>>2]=t,s[l+12>>2]=l,s[l+8>>2]=l}while(0);if(s[5837]=c=(0|s[5837])-1|0,!(0|c)){for(t=23772;t=0|s[t>>2];)t=t+8|0;s[5837]=-1}}}}function pe(t,e){e|=0;var i=0;return(t|=0)?(i=0|_(e,t),(e|t)>>>0>65535&&(i=(0|(i>>>0)/(t>>>0))==(0|e)?i:-1)):i=0,!(t=0|ue(i))||!(3&s[t+-4>>2])||we(0|t,0,0|i),0|t}function fe(t,e,i,n){return w(0|(n=(e|=0)-(n|=0)-((i|=0)>>>0>(t|=0)>>>0|0)>>>0)),0|t-i>>>0}function me(t){return 0|((t|=0)?31-(0|y(t^t-1))|0:32)}function ge(t,e,i,n){var r,o;return o=I,I=I+16|0,function(t,e,i,n,r){r|=0;var o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0;if(u=t|=0,a=i|=0,l=p=n|=0,!(h=c=e|=0))return o=0!=(0|r),l?o?(s[r>>2]=0|t,s[r+4>>2]=0&e,r=0,w(0|(p=0)),0|r):(r=0,w(0|(p=0)),0|r):(o&&(s[r>>2]=(u>>>0)%(a>>>0),s[r+4>>2]=0),r=(u>>>0)/(a>>>0)>>>0,w(0|(p=0)),0|r);o=0==(0|l);do{if(a){if(!o){if((o=(0|y(0|l))-(0|y(0|h))|0)>>>0<=31){a=d=o+1|0,t=u>>>(d>>>0)&(e=o-31>>31)|h<<(l=31-o|0),e&=h>>>(d>>>0),o=0,l=u<<l;break}return r?(s[r>>2]=0|t,s[r+4>>2]=c|0&e,r=0,w(0|(p=0)),0|r):(r=0,w(0|(p=0)),0|r)}if((o=a-1|0)&a|0){a=l=33+(0|y(0|a))-(0|y(0|h))|0,t=(d=32-l|0)-1>>31&h>>>((f=l-32|0)>>>0)|(h<<d|u>>>(l>>>0))&(e=f>>31),e&=h>>>(l>>>0),o=u<<(m=64-l|0)&(c=d>>31),l=(h<<m|u>>>(f>>>0))&c|u<<d&l-33>>31;break}return 0|r&&(s[r>>2]=o&u,s[r+4>>2]=0),1==(0|a)?(m=0|t,w(0|(f=c|0&e)),0|m):(f=h>>>((m=0|me(0|a))>>>0)|0,m=h<<32-m|u>>>(m>>>0)|0,w(0|f),0|m)}if(o)return 0|r&&(s[r>>2]=(h>>>0)%(a>>>0),s[r+4>>2]=0),m=(h>>>0)/(a>>>0)>>>0,w(0|(f=0)),0|m;if(!u)return 0|r&&(s[r>>2]=0,s[r+4>>2]=(h>>>0)%(l>>>0)),m=(h>>>0)/(l>>>0)>>>0,w(0|(f=0)),0|m;if(!((o=l-1|0)&l))return 0|r&&(s[r>>2]=0|t,s[r+4>>2]=o&h|0&e),f=0,m=h>>>((0|me(0|l))>>>0),w(0|f),0|m;if((o=(0|y(0|l))-(0|y(0|h))|0)>>>0<=30){a=e=o+1|0,t=h<<(l=31-o|0)|u>>>(e>>>0),e=h>>>(e>>>0),o=0,l=u<<l;break}return r?(s[r>>2]=0|t,s[r+4>>2]=c|0&e,m=0,w(0|(f=0)),0|m):(m=0,w(0|(f=0)),0|m)}while(0);if(a){h=0|function(t,e,i,n){return w((e|=0)+(n|=0)+((i=(t|=0)+(i|=0)>>>0)>>>0<t>>>0|0)>>>0|0),0|i}(0|(d=0|i),0|(u=p|0&n),-1,-1),i=0|x(),c=l,l=0;do{n=c,c=o>>>31|c<<1,o=l|o<<1,fe(0|h,0|i,0|(n=t<<1|n>>>31|0),0|(p=t>>>31|e<<1|0)),l=1&(f=(m=0|x())>>31|((0|m)<0?-1:0)<<1),t=0|fe(0|n,0|p,f&d|0,(((0|m)<0?-1:0)>>31|((0|m)<0?-1:0)<<1)&u|0),e=0|x(),a=a-1|0}while(0!=(0|a));h=c,c=0}else h=l,c=0,l=0;a=0,0|r&&(s[r>>2]=t,s[r+4>>2]=e),m=-2&(o<<1|0)|l,w(0|(f=(0|o)>>>31|(h|a)<<1|0&(a<<1|o>>>31)|c))}(t|=0,e|=0,i|=0,n|=0,r=0|o),I=o,w(0|s[r+4>>2]),0|s[r>>2]}function Ae(t,e,i){return t|=0,e|=0,(0|(i|=0))<32?(w(e>>>i|0),t>>>i|(e&(1<<i)-1)<<32-i):(w(0),e>>>i-32|0)}function ve(t,e,i){return t|=0,(0|(i|=0))<32?(w((e|=0)<<i|(t&(1<<i)-1<<32-i)>>>32-i|0),t<<i):(w(t<<i-32|0),0)}function _e(t,e){return e=+e,(t=+t)!=t?+e:e!=e?+t:+b(+t,+e)}function be(t){return(t=+t)>=0?+a(t+.5):+v(t-.5)}function ye(t,e,i){t|=0,e|=0;var r,o,a=0;if((0|(i|=0))>=8192)return E(0|t,0|e,0|i),0|t;if(o=0|t,r=t+i|0,(3&t)==(3&e)){for(;3&t;){if(!i)return 0|o;n[t>>0]=0|n[e>>0],t=t+1|0,e=e+1|0,i=i-1|0}for(a=(i=-4&r|0)-64|0;(0|t)<=(0|a);)s[t>>2]=s[e>>2],s[t+4>>2]=s[e+4>>2],s[t+8>>2]=s[e+8>>2],s[t+12>>2]=s[e+12>>2],s[t+16>>2]=s[e+16>>2],s[t+20>>2]=s[e+20>>2],s[t+24>>2]=s[e+24>>2],s[t+28>>2]=s[e+28>>2],s[t+32>>2]=s[e+32>>2],s[t+36>>2]=s[e+36>>2],s[t+40>>2]=s[e+40>>2],s[t+44>>2]=s[e+44>>2],s[t+48>>2]=s[e+48>>2],s[t+52>>2]=s[e+52>>2],s[t+56>>2]=s[e+56>>2],s[t+60>>2]=s[e+60>>2],t=t+64|0,e=e+64|0;for(;(0|t)<(0|i);)s[t>>2]=s[e>>2],t=t+4|0,e=e+4|0}else for(i=r-4|0;(0|t)<(0|i);)n[t>>0]=0|n[e>>0],n[t+1>>0]=0|n[e+1>>0],n[t+2>>0]=0|n[e+2>>0],n[t+3>>0]=0|n[e+3>>0],t=t+4|0,e=e+4|0;for(;(0|t)<(0|r);)n[t>>0]=0|n[e>>0],t=t+1|0,e=e+1|0;return 0|o}function we(t,e,i){e|=0;var r,o=0,a=0,l=0;if(r=(t|=0)+(i|=0)|0,e&=255,(0|i)>=67){for(;3&t;)n[t>>0]=e,t=t+1|0;for(l=e|e<<8|e<<16|e<<24,a=(o=-4&r|0)-64|0;(0|t)<=(0|a);)s[t>>2]=l,s[t+4>>2]=l,s[t+8>>2]=l,s[t+12>>2]=l,s[t+16>>2]=l,s[t+20>>2]=l,s[t+24>>2]=l,s[t+28>>2]=l,s[t+32>>2]=l,s[t+36>>2]=l,s[t+40>>2]=l,s[t+44>>2]=l,s[t+48>>2]=l,s[t+52>>2]=l,s[t+56>>2]=l,s[t+60>>2]=l,t=t+64|0;for(;(0|t)<(0|o);)s[t>>2]=l,t=t+4|0}for(;(0|t)<(0|r);)n[t>>0]=e,t=t+1|0;return r-i|0}function xe(t){return(t=+t)>=0?+a(t+.5):+v(t-.5)}function Se(t){var e,i,n;return t|=0,n=0|k(),(0|t)>0&(0|(e=(i=0|s[o>>2])+t|0))<(0|i)|(0|e)<0?(T(0|e),C(12),-1):(0|e)>(0|n)&&!(0|M(0|e))?(C(12),-1):(s[o>>2]=e,0|i)}return{___uremdi3:ge,_bitshift64Lshr:Ae,_bitshift64Shl:ve,_calloc:pe,_cellAreaKm2:function(t,e){var i,n,r,o=0;if(r=I,I=I+192|0,n=r,zt(t|=0,e|=0,i=r+168|0),Vt(t,e,n),(0|(e=0|s[n>>2]))>0){if(o=+St(n+8|0,n+8+((1!=(0|e)&1)<<4)|0,i)+0,1!=(0|e)){t=1;do{o+=+St(n+8+(t<<4)|0,n+8+(((0|(t=t+1|0))%(0|e)|0)<<4)|0,i)}while((0|t)<(0|e))}}else o=0;return I=r,6371.007180918475*o*6371.007180918475},_cellAreaM2:function(t,e){var i,n,r,o=0;if(r=I,I=I+192|0,n=r,zt(t|=0,e|=0,i=r+168|0),Vt(t,e,n),(0|(e=0|s[n>>2]))>0){if(o=+St(n+8|0,n+8+((1!=(0|e)&1)<<4)|0,i)+0,1!=(0|e)){t=1;do{o+=+St(n+8+(t<<4)|0,n+8+(((0|(t=t+1|0))%(0|e)|0)<<4)|0,i)}while((0|t)<(0|e))}}else o=0;return I=r,6371.007180918475*o*6371.007180918475*1e3*1e3},_cellAreaRads2:function(t,e){var i,n,r,o=0;if(r=I,I=I+192|0,n=r,zt(t|=0,e|=0,i=r+168|0),Vt(t,e,n),(0|(e=0|s[n>>2]))<=0)return I=r,+(o=0);if(o=+St(n+8|0,n+8+((1!=(0|e)&1)<<4)|0,i)+0,1==(0|e))return I=r,+o;t=1;do{o+=+St(n+8+(t<<4)|0,n+8+(((0|(t=t+1|0))%(0|e)|0)<<4)|0,i)}while((0|t)<(0|e));return I=r,+o},_compact:function(t,e,i){e|=0;var n,r=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0,y=0,w=0,S=0,C=0,k=0;if(!(i|=0))return 0;if(r=0|s[(o=t|=0)>>2],!0&0==(15728640&(o=0|s[o+4>>2])|0)){if((0|i)<=0||(s[(C=e)>>2]=r,s[C+4>>2]=o,1==(0|i)))return 0;r=1;do{S=0|s[4+(w=t+(r<<3)|0)>>2],s[(C=e+(r<<3)|0)>>2]=s[w>>2],s[C+4>>2]=S,r=r+1|0}while((0|r)!=(0|i));return 0}if(!(S=0|ue(w=i<<3)))return-3;if(ye(0|S,0|t,0|w),!(n=0|pe(i,8)))return de(S),-3;r=i;t:for(;;){b=0|Ae(0|(d=0|s[(l=S)>>2]),0|(l=0|s[l+4>>2]),52),x(),y=(b&=15)-1|0,_=(0|r)>0;e:do{if(_){if(v=((0|r)<0)<<31>>31,g=0|ve(0|y,0,52),A=0|x(),y>>>0>15)for(o=0,t=d,i=l;;){if(!(0==(0|t)&0==(0|i))){if(a=0|Ae(0|t,0|i,52),x(),c=(0|(a&=15))<(0|y),a=(0|a)==(0|y),i=0|ge(0|(u=c?0:a?t:0),0|(t=c?0:a?i:0),0|r,0|v),x(),0==(0|(h=0|s[(c=a=n+(i<<3)|0)>>2]))&0==(0|(c=0|s[c+4>>2])))i=u;else for(g=0,m=i,f=c,i=u;;){if((0|g)>(0|r)){C=41;break t}if((0|h)==(0|i)&(-117440513&f|0)==(0|t)){u=0|Ae(0|h,0|f,56),x(),p=1+(u&=7)|0,A=0|Ae(0|h,0|f,45),x();i:do{if(0|F(127&A)){if(h=0|Ae(0|h,0|f,52),x(),!(h&=15)){c=6;break}for(c=1;;){if(!(0==((A=0|ve(7,0,3*(15-c|0)|0))&i|0)&0==((0|x())&t|0))){c=7;break i}if(!(c>>>0<h>>>0)){c=6;break}c=c+1|0}}else c=7}while(0);if((u+2|0)>>>0>c>>>0){C=51;break t}A=0|ve(0|p,0,56),t=0|x()|-117440513&t,s[(c=a)>>2]=0,s[c+4>>2]=0,c=m,i|=A}else c=(m+1|0)%(0|r)|0;if(0==(0|(h=0|s[(f=a=n+(c<<3)|0)>>2]))&0==(0|(f=0|s[f+4>>2])))break;g=g+1|0,m=c}s[(A=a)>>2]=i,s[A+4>>2]=t}if((0|(o=o+1|0))>=(0|r))break e;t=0|s[(i=S+(o<<3)|0)>>2],i=0|s[i+4>>2]}for(o=0,t=d,i=l;;){if(!(0==(0|t)&0==(0|i))){if(c=0|Ae(0|t,0|i,52),x(),(0|(c&=15))>=(0|y)){if((0|c)!=(0|y)&&(t|=g,i=-15728641&i|A,c>>>0>=b>>>0)){a=y;do{m=0|ve(7,0,3*(14-a|0)|0),a=a+1|0,t|=m,i=0|x()|i}while(a>>>0<c>>>0)}}else t=0,i=0;if(c=0|ge(0|t,0|i,0|r,0|v),x(),!(0==(0|(u=0|s[(h=a=n+(c<<3)|0)>>2]))&0==(0|(h=0|s[h+4>>2]))))for(m=0;;){if((0|m)>(0|r)){C=41;break t}if((0|u)==(0|t)&(-117440513&h|0)==(0|i)){p=0|Ae(0|u,0|h,56),x(),f=1+(p&=7)|0,k=0|Ae(0|u,0|h,45),x();i:do{if(0|F(127&k)){if(u=0|Ae(0|u,0|h,52),x(),!(u&=15)){h=6;break}for(h=1;;){if(!(0==((k=0|ve(7,0,3*(15-h|0)|0))&t|0)&0==((0|x())&i|0))){h=7;break i}if(!(h>>>0<u>>>0)){h=6;break}h=h+1|0}}else h=7}while(0);if((p+2|0)>>>0>h>>>0){C=51;break t}k=0|ve(0|f,0,56),i=0|x()|-117440513&i,s[(f=a)>>2]=0,s[f+4>>2]=0,t|=k}else c=(c+1|0)%(0|r)|0;if(0==(0|(u=0|s[(h=a=n+(c<<3)|0)>>2]))&0==(0|(h=0|s[h+4>>2])))break;m=m+1|0}s[(k=a)>>2]=t,s[k+4>>2]=i}if((0|(o=o+1|0))>=(0|r))break e;t=0|s[(i=S+(o<<3)|0)>>2],i=0|s[i+4>>2]}}}while(0);if((r+5|0)>>>0<11){C=99;break}if(!(A=0|pe((0|r)/6|0,8))){C=58;break}e:do{if(_){m=0,f=0;do{if(!(0==(0|(o=0|s[(t=c=n+(m<<3)|0)>>2]))&0==(0|(t=0|s[t+4>>2])))){h=0|Ae(0|o,0|t,56),x(),i=1+(h&=7)|0,u=-117440513&t,k=0|Ae(0|o,0|t,45),x();i:do{if(0|F(127&k)){if(p=0|Ae(0|o,0|t,52),x(),0|(p&=15))for(a=1;;){if(!(0==(o&(k=0|ve(7,0,3*(15-a|0)|0))|0)&0==(u&(0|x())|0)))break i;if(!(a>>>0<p>>>0))break;a=a+1|0}o|=t=0|ve(0|i,0,56),t=0|x()|u,s[(i=c)>>2]=o,s[i+4>>2]=t,i=h+2|0}}while(0);7==(0|i)&&(s[(k=A+(f<<3)|0)>>2]=o,s[k+4>>2]=-117440513&t,f=f+1|0)}m=m+1|0}while((0|m)!=(0|r));if(_){if(g=((0|r)<0)<<31>>31,p=0|ve(0|y,0,52),m=0|x(),y>>>0>15)for(t=0,o=0;;){do{if(!(0==(0|d)&0==(0|l))){for(h=0|Ae(0|d,0|l,52),x(),a=(0|(h&=15))<(0|y),h=(0|h)==(0|y),a=0|ge(0|(c=a?0:h?d:0),0|(h=a?0:h?l:0),0|r,0|g),x(),i=0;;){if((0|i)>(0|r)){C=98;break t}if((-117440513&(u=0|s[4+(k=n+(a<<3)|0)>>2])|0)==(0|h)&&(0|s[k>>2])==(0|c)){C=70;break}if((0|s[(k=n+((a=(a+1|0)%(0|r)|0)<<3)|0)>>2])==(0|c)&&(0|s[k+4>>2])==(0|h))break;i=i+1|0}if(70==(0|C)&&(C=0,!0&100663296==(117440512&u|0)))break;s[(k=e+(o<<3)|0)>>2]=d,s[k+4>>2]=l,o=o+1|0}}while(0);if((0|(t=t+1|0))>=(0|r)){r=f;break e}d=0|s[(l=S+(t<<3)|0)>>2],l=0|s[l+4>>2]}for(t=0,o=0;;){do{if(!(0==(0|d)&0==(0|l))){if(h=0|Ae(0|d,0|l,52),x(),(0|(h&=15))>=(0|y))if((0|h)!=(0|y))if(i=d|p,a=-15728641&l|m,h>>>0<b>>>0)h=a;else{c=y;do{k=0|ve(7,0,3*(14-c|0)|0),c=c+1|0,i|=k,a=0|x()|a}while(c>>>0<h>>>0);h=a}else i=d,h=l;else i=0,h=0;for(c=0|ge(0|i,0|h,0|r,0|g),x(),a=0;;){if((0|a)>(0|r)){C=98;break t}if((-117440513&(u=0|s[4+(k=n+(c<<3)|0)>>2])|0)==(0|h)&&(0|s[k>>2])==(0|i)){C=93;break}if((0|s[(k=n+((c=(c+1|0)%(0|r)|0)<<3)|0)>>2])==(0|i)&&(0|s[k+4>>2])==(0|h))break;a=a+1|0}if(93==(0|C)&&(C=0,!0&100663296==(117440512&u|0)))break;s[(k=e+(o<<3)|0)>>2]=d,s[k+4>>2]=l,o=o+1|0}}while(0);if((0|(t=t+1|0))>=(0|r)){r=f;break e}d=0|s[(l=S+(t<<3)|0)>>2],l=0|s[l+4>>2]}}else o=0,r=f}else o=0,r=0}while(0);if(we(0|n,0,0|w),ye(0|S,0|A,r<<3|0),de(A),!r)break;e=e+(o<<3)|0}return 41==(0|C)?(de(S),de(n),0|(k=-1)):51==(0|C)?(de(S),de(n),0|(k=-2)):58==(0|C)?(de(S),de(n),0|(k=-3)):98==(0|C)?(de(A),de(S),de(n),0|(k=-1)):(99==(0|C)&&ye(0|e,0|S,r<<3|0),de(S),de(n),0|(k=0))},_destroyLinkedPolygon:function(t){var e=0,i=0,n=0,r=0;if(t|=0)for(n=1;;){if(0|(e=0|s[t>>2]))do{if(0|(i=0|s[e>>2]))do{r=i,i=0|s[i+16>>2],de(r)}while(0!=(0|i));r=e,e=0|s[e+8>>2],de(r)}while(0!=(0|e));if(e=t,t=0|s[t+8>>2],n||de(e),!t)break;n=0}},_edgeLengthKm:function(t){return+ +r[20752+((t|=0)<<3)>>3]},_edgeLengthM:function(t){return+ +r[20880+((t|=0)<<3)>>3]},_emscripten_replace_memory:function(t){return n=new Int8Array(t),new Uint8Array(t),s=new Int32Array(t),new Float32Array(t),r=new Float64Array(t),i=t,!0},_exactEdgeLengthKm:function(t,e){var i,n,o=0,a=0,l=0,h=0,p=0,f=0;if(n=I,I=I+176|0,jt(t|=0,e|=0,i=n),(0|(t=0|s[i>>2]))<=1)return I=n,+(l=0);e=t+-1|0,t=0,o=0,a=+r[i+8>>3],l=+r[i+16>>3];do{p=a,h=l,h=(f=+d(.5*((a=+r[i+8+((t=t+1|0)<<4)>>3])-p)))*f+(h=+d(.5*((l=+r[i+8+(t<<4)+8>>3])-h)))*(+u(+p)*+u(+a)*h),o+=2*+A(+ +c(+h),+ +c(+(1-h)))}while((0|t)!=(0|e));return I=n,+(f=6371.007180918475*o)},_exactEdgeLengthM:function(t,e){var i,n,o=0,a=0,l=0,h=0,p=0,f=0;if(n=I,I=I+176|0,jt(t|=0,e|=0,i=n),(0|(t=0|s[i>>2]))<=1)return I=n,+(l=0);e=t+-1|0,t=0,o=0,a=+r[i+8>>3],l=+r[i+16>>3];do{p=a,h=l,h=(f=+d(.5*((a=+r[i+8+((t=t+1|0)<<4)>>3])-p)))*f+(h=+d(.5*((l=+r[i+8+(t<<4)+8>>3])-h)))*(+u(+p)*+u(+a)*h),o+=2*+A(+ +c(+h),+ +c(+(1-h)))}while((0|t)!=(0|e));return I=n,+(f=6371.007180918475*o*1e3)},_exactEdgeLengthRads:function(t,e){var i,n,o=0,a=0,l=0,h=0,p=0,f=0;if(n=I,I=I+176|0,jt(t|=0,e|=0,i=n),(0|(t=0|s[i>>2]))<=1)return I=n,+(l=0);e=t+-1|0,t=0,o=0,a=+r[i+8>>3],l=+r[i+16>>3];do{p=a,h=l,h=(f=+d(.5*((a=+r[i+8+((t=t+1|0)<<4)>>3])-p)))*f+(h=+d(.5*((l=+r[i+8+(t<<4)+8>>3])-h)))*(+u(+a)*+u(+p)*h),o+=2*+A(+ +c(+h),+ +c(+(1-h)))}while((0|t)<(0|e));return I=n,+o},_experimentalH3ToLocalIj:function(t,e,i,n,r){var o,a;return r|=0,a=I,I=I+16|0,(t=0|Yt(t|=0,e|=0,i|=0,n|=0,o=a))||(function(t,e){var i;s[(e|=0)>>2]=(0|s[(t|=0)>>2])-(i=0|s[t+8>>2]),s[e+4>>2]=(0|s[t+4>>2])-i}(o,r),t=0),I=a,0|t},_experimentalLocalIjToH3:function(t,e,i,n){var r,o;return t|=0,e|=0,n|=0,r=I,I=I+16|0,function(t,e){var i,n,r,o=0,a=0,l=0;s[(e|=0)>>2]=a=0|s[(t|=0)>>2],s[(n=e+4|0)>>2]=t=0|s[t+4>>2],s[(r=e+8|0)>>2]=0,o=t-a|0,(0|a)<0?(t=0-a|0,s[n>>2]=o,s[r>>2]=t,s[e>>2]=0,a=0):(o=t,t=0),(0|o)<0&&(s[e>>2]=a=a-o|0,s[r>>2]=t=t-o|0,s[n>>2]=0,o=0),i=a-t|0,l=o-t|0,(0|t)<0?(s[e>>2]=i,s[n>>2]=l,s[r>>2]=0,o=l,l=i,t=0):l=a,!((0|(a=(0|t)<(0|(a=(0|o)<(0|l)?o:l))?t:a))<=0)&&(s[e>>2]=l-a,s[n>>2]=o-a,s[r>>2]=t-a)}(i|=0,o=r),n=0|Zt(t,e,o,n),I=r,0|n},_free:de,_geoToH3:Ft,_getDestinationH3IndexFromUnidirectionalEdge:function(t,e){t|=0;var i,n=0,r=0;return i=I,I=I+16|0,n=i,!0&268435456==(2013265920&(e|=0)|0)?(r=0|Ae(0|t,0|e,56),x(),s[n>>2]=0,n=0|D(t,-2130706433&e|134217728,7&r,n),e=0|x(),w(0|e),I=i,0|n):(n=0,w(0|(e=0)),I=i,0|n)},_getH3IndexesFromUnidirectionalEdge:function(t,e,i){t|=0;var n,r,o,a,l=0;o=I,I=I+16|0,n=o,r=-2130706433&(e|=0)|134217728,s[(l=i|=0)>>2]=(a=!0&268435456==(2013265920&e|0))?t:0,s[l+4>>2]=a?r:0,a?(e=0|Ae(0|t,0|e,56),x(),s[n>>2]=0,t=0|D(t,r,7&e,n),e=0|x()):(t=0,e=0),s[(l=i+8|0)>>2]=t,s[l+4>>2]=e,I=o},_getH3UnidirectionalEdge:function(t,e,i,n){var r,o,a=0,l=0,c=0,h=0,u=0;if(o=I,I=I+16|0,r=o,!(0|Ut(t|=0,e|=0,i|=0,n|=0)))return h=0,w(0|(c=0)),I=o,0|h;for(c=-2130706433&e,a=(a=0==(0|Tt(t,e)))?1:2;s[r>>2]=0,l=a+1|0,!((0|(u=0|D(t,e,a,r)))==(0|i)&(0|x())==(0|n));){if(!(l>>>0<7)){a=0,t=0,h=6;break}a=l}return 6==(0|h)?(w(0|a),I=o,0|t):(u=0|ve(0|a,0,56),h=0|c|x()|268435456,u|=t,w(0|h),I=o,0|u)},_getH3UnidirectionalEdgeBoundary:jt,_getH3UnidirectionalEdgesFromHexagon:function(t,e,i){i|=0;var n,r=0;n=0==(0|Tt(t|=0,e|=0)),e&=-2130706433,s[(r=i)>>2]=n?t:0,s[r+4>>2]=n?285212672|e:0,s[(r=i+8|0)>>2]=t,s[r+4>>2]=301989888|e,s[(r=i+16|0)>>2]=t,s[r+4>>2]=318767104|e,s[(r=i+24|0)>>2]=t,s[r+4>>2]=335544320|e,s[(r=i+32|0)>>2]=t,s[r+4>>2]=352321536|e,s[(i=i+40|0)>>2]=t,s[i+4>>2]=369098752|e},_getOriginH3IndexFromUnidirectionalEdge:function(t,e){var i;return t|=0,w(0|((i=!0&268435456==(2013265920&(e|=0)|0))?-2130706433&e|134217728:0)),0|(i?t:0)},_getPentagonIndexes:$t,_getRes0Indexes:function(t){t|=0;var e=0,i=0,n=0;e=0;do{ve(0|e,0,45),n=134225919|x(),s[(i=t+(e<<3)|0)>>2]=-1,s[i+4>>2]=n,e=e+1|0}while(122!=(0|e))},_h3Distance:function(t,e,i,n){var s,r,o;return i|=0,n|=0,o=I,I=I+32|0,r=o,t=0==(0|Yt(t|=0,e|=0,t,e,s=o+12|0))&&0==(0|Yt(t,e,i,n,r))?0|ut(s,r):-1,I=o,0|t},_h3GetBaseCell:Ct,_h3GetFaces:function t(e,i,n){n|=0;var r,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;r=I,I=I+128|0,d=r+112|0,l=r+96|0,p=r,a=0|Ae(0|(e|=0),0|(i|=0),52),x(),s[d>>2]=h=15&a,c=0|Ae(0|e,0|i,45),x(),c&=127;t:do{if(0|F(c)){if(0|h)for(o=1;;){if(!(0==((u=0|ve(7,0,3*(15-o|0)|0))&e|0)&0==((0|x())&i|0))){a=0;break t}if(!(o>>>0<h>>>0))break;o=o+1|0}if(!(1&a))return u=0|ve(h+1|0,0,52),p=0|x()|-15728641&i,t((u|e)&~(d=0|ve(7,0,3*(14-h|0)|0)),p&~(0|x()),n),void(I=r);a=1}else a=0}while(0);Bt(e,i,l),a?(gt(l,d,p),u=5):(bt(l,d,p),u=6);t:do{if(0|F(c))if(h)for(o=1;;){if(!(0==((c=0|ve(7,0,3*(15-o|0)|0))&e|0)&0==((0|x())&i|0))){o=8;break t}if(!(o>>>0<h>>>0)){o=20;break}o=o+1|0}else o=20;else o=8}while(0);if(we(0|n,-1,0|o),a){a=0;do{for(vt(l=p+(a<<4)|0,0|s[d>>2]),l=0|s[l>>2],o=0;!(-1==(0|(h=0|s[(c=n+(o<<2)|0)>>2]))|(0|h)==(0|l));)o=o+1|0;s[c>>2]=l,a=a+1|0}while((0|a)!=(0|u))}else{a=0;do{for(At(l=p+(a<<4)|0,0|s[d>>2],0,1),l=0|s[l>>2],o=0;!(-1==(0|(h=0|s[(c=n+(o<<2)|0)>>2]))|(0|h)==(0|l));)o=o+1|0;s[c>>2]=l,a=a+1|0}while((0|a)!=(0|u))}I=r},_h3GetResolution:function(t,e){return e=0|Ae(0|(t|=0),0|(e|=0),52),x(),15&e|0},_h3IndexesAreNeighbors:Ut,_h3IsPentagon:Tt,_h3IsResClassIII:function(t,e){return e=0|Ae(0|(t|=0),0|(e|=0),52),x(),1&e|0},_h3IsValid:kt,_h3Line:function(t,e,i,n,r){i|=0,n|=0,r|=0;var o,a=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0,y=0,w=0,x=0,S=0;if(o=I,I=I+48|0,c=o+12|0,x=o,0==(0|Yt(t|=0,e|=0,t,e,a=o+24|0))&&0==(0|Yt(t,e,i,n,c))){if((0|(w=0|ut(a,c)))<0)return I=o,0|w;for(s[a>>2]=0,s[a+4>>2]=0,s[a+8>>2]=0,s[c>>2]=0,s[c+4>>2]=0,s[c+8>>2]=0,Yt(t,e,t,e,a),Yt(t,e,i,n,c),dt(a),dt(c),w?(y=a,i=p=0|s[a>>2],n=f=0|s[(_=a+4|0)>>2],a=m=0|s[(b=a+8|0)>>2],A=+((0|s[c>>2])-p|0)/(g=+(0|w)),v=+((0|s[c+4>>2])-f|0)/g,g=+((0|s[c+8>>2])-m|0)/g):(_=n=a+4|0,b=m=a+8|0,y=a,i=0|s[a>>2],n=0|s[n>>2],a=0|s[m>>2],A=0,v=0,g=0),s[x>>2]=i,s[(m=x+4|0)>>2]=n,s[(f=x+8|0)>>2]=a,p=0;;){S=A*(u=+(0|p))+ +(0|i),h=v*u+ +(0|s[_>>2]),u=g*u+ +(0|s[b>>2]),n=~~+be(+S),c=~~+be(+h),i=~~+be(+u),S=+l(+(+(0|n)-S)),h=+l(+(+(0|c)-h)),u=+l(+(+(0|i)-u));do{if(!(S>h&S>u)){if(d=0-n|0,h>u){a=d-i|0;break}a=c,i=d-c|0;break}n=0-(c+i)|0,a=c}while(0);if(s[x>>2]=n,s[m>>2]=a,s[f>>2]=i,pt(x),Zt(t,e,x,r+(p<<3)|0),(0|p)==(0|w))break;p=p+1|0,i=0|s[y>>2]}return I=o,0}return I=o,-1},_h3LineSize:function(t,e,i,n){var s,r,o;return i|=0,n|=0,o=I,I=I+32|0,r=o,t=0==(0|Yt(t|=0,e|=0,t,e,s=o+12|0))&&0==(0|Yt(t,e,i,n,r))?0|ut(s,r):-1,I=o,(t>>>31^1)+t|0},_h3SetToLinkedGeo:function(t,e,i){i|=0;var n,r,o,a=0;if(o=I,I=I+32|0,n=o,function(t,e,i){t|=0,i|=0;var n,r,o=0,a=0,l=0,c=0,h=0;if(r=I,I=I+176|0,n=r,(0|(e|=0))<1)return ne(i,0,0),void(I=r);c=0|Ae(0|s[(c=t)>>2],0|s[c+4>>2],52),x(),ne(i,(0|e)>6?e:6,15&c),c=0;do{if(Vt(0|s[(o=t+(c<<3)|0)>>2],0|s[o+4>>2],n),(0|(o=0|s[n>>2]))>0){h=0;do{l=n+8+(h<<4)|0,(a=0|le(i,o=n+8+(((0|(h=h+1|0))%(0|o)|0)<<4)|0,l))?oe(i,a):ae(i,l,o),o=0|s[n>>2]}while((0|h)<(0|o))}c=c+1|0}while((0|c)!=(0|e));I=r}(t|=0,e|=0,r=o+16|0),s[i>>2]=0,s[i+4>>2]=0,s[i+8>>2]=0,!(t=0|re(r)))return Wt(i),se(r),void(I=o);do{e=0|Ht(i);do{Gt(e,t),s[n>>2]=s[(a=t+16|0)>>2],s[n+4>>2]=s[a+4>>2],s[n+8>>2]=s[a+8>>2],s[n+12>>2]=s[a+12>>2],oe(r,t),t=0|ce(r,n)}while(0!=(0|t));t=0|re(r)}while(0!=(0|t));Wt(i),se(r),I=o},_h3ToCenterChild:function(t,e,i){i|=0;var n=0,s=0;if(n=0|Ae(0|(t|=0),0|(e|=0),52),x(),(0|i)<16&(0|(n&=15))<=(0|i)){if((0|n)!=(0|i)&&(t|=s=0|ve(0|i,0,52),e=0|x()|-15728641&e,(0|n)<(0|i)))do{s=0|ve(7,0,3*(14-n|0)|0),n=n+1|0,t&=~s,e&=~(0|x())}while((0|n)<(0|i))}else e=0,t=0;return w(0|e),0|t},_h3ToChildren:Mt,_h3ToGeo:zt,_h3ToGeoBoundary:Vt,_h3ToParent:Et,_h3UnidirectionalEdgeIsValid:function(t,e){var i=0;if(!(!0&268435456==(2013265920&(e|=0)|0)))return 0;switch(i=0|Ae(0|(t|=0),0|e,56),x(),7&i){case 0:case 7:return 0}return!0&16777216==(117440512&e|0)&0!=(0|Tt(t,i=-2130706433&e|134217728))?0|(i=0):0|(i=0|kt(t,i))},_hexAreaKm2:function(t){return+ +r[20496+((t|=0)<<3)>>3]},_hexAreaM2:function(t){return+ +r[20624+((t|=0)<<3)>>3]},_hexRing:function(t,e,i,n){t|=0,e|=0,n|=0;var r,o=0,a=0,l=0,c=0,h=0,u=0,d=0;if(r=I,I=I+16|0,d=r,!(i|=0))return s[(d=n)>>2]=t,s[d+4>>2]=e,I=r,0;s[d>>2]=0;t:do{if(0|Tt(t,e))t=1;else{if(a=(0|i)>0){o=0,u=t;do{if(0==(0|(u=0|D(u,e,4,d)))&0==(0|(e=0|x()))){t=2;break t}if(o=o+1|0,0|Tt(u,e)){t=1;break t}}while((0|o)<(0|i));if(s[(h=n)>>2]=u,s[h+4>>2]=e,h=i+-1|0,a){a=0,l=1,o=u,t=e;do{if(0==(0|(o=0|D(o,t,2,d)))&0==(0|(t=0|x()))){t=2;break t}if(s[(c=n+(l<<3)|0)>>2]=o,s[c+4>>2]=t,l=l+1|0,0|Tt(o,t)){t=1;break t}a=a+1|0}while((0|a)<(0|i));c=0,a=l;do{if(0==(0|(o=0|D(o,t,3,d)))&0==(0|(t=0|x()))){t=2;break t}if(s[(l=n+(a<<3)|0)>>2]=o,s[l+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}c=c+1|0}while((0|c)<(0|i));l=0;do{if(0==(0|(o=0|D(o,t,1,d)))&0==(0|(t=0|x()))){t=2;break t}if(s[(c=n+(a<<3)|0)>>2]=o,s[c+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}l=l+1|0}while((0|l)<(0|i));l=0;do{if(0==(0|(o=0|D(o,t,5,d)))&0==(0|(t=0|x()))){t=2;break t}if(s[(c=n+(a<<3)|0)>>2]=o,s[c+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}l=l+1|0}while((0|l)<(0|i));l=0;do{if(0==(0|(o=0|D(o,t,4,d)))&0==(0|(t=0|x()))){t=2;break t}if(s[(c=n+(a<<3)|0)>>2]=o,s[c+4>>2]=t,a=a+1|0,0|Tt(o,t)){t=1;break t}l=l+1|0}while((0|l)<(0|i));for(l=0;;){if(0==(0|(o=0|D(o,t,6,d)))&0==(0|(t=0|x()))){t=2;break t}if((0|l)!=(0|h)){if(s[(c=n+(a<<3)|0)>>2]=o,s[c+4>>2]=t,0|Tt(o,t)){t=1;break t}a=a+1|0}if((0|(l=l+1|0))>=(0|i)){l=u,a=e;break}}}else l=u,o=u,a=e,t=e}else s[(l=n)>>2]=t,s[l+4>>2]=e,l=t,o=t,a=e,t=e;t=1&((0|l)!=(0|o)|(0|a)!=(0|t))}}while(0);return I=r,0|t},_i64Subtract:fe,_kRing:P,_kRingDistances:function(t,e,i,n,s){var r=0;if(0|O(t|=0,e|=0,i|=0,n|=0,s|=0)){if(we(0|n,0,(r=1+(0|_(3*i|0,i+1|0))|0)<<3|0),0|s)return we(0|s,0,r<<2|0),void R(t,e,i,n,s,r,0);(s=0|pe(r,4))&&(R(t,e,i,n,s,r,0),de(s))}},_llvm_minnum_f64:_e,_llvm_round_f64:be,_malloc:ue,_maxFaceCount:function(t,e){var i=0,n=0;if(n=0|Ae(0|(t|=0),0|(e|=0),45),x(),!(0|F(127&n)))return 2;if(n=0|Ae(0|t,0|e,52),x(),!(n&=15))return 5;for(i=1;;){if(!(0==((0|ve(7,0,3*(15-i|0)|0))&t|0)&0==((0|x())&e|0))){i=2,t=6;break}if(!(i>>>0<n>>>0)){i=5,t=6;break}i=i+1|0}return 6==(0|t)?0|i:0},_maxH3ToChildrenSize:function(t,e,i){return i|=0,t=0|Ae(0|(t|=0),0|(e|=0),52),x(),(0|i)<16&(0|(t&=15))<=(0|i)?0|(i=0|Kt(7,i-t|0)):0|(i=0)},_maxKringSize:function(t){return 1+(0|_(3*(t|=0)|0,t+1|0))|0},_maxPolyfillSize:function(t,e){e|=0;var i,n=0,r=0,o=0,a=0,l=0;if(i=I,I=I+48|0,o=i+8|0,a=0|s[4+(l=t|=0)>>2],s[(n=r=i)>>2]=s[l>>2],s[n+4>>2]=a,Qt(r,o),o=0|G(o,e),e=0|s[r>>2],(0|(r=0|s[t+8>>2]))<=0)return I=i,0|(l=(a=(0|o)<(0|(l=e)))?l:o)+12;n=0|s[t+12>>2],t=0;do{e=(0|s[n+(t<<3)>>2])+e|0,t=t+1|0}while((0|t)<(0|r));return I=i,0|(l=(l=(0|o)<(0|e))?e:o)+12},_maxUncompactSize:function(t,e,i){t|=0;var n=0,r=0,o=0,a=0;if((0|(e|=0))<=0)return 0;if((0|(i|=0))>=16){for(n=0;;){if(!(0==(0|s[(a=t+(n<<3)|0)>>2])&0==(0|s[a+4>>2]))){n=-1,r=13;break}if((0|(n=n+1|0))>=(0|e)){n=0,r=13;break}}if(13==(0|r))return 0|n}n=0,a=0;t:for(;;){o=0|s[(r=t+(a<<3)|0)>>2],r=0|s[r+4>>2];do{if(!(0==(0|o)&0==(0|r))){if(r=0|Ae(0|o,0|r,52),x(),(0|(r&=15))>(0|i)){n=-1,r=13;break t}if((0|r)==(0|i)){n=n+1|0;break}n=(0|Kt(7,i-r|0))+n|0;break}}while(0);if((0|(a=a+1|0))>=(0|e)){r=13;break}}return 13==(0|r)?0|n:0},_memcpy:ye,_memset:we,_numHexagons:function(t){var e;return t=0|s[(e=21008+((t|=0)<<3)|0)>>2],w(0|s[e+4>>2]),0|t},_pentagonIndexCount:function(){return 12},_pointDistKm:xt,_pointDistM:function(t,e){var i,n,s,o=0;return o=(s=+d(.5*((n=+r[(e|=0)>>3])-(i=+r[(t|=0)>>3]))))*s+(o=+d(.5*(+r[e+8>>3]-+r[t+8>>3])))*(+u(+n)*+u(+i)*o),2*+A(+ +c(+o),+ +c(+(1-o)))*6371.007180918475*1e3},_pointDistRads:function(t,e){var i,n,s,o=0;return o=(s=+d(.5*((n=+r[(e|=0)>>3])-(i=+r[(t|=0)>>3]))))*s+(o=+d(.5*(+r[e+8>>3]-+r[t+8>>3])))*(+u(+n)*+u(+i)*o),2*+A(+ +c(+o),+ +c(+(1-o)))},_polyfill:function(t,e,i){var n,o=0,a=0,c=0,h=0,u=0;if(n=I,I=I+48|0,o=n+8|0,a=n,0|function(t,e,i){e|=0,i|=0;var n,o,a,c,h,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0,y=0,w=0,C=0,k=0,E=0,M=0,T=0,P=0,D=0,F=0,N=0,B=0,z=0,V=0,$=0;if(h=I,I=I+112|0,o=h+80|0,g=h+72|0,a=h,c=h+56|0,($=0|ue(32+(s[(A=8+(t|=0)|0)>>2]<<5)|0))||S(22848,22448,800,22456),function(t,e){e|=0;var i=0,n=0,o=0,a=0,c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0,A=0,v=0,_=0,b=0,y=0,w=0,x=0,S=0,C=0,k=0;if(A=0|s[(t|=0)>>2]){if(r[(v=e+8|0)>>3]=17976931348623157e292,r[(_=e+24|0)>>3]=17976931348623157e292,r[e>>3]=-17976931348623157e292,r[(b=e+16|0)>>3]=-17976931348623157e292,(0|A)>0){for(o=0|s[t+4>>2],m=17976931348623157e292,g=-17976931348623157e292,n=0,i=-1,u=17976931348623157e292,d=17976931348623157e292,f=-17976931348623157e292,c=-17976931348623157e292,y=0;p=+r[o+(y<<4)+8>>3],h=+r[o+(((0|(C=i+2|0))==(0|A)?0:C)<<4)+8>>3],(a=+r[o+(y<<4)>>3])<u&&(r[v>>3]=a,u=a),p<d&&(r[_>>3]=p,d=p),a>f?r[e>>3]=a:a=f,p>c&&(r[b>>3]=p,c=p),m=p>0&p<m?p:m,g=p<0&p>g?p:g,n|=+l(+(p-h))>3.141592653589793,(0|(i=y+1|0))!=(0|A);)C=y,f=a,y=i,i=C;n&&(r[b>>3]=g,r[_>>3]=m)}}else s[e>>2]=0,s[e+4>>2]=0,s[e+8>>2]=0,s[e+12>>2]=0,s[e+16>>2]=0,s[e+20>>2]=0,s[e+24>>2]=0,s[e+28>>2]=0;if(!((0|(i=0|s[(C=t+8|0)>>2]))<=0)){S=t+12|0,x=0;do{if(n=x,_=e+((x=x+1|0)<<5)|0,b=0|s[(o=0|s[S>>2])+(n<<3)>>2]){if(r[(y=e+(x<<5)+8|0)>>3]=17976931348623157e292,r[(t=e+(x<<5)+24|0)>>3]=17976931348623157e292,r[_>>3]=-17976931348623157e292,r[(w=e+(x<<5)+16|0)>>3]=-17976931348623157e292,(0|b)>0){for(A=0|s[o+(n<<3)+4>>2],m=17976931348623157e292,g=-17976931348623157e292,o=0,n=-1,v=0,u=17976931348623157e292,d=17976931348623157e292,p=-17976931348623157e292,c=-17976931348623157e292;f=+r[A+(v<<4)+8>>3],h=+r[A+(((0|(n=n+2|0))==(0|b)?0:n)<<4)+8>>3],(a=+r[A+(v<<4)>>3])<u&&(r[y>>3]=a,u=a),f<d&&(r[t>>3]=f,d=f),a>p?r[_>>3]=a:a=p,f>c&&(r[w>>3]=f,c=f),m=f>0&f<m?f:m,g=f<0&f>g?f:g,o|=+l(+(f-h))>3.141592653589793,(0|(n=v+1|0))!=(0|b);)k=v,v=n,p=a,n=k;o&&(r[w>>3]=g,r[t>>3]=m)}}else s[_>>2]=0,s[_+4>>2]=0,s[_+8>>2]=0,s[_+12>>2]=0,s[_+16>>2]=0,s[_+20>>2]=0,s[_+24>>2]=0,s[_+28>>2]=0,i=0|s[C>>2]}while((0|x)<(0|i))}}(t,$),u=0|s[(p=t)+4>>2],s[(m=g)>>2]=s[p>>2],s[m+4>>2]=u,Qt(g,o),m=0|G(o,e),u=0|s[g>>2],(0|(p=0|s[A>>2]))>0){f=0|s[t+12>>2],d=0;do{u=(0|s[f+(d<<3)>>2])+u|0,d=d+1|0}while((0|d)!=(0|p))}if(d=0|pe(n=(m=(0|m)<(0|u)?u:m)+12|0,8),v=0|pe(n,8),s[o>>2]=0,V=0|s[(z=t)+4>>2],s[(u=g)>>2]=s[z>>2],s[u+4>>2]=V,0|(u=0|L(g,n,e,o,d,v)))return de(d),de(v),de($),I=h,0|u;t:do{if((0|s[A>>2])>0){for(p=t+12|0,u=0;f=0|L((0|s[p>>2])+(u<<3)|0,n,e,o,d,v),u=u+1|0,!(0|f);)if((0|u)>=(0|s[A>>2]))break t;return de(d),de(v),de($),I=h,0|f}}while(0);(0|m)>-12&&we(0|v,0,((0|n)>1?n:1)<<3|0);t:do{if((0|s[o>>2])>0){V=((0|n)<0)<<31>>31,P=d,D=v,F=d,N=d,B=v,z=d,u=d,k=d,E=v,M=v,T=v,d=v;e:for(;;){for(C=0|s[o>>2],y=0,w=0,p=0;;){m=(f=a)+56|0;do{s[f>>2]=0,f=f+4|0}while((0|f)<(0|m));if(0|O(g=0|s[(e=P+(y<<3)|0)>>2],e=0|s[e+4>>2],1,a,0)){m=(f=a)+56|0;do{s[f>>2]=0,f=f+4|0}while((0|f)<(0|m));0|(f=0|pe(7,4))&&(R(g,e,1,a,f,7,0),de(f))}b=0;do{v=0|s[(_=a+(b<<3)|0)>>2],_=0|s[_+4>>2];i:do{if(!(0==(0|v)&0==(0|_))){if(g=0|ge(0|v,0|_,0|n,0|V),x(),!(0==(0|(e=0|s[(m=f=i+(g<<3)|0)>>2]))&0==(0|(m=0|s[m+4>>2]))))for(A=0;;){if((0|A)>(0|n))break e;if((0|e)==(0|v)&(0|m)==(0|_))break i;if(0==(0|(e=0|s[(m=f=i+((g=(g+1|0)%(0|n)|0)<<3)|0)>>2]))&0==(0|(m=0|s[m+4>>2])))break;A=A+1|0}0==(0|v)&0==(0|_)||(zt(v,_,c),0|Jt(t,$,c)&&(s[(A=f)>>2]=v,s[A+4>>2]=_,s[(A=D+(p<<3)|0)>>2]=v,s[A+4>>2]=_,p=p+1|0))}}while(0);b=b+1|0}while(b>>>0<7);if((0|(w=w+1|0))>=(0|C))break;y=y+1|0}if((0|C)>0&&we(0|F,0,C<<3|0),s[o>>2]=p,!((0|p)>0))break t;v=d,_=T,b=z,y=M,w=E,C=D,d=k,T=u,M=N,E=F,k=v,u=_,z=B,B=b,N=y,F=w,D=P,P=C}return de(N),de(B),de($),I=h,-1}u=v}while(0);return de($),de(d),de(u),I=h,0}(t|=0,e|=0,i|=0)){if(c=0|s[(u=t)+4>>2],s[(h=a)>>2]=s[u>>2],s[h+4>>2]=c,Qt(a,o),h=0|G(o,e),e=0|s[a>>2],(0|(c=0|s[t+8>>2]))>0){a=0|s[t+12>>2],o=0;do{e=(0|s[a+(o<<3)>>2])+e|0,o=o+1|0}while((0|o)!=(0|c))}(0|(e=(0|h)<(0|e)?e:h))<=-12||we(0|i,0,8+(((0|(u=e+11|0))>0?u:0)<<3)|0),I=n}else I=n},_res0IndexCount:function(){return 122},_round:xe,_sbrk:Se,_sizeOfCoordIJ:function(){return 8},_sizeOfGeoBoundary:function(){return 168},_sizeOfGeoCoord:function(){return 16},_sizeOfGeoPolygon:function(){return 16},_sizeOfGeofence:function(){return 8},_sizeOfH3Index:function(){return 8},_sizeOfLinkedGeoPolygon:function(){return 12},_uncompact:function(t,e,i,n,r){t|=0,i|=0,n|=0;var o=0,a=0,l=0,c=0,h=0,u=0;if((0|(e|=0))<=0)return 0;if((0|(r|=0))>=16){for(o=0;;){if(!(0==(0|s[(u=t+(o<<3)|0)>>2])&0==(0|s[u+4>>2]))){o=14;break}if((0|(o=o+1|0))>=(0|e)){a=0,o=16;break}}if(14==(0|o))return 0|((0|n)>0?-2:-1);if(16==(0|o))return 0|a}o=0,u=0;t:for(;;){a=0|s[(l=h=t+(u<<3)|0)>>2],l=0|s[l+4>>2];do{if(!(0==(0|a)&0==(0|l))){if((0|o)>=(0|n)){a=-1,o=16;break t}if(c=0|Ae(0|a,0|l,52),x(),(0|(c&=15))>(0|r)){a=-2,o=16;break t}if((0|c)==(0|r)){s[(h=i+(o<<3)|0)>>2]=a,s[h+4>>2]=l,o=o+1|0;break}if((0|(a=(0|Kt(7,r-c|0))+o|0))>(0|n)){a=-1,o=16;break t}Mt(0|s[h>>2],0|s[h+4>>2],r,i+(o<<3)|0),o=a}}while(0);if((0|(u=u+1|0))>=(0|e)){a=0,o=16;break}}return 16==(0|o)?0|a:0},establishStackSpace:function(t,e){I=t|=0},stackAlloc:function(t){var e;return e=I,I=15+(I=I+(t|=0)|0)&-16,0|e},stackRestore:function(t){I=t|=0},stackSave:function(){return 0|I}}}({Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},{a:at,b:function(t){c=t},c:h,d:function(t,e,i,n){at(\"Assertion failed: \"+w(t)+\", at: \"+[e?w(e):\"unknown filename\",i,n?w(n):\"unknown function\"])},e:function(t){return i.___errno_location&&(v[i.___errno_location()>>2]=t),t},f:G,g:function(t,e,i){g.set(g.subarray(e,e+i),t)},h:function(t){var e=G(),i=2130706432;if(t>i)return!1;for(var n=Math.max(e,16777216);n<t;)n=n<=536870912?x(2*n,16777216):Math.min(x((3*n+2147483648)/4,16777216),i);return!!W(n)},i:function(t){at(\"OOM\")},j:function(t){return t},k:j,l:W,m:H,n:function(){var t=H();return i.extraStackTrace&&(t+=\"\\n\"+i.extraStackTrace()),j(t)},o:24032,p:24016},f),Q=(i.___uremdi3=X.___uremdi3,i._bitshift64Lshr=X._bitshift64Lshr,i._bitshift64Shl=X._bitshift64Shl,i._calloc=X._calloc,i._cellAreaKm2=X._cellAreaKm2,i._cellAreaM2=X._cellAreaM2,i._cellAreaRads2=X._cellAreaRads2,i._compact=X._compact,i._destroyLinkedPolygon=X._destroyLinkedPolygon,i._edgeLengthKm=X._edgeLengthKm,i._edgeLengthM=X._edgeLengthM,i._emscripten_replace_memory=X._emscripten_replace_memory),J=(i._exactEdgeLengthKm=X._exactEdgeLengthKm,i._exactEdgeLengthM=X._exactEdgeLengthM,i._exactEdgeLengthRads=X._exactEdgeLengthRads,i._experimentalH3ToLocalIj=X._experimentalH3ToLocalIj,i._experimentalLocalIjToH3=X._experimentalLocalIjToH3,i._free=X._free,i._geoToH3=X._geoToH3,i._getDestinationH3IndexFromUnidirectionalEdge=X._getDestinationH3IndexFromUnidirectionalEdge,i._getH3IndexesFromUnidirectionalEdge=X._getH3IndexesFromUnidirectionalEdge,i._getH3UnidirectionalEdge=X._getH3UnidirectionalEdge,i._getH3UnidirectionalEdgeBoundary=X._getH3UnidirectionalEdgeBoundary,i._getH3UnidirectionalEdgesFromHexagon=X._getH3UnidirectionalEdgesFromHexagon,i._getOriginH3IndexFromUnidirectionalEdge=X._getOriginH3IndexFromUnidirectionalEdge,i._getPentagonIndexes=X._getPentagonIndexes,i._getRes0Indexes=X._getRes0Indexes,i._h3Distance=X._h3Distance,i._h3GetBaseCell=X._h3GetBaseCell,i._h3GetFaces=X._h3GetFaces,i._h3GetResolution=X._h3GetResolution,i._h3IndexesAreNeighbors=X._h3IndexesAreNeighbors,i._h3IsPentagon=X._h3IsPentagon,i._h3IsResClassIII=X._h3IsResClassIII,i._h3IsValid=X._h3IsValid,i._h3Line=X._h3Line,i._h3LineSize=X._h3LineSize,i._h3SetToLinkedGeo=X._h3SetToLinkedGeo,i._h3ToCenterChild=X._h3ToCenterChild,i._h3ToChildren=X._h3ToChildren,i._h3ToGeo=X._h3ToGeo,i._h3ToGeoBoundary=X._h3ToGeoBoundary,i._h3ToParent=X._h3ToParent,i._h3UnidirectionalEdgeIsValid=X._h3UnidirectionalEdgeIsValid,i._hexAreaKm2=X._hexAreaKm2,i._hexAreaM2=X._hexAreaM2,i._hexRing=X._hexRing,i._i64Subtract=X._i64Subtract,i._kRing=X._kRing,i._kRingDistances=X._kRingDistances,i._llvm_minnum_f64=X._llvm_minnum_f64,i._llvm_round_f64=X._llvm_round_f64,i._malloc=X._malloc,i._maxFaceCount=X._maxFaceCount,i._maxH3ToChildrenSize=X._maxH3ToChildrenSize,i._maxKringSize=X._maxKringSize,i._maxPolyfillSize=X._maxPolyfillSize,i._maxUncompactSize=X._maxUncompactSize,i._memcpy=X._memcpy,i._memset=X._memset,i._numHexagons=X._numHexagons,i._pentagonIndexCount=X._pentagonIndexCount,i._pointDistKm=X._pointDistKm,i._pointDistM=X._pointDistM,i._pointDistRads=X._pointDistRads,i._polyfill=X._polyfill,i._res0IndexCount=X._res0IndexCount,i._round=X._round,i._sbrk=X._sbrk,i._sizeOfCoordIJ=X._sizeOfCoordIJ,i._sizeOfGeoBoundary=X._sizeOfGeoBoundary,i._sizeOfGeoCoord=X._sizeOfGeoCoord,i._sizeOfGeoPolygon=X._sizeOfGeoPolygon,i._sizeOfGeofence=X._sizeOfGeofence,i._sizeOfH3Index=X._sizeOfH3Index,i._sizeOfLinkedGeoPolygon=X._sizeOfLinkedGeoPolygon,i._uncompact=X._uncompact,i.establishStackSpace=X.establishStackSpace,i.stackAlloc=X.stackAlloc),tt=i.stackRestore=X.stackRestore,et=i.stackSave=X.stackSave;if(i.asm=X,i.cwrap=function(t,e,i,n){var s=(i=i||[]).every(function(t){return\"number\"===t});return\"string\"!==e&&s&&!n?d(t):function(){return p(t,e,i,arguments)}},i.setValue=function(t,e,i,n){switch(\"*\"===(i=i||\"i8\").charAt(i.length-1)&&(i=\"i32\"),i){case\"i1\":case\"i8\":m[t>>0]=e;break;case\"i16\":A[t>>1]=e;break;case\"i32\":v[t>>2]=e;break;case\"i64\":z=[e>>>0,(B=e,+P(B)>=1?B>0?(0|D(+R(B/4294967296),4294967295))>>>0:~~+O((B-+(~~B>>>0))/4294967296)>>>0:0)],v[t>>2]=z[0],v[t+4>>2]=z[1];break;case\"float\":_[t>>2]=e;break;case\"double\":b[t>>3]=e;break;default:at(\"invalid type for setValue: \"+i)}},i.getValue=function(t,e,i){switch(\"*\"===(e=e||\"i8\").charAt(e.length-1)&&(e=\"i32\"),e){case\"i1\":case\"i8\":return m[t>>0];case\"i16\":return A[t>>1];case\"i32\":case\"i64\":return v[t>>2];case\"float\":return _[t>>2];case\"double\":return b[t>>3];default:at(\"invalid type for getValue: \"+e)}return null},i.getTempRet0=h,V){U(V)||(Z=V,V=i.locateFile?i.locateFile(Z,o):o+Z),L++,i.monitorRunDependencies&&i.monitorRunDependencies(L);var it=function(t){t.byteLength&&(t=new Uint8Array(t)),g.set(t,8),i.memoryInitializerRequest&&delete i.memoryInitializerRequest.response,function(t){if(L--,i.monitorRunDependencies&&i.monitorRunDependencies(L),0==L&&(null!==F&&(clearInterval(F),F=null),N)){var e=N;N=null,e()}}()},nt=function(){s(V,it,function(){throw\"could not load memory initializer \"+V})},st=Y(V);if(st)it(st.buffer);else if(i.memoryInitializerRequest){var rt=function(){var t=i.memoryInitializerRequest,e=t.response;if(200!==t.status&&0!==t.status){var n=Y(i.memoryInitializerRequestURL);if(!n)return console.warn(\"a problem seems to have happened with Module.memoryInitializerRequest, status: \"+t.status+\", retrying \"+V),void nt();e=n.buffer}it(e)};i.memoryInitializerRequest.response?setTimeout(rt,0):i.memoryInitializerRequest.addEventListener(\"load\",rt)}else nt()}function ot(t){function e(){K||(K=!0,!u&&(k(M),k(T),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for(\"function\"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)t=i.postRun.shift(),I.unshift(t);var t;k(I)}()))}t=t||r,L>0||(function(){if(i.preRun)for(\"function\"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)t=i.preRun.shift(),E.unshift(t);var t;k(E)}(),L>0)||(i.setStatus?(i.setStatus(\"Running...\"),setTimeout(function(){setTimeout(function(){i.setStatus(\"\")},1),e()},1)):e())}function at(t){throw i.onAbort&&i.onAbort(t),a(t+=\"\"),l(t),u=!0,\"abort(\"+t+\"). Build with -s ASSERTIONS=1 for more info.\"}if(N=function t(){K||ot(),K||(N=t)},i.run=ot,i.abort=at,i.preInit)for(\"function\"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return ot(),t}(\"object\"==typeof KU?KU:{}),XU=\"number\",QU={};[[\"sizeOfH3Index\",XU],[\"sizeOfGeoCoord\",XU],[\"sizeOfGeoBoundary\",XU],[\"sizeOfGeoPolygon\",XU],[\"sizeOfGeofence\",XU],[\"sizeOfLinkedGeoPolygon\",XU],[\"sizeOfCoordIJ\",XU],[\"h3IsValid\",XU,[XU,XU]],[\"geoToH3\",XU,[XU,XU,XU]],[\"h3ToGeo\",null,[XU,XU,XU]],[\"h3ToGeoBoundary\",null,[XU,XU,XU]],[\"maxKringSize\",XU,[XU]],[\"kRing\",null,[XU,XU,XU,XU]],[\"kRingDistances\",null,[XU,XU,XU,XU,XU]],[\"hexRing\",null,[XU,XU,XU,XU]],[\"maxPolyfillSize\",XU,[XU,XU]],[\"polyfill\",null,[XU,XU,XU]],[\"h3SetToLinkedGeo\",null,[XU,XU,XU]],[\"destroyLinkedPolygon\",null,[XU]],[\"compact\",XU,[XU,XU,XU]],[\"uncompact\",XU,[XU,XU,XU,XU,XU]],[\"maxUncompactSize\",XU,[XU,XU,XU]],[\"h3IsPentagon\",XU,[XU,XU]],[\"h3IsResClassIII\",XU,[XU,XU]],[\"h3GetBaseCell\",XU,[XU,XU]],[\"h3GetResolution\",XU,[XU,XU]],[\"maxFaceCount\",XU,[XU,XU]],[\"h3GetFaces\",null,[XU,XU,XU]],[\"h3ToParent\",XU,[XU,XU,XU]],[\"h3ToChildren\",null,[XU,XU,XU,XU]],[\"h3ToCenterChild\",XU,[XU,XU,XU]],[\"maxH3ToChildrenSize\",XU,[XU,XU,XU]],[\"h3IndexesAreNeighbors\",XU,[XU,XU,XU,XU]],[\"getH3UnidirectionalEdge\",XU,[XU,XU,XU,XU]],[\"getOriginH3IndexFromUnidirectionalEdge\",XU,[XU,XU]],[\"getDestinationH3IndexFromUnidirectionalEdge\",XU,[XU,XU]],[\"h3UnidirectionalEdgeIsValid\",XU,[XU,XU]],[\"getH3IndexesFromUnidirectionalEdge\",null,[XU,XU,XU]],[\"getH3UnidirectionalEdgesFromHexagon\",null,[XU,XU,XU]],[\"getH3UnidirectionalEdgeBoundary\",null,[XU,XU,XU]],[\"h3Distance\",XU,[XU,XU,XU,XU]],[\"h3Line\",XU,[XU,XU,XU,XU,XU]],[\"h3LineSize\",XU,[XU,XU,XU,XU]],[\"experimentalH3ToLocalIj\",XU,[XU,XU,XU,XU,XU]],[\"experimentalLocalIjToH3\",XU,[XU,XU,XU,XU]],[\"hexAreaM2\",XU,[XU]],[\"hexAreaKm2\",XU,[XU]],[\"edgeLengthM\",XU,[XU]],[\"edgeLengthKm\",XU,[XU]],[\"pointDistM\",XU,[XU,XU]],[\"pointDistKm\",XU,[XU,XU]],[\"pointDistRads\",XU,[XU,XU]],[\"cellAreaM2\",XU,[XU,XU]],[\"cellAreaKm2\",XU,[XU,XU]],[\"cellAreaRads2\",XU,[XU,XU]],[\"exactEdgeLengthM\",XU,[XU,XU]],[\"exactEdgeLengthKm\",XU,[XU,XU]],[\"exactEdgeLengthRads\",XU,[XU,XU]],[\"numHexagons\",XU,[XU]],[\"getRes0Indexes\",null,[XU]],[\"res0IndexCount\",XU],[\"getPentagonIndexes\",null,[XU,XU]],[\"pentagonIndexCount\",XU]].forEach(function(t){QU[t[0]]=KU.cwrap.apply(KU,t)});var JU=QU.sizeOfH3Index(),tj=QU.sizeOfGeoCoord(),ej=QU.sizeOfGeoBoundary(),ij=QU.sizeOfGeoPolygon(),nj=QU.sizeOfGeofence();QU.sizeOfLinkedGeoPolygon(),QU.sizeOfCoordIJ();var sj=/[^0-9a-fA-F]/;function rj(t){if(Array.isArray(t)&&2===t.length&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(\"string\"!=typeof t||sj.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),16);return[parseInt(t.substring(t.length-8),16),e]}function oj(t){if(t>=0)return t.toString(16);var e=lj(8,(t&=2147483647).toString(16));return(parseInt(e[0],16)+8).toString(16)+e.substring(1)}function aj(t,e){return oj(e)+lj(8,oj(t))}function lj(t,e){for(var i=t-e.length,n=\"\",s=0;s<i;s++)n+=\"0\";return n+e}function cj(t,e,i){for(var n=t.length,s=KU._calloc(n,tj),r=i?1:0,o=i?0:1,a=0;a<2*n;a+=2)KU.HEAPF64.set([t[a/2][r],t[a/2][o]].map(Mj),s/8+a);return KU.HEAPU32.set([n,s],e/4),e}function hj(t){var e=function(t){return[t,KU.getTempRet0()]}(t),i=e[1];return i?aj(e[0],i):null}function uj(t,e){void 0===e&&(e=0);var i=KU.getValue(t+4*e*2,\"i32\"),n=KU.getValue(t+4*(2*e+1),\"i32\");return n?aj(i,n):null}function dj(t,e,i){KU.HEAPU32.set(rj(t),e/4+2*i)}function pj(t,e){for(var i=[],n=0;n<e;n++){var s=uj(t,n);null!==s&&i.push(s)}return i}function fj(t){return function(t){return 180*t/Math.PI}(KU.getValue(t,\"double\"))}function mj(t){return[fj(t),fj(t+8)]}function gj(t){return[fj(t+8),fj(t)]}function Aj(t,e,i){for(var n=KU.getValue(t,\"i32\"),s=t+8,r=[],o=e?gj:mj,a=0;a<2*n;a+=2)r.push(o(s+8*a));return i&&r.push(r[0]),r}function vj(t){var e=rj(t),i=e[0],n=e[1];return QU.h3IsValid(i,n)?QU.h3GetResolution(i,n):-1}function _j(t){var e=KU._malloc(tj),i=rj(t);QU.h3ToGeo(i[0],i[1],e);var n=mj(e);return KU._free(e),n}function bj(t,e){var i=KU._malloc(ej),n=rj(t);QU.h3ToGeoBoundary(n[0],n[1],i);var s=Aj(i,e,e);return KU._free(i),s}function yj(t,e){var i=rj(t);return hj(QU.h3ToParent(i[0],i[1],e))}function wj(t,e,i){if(function(t){if(\"number\"!=typeof t||t<0||t>15||Math.floor(t)!==t)throw new Error(\"Invalid resolution: \"+t)}(e),i=Boolean(i),0===t.length||0===t[0].length)return[];\"number\"==typeof t[0][0]&&(t=[t]);var n=function(t,e){var i,n=t.length-1,s=KU._calloc(ij),r=0+nj,o=r+4;if(cj(t[0],s+0,e),n>0){i=KU._calloc(n,nj);for(var a=0;a<n;a++)cj(t[a+1],i+nj*a,e)}return KU.setValue(s+r,n,\"i32\"),KU.setValue(s+o,i,\"i32\"),s}(t,i),s=QU.maxPolyfillSize(n,e),r=KU._calloc(s,JU);QU.polyfill(n,e,r);var o=pj(r,s);return KU._free(r),function(t){var e=0+nj,i=e+4;KU._free(KU.getValue(t+0+4,\"i8*\"));var n=KU.getValue(t+e,\"i32\");if(n>0){for(var s=KU.getValue(t+i,\"i32\"),r=0;r<n;r++)KU._free(KU.getValue(s+nj*r+4,\"i8*\"));KU._free(s)}KU._free(t)}(n),o}function xj(t){var e=rj(t);return hj(QU.getOriginH3IndexFromUnidirectionalEdge(e[0],e[1]))}function Sj(t){var e=rj(t);return hj(QU.getDestinationH3IndexFromUnidirectionalEdge(e[0],e[1]))}function Cj(t){var e=rj(t);return Boolean(QU.h3UnidirectionalEdgeIsValid(e[0],e[1]))}function kj(t){var e=rj(t),i=e[0],n=e[1],s=KU._calloc(2,JU);QU.getH3IndexesFromUnidirectionalEdge(i,n,s);var r=pj(s,2);return KU._free(s),r}function Ej(t,e){var i=KU._malloc(ej),n=rj(t);QU.getH3UnidirectionalEdgeBoundary(n[0],n[1],i);var s=Aj(i,e);return KU._free(i),s}function Mj(t){return t*Math.PI/180}function Tj(t){let e=null;const i=t.map(t=>{const i=FU(bj(t,!0),e);return e=i[i.length-1],i}).map(t=>t.reduce((t,e)=>(e[0]<t.minLongitude&&(t.minLongitude=e[0]),e[0]>t.maxLongitude&&(t.maxLongitude=e[0]),e[1]<t.minLatitude&&(t.minLatitude=e[1]),e[1]>t.maxLatitude&&(t.maxLatitude=e[1]),t),{minLongitude:Number.MAX_SAFE_INTEGER,maxLongitude:Number.MIN_SAFE_INTEGER,minLatitude:Number.MAX_SAFE_INTEGER,maxLatitude:Number.MIN_SAFE_INTEGER})).reduce((t,e)=>(e.minLongitude<t.minLongitude&&(t.minLongitude=e.minLongitude),e.maxLongitude>t.maxLongitude&&(t.maxLongitude=e.maxLongitude),e.minLatitude<t.minLatitude&&(t.minLatitude=e.minLatitude),e.maxLatitude>t.maxLatitude&&(t.maxLatitude=e.maxLatitude),t),{minLongitude:Number.MAX_SAFE_INTEGER,maxLongitude:Number.MIN_SAFE_INTEGER,minLatitude:Number.MAX_SAFE_INTEGER,maxLatitude:Number.MIN_SAFE_INTEGER});return[...PV([i.minLongitude,i.minLatitude]),...PV([i.maxLongitude,i.maxLatitude])]}function Ij(t){return{id:t.id,name:t.name,h3indexes:t.h3indexes}}let Pj=(()=>{class t{constructor(t,e){this.configService=t,this.mapConfigService=e,this.view$=new Jp(null),this.pointerMove$=new C,this.locateEvents$=new C,this.fitEvents$=new C,this.zoomEvents$=new C,this.flyToEvents$=new C,this.pingLocation$=new C,this.hasBooted$=new Jp(!1)}init(){this.locateEvents$.pipe(FO()).subscribe(()=>{this.hasBooted$.next(!0)})}destroy(){this.hasBooted$.next(!1)}centerOn(t,e){if(!fU(t[0])||!fU(t[1]))throw new Error(`centerOn: can't center on malformed location: ${t.toString()}`);this.locateEvents$.next(new ZU({center:t,zoom:e}))}centerOnLonLat(t,e){this.centerOn(PV(t),e)}locate(t){this.centerOnLonLat(t,10)}resetToDefaultView(){const t=this.configService.lastView;t?this.centerOn(t.center,t.zoom):this.centerOnLonLat([8.3825684,40.4385859],7)}fitOn(t,e=1e3){this.fitEvents$.next(new YU({polygon:t,duration:e}))}flyTo(t,e){this.flyToEvents$.next(new ZU({center:t,zoom:e}))}fitOnHexagons(t,e=1e3){this.fitOn(Tj(t),e)}zoomByDelta(t){this.zoomEvents$.next(t)}updateViewState(t){this.view$.next(t)}emitPointerMoveEvent(t){this.pointerMove$.next(t)}locateFit(t){if(this.pingLocation(t),this.mapConfigService.zoomOnLocationEvents$.value)this.locate(t);else{const[e,i]=PV(t),n=this.view$.value;let[s,r,o,a]=n.extent;if(!(s<e&&e<o&&r<i&&i<a)){e<s&&(s=e),e>o&&(o=e),i<r&&(r=i),i>a&&(a=i);const l=Mz(n.center,n.maxResolution,0,n.viewportSize.map(t=>t-200)),c=l[3]-l[1];o-s<l[2]-l[0]&&a-r<c?this.fitOn([s,r,o,a]):this.centerOnLonLat(t)}}}pingLocation(t){this.pingLocation$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(WU),Mn(qU))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function Oj(t,e=df){const i=function(t){return t instanceof Date&&!isNaN(+t)}(t)?+t-e.now():Math.abs(t);return t=>t.lift(new Rj(i,e))}class Rj{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new Dj(t,this.delay,this.scheduler))}}class Dj extends g{constructor(t,e,i){super(t),this.delay=e,this.scheduler=i,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,i=e.queue,n=t.scheduler,s=t.destination;for(;i.length>0&&i[0].time-n.now()<=0;)i.shift().notification.observe(s);if(i.length>0){const e=Math.max(0,i[0].time-n.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(Dj.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,i=new Lj(e.now()+this.delay,t);this.queue.push(i),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(bg.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(bg.createComplete()),this.unsubscribe()}}class Lj{constructor(t,e){this.time=t,this.notification=e}}let Fj=(()=>{class t{constructor(t){this.mapConfigService=t,this.timestamp$=new Jp(0),this.mapConfigService.shipFilter$.pipe(kf(1),M(t=>t.frozenTimestamp),Af(t=>t>0),FO()).subscribe(t=>{this.setTimestamp(t)}),this.timestamp$.pipe(kf(1),Oj(0)).subscribe(t=>{this.mapConfigService.freezeTimestamp(t)})}setTimestampToNow(){this.setTimestamp(this.getCurrentTimestamp())}setTimestamp(t){t=Math.min(t,this.getCurrentTimestamp()),this.timestamp$.next(t)}incrementTimestamp(t){this.setTimestamp(this.timestamp$.value+t)}resetTimestamp(){this.setTimestamp(0)}getCurrentTimestamp(){return Math.ceil(Date.now()/1e3)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(qU))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Nj=(()=>{class t{constructor(t,e,i,n){this.router=t,this.configService=e,this.historyService=i,this.mapService=n,this.previousUrl=void 0,this.currentUrl=void 0,this.route$=new Jp(\"\"),this.viewURL$=new Jp(\"\"),this.router.events.subscribe(t=>{t instanceof zO&&(this.currentUrl&&(this.previousUrl=this.currentUrl),this.currentUrl=t.urlAfterRedirects,this.route$.next(this.currentUrl))}),JT([this.mapService.view$.pipe(kf(1)),this.historyService.timestamp$]).pipe(pf(500)).subscribe(([t,e])=>{let i=t.toURL();e&&(i+=`,${new Date(1e3*e).toISOString()}`),this.viewURL$.next(i),null!==t.center[0]&&this.configService.set(\"lastView\",t.toLocateEvent())})}goToPreviousPage(){return Hp(this,void 0,void 0,function*(){yield this.router.navigateByUrl(this.previousUrl)})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(pL),Mn(WU),Mn(Fj),Mn(Pj))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const Bj=Symbol(\"Comlink.proxy\"),zj=Symbol(\"Comlink.endpoint\"),Vj=Symbol(\"Comlink.releaseProxy\"),$j=Symbol(\"Comlink.thrown\"),Uj=t=>\"object\"==typeof t&&null!==t||\"function\"==typeof t,jj=new Map([[\"proxy\",{canHandle:t=>Uj(t)&&t[Bj],serialize(t){const{port1:e,port2:i}=new MessageChannel;return Hj(t,e),[i,[i]]},deserialize:t=>(t.start(),Wj(t))}],[\"throw\",{canHandle:t=>Uj(t)&&$j in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){throw t.isError?Object.assign(new Error(t.value.message),t.value):t.value}}]]);function Hj(t,e=self){e.addEventListener(\"message\",function i(n){if(!n||!n.data)return;const{id:s,type:r,path:o}=Object.assign({path:[]},n.data),a=(n.data.argumentList||[]).map(tH);let l;try{const e=o.slice(0,-1).reduce((t,e)=>t[e],t),i=o.reduce((t,e)=>t[e],t);switch(r){case\"GET\":l=i;break;case\"SET\":e[o.slice(-1)[0]]=tH(n.data.value),l=!0;break;case\"APPLY\":l=i.apply(e,a);break;case\"CONSTRUCT\":l=Qj(new i(...a));break;case\"ENDPOINT\":{const{port1:e,port2:i}=new MessageChannel;Hj(t,i),l=function(t,e){return Xj.set(t,e),t}(e,[e])}break;case\"RELEASE\":l=void 0;break;default:return}}catch(c){l={value:c,[$j]:0}}Promise.resolve(l).catch(t=>({value:t,[$j]:0})).then(t=>{const[n,o]=Jj(t);e.postMessage(Object.assign(Object.assign({},n),{id:s}),o),\"RELEASE\"===r&&(e.removeEventListener(\"message\",i),Gj(e))})}),e.start&&e.start()}function Gj(t){(function(t){return\"MessagePort\"===t.constructor.name})(t)&&t.close()}function Wj(t,e){return Yj(t,[],e)}function qj(t){if(t)throw new Error(\"Proxy has been released and is not useable\")}function Yj(t,e=[],i=function(){}){let n=!1;const s=new Proxy(i,{get(i,r){if(qj(n),r===Vj)return()=>eH(t,{type:\"RELEASE\",path:e.map(t=>t.toString())}).then(()=>{Gj(t),n=!0});if(\"then\"===r){if(0===e.length)return{then:()=>s};const i=eH(t,{type:\"GET\",path:e.map(t=>t.toString())}).then(tH);return i.then.bind(i)}return Yj(t,[...e,r])},set(i,s,r){qj(n);const[o,a]=Jj(r);return eH(t,{type:\"SET\",path:[...e,s].map(t=>t.toString()),value:o},a).then(tH)},apply(i,s,r){qj(n);const o=e[e.length-1];if(o===zj)return eH(t,{type:\"ENDPOINT\"}).then(tH);if(\"bind\"===o)return Yj(t,e.slice(0,-1));const[a,l]=Kj(r);return eH(t,{type:\"APPLY\",path:e.map(t=>t.toString()),argumentList:a},l).then(tH)},construct(i,s){qj(n);const[r,o]=Kj(s);return eH(t,{type:\"CONSTRUCT\",path:e.map(t=>t.toString()),argumentList:r},o).then(tH)}});return s}function Zj(t){return Array.prototype.concat.apply([],t)}function Kj(t){const e=t.map(Jj);return[e.map(t=>t[0]),Zj(e.map(t=>t[1]))]}const Xj=new WeakMap;function Qj(t){return Object.assign(t,{[Bj]:!0})}function Jj(t){for(const[e,i]of jj)if(i.canHandle(t)){const[n,s]=i.serialize(t);return[{type:\"HANDLER\",name:e,value:n},s]}return[{type:\"RAW\",value:t},Xj.get(t)||[]]}function tH(t){switch(t.type){case\"HANDLER\":return jj.get(t.name).deserialize(t.value);case\"RAW\":return t.value}}function eH(t,e,i){return new Promise(n=>{const s=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join(\"-\");t.addEventListener(\"message\",function e(i){!i.data||!i.data.id||i.data.id!==s||(t.removeEventListener(\"message\",e),n(i.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:s},e),i)})}const iH=new Worker(i.tu(new URL(i.p+i.u(390),i.b)),{type:void 0}),nH=Wj(iH);let sH=(()=>{class t{constructor(t,e){this.ngZone=t,this.errorHandler=e,this.areaShipsFeeds$=new C,this.areaAircraftsFeeds$=new C,this.inflightRequests$=new Jp(!1),this.applicationHealth$=new Jp(null),this.isOffline=!1,iH.addEventListener(\"message\",t=>{var e;switch(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.type){case\"error\":case\"unhandledrejection\":this.errorHandler.handleError(Object.assign(new Error,t.data));break;case\"sentry_breadcrumb\":sB(t.data.breadcrumb)}})}init(){return Hp(this,void 0,void 0,function*(){yield new Promise((t,e)=>{this.ngZone.runOutsideAngular(()=>Hp(this,void 0,void 0,function*(){try{this.worker=yield new nH({serverURL:window.__anaisSettings.ANAIS_SERVER_URL,sepiaServerURL:window.__anaisSettings.SEPIA_SERVER_URL,sentryURL:window.__anaisSettings.SENTRY_URL,sentryRelease:window.__anaisSettings.APPLICATION_FULL_VERSION},Qj({areaShipsFeed:t=>Hp(this,void 0,void 0,function*(){this.areaShipsFeeds$.next(t)}),areaAircraftsFeed:t=>{this.areaAircraftsFeeds$.next(t)},inflightRequests:t=>{this.inflightRequests$.next(t)},applicationHealth:t=>{this.isOffline||this.applicationHealth$.next(t)}})),t()}catch(i){e(i)}}))})})}setOffline(t){this.isOffline=t,this.application.setOffline(t)}get(){return this.worker}get aircrafts(){return this.worker.aircrafts}get alerts(){return this.worker.alerts}get alertRules(){return this.worker.alertRules}get annotations(){return this.worker.annotations}get application(){return this.worker.application}get authentication(){return this.worker.authentication}get containers(){return this.worker.containers}get export(){return this.worker.export}get fleets(){return this.worker.fleets}get groups(){return this.worker.groups}get lloyds(){return this.worker.lloyds}get modifications(){return this.worker.modifications}get offline(){return this.worker.offline}get ports(){return this.worker.ports}get ships(){return this.worker.ships}get tickets(){return this.worker.tickets}get users(){return this.worker.users}get zones(){return this.worker.zones}get view(){return this.worker.view}get viewport(){return this.worker.viewport}get aircraftsFeed(){return this.worker.aircraftsFeed}get shipsFeed(){return this.worker.shipsFeed}}return t.\\u0275fac=function(e){return new(e||t)(Mn(nu),Mn(Rs))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),rH=(()=>{class t{constructor(t,e,i,n,s){this.errorHandler=t,this.mapConfigService=e,this.mapService=i,this.routeService=n,this.workerService=s,this.initialized=!1,this.user$=new Jp(null),this.user$.subscribe(t=>{!function(t){iB(\"setUser\",t)}(t?{id:t.id,email:t.email}:null)}),this.errorHandler.unauthorizedError$.subscribe(()=>{var t;this.clearAuthentication();let e=this.routeService.currentUrl;(\"/\"===e||e.startsWith(\"/@\"))&&(e=null===(t=this.mapService.view$.value)||void 0===t?void 0:t.toURL()),location.href=\"/login?expired=\"+(e?\"&redirect=\"+e:\"\")})}init(t){return Hp(this,void 0,void 0,function*(){if(t)this.user$.next(t);else try{this.user$.next(yield this.workerService.authentication.getUserInfos())}catch(e){if(e.name!==aB.Unauthorized&&e.name!==aB.Maintenance)throw e}this.initialized=!0})}isAuthenticated(){return null!==this.user$.value}isAdmin(){return this.isAuthenticated()&&\"admin\"===this.user$.value.profile}getUserId(){return this.isAuthenticated()&&this.user$.value.id}login(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.authentication.login(t),this.mapConfigService.resetShipFilter(),this.user$.next(yield this.workerService.authentication.getUserInfos())})}logout(){return Hp(this,void 0,void 0,function*(){try{yield this.workerService.authentication.logout()}finally{this.clearAuthentication()}})}clearAuthentication(){this.user$.next(null)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(Rs),Mn(qU),Mn(Pj),Mn(Nj),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),oH=(()=>{class t{constructor(t){this.data=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(XC))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-confirm-dialog\"]],decls:11,vars:4,consts:[[\"mat-dialog-title\",\"\"],[\"mat-dialog-content\",\"\"],[\"mat-dialog-actions\",\"\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Oui\",3,\"mat-dialog-close\"],[\"mat-button\",\"\",\"title\",\"Non\",3,\"mat-dialog-close\"]],template:function(t,e){1&t&&(La(0,\"h1\",0),xl(1),Fa(),La(2,\"div\",1),La(3,\"p\"),xl(4),Fa(),Fa(),La(5,\"div\",2),Na(6,\"div\",3),La(7,\"button\",4),xl(8,\"Oui\"),Fa(),La(9,\"button\",5),xl(10,\"Non\"),Fa(),Fa()),2&t&&(Cr(1),Sl(e.data.title),Cr(3),Sl(e.data.message),Cr(3),Ra(\"mat-dialog-close\",!0),Cr(2),Ra(\"mat-dialog-close\",!1))},directives:[rk,ok,ak,Ly,sk],encapsulation:2,changeDetection:0}),t})();function aH(t,e){if(1&t){const t=$a();La(0,\"div\",1),La(1,\"button\",2),Ga(\"click\",function(){return Fe(t),Ka().action()}),xl(2),Fa(),Fa()}if(2&t){const t=Ka();Cr(2),Sl(t.data.action)}}function lH(t,e){}const cH=new Ji(\"MatSnackBarData\");class hH{constructor(){this.politeness=\"assertive\",this.announcementMessage=\"\",this.duration=0,this.data=null,this.horizontalPosition=\"center\",this.verticalPosition=\"bottom\"}}const uH=Math.pow(2,31)-1;class dH{constructor(t,e){this._overlayRef=e,this._afterDismissed=new C,this._afterOpened=new C,this._onAction=new C,this._dismissedByAction=!1,this.containerInstance=t,this.onAction().subscribe(()=>this.dismiss()),t._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(t){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(t,uH))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}}let pH=(()=>{class t{constructor(t,e){this.snackBarRef=t,this.data=e}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}}return t.\\u0275fac=function(e){return new(e||t)(Oa(dH),Oa(cH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"simple-snack-bar\"]],hostAttrs:[1,\"mat-simple-snackbar\"],decls:3,vars:2,consts:[[\"class\",\"mat-simple-snackbar-action\",4,\"ngIf\"],[1,\"mat-simple-snackbar-action\"],[\"mat-button\",\"\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"span\"),xl(1),Fa(),oa(2,aH,3,1,\"div\",0)),2&t&&(Cr(1),Sl(e.data.message),Cr(1),Ra(\"ngIf\",e.hasAction))},directives:[Vd,Ly],styles:[\".mat-simple-snackbar{display:flex;justify-content:space-between;align-items:center;line-height:20px;opacity:1}.mat-simple-snackbar-action{flex-shrink:0;margin:-8px -8px -8px 8px}.mat-simple-snackbar-action button{max-height:36px;min-width:0}[dir=rtl] .mat-simple-snackbar-action{margin-left:-8px;margin-right:8px}\\n\"],encapsulation:2,changeDetection:0}),t})();const fH={snackBarState:BA(\"state\",[UA(\"void, hidden\",$A({transform:\"scale(0.8)\",opacity:0})),UA(\"visible\",$A({transform:\"scale(1)\",opacity:1})),HA(\"* => visible\",zA(\"150ms cubic-bezier(0, 0, 0.2, 1)\")),HA(\"* => void, * => hidden\",zA(\"75ms cubic-bezier(0.4, 0.0, 1, 1)\",$A({opacity:0})))])};let mH=(()=>{class t extends Zp{constructor(t,e,i,n,s){super(),this._ngZone=t,this._elementRef=e,this._changeDetectorRef=i,this._platform=n,this.snackBarConfig=s,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new C,this._onExit=new C,this._onEnter=new C,this._animationState=\"void\",this.attachDomPortal=t=>(this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachDomPortal(t)),this._live=\"assertive\"!==s.politeness||s.announcementMessage?\"off\"===s.politeness?\"off\":\"polite\":\"assertive\",this._platform.FIREFOX&&(\"polite\"===this._live&&(this._role=\"status\"),\"assertive\"===this._live&&(this._role=\"alert\"))}attachComponentPortal(t){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._assertNotAttached(),this._applySnackBarClasses(),this._portalOutlet.attachTemplatePortal(t)}onAnimationEnd(t){const{fromState:e,toState:i}=t;if((\"void\"===i&&\"void\"!==e||\"hidden\"===i)&&this._completeExit(),\"visible\"===i){const t=this._onEnter;this._ngZone.run(()=>{t.next(),t.complete()})}}enter(){this._destroyed||(this._animationState=\"visible\",this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._animationState=\"hidden\",this._elementRef.nativeElement.setAttribute(\"mat-exit\",\"\"),clearTimeout(this._announceTimeoutId),this._onExit}ngOnDestroy(){this._destroyed=!0,this._completeExit()}_completeExit(){this._ngZone.onMicrotaskEmpty.pipe(xf(1)).subscribe(()=>{this._onExit.next(),this._onExit.complete()})}_applySnackBarClasses(){const t=this._elementRef.nativeElement,e=this.snackBarConfig.panelClass;e&&(Array.isArray(e)?e.forEach(e=>t.classList.add(e)):t.classList.add(e)),\"center\"===this.snackBarConfig.horizontalPosition&&t.classList.add(\"mat-snack-bar-center\"),\"top\"===this.snackBarConfig.verticalPosition&&t.classList.add(\"mat-snack-bar-top\")}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{const t=this._elementRef.nativeElement.querySelector(\"[aria-hidden]\"),e=this._elementRef.nativeElement.querySelector(\"[aria-live]\");if(t&&e){let i=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&t.contains(document.activeElement)&&(i=document.activeElement),t.removeAttribute(\"aria-hidden\"),e.appendChild(t),null==i||i.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(ic),Oa(Mc),Oa(Hf),Oa(hH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"snack-bar-container\"]],viewQuery:function(t,e){if(1&t&&Th(Xp,7),2&t){let t;Mh(t=Ph())&&(e._portalOutlet=t.first)}},hostAttrs:[1,\"mat-snack-bar-container\"],hostVars:1,hostBindings:function(t,e){1&t&&Wa(\"@state.done\",function(t){return e.onAnimationEnd(t)}),2&t&&Pl(\"@state\",e._animationState)},features:[Uo],decls:3,vars:2,consts:[[\"aria-hidden\",\"true\"],[\"cdkPortalOutlet\",\"\"]],template:function(t,e){1&t&&(La(0,\"div\",0),oa(1,lH,0,0,\"ng-template\",1),Fa(),Na(2,\"div\")),2&t&&(Cr(2),ia(\"aria-live\",e._live)(\"role\",e._role))},directives:[Xp],styles:[\".mat-snack-bar-container{border-radius:4px;box-sizing:border-box;display:block;margin:24px;max-width:33vw;min-width:344px;padding:14px 16px;min-height:48px;transform-origin:center}.cdk-high-contrast-active .mat-snack-bar-container{border:solid 1px}.mat-snack-bar-handset{width:100%}.mat-snack-bar-handset .mat-snack-bar-container{margin:8px;max-width:100%;min-width:0;width:100%}\\n\"],encapsulation:2,data:{animation:[fH.snackBarState]}}),t})(),gH=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[DA,Qp,np,Ny,Fb],Fb]}),t})();const AH=new Ji(\"mat-snack-bar-default-options\",{providedIn:\"root\",factory:function(){return new hH}});let vH=(()=>{class t{constructor(t,e,i,n,s,r){this._overlay=t,this._live=e,this._injector=i,this._breakpointObserver=n,this._parentSnackBar=s,this._defaultConfig=r,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=pH,this.snackBarContainerComponent=mH,this.handsetCssClass=\"mat-snack-bar-handset\"}get _openedSnackBarRef(){const t=this._parentSnackBar;return t?t._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(t){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=t:this._snackBarRefAtThisLevel=t}openFromComponent(t,e){return this._attach(t,e)}openFromTemplate(t,e){return this._attach(t,e)}open(t,e=\"\",i){const n=Object.assign(Object.assign({},this._defaultConfig),i);return n.data={message:t,action:e},n.announcementMessage===t&&(n.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,n)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(t,e){const i=Vo.create({parent:e&&e.viewContainerRef&&e.viewContainerRef.injector||this._injector,providers:[{provide:hH,useValue:e}]}),n=new Wp(this.snackBarContainerComponent,e.viewContainerRef,i),s=t.attach(n);return s.instance.snackBarConfig=e,s.instance}_attach(t,e){const i=Object.assign(Object.assign(Object.assign({},new hH),this._defaultConfig),e),n=this._createOverlay(i),s=this._attachSnackBarContainer(n,i),r=new dH(s,n);if(t instanceof Rc){const e=new qp(t,null,{$implicit:i.data,snackBarRef:r});r.instance=s.attachTemplatePortal(e)}else{const e=this._createInjector(i,r),n=new Wp(t,void 0,e),o=s.attachComponentPortal(n);r.instance=o.instance}return this._breakpointObserver.observe(\"(max-width: 599.98px) and (orientation: portrait)\").pipe(Of(n.detachments())).subscribe(t=>{const e=n.overlayElement.classList;t.matches?e.add(this.handsetCssClass):e.remove(this.handsetCssClass)}),i.announcementMessage&&s._onAnnounce.subscribe(()=>{this._live.announce(i.announcementMessage,i.politeness)}),this._animateSnackBar(r,i),this._openedSnackBarRef=r,this._openedSnackBarRef}_animateSnackBar(t,e){t.afterDismissed().subscribe(()=>{this._openedSnackBarRef==t&&(this._openedSnackBarRef=null),e.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{t.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):t.containerInstance.enter(),e.duration&&e.duration>0&&t.afterOpened().subscribe(()=>t._dismissAfter(e.duration))}_createOverlay(t){const e=new cA;e.direction=t.direction;let i=this._overlay.position().global();const n=\"rtl\"===t.direction,s=\"left\"===t.horizontalPosition||\"start\"===t.horizontalPosition&&!n||\"end\"===t.horizontalPosition&&n,r=!s&&\"center\"!==t.horizontalPosition;return s?i.left(\"0\"):r?i.right(\"0\"):i.centerHorizontally(),\"top\"===t.verticalPosition?i.top(\"0\"):i.bottom(\"0\"),e.positionStrategy=i,this._overlay.create(e)}_createInjector(t,e){return Vo.create({parent:t&&t.viewContainerRef&&t.viewContainerRef.injector||this._injector,providers:[{provide:dH,useValue:e},{provide:cH,useValue:t.data}]})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(MA),Mn(Fm),Mn(Vo),Mn(oI),Mn(t,12),Mn(AH))},t.\\u0275prov=mt({factory:function(){return new t(Mn(MA),Mn(Fm),Mn(Co),Mn(oI),Mn(t,12),Mn(AH))},token:t,providedIn:gH}),t})(),_H=(()=>{class t{constructor(t,e,i){this.ngZone=t,this.dialog=e,this.snackBar=i,this.drawingMode$=new Jp(!1),this.errors$=new C,this.errors$.pipe(FM(1e3,uf,{leading:!0,trailing:!0})).subscribe(t=>{this.ngZone.run(()=>{this.snackBar.open(t,\"Fermer\",{panelClass:\"error-snack-bar\",duration:4e3})})})}success(t,e=0){this.snackBar.open(t,0===e?\"Fermer\":\"\",{duration:e})}error(t){this.errors$.next(t)}confirm(t){this.ngZone.run(()=>{this.dialog.open(oH,{data:{title:t.title,message:t.message}}).afterClosed().subscribe(t.action)})}confirmAsync(t){return Hp(this,void 0,void 0,function*(){return new Promise(e=>{this.ngZone.run(()=>{this.dialog.open(oH,{data:{title:t.title,message:t.message}}).afterClosed().subscribe(t=>{e(t)})})})})}setDrawingMode(t){this.drawingMode$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(nu),Mn(ik),Mn(vH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),bH=(()=>{class t{constructor(t,e,i){this.authenticationService=t,this.router=e,this.uiService=i}canActivateChild(t,e){return Hp(this,void 0,void 0,function*(){return!!this.authenticationService.isAdmin()||(this.uiService.error(\"Vous n'avez pas les permissions requises.\"),yield this.router.navigateByUrl(\"/\"),!1)})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(rH),Mn(pL),Mn(_H))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const yH=[{label:\"15 minutes\",value:900},{label:\"30 minutes\",value:1800},{label:\"1 heure\",value:3600},{label:\"2 heures\",value:7200},{label:\"6 heures\",value:21600},{label:\"12 heures\",value:43200},{label:\"24 heures\",value:86400},{label:\"2 jours\",value:172800},{label:\"1 semaine\",value:604800},{label:\"2 semaines\",value:1209600},{label:\"1 mois\",value:2592e3},{label:\"3 mois\",value:7776e3}],wH=yH.reduce((t,e)=>(t[e.value]=e.label,t),{});var xH=(()=>(function(t){t.RealTime=\"realTime\",t.PastAndRealTime=\"pastAndRealTime\",t.Past=\"past\"}(xH||(xH={})),xH))();function SH(t){t.speed||(t.speed={enable:!1,min:0,max:100}),t.erraticRoute||(t.erraticRoute={enable:!1}),t.transhipment||(t.transhipment={enable:!1}),t.aisInterruption||(t.aisInterruption={enable:!1}),t.passageInZone||(t.passageInZone={enable:!1,sequential:!1,timeWindow:yH.find(t=>\"1 mois\"===t.label).value,passages:[]}),t.spoofing||(t.spoofing={enable:!1}),t.identifier||(t.identifier={enable:!1,identifiers:[]}),t.fleet||(t.fleet={enable:!1,fleets:[]}),t.flag||(t.flag={enable:!1,flags:[]}),t.type||(t.type={enable:!1,types:[]}),t.time||(t.time={type:xH.RealTime,since:null,to:null}),t.zone||(t.zone={enable:!0,zones:[]})}const CH=[{name:\"Afghanistan\",iso2:\"af\",iso3:\"afg\"},{name:\"Afrique du Sud\",iso2:\"za\",iso3:\"zaf\"},{name:\"\\xceles \\xc5land\",iso2:\"ax\",iso3:\"ala\"},{name:\"Albanie\",iso2:\"al\",iso3:\"alb\"},{name:\"Alg\\xe9rie\",iso2:\"dz\",iso3:\"dza\"},{name:\"Allemagne\",iso2:\"de\",iso3:\"deu\"},{name:\"Andorre\",iso2:\"ad\",iso3:\"and\"},{name:\"Angola\",iso2:\"ao\",iso3:\"ago\"},{name:\"Anguilla\",iso2:\"ai\",iso3:\"aia\"},{name:\"Antarctique\",iso2:\"aq\",iso3:\"ata\"},{name:\"Antigua-et-Barbuda\",iso2:\"ag\",iso3:\"atg\"},{name:\"Arabie saoudite\",iso2:\"sa\",iso3:\"sau\"},{name:\"Argentine\",iso2:\"ar\",iso3:\"arg\"},{name:\"Arm\\xe9nie\",iso2:\"am\",iso3:\"arm\"},{name:\"Aruba\",iso2:\"aw\",iso3:\"abw\"},{name:\"Australie\",iso2:\"au\",iso3:\"aus\"},{name:\"Autriche\",iso2:\"at\",iso3:\"aut\"},{name:\"Azerba\\xefdjan\",iso2:\"az\",iso3:\"aze\"},{name:\"Bahamas\",iso2:\"bs\",iso3:\"bhs\"},{name:\"Bahre\\xefn\",iso2:\"bh\",iso3:\"bhr\"},{name:\"Bangladesh\",iso2:\"bd\",iso3:\"bgd\"},{name:\"Barbade\",iso2:\"bb\",iso3:\"brb\"},{name:\"Bi\\xe9lorussie\",iso2:\"by\",iso3:\"blr\"},{name:\"Belgique\",iso2:\"be\",iso3:\"bel\"},{name:\"Belize\",iso2:\"bz\",iso3:\"blz\"},{name:\"B\\xe9nin\",iso2:\"bj\",iso3:\"ben\"},{name:\"Bermudes\",iso2:\"bm\",iso3:\"bmu\"},{name:\"Bhoutan\",iso2:\"bt\",iso3:\"btn\"},{name:\"Bolivie\",iso2:\"bo\",iso3:\"bol\"},{name:\"Pays-Bas carib\\xe9ens\",iso2:\"bq\",iso3:\"bes\"},{name:\"Bosnie-Herz\\xe9govine\",iso2:\"ba\",iso3:\"bih\"},{name:\"Botswana\",iso2:\"bw\",iso3:\"bwa\"},{name:\"\\xcele Bouvet\",iso2:\"bv\",iso3:\"bvt\"},{name:\"Br\\xe9sil\",iso2:\"br\",iso3:\"bra\"},{name:\"Brunei\",iso2:\"bn\",iso3:\"brn\"},{name:\"Bulgarie\",iso2:\"bg\",iso3:\"bgr\"},{name:\"Burkina Faso\",iso2:\"bf\",iso3:\"bfa\"},{name:\"Burundi\",iso2:\"bi\",iso3:\"bdi\"},{name:\"\\xceles Ca\\xefmans\",iso2:\"ky\",iso3:\"cym\"},{name:\"Cambodge\",iso2:\"kh\",iso3:\"khm\"},{name:\"Cameroun\",iso2:\"cm\",iso3:\"cmr\"},{name:\"Canada\",iso2:\"ca\",iso3:\"can\"},{name:\"Cap-Vert\",iso2:\"cv\",iso3:\"cpv\"},{name:\"R\\xe9publique centrafricaine\",iso2:\"cf\",iso3:\"caf\"},{name:\"Chili\",iso2:\"cl\",iso3:\"chl\"},{name:\"Chine\",iso2:\"cn\",iso3:\"chn\"},{name:\"\\xcele Christmas\",iso2:\"cx\",iso3:\"cxr\"},{name:\"Chypre\",iso2:\"cy\",iso3:\"cyp\"},{name:\"\\xceles Cocos\",iso2:\"cc\",iso3:\"cck\"},{name:\"Colombie\",iso2:\"co\",iso3:\"col\"},{name:\"Comores\",iso2:\"km\",iso3:\"com\"},{name:\"R\\xe9publique du Congo\",iso2:\"cg\",iso3:\"cog\"},{name:\"R\\xe9publique d\\xe9mocratique du Congo\",iso2:\"cd\",iso3:\"cod\"},{name:\"\\xceles Cook\",iso2:\"ck\",iso3:\"cok\"},{name:\"Cor\\xe9e du Sud\",iso2:\"kr\",iso3:\"kor\"},{name:\"Cor\\xe9e du Nord\",iso2:\"kp\",iso3:\"prk\"},{name:\"Costa Rica\",iso2:\"cr\",iso3:\"cri\"},{name:\"C\\xf4te d'Ivoire\",iso2:\"ci\",iso3:\"civ\"},{name:\"Croatie\",iso2:\"hr\",iso3:\"hrv\"},{name:\"Cuba\",iso2:\"cu\",iso3:\"cub\"},{name:\"Cura\\xe7ao\",iso2:\"cw\",iso3:\"cuw\"},{name:\"Danemark\",iso2:\"dk\",iso3:\"dnk\"},{name:\"Djibouti\",iso2:\"dj\",iso3:\"dji\"},{name:\"R\\xe9publique dominicaine\",iso2:\"do\",iso3:\"dom\"},{name:\"Dominique\",iso2:\"dm\",iso3:\"dma\"},{name:\"\\xc9gypte\",iso2:\"eg\",iso3:\"egy\"},{name:\"Salvador\",iso2:\"sv\",iso3:\"slv\"},{name:\"\\xc9mirats arabes unis\",iso2:\"ae\",iso3:\"are\"},{name:\"\\xc9quateur\",iso2:\"ec\",iso3:\"ecu\"},{name:\"\\xc9rythr\\xe9e\",iso2:\"er\",iso3:\"eri\"},{name:\"Espagne\",iso2:\"es\",iso3:\"esp\"},{name:\"Estonie\",iso2:\"ee\",iso3:\"est\"},{name:\"\\xc9tats-Unis\",iso2:\"us\",iso3:\"usa\"},{name:\"\\xc9thiopie\",iso2:\"et\",iso3:\"eth\"},{name:\"Malouines\",iso2:\"fk\",iso3:\"flk\"},{name:\"\\xceles F\\xe9ro\\xe9\",iso2:\"fo\",iso3:\"fro\"},{name:\"Fidji\",iso2:\"fj\",iso3:\"fji\"},{name:\"Finlande\",iso2:\"fi\",iso3:\"fin\"},{name:\"France\",iso2:\"fr\",iso3:\"fra\"},{name:\"Gabon\",iso2:\"ga\",iso3:\"gab\"},{name:\"Gambie\",iso2:\"gm\",iso3:\"gmb\"},{name:\"G\\xe9orgie\",iso2:\"ge\",iso3:\"geo\"},{name:\"G\\xe9orgie du Sud-et-les \\xeeles Sandwich du Sud\",iso2:\"gs\",iso3:\"sgs\"},{name:\"Ghana\",iso2:\"gh\",iso3:\"gha\"},{name:\"Gibraltar\",iso2:\"gi\",iso3:\"gib\"},{name:\"Gr\\xe8ce\",iso2:\"gr\",iso3:\"grc\"},{name:\"Grenade\",iso2:\"gd\",iso3:\"grd\"},{name:\"Groenland\",iso2:\"gl\",iso3:\"grl\"},{name:\"Guadeloupe\",iso2:\"gp\",iso3:\"glp\"},{name:\"Guam\",iso2:\"gu\",iso3:\"gum\"},{name:\"Guatemala\",iso2:\"gt\",iso3:\"gtm\"},{name:\"Guernesey\",iso2:\"gg\",iso3:\"ggy\"},{name:\"Guin\\xe9e\",iso2:\"gn\",iso3:\"gin\"},{name:\"Guin\\xe9e-Bissau\",iso2:\"gw\",iso3:\"gnb\"},{name:\"Guin\\xe9e \\xe9quatoriale\",iso2:\"gq\",iso3:\"gnq\"},{name:\"Guyana\",iso2:\"gy\",iso3:\"guy\"},{name:\"Guyane\",iso2:\"gf\",iso3:\"guf\"},{name:\"Ha\\xefti\",iso2:\"ht\",iso3:\"hti\"},{name:\"\\xceles Heard-et-MacDonald\",iso2:\"hm\",iso3:\"hmd\"},{name:\"Honduras\",iso2:\"hn\",iso3:\"hnd\"},{name:\"Hong Kong\",iso2:\"hk\",iso3:\"hkg\"},{name:\"Hongrie\",iso2:\"hu\",iso3:\"hun\"},{name:\"\\xcele de Man\",iso2:\"im\",iso3:\"imn\"},{name:\"\\xceles mineures \\xe9loign\\xe9es des \\xc9tats-Unis\",iso2:\"um\",iso3:\"umi\"},{name:\"\\xceles Vierges britanniques\",iso2:\"vg\",iso3:\"vgb\"},{name:\"\\xceles Vierges des \\xc9tats-Unis\",iso2:\"vi\",iso3:\"vir\"},{name:\"Inde\",iso2:\"in\",iso3:\"ind\"},{name:\"Indon\\xe9sie\",iso2:\"id\",iso3:\"idn\"},{name:\"Iran\",iso2:\"ir\",iso3:\"irn\"},{name:\"Irak\",iso2:\"iq\",iso3:\"irq\"},{name:\"Irlande\",iso2:\"ie\",iso3:\"irl\"},{name:\"Islande\",iso2:\"is\",iso3:\"isl\"},{name:\"Isra\\xebl\",iso2:\"il\",iso3:\"isr\"},{name:\"Italie\",iso2:\"it\",iso3:\"ita\"},{name:\"Jama\\xefque\",iso2:\"jm\",iso3:\"jam\"},{name:\"Japon\",iso2:\"jp\",iso3:\"jpn\"},{name:\"Jersey\",iso2:\"je\",iso3:\"jey\"},{name:\"Jordanie\",iso2:\"jo\",iso3:\"jor\"},{name:\"Kazakhstan\",iso2:\"kz\",iso3:\"kaz\"},{name:\"Kenya\",iso2:\"ke\",iso3:\"ken\"},{name:\"Kirghizistan\",iso2:\"kg\",iso3:\"kgz\"},{name:\"Kiribati\",iso2:\"ki\",iso3:\"kir\"},{name:\"Kowe\\xeft\",iso2:\"kw\",iso3:\"kwt\"},{name:\"Laos\",iso2:\"la\",iso3:\"lao\"},{name:\"Lesotho\",iso2:\"ls\",iso3:\"lso\"},{name:\"Lettonie\",iso2:\"lv\",iso3:\"lva\"},{name:\"Liban\",iso2:\"lb\",iso3:\"lbn\"},{name:\"Liberia\",iso2:\"lr\",iso3:\"lbr\"},{name:\"Libye\",iso2:\"ly\",iso3:\"lby\"},{name:\"Liechtenstein\",iso2:\"li\",iso3:\"lie\"},{name:\"Lituanie\",iso2:\"lt\",iso3:\"ltu\"},{name:\"Luxembourg\",iso2:\"lu\",iso3:\"lux\"},{name:\"Macao\",iso2:\"mo\",iso3:\"mac\"},{name:\"Mac\\xe9doine du Nord\",iso2:\"mk\",iso3:\"mkd\"},{name:\"Madagascar\",iso2:\"mg\",iso3:\"mdg\"},{name:\"Malaisie\",iso2:\"my\",iso3:\"mys\"},{name:\"Malawi\",iso2:\"mw\",iso3:\"mwi\"},{name:\"Maldives\",iso2:\"mv\",iso3:\"mdv\"},{name:\"Mali\",iso2:\"ml\",iso3:\"mli\"},{name:\"Malte\",iso2:\"mt\",iso3:\"mlt\"},{name:\"\\xceles Mariannes du Nord\",iso2:\"mp\",iso3:\"mnp\"},{name:\"Maroc\",iso2:\"ma\",iso3:\"mar\"},{name:\"\\xceles Marshall\",iso2:\"mh\",iso3:\"mhl\"},{name:\"Martinique\",iso2:\"mq\",iso3:\"mtq\"},{name:\"Maurice\",iso2:\"mu\",iso3:\"mus\"},{name:\"Mauritanie\",iso2:\"mr\",iso3:\"mrt\"},{name:\"Mayotte\",iso2:\"yt\",iso3:\"myt\"},{name:\"Mexique\",iso2:\"mx\",iso3:\"mex\"},{name:\"\\xc9tats f\\xe9d\\xe9r\\xe9s de Micron\\xe9sie\",iso2:\"fm\",iso3:\"fsm\"},{name:\"Moldavie\",iso2:\"md\",iso3:\"mda\"},{name:\"Monaco\",iso2:\"mc\",iso3:\"mco\"},{name:\"Mongolie\",iso2:\"mn\",iso3:\"mng\"},{name:\"Mont\\xe9n\\xe9gro\",iso2:\"me\",iso3:\"mne\"},{name:\"Montserrat\",iso2:\"ms\",iso3:\"msr\"},{name:\"Mozambique\",iso2:\"mz\",iso3:\"moz\"},{name:\"Birmanie\",iso2:\"mm\",iso3:\"mmr\"},{name:\"Namibie\",iso2:\"na\",iso3:\"nam\"},{name:\"Nauru\",iso2:\"nr\",iso3:\"nru\"},{name:\"N\\xe9pal\",iso2:\"np\",iso3:\"npl\"},{name:\"Nicaragua\",iso2:\"ni\",iso3:\"nic\"},{name:\"Niger\",iso2:\"ne\",iso3:\"ner\"},{name:\"Nigeria\",iso2:\"ng\",iso3:\"nga\"},{name:\"Niue\",iso2:\"nu\",iso3:\"niu\"},{name:\"\\xcele Norfolk\",iso2:\"nf\",iso3:\"nfk\"},{name:\"Norv\\xe8ge\",iso2:\"no\",iso3:\"nor\"},{name:\"Nouvelle-Cal\\xe9donie\",iso2:\"nc\",iso3:\"ncl\"},{name:\"Nouvelle-Z\\xe9lande\",iso2:\"nz\",iso3:\"nzl\"},{name:\"Territoire britannique de l'oc\\xe9an Indien\",iso2:\"io\",iso3:\"iot\"},{name:\"Oman\",iso2:\"om\",iso3:\"omn\"},{name:\"Ouganda\",iso2:\"ug\",iso3:\"uga\"},{name:\"Ouzb\\xe9kistan\",iso2:\"uz\",iso3:\"uzb\"},{name:\"Pakistan\",iso2:\"pk\",iso3:\"pak\"},{name:\"Palaos\",iso2:\"pw\",iso3:\"plw\"},{name:\"Palestine\",iso2:\"ps\",iso3:\"pse\"},{name:\"Panama\",iso2:\"pa\",iso3:\"pan\"},{name:\"Papouasie-Nouvelle-Guin\\xe9e\",iso2:\"pg\",iso3:\"png\"},{name:\"Paraguay\",iso2:\"py\",iso3:\"pry\"},{name:\"Pays-Bas\",iso2:\"nl\",iso3:\"nld\"},{name:\"P\\xe9rou\",iso2:\"pe\",iso3:\"per\"},{name:\"Philippines\",iso2:\"ph\",iso3:\"phl\"},{name:\"\\xceles Pitcairn\",iso2:\"pn\",iso3:\"pcn\"},{name:\"Pologne\",iso2:\"pl\",iso3:\"pol\"},{name:\"Polyn\\xe9sie fran\\xe7aise\",iso2:\"pf\",iso3:\"pyf\"},{name:\"Porto Rico\",iso2:\"pr\",iso3:\"pri\"},{name:\"Portugal\",iso2:\"pt\",iso3:\"prt\"},{name:\"Qatar\",iso2:\"qa\",iso3:\"qat\"},{name:\"La R\\xe9union\",iso2:\"re\",iso3:\"reu\"},{name:\"Roumanie\",iso2:\"ro\",iso3:\"rou\"},{name:\"Royaume-Uni\",iso2:\"gb\",iso3:\"gbr\"},{name:\"Russie\",iso2:\"ru\",iso3:\"rus\"},{name:\"Rwanda\",iso2:\"rw\",iso3:\"rwa\"},{name:\"R\\xe9publique arabe sahraouie d\\xe9mocratique\",iso2:\"eh\",iso3:\"esh\"},{name:\"Saint-Barth\\xe9lemy\",iso2:\"bl\",iso3:\"blm\"},{name:\"Saint-Christophe-et-Ni\\xe9v\\xe8s\",iso2:\"kn\",iso3:\"kna\"},{name:\"Saint-Marin\",iso2:\"sm\",iso3:\"smr\"},{name:\"Saint-Martin\",iso2:\"mf\",iso3:\"maf\"},{name:\"Saint-Martin\",iso2:\"sx\",iso3:\"sxm\"},{name:\"Saint-Pierre-et-Miquelon\",iso2:\"pm\",iso3:\"spm\"},{name:\"Saint-Si\\xe8ge (\\xc9tat de la Cit\\xe9 du Vatican)\",iso2:\"va\",iso3:\"vat\"},{name:\"Saint-Vincent-et-les-Grenadines\",iso2:\"vc\",iso3:\"vct\"},{name:\"Sainte-H\\xe9l\\xe8ne, Ascension et Tristan da Cunha\",iso2:\"sh\",iso3:\"shn\"},{name:\"Sainte-Lucie\",iso2:\"lc\",iso3:\"lca\"},{name:\"\\xceles Salomon\",iso2:\"sb\",iso3:\"slb\"},{name:\"Samoa\",iso2:\"ws\",iso3:\"wsm\"},{name:\"Samoa am\\xe9ricaines\",iso2:\"as\",iso3:\"asm\"},{name:\"Sao Tom\\xe9-et-Principe\",iso2:\"st\",iso3:\"stp\"},{name:\"S\\xe9n\\xe9gal\",iso2:\"sn\",iso3:\"sen\"},{name:\"Serbie\",iso2:\"rs\",iso3:\"srb\"},{name:\"Seychelles\",iso2:\"sc\",iso3:\"syc\"},{name:\"Sierra Leone\",iso2:\"sl\",iso3:\"sle\"},{name:\"Singapour\",iso2:\"sg\",iso3:\"sgp\"},{name:\"Slovaquie\",iso2:\"sk\",iso3:\"svk\"},{name:\"Slov\\xe9nie\",iso2:\"si\",iso3:\"svn\"},{name:\"Somalie\",iso2:\"so\",iso3:\"som\"},{name:\"Soudan\",iso2:\"sd\",iso3:\"sdn\"},{name:\"Soudan du Sud\",iso2:\"ss\",iso3:\"ssd\"},{name:\"Sri Lanka\",iso2:\"lk\",iso3:\"lka\"},{name:\"Su\\xe8de\",iso2:\"se\",iso3:\"swe\"},{name:\"Suisse\",iso2:\"ch\",iso3:\"che\"},{name:\"Suriname\",iso2:\"sr\",iso3:\"sur\"},{name:\"Svalbard et ile Jan Mayen\",iso2:\"sj\",iso3:\"sjm\"},{name:\"Eswatini\",iso2:\"sz\",iso3:\"swz\"},{name:\"Syrie\",iso2:\"sy\",iso3:\"syr\"},{name:\"Tadjikistan\",iso2:\"tj\",iso3:\"tjk\"},{name:\"Ta\\xefwan / (R\\xe9publique de Chine (Ta\\xefwan))\",iso2:\"tw\",iso3:\"twn\"},{name:\"Tanzanie\",iso2:\"tz\",iso3:\"tza\"},{name:\"Tchad\",iso2:\"td\",iso3:\"tcd\"},{name:\"Tch\\xe9quie\",iso2:\"cz\",iso3:\"cze\"},{name:\"Terres australes et antarctiques fran\\xe7aises\",iso2:\"tf\",iso3:\"atf\"},{name:\"Tha\\xeflande\",iso2:\"th\",iso3:\"tha\"},{name:\"Timor oriental\",iso2:\"tl\",iso3:\"tls\"},{name:\"Togo\",iso2:\"tg\",iso3:\"tgo\"},{name:\"Tokelau\",iso2:\"tk\",iso3:\"tkl\"},{name:\"Tonga\",iso2:\"to\",iso3:\"ton\"},{name:\"Trinit\\xe9-et-Tobago\",iso2:\"tt\",iso3:\"tto\"},{name:\"Tunisie\",iso2:\"tn\",iso3:\"tun\"},{name:\"Turkm\\xe9nistan\",iso2:\"tm\",iso3:\"tkm\"},{name:\"\\xceles Turques-et-Ca\\xefques\",iso2:\"tc\",iso3:\"tca\"},{name:\"Turquie\",iso2:\"tr\",iso3:\"tur\"},{name:\"Tuvalu\",iso2:\"tv\",iso3:\"tuv\"},{name:\"Ukraine\",iso2:\"ua\",iso3:\"ukr\"},{name:\"Uruguay\",iso2:\"uy\",iso3:\"ury\"},{name:\"Vanuatu\",iso2:\"vu\",iso3:\"vut\"},{name:\"Venezuela\",iso2:\"ve\",iso3:\"ven\"},{name:\"Vi\\xeat Nam\",iso2:\"vn\",iso3:\"vnm\"},{name:\"Wallis-et-Futuna\",iso2:\"wf\",iso3:\"wlf\"},{name:\"Y\\xe9men\",iso2:\"ye\",iso3:\"yem\"},{name:\"Zambie\",iso2:\"zm\",iso3:\"zmb\"},{name:\"Zimbabwe\",iso2:\"zw\",iso3:\"zwe\"}].map(t=>(t.flag=t.iso2,t.searchValue=pU(t.name),t)).sort((t,e)=>Intl.Collator().compare(t.name,e.name)),kH=Object.values(CH).reduce((t,e)=>(t[e.flag]=e.name,t),{});function EH(t,e){var i;const n=t;return t.criteria.zone&&(n.criteria.zone.zones=t.criteria.zone.zones.map(t=>e[t]).filter(t=>!!t)),t.criteria.passageInZone&&(n.criteria.passageInZone.passages=t.criteria.passageInZone.passages.map(t=>e[t.zone]?{zone:e[t.zone]}:null).filter(t=>!!t)),n.criteria.zone?n.criteria.zone.enable=!0:n.criteria.zone={enable:!0,zones:[]},n.validZone=(null===(i=n.criteria.zone)||void 0===i?void 0:i.zones.length)>0,SH(n.criteria),n}function MH(t){const e=uU(t);return t.criteria.zone&&(e.criteria.zone.zones=t.criteria.zone.zones.map(t=>t.id)),t.criteria.passageInZone&&(e.criteria.passageInZone.passages=t.criteria.passageInZone.passages.map(t=>({zone:t.zone.id}))),{id:e.id,name:e.name,active:e.active,criteria:e.criteria,color:e.color,enableDailyReport:e.enableDailyReport}}function TH(t){const e=+`0x${t.substr(1)}`;return[Math.round(e/65536)/256,Math.round(e/256%256)/256,Math.round(e%256)/256]}function IH(t){const e=+`0x${t.substr(1)}`;return[Math.round(e/65536),Math.round(e/256%256),Math.round(e%256)]}function PH(t,e){const i=+`0x${t.substr(1)}`,n=Math.min(Math.max(Math.round(i/65536)-e,0),255).toString(16),s=Math.min(Math.max(Math.round(i/256%256)-e,0),255).toString(16),r=Math.min(Math.max(Math.round(i%256)-e,0),255).toString(16);return`#${[1===n.length?`0${n}`:n,1===s.length?`0${s}`:s,1===r.length?`0${r}`:r].join(\"\")}`}let OH=(()=>{class t{constructor(t,e){this.mapConfigService=t,this.workerService=e,this.zones$=new Jp([]),this.zonesById={},this.selectedZone$=new Jp(null)}setZones(t){this.zonesById=t.reduce((t,e)=>(t[e.id]=e,t),{}),this.zones$.next(t)}refreshZones(){return Hp(this,void 0,void 0,function*(){const t=yield this.workerService.zones.list();return this.setZones(t),t})}clear(){this.zones$.next([])}createZone(t){return Hp(this,void 0,void 0,function*(){const e=Ij(t);let i;return i=t.group_id?yield this.workerService.zones.createGroupZone(t.group_id,e):yield this.workerService.zones.createPersonalZone(e),this.mapConfigService.enableWebsockets$.value||(yield this.refreshZones()),i})}updateZone(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.zones.update(Ij(t)),this.mapConfigService.enableWebsockets$.value||(yield this.refreshZones())})}deleteZone(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.zones.delete(t),this.mapConfigService.enableWebsockets$.value||(yield this.refreshZones())})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(qU),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const RH=[\"#ffffff\",[255,255,255]];let DH=(()=>{class t{constructor(t,e,i,n){this.mapConfigService=t,this.mapService=e,this.workerService=i,this.zonesService=n,this.alertRules$=new Jp([]),this.selectedAlertRuleId$=new Jp(null),this.selectedAlertRule$=new Jp(null),this.alertRulesNamesByZoneId={},this.alertRuleColorsById={},this.alertRules$.subscribe(t=>{this.alertRulesNamesByZoneId=t.reduce((t,e)=>{var i,n;const s=null===(i=e.criteria.zone)||void 0===i?void 0:i.zones;(null==s?void 0:s.length)&&s.forEach(i=>{let n=t[i.id];n||(n=t[i.id]=[]),n.push(e.name)});const r=null===(n=e.criteria.passageInZone)||void 0===n?void 0:n.passages;return(null==r?void 0:r.length)&&r.forEach(i=>{let n=t[i.zone.id];n||(n=t[i.zone.id]=[]),n.push(e.name)}),t},{}),this.alertRuleColorsById=t.reduce((t,e)=>(t[e.id]=[e.color,IH(e.color)],t),{})})}setAlertRules(t){this.alertRules$.next(t)}refreshAlertRules(){return Hp(this,void 0,void 0,function*(){const t=(yield this.workerService.alertRules.list()).map(t=>EH(t,this.zonesService.zonesById));return this.setAlertRules(t),t})}clear(){this.alertRules$.next([])}selectAlertRule(t){return Hp(this,void 0,void 0,function*(){this.selectedAlertRuleId$.next(t);const e=EH(yield this.workerService.alertRules.get(t),this.zonesService.zonesById);if(!this.selectedAlertRule$.value||e.id!==this.selectedAlertRule$.value.id){const t=function(t){return[].concat(t.criteria.passageInZone.enable?t.criteria.passageInZone.passages.flatMap(t=>t.zone.h3indexes):[]).concat(t.criteria.zone.enable?t.criteria.zone.zones.flatMap(t=>t.h3indexes):[])}(e);this.mapService.hasBooted$.value?t.length>0&&this.mapService.fitOnHexagons(t):(this.mapService.resetToDefaultView(),t.length>0&&setTimeout(()=>{this.mapService.fitOnHexagons(t,0)},50))}return this.selectedAlertRule$.next(e),e})}deselectAlertRule(){this.selectedAlertRuleId$.next(null),this.selectedAlertRule$.next(null)}updateAlertRulesFilter(t){this.mapConfigService.updateAlertRulesFilter(t)}createAlertRule(t){return Hp(this,void 0,void 0,function*(){const e=MH(t);let i;return i=t.group_id?yield this.workerService.alertRules.createGroupAlertRule(t.group_id,e):yield this.workerService.alertRules.createPersonalAlertRule(e),this.mapConfigService.enableWebsockets$.value||(yield this.refreshAlertRules()),i})}updateAlertRule(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.alertRules.update(MH(t)),this.mapConfigService.enableWebsockets$.value||(yield this.refreshAlertRules())})}deleteAlertRule(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.alertRules.delete(t),this.mapConfigService.enableWebsockets$.value||(yield this.refreshAlertRules())})}getAlertRuleColor(t){return this.alertRuleColorsById[t]||RH}}return t.\\u0275fac=function(e){return new(e||t)(Mn(qU),Mn(Pj),Mn(sH),Mn(OH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),LH=(()=>{class t{constructor(){this.alerts$=new Jp([])}updateAlerts(t){this.alerts$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const FH=[{key:\"LineString\",name:\"Ligne\"},{key:\"Point\",name:\"Point\"},{key:\"Polygon\",name:\"Zone\"},{key:\"Circle\",name:\"Cercle\"}];var NH=(()=>(function(t){t.Aircraft=\"aircraft\",t.AircraftPosition=\"aircraft-position\",t.Alert=\"alert\",t.Annotation=\"annotation\",t.Event=\"event\",t.PortClickEvent=\"port-click-event\",t.Ship=\"ship\",t.ShipPosition=\"ship-position\",t.H3Element=\"h3element\"}(NH||(NH={})),NH))();let BH=(()=>{class t{constructor(t,e){this.mapConfigService=t,this.workerService=e,this.annotations$=new Jp([]),this.editedAnnotation$=new Jp(null),this.editedAnnotationGeomType$=new Jp(\"Point\"),this.annotationsVisibilityById={},this.annotationsVisibilityById=this.mapConfigService.annotationsVisibilityById$.value,this.editedAnnotation$.pipe(kf(1),Af(t=>t&&!!t.geom),M(t=>t.geom.type),Tf()).subscribe(t=>{this.editedAnnotationGeomType$.next(t)})}setAnnotations(t){let e=!1;t.forEach(t=>{let i=this.annotationsVisibilityById[t.id];void 0===i&&(i=this.mapConfigService.defaultAnnotationVisibility$.value,this.annotationsVisibilityById[t.id]=i,e=!0),t.visible=i}),e&&this.mapConfigService.updateAnnotationsVisilityById(this.annotationsVisibilityById),this.annotations$.next(t)}refreshAnnotations(){return Hp(this,void 0,void 0,function*(){const t=yield this.workerService.annotations.list();return this.setAnnotations(t),t})}clear(){this.annotations$.next([])}createNewAnnotation(t,e){const i={kind:NH.Annotation,name:\"\",description:\"\",color:\"#c3267d\",geom:e};e&&(i.lon=e.coordinates[0],i.lat=e.coordinates[1]),t&&(i.group_id=t),this.editedAnnotation$.next(i)}updateEditedAnnotationGeom(t){const e=this.editedAnnotation$.value;if(e.geom=t,t)switch(t.type){case\"Point\":t.coordinates=t.coordinates.map(t=>cU(t,9));break;case\"LineString\":t.coordinates=t.coordinates.map(t=>t.map(t=>cU(t,9)));break;case\"Polygon\":t.coordinates[0]=t.coordinates[0].map(t=>t.map(t=>cU(t,9)));break;case\"Circle\":t.center=t.center.map(t=>cU(t,9)),t.radius=cU(t.radius,9)}this.editedAnnotation$.next(e)}editAnnotation(t){this.editedAnnotation$.next(uU(t))}refreshEditedAnnotation(){this.editedAnnotation$.next(this.editedAnnotation$.value)}cancelEditing(){this.editedAnnotation$.next(null),this.annotations$.next(this.annotations$.value)}saveEditedAnnotation(){return Hp(this,void 0,void 0,function*(){const t=this.editedAnnotation$.value,e=function(t){return{id:t.id,name:t.name,description:t.description,geom:t.geom,color:t.color}}(t);t.id?yield this.workerService.annotations.update(e):t.group_id?yield this.workerService.annotations.createGroupAnnotation(t.group_id,e):yield this.workerService.annotations.createAnnotation(e),this.mapConfigService.enableWebsockets$.value||(yield this.refreshAnnotations()),this.editedAnnotation$.next(null)})}deleteAnnotation(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.annotations.delete(t),this.mapConfigService.enableWebsockets$.value||(yield this.refreshAnnotations())})}toggleAnnotationVisiblity(t){t.visible=!t.visible,this.annotationsVisibilityById[t.id]=t.visible,this.mapConfigService.updateAnnotationsVisilityById(this.annotationsVisibilityById),this.annotations$.next(this.annotations$.value)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(qU),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),zH=(()=>{class t{constructor(){this.drawingZoneMode$=new Jp(!1),this.drawingZoneHexagonsCache={},this.hexagons$=new Jp([]),this.selectHexagon$=new C,this.selectHexagon$.subscribe(t=>{this.drawingZoneHexagonsCache[t]?(sB({category:\"app\",message:\"drawing: unselect-hexagon\"}),delete this.drawingZoneHexagonsCache[t]):(sB({category:\"app\",message:\"drawing: select-hexagon\"}),this.drawingZoneHexagonsCache[t]=!0),this.updateZones(Object.keys(this.drawingZoneHexagonsCache))})}updateZones(t){(0!==t.length||0!==this.hexagons$.value.length)&&this.hexagons$.next(t)}clearZones(){this.updateZones([])}editZone(t){return this.drawingZoneMode$.next(!0),this.drawingZoneHexagonsCache={},t.forEach(t=>{this.drawingZoneHexagonsCache[t]=!0}),this.hexagons$.next(t),this.hexagons$}stopEditingZone(){this.drawingZoneMode$.next(!1),this.clearZones()}selectHexagon(t){this.selectHexagon$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const VH=[{label:\"Perte signal AIS\",color:PH(\"#ff272d\",20)},{label:\"Changement d'informations\",color:PH(\"#e1cf15\",20)},{label:\"Spoofing\",color:PH(\"#ff29ff\",20)},{label:\"Position tr\\xe8s \\xe9loign\\xe9e\",color:PH(\"#0623c9\",20)},{label:\"Position d\\xe9cal\\xe9e\",color:PH(\"#a07149\",20)},{label:\"Entr\\xe9e/Sortie de zone\",color:PH(\"#78f48b\",20)},{label:\"Route erratique\",color:PH(\"#f78851\",20)},{label:\"Transbordement\",color:PH(\"#5910d0\",20)}],$H=[{key:1,label:\"Perte signal AIS\",color:\"#ff272d\"},{key:101,label:\"Modification infos navire\",color:\"#e1cf15\"},{key:102,label:\"IMO invalide\",color:\"#ff29ff\"},{key:103,label:\"Callsign invalide\",color:\"#ff29ff\"},{key:110,label:\"Spoofing\",color:\"#ff29ff\"},{key:201,label:\"Modification infos voyage\",color:\"#e1cf15\"},{key:301,label:\"Position tr\\xe8s \\xe9loign\\xe9e\",color:\"#0623c9\"},{key:302,label:\"Modification statut\",color:\"#e1cf15\"},{key:307,label:\"Position d\\xe9cal\\xe9e\",color:\"#a07149\"},{key:401,label:\"Entr\\xe9e zone\",color:\"#78f48b\"},{key:402,label:\"Sortie zone\",color:\"#78f48b\"},{key:403,label:\"Route erratique\",color:\"#f78851\"},{key:404,label:\"Transbordement\",color:\"#5910d0\"}];$H.forEach(t=>{t.textColor=PH(t.color,20)});const UH=$H.reduce((t,e)=>(t[e.key]=e.label,t),{}),jH=$H.reduce((t,e)=>(t[e.key]=e,t),{});var HH=(()=>(function(t){t[t.AISCommLoss=1]=\"AISCommLoss\",t[t.ShipIdChanged=101]=\"ShipIdChanged\",t[t.InvalidImo=102]=\"InvalidImo\",t[t.InvalidCallsign=103]=\"InvalidCallsign\",t[t.Spoofing=110]=\"Spoofing\",t[t.VoyageChanged=201]=\"VoyageChanged\",t[t.VoyageDestination=202]=\"VoyageDestination\",t[t.VoyageETA=203]=\"VoyageETA\",t[t.PositionDubious=301]=\"PositionDubious\",t[t.StatusChanged=302]=\"StatusChanged\",t[t.VectorCheck=307]=\"VectorCheck\",t[t.MoveZoneEntry=401]=\"MoveZoneEntry\",t[t.MoveZoneExit=402]=\"MoveZoneExit\",t[t.MoveErratic=403]=\"MoveErratic\",t[t.MoveMeetingAtSea=404]=\"MoveMeetingAtSea\"}(HH||(HH={})),HH))();class GH{constructor(t,e,i,n){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=i,this.scheduler=n}call(t,e){return e.subscribe(new qH(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))}}class WH{constructor(){this.buffer=[]}}class qH extends g{constructor(t,e,i,n,s){super(t),this.bufferTimeSpan=e,this.bufferCreationInterval=i,this.maxBufferSize=n,this.scheduler=s,this.contexts=[];const r=this.openContext();if(this.timespanOnly=null==i||i<0,this.timespanOnly)this.add(r.closeAction=s.schedule(YH,e,{subscriber:this,context:r,bufferTimeSpan:e}));else{const t={bufferTimeSpan:e,bufferCreationInterval:i,subscriber:this,scheduler:s};this.add(r.closeAction=s.schedule(KH,e,{subscriber:this,context:r})),this.add(s.schedule(ZH,i,t))}}_next(t){const e=this.contexts,i=e.length;let n;for(let s=0;s<i;s++){const i=e[s],r=i.buffer;r.push(t),r.length==this.maxBufferSize&&(n=i)}n&&this.onBufferFull(n)}_error(t){this.contexts.length=0,super._error(t)}_complete(){const{contexts:t,destination:e}=this;for(;t.length>0;){const i=t.shift();e.next(i.buffer)}super._complete()}_unsubscribe(){this.contexts=null}onBufferFull(t){this.closeContext(t);const e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();const e=this.bufferTimeSpan;this.add(t.closeAction=this.scheduler.schedule(YH,e,{subscriber:this,context:t,bufferTimeSpan:e}))}}openContext(){const t=new WH;return this.contexts.push(t),t}closeContext(t){this.destination.next(t.buffer);const e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)}}function YH(t){const e=t.subscriber,i=t.context;i&&e.closeContext(i),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function ZH(t){const{bufferCreationInterval:e,bufferTimeSpan:i,subscriber:n,scheduler:s}=t,r=n.openContext();n.closed||(n.add(r.closeAction=s.schedule(KH,i,{subscriber:n,context:r})),this.schedule(t,e))}function KH(t){const{subscriber:e,context:i}=t;e.closeContext(i)}function XH(t,e){const i=t.findIndex(e);return-1!==i?t.slice(i):[]}function QH(t){const e=t.routerState.snapshot.url;return e.startsWith(\"/fleets/\")&&!e.startsWith(\"/fleets/new\")?e.substring(0,44):\"\"}let JH=(()=>{class t{constructor(){this.events$=new Jp([])}clear(){this.events$.next([])}updateEvents(t){this.events$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),tG=(()=>{class t{constructor(){this.trails$=new Jp([])}clear(){this.trails$.next([])}updateTrails(t){this.trails$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),eG=(()=>{class t{constructor(){this.active$=new Jp(!1)}toggleMeasureMode(){this.active$.next(!this.active$.value)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const iG=[\"#1e88e5\",\"#5e35b1\",\"#64b5f6\",\"#311b92\",\"#d1c4e9\",\"#9575cd\",\"#1a237e\",\"#1e88e5\",\"#bbdefb\",\"#3949ab\",\"#7986cb\"],nG=iG.map(t=>IH(t)),sG=[\"#900C3F\",\"#FF5733\",\"#3D3D6B\",\"#FFC300\",\"#511849\",\"#FF8D1A\",\"#2A7B9B\",\"#C70039\",\"#44be77\",\"#c4b320\",\"#00BAAD\",\"#7a9b38\"];function rG(t,e){const i=Object.assign(Object.assign({type:\"port-edition\"},uU(t)),{color:null==e?void 0:e.color,oldPort:e});return oG(i),i}function oG(t){if(\"port-edition\"!==t.type||!t.oldPort)return;const e=t.h3indexes.filter(e=>!t.oldPort.h3indexes.includes(e)),i=t.oldPort.h3indexes.filter(e=>!t.h3indexes.includes(e));t.labelChanged=t.label!==t.oldPort.label,t.iso3Changed=t.iso3!==t.oldPort.iso3,t.h3indexesChanged=e.length>0||i.length>0,t.h3indexesAddedCount=e.length,t.h3indexesRemovedCount=i.length,t.changed=t.labelChanged||t.iso3Changed||t.h3indexesChanged}function aG(t){return{type:t.type,id:t.id,label:t.label,iso3:t.iso3,h3indexes:t.h3indexes}}const lG={draft:{label:\"Brouillon\",bgColor:\"#989898\"},pending:{label:\"En attente\",bgColor:\"#5787ff\"},validated:{label:\"Valid\\xe9\",bgColor:\"#0d7d0d\"},refused:{label:\"Refus\\xe9\",bgColor:\"#b91515\"}},cG=new Array(6);function hG(t){return dG(t,1,0,0,1,0,0)}function uG(t,e){const i=t[0],n=t[1],s=t[2],r=t[3],o=t[4],a=t[5],l=e[0],c=e[1],h=e[2],u=e[3],d=e[4],p=e[5];return t[0]=i*l+s*c,t[1]=n*l+r*c,t[2]=i*h+s*u,t[3]=n*h+r*u,t[4]=i*d+s*p+o,t[5]=n*d+r*p+a,t}function dG(t,e,i,n,s,r,o){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t[4]=r,t[5]=o,t}function pG(t,e){const i=e[0],n=e[1];return e[0]=t[0]*i+t[2]*n+t[4],e[1]=t[1]*i+t[3]*n+t[5],e}function fG(t,e,i){return uG(t,dG(cG,1,0,0,1,e,i))}function mG(t,e,i,n,s,r,o,a){const l=Math.sin(r),c=Math.cos(r);return t[0]=n*c,t[1]=s*l,t[2]=-n*l,t[3]=s*c,t[4]=o*n*c-a*n*l+e,t[5]=o*s*l+a*s*c+i,t}function gG(t,e){const i=function(t){return t[0]*t[3]-t[1]*t[2]}(e);sz(0!==i,32);const n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5];return t[0]=o/i,t[1]=-s/i,t[2]=-r/i,t[3]=n/i,t[4]=(r*l-o*a)/i,t[5]=-(n*l-s*a)/i,t}let AG;function vG(t){const e=\"matrix(\"+t.join(\", \")+\")\";if(VB)return e;const i=AG||(AG=document.createElement(\"div\"));return i.style.transform=e,i.style.transform}function _G(t,e,i,n,s,r){r=r||[];let o=0;for(let a=e;a<i;a+=n){const e=t[a],i=t[a+1];r[o++]=s[0]*e+s[2]*i+s[4],r[o++]=s[1]*e+s[3]*i+s[5]}return r&&r.length!=o&&(r.length=o),r}function bG(t,e,i,n,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),c=r[0],h=r[1];let u=0;for(let d=e;d<i;d+=n){const e=t[d]-c,i=t[d+1]-h;o[u++]=c+e*a-i*l,o[u++]=h+e*l+i*a;for(let s=d+2;s<d+n;++s)o[u++]=t[s]}return o&&o.length!=u&&(o.length=u),o}function yG(t,e,i,n,s,r,o){o=o||[];let a=0;for(let l=e;l<i;l+=n){o[a++]=t[l]+s,o[a++]=t[l+1]+r;for(let e=l+2;e<l+n;++e)o[a++]=t[e]}return o&&o.length!=a&&(o.length=a),o}const wG=[1,0,0,1,0,0];var xG=class extends r${constructor(){super(),this.extent_=[1/0,1/0,-1/0,-1/0],this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=function(t){let e,i,n,s=!1;return function(){const r=Array.prototype.slice.call(arguments);return(!s||this!==n||!_B(r,i))&&(s=!0,n=this,i=r,e=t.apply(this,arguments)),e}}(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return kB()}closestPointXY(t,e,i,n){return kB()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return this.closestPointXY(t[0],t[1],e=e||[NaN,NaN],1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return kB()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&fz(t),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}rotate(t,e){kB()}scale(t,e,i){kB()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return kB()}getType(){return kB()}applyTransform(t){kB()}intersectsExtent(t){return kB()}translate(t,e){kB()}transform(t,e){const i=EV(t),n=\"tile-pixels\"==i.getUnits()?function(t,n,s){const r=i.getExtent(),o=i.getWorldExtent(),a=Iz(o)/Iz(r);return mG(wG,o[0],o[3],a,-a,0,0,0),_G(t,0,t.length,s,wG,n),LV(i,e)(t,n,s)}:LV(i,e);return this.applyTransform(n),this}};function SG(t){let e;return\"XY\"==t?e=2:\"XYZ\"==t||\"XYM\"==t?e=3:\"XYZM\"==t&&(e=4),e}var CG=class extends xG{constructor(){super(),this.layout=\"XY\",this.stride=2,this.flatCoordinates=null}computeExtent(t){return gz(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return kB()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=SG(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){kB()}setLayout(t,e,i){let n;if(t)n=SG(t);else{for(let t=0;t<i;++t){if(0===e.length)return this.layout=\"XY\",void(this.stride=2);e=e[0]}n=e.length,t=function(t){let e;return 2==t?e=\"XY\":3==t?e=\"XYZ\":4==t&&(e=\"XYZM\"),e}(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();bG(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){void 0===e&&(e=t),i||(i=kz(this.getExtent()));const n=this.getFlatCoordinates();if(n){const s=this.getStride();(function(t,e,i,n,s,r,o,a){a=a||[];const l=o[0],c=o[1];let h=0;for(let u=0;u<i;u+=n){const e=t[u+1]-c;a[h++]=l+s*(t[u]-l),a[h++]=c+r*e;for(let i=u+2;i<u+n;++i)a[h++]=t[i]}a&&a.length!=h&&(a.length=h)})(n,0,n.length,s,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();yG(i,0,i.length,n,t,e,i),this.changed()}}};function kG(t,e,i,n,s,r,o){const a=t[e],l=t[e+1],c=t[i]-a,h=t[i+1]-l;let u;if(0===c&&0===h)u=e;else{const d=((s-a)*c+(r-l)*h)/(c*c+h*h);if(d>1)u=i;else{if(d>0){for(let s=0;s<n;++s)o[s]=oV(t[e+s],t[i+s],d);return void(o.length=n)}u=e}}for(let d=0;d<n;++d)o[d]=t[u+d];o.length=n}function EG(t,e,i,n,s){let r=t[e],o=t[e+1];for(e+=n;e<i;e+=n){const i=t[e],n=t[e+1],a=iV(r,o,i,n);a>s&&(s=a),r=i,o=n}return s}function MG(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const o=i[r];s=EG(t,e,o,n,s),e=o}return s}function TG(t,e,i,n,s,r,o,a,l,c,h){if(e==i)return c;let u,d;if(0===s){if(d=iV(o,a,t[e],t[e+1]),d<c){for(u=0;u<n;++u)l[u]=t[e+u];return l.length=n,d}return c}h=h||[NaN,NaN];let p=e+n;for(;p<i;)if(kG(t,p-n,p,n,o,a,h),d=iV(o,a,h[0],h[1]),d<c){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n,p+=n}else p+=n*Math.max((Math.sqrt(d)-Math.sqrt(c))/s|0,1);if(r&&(kG(t,i-n,e,n,o,a,h),d=iV(o,a,h[0],h[1]),d<c)){for(c=d,u=0;u<n;++u)l[u]=h[u];l.length=n}return c}function IG(t,e,i,n,s,r,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=i.length;u<d;++u){const d=i[u];c=TG(t,e,d,n,s,r,o,a,l,c,h),e=d}return c}function PG(t,e,i,n){for(let s=0,r=i.length;s<r;++s)t[e++]=i[s];return e}function OG(t,e,i,n){for(let s=0,r=i.length;s<r;++s){const r=i[s];for(let i=0;i<n;++i)t[e++]=r[i]}return e}function RG(t,e,i,n,s){s=s||[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=OG(t,e,i[o],n);s[r++]=a,e=a}return s.length=r,s}function DG(t,e,i,n,s,r,o){const a=(i-e)/n;if(a<3){for(;e<i;e+=n)r[o++]=t[e],r[o++]=t[e+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const c=[e,i-n];let h=0;for(;c.length>0;){const i=c.pop(),r=c.pop();let o=0;const a=t[r],u=t[r+1],d=t[i],p=t[i+1];for(let e=r+n;e<i;e+=n){const i=eV(t[e],t[e+1],a,u,d,p);i>o&&(h=e,o=i)}o>s&&(l[(h-e)/n]=1,r+n<h&&c.push(r,h),h+n<i&&c.push(h,i))}for(let u=0;u<a;++u)l[u]&&(r[o++]=t[e+u*n],r[o++]=t[e+u*n+1]);return o}function LG(t,e){return e*Math.round(t/e)}function FG(t,e,i,n,s,r,o){if(e==i)return o;let a,l,c=LG(t[e],s),h=LG(t[e+1],s);e+=n,r[o++]=c,r[o++]=h;do{if(a=LG(t[e],s),l=LG(t[e+1],s),(e+=n)==i)return r[o++]=a,r[o++]=l,o}while(a==c&&l==h);for(;e<i;){const i=LG(t[e],s),u=LG(t[e+1],s);if(e+=n,i==a&&u==l)continue;const d=a-c,p=l-h,f=i-c,m=u-h;d*m==p*f&&(d<0&&f<d||d==f||d>0&&f>d)&&(p<0&&m<p||p==m||p>0&&m>p)?(a=i,l=u):(r[o++]=a,r[o++]=l,c=a,h=l,a=i,l=u)}return r[o++]=a,r[o++]=l,o}function NG(t,e,i,n,s,r,o,a){for(let l=0,c=i.length;l<c;++l){const c=i[l];o=FG(t,e,c,n,s,r,o),a.push(o),e=c}return o}function BG(t,e,i,n,s){s=void 0!==s?s:[];let r=0;for(let o=e;o<i;o+=n)s[r++]=t.slice(o,o+n);return s.length=r,s}function zG(t,e,i,n,s){s=void 0!==s?s:[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];s[r++]=BG(t,e,a,n,s[r]),e=a}return s.length=r,s}function VG(t,e,i,n,s){s=void 0!==s?s:[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=i[o];s[r++]=1===a.length&&a[0]===e?[]:zG(t,e,a,n,s[r]),e=a[a.length-1]}return s.length=r,s}function $G(t,e,i,n){let s=0,r=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];s+=o*i-r*n,r=i,o=n}return s/2}function UG(t,e,i,n){let s=0;for(let r=0,o=i.length;r<o;++r){const o=i[r];s+=$G(t,e,o,n),e=o}return s}class jG extends CG{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}clone(){return new jG(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<lz(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(EG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),TG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return $G(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return BG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=DG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new jG(e,\"XY\")}getType(){return\"LinearRing\"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=OG(this.flatCoordinates,0,t,this.stride),this.changed()}}var HG=jG;class GG extends CG{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new GG(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const s=this.flatCoordinates,r=iV(t,e,s[0],s[1]);if(r<n){const t=this.stride;for(let e=0;e<t;++e)i[e]=s[e];return i.length=t,r}return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return mz(this.flatCoordinates,t)}getType(){return\"Point\"}intersectsExtent(t){return uz(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=PG(this.flatCoordinates,0,t),this.changed()}}var WG=GG;function qG(t,e,i,n,s,r,o){let a,l,c,h,u,d,p;const f=s[r+1],m=[];for(let v=0,_=i.length;v<_;++v){const s=i[v];for(h=t[s-n],d=t[s-n+1],a=e;a<s;a+=n)u=t[a],p=t[a+1],(f<=d&&p<=f||d<=f&&f<=p)&&(c=(f-d)/(p-d)*(u-h)+h,m.push(c)),h=u,d=p}let g=NaN,A=-1/0;for(m.sort(mB),h=m[0],a=1,l=m.length;a<l;++a){u=m[a];const s=Math.abs(u-h);s>A&&(c=(h+u)/2,f$(t,e,i,n,c,f)&&(g=c,A=s)),h=u}return isNaN(g)&&(g=s[r]),o?(o.push(g,f,A),o):[g,f,A]}function YG(t,e,i,n){for(;e<i-n;){for(let s=0;s<n;++s){const r=t[e+s];t[e+s]=t[i-n+s],t[i-n+s]=r}e+=n,i-=n}}function ZG(t,e,i,n){let s=0,r=t[i-n],o=t[i-n+1];for(;e<i;e+=n){const i=t[e],n=t[e+1];s+=(i-r)*(n+o),r=i,o=n}return 0===s?void 0:s>0}function KG(t,e,i,n,s){s=void 0!==s&&s;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=ZG(t,e,o,n);if(0===r){if(s&&a||!s&&!a)return!1}else if(s&&!a||!s&&a)return!1;e=o}return!0}function XG(t,e,i,n,s){s=void 0!==s&&s;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=ZG(t,e,o,n);(0===r?s&&a||!s&&!a:s&&!a||!s&&a)&&YG(t,e,o,n),e=o}return e}function QG(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r)e=XG(t,e,i[r],n,s);return e}class JG extends CG{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==e&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?vB(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new JG(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<lz(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(MG(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),IG(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return f$(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return UG(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),XG(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,zG(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=kz(this.getExtent());this.flatInteriorPoint_=qG(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new WG(this.getFlatInteriorPoint(),\"XYM\")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new HG(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let s=0;for(let r=0,o=i.length;r<o;++r){const o=i[r],a=new HG(e.slice(s,o),t);n.push(a),s=o}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;KG(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=XG(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=NG(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new JG(e,\"XY\",i)}getType(){return\"Polygon\"}intersectsExtent(t){return A$(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=RG(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}var tW=JG;function eW(t,e,i,n){i=i||32;const s=[];for(let r=0;r<i;++r)vB(s,yV(t,e,2*Math.PI*r/i,n));return s.push(s[0],s[1]),new JG(s,\"XY\",[s.length])}function iW(t){const e=t[0],i=t[1],n=t[2],s=t[3],r=[e,i,e,s,n,s,n,i,e,i];return new JG(r,\"XY\",[r.length])}function nW(t,e,i){e=e||32;const n=t.getStride(),s=t.getLayout(),r=t.getCenter(),o=n*(e+1),a=new Array(o);for(let c=0;c<o;c+=n){a[c]=0,a[c+1]=0;for(let t=2;t<n;t++)a[c+t]=r[t]}const l=new JG(a,s,[a.length]);return function(t,e,i,n){const s=t.getFlatCoordinates(),r=t.getStride(),o=s.length/r-1,a=n||0;for(let l=0;l<=o;++l){const t=l*r,n=a+2*rV(l,o)*Math.PI/o;s[t]=e[0]+i*Math.cos(n),s[t+1]=e[1]+i*Math.sin(n)}t.changed()}(l,r,t.getRadius(),i),l}const sW=[[8.384360674740835,87.82361750161175],[145.5581976913369,87.3646953231962],[-325.5581976913369,87.82361750161175],[-215.5581976913369,87.82361750161175],[-161.8917180108592,84.22628942426208],[-125.29445893479551,82.48154130920918],[-90.38109747487815,82.85349004122665],[-51.70487751530814,84.93555635380527],[8.384360674740835,87.82361750161175]],rW=[[-214.4418023086631,87.3646953231962],[-163.45686807900947,76.14556732608256],[-131.70883908792965,69.37134141076518],[-100.821870205822,67.53592431503803],[-66.90449925088507,72.20470505499345],[-34.75841798028466,81.27137179020501],[-214.4418023086631,87.3646953231962]];function oW(t){let e=bj(t,!0);return e=\"81033ffffffffff\"===t?sW:\"8003fffffffffff\"===t?rW:aW(e),new tW([e.map(t=>PV(t))])}function aW(t){const e=t[0][0],i=t[0][1];return t.map(([t,n])=>(Math.abs(t-e)>180&&(e>0?t+=360:t-=360),Math.abs(n-i)>90&&(i>0?n+=180:n-=180),[t,n]))}function lW(t){const e=aW(Ej(t,!0)),i=Sj(t),[n]=FU([_j(i).reverse()],e[0]);3===e.length&&e.splice(1,1);let s=e[0],r=e[1];return s=cW(s[0],s[1],n[0],n[1],.15),r=cW(r[0],r[1],n[0],n[1],.15),e.push(r),e.push(s),e}function cW(t,e,i,n,s){return[t+(i-t)*s,e+(n-e)*s]}function hW(t){if(t.length<2)return!1;for(let e=0;e<t.length;e++)for(let i=e+1;i<t.length;i++){const n=t[i];if(t[e].some(t=>n.some(e=>zU(t,e))))return[e,i]}return!1}function uW(t){const e=t.reduce((t,e)=>{let i=t[vj(e)];return i||(i=t[vj(e)]=[]),i.push(e),t},{});return Object.keys(e).sort().reverse().forEach(t=>{const i=e[t],n=function(t){if(!t||!t.length)return[];var e=t.length,i=KU._calloc(e,JU);!function(t,e){for(var i=e.length,n=0;n<i;n++)dj(e[n],t,n)}(i,t);var n=KU._calloc(e,JU);if(0!==QU.compact(i,n,e))throw KU._free(i),KU._free(n),new Error(\"Failed to compact, malformed input data (duplicate hexagons?)\");var s=pj(n,e);return KU._free(i),KU._free(n),s}(i);i.length!==n&&(e[t]=[],n.forEach(t=>{let i=e[vj(t)];i||(i=e[vj(t)]=[]),i.push(t)}))}),Object.values(e).flat()}let dW=(()=>{class t{constructor(t,e){this.mapConfigService=t,this.workerService=e,this.modifications$=new Jp(null),this.hasBeenFetched=!1,this.modificationsPanelState$=new Jp({sortChronologically:!1,showValidated:!1})}refreshModifications(){return Hp(this,void 0,void 0,function*(){const t=yield this.workerService.modifications.listModifications();this.hasBeenFetched=!0,this.modifications$.next(t)})}clear(){this.modifications$.next([])}createModification(t){return Hp(this,void 0,void 0,function*(){const e=yield this.workerService.modifications.createModification(t);return this.mapConfigService.enableWebsockets$.value||(yield this.refreshModifications()),e})}updateModification(t,e){return Hp(this,void 0,void 0,function*(){yield this.workerService.modifications.updateModification(t,e),this.mapConfigService.enableWebsockets$.value||(yield this.refreshModifications())})}publishModification(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.modifications.publishModification(t),this.mapConfigService.enableWebsockets$.value||(yield this.refreshModifications())})}refuseModification(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.modifications.refuseModification(t),this.mapConfigService.enableWebsockets$.value||(yield this.refreshModifications())})}validateModification(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.modifications.validateModification(t),this.mapConfigService.enableWebsockets$.value||(yield this.refreshModifications())})}toggleSortChronologically(){this.modificationsPanelState$.value.sortChronologically=!this.modificationsPanelState$.value.sortChronologically,this.modificationsPanelState$.next(this.modificationsPanelState$.value)}toggleShowValidated(){this.modificationsPanelState$.value.showValidated=!this.modificationsPanelState$.value.showValidated,this.modificationsPanelState$.next(this.modificationsPanelState$.value)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(qU),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),pW=(()=>{class t{constructor(){this.portById$=new Jp(null),this.visiblePorts$=new Jp(null),this.excludedPortsIds$=new Jp([])}updatePortById(t){this.portById$.next(t?t.reduce((t,e)=>(t[e.id]=e,t),{}):null)}updateVisiblePorts(t){this.visiblePorts$.next(t)}updateExcludedPortsIds(t){this.excludedPortsIds$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),fW=(()=>{class t{constructor(t,e){this.modificationsService=t,this.portsStateService=e,this.modification$=new Jp(null),this.previewChanges$=new Jp(!0),this.portEdition$=new Jp(null),this.visiblePorts$=new Jp(null),this.portEdition$.pipe(Af(t=>!!t&&\"port-edition\"===t.type)).subscribe(t=>{oG(t)}),JT([this.modification$.pipe(M(t=>t?t.data.map(t=>t.id):[])),this.portEdition$.pipe(M(t=>null==t?void 0:t.id),Tf(),M(t=>t?[t]:[])),this.previewChanges$]).pipe(M(([t,e,i])=>i?[t,e]:[]),M(t=>t.flat().filter(t=>!t.startsWith(\"new-\")))).subscribe(t=>{this.portsStateService.updateExcludedPortsIds(t)}),this.modification$.pipe(M(t=>{var e;return null===(e=t)||void 0===e?void 0:e.id}),Tf()).subscribe(t=>{var e;null===(e=this.modificationsSubscription)||void 0===e||e.unsubscribe(),t&&(this.modificationsSubscription=this.modificationsService.modifications$.subscribe(()=>Hp(this,void 0,void 0,function*(){try{yield this.viewModification(t)}catch(e){if(\"Modification inconnue\"!==e.message)throw e}})))})}initModification(t){return Hp(this,void 0,void 0,function*(){this.modification$.next({type:t,data:[]})})}viewModification(t){return Hp(this,void 0,void 0,function*(){const[e,i,n]=yield Promise.all([this.modificationsService.modifications$.pipe(Af(t=>!!t),FO()).toPromise(),this.portsStateService.portById$.pipe(Af(t=>!!t),FO()).toPromise(),this.portsStateService.visiblePorts$.pipe(Af(t=>!!t),FO()).toPromise()]),s=uU(e.find(e=>e.id===t));if(!s)throw new Error(\"Modification inconnue\");const r=n.map(t=>t.color);s.data=s.data.map(t=>{if(\"port-creation\"===t.type){const e=parseInt(t.id.substring(4),10);t.color=sG.find(t=>!r.includes(t))||sG[e%sG.length],r.push(t.color)}return function(t,e){const i=Object.assign(Object.assign({},uU(t)),{color:(null==t?void 0:t.color)||(null==e?void 0:e.color)||sG[0],oldPort:e});return oG(i),i}(t,i[t.id])}),this.modification$.next(s)})}clear(){this.modification$.next(null),this.portEdition$.next(null)}initializePortCreation(){this.portEdition$.next(this.newPortCreation())}newPortCreation(){var t;const e=this.portsStateService.visiblePorts$.value,i=e.map(t=>t.color).concat(this.modification$.value.data.map(t=>t.color)),n=this.modification$.value.data.filter(t=>\"port-creation\"===t.type).map(t=>parseInt(t.id.substring(4),10)).reduce((t,e)=>e>t?e:t,0)+1;return{type:\"port-creation\",id:`new-${n}`,label:\"\",iso3:(null===(t=e[0])||void 0===t?void 0:t.iso3)||\"\",h3indexes:[],color:sG.find(t=>!i.includes(t))||sG[n%sG.length]}}editPort(t){const e=this.modification$.value.data.find(e=>e.id===t.id);this.portEdition$.next(e?rG(e,this.portsStateService.portById$.value[t.id]):rG(t,t)),this.previewChanges$.value||this.previewChanges$.next(!0)}editPortEdition(t){this.portEdition$.next(uU(t))}cancelEditedPort(){this.portEdition$.next(null)}revertEditedPort(){this.revertPortEdition(this.portEdition$.value)}revertPortEdition(t){const e=t,i=this.modification$.value.data.findIndex(t=>t.id===e.id);-1!==i&&(this.modification$.value.data.splice(i,1),this.triggerModificationChange()),this.portEdition$.next(null)}saveEditedPort(){const t=this.portEdition$.value,e=this.modification$.value.data.findIndex(e=>e.id===t.id);-1!==e?(\"port-edition\"===t.type&&t.changed||\"port-creation\"===t.type?(t.h3indexes=uW(t.h3indexes),oG(t),this.modification$.value.data[e]=t):this.modification$.value.data.splice(e,1),this.triggerModificationChange()):(\"port-edition\"===t.type&&(t.changed||!t.oldPort)||\"port-creation\"===t.type)&&(t.h3indexes=uW(t.h3indexes),oG(t),this.modification$.value.data.push(t),this.triggerModificationChange()),this.portEdition$.next(null)}deleteEditedPort(){const t=this.portEdition$.value,e=this.modification$.value.data.findIndex(e=>e.id===t.id);if(-1!==e){const t=this.modification$.value.data[e];\"port-edition\"===t.type&&t.oldPort?this.modification$.value.data[e]=Object.assign(Object.assign({},this.modification$.value.data[e]),{type:\"port-deletion\"}):this.modification$.value.data.splice(e,1)}else this.portEdition$.value.oldPort&&this.modification$.value.data.push(function(t){return Object.assign({type:\"port-deletion\"},uU(t))}(this.portEdition$.value.oldPort));this.portEdition$.next(null),this.triggerModificationChange()}renameEditedPort(t){this.portEdition$.value.label=t,this.triggerPortEditionChange()}updateEditedPortISO3(t){this.portEdition$.value.iso3=t,this.triggerPortEditionChange()}addHexagonToPort(t){this.portEdition$.value.h3indexes.includes(t)||(this.portEdition$.value.h3indexes.push(t),this.triggerPortEditionChange())}removeHexagonFromPort(t){this.portEdition$.value.h3indexes=this.portEdition$.value.h3indexes.filter(e=>e!==t),this.triggerPortEditionChange()}togglePreviewChanges(){this.previewChanges$.next(!this.previewChanges$.value)}triggerPortEditionChange(){this.portEdition$.next(this.portEdition$.value)}triggerModificationChange(){const t=this.portsStateService.portById$.value||{},e=this.modification$.value;e&&e.data.filter(t=>\"port-creation\"!==t.type).forEach(e=>{e.oldPort=t[e.id]}),this.modification$.next(e)}updateVisiblePorts(t){this.visiblePorts$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(dW),Mn(pW))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function mW(t,e){if(e.length<t)throw new TypeError(t+\" argument\"+(t>1?\"s\":\"\")+\" required, but only \"+e.length+\" present\")}function gW(t){return mW(1,arguments),t instanceof Date||\"object\"==typeof t&&\"[object Date]\"===Object.prototype.toString.call(t)}function AW(t){mW(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||\"object\"==typeof t&&\"[object Date]\"===e?new Date(t.getTime()):\"number\"==typeof t||\"[object Number]\"===e?new Date(t):((\"string\"==typeof t||\"[object String]\"===e)&&\"undefined\"!=typeof console&&(console.warn(\"Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule\"),console.warn((new Error).stack)),new Date(NaN))}function vW(t){if(mW(1,arguments),!gW(t)&&\"number\"!=typeof t)return!1;var e=AW(t);return!isNaN(Number(e))}var _W={lessThanXSeconds:{one:\"less than a second\",other:\"less than {{count}} seconds\"},xSeconds:{one:\"1 second\",other:\"{{count}} seconds\"},halfAMinute:\"half a minute\",lessThanXMinutes:{one:\"less than a minute\",other:\"less than {{count}} minutes\"},xMinutes:{one:\"1 minute\",other:\"{{count}} minutes\"},aboutXHours:{one:\"about 1 hour\",other:\"about {{count}} hours\"},xHours:{one:\"1 hour\",other:\"{{count}} hours\"},xDays:{one:\"1 day\",other:\"{{count}} days\"},aboutXWeeks:{one:\"about 1 week\",other:\"about {{count}} weeks\"},xWeeks:{one:\"1 week\",other:\"{{count}} weeks\"},aboutXMonths:{one:\"about 1 month\",other:\"about {{count}} months\"},xMonths:{one:\"1 month\",other:\"{{count}} months\"},aboutXYears:{one:\"about 1 year\",other:\"about {{count}} years\"},xYears:{one:\"1 year\",other:\"{{count}} years\"},overXYears:{one:\"over 1 year\",other:\"over {{count}} years\"},almostXYears:{one:\"almost 1 year\",other:\"almost {{count}} years\"}};function bW(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.width?String(e.width):t.defaultWidth,n=t.formats[i]||t.formats[t.defaultWidth];return n}}var yW={date:bW({formats:{full:\"EEEE, MMMM do, y\",long:\"MMMM do, y\",medium:\"MMM d, y\",short:\"MM/dd/yyyy\"},defaultWidth:\"full\"}),time:bW({formats:{full:\"h:mm:ss a zzzz\",long:\"h:mm:ss a z\",medium:\"h:mm:ss a\",short:\"h:mm a\"},defaultWidth:\"full\"}),dateTime:bW({formats:{full:\"{{date}} 'at' {{time}}\",long:\"{{date}} 'at' {{time}}\",medium:\"{{date}}, {{time}}\",short:\"{{date}}, {{time}}\"},defaultWidth:\"full\"})},wW={lastWeek:\"'last' eeee 'at' p\",yesterday:\"'yesterday at' p\",today:\"'today at' p\",tomorrow:\"'tomorrow at' p\",nextWeek:\"eeee 'at' p\",other:\"P\"};function xW(t){return function(e,i){var n,s=i||{};if(\"formatting\"===(s.context?String(s.context):\"standalone\")&&t.formattingValues){var r=t.defaultFormattingWidth||t.defaultWidth,o=s.width?String(s.width):r;n=t.formattingValues[o]||t.formattingValues[r]}else{var a=t.defaultWidth,l=s.width?String(s.width):t.defaultWidth;n=t.values[l]||t.values[a]}return n[t.argumentCallback?t.argumentCallback(e):e]}}function SW(t){return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.width,s=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],r=e.match(s);if(!r)return null;var o,a=r[0],l=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?kW(l,function(t){return t.test(a)}):CW(l,function(t){return t.test(a)});o=t.valueCallback?t.valueCallback(c):c,o=i.valueCallback?i.valueCallback(o):o;var h=e.slice(a.length);return{value:o,rest:h}}}function CW(t,e){for(var i in t)if(t.hasOwnProperty(i)&&e(t[i]))return i}function kW(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return i}function EW(t){return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.match(t.matchPattern);if(!n)return null;var s=n[0],r=e.match(t.parsePattern);if(!r)return null;var o=t.valueCallback?t.valueCallback(r[0]):r[0];o=i.valueCallback?i.valueCallback(o):o;var a=e.slice(s.length);return{value:o,rest:a}}}var MW={code:\"en-US\",formatDistance:function(t,e,i){var n,s=_W[t];return n=\"string\"==typeof s?s:1===e?s.one:s.other.replace(\"{{count}}\",e.toString()),null!=i&&i.addSuffix?i.comparison&&i.comparison>0?\"in \"+n:n+\" ago\":n},formatLong:yW,formatRelative:function(t,e,i,n){return wW[t]},localize:{ordinalNumber:function(t,e){var i=Number(t),n=i%100;if(n>20||n<10)switch(n%10){case 1:return i+\"st\";case 2:return i+\"nd\";case 3:return i+\"rd\"}return i+\"th\"},era:xW({values:{narrow:[\"B\",\"A\"],abbreviated:[\"BC\",\"AD\"],wide:[\"Before Christ\",\"Anno Domini\"]},defaultWidth:\"wide\"}),quarter:xW({values:{narrow:[\"1\",\"2\",\"3\",\"4\"],abbreviated:[\"Q1\",\"Q2\",\"Q3\",\"Q4\"],wide:[\"1st quarter\",\"2nd quarter\",\"3rd quarter\",\"4th quarter\"]},defaultWidth:\"wide\",argumentCallback:function(t){return t-1}}),month:xW({values:{narrow:[\"J\",\"F\",\"M\",\"A\",\"M\",\"J\",\"J\",\"A\",\"S\",\"O\",\"N\",\"D\"],abbreviated:[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],wide:[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"]},defaultWidth:\"wide\"}),day:xW({values:{narrow:[\"S\",\"M\",\"T\",\"W\",\"T\",\"F\",\"S\"],short:[\"Su\",\"Mo\",\"Tu\",\"We\",\"Th\",\"Fr\",\"Sa\"],abbreviated:[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],wide:[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},defaultWidth:\"wide\"}),dayPeriod:xW({values:{narrow:{am:\"a\",pm:\"p\",midnight:\"mi\",noon:\"n\",morning:\"morning\",afternoon:\"afternoon\",evening:\"evening\",night:\"night\"},abbreviated:{am:\"AM\",pm:\"PM\",midnight:\"midnight\",noon:\"noon\",morning:\"morning\",afternoon:\"afternoon\",evening:\"evening\",night:\"night\"},wide:{am:\"a.m.\",pm:\"p.m.\",midnight:\"midnight\",noon:\"noon\",morning:\"morning\",afternoon:\"afternoon\",evening:\"evening\",night:\"night\"}},defaultWidth:\"wide\",formattingValues:{narrow:{am:\"a\",pm:\"p\",midnight:\"mi\",noon:\"n\",morning:\"in the morning\",afternoon:\"in the afternoon\",evening:\"in the evening\",night:\"at night\"},abbreviated:{am:\"AM\",pm:\"PM\",midnight:\"midnight\",noon:\"noon\",morning:\"in the morning\",afternoon:\"in the afternoon\",evening:\"in the evening\",night:\"at night\"},wide:{am:\"a.m.\",pm:\"p.m.\",midnight:\"midnight\",noon:\"noon\",morning:\"in the morning\",afternoon:\"in the afternoon\",evening:\"in the evening\",night:\"at night\"}},defaultFormattingWidth:\"wide\"})},match:{ordinalNumber:EW({matchPattern:/^(\\d+)(th|st|nd|rd)?/i,parsePattern:/\\d+/i,valueCallback:function(t){return parseInt(t,10)}}),era:SW({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\\.?\\s?c\\.?|b\\.?\\s?c\\.?\\s?e\\.?|a\\.?\\s?d\\.?|c\\.?\\s?e\\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:\"wide\",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:\"any\"}),quarter:SW({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:\"wide\",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:\"any\",valueCallback:function(t){return t+1}}),month:SW({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:\"wide\",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:\"any\"}),day:SW({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:\"wide\",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:\"any\"}),dayPeriod:SW({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\\.?\\s?m\\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:\"any\",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:\"any\"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function TW(t){if(null===t||!0===t||!1===t)return NaN;var e=Number(t);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function IW(t,e){mW(2,arguments);var i=AW(t).getTime(),n=TW(e);return new Date(i+n)}function PW(t,e){mW(2,arguments);var i=TW(e);return IW(t,-i)}function OW(t){mW(1,arguments);var e=1,i=AW(t),n=i.getUTCDay(),s=(n<e?7:0)+n-e;return i.setUTCDate(i.getUTCDate()-s),i.setUTCHours(0,0,0,0),i}function RW(t){mW(1,arguments);var e=AW(t),i=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(i+1,0,4),n.setUTCHours(0,0,0,0);var s=OW(n),r=new Date(0);r.setUTCFullYear(i,0,4),r.setUTCHours(0,0,0,0);var o=OW(r);return e.getTime()>=s.getTime()?i+1:e.getTime()>=o.getTime()?i:i-1}function DW(t){mW(1,arguments);var e=RW(t),i=new Date(0);i.setUTCFullYear(e,0,4),i.setUTCHours(0,0,0,0);var n=OW(i);return n}function LW(t){mW(1,arguments);var e=AW(t),i=OW(e).getTime()-DW(e).getTime();return Math.round(i/6048e5)+1}function FW(t,e){mW(1,arguments);var i=e||{},n=i.locale,s=n&&n.options&&n.options.weekStartsOn,r=null==s?0:TW(s),o=null==i.weekStartsOn?r:TW(i.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError(\"weekStartsOn must be between 0 and 6 inclusively\");var a=AW(t),l=a.getUTCDay(),c=(l<o?7:0)+l-o;return a.setUTCDate(a.getUTCDate()-c),a.setUTCHours(0,0,0,0),a}function NW(t,e){mW(1,arguments);var i=AW(t),n=i.getUTCFullYear(),s=e||{},r=s.locale,o=r&&r.options&&r.options.firstWeekContainsDate,a=null==o?1:TW(o),l=null==s.firstWeekContainsDate?a:TW(s.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError(\"firstWeekContainsDate must be between 1 and 7 inclusively\");var c=new Date(0);c.setUTCFullYear(n+1,0,l),c.setUTCHours(0,0,0,0);var h=FW(c,e),u=new Date(0);u.setUTCFullYear(n,0,l),u.setUTCHours(0,0,0,0);var d=FW(u,e);return i.getTime()>=h.getTime()?n+1:i.getTime()>=d.getTime()?n:n-1}function BW(t,e){mW(1,arguments);var i=e||{},n=i.locale,s=n&&n.options&&n.options.firstWeekContainsDate,r=null==s?1:TW(s),o=null==i.firstWeekContainsDate?r:TW(i.firstWeekContainsDate),a=NW(t,e),l=new Date(0);l.setUTCFullYear(a,0,o),l.setUTCHours(0,0,0,0);var c=FW(l,e);return c}function zW(t,e){mW(1,arguments);var i=AW(t),n=FW(i,e).getTime()-BW(i,e).getTime();return Math.round(n/6048e5)+1}function VW(t,e){for(var i=t<0?\"-\":\"\",n=Math.abs(t).toString();n.length<e;)n=\"0\"+n;return i+n}var $W=function(t,e){var i=t.getUTCFullYear(),n=i>0?i:1-i;return VW(\"yy\"===e?n%100:n,e.length)},UW=function(t,e){var i=t.getUTCMonth();return\"M\"===e?String(i+1):VW(i+1,2)},jW=function(t,e){return VW(t.getUTCDate(),e.length)},HW=function(t,e){return VW(t.getUTCHours()%12||12,e.length)},GW=function(t,e){return VW(t.getUTCHours(),e.length)},WW=function(t,e){return VW(t.getUTCMinutes(),e.length)},qW=function(t,e){return VW(t.getUTCSeconds(),e.length)},YW=function(t,e){var i=e.length,n=t.getUTCMilliseconds();return VW(Math.floor(n*Math.pow(10,i-3)),e.length)};function ZW(t,e){var i=t>0?\"-\":\"+\",n=Math.abs(t),s=Math.floor(n/60),r=n%60;if(0===r)return i+String(s);var o=e||\"\";return i+String(s)+o+VW(r,2)}function KW(t,e){return t%60==0?(t>0?\"-\":\"+\")+VW(Math.abs(t)/60,2):XW(t,e)}function XW(t,e){var i=e||\"\",n=t>0?\"-\":\"+\",s=Math.abs(t);return n+VW(Math.floor(s/60),2)+i+VW(s%60,2)}var QW={G:function(t,e,i){var n=t.getUTCFullYear()>0?1:0;switch(e){case\"G\":case\"GG\":case\"GGG\":return i.era(n,{width:\"abbreviated\"});case\"GGGGG\":return i.era(n,{width:\"narrow\"});case\"GGGG\":default:return i.era(n,{width:\"wide\"})}},y:function(t,e,i){if(\"yo\"===e){var n=t.getUTCFullYear();return i.ordinalNumber(n>0?n:1-n,{unit:\"year\"})}return $W(t,e)},Y:function(t,e,i,n){var s=NW(t,n),r=s>0?s:1-s;return\"YY\"===e?VW(r%100,2):\"Yo\"===e?i.ordinalNumber(r,{unit:\"year\"}):VW(r,e.length)},R:function(t,e){return VW(RW(t),e.length)},u:function(t,e){return VW(t.getUTCFullYear(),e.length)},Q:function(t,e,i){var n=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case\"Q\":return String(n);case\"QQ\":return VW(n,2);case\"Qo\":return i.ordinalNumber(n,{unit:\"quarter\"});case\"QQQ\":return i.quarter(n,{width:\"abbreviated\",context:\"formatting\"});case\"QQQQQ\":return i.quarter(n,{width:\"narrow\",context:\"formatting\"});case\"QQQQ\":default:return i.quarter(n,{width:\"wide\",context:\"formatting\"})}},q:function(t,e,i){var n=Math.ceil((t.getUTCMonth()+1)/3);switch(e){case\"q\":return String(n);case\"qq\":return VW(n,2);case\"qo\":return i.ordinalNumber(n,{unit:\"quarter\"});case\"qqq\":return i.quarter(n,{width:\"abbreviated\",context:\"standalone\"});case\"qqqqq\":return i.quarter(n,{width:\"narrow\",context:\"standalone\"});case\"qqqq\":default:return i.quarter(n,{width:\"wide\",context:\"standalone\"})}},M:function(t,e,i){var n=t.getUTCMonth();switch(e){case\"M\":case\"MM\":return UW(t,e);case\"Mo\":return i.ordinalNumber(n+1,{unit:\"month\"});case\"MMM\":return i.month(n,{width:\"abbreviated\",context:\"formatting\"});case\"MMMMM\":return i.month(n,{width:\"narrow\",context:\"formatting\"});case\"MMMM\":default:return i.month(n,{width:\"wide\",context:\"formatting\"})}},L:function(t,e,i){var n=t.getUTCMonth();switch(e){case\"L\":return String(n+1);case\"LL\":return VW(n+1,2);case\"Lo\":return i.ordinalNumber(n+1,{unit:\"month\"});case\"LLL\":return i.month(n,{width:\"abbreviated\",context:\"standalone\"});case\"LLLLL\":return i.month(n,{width:\"narrow\",context:\"standalone\"});case\"LLLL\":default:return i.month(n,{width:\"wide\",context:\"standalone\"})}},w:function(t,e,i,n){var s=zW(t,n);return\"wo\"===e?i.ordinalNumber(s,{unit:\"week\"}):VW(s,e.length)},I:function(t,e,i){var n=LW(t);return\"Io\"===e?i.ordinalNumber(n,{unit:\"week\"}):VW(n,e.length)},d:function(t,e,i){return\"do\"===e?i.ordinalNumber(t.getUTCDate(),{unit:\"date\"}):jW(t,e)},D:function(t,e,i){var n=function(t){mW(1,arguments);var e=AW(t),i=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime();return Math.floor((i-n)/864e5)+1}(t);return\"Do\"===e?i.ordinalNumber(n,{unit:\"dayOfYear\"}):VW(n,e.length)},E:function(t,e,i){var n=t.getUTCDay();switch(e){case\"E\":case\"EE\":case\"EEE\":return i.day(n,{width:\"abbreviated\",context:\"formatting\"});case\"EEEEE\":return i.day(n,{width:\"narrow\",context:\"formatting\"});case\"EEEEEE\":return i.day(n,{width:\"short\",context:\"formatting\"});case\"EEEE\":default:return i.day(n,{width:\"wide\",context:\"formatting\"})}},e:function(t,e,i,n){var s=t.getUTCDay(),r=(s-n.weekStartsOn+8)%7||7;switch(e){case\"e\":return String(r);case\"ee\":return VW(r,2);case\"eo\":return i.ordinalNumber(r,{unit:\"day\"});case\"eee\":return i.day(s,{width:\"abbreviated\",context:\"formatting\"});case\"eeeee\":return i.day(s,{width:\"narrow\",context:\"formatting\"});case\"eeeeee\":return i.day(s,{width:\"short\",context:\"formatting\"});case\"eeee\":default:return i.day(s,{width:\"wide\",context:\"formatting\"})}},c:function(t,e,i,n){var s=t.getUTCDay(),r=(s-n.weekStartsOn+8)%7||7;switch(e){case\"c\":return String(r);case\"cc\":return VW(r,e.length);case\"co\":return i.ordinalNumber(r,{unit:\"day\"});case\"ccc\":return i.day(s,{width:\"abbreviated\",context:\"standalone\"});case\"ccccc\":return i.day(s,{width:\"narrow\",context:\"standalone\"});case\"cccccc\":return i.day(s,{width:\"short\",context:\"standalone\"});case\"cccc\":default:return i.day(s,{width:\"wide\",context:\"standalone\"})}},i:function(t,e,i){var n=t.getUTCDay(),s=0===n?7:n;switch(e){case\"i\":return String(s);case\"ii\":return VW(s,e.length);case\"io\":return i.ordinalNumber(s,{unit:\"day\"});case\"iii\":return i.day(n,{width:\"abbreviated\",context:\"formatting\"});case\"iiiii\":return i.day(n,{width:\"narrow\",context:\"formatting\"});case\"iiiiii\":return i.day(n,{width:\"short\",context:\"formatting\"});case\"iiii\":default:return i.day(n,{width:\"wide\",context:\"formatting\"})}},a:function(t,e,i){var n=t.getUTCHours()/12>=1?\"pm\":\"am\";switch(e){case\"a\":case\"aa\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"});case\"aaa\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"}).toLowerCase();case\"aaaaa\":return i.dayPeriod(n,{width:\"narrow\",context:\"formatting\"});case\"aaaa\":default:return i.dayPeriod(n,{width:\"wide\",context:\"formatting\"})}},b:function(t,e,i){var n,s=t.getUTCHours();switch(n=12===s?\"noon\":0===s?\"midnight\":s/12>=1?\"pm\":\"am\",e){case\"b\":case\"bb\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"});case\"bbb\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"}).toLowerCase();case\"bbbbb\":return i.dayPeriod(n,{width:\"narrow\",context:\"formatting\"});case\"bbbb\":default:return i.dayPeriod(n,{width:\"wide\",context:\"formatting\"})}},B:function(t,e,i){var n,s=t.getUTCHours();switch(n=s>=17?\"evening\":s>=12?\"afternoon\":s>=4?\"morning\":\"night\",e){case\"B\":case\"BB\":case\"BBB\":return i.dayPeriod(n,{width:\"abbreviated\",context:\"formatting\"});case\"BBBBB\":return i.dayPeriod(n,{width:\"narrow\",context:\"formatting\"});case\"BBBB\":default:return i.dayPeriod(n,{width:\"wide\",context:\"formatting\"})}},h:function(t,e,i){if(\"ho\"===e){var n=t.getUTCHours()%12;return 0===n&&(n=12),i.ordinalNumber(n,{unit:\"hour\"})}return HW(t,e)},H:function(t,e,i){return\"Ho\"===e?i.ordinalNumber(t.getUTCHours(),{unit:\"hour\"}):GW(t,e)},K:function(t,e,i){var n=t.getUTCHours()%12;return\"Ko\"===e?i.ordinalNumber(n,{unit:\"hour\"}):VW(n,e.length)},k:function(t,e,i){var n=t.getUTCHours();return 0===n&&(n=24),\"ko\"===e?i.ordinalNumber(n,{unit:\"hour\"}):VW(n,e.length)},m:function(t,e,i){return\"mo\"===e?i.ordinalNumber(t.getUTCMinutes(),{unit:\"minute\"}):WW(t,e)},s:function(t,e,i){return\"so\"===e?i.ordinalNumber(t.getUTCSeconds(),{unit:\"second\"}):qW(t,e)},S:function(t,e){return YW(t,e)},X:function(t,e,i,n){var s=(n._originalDate||t).getTimezoneOffset();if(0===s)return\"Z\";switch(e){case\"X\":return KW(s);case\"XXXX\":case\"XX\":return XW(s);case\"XXXXX\":case\"XXX\":default:return XW(s,\":\")}},x:function(t,e,i,n){var s=(n._originalDate||t).getTimezoneOffset();switch(e){case\"x\":return KW(s);case\"xxxx\":case\"xx\":return XW(s);case\"xxxxx\":case\"xxx\":default:return XW(s,\":\")}},O:function(t,e,i,n){var s=(n._originalDate||t).getTimezoneOffset();switch(e){case\"O\":case\"OO\":case\"OOO\":return\"GMT\"+ZW(s,\":\");case\"OOOO\":default:return\"GMT\"+XW(s,\":\")}},z:function(t,e,i,n){var s=(n._originalDate||t).getTimezoneOffset();switch(e){case\"z\":case\"zz\":case\"zzz\":return\"GMT\"+ZW(s,\":\");case\"zzzz\":default:return\"GMT\"+XW(s,\":\")}},t:function(t,e,i,n){return VW(Math.floor((n._originalDate||t).getTime()/1e3),e.length)},T:function(t,e,i,n){return VW((n._originalDate||t).getTime(),e.length)}};function JW(t,e){switch(t){case\"P\":return e.date({width:\"short\"});case\"PP\":return e.date({width:\"medium\"});case\"PPP\":return e.date({width:\"long\"});case\"PPPP\":default:return e.date({width:\"full\"})}}function tq(t,e){switch(t){case\"p\":return e.time({width:\"short\"});case\"pp\":return e.time({width:\"medium\"});case\"ppp\":return e.time({width:\"long\"});case\"pppp\":default:return e.time({width:\"full\"})}}var eq={p:tq,P:function(t,e){var i,n=t.match(/(P+)(p+)?/)||[],s=n[1],r=n[2];if(!r)return JW(t,e);switch(s){case\"P\":i=e.dateTime({width:\"short\"});break;case\"PP\":i=e.dateTime({width:\"medium\"});break;case\"PPP\":i=e.dateTime({width:\"long\"});break;case\"PPPP\":default:i=e.dateTime({width:\"full\"})}return i.replace(\"{{date}}\",JW(s,e)).replace(\"{{time}}\",tq(r,e))}};function iq(t){var e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return e.setUTCFullYear(t.getFullYear()),t.getTime()-e.getTime()}var nq=[\"D\",\"DD\"],sq=[\"YY\",\"YYYY\"];function rq(t){return-1!==nq.indexOf(t)}function oq(t){return-1!==sq.indexOf(t)}function aq(t,e,i){if(\"YYYY\"===t)throw new RangeError(\"Use `yyyy` instead of `YYYY` (in `\".concat(e,\"`) for formatting years to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"));if(\"YY\"===t)throw new RangeError(\"Use `yy` instead of `YY` (in `\".concat(e,\"`) for formatting years to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"));if(\"D\"===t)throw new RangeError(\"Use `d` instead of `D` (in `\".concat(e,\"`) for formatting days of the month to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"));if(\"DD\"===t)throw new RangeError(\"Use `dd` instead of `DD` (in `\".concat(e,\"`) for formatting days of the month to the input `\").concat(i,\"`; see: https://git.io/fxCyr\"))}var lq=/[yYQqMLwIdDecihHKkms]o|(\\w)\\1*|''|'(''|[^'])+('|$)|./g,cq=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,hq=/^'([^]*?)'?$/,uq=/''/g,dq=/[a-zA-Z]/;function pq(t,e,i){mW(2,arguments);var n=String(e),s=i||{},r=s.locale||MW,o=r.options&&r.options.firstWeekContainsDate,a=null==o?1:TW(o),l=null==s.firstWeekContainsDate?a:TW(s.firstWeekContainsDate);if(!(l>=1&&l<=7))throw new RangeError(\"firstWeekContainsDate must be between 1 and 7 inclusively\");var c=r.options&&r.options.weekStartsOn,h=null==c?0:TW(c),u=null==s.weekStartsOn?h:TW(s.weekStartsOn);if(!(u>=0&&u<=6))throw new RangeError(\"weekStartsOn must be between 0 and 6 inclusively\");if(!r.localize)throw new RangeError(\"locale must contain localize property\");if(!r.formatLong)throw new RangeError(\"locale must contain formatLong property\");var d=AW(t);if(!vW(d))throw new RangeError(\"Invalid time value\");var p=iq(d),f=PW(d,p),m={firstWeekContainsDate:l,weekStartsOn:u,locale:r,_originalDate:d},g=n.match(cq).map(function(t){var e=t[0];return\"p\"===e||\"P\"===e?(0,eq[e])(t,r.formatLong,m):t}).join(\"\").match(lq).map(function(i){if(\"''\"===i)return\"'\";var n=i[0];if(\"'\"===n)return fq(i);var o=QW[n];if(o)return!s.useAdditionalWeekYearTokens&&oq(i)&&aq(i,e,t),!s.useAdditionalDayOfYearTokens&&rq(i)&&aq(i,e,t),o(f,i,r.localize,m);if(n.match(dq))throw new RangeError(\"Format string contains an unescaped latin alphabet character `\"+n+\"`\");return i}).join(\"\");return g}function fq(t){return t.match(hq)[1].replace(uq,\"'\")}const mq=86400;let gq=function(){return new Date};function Aq(t){if(t<0)return`/!\\\\ Dur\\xe9e n\\xe9gative ${Aq(-t)}`;if(t<60)return\"moins d'une minute\";const e=Math.floor(t/mq),i=Math.floor(t%mq/3600),n=Math.floor(t%3600/60),s=[];return e>=1&&s.push(`${e} jour${e>1?\"s\":\"\"}`),i>=1&&s.push(`${i} heure${i>1?\"s\":\"\"}`),s.length<2&&0!==n&&s.push(`${n} minute${n>1?\"s\":\"\"}`),`${s.join(\", \")}`}function vq(t){if(t<0)return`/!\\\\ Dur\\xe9e n\\xe9gative ${vq(-t)}`;if(t<60)return\"< 1m\";const e=Math.floor(t/mq),i=Math.floor(t%mq/3600),n=Math.floor(t%3600/60),s=[];return e>=1&&s.push(`${e}j`),i>=1&&s.push(`${i}h`),s.length<2&&0!==n&&s.push(`${n}m`),`${s.join(\" \")}`}function _q(t){return Math.floor(t.getTime()/1e3)}function bq(t){return pq(t,\"dd/MM/yyyy\")}function yq(t){return pq(1e3*t,\"yyyy-MM-dd'T'HH-mm-ss\")}function wq(t){return new Date(t).toISOString().substr(0,19)}let xq=(()=>{class t{constructor(){this.active$=new Jp(!1),this.selectedPIM$=new Jp(null),this.nextStartDate$=new Jp(_q(new Date)),this.nextSpeed$=new Jp(10)}togglePIMMode(){this.active$.next(!this.active$.value)}selectPIM(t){this.selectedPIM$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const Sq=CH.reduce((t,e)=>(t[e.iso2]=e,t[e.iso3]=e,t),{}),Cq={flag:\"undefined\",iso2:\"undefined\",iso3:\"undefined\",name:\"Inconnu\",searchValue:\"\"};function kq(t){var e;return null!==(e=Sq[t])&&void 0!==e?e:Cq}const Eq=Object.entries({201:[\"AL\",\"ALB\",\"\",\"Albania\"],202:[\"AD\",\"AND\",\"\",\"Andorra\"],203:[\"AT\",\"AUT\",\"\",\"Austria\"],204:[\"PT\",\"PRT\",\"PT-20\",\"Azores\"],205:[\"BE\",\"BEL\",\"\",\"Belgium\"],206:[\"BY\",\"BLR\",\"\",\"Belarus\"],207:[\"BG\",\"BGR\",\"\",\"Bulgaria\"],208:[\"VA\",\"VAT\",\"\",\"Vatican City State\"],209:[\"CY\",\"CYP\",\"\",\"Cyprus\"],210:[\"CY\",\"CYP\",\"\",\"Cyprus\"],211:[\"DE\",\"DEU\",\"\",\"Germany\"],212:[\"CY\",\"CYP\",\"\",\"Cyprus\"],213:[\"GE\",\"GEO\",\"\",\"Georgia\"],214:[\"MD\",\"MDA\",\"\",\"Moldova\"],215:[\"MT\",\"MLT\",\"\",\"Malta\"],216:[\"AM\",\"ARM\",\"\",\"Armenia\"],218:[\"DE\",\"DEU\",\"\",\"Germany\"],219:[\"DK\",\"DNK\",\"\",\"Denmark\"],220:[\"DK\",\"DNK\",\"\",\"Denmark\"],224:[\"ES\",\"ESP\",\"\",\"Spain\"],225:[\"ES\",\"ESP\",\"\",\"Spain\"],226:[\"FR\",\"FRA\",\"\",\"France\"],227:[\"FR\",\"FRA\",\"\",\"France\"],228:[\"FR\",\"FRA\",\"\",\"France\"],229:[\"MT\",\"MLT\",\"\",\"Malta\"],230:[\"FI\",\"FIN\",\"\",\"Finland\"],231:[\"FO\",\"FRO\",\"\",\"Faroe Islands\"],232:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],233:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],234:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],235:[\"GB\",\"GBR\",\"\",\"United Kingdom\"],236:[\"GI\",\"GIB\",\"\",\"Gibraltar\"],237:[\"GR\",\"GRC\",\"\",\"Greece\"],238:[\"HR\",\"HRV\",\"\",\"Croatia\"],239:[\"GR\",\"GRC\",\"\",\"Greece\"],240:[\"GR\",\"GRC\",\"\",\"Greece\"],241:[\"GR\",\"GRC\",\"\",\"Greece\"],242:[\"MA\",\"MAR\",\"\",\"Morocco\"],243:[\"HU\",\"HUN\",\"\",\"Hungary\"],244:[\"NL\",\"NLD\",\"\",\"Netherlands\"],245:[\"NL\",\"NLD\",\"\",\"Netherlands\"],246:[\"NL\",\"NLD\",\"\",\"Netherlands\"],247:[\"IT\",\"ITA\",\"\",\"Italy\"],248:[\"MT\",\"MLT\",\"\",\"Malta\"],249:[\"MT\",\"MLT\",\"\",\"Malta\"],250:[\"IE\",\"IRL\",\"\",\"Ireland\"],251:[\"IS\",\"ISL\",\"\",\"Iceland\"],252:[\"LI\",\"LIE\",\"\",\"Liechtenstein\"],253:[\"LU\",\"LUX\",\"\",\"Luxembourg\"],254:[\"MC\",\"MCO\",\"\",\"Monaco\"],255:[\"PT\",\"PRT\",\"PT-30\",\"Madeira\"],256:[\"MT\",\"MLT\",\"\",\"Malta\"],257:[\"NO\",\"NOR\",\"\",\"Norway\"],258:[\"NO\",\"NOR\",\"\",\"Norway\"],259:[\"NO\",\"NOR\",\"\",\"Norway\"],261:[\"PL\",\"POL\",\"\",\"Poland\"],262:[\"ME\",\"MNE\",\"\",\"Montenegro\"],263:[\"PT\",\"PRT\",\"\",\"Portugal\"],264:[\"RO\",\"ROU\",\"\",\"Romania\"],265:[\"SE\",\"SWE\",\"\",\"Sweden\"],266:[\"SE\",\"SWE\",\"\",\"Sweden\"],267:[\"SK\",\"SVK\",\"\",\"Slovak Republic\"],268:[\"SM\",\"SMR\",\"\",\"San Marino\"],269:[\"CH\",\"CHE\",\"\",\"Switzerland\"],270:[\"CZ\",\"CZE\",\"\",\"Czech Republic\"],271:[\"TR\",\"TUR\",\"\",\"Turkey\"],272:[\"UA\",\"UKR\",\"\",\"Ukraine\"],273:[\"RU\",\"RUS\",\"\",\"Russia\"],274:[\"MK\",\"MKD\",\"\",\"Macedonia\"],275:[\"LV\",\"LVA\",\"\",\"Latvia\"],276:[\"EE\",\"EST\",\"\",\"Estonia\"],277:[\"LT\",\"LTU\",\"\",\"Lithuania\"],278:[\"SI\",\"SVN\",\"\",\"Slovenia\"],279:[\"RS\",\"SRB\",\"\",\"Serbia\"],301:[\"AI\",\"AIA\",\"\",\"Anguilla\"],303:[\"US\",\"USA\",\"US-AK\",\"Alaska\"],304:[\"AG\",\"ATG\",\"\",\"Antigua and Barbuda\"],305:[\"AG\",\"ATG\",\"\",\"Antigua and Barbuda\"],306:[\"CW\",\"CUW\",\"\",\"Antilles\"],307:[\"AW\",\"ABW\",\"\",\"Aruba\"],308:[\"BS\",\"BHS\",\"\",\"Bahamas\"],309:[\"BS\",\"BHS\",\"\",\"Bahamas\"],310:[\"BM\",\"BMU\",\"\",\"Bermuda\"],311:[\"BS\",\"BMU\",\"\",\"Bahamas\"],312:[\"BZ\",\"BLZ\",\"\",\"Belize\"],314:[\"BB\",\"BRB\",\"\",\"Barbados\"],316:[\"CA\",\"CAN\",\"\",\"Canada\"],319:[\"KY\",\"CYM\",\"\",\"Cayman Islands\"],321:[\"CR\",\"CRI\",\"\",\"Costa Rica\"],323:[\"CU\",\"CUB\",\"\",\"Cuba\"],325:[\"DM\",\"DMA\",\"\",\"Dominica\"],327:[\"DO\",\"DOM\",\"\",\"Dominican Republic\"],329:[\"GP\",\"GLP\",\"\",\"Guadeloupe\"],330:[\"GD\",\"GRD\",\"\",\"Grenada\"],331:[\"GL\",\"GRL\",\"\",\"Greenland\"],332:[\"GT\",\"GTM\",\"\",\"Guatemala\"],335:[\"HN\",\"HND\",\"\",\"Honduras\"],336:[\"HT\",\"HTI\",\"\",\"Haiti\"],338:[\"US\",\"USA\",\"\",\"United States of America\"],339:[\"JM\",\"JAM\",\"\",\"Jamaica\"],341:[\"KN\",\"KNA\",\"\",\"Saint Kitts and Nevis\"],343:[\"LC\",\"LCA\",\"\",\"Saint Lucia\"],345:[\"MX\",\"MEX\",\"\",\"Mexico\"],347:[\"MQ\",\"MTQ\",\"\",\"Martinique\"],348:[\"MS\",\"MSR\",\"\",\"Montserrat\"],350:[\"NI\",\"NIC\",\"\",\"Nicaragua\"],351:[\"PA\",\"PAN\",\"\",\"Panama\"],352:[\"PA\",\"PAN\",\"\",\"Panama\"],353:[\"PA\",\"PAN\",\"\",\"Panama\"],354:[\"PA\",\"PAN\",\"\",\"Panama\"],355:[\"PA\",\"PAN\",\"\",\"Panama\"],356:[\"PA\",\"PAN\",\"\",\"Panama\"],357:[\"PA\",\"PAN\",\"\",\"Panama\"],358:[\"PR\",\"PRI\",\"\",\"Puerto Rico\"],359:[\"SV\",\"SLV\",\"\",\"El Salvador\"],361:[\"PM\",\"SPM\",\"\",\"Saint Pierre and Miquelon\"],362:[\"TT\",\"TTO\",\"\",\"Trinidad and Tobago\"],364:[\"TC\",\"TCA\",\"\",\"Turks and Caicos Islands\"],366:[\"US\",\"USA\",\"\",\"United States of America\"],367:[\"US\",\"USA\",\"\",\"United States of America\"],368:[\"US\",\"USA\",\"\",\"United States of America\"],369:[\"US\",\"USA\",\"\",\"United States of America\"],370:[\"PA\",\"PAN\",\"\",\"Panama\"],371:[\"PA\",\"PAN\",\"\",\"Panama\"],372:[\"PA\",\"PAN\",\"\",\"Panama\"],373:[\"PA\",\"PAN\",\"\",\"Panama\"],374:[\"PA\",\"PAN\",\"\",\"Panama\"],375:[\"VC\",\"VCT\",\"\",\"Saint Vincent and the Grenadines\"],376:[\"VC\",\"VCT\",\"\",\"Saint Vincent and the Grenadines\"],377:[\"VC\",\"VCT\",\"\",\"Saint Vincent and the Grenadines\"],378:[\"VG\",\"VGB\",\"\",\"British Virgin Islands\"],379:[\"VI\",\"VIR\",\"\",\"United States Virgin Islands\"],401:[\"AF\",\"AFG\",\"\",\"Afghanistan\"],403:[\"SA\",\"SAU\",\"\",\"Saudi Arabia\"],405:[\"BD\",\"BGD\",\"\",\"Bangladesh\"],408:[\"BH\",\"BHR\",\"\",\"Bahrain\"],410:[\"BT\",\"BTN\",\"\",\"Bhutan\"],412:[\"CN\",\"CHN\",\"\",\"China\"],413:[\"CN\",\"CHN\",\"\",\"China\"],414:[\"CN\",\"CHN\",\"\",\"China\"],416:[\"TW\",\"TWN\",\"\",\"Taiwan\"],417:[\"LK\",\"LKA\",\"\",\"Sri Lanka\"],419:[\"IN\",\"IND\",\"\",\"India\"],422:[\"IR\",\"IRN\",\"\",\"Iran\"],423:[\"AZ\",\"AZE\",\"\",\"Azerbaijan\"],425:[\"IQ\",\"IRQ\",\"\",\"Iraq\"],428:[\"IL\",\"ISR\",\"\",\"Israel\"],431:[\"JP\",\"JPN\",\"\",\"Japan\"],432:[\"JP\",\"JPN\",\"\",\"Japan\"],434:[\"TM\",\"TKM\",\"\",\"Turkmenistan\"],436:[\"KZ\",\"KAZ\",\"\",\"Kazakhstan\"],437:[\"UZ\",\"UZB\",\"\",\"Uzbekistan\"],438:[\"JO\",\"JOR\",\"\",\"Jordan\"],440:[\"KR\",\"KOR\",\"\",\"Korea\"],441:[\"KR\",\"KOR\",\"\",\"Korea\"],443:[\"PS\",\"PSE\",\"\",\"State of Palestine\"],445:[\"KP\",\"PRK\",\"\",\"Democratic People's Republic of Korea\"],447:[\"KW\",\"KWT\",\"\",\"Kuwait\"],450:[\"LB\",\"LBN\",\"\",\"Lebanon\"],451:[\"KG\",\"KGZ\",\"\",\"Kyrgyz Republic\"],453:[\"MO\",\"MAC\",\"\",\"Macao\"],455:[\"MV\",\"MDV\",\"\",\"Maldives\"],457:[\"MN\",\"MNG\",\"\",\"Mongolia\"],459:[\"NP\",\"NPL\",\"\",\"Nepal\"],461:[\"OM\",\"OMN\",\"\",\"Oman\"],463:[\"PK\",\"PAK\",\"\",\"Pakistan\"],466:[\"QA\",\"QAT\",\"\",\"Qatar (State of)\"],468:[\"SY\",\"SYR\",\"\",\"Syrian Arab Republic\"],470:[\"AE\",\"ARE\",\"\",\"United Arab Emirates\"],472:[\"TJ\",\"TJK\",\"\",\"Tajikistan\"],473:[\"YE\",\"YEM\",\"\",\"Yemen\"],475:[\"YE\",\"YEM\",\"\",\"Yemen\"],477:[\"HK\",\"HKG\",\"\",\"Hong Kong\"],478:[\"BA\",\"BIH\",\"\",\"Bosnia and Herzegovina\"],501:[\"FR\",\"FRA\",\"AQ\",\"Adelie Land\"],503:[\"AU\",\"AUS\",\"\",\"Australia\"],506:[\"MM\",\"MMR\",\"\",\"Myanmar\"],508:[\"BN\",\"BRN\",\"\",\"Brunei Darussalam\"],510:[\"FM\",\"FSM\",\"\",\"Micronesia\"],511:[\"PW\",\"PLW\",\"\",\"Palau\"],512:[\"NZ\",\"NZL\",\"\",\"New Zealand\"],514:[\"KH\",\"KHM\",\"\",\"Cambodia\"],515:[\"KH\",\"KHM\",\"\",\"Cambodia\"],516:[\"CX\",\"CXR\",\"\",\"Christmas Island\"],518:[\"CK\",\"COK\",\"\",\"Cook Islands\"],520:[\"FJ\",\"FJI\",\"\",\"Fiji\"],523:[\"CC\",\"CCK\",\"\",\"Cocos (Keeling) Islands\"],525:[\"ID\",\"IDN\",\"\",\"Indonesia\"],529:[\"KI\",\"KIR\",\"\",\"Kiribati\"],531:[\"LA\",\"LAO\",\"\",\"Lao People's Democratic Republic\"],533:[\"MY\",\"MYS\",\"\",\"Malaysia\"],536:[\"MP\",\"MNP\",\"\",\"Northern Mariana Islands\"],538:[\"MH\",\"MHL\",\"\",\"Marshall Islands\"],540:[\"NC\",\"NCL\",\"\",\"New Caledonia\"],542:[\"NU\",\"NIU\",\"\",\"Niue\"],544:[\"NR\",\"NRU\",\"\",\"Nauru\"],546:[\"PF\",\"PYF\",\"\",\"French Polynesia\"],548:[\"PH\",\"PHL\",\"\",\"Philippines\"],553:[\"PG\",\"PNG\",\"\",\"Papua New Guinea\"],555:[\"PN\",\"PCN\",\"\",\"Pitcairn Island\"],557:[\"SB\",\"SLB\",\"\",\"Solomon Islands\"],559:[\"AS\",\"ASM\",\"\",\"American Samoa\"],561:[\"WS\",\"WSM\",\"\",\"Samoa\"],563:[\"SG\",\"SGP\",\"\",\"Singapore\"],564:[\"SG\",\"SGP\",\"\",\"Singapore\"],565:[\"SG\",\"SGP\",\"\",\"Singapore\"],566:[\"SG\",\"SGP\",\"\",\"Singapore\"],567:[\"TH\",\"THA\",\"\",\"Thailand\"],570:[\"TO\",\"TON\",\"\",\"Tonga\"],572:[\"TV\",\"TUV\",\"\",\"Tuvalu\"],574:[\"VN\",\"VNM\",\"\",\"Viet Nam\"],576:[\"VU\",\"VUT\",\"\",\"Vanuatu\"],577:[\"VU\",\"VUT\",\"\",\"Vanuatu\"],578:[\"WF\",\"WLF\",\"\",\"Wallis and Futuna Islands\"],601:[\"ZA\",\"ZAF\",\"\",\"South Africa\"],603:[\"AO\",\"AGO\",\"\",\"Angola\"],605:[\"DZ\",\"DZA\",\"\",\"Algeria\"],607:[\"FR\",\"FRA\",\"TF\",\"Saint Paul and Amsterdam Islands\"],608:[\"GB\",\"GBR\",\"AC\",\"Ascension Island\"],609:[\"BI\",\"BDI\",\"\",\"Burundi\"],610:[\"BJ\",\"BEN\",\"\",\"Benin\"],611:[\"BW\",\"BWA\",\"\",\"Botswana\"],612:[\"CF\",\"CAF\",\"\",\"Central African Republic\"],613:[\"CM\",\"CMR\",\"\",\"Cameroon\"],615:[\"CG\",\"COG\",\"\",\"Congo\"],616:[\"KM\",\"COM\",\"\",\"Comoros\"],617:[\"CV\",\"CPV\",\"\",\"Cabo Verde\"],618:[\"FR\",\"FRA\",\"TF\",\"Crozet Archipelago\"],619:[\"CI\",\"CIV\",\"\",\"Ivory Coast\"],620:[\"KM\",\"COM\",\"\",\"Comoros\"],621:[\"DJ\",\"DJI\",\"\",\"Djibouti\"],622:[\"EG\",\"EGY\",\"\",\"Egypt\"],624:[\"ET\",\"ETH\",\"\",\"Ethiopia\"],625:[\"ER\",\"ERI\",\"\",\"Eritrea\"],626:[\"GA\",\"GAB\",\"\",\"Gabonese Republic\"],627:[\"GH\",\"GHA\",\"\",\"Ghana\"],629:[\"GM\",\"GMB\",\"\",\"Gambia\"],630:[\"GW\",\"GNB\",\"\",\"Guinea-Bissau\"],631:[\"GQ\",\"GNQ\",\"\",\"Equatorial Guinea\"],632:[\"GN\",\"GIN\",\"\",\"Guinea\"],633:[\"BF\",\"BFA\",\"\",\"Burkina Faso\"],634:[\"KE\",\"KEN\",\"\",\"Kenya\"],635:[\"FR\",\"FRA\",\"TF\",\"Kerguelen Islands\"],636:[\"LR\",\"LBR\",\"\",\"Liberia\"],637:[\"LR\",\"LBR\",\"\",\"Liberia\"],638:[\"SS\",\"SSD\",\"\",\"South Sudan\"],642:[\"LY\",\"LBY\",\"\",\"Libya\"],644:[\"LS\",\"LSO\",\"\",\"Lesotho\"],645:[\"MU\",\"MUS\",\"\",\"Mauritius\"],647:[\"MG\",\"MDG\",\"\",\"Madagascar\"],649:[\"ML\",\"MLI\",\"\",\"Mali\"],650:[\"MZ\",\"MOZ\",\"\",\"Mozambique\"],654:[\"MR\",\"MRT\",\"\",\"Mauritania\"],655:[\"MW\",\"MWI\",\"\",\"Malawi\"],656:[\"NE\",\"NER\",\"\",\"Niger\"],657:[\"NG\",\"NGA\",\"\",\"Nigeria\"],659:[\"NA\",\"NAM\",\"\",\"Namibia\"],660:[\"RE\",\"REU\",\"\",\"Reunion\"],661:[\"RW\",\"RWA\",\"\",\"Rwanda\"],662:[\"SD\",\"SDN\",\"\",\"Sudan\"],663:[\"SN\",\"SEN\",\"\",\"Senegal\"],664:[\"SC\",\"SYC\",\"\",\"Seychelles\"],665:[\"SH\",\"SHN\",\"\",\"Saint Helena\"],666:[\"SO\",\"SOM\",\"\",\"Somali Democratic Republic\"],667:[\"SL\",\"SLE\",\"\",\"Sierra Leone\"],668:[\"ST\",\"STP\",\"\",\"Sao Tome and Principe\"],669:[\"SZ\",\"SWZ\",\"\",\"Swaziland\"],670:[\"TD\",\"TCD\",\"\",\"Chad\"],671:[\"TG\",\"TGO\",\"\",\"Togolese Republic\"],672:[\"TN\",\"TUN\",\"\",\"Tunisian Republic\"],674:[\"TZ\",\"TZA\",\"\",\"Tanzania\"],675:[\"UG\",\"UGA\",\"\",\"Uganda\"],676:[\"CD\",\"COD\",\"\",\"Democratic Republic of the Congo\"],677:[\"TZ\",\"TZA\",\"\",\"Tanzania\"],678:[\"ZM\",\"ZMB\",\"\",\"Zambia\"],679:[\"ZW\",\"ZWE\",\"\",\"Zimbabwe\"],701:[\"AR\",\"ARG\",\"\",\"Argentine Republic\"],710:[\"BR\",\"BRA\",\"\",\"Brazil\"],720:[\"BO\",\"BOL\",\"\",\"Bolivia\"],725:[\"CL\",\"CHL\",\"\",\"Chile\"],730:[\"CO\",\"COL\",\"\",\"Colombia\"],735:[\"EC\",\"ECU\",\"\",\"Ecuador\"],740:[\"FK\",\"FLK\",\"\",\"Falkland Islands\"],745:[\"GF\",\"GUF\",\"\",\"Guiana\"],750:[\"GY\",\"GUY\",\"\",\"Guyana\"],755:[\"PY\",\"PRY\",\"\",\"Paraguay\"],760:[\"PE\",\"PER\",\"\",\"Peru\"],765:[\"SR\",\"SUR\",\"\",\"Suriname\"],770:[\"UY\",\"URY\",\"\",\"Uruguay\"],775:[\"VE\",\"VEN\",\"\",\"Venezuela\"]}).reduce((t,[e,[i]])=>(t[e]=i.toLowerCase(),t),{});Object.values(CH).reduce((t,e)=>(t[e.iso3.toLocaleLowerCase()]=e.iso2,t),{});const Mq=[{key:\"cargo\",label:\"Marchandises\",aisTypes:[\"cargo\"],color:\"#78f48b\"},{key:\"tanker\",label:\"Tanker\",aisTypes:[\"tanker\"],color:\"#ff272d\"},{key:\"passenger\",label:\"Passagers\",aisTypes:[\"passenger\"],color:\"#0623c9\"},{key:\"submarine\",label:\"Op\\xe9rations sous-marines\",aisTypes:[\"towing\",\"dredger\",\"diving\"],color:\"#1adde5\"},{key:\"tug\",label:\"Remorquage\",aisTypes:[\"tug\"],color:\"#9a460f\"},{key:\"fishing\",label:\"P\\xeache\",aisTypes:[\"fishing\"],color:\"#f78851\"},{key:\"leisure\",label:\"Plaisance\",aisTypes:[\"sailing\",\"leisure\"],color:\"#ff29ff\"},{key:\"military\",label:\"Militaire\",aisTypes:[\"military\"],color:\"#5910d0\"},{key:\"other\",label:\"Autre\",aisTypes:[\"other\"],color:\"#e1cf15\"},{key:\"default\",label:\"Non sp\\xe9cifi\\xe9\",aisTypes:[\"unspecified\"],color:\"#cccccc\"}];Mq.forEach(t=>{t.rgbColor=TH(t.color),t.textColor=PH(t.color,20)}),Mq.reduce((t,e)=>(t[e.key]=e,t),{}),Mq.flatMap(t=>t.aisTypes.map(e=>[e,t])).reduce((t,[e,i])=>(t[e]=i,t),{});const Tq=[{key:\"sar-aircraft\",label:\"111xx - A\\xe9ronefs SAR\"},{key:\"ship\",label:\"2-7xx - Navires\"},{key:\"handheld\",label:\"8xx - Appareils portatifs\"},{key:\"sart\",label:\"970xx - Recherche et sauvetage\"},{key:\"mob\",label:\"972xx - Personne \\xe0 la mer\"},{key:\"rls\",label:\"974xx - Radiobalises de localisation des sinistres\"},{key:\"secondary-craft\",label:\"98xx - Engins secondaires\"},{key:\"aton\",label:\"99xx - Aides \\xe0 la navigation\"},{key:\"beacon-other\",label:\"9x - Autres balises\"}];function Iq(t,e){var i,n,s;let r=!1;if(t.colorResultTimestamp=0,!e.colorModeShipType)if(e.isMissingColorFilterConfiguration||e.frozenTimestamp)r=!0;else{let i=0;if(e.alertRules.length>0){const n=t.lastAlerts.find(t=>e.alertRules.includes(t.rule_id));n&&(i=n.timestamp)}let n=0;if(e.eventTypes.length>0){const i=t.lastEvents.find(t=>e.eventTypes.includes(t.type));i&&(n=i.timestamp)}t.colorResultTimestamp=Math.max(i,n),r=t.colorResultTimestamp>=e.absoluteMinimumTimestamp}t.stationary=t.stationary||t.sog&&parseFloat(t.sog)<1,t.visible=t.selected||(!e.restrictedShips.size||e.restrictedShips.has(t.mmsi))&&t.timestamp>=e.absoluteVisibilityThresholdTimestamp&&(!e.shipAISTypes.length||e.shipAISTypes.includes(t.aisType))&&(!e.shipTypes.length||!!e.shipTypesCache[t.cargo])&&(!e.shipLloydsTypes.length||e.shipLloydsTypes.includes(t.lloydsType))&&(!e.shipFlags.length||!!e.shipFlagsCache[t.country.flag])&&(!e.shipDestinations.length||t.destination&&e.shipDestinations.some(e=>t.destination.includes(e)))&&(!e.shipDepartures.length||t.departure&&e.shipDepartures.some(e=>t.departure.includes(e)))&&(!e.shipStatus.length||e.shipStatus.includes(t.status))&&(!e.shipSpeed||e.shipSpeed.min<=t.numberSog&&t.numberSog<=e.shipSpeed.max)&&(!e.shipLength||e.shipLength.min<=t.length&&t.length<=e.shipLength.max)&&(!e.shipWidth||e.shipWidth.min<=t.width&&t.width<=e.shipWidth.max)&&(!e.shipDraught||e.shipDraught.min<=t.numberDraught&&t.numberDraught<=e.shipDraught.max)&&(!e.shipYearofbuild||e.shipYearofbuild.min<=t.yearofbuild&&t.yearofbuild<=e.shipYearofbuild.max||e.shipYearofbuildIncludeNulls&&0===t.yearofbuild)&&(!e.shipCourse||(e.shipCourse.min<e.shipCourse.max?e.shipCourse.min<=t.numberCog&&t.numberCog<=e.shipCourse.max:e.shipCourse.min<=t.numberCog||t.numberCog<=e.shipCourse.max))&&(!e.fleets.length||e.fleetsShipsCache.has(t.mmsi))&&(!e.shipIdentifier.length||(null===(i=t.name)||void 0===i?void 0:i.includes(e.shipIdentifier))||(null===(n=t.mmsi)||void 0===n?void 0:n.includes(e.shipIdentifier))||(null===(s=t.imo)||void 0===s?void 0:s.includes(e.shipIdentifier)))&&(e.colorModeShipType||e.colorModeAllShips||e.colorModeResultsOnly&&r)&&(0===e.selectedShips.size||e.frozenTimestamp>0||!e.selectedShips.has(t.mmsi)),t.transparent=t.timestamp<=e.absoluteTransparencyThresholdTimestamp}function Pq(t,e,i){if(i)for(;t.positionIndex>0&&t.positions[t.positionIndex].timestamp>e;)t.positionIndex--;else for(;t.positionIndex<t.positions.length-1&&t.positions[t.positionIndex+1].timestamp<e;)t.positionIndex++;const n=t.positions[t.positionIndex],s=e<=t.positions[0].timestamp||t.positionIndex===t.positions.length-1;t.visible=!s,t.position=s?[n.lon,n.lat]:function(t,e,i){const n=(i-t.timestamp)/(e.timestamp-t.timestamp);return[t.lon+(e.lon-t.lon)*n,t.lat+(e.lat-t.lat)*n]}(n,t.positions[t.positionIndex+1],e),t.course=n.course,t.speed=n.speed}const Oq=[1,2,5,10,20,30];let Rq=(()=>{class t{constructor(t){this.workerService=t,this.active$=new Jp(!1),this.startTimestamp$=new Jp(0),this.duration$=new Jp(0),this.shipsByMMSI$=new Jp(null),this.animationTimestamp$=new Jp(0),this.paused$=new Jp(!0),this.reverseMode$=new Jp(!1),this.animationSpeed$=new Jp(10),this.lastFrameMs=0,this.viewExtent=null,this.animate=t=>{const e=this.animationTimestamp$.value+(this.reverseMode$.value?-1:1)*this.animationSpeed$.value*(t-this.lastFrameMs)*.006;this.lastFrameMs=t;const i=this.reverseMode$.value;Object.values(this.shipsByMMSI$.value).forEach(t=>{Pq(t,e,i)}),this.animationTimestamp$.next(e),this.reverseMode$.value?e-this.minTimestamp<900&&(this.minTimestamp=this.minTimestamp-this.duration$.value,this.loadChunk(this.minTimestamp,this.duration$.value)):this.maxTimestamp-e<900&&(this.loadChunk(this.maxTimestamp,this.duration$.value),this.maxTimestamp=this.maxTimestamp+this.duration$.value),this.animationFrameTimeout=requestAnimationFrame(this.animate)},this.paused$.subscribe(t=>{t?cancelAnimationFrame(this.animationFrameTimeout):requestAnimationFrame(t=>{this.lastFrameMs=t,this.animationFrameTimeout=requestAnimationFrame(this.animate)})})}enterPlaybackMode(){this.active$.next(!0)}exitPlaybackMode(){cancelAnimationFrame(this.animationFrameTimeout),this.shipsByMMSI$.next(null),this.active$.next(!1)}loadPlayback(t,e){return Hp(this,void 0,void 0,function*(){this.startTimestamp$.next(t),this.duration$.next(e),this.minTimestamp=t-e,this.maxTimestamp=t+e,this.paused$.next(!0),this.reverseMode$.next(!1),this.shipsByMMSI$.next({}),yield Promise.all([this.loadChunk(t-e,e),this.loadChunk(t,e)]),Object.values(this.shipsByMMSI$.value).forEach(e=>{Pq(e,t,!1)}),this.animationTimestamp$.next(t)})}reinitiate(){this.animationTimestamp$.next(this.startTimestamp$.value)}loadChunk(t,e){return Hp(this,void 0,void 0,function*(){const i=yield this.workerService.ships.getShipsPlaybackAtBboxAndTimestamp(this.viewExtent,t,e),n=this.shipsByMMSI$.value;console.time(\"assemble chunk\");const s=this.reverseMode$.value;i.forEach(t=>{if(n[t.mmsi]){const e=n[t.mmsi];e.positions=e.positions.concat(t.positions).sort((t,e)=>t.timestamp-e.timestamp),e.positionIndex=s?e.positions.length-1:0;const i=e.positions,r=i.length-1;for(let t=0;t<r;t++)if(i[t].chunkEnd){const e=[i[t].lon,i[t].lat],n=[i[t+1].lon,i[t+1].lat];i[t].course=(2*Math.PI+Math.PI/2-VU(e,n))%(2*Math.PI),i[t].speed=Math.round(10*$U(e,n,i[t+1].timestamp-i[t].timestamp))/10}}else n[t.mmsi]=t});const r=this.animationTimestamp$.value,o=this.reverseMode$.value;Object.values(n).forEach(t=>{Pq(t,r,o)}),console.timeEnd(\"assemble chunk\"),this.shipsByMMSI$.next(n)})}togglePause(){this.paused$.next(!this.paused$.value)}toggleReverseMode(){this.reverseMode$.next(!this.reverseMode$.value)}updateSpeed(t){const e=Oq.indexOf(this.animationSpeed$.value);\"-\"===t?e>0&&this.animationSpeed$.next(Oq[e-1]):e<Oq.length-1&&this.animationSpeed$.next(Oq[e+1])}updateViewBox(t){this.viewExtent=t}}return t.\\u0275fac=function(e){return new(e||t)(Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const Dq=[-1165201.47,4946429.48,1168528.74,6341728.49];let Lq=(()=>{class t{constructor(t,e){this.mapService=t,this.mapConfigService=e,this.isConfiguringZonex$=new Jp(!1),this.selectedZonex=[]}enterConfigurationMode(){this.isConfiguringZonex$.next(!0),this.mapService.fitOn(Dq),this.selectedZonex=[...this.mapConfigService.displayedZonex$.value]}saveConfiguration(){this.mapConfigService.updateDisplayedZonex(this.selectedZonex),this.cancelConfiguration()}cancelConfiguration(){this.isConfiguringZonex$.next(!1),this.selectedZonex=[]}toggleSelection(t){const e=this.selectedZonex.indexOf(t);-1!==e?this.selectedZonex.splice(e,1):this.selectedZonex.push(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(Pj),Mn(qU))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Fq=(()=>{class t{constructor(t,e,i,n,s,r,o,a,l,c,h,u){this.alertsService=t,this.alertRulesService=e,this.annotationService=i,this.drawingService=n,this.historyService=s,this.mapConfigService=r,this.measureService=o,this.modificationEditionService=a,this.pimService=l,this.playbackService=c,this.routeService=h,this.zonexService=u,this.coordinateSystem$=new Jp(H$.find(t=>\"dms\"===t.key));const d=this.routeService.route$.pipe(M(t=>\"/zones\"===t),Tf()),p=this.routeService.route$.pipe(M(t=>\"/moves\"===t),Tf()),f=this.routeService.route$.pipe(M(t=>\"/ports\"===t),Tf()),m=this.routeService.route$.pipe(M(t=>t.startsWith(\"/modifications\")),Tf()),g=this.routeService.route$.pipe(M(t=>t.startsWith(\"/alerts/rules/\")),Tf()),A=this.routeService.route$.pipe(M(t=>\"/annotations\"===t),Tf());this.mustHideEntities$=JT([d,g,this.playbackService.active$,this.zonexService.isConfiguringZonex$]).pipe(M(([t,e,i,n])=>t||e||i||n),Tf()),this.minimumZoom$=JT([this.historyService.timestamp$.pipe(M(t=>!!t)),this.mapConfigService.limitMinimumZoom$,this.alertRulesService.selectedAlertRuleId$,d,p]).pipe(M(([t,e,i,n,s])=>t?7:i||n?2.5:s?5:e?6:2.5),Tf()),this.featuresSelectable$=JT([p,this.annotationService.editedAnnotation$.pipe(M(t=>!!t)),this.drawingService.drawingZoneMode$,this.measureService.active$,this.pimService.active$,this.zonexService.isConfiguringZonex$,this.modificationEditionService.modification$.pipe(M(t=>!!t))]).pipe(M(([t,e,i,n,s,r,o])=>!(t||e||i||n||s||r||o)),Tf()),this.showShipsLayer$=JT([this.mapConfigService.showShipsLayer$,this.mustHideEntities$.pipe(pf(500))]).pipe(M(([t,e])=>t&&!e),Tf()),this.showAircraftsLayer$=JT([this.mapConfigService.showAircraftsLayer$,this.mustHideEntities$.pipe(pf(500))]).pipe(M(([t,e])=>t&&!e),Tf()),this.showAnnotationsLayer$=JT([this.mapConfigService.showAnnotationsLayer$,A,this.annotationService.editedAnnotation$.pipe(M(t=>!!t)),this.zonexService.isConfiguringZonex$]).pipe(M(([t,e,i,n])=>(t||e||i)&&!n),Tf()),this.showPortsLayer$=JT([this.mapConfigService.showPortsLayer$,f,m]).pipe(M(([t,e,i])=>t||e||i),Tf()),this.isPortsSelectable$=this.modificationEditionService.portEdition$.pipe(M(t=>!t),Tf()),this.selectableHexagons$=this.drawingService.drawingZoneMode$.pipe(Tf()),this.showHexagonsLayer$=JT([this.selectableHexagons$,this.mapConfigService.showHexagonsLayer$,p]).pipe(M(([t,e,i])=>t||e&&!i),Tf()),this.showEdgesLayer$=p.pipe(Tf()),this.showTrailsLayer$=JT([this.mapConfigService.showTrailsLayer$,this.mustHideEntities$]).pipe(M(([t,e])=>t&&!e),Tf()),this.showSelectionMarkers$=this.mustHideEntities$.pipe(M(t=>!t),Tf()),this.showEntitiesSelections$=JT([this.mapConfigService.enableMultiSelectionMode$,this.mustHideEntities$]).pipe(M(([t,e])=>t&&!e),Tf()),this.showAlertsLayer$=JT([this.alertsService.alerts$,this.mustHideEntities$]).pipe(M(([t,e])=>t.length>0||!e),Tf()),this.showEventsLayer$=this.showAlertsLayer$,this.mapConfigService.coordinateSystem$.subscribe(t=>{this.coordinateSystem$.next(H$.find(e=>e.key===t))}),this.defaultCursorHandling$=this.modificationEditionService.portEdition$.pipe(M(t=>!t),Tf())}}return t.\\u0275fac=function(e){return new(e||t)(Mn(LH),Mn(DH),Mn(BH),Mn(zH),Mn(Fj),Mn(qU),Mn(eG),Mn(fW),Mn(xq),Mn(Rq),Mn(Nj),Mn(Lq))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function Nq(t){return new Promise((e,i)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>i(t.error)})}let Bq;function zq(){return Bq||(Bq=function(t,e){const i=function(){var t;return!navigator.userAgentData&&/Safari\\//.test(navigator.userAgent)&&!/Chrom(e|ium)\\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var i=function(){return indexedDB.databases().finally(e)};t=setInterval(i,100),i()}).finally(function(){return clearInterval(t)}):Promise.resolve()}().then(()=>{const t=indexedDB.open(\"keyval-store\");return t.onupgradeneeded=()=>t.result.createObjectStore(e),Nq(t)});return(t,n)=>i.then(i=>n(i.transaction(e,t).objectStore(e)))}(0,\"keyval\")),Bq}function Vq(t,e=zq()){return e(\"readonly\",e=>Nq(e.get(t)))}function $q(t,e,i=zq()){return i(\"readwrite\",i=>(i.put(e,t),Nq(i.transaction)))}class Uq{constructor(t){this.config=t,this.progress=new Jp(null),this.progress$=this.progress.asObservable(),this.incrementCounter=()=>{this.progress.value.progressCounter++,this.progress.value.progressPercentage=this.progress.value.progressCounter/this.progress.value.stepTotal*100,this.progress.next(this.progress.value)}}execute(t){var e;return Hp(this,void 0,void 0,function*(){this.progress.next({numberOfSteps:this.config.numberOfSteps,stepTitle:t.title,stepTotal:t.total,stepNumber:this.progress.value?(null===(e=this.progress.value)||void 0===e?void 0:e.stepNumber)+1:this.config.initialStep?this.config.initialStep:1,progressCounter:0,progressPercentage:0}),yield t.action(this.incrementCounter)})}}const jq=\"offline-config\",Hq=\"offline-user-data\";let Gq=(()=>{class t{constructor(){this.subscriptions=[],this.eventListeners=[]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.eventListeners.forEach(i$)}ensureMandatoryInputParams(...t){t.forEach(t=>{if(void 0===this[t])throw new Error(`Missing input property '${t}'`)})}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t}),t})();function Wq(t=0,e=df){return(!rg(t)||t<0)&&(t=0),(!e||\"function\"!=typeof e.schedule)&&(e=df),new b(i=>(i.add(e.schedule(qq,t,{subscriber:i,counter:0,period:t})),i))}function qq(t){const{subscriber:e,counter:i,period:n}=t;e.next(i),this.schedule({subscriber:e,counter:i+1,period:n},n)}let Yq=(()=>{class t{constructor(){this.userAFK$=new Jp(!1),document.addEventListener(\"visibilitychange\",()=>{\"visible\"===document.visibilityState?(clearTimeout(this.afkTimeout),this.userAFK$.next(!1)):this.afkTimeout=setTimeout(()=>{this.userAFK$.next(!0)},9e5)})}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Zq=(()=>{class t{constructor(t,e,i,n,s){this.authenticationService=t,this.mapConfigService=e,this.historyService=i,this.offlineService=n,this.visibilityService=s,this.refresh$=new C,this.pause$=new Jp(!1),this.tap=()=>{this.refreshTimer&&this.refreshTimer.unsubscribe(),this.refreshTimer=Wq(this.mapConfigService.shipRefreshInterval$.value).pipe(Af(()=>this.authenticationService.isAuthenticated()),Af(()=>!this.pause$.value),Af(()=>!this.visibilityService.userAFK$.value),Af(()=>0===this.historyService.timestamp$.value)).subscribe(()=>{this.refresh$.next()})},this.offlineService.isOffline$.subscribe(t=>{this.setPause(t)}),this.mapConfigService.shipRefreshInterval$.subscribe(()=>{this.tap()}),this.pause$.subscribe(t=>{t||(this.tap(),this.refresh$.next())})}destroy(){this.setPause(!1),this.refreshTimer.unsubscribe()}togglePause(){this.pause$.next(!this.pause$.value)}setPause(t){this.pause$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(rH),Mn(qU),Mn(Fj),Mn(MY),Mn(Yq))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Kq=(()=>{class t{constructor(t,e){this.configService=t,this.refreshTimerService=e,this.timeRange$=new Jp(null),this.reset(),this.refreshTimerService.refresh$.subscribe(()=>{this.refresh()})}reset(){this.timeRange$.next(LU[this.configService.defaultTimeRange].refresh())}refresh(){this.timeRange$.value.isCustom||this.timeRange$.next(this.timeRange$.value.refresh())}updateTimeRange(t){this.timeRange$.next(t.refresh())}setCustom(t,e){this.timeRange$.next(this.timeRange$.value.setCustom(t,e))}setRelative(t){this.timeRange$.next(this.timeRange$.value.setRelative(t))}goBackward(){this.timeRange$.next(this.timeRange$.value.shift(-this.timeRange$.value.value/2))}goForward(){this.timeRange$.next(this.timeRange$.value.shift(this.timeRange$.value.value/2))}extendBackward(){this.timeRange$.next(this.timeRange$.value.extend(-this.timeRange$.value.value/2))}extendForward(){this.timeRange$.next(this.timeRange$.value.extend(this.timeRange$.value.value/2))}}return t.\\u0275fac=function(e){return new(e||t)(Mn(WU),Mn(Zq))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Xq=(()=>{class t{constructor(){this._vertical=!1,this._inset=!1}get vertical(){return this._vertical}set vertical(t){this._vertical=Lf(t)}get inset(){return this._inset}set inset(t){this._inset=Lf(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-divider\"]],hostAttrs:[\"role\",\"separator\",1,\"mat-divider\"],hostVars:7,hostBindings:function(t,e){2&t&&(ia(\"aria-orientation\",e.vertical?\"vertical\":\"horizontal\"),hl(\"mat-divider-vertical\",e.vertical)(\"mat-divider-horizontal\",!e.vertical)(\"mat-divider-inset\",e.inset))},inputs:{vertical:\"vertical\",inset:\"inset\"},decls:0,vars:0,template:function(t,e){},styles:[\".mat-divider{display:block;margin:0;border-top-width:1px;border-top-style:solid}.mat-divider.mat-divider-vertical{border-top:0;border-right-width:1px;border-right-style:solid}.mat-divider.mat-divider-inset{margin-left:80px}[dir=rtl] .mat-divider.mat-divider-inset{margin-left:auto;margin-right:80px}\\n\"],encapsulation:2,changeDetection:0}),t})(),Qq=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[Fb],Fb]}),t})(),Jq=(()=>{class t{constructor(t){this.viewContainerRef=t}ngOnInit(){const t=this.viewContainerRef.element.nativeElement;t.addEventListener(\"click\",()=>Hp(this,void 0,void 0,function*(){const e=Date.now();t.disabled=!0,t.style.width=`${t.offsetWidth}px`,t.style.height=`${t.offsetHeight}px`;const i=t.children[0].innerHTML;t.children[0].innerHTML='\\n<mat-spinner role=\"progressbar\" mode=\"indeterminate\" class=\"async-button\">\\n  <svg class=\"async-button__svg\" preserveAspectRatio=\"xMidYMid meet\" focusable=\"false\" viewBox=\"0 0 16.4 16.4\">\\n    <circle class=\"async-button__circle\" cx=\"50%\" cy=\"50%\" r=\"7\">\\n    </circle>\\n  </svg>\\n</mat-spinner>';try{yield this.action()}finally{const n=Date.now()-e;n<300&&(yield hU(300-n)),t.children[0].innerHTML=i,t.style.width=\"\",t.style.height=\"\",t.disabled=!1}}))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Vc))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"app-async-action\",\"\"]],inputs:{action:[\"app-async-action\",\"action\"]}}),t})();const tY=[\"input\"],eY=function(t){return{enterDuration:t}},iY=[\"*\"],nY=new Ji(\"mat-checkbox-default-options\",{providedIn:\"root\",factory:sY});function sY(){return{color:\"accent\",clickAction:\"check-indeterminate\"}}let rY=0;const oY=sY(),aY={provide:Uy,useExisting:at(()=>hY),multi:!0};class lY{}const cY=Vb(Bb(zb(Nb(class{constructor(t){this._elementRef=t}}))));let hY=(()=>{class t extends cY{constructor(t,e,i,n,s,r,o){super(t),this._changeDetectorRef=e,this._focusMonitor=i,this._ngZone=n,this._animationMode=r,this._options=o,this.ariaLabel=\"\",this.ariaLabelledby=null,this._uniqueId=\"mat-checkbox-\"+ ++rY,this.id=this._uniqueId,this.labelPosition=\"after\",this.name=null,this.change=new gh,this.indeterminateChange=new gh,this._onTouched=()=>{},this._currentAnimationClass=\"\",this._currentCheckState=0,this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||oY,this.color=this.defaultColor=this._options.color||oY.color,this.tabIndex=parseInt(s)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(t){this._required=Lf(t)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{t||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngAfterViewChecked(){}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(t){t!=this.checked&&(this._checked=t,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(t){const e=Lf(t);e!==this.disabled&&(this._disabled=e,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(t){const e=t!=this._indeterminate;this._indeterminate=Lf(t),e&&(this._transitionCheckState(this._indeterminate?3:this.checked?1:2),this.indeterminateChange.emit(this._indeterminate)),this._syncIndeterminate(this._indeterminate)}_isRippleDisabled(){return this.disableRipple||this.disabled}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(t){this.checked=!!t}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t}_getAriaChecked(){return this.checked?\"true\":this.indeterminate?\"mixed\":\"false\"}_transitionCheckState(t){let e=this._currentCheckState,i=this._elementRef.nativeElement;if(e!==t&&(this._currentAnimationClass.length>0&&i.classList.remove(this._currentAnimationClass),this._currentAnimationClass=this._getAnimationClassForCheckStateTransition(e,t),this._currentCheckState=t,this._currentAnimationClass.length>0)){i.classList.add(this._currentAnimationClass);const t=this._currentAnimationClass;this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{i.classList.remove(t)},1e3)})}}_emitChangeEvent(){const t=new lY;t.source=this,t.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(t),this._inputElement&&(this._inputElement.nativeElement.checked=this.checked)}toggle(){this.checked=!this.checked}_onInputClick(t){var e;const i=null===(e=this._options)||void 0===e?void 0:e.clickAction;t.stopPropagation(),this.disabled||\"noop\"===i?!this.disabled&&\"noop\"===i&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&\"check\"!==i&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this.toggle(),this._transitionCheckState(this._checked?1:2),this._emitChangeEvent())}focus(t,e){t?this._focusMonitor.focusVia(this._inputElement,t,e):this._inputElement.nativeElement.focus(e)}_onInteractionEvent(t){t.stopPropagation()}_getAnimationClassForCheckStateTransition(t,e){if(\"NoopAnimations\"===this._animationMode)return\"\";let i=\"\";switch(t){case 0:if(1===e)i=\"unchecked-checked\";else{if(3!=e)return\"\";i=\"unchecked-indeterminate\"}break;case 2:i=1===e?\"unchecked-checked\":\"unchecked-indeterminate\";break;case 1:i=2===e?\"checked-unchecked\":\"checked-indeterminate\";break;case 3:i=1===e?\"indeterminate-checked\":\"indeterminate-unchecked\"}return`mat-checkbox-anim-${i}`}_syncIndeterminate(t){const e=this._inputElement;e&&(e.nativeElement.indeterminate=t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa(Vm),Oa(nu),Yi(\"tabindex\"),Oa(wb,8),Oa(nY,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-checkbox\"]],viewQuery:function(t,e){if(1&t&&(Th(tY,5),Th(py,5)),2&t){let t;Mh(t=Ph())&&(e._inputElement=t.first),Mh(t=Ph())&&(e.ripple=t.first)}},hostAttrs:[1,\"mat-checkbox\"],hostVars:12,hostBindings:function(t,e){2&t&&(Il(\"id\",e.id),ia(\"tabindex\",null),hl(\"mat-checkbox-indeterminate\",e.indeterminate)(\"mat-checkbox-checked\",e.checked)(\"mat-checkbox-disabled\",e.disabled)(\"mat-checkbox-label-before\",\"before\"==e.labelPosition)(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode))},inputs:{disableRipple:\"disableRipple\",color:\"color\",tabIndex:\"tabIndex\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],id:\"id\",labelPosition:\"labelPosition\",name:\"name\",required:\"required\",checked:\"checked\",disabled:\"disabled\",indeterminate:\"indeterminate\",ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"],value:\"value\"},outputs:{change:\"change\",indeterminateChange:\"indeterminateChange\"},exportAs:[\"matCheckbox\"],features:[Yl([aY]),Uo],ngContentSelectors:iY,decls:17,vars:21,consts:[[1,\"mat-checkbox-layout\"],[\"label\",\"\"],[1,\"mat-checkbox-inner-container\"],[\"type\",\"checkbox\",1,\"mat-checkbox-input\",\"cdk-visually-hidden\",3,\"id\",\"required\",\"checked\",\"disabled\",\"tabIndex\",\"change\",\"click\"],[\"input\",\"\"],[\"matRipple\",\"\",1,\"mat-checkbox-ripple\",\"mat-focus-indicator\",3,\"matRippleTrigger\",\"matRippleDisabled\",\"matRippleRadius\",\"matRippleCentered\",\"matRippleAnimation\"],[1,\"mat-ripple-element\",\"mat-checkbox-persistent-ripple\"],[1,\"mat-checkbox-frame\"],[1,\"mat-checkbox-background\"],[\"version\",\"1.1\",\"focusable\",\"false\",\"viewBox\",\"0 0 24 24\",0,\"xml\",\"space\",\"preserve\",\"aria-hidden\",\"true\",1,\"mat-checkbox-checkmark\"],[\"fill\",\"none\",\"stroke\",\"white\",\"d\",\"M4.1,12.7 9,17.6 20.3,6.3\",1,\"mat-checkbox-checkmark-path\"],[1,\"mat-checkbox-mixedmark\"],[1,\"mat-checkbox-label\",3,\"cdkObserveContent\"],[\"checkboxLabel\",\"\"],[2,\"display\",\"none\"]],template:function(t,e){if(1&t&&(Qa(),La(0,\"label\",0,1),La(2,\"span\",2),La(3,\"input\",3,4),Ga(\"change\",function(t){return e._onInteractionEvent(t)})(\"click\",function(t){return e._onInputClick(t)}),Fa(),La(5,\"span\",5),Na(6,\"span\",6),Fa(),Na(7,\"span\",7),La(8,\"span\",8),hi(),La(9,\"svg\",9),Na(10,\"path\",10),Fa(),ui(),Na(11,\"span\",11),Fa(),Fa(),La(12,\"span\",12,13),Ga(\"cdkObserveContent\",function(){return e._onLabelTextChange()}),La(14,\"span\",14),xl(15,\"\\xa0\"),Fa(),Ja(16),Fa(),Fa()),2&t){const t=aa(1),i=aa(13);ia(\"for\",e.inputId),Cr(2),hl(\"mat-checkbox-inner-container-no-side-margin\",!i.textContent||!i.textContent.trim()),Cr(1),Ra(\"id\",e.inputId)(\"required\",e.required)(\"checked\",e.checked)(\"disabled\",e.disabled)(\"tabIndex\",e.tabIndex),ia(\"value\",e.value)(\"name\",e.name)(\"aria-label\",e.ariaLabel||null)(\"aria-labelledby\",e.ariaLabelledby)(\"aria-checked\",e._getAriaChecked())(\"aria-describedby\",e.ariaDescribedby),Cr(2),Ra(\"matRippleTrigger\",t)(\"matRippleDisabled\",e._isRippleDisabled())(\"matRippleRadius\",20)(\"matRippleCentered\",!0)(\"matRippleAnimation\",ih(19,eY,\"NoopAnimations\"===e._animationMode?0:150))}},directives:[py,am],styles:[\"@keyframes mat-checkbox-fade-in-background{0%{opacity:0}50%{opacity:1}}@keyframes mat-checkbox-fade-out-background{0%,50%{opacity:1}100%{opacity:0}}@keyframes mat-checkbox-unchecked-checked-checkmark-path{0%,50%{stroke-dashoffset:22.910259}50%{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1)}100%{stroke-dashoffset:0}}@keyframes mat-checkbox-unchecked-indeterminate-mixedmark{0%,68.2%{transform:scaleX(0)}68.2%{animation-timing-function:cubic-bezier(0, 0, 0, 1)}100%{transform:scaleX(1)}}@keyframes mat-checkbox-checked-unchecked-checkmark-path{from{animation-timing-function:cubic-bezier(0.4, 0, 1, 1);stroke-dashoffset:0}to{stroke-dashoffset:-22.910259}}@keyframes mat-checkbox-checked-indeterminate-checkmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1);opacity:1;transform:rotate(0deg)}to{opacity:0;transform:rotate(45deg)}}@keyframes mat-checkbox-indeterminate-checked-checkmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);opacity:0;transform:rotate(45deg)}to{opacity:1;transform:rotate(360deg)}}@keyframes mat-checkbox-checked-indeterminate-mixedmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1);opacity:0;transform:rotate(-45deg)}to{opacity:1;transform:rotate(0deg)}}@keyframes mat-checkbox-indeterminate-checked-mixedmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);opacity:1;transform:rotate(0deg)}to{opacity:0;transform:rotate(315deg)}}@keyframes mat-checkbox-indeterminate-unchecked-mixedmark{0%{animation-timing-function:linear;opacity:1;transform:scaleX(1)}32.8%,100%{opacity:0;transform:scaleX(0)}}.mat-checkbox-background,.mat-checkbox-frame{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:2px;box-sizing:border-box;pointer-events:none}.mat-checkbox{display:inline-block;transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);cursor:pointer;-webkit-tap-highlight-color:transparent}._mat-animation-noopable.mat-checkbox{transition:none;animation:none}.mat-checkbox .mat-ripple-element:not(.mat-checkbox-persistent-ripple){opacity:.16}.mat-checkbox .mat-checkbox-ripple{position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.cdk-high-contrast-active .mat-checkbox.cdk-keyboard-focused .mat-checkbox-ripple{outline:solid 3px}.mat-checkbox-layout{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:inherit;align-items:baseline;vertical-align:middle;display:inline-flex;white-space:nowrap}.mat-checkbox-label{-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto}.mat-checkbox-inner-container{display:inline-block;height:16px;line-height:0;margin:auto;margin-right:8px;order:0;position:relative;vertical-align:middle;white-space:nowrap;width:16px;flex-shrink:0}[dir=rtl] .mat-checkbox-inner-container{margin-left:8px;margin-right:auto}.mat-checkbox-inner-container-no-side-margin{margin-left:0;margin-right:0}.mat-checkbox-frame{background-color:transparent;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1);border-width:2px;border-style:solid}._mat-animation-noopable .mat-checkbox-frame{transition:none}.mat-checkbox-background{align-items:center;display:inline-flex;justify-content:center;transition:background-color 90ms cubic-bezier(0, 0, 0.2, 0.1),opacity 90ms cubic-bezier(0, 0, 0.2, 0.1);-webkit-print-color-adjust:exact;color-adjust:exact}._mat-animation-noopable .mat-checkbox-background{transition:none}.cdk-high-contrast-active .mat-checkbox .mat-checkbox-background{background:none}.mat-checkbox-persistent-ripple{display:block;width:100%;height:100%;transform:none}.mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{opacity:.04}.mat-checkbox.cdk-keyboard-focused .mat-checkbox-persistent-ripple{opacity:.12}.mat-checkbox-persistent-ripple,.mat-checkbox.mat-checkbox-disabled .mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{opacity:0}@media(hover: none){.mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{display:none}}.mat-checkbox-checkmark{top:0;left:0;right:0;bottom:0;position:absolute;width:100%}.mat-checkbox-checkmark-path{stroke-dashoffset:22.910259;stroke-dasharray:22.910259;stroke-width:2.1333333333px}.cdk-high-contrast-black-on-white .mat-checkbox-checkmark-path{stroke:#000 !important}.mat-checkbox-mixedmark{width:calc(100% - 6px);height:2px;opacity:0;transform:scaleX(0) rotate(0deg);border-radius:2px}.cdk-high-contrast-active .mat-checkbox-mixedmark{height:0;border-top:solid 2px;margin-top:2px}.mat-checkbox-label-before .mat-checkbox-inner-container{order:1;margin-left:8px;margin-right:auto}[dir=rtl] .mat-checkbox-label-before .mat-checkbox-inner-container{margin-left:auto;margin-right:8px}.mat-checkbox-checked .mat-checkbox-checkmark{opacity:1}.mat-checkbox-checked .mat-checkbox-checkmark-path{stroke-dashoffset:0}.mat-checkbox-checked .mat-checkbox-mixedmark{transform:scaleX(1) rotate(-45deg)}.mat-checkbox-indeterminate .mat-checkbox-checkmark{opacity:0;transform:rotate(45deg)}.mat-checkbox-indeterminate .mat-checkbox-checkmark-path{stroke-dashoffset:0}.mat-checkbox-indeterminate .mat-checkbox-mixedmark{opacity:1;transform:scaleX(1) rotate(0deg)}.mat-checkbox-unchecked .mat-checkbox-background{background-color:transparent}.mat-checkbox-disabled{cursor:default}.cdk-high-contrast-active .mat-checkbox-disabled{opacity:.5}.mat-checkbox-anim-unchecked-checked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-in-background}.mat-checkbox-anim-unchecked-checked .mat-checkbox-checkmark-path{animation:180ms linear 0ms mat-checkbox-unchecked-checked-checkmark-path}.mat-checkbox-anim-unchecked-indeterminate .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-in-background}.mat-checkbox-anim-unchecked-indeterminate .mat-checkbox-mixedmark{animation:90ms linear 0ms mat-checkbox-unchecked-indeterminate-mixedmark}.mat-checkbox-anim-checked-unchecked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-out-background}.mat-checkbox-anim-checked-unchecked .mat-checkbox-checkmark-path{animation:90ms linear 0ms mat-checkbox-checked-unchecked-checkmark-path}.mat-checkbox-anim-checked-indeterminate .mat-checkbox-checkmark{animation:90ms linear 0ms mat-checkbox-checked-indeterminate-checkmark}.mat-checkbox-anim-checked-indeterminate .mat-checkbox-mixedmark{animation:90ms linear 0ms mat-checkbox-checked-indeterminate-mixedmark}.mat-checkbox-anim-indeterminate-checked .mat-checkbox-checkmark{animation:500ms linear 0ms mat-checkbox-indeterminate-checked-checkmark}.mat-checkbox-anim-indeterminate-checked .mat-checkbox-mixedmark{animation:500ms linear 0ms mat-checkbox-indeterminate-checked-mixedmark}.mat-checkbox-anim-indeterminate-unchecked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-out-background}.mat-checkbox-anim-indeterminate-unchecked .mat-checkbox-mixedmark{animation:300ms linear 0ms mat-checkbox-indeterminate-unchecked-mixedmark}.mat-checkbox-input{bottom:0;left:50%}\\n\"],encapsulation:2,changeDetection:0}),t})(),uY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({}),t})(),dY=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[fy,Fb,lm,uY],Fb,uY]}),t})();function pY(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\" P\\xe9riode invalide \"),Fa())}function fY(t,e){if(1&t&&(La(0,\"div\",2),La(1,\"mat-form-field\"),La(2,\"mat-label\"),xl(3,\"P\\xe9riode\"),Fa(),La(4,\"mat-date-range-input\",18),Na(5,\"input\",19),Na(6,\"input\",20),Fa(),Na(7,\"mat-datepicker-toggle\",21),Na(8,\"mat-date-range-picker\",null,22),oa(10,pY,2,0,\"mat-error\",23),La(11,\"mat-hint\"),xl(12,\"Les jours commencent \\xe0 00:00 UTC\"),Fa(),Fa(),Fa()),2&t){const t=aa(9),e=Ka(2);Cr(4),Ra(\"rangePicker\",t)(\"min\",e.minDate)(\"max\",e.maxDate),Cr(3),Ra(\"for\",t),Cr(3),Ra(\"ngIf\",e.form.controls.endTimestamp.invalid)}}function mY(t,e){if(1&t&&(La(0,\"h5\"),xl(1,\"Donn\\xe9es navire\"),Fa(),La(2,\"div\",9),La(3,\"label\"),xl(4,\" Informations principales : \"),Na(5,\"mat-checkbox\",10),Fa(),Fa(),La(6,\"div\",9),La(7,\"label\"),xl(8,\" Informations Lloyd's d\\xe9taill\\xe9es : \"),Na(9,\"mat-checkbox\",11),Fa(),Fa(),La(10,\"h5\"),xl(11,\"Donn\\xe9es historiques\"),Fa(),La(12,\"div\",12),La(13,\"div\",2),La(14,\"div\",9),La(15,\"label\"),xl(16,\" Traces : \"),Na(17,\"mat-checkbox\",13),Fa(),Fa(),La(18,\"div\",9),La(19,\"label\"),xl(20,\" \\xc9v\\xe9nements : \"),Na(21,\"mat-checkbox\",14),Fa(),Fa(),La(22,\"div\",9),La(23,\"label\"),xl(24,\" Alertes : \"),Na(25,\"mat-checkbox\",15),Fa(),Fa(),La(26,\"div\",9),La(27,\"label\"),xl(28,\" Escales : \"),Na(29,\"mat-checkbox\",16),Fa(),Fa(),Fa(),oa(30,fY,13,5,\"div\",17),Fa()),2&t){const t=Ka();Cr(30),Ra(\"ngIf\",t.includesTimeRangeData)}}function gY(t,e){1&t&&(La(0,\"h5\"),xl(1,\"Donn\\xe9es a\\xe9ronef\"),Fa(),La(2,\"div\",9),La(3,\"label\"),xl(4,\" Informations principales : \"),Na(5,\"mat-checkbox\",24),Fa(),Fa(),La(6,\"div\",9),La(7,\"label\"),xl(8,\" Traces (depuis le dernier d\\xe9collage) : \"),Na(9,\"mat-checkbox\",25),Fa(),Fa())}function AY(t,e){1&t&&(La(0,\"div\",26),xl(1,\" Vous devez s\\xe9lectionner au moins un type de donn\\xe9es \\xe0 exporter. \"),Fa())}let vY=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.formBuilder=t,this.data=e,this.exportService=i,this.timeRangeService=n,this.dialogRef=s,this.minDate=new Date(2019,4,1),this.maxDate=new Date(Date.now()+864e5),this.includesTimeRangeData=!1,this.exportData=()=>Hp(this,void 0,void 0,function*(){const t=this.form.value;yield this.exportService.exportData(Object.assign(Object.assign({},t),{mmsis:this.data.mmsis||[],icaos:this.data.icaos||[],startTimestamp:_q(t.startTimestamp||new Date),endTimestamp:_q(t.endTimestamp||new Date)}))})}ngOnInit(){if(!(this.data.icaos&&0!==this.data.icaos.length||this.data.mmsis&&0!==this.data.mmsis.length))throw new Error(\"missing params icaos or mmsis\");const t=this.timeRangeService.timeRange$.value;this.form=this.formBuilder.group({includeShipInfos:[!1],includeLloydsInfos:[!1],startTimestamp:[new Date(1e3*t.start)],endTimestamp:[new Date(t.isRelative?Date.now()+864e5:1e3*t.end)],includeTrails:[!1],includeEvents:[!1],includeAlerts:[!1],includePortCalls:[!1],includeAircraftsInfos:[!1],includeAircraftsTrails:[!1]},{validators:Xy.compose([t=>{const e=t.value;return e.includeAlerts||e.includeEvents||e.includeLloydsInfos||e.includePortCalls||e.includeShipInfos||e.includeTrails||e.includeAircraftsInfos||e.includeAircraftsTrails?null:{atLeastOneInclude:!0}},t=>{const e=t.value;return this.includesTimeRangeData=e.includeAlerts||e.includeEvents||e.includePortCalls||e.includeTrails,t.controls.endTimestamp.setErrors(!this.includesTimeRangeData||e.startTimestamp&&e.endTimestamp?null:{invalidRange:!0}),null}])})}closeDialog(){this.dialogRef.close()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Lx),Oa(XC),Oa(CY),Oa(Kq),Oa(ZC))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-export-data-dialog\"]],features:[Uo],decls:17,vars:7,consts:[[1,\"d-flex\"],[1,\"dialog-title\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[1,\"d-flex-column\",\"pa-3\",2,\"max-height\",\"60vh\",\"overflow\",\"auto\"],[3,\"formGroup\"],[3,\"ngIf\"],[\"class\",\"error-message mt-3\",4,\"ngIf\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",1,\"d-block\",\"mt-3\",3,\"disabled\",\"app-async-action\"],[1,\"my-2\"],[\"color\",\"primary\",\"formControlName\",\"includeShipInfos\",1,\"mx-1\"],[\"color\",\"primary\",\"formControlName\",\"includeLloydsInfos\",1,\"mx-1\"],[1,\"d-flex-center\"],[\"color\",\"primary\",\"formControlName\",\"includeTrails\",1,\"mx-1\"],[\"color\",\"primary\",\"formControlName\",\"includeEvents\",1,\"mx-1\"],[\"color\",\"primary\",\"formControlName\",\"includeAlerts\",1,\"mx-1\"],[\"color\",\"primary\",\"formControlName\",\"includePortCalls\",1,\"mx-1\"],[\"class\",\"u-flex\",4,\"ngIf\"],[3,\"rangePicker\",\"min\",\"max\"],[\"matStartDate\",\"\",\"formControlName\",\"startTimestamp\",\"placeholder\",\"D\\xe9but\"],[\"matEndDate\",\"\",\"formControlName\",\"endTimestamp\",\"placeholder\",\"Fin\"],[\"matSuffix\",\"\",3,\"for\"],[\"picker\",\"\"],[4,\"ngIf\"],[\"color\",\"primary\",\"formControlName\",\"includeAircraftsInfos\",1,\"mx-1\"],[\"color\",\"primary\",\"formControlName\",\"includeAircraftsTrails\",1,\"mx-1\"],[1,\"error-message\",\"mt-3\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"h1\",1),xl(2,\" Choix des donn\\xe9es \\xe0 exporter \"),Fa(),Na(3,\"div\",2),La(4,\"button\",3),La(5,\"mat-icon\"),xl(6,\"close\"),Fa(),Fa(),Fa(),Na(7,\"mat-divider\"),La(8,\"div\",4),La(9,\"form\",5),La(10,\"div\"),xl(11),Fa(),oa(12,mY,31,1,\"ng-template\",6),oa(13,gY,10,0,\"ng-template\",6),oa(14,AY,2,0,\"div\",7),La(15,\"button\",8),xl(16,\" Exporter \"),Fa(),Fa(),Fa()),2&t&&(Cr(9),Ra(\"formGroup\",e.form),Cr(2),Cl(\"Vous vous appr\\xeatez \\xe0 exporter les donn\\xe9es \",e.data.label,\".\"),Cr(1),Ra(\"ngIf\",(null==e.data.mmsis?null:e.data.mmsis.length)>0),Cr(1),Ra(\"ngIf\",(null==e.data.icaos?null:e.data.icaos.length)>0),Cr(1),Ra(\"ngIf\",e.form.touched&&(null==e.form.errors?null:e.form.errors.atLeastOneInclude)),Cr(1),Ra(\"disabled\",e.form.invalid)(\"app-async-action\",e.exportData))},directives:[Ly,sk,uE,Xq,sx,Cw,dx,Vd,Jq,hY,Sw,_x,AS,aS,zC,FC,Gy,NC,RC,dS,VC,oS,eS],styles:[\".dialog-title[_ngcontent-%COMP%]{margin:0;padding:16px}\"]}),t})();var _Y=i(3492);function bY(t,e,i){const n=new Blob([t],{type:i});yY(URL.createObjectURL(n),e)}function yY(t,e){const i=document.createElement(\"a\");document.body.appendChild(i),i.type=\"hidden\",i.href=t,i.download=e,i.target=\"_blank\",i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}function wY(t){return\"\"+t.split(\"\").map(Number).reduce((t,e)=>t+e,0)%10}function xY(t,e,i){const n=function(t){const e=rV(t+180,360)-180,i=Math.abs(3600*e);let n=Math.floor(i/3600),s=(i-3600*n)/60;return s>=60&&(s=0,n+=1),`${n}${$$(s,2,0)}`}(t).padStart(e,\"0\");return`${n}${t>0?i[0]:i[1]}${wY(n)}`}function SY(t){return t.length>1e4&&(t=t.slice(0,1e4)),`MSGID/ANAIS/GOLD/0001/${gq().toLocaleString(\"en-US\",{month:\"short\"}).toUpperCase()}\\n${t.map((t,e)=>function(t,e){const i=new Date(1e3*t.timestamp);let n=`${$$(i.getUTCDate(),2,0)}${$$(i.getUTCHours(),2,0)}${$$(i.getUTCMinutes(),2,0)}`;return n+=\"Z\"+wY(n),`CTC/T${$$(e,4,0)}/UNEQUATED-${(function(t){return t?null==t?void 0:t.replace(/\\//g,\"-\"):\"\"}(t.name)||\"UNDEFINED\").toUpperCase()}//UNK///${\"undefined\"!==t.country.iso2?t.country.iso2.toUpperCase():\"ZZ\"}////18///0\\nPOS/${n}/${i.toLocaleString(\"en-US\",{month:\"short\"}).toUpperCase()}/${xY(t.lat,4,\"NS\")}/${xY(t.lon,5,\"EW\")}/AIS////${t.numberCog.toFixed(1)}T/${t.numberSog.toFixed(1)}K/ALT000\\nAIS/${t.mmsi}/${t.imo||\"-\"}`}(t,e)).join(\"\\n\")}\\nENDAT`}let CY=(()=>{class t{constructor(t,e,i,n,s,r){this.dialog=t,this.historyService=e,this.mapConfigService=i,this.uiService=n,this.workerService=s,this.zonesService=r}registerVisibleAircraftsCallback(t){this.getVisibleAircraftsFn=t}registerVisibleShipsCallback(t){this.getVisibleShipsFn=t}exportVisiblePositions(t){let e=this.historyService.timestamp$.value;0===e&&(e=_q(new Date));const i=yq(e);let n=!1;const s=this.mapConfigService.showShipsLayer$.value;if(s){const e=this.getVisibleShipsFn();e.length&&(n=!0,\"CSV\"===t?bY(function(t){return[[\"timestamp\",\"lon\",\"lat\",\"hdms\",\"mmsi\",\"imo\",\"callsign\",\"name\",\"flag\",\"cargo\",\"type\",\"cog\",\"hdg\",\"sog\",\"length\",\"width\",\"draught\",\"destination\",\"departure\",\"eta\"].join(\",\"),...t.map(t=>function(t){return[wq(1e3*t.timestamp),t.lon,t.lat,t.hdms,t.mmsi,t.imo,t.callsign,_U(t.name),t.country.flag,t.cargo,t.shipType.key,t.cog,t.hdg,t.sog,t.length,t.width,t.draught,_U(t.destination),_U(t.departure),t.eta]}(t).join(\",\"))].join(\"\\n\")}(e),`anais-pistes-ships-${i}.csv`,\"text/csv\"):e.length>1e4?this.uiService.confirm({title:\"Confirmer l'export\",message:\"La vue courante contient trop de navires. Le message OTH-T-GOLD n'en contiendra que 10000.\",action:t=>{t&&bY(SY(e.slice(0,1e4)),`anais-pistes-ships-${i}.gold`,\"text/plain\")}}):bY(SY(e),`anais-pistes-ships-${i}.gold`,\"text/plain\"))}const r=this.mapConfigService.showAircraftsLayer$.value;if(r){const e=this.getVisibleAircraftsFn();e.length&&(n=!0,\"CSV\"===t&&bY(function(t){return[[\"icao\",\"callsign\",\"squawk\",\"type\",\"timestamp\",\"lon\",\"lat\",\"hdms\",\"altitude\"].join(\",\"),...t.map(t=>function(t){return[t.icao,t.callsign,t.squawk,t.type,wq(1e3*t.timestamp),t.lon,t.lat,j$([t.lon,t.lat]),t.altitude]}(t).join(\",\"))].join(\"\\n\")}(e),`anais-pistes-aircrafts-${i}.csv`,\"text/csv\"))}if(!n){const t=[s&&\"navire\",r&&\"a\\xe9ronef\"].filter(t=>!!t).join(\" ou \")||\"navire ou a\\xe9ronef\";this.uiService.error(`La vue courante ne contient aucun ${t}`)}}getEntitiesInExtent(t){const e=[];return this.mapConfigService.showShipsLayer$.value&&e.push(...this.getVisibleShipsFn(t)),this.mapConfigService.showAircraftsLayer$.value&&e.push(...this.getVisibleAircraftsFn(t)),e}openExportDataDialog(t){this.dialog.open(vY,{panelClass:\"no-border-dialog\",maxHeight:\"90vh\",maxWidth:\"90vw\",minWidth:\"300px\",autoFocus:!1,closeOnNavigation:!0,hasBackdrop:!0,data:t})}exportData(t){return Hp(this,void 0,void 0,function*(){(yield this.workerService.export.exportEntitiesData(t,{zonesById:this.zonesService.zonesById})).forEach(t=>{yY(t.url,t.filename)})})}openExportDataDialogForCurrentView(){let t=!1;const e=[],i=this.mapConfigService.showShipsLayer$.value;i&&(e.push(...this.getVisibleShipsFn().map(t=>t.mmsi)),t=e.length>0);const n=[],s=this.mapConfigService.showAircraftsLayer$.value;if(s&&(n.push(...this.getVisibleAircraftsFn().map(t=>t.icao)),t=n.length>0),t)this.openExportDataDialog({icaos:n,mmsis:e,label:\"des entit\\xe9s visibles\"});else{const t=[i&&\"navire\",s&&\"a\\xe9ronef\"].filter(t=>!!t).join(\" ou \")||\"navire ou a\\xe9ronef\";this.uiService.error(`La vue courante ne contient aucun ${t}`)}}}return t.\\u0275fac=function(e){return new(e||t)(Mn(ik),Mn(Fj),Mn(qU),Mn(_H),Mn(sH),Mn(OH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const kY=[\"assets/images/2016mtln170_003.jpg\",\"assets/images/adsbexchange-icon.png\",\"assets/images/aircraft.png\",\"assets/images/alert-dubious-move.svg\",\"assets/images/alert-erratic-route.svg\",\"assets/images/alert-no-position.svg\",\"assets/images/alert-transhipment.svg\",\"assets/images/anchor.svg\",\"assets/images/arrow-chevron.png\",\"assets/images/danger.svg\",\"assets/images/favicon_anais.png\",\"assets/images/favicon_anais.svg\",\"assets/images/filter.svg\",\"assets/images/flag-undefined.svg\",\"assets/images/fleets.svg\",\"assets/images/flightradar24-icon.png\",\"assets/images/glitter-star.png\",\"assets/images/help-firefox-mixed-content-tutorial.png\",\"assets/images/hexagon.svg\",\"assets/images/layers.svg\",\"assets/images/lifeline.png\",\"assets/images/lloyds-icon.png\",\"assets/images/login_background.jpg\",\"assets/images/logo_anais.png\",\"assets/images/logo_anais.svg\",\"assets/images/logo_fabnum.png\",\"assets/images/marinetraffic-icon.png\",\"assets/images/point.png\",\"assets/images/port.png\",\"assets/images/ship.png\",\"assets/images/tchap-logo.png\",\"assets/images/tooltips-mini.svg\",\"assets/images/tooltips.svg\",\"assets/images/trail-detailed.svg\",\"assets/images/trail-simple.svg\",\"assets/images/zones.svg\"],EY=[\"assets/geo/Limite_3milles_peche_WGS84_EPSG4326.geojson\",\"assets/geo/Limite_6milles_bande_cotiere_peche_WGS84_EPSG4326.geojson\",\"assets/geo/Delim_accord_WGS84.geojson\",\"assets/geo/Lignes_base_droites_WGS84.geojson\",\"assets/geo/Lim_ext_MT_WGS84.geojson\",\"assets/geo/Lim_ext_PC_WGS84.geojson\",\"assets/geo/Lim_ext_ZC_WGS84.geojson\",\"assets/geo/Lim_ext_ZEE_WGS84.geojson\",\"assets/geo/Lim_sans_accord_WGS84.geojson\",\"assets/geo/mrcc_2020-08-03.geojson\",\"assets/geo/sar_2020-08-03.geojson\",\"assets/geo/french-srr.geojson\",\"assets/geo/UK_12M_Limit.geojson\",\"assets/geo/UK_6M_Limit.geojson\",\"assets/geo/zonex.atlan.2021.geojson\",\"assets/geo/zonex.atlan.tirs.2021.corrected.geojson\",\"assets/geo/zonex.med.corrected.geojson\"];let MY=(()=>{class t{constructor(t,e,i,n,s,r,o){this.alertRulesService=t,this.authenticationService=e,this.exportService=i,this.mapConfigService=n,this.mapService=s,this.uiService=r,this.workerService=o,this.setupActive$=new Jp(!1),this.loading=!1,this.viewExtent$=new Jp(null),this.downloadProgress$=new Jp(null),this.offlineConfig$=new Jp(null),this.isOffline$=new Jp(!1),this.invalidIndexedDB=!1,this.offlineConfig$.subscribe(t=>{this.isOffline$.next(!!t)})}init(){var t;return Hp(this,void 0,void 0,function*(){const e=!!(null===(t=null==navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller);let i;if(e&&(i=yield new Promise((t,e)=>{const i=new MessageChannel;navigator.serviceWorker.controller.postMessage(\"state:info\",[i.port2]),i.port1.onmessage=e=>{t(e.data),i.port1.close()},setTimeout(e,5e3)})),e&&\"setup\"===i)return;try{this.offlineUserData=yield Vq(Hq)}catch(s){return void(this.invalidIndexedDB=!0)}const n=yield Vq(jq);if(e&&\"ready\"===i&&n&&this.offlineUserData)return this.offlineConfig$.next(n),this.workerService.setOffline(!0),yield this.workerService.offline.loadFromIDB(),void this.mapService.hasBooted$.pipe(kf(1),Af(t=>t),FO(),Oj(0)).subscribe(()=>{this.workerService.offline.triggerShipFeed()});e||n||this.offlineUserData?(yield this.exitOfflineMode(),yield hU(5e3)):this.workerService.setOffline(!1)})}getOfflineData(){return this.offlineUserData}enterSetupMode(){this.setupActive$.next(!0),this.mapConfigService.showShipsLayer$.value||this.mapConfigService.toggleShipsLayer()}exitSetupMode(){this.setupActive$.next(!1)}loadOfflineData(t){var e,i;return Hp(this,void 0,void 0,function*(){try{this.loading=!0;const e=this.mapConfigService.baseLayer$.value.source,i=e.getTileUrlFunction(),n=e.getTilePixelRatio(),s=this.mapService.view$.value.projection,r=e.getTileGrid(),o=r.getZForResolution(this.mapService.view$.value.resolution),a=NV(this.viewExtent$.value,\"EPSG:4326\",\"EPSG:3857\"),l=this.exportService.getVisibleShipsFn(a).map(t=>t.mmsi),c=yield this.workerService.ships.getLatestTimestamp(),h={extent:this.viewExtent$.value,mercatorExtent:a,minZoom:o,maxZoom:t.maxZoom,startTimestamp:c-t.timeRange,endTimestamp:c,includeAdditionalLayers:t.includeAdditionalLayers,includeTrails:t.includeTrails,includeEvents:t.includeEvents,includeAlerts:t.includeAlerts,includeLloydsInfos:t.includeLloydsInfos,includePortCalls:t.includePortCalls,shipFilter:uU(this.mapConfigService.shipFilter$.value)};if(yield this.workerService.application.logUserActivity(\"offline-load\",Object.assign(Object.assign({},t),{zoomLevels:1+t.maxZoom-o,shipsCount:l.length})),this.mapConfigService.showAircraftsLayer$.value&&this.mapConfigService.toggleAircraftsLayer(),!(\"serviceWorker\"in navigator))throw new Error(\"Services workers non support\\xe9s par votre navigateur. Mode hors-ligne non disponible.\");yield navigator.serviceWorker.register(\"/service-worker.js\",{scope:\"/\"}),yield hU(500),navigator.serviceWorker.controller.postMessage(\"state:setup\"),yield hU(50),this.workerService.setOffline(!0),this.offlineConfig$.next(h);const u=new Uq({numberOfSteps:2+(h.includeAdditionalLayers?1:0)+(h.includeTrails?1:0)+(h.includeEvents?1:0)+(h.includeAlerts?1:0)+(h.includeLloydsInfos?1:0)+(h.includePortCalls?1:0)});let d;u.progress$.subscribe(t=>{this.downloadProgress$.next(t)}),yield u.execute({title:\"T\\xe9l\\xe9chargement des modules ANAIS\",total:kY.length+1,action:t=>Hp(this,void 0,void 0,function*(){d=yield function(t){return Hp(this,void 0,void 0,function*(){return new Promise((t,e)=>{const i=document.createElement(\"iframe\");i.onload=()=>{t(i)},i.onerror=e,i.src=\"/__offline-assets\",document.body.appendChild(i)})})}(),t(),yield Promise.all(kY.map(e=>Hp(this,void 0,void 0,function*(){yield fetch(e),t()})))})});const[p,f,m,g]=yield Promise.all([this.workerService.groups.listGroups(),this.workerService.annotations.list(),this.workerService.fleets.list(),this.workerService.zones.list()]);yield $q(Hq,{groups:p,rules:this.alertRulesService.alertRules$.value,annotations:f,fleets:m,zones:g,user:this.authenticationService.user$.value});const A=[];for(let t=o;t<=h.maxZoom;t++)r.forEachTileCoord(a,t,t=>{const r=i.call(e,t,n,s);A.push(r)});yield u.execute({title:\"T\\xe9l\\xe9chargement des tuiles de carte\",total:A.length,action:t=>Hp(this,void 0,void 0,function*(){yield Promise.all(A.map(e=>Hp(this,void 0,void 0,function*(){yield function(t){return Hp(this,void 0,void 0,function*(){return new Promise((e,i)=>{const n=new Image;n.crossOrigin=\"Anonymous\",n.onload=e,n.onerror=i,n.src=t,n.remove()})})}(e),t()})))})}),h.includeAdditionalLayers&&(yield u.execute({title:\"T\\xe9l\\xe9chargement des couches additionnelles\",total:EY.length,action:t=>Hp(this,void 0,void 0,function*(){yield Promise.all(EY.map(e=>Hp(this,void 0,void 0,function*(){yield fetch(e),t()})))})})),yield this.workerService.offline.initialize(h,l,Qj(t=>{this.downloadProgress$.next(t)})),yield $q(jq,h),d.remove(),navigator.serviceWorker.controller.postMessage(\"state:ready\"),yield hU(50)}catch(n){throw this.offlineConfig$.next(null),this.workerService.setOffline(!1),null===(i=null===(e=navigator.serviceWorker)||void 0===e?void 0:e.controller)||void 0===i||i.postMessage(\"state:disabled\"),n}finally{this.downloadProgress$.next(null),this.loading=!1}})}updateOfflineData(){return Hp(this,void 0,void 0,function*(){this.loading=!0;const t=this.offlineConfig$.value,e=t.endTimestamp;t.endTimestamp=yield this.workerService.ships.getLatestTimestamp();try{yield this.workerService.application.logUserActivity(\"offline-update\",{interval:t.endTimestamp-e}),this.offlineConfig$.next(t),yield this.workerService.offline.update(t.endTimestamp,Qj(t=>{this.downloadProgress$.next(t)})),yield $q(jq,t)}catch(i){throw t.endTimestamp=e,this.offlineConfig$.next(t),i}finally{this.downloadProgress$.next(null),this.loading=!1}})}exitOfflineMode(){var t,e;return Hp(this,void 0,void 0,function*(){yield function(t=zq()){return t(\"readwrite\",t=>(t.clear(),Nq(t.transaction)))}(),null===(e=null===(t=navigator.serviceWorker)||void 0===t?void 0:t.controller)||void 0===e||e.postMessage(\"unregister\"),this.workerService.setOffline(!1)})}updateViewBox(t){this.viewExtent$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(DH),Mn(rH),Mn(CY),Mn(qU),Mn(Pj),Mn(_H),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),TY=(()=>{class t{constructor(t,e,i,n,s,r){this.historyService=t,this.mapConfigService=e,this.offlineService=i,this.timeRangeService=n,this.workerService=s,this.zonesService=r,this.shipsInView$=new Jp([]),this.shipsInViewCount$=new Jp(0),this.shipsCount$=new Jp(0)}fetchShip(t,e){return Hp(this,void 0,void 0,function*(){let i;if(this.offlineService.isOffline$.value)i=yield this.workerService.offline.getShipDetail(t);else{i=yield this.workerService.ships.getShip(t);let n=null!=e?e:this.timeRangeService.timeRange$.value;if(!n.isCustom){const t=this.historyService.timestamp$.value;n=n.setRelative(t>0?t:i.timestamp)}Object.assign(i,yield this.workerService.ships.getShipDetails(t,n,+i.imo,this.mapConfigService.detailedShipTraces$.value,this.mapConfigService.debugH3Trace$.value,!!window.__anaisSettings.PORTCALLS_ENABLE,!!e))}return i.trail.forEach(t=>{t.ship=i}),i.h3Trace.elements.forEach(t=>{t.ship=i}),i.events=i.events.filter(t=>t.type!==HH.MoveZoneEntry&&t.type!==HH.MoveZoneExit||!!this.zonesService.zonesById[t.data.zone]),i})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(Fj),Mn(qU),Mn(MY),Mn(Kq),Mn(sH),Mn(OH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),IY=(()=>{class t{constructor(t,e,i,n,s,r,o,a,l,c,h,u){this.ngZone=t,this.router=e,this.errorHandler=i,this.alertRulesService=n,this.eventsLayerService=s,this.h3TracesLayerService=r,this.mapConfigService=o,this.mapStateService=a,this.offlineService=l,this.shipsService=c,this.timeRangeService=h,this.workerService=u,this.entities$=new Jp([]),this.openEntity$=new Jp(null),this.alerts$=new Jp([]),this.trails$=new Jp([]),this.mustHideEntities=!1,this.shipsMaxTimestamp=0,this.mapStateService.mustHideEntities$.subscribe(t=>{this.mustHideEntities=t}),this.entities$.pipe(M(t=>t.filter(t=>!!t.entity))).subscribe(t=>{const e=[],i=[],n=[],s=[];t.forEach(t=>{var r,o,a;t.type===NH.Aircraft?e.push(t.entity.trace):t.type===NH.Ship&&(n.push(...null!==(r=t.entity.alerts)&&void 0!==r?r:[]),s.push(...null!==(o=t.entity.events)&&void 0!==o?o:[]),e.push(t.entity.trail),i.push(null!==(a=t.entity.h3Trace)&&void 0!==a?a:[]))}),n.forEach(t=>{const[e,i]=this.alertRulesService.getAlertRuleColor(t.rule_id);t.color=e,t.rgbVecColor=i}),this.alerts$.next(n),this.eventsLayerService.updateEvents(s),this.trails$.next(e),this.h3TracesLayerService.updateTrails(i)}),q(this.mapConfigService.detailedShipTraces$.pipe(kf(1)),this.timeRangeService.timeRange$.pipe(ug(),Af(([t,e])=>t.key!==e.key||\"custom\"===t.key))).pipe(Af(()=>!this.mustHideEntities)).subscribe(()=>Hp(this,void 0,void 0,function*(){yield Promise.all(this.entities$.value.map(t=>Hp(this,void 0,void 0,function*(){yield this.fetchEntity(t.type,t.id)})))})),this.timeRangeService.timeRange$.pipe(ug(),Af(([t,e])=>t.key===e.key&&\"custom\"!==t.key),fg(()=>Hp(this,void 0,void 0,function*(){return this.workerService.ships.getLatestTimestamp()})),Af(t=>t!==this.shipsMaxTimestamp&&this.entities$.value.length>0)).subscribe(t=>Hp(this,void 0,void 0,function*(){const e=new OU({key:\"custom\",isCustom:!0,start:this.shipsMaxTimestamp-900,end:t});this.shipsMaxTimestamp=t,yield Promise.all(this.entities$.value.map(t=>Hp(this,void 0,void 0,function*(){yield this.fetchEntity(t.type,t.id,e)})))})),this.mapConfigService.enableMultiSelectionMode$.subscribe(t=>{t||(this.openEntity$.value?this.entities$.next([this.openEntity$.value]):this.entities$.value.length>1&&this.entities$.next([this.entities$.value[0]]))})}clear(){this.entities$.next([])}selectShip(t){this.toggleSelection(NH.Ship,t)}selectAircraft(t){this.toggleSelection(NH.Aircraft,t)}openEntity(t,e){const i=this.entities$.value.find(i=>i.type===t&&i.id===e);i?this.openEntity$.next(i):(this.toggleSelection(t,e),this.openEntity$.next(this.entities$.value[this.entities$.value.length-1]))}closeOpenEntity(){this.openEntity$.next(null),this.mapConfigService.enableMultiSelectionMode$.value||this.entities$.next([])}toggleSelection(t,e){var i;let n=this.entities$.value;const s=n.findIndex(t=>t.id===e);if(-1===s){sB({category:\"app\",message:`select-entity: ${t}`});const i={type:t,id:e,entity:null};this.mapConfigService.enableMultiSelectionMode$.value||(n=[],this.ngZone.run(()=>{const i=QH(this.router);this.router.navigateByUrl(`${i}/${t}s/${e}`)})),(()=>{Hp(this,void 0,void 0,function*(){this.entities$.value.every(t=>t.type!==NH.Ship)&&!this.offlineService.isOffline$.value&&(this.shipsMaxTimestamp=yield this.workerService.ships.getLatestTimestamp()),yield this.fetchEntity(t,e)})})(),n.push(i)}else{if(sB({category:\"app\",message:`unselect-entity: ${t}`}),n[s].id===(null===(i=this.openEntity$.value)||void 0===i?void 0:i.id)){const t=QH(this.router)||\"/\";this.router.navigateByUrl(t)}n.splice(s,1)}this.entities$.next(n)}addToSelection(t,e){-1===this.entities$.value.findIndex(t=>t.id===e)&&this.toggleSelection(t,e)}fetchEntity(t,e,i){var n;return Hp(this,void 0,void 0,function*(){let s=null,r=null;try{if(t===NH.Ship){s=yield this.shipsService.fetchShip(e,i);const r=null===(n=this.entities$.value.find(i=>i.type===t&&i.id===e))||void 0===n?void 0:n.entity;i&&r&&(s.alerts=s.alerts.concat(XH(r.alerts,t=>t.start<i.start)),s.events=s.events.concat(XH(r.events,t=>t.timestamp<i.start)),s.portCallEvents=s.portCallEvents.concat(XH(r.portCallEvents,t=>t.timestamp<i.start)),s.trail=s.trail.concat(XH(r.trail,t=>t.timestamp<i.start)))}else t===NH.Aircraft&&(s=yield this.workerService.aircrafts.getAircraftDetails(e))}catch(o){o.name===aB.Unauthorized&&this.errorHandler.handleError(o),r=o.message.includes(`GetTrip ERROR : ${e} dont find`)?`L'a\\xe9ronef ${e} est inconnu. Il a d\\xfb atterrir ou son signal n'est plus capt\\xe9 depuis plus de 5 minutes.`:\"not found\"===o.message?`Le navire ${e} est inconnu.`:o.message}this.updateEntity(t,e,s,r)})}updateEntity(t,e,i,n){const s=this.entities$.value.findIndex(i=>i.type===t&&i.id===e);if(-1===s)return;const r=Object.assign(Object.assign({},this.entities$.value[s]),{entity:i,error:n});this.entities$.value[s]=r,this.entities$.next(this.entities$.value);const o=this.openEntity$.value;o&&o.type===t&&o.id===e&&this.openEntity$.next(r)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(nu),Mn(pL),Mn(Rs),Mn(DH),Mn(JH),Mn(tG),Mn(qU),Mn(Fq),Mn(MY),Mn(TY),Mn(Kq),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();class PY{constructor(t){this.closingNotifier=t}call(t,e){return e.subscribe(new OY(t,this.closingNotifier))}}class OY extends V{constructor(t,e){super(t),this.buffer=[],this.add($(e,new z(this)))}_next(t){this.buffer.push(t)}notifyNext(){const t=this.buffer;this.buffer=[],this.destination.next(t)}}let RY=(()=>{class t{constructor(t){this.mapStateService=t,this.hoveredAircraft$=new Jp(null),this.hoveredAlert$=new Jp(null),this.hoveredAnnotation$=new Jp(null),this.hoveredEvent$=new Jp(null),this.hoveredShip$=new Jp(null),this.hoveredAircraftPosition$=new Jp(null),this.hoveredShipPosition$=new Jp(null),this.hoveredPort$=new Jp(null),this.hoveredH3Element$=new Jp(null),this.pinnedEntitiesTooltips$=new Jp([]),this.pinEvents$=new C,this.displayedEntity$=JT([this.hoveredAircraft$.pipe(Tf()),this.hoveredAlert$.pipe(Tf()),this.hoveredEvent$.pipe(Tf()),this.hoveredShip$.pipe(Tf()),this.hoveredAircraftPosition$.pipe(Tf()),this.hoveredShipPosition$.pipe(Tf()),this.hoveredAnnotation$.pipe(Tf((t,e)=>null===e&&t===e)),this.hoveredH3Element$.pipe(Tf())]).pipe(M(([t,e,i,n,s,r,o,a])=>{var l,c,h,u,d,p,f;return null!==(f=null!==(p=null!==(d=null!==(u=null!==(h=null!==(c=null!==(l=null!=e?e:i)&&void 0!==l?l:t)&&void 0!==c?c:n)&&void 0!==h?h:s)&&void 0!==u?u:r)&&void 0!==d?d:o)&&void 0!==p?p:a)&&void 0!==f?f:null}),sf(t=>{t&&(t.hdms=this.mapStateService.coordinateSystem$.value.format([t.lon,t.lat]))})),this.pinEvents$.pipe(function(t){return function(e){return e.lift(new PY(t))}}(this.pinEvents$.pipe(pf(50))),M(t=>{var e,i,n,s,r,o,a;return null!==(a=null!==(o=null!==(r=null!==(s=null!==(n=null!==(i=null!==(e=t.find(t=>t.kind===NH.Alert))&&void 0!==e?e:t.find(t=>t.kind===NH.Event))&&void 0!==i?i:t.find(t=>t.kind===NH.Ship))&&void 0!==n?n:t.find(t=>t.kind===NH.AircraftPosition))&&void 0!==s?s:t.find(t=>t.kind===NH.ShipPosition))&&void 0!==r?r:t.find(t=>t.kind===NH.PortClickEvent))&&void 0!==o?o:t.find(t=>t.kind===NH.Annotation))&&void 0!==a?a:t.find(t=>t.kind===NH.H3Element)}),Af(t=>!!t)).subscribe(t=>{t.kind===NH.Annotation?t=uU(t):t.hdms=this.mapStateService.coordinateSystem$.value.format([t.lon,t.lat]),this.pinnedEntitiesTooltips$.value.push({lon:t.lon,lat:t.lat,positioning:\"bottom-left\",entity:t}),this.pinnedEntitiesTooltips$.next(this.pinnedEntitiesTooltips$.value)})}hoverEntity(t,e){switch(t){case NH.Aircraft:e&&(e.kind=NH.Aircraft),this.hoveredAircraft$.next(e);break;case NH.Alert:e&&(e.kind=NH.Alert),this.hoveredAlert$.next(e);break;case NH.Annotation:e&&(e.kind=NH.Annotation),this.hoveredAnnotation$.next(e);break;case NH.Event:e&&(e.kind=NH.Event),this.hoveredEvent$.next(e);break;case NH.Ship:this.hoveredShip$.next(e);break;case NH.AircraftPosition:e&&(e.kind=NH.AircraftPosition),this.hoveredAircraftPosition$.next(e);break;case NH.ShipPosition:e&&(e.kind=NH.ShipPosition),this.hoveredShipPosition$.next(e);break;case NH.H3Element:e&&(e.kind=NH.H3Element),this.hoveredH3Element$.next(e);break;default:throw new Error(\"Entit\\xe9 inconnue\")}}clearPinnedEntities(){this.pinnedEntitiesTooltips$.next([])}pinEntity(t){this.pinEvents$.next(t)}unpinTooltip(t){this.pinnedEntitiesTooltips$.next(this.pinnedEntitiesTooltips$.value.filter(e=>e!==t))}}return t.\\u0275fac=function(e){return new(e||t)(Mn(Fq))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),DY=(()=>{class t{constructor(t,e,i){this.ngZone=t,this.selectionService=e,this.tooltipsService=i,this.selectAlertFeature$=new C,this.selectEventFeature$=new C,this.selectEventItem$=new C,this.mapClickEvents$=new C,this.ngZone.runOutsideAngular(()=>{this.mapClickEvents$.pipe(function(t){let e=arguments.length,i=df;E(arguments[arguments.length-1])&&(i=arguments[arguments.length-1],e--);let n=null;e>=2&&(n=arguments[1]);let s=Number.POSITIVE_INFINITY;return e>=3&&(s=arguments[2]),function(e){return e.lift(new GH(t,n,s,i))}}(16),M(t=>{var e,i,n,s,r,o,a,l;return null!==(l=null!==(a=null!==(o=null!==(r=null!==(s=null!==(n=null!==(i=null!==(e=t.find(t=>t.kind===NH.Alert))&&void 0!==e?e:t.find(t=>t.kind===NH.Event))&&void 0!==i?i:t.find(t=>t.kind===NH.Aircraft))&&void 0!==n?n:t.find(t=>t.kind===NH.Ship))&&void 0!==s?s:t.find(t=>t.kind===NH.AircraftPosition))&&void 0!==r?r:t.find(t=>t.kind===NH.ShipPosition))&&void 0!==o?o:t.find(t=>t.kind===NH.PortClickEvent))&&void 0!==a?a:t.find(t=>t.kind===NH.Annotation))&&void 0!==l?l:t.find(t=>t.kind===NH.H3Element)}),Af(t=>!!t)).subscribe(t=>{switch(sB({category:\"app\",message:`map-click: ${t.kind}`}),t.kind){case NH.Aircraft:this.selectionService.selectAircraft(t.icao);break;case NH.AircraftPosition:this.tooltipsService.pinEntity(t);break;case NH.Alert:this.selectAlertFeature$.next(t),this.tooltipsService.pinEntity(t);break;case NH.Annotation:this.tooltipsService.pinEntity(t);break;case NH.Event:this.selectEventFeature$.next(t),this.tooltipsService.pinEntity(t);break;case NH.PortClickEvent:this.tooltipsService.pinEntity(t);break;case NH.Ship:this.selectionService.selectShip(t.mmsi);break;case NH.ShipPosition:case NH.H3Element:this.tooltipsService.pinEntity(t);break;default:throw new Error(\"Entit\\xe9 inconnue\")}})})}clickOnEntity(t,e){switch(t){case NH.Aircraft:e.kind=NH.Aircraft,this.mapClickEvents$.next(e);break;case NH.AircraftPosition:e.kind=NH.AircraftPosition,this.mapClickEvents$.next(e);break;case NH.Alert:e.kind=NH.Alert,this.mapClickEvents$.next(e);break;case NH.Annotation:e.kind=NH.Annotation,this.mapClickEvents$.next(e);break;case NH.Event:e.kind=NH.Event,this.mapClickEvents$.next(e);break;case NH.PortClickEvent:case NH.Ship:this.mapClickEvents$.next(e);break;case NH.ShipPosition:e.kind=NH.ShipPosition,this.mapClickEvents$.next(e);break;case NH.H3Element:e.kind=NH.H3Element,this.mapClickEvents$.next(e);break;default:throw new Error(\"Entit\\xe9 inconnue\")}}}return t.\\u0275fac=function(e){return new(e||t)(Mn(nu),Mn(IY),Mn(RY))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),LY=(()=>{class t{constructor(){this.zones$=new Jp([])}clear(){this.zones$.next([])}updateZones(t){this.zones$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),FY=(()=>{class t{constructor(t,e,i,n,s,r,o){this.interactionsService=t,this.mapService=e,this.offlineService=i,this.tooltipsService=n,this.workerService=s,this.zonesLayerService=r,this.zonesService=o,this.additionalShipTrail$=new Jp(null),this.interactionsService.selectEventItem$.subscribe(t=>{this.mapService.pingLocation([t.lon,t.lat]),this.mapService.centerOnLonLat([t.lon,t.lat])}),this.interactionsService.selectEventFeature$.subscribe(t=>{this.tooltipsService.pinEntity(t)}),q(this.interactionsService.selectEventFeature$,this.interactionsService.selectEventItem$).subscribe(t=>{if(!t)return;let e=!1,i=!1;switch(t.type){case HH.PositionDubious:{this.mapService.pingLocation([t.data.lon,t.data.lat]);const i=MU.New(t.lon,t.lat,t.lon,t.lat);i.addPoint(t.data.lon,t.data.lat),this.mapService.fitOn(i.toExtent()),e=!0;break}case HH.MoveZoneEntry:case HH.MoveZoneExit:{const i=this.zonesService.zonesById[t.data.zone];this.zonesLayerService.updateZones([i]),this.mapService.fitOnHexagons(i.h3indexes),e=!0;break}case HH.MoveMeetingAtSea:this.viewAdditionalShipTrail(t.data.mmsi,t.timestamp),i=!0}i||this.hideAdditionalTrail(),e||this.zonesLayerService.clear()})}viewAdditionalShipTrail(t,e){return Hp(this,void 0,void 0,function*(){if(!this.offlineService.isOffline$.value){const i=yield this.workerService.ships.getShipTrail(t,e-86400,e+86400);this.additionalShipTrail$.next(i)}})}hideAdditionalTrail(){this.additionalShipTrail$.value&&this.additionalShipTrail$.next(null)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(DY),Mn(Pj),Mn(MY),Mn(RY),Mn(sH),Mn(LY),Mn(OH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),NY=(()=>{class t{constructor(t,e){this.configService=t,this.mapConfigService=e,this.configurations$=new Jp([]),this.activeConfigurationName$=new Jp(\"\"),this.activeConfiguration$=new Jp(null),this.dirtyActiveConfiguration$=new Jp(!1),this.loadConfig(),JT([this.configurations$,this.activeConfigurationName$]).pipe(kf(1),pf(300)).subscribe(()=>{this.saveConfig()}),JT([this.configurations$,this.activeConfigurationName$]).subscribe(([t,e])=>{this.activeConfiguration$.next(e?t.find(t=>t.name===e):null)}),this.activeConfiguration$.pipe(kf(1),Tf()).subscribe(t=>{this.mapConfigService.updateBatch(t?t.filters:yU())}),this.activeConfiguration$.subscribe(t=>{var e;this.dirtyActiveConfiguration$.next(!1),null===(e=this.dirtyWatch)||void 0===e||e.unsubscribe(),t&&(this.dirtyWatch=this.mapConfigService.shipFilter$.pipe(M(t=>wU(t)),Tf(xU),kf(1)).subscribe(()=>{this.dirtyActiveConfiguration$.next(!0)}))})}loadConfig(){const t=this.configService.filterConfigurations;t&&(gU(t.configurations)&&(t.configurations.forEach(t=>{t.filters=Object.assign({},yU(),t.filters)}),this.configurations$.next(t.configurations)),gU(t.activeConfigurationName)&&this.activeConfigurationName$.next(t.activeConfigurationName))}saveConfig(){this.configService.set(\"filterConfigurations\",{configurations:this.configurations$.value,activeConfigurationName:this.activeConfigurationName$.value})}selectConfiguration(t){this.activeConfigurationName$.next(t)}importConfiguration(t){t.filters=Object.assign({},yU(),t.filters),this.configurations$.next([...this.configurations$.value,t].sort((t,e)=>t.name<=e.name?-1:1))}createConfiguration(t){this.configurations$.next([...this.configurations$.value,{name:t,filters:wU(this.mapConfigService.shipFilter$.value)}].sort((t,e)=>t.name<=e.name?-1:1))}renameConfiguration(t,e){const i=this.configurations$.value.findIndex(e=>e.name===t),n=this.configurations$.value.findIndex(t=>t.name===e);if(-1===i)throw new Error(\"Configuration non trouv\\xe9e\");if(-1!==n&&n!==i)throw new Error(\"La configuration existe d\\xe9j\\xe0\");const[s]=this.configurations$.value.splice(i,1);s.name=e,this.configurations$.next([...this.configurations$.value,s].sort((t,e)=>t.name<=e.name?-1:1)),this.selectConfiguration(e)}updateConfiguration(t){const e=this.configurations$.value.findIndex(e=>e.name===t.name);if(-1===e)throw new Error(\"Configuration non trouv\\xe9e\");this.configurations$.value.splice(e,1),this.configurations$.next([...this.configurations$.value,t].sort((t,e)=>t.name<=e.name?-1:1))}deleteConfiguration(t){this.configurations$.next(this.configurations$.value.filter(e=>e.name!==t)),this.activeConfigurationName$.next(null)}clear(){this.configurations$.next([]),this.activeConfigurationName$.next(null)}clearMapFilters(){this.mapConfigService.resetShipFilter()}updateActiveConfigurationFilters(){if(!this.activeConfigurationName$.value)throw new Error(\"Aucune configuration active\");this.updateConfiguration({name:this.activeConfigurationName$.value,filters:wU(this.mapConfigService.shipFilter$.value)})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(WU),Mn(qU))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function BY(t){return{id:t.id,name:t.name,ships:t.ships.map(t=>t.mmsi)}}let zY=(()=>{class t{constructor(t,e,i,n,s,r){this.alertRulesService=t,this.mapConfigService=e,this.offlineService=i,this.timeRangeService=n,this.uiService=s,this.workerService=r,this.fleets$=new Jp([]),this.fleetsById={},this.selectedFleet$=new Jp(null),this.selectingFleet=!1,this.fleetAlerts$=new Jp([]),this.fleetTrails$=new Jp([]),this.displayFleetTrail$=new Jp(!1),this.toggleDisplayFleetTrails=()=>Hp(this,void 0,void 0,function*(){if(!this.displayFleetTrail$.value){let t;const e=this.timeRangeService.timeRange$.value;if(e.end-e.start>=2592e3?t=\"L'intervalle demand\\xe9 est cons\\xe9quent\":this.selectedFleet$.value.ships.length>=200&&(t=\"La flotte contient beaucoup de navires\"),t&&!(yield this.uiService.confirmAsync({title:\"Confirmation\",message:`${t} et pourrait ralentir le serveur. \\xcates-vous s\\xfbr de vouloir effectuer l'action ?`})))return}if(this.displayFleetTrail$.next(!this.displayFleetTrail$.value),this.displayFleetTrail$.value){const t=this.timeRangeService.timeRange$.value,e=yield this.workerService.fleets.getFleetTrails(this.selectedFleet$.value.id,t.start,t.end,this.mapConfigService.detailedShipTraces$.value),i=this.selectedFleet$.value.ships.reduce((t,e)=>(t[e.mmsi]=e,t),{}),n=Object.entries(e).map(([t,e])=>e.map(e=>(e.ship=i[t],e)));this.fleetTrails$.next(n)}else this.fleetTrails$.next([])}),this.mapConfigService.detailedShipTraces$.subscribe(()=>Hp(this,void 0,void 0,function*(){this.selectedFleet$.value&&(yield this.selectFleet(this.selectedFleet$.value.id))})),JT([this.mapConfigService.shipFilter$.pipe(M(t=>t.fleets),Tf()),this.mapConfigService.shipFilter$.pipe(M(t=>t.intersectFleets),Tf()),this.fleets$]).subscribe(([t,e])=>{if(e){const[e,...i]=t.map(t=>{var e;return null===(e=this.fleetsById[t])||void 0===e?void 0:e.ships.map(t=>t.mmsi)});if(void 0===e)return void(this.mapConfigService.shipFilter$.value.fleetsShipsCache=new Set);this.mapConfigService.shipFilter$.value.fleetsShipsCache=new Set(e.filter(t=>i.every(e=>e.includes(t))))}else this.mapConfigService.shipFilter$.value.fleetsShipsCache=new Set(t.flatMap(t=>{var e;return null===(e=this.fleetsById[t])||void 0===e?void 0:e.ships.map(t=>t.mmsi)}))})}setFleets(t){this.fleetsById=t.reduce((t,e)=>(t[e.id]=e,t),{}),this.fleets$.next(t)}refreshFleets(){return Hp(this,void 0,void 0,function*(){const t=yield this.workerService.fleets.list();return this.setFleets(t),t})}clear(){this.fleets$.next([])}selectFleet(t){return Hp(this,void 0,void 0,function*(){this.selectingFleet=!0;const e=this.timeRangeService.timeRange$.value;let i,n;if(this.offlineService.isOffline$.value){const e=this.fleets$.value.find(e=>e.id===t);if(!e)throw new Error(\"Flotte inconnue\");[i,n]=yield Promise.all([this.workerService.offline.getFleet(e),this.workerService.offline.getFleetAlerts(e.ships.map(t=>t.mmsi))])}else[i,n]=yield Promise.all([this.workerService.fleets.get(t),this.workerService.fleets.getFleetAlerts(t,e.start,e.end)]);return this.selectedFleet$.next(i),n.forEach(t=>{const[e,i]=this.alertRulesService.getAlertRuleColor(t.rule_id);t.color=e,t.rgbVecColor=i}),this.fleetAlerts$.next(n),this.selectingFleet=!1,{fleet:i,trailsByMMSI:void 0,alerts:n}})}deselectFleet(){this.selectedFleet$.next(null),this.fleetAlerts$.next([]),this.fleetTrails$.next([]),this.displayFleetTrail$.next(!1)}createFleet(t){return Hp(this,void 0,void 0,function*(){const e=BY(t);let i;return i=t.group_id?yield this.workerService.fleets.createGroupFleet(t.group_id,e):yield this.workerService.fleets.createPersonalFleet(e),this.mapConfigService.enableWebsockets$.value||(yield this.refreshFleets()),i})}updateFleet(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.fleets.update(BY(t)),this.mapConfigService.enableWebsockets$.value||(yield this.refreshFleets())})}deleteFleet(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.fleets.delete(t),this.mapConfigService.enableWebsockets$.value||(yield this.refreshFleets())})}resetDisplayFleetTrails(){this.displayFleetTrail$.next(!1),this.fleetTrails$.next([])}}return t.\\u0275fac=function(e){return new(e||t)(Mn(DH),Mn(qU),Mn(MY),Mn(Kq),Mn(_H),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();var VY=(()=>(function(t){t.Guest=\"guest\",t.Contributor=\"contributor\",t.Owner=\"owner\"}(VY||(VY={})),VY))();const $Y=[{role:VY.Guest,label:\"Invit\\xe9\",backgroundColor:\"#3c94ee\"},{role:VY.Contributor,label:\"Contributeur\",backgroundColor:\"#3c4bee\"},{role:VY.Owner,label:\"Propri\\xe9taire\",backgroundColor:\"#7329eb\"}];let UY=(()=>{class t{constructor(t){this.workerService=t,this.groups$=new Jp([]),this.groupsById$=new Jp({}),this.groupDeletion$=new C,this.updatableGroups$=this.groups$.pipe(M(t=>[...t.filter(t=>t.role!==VY.Guest).map(t=>({id:t.id,name:t.name})),{id:\"\",name:\"Priv\\xe9\"}])),this.groups$.subscribe(t=>{this.groupsById$.next(t.reduce((t,e)=>(t[e.id]=e,t),{}))}),this.groupDeletion$.subscribe(t=>{this.groups$.next(this.groups$.value.filter(e=>e.id!==t))})}refreshGroups(){return Hp(this,void 0,void 0,function*(){const t=yield this.workerService.groups.listGroups();return this.groups$.next(t),t})}updateGroupInfos(t){const e=this.groupsById$.value[t.id];e.name=t.name,e.updated_at=t.updated_at,this.groups$.next(this.groups$.value)}removeGroup(t){this.groupDeletion$.next(t)}clear(){this.groups$.next([])}setGroups(t){this.groups$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),jY=(()=>{class t{constructor(){this.initialized$=new Jp(!1)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const HY=Object.create(null);HY.open=\"0\",HY.close=\"1\",HY.ping=\"2\",HY.pong=\"3\",HY.message=\"4\",HY.upgrade=\"5\",HY.noop=\"6\";const GY=Object.create(null);Object.keys(HY).forEach(t=>{GY[HY[t]]=t});const WY={type:\"error\",data:\"parser error\"},qY=\"function\"==typeof Blob||\"undefined\"!=typeof Blob&&\"[object BlobConstructor]\"===Object.prototype.toString.call(Blob),YY=\"function\"==typeof ArrayBuffer,ZY=({type:t,data:e},i,n)=>qY&&e instanceof Blob?i?n(e):KY(e,n):YY&&(e instanceof ArrayBuffer||(t=>\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer)(e))?i?n(e):KY(new Blob([e]),n):n(HY[t]+(e||\"\")),KY=(t,e)=>{const i=new FileReader;return i.onload=function(){const t=i.result.split(\",\")[1];e(\"b\"+t)},i.readAsDataURL(t)};for(var XY=ZY,QY=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",JY=\"undefined\"==typeof Uint8Array?[]:new Uint8Array(256),tZ=0;tZ<QY.length;tZ++)JY[QY.charCodeAt(tZ)]=tZ;const eZ=\"function\"==typeof ArrayBuffer,iZ=(t,e)=>{if(eZ){const i=function(t){var e,i,n,s,r,o=.75*t.length,a=t.length,l=0;\"=\"===t[t.length-1]&&(o--,\"=\"===t[t.length-2]&&o--);var c=new ArrayBuffer(o),h=new Uint8Array(c);for(e=0;e<a;e+=4)i=JY[t.charCodeAt(e)],n=JY[t.charCodeAt(e+1)],s=JY[t.charCodeAt(e+2)],r=JY[t.charCodeAt(e+3)],h[l++]=i<<2|n>>4,h[l++]=(15&n)<<4|s>>2,h[l++]=(3&s)<<6|63&r;return c}(t);return nZ(i,e)}return{base64:!0,data:t}},nZ=(t,e)=>{switch(e){case\"blob\":return t instanceof ArrayBuffer?new Blob([t]):t;case\"arraybuffer\":default:return t}};var sZ=(t,e)=>{if(\"string\"!=typeof t)return{type:\"message\",data:nZ(t,e)};const i=t.charAt(0);return\"b\"===i?{type:\"message\",data:iZ(t.substring(1),e)}:GY[i]?t.length>1?{type:GY[i],data:t.substring(1)}:{type:GY[i]}:WY};const rZ=String.fromCharCode(30);function oZ(t){if(t)return function(t){for(var e in oZ.prototype)t[e]=oZ.prototype[e];return t}(t)}oZ.prototype.on=oZ.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[\"$\"+t]=this._callbacks[\"$\"+t]||[]).push(e),this},oZ.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},oZ.prototype.off=oZ.prototype.removeListener=oZ.prototype.removeAllListeners=oZ.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i=this._callbacks[\"$\"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks[\"$\"+t],this;for(var n,s=0;s<i.length;s++)if((n=i[s])===e||n.fn===e){i.splice(s,1);break}return 0===i.length&&delete this._callbacks[\"$\"+t],this},oZ.prototype.emitReserved=oZ.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks[\"$\"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){n=0;for(var s=(i=i.slice(0)).length;n<s;++n)i[n].apply(this,e)}return this},oZ.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[\"$\"+t]||[]},oZ.prototype.hasListeners=function(t){return!!this.listeners(t).length};var aZ=\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:Function(\"return this\")();function lZ(t,...e){return e.reduce((e,i)=>(t.hasOwnProperty(i)&&(e[i]=t[i]),e),{})}const cZ=setTimeout,hZ=clearTimeout;function uZ(t,e){e.useNativeTimers?(t.setTimeoutFn=cZ.bind(aZ),t.clearTimeoutFn=hZ.bind(aZ)):(t.setTimeoutFn=setTimeout.bind(aZ),t.clearTimeoutFn=clearTimeout.bind(aZ))}function dZ(t){return\"string\"==typeof t?function(t){let e=0,i=0;for(let n=0,s=t.length;n<s;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}(t):Math.ceil(1.33*(t.byteLength||t.size))}class pZ extends Error{constructor(t,e,i){super(t),this.description=e,this.context=i,this.type=\"TransportError\"}}class fZ extends oZ{constructor(t){super(),this.writable=!1,uZ(this,t),this.opts=t,this.query=t.query,this.readyState=\"\",this.socket=t.socket}onError(t,e,i){return super.emitReserved(\"error\",new pZ(t,e,i)),this}open(){return(\"closed\"===this.readyState||\"\"===this.readyState)&&(this.readyState=\"opening\",this.doOpen()),this}close(){return(\"opening\"===this.readyState||\"open\"===this.readyState)&&(this.doClose(),this.onClose()),this}send(t){\"open\"===this.readyState&&this.write(t)}onOpen(){this.readyState=\"open\",this.writable=!0,super.emitReserved(\"open\")}onData(t){const e=sZ(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved(\"packet\",t)}onClose(t){this.readyState=\"closed\",super.emitReserved(\"close\",t)}}const mZ=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),gZ={};let AZ,vZ=0,_Z=0;function bZ(t){let e=\"\";do{e=mZ[t%64]+e,t=Math.floor(t/64)}while(t>0);return e}function yZ(){const t=bZ(+new Date);return t!==AZ?(vZ=0,AZ=t):t+\".\"+bZ(vZ++)}for(;_Z<64;_Z++)gZ[mZ[_Z]]=_Z;function wZ(t){let e=\"\";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+=\"&\"),e+=encodeURIComponent(i)+\"=\"+encodeURIComponent(t[i]));return e}let xZ=!1;try{xZ=\"undefined\"!=typeof XMLHttpRequest&&\"withCredentials\"in new XMLHttpRequest}catch(p){}const SZ=xZ;function CZ(t){const e=t.xdomain;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!e||SZ))return new XMLHttpRequest}catch(i){}if(!e)try{return new(aZ[[\"Active\"].concat(\"Object\").join(\"X\")])(\"Microsoft.XMLHTTP\")}catch(i){}}function kZ(){}const EZ=null!=new CZ({xdomain:!1}).responseType;let MZ=(()=>{class t extends oZ{constructor(t,e){super(),uZ(this,e),this.opts=e,this.method=e.method||\"GET\",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const e=lZ(this.opts,\"agent\",\"pfx\",\"key\",\"passphrase\",\"cert\",\"ca\",\"ciphers\",\"rejectUnauthorized\",\"autoUnref\");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const i=this.xhr=new CZ(e);try{i.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&i.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(n){}if(\"POST\"===this.method)try{i.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}catch(n){}try{i.setRequestHeader(\"Accept\",\"*/*\")}catch(n){}\"withCredentials\"in i&&(i.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(i.timeout=this.opts.requestTimeout),i.onreadystatechange=()=>{4===i.readyState&&(200===i.status||1223===i.status?this.onLoad():this.setTimeoutFn(()=>{this.onError(\"number\"==typeof i.status?i.status:0)},0))},i.send(this.data)}catch(n){return void this.setTimeoutFn(()=>{this.onError(n)},0)}\"undefined\"!=typeof document&&(this.index=t.requestsCount++,t.requests[this.index]=this)}onError(t){this.emitReserved(\"error\",t,this.xhr),this.cleanup(!0)}cleanup(e){if(null!=this.xhr){if(this.xhr.onreadystatechange=kZ,e)try{this.xhr.abort()}catch(i){}\"undefined\"!=typeof document&&delete t.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved(\"data\",t),this.emitReserved(\"success\"),this.cleanup())}abort(){this.cleanup()}}return t.requestsCount=0,t.requests={},t})();function TZ(){for(let t in MZ.requests)MZ.requests.hasOwnProperty(t)&&MZ.requests[t].abort()}\"undefined\"!=typeof document&&(\"function\"==typeof attachEvent?attachEvent(\"onunload\",TZ):\"function\"==typeof addEventListener&&addEventListener(\"onpagehide\"in aZ?\"pagehide\":\"unload\",TZ,!1));const IZ=\"function\"==typeof Promise&&\"function\"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,e)=>e(t,0),PZ=aZ.WebSocket||aZ.MozWebSocket,OZ=\"undefined\"!=typeof navigator&&\"string\"==typeof navigator.product&&\"reactnative\"===navigator.product.toLowerCase();class RZ extends fZ{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return\"websocket\"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,i=OZ?{}:lZ(this.opts,\"agent\",\"perMessageDeflate\",\"pfx\",\"key\",\"passphrase\",\"cert\",\"ca\",\"ciphers\",\"rejectUnauthorized\",\"localAddress\",\"protocolVersion\",\"origin\",\"maxPayload\",\"family\",\"checkServerIdentity\");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=OZ?new PZ(t,e,i):e?new PZ(t,e):new PZ(t)}catch(n){return this.emitReserved(\"error\",n)}this.ws.binaryType=this.socket.binaryType||\"arraybuffer\",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:\"websocket connection closed\",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError(\"websocket error\",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const i=e===t.length-1;XY(t[e],this.supportsBinary,t=>{try{this.ws.send(t)}catch(e){}i&&IZ(()=>{this.writable=!0,this.emitReserved(\"drain\")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?\"wss\":\"ws\";let i=\"\";this.opts.port&&(\"wss\"===e&&443!==Number(this.opts.port)||\"ws\"===e&&80!==Number(this.opts.port))&&(i=\":\"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=yZ()),this.supportsBinary||(t.b64=1);const n=wZ(t);return e+\"://\"+(-1!==this.opts.hostname.indexOf(\":\")?\"[\"+this.opts.hostname+\"]\":this.opts.hostname)+i+this.opts.path+(n.length?\"?\"+n:\"\")}check(){return!(!PZ||\"__initialize\"in PZ&&this.name===RZ.prototype.name)}}const DZ={websocket:RZ,polling:class extends fZ{constructor(t){if(super(t),this.polling=!1,\"undefined\"!=typeof location){const e=\"https:\"===location.protocol;let i=location.port;i||(i=e?\"443\":\"80\"),this.xd=\"undefined\"!=typeof location&&t.hostname!==location.hostname||i!==t.port,this.xs=t.secure!==e}this.supportsBinary=EZ&&!(t&&t.forceBase64)}get name(){return\"polling\"}doOpen(){this.poll()}pause(t){this.readyState=\"pausing\";const e=()=>{this.readyState=\"paused\",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once(\"pollComplete\",function(){--t||e()})),this.writable||(t++,this.once(\"drain\",function(){--t||e()}))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved(\"poll\")}onData(t){((t,e)=>{const i=t.split(rZ),n=[];for(let s=0;s<i.length;s++){const t=sZ(i[s],e);if(n.push(t),\"error\"===t.type)break}return n})(t,this.socket.binaryType).forEach(t=>{if(\"opening\"===this.readyState&&\"open\"===t.type&&this.onOpen(),\"close\"===t.type)return this.onClose({description:\"transport closed by the server\"}),!1;this.onPacket(t)}),\"closed\"!==this.readyState&&(this.polling=!1,this.emitReserved(\"pollComplete\"),\"open\"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:\"close\"}])};\"open\"===this.readyState?t():this.once(\"open\",t)}write(t){this.writable=!1,((t,e)=>{const i=t.length,n=new Array(i);let s=0;t.forEach((t,r)=>{XY(t,!1,t=>{n[r]=t,++s===i&&e(n.join(rZ))})})})(t,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved(\"drain\")})})}uri(){let t=this.query||{};const e=this.opts.secure?\"https\":\"http\";let i=\"\";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=yZ()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&(\"https\"===e&&443!==Number(this.opts.port)||\"http\"===e&&80!==Number(this.opts.port))&&(i=\":\"+this.opts.port);const n=wZ(t);return e+\"://\"+(-1!==this.opts.hostname.indexOf(\":\")?\"[\"+this.opts.hostname+\"]\":this.opts.hostname)+i+this.opts.path+(n.length?\"?\"+n:\"\")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new MZ(this.uri(),t)}doWrite(t,e){const i=this.request({method:\"POST\",data:t});i.on(\"success\",e),i.on(\"error\",(t,e)=>{this.onError(\"xhr post error\",t,e)})}doPoll(){const t=this.request();t.on(\"data\",this.onData.bind(this)),t.on(\"error\",(t,e)=>{this.onError(\"xhr poll error\",t,e)}),this.pollXhr=t}}},LZ=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,FZ=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];function NZ(t){const e=t,i=t.indexOf(\"[\"),n=t.indexOf(\"]\");-1!=i&&-1!=n&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,\";\")+t.substring(n,t.length));let s=LZ.exec(t||\"\"),r={},o=14;for(;o--;)r[FZ[o]]=s[o]||\"\";return-1!=i&&-1!=n&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,\":\"),r.authority=r.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\"),r.ipv6uri=!0),r.pathNames=function(t,e){const i=e.replace(/\\/{2,9}/g,\"/\").split(\"/\");return(\"/\"==e.substr(0,1)||0===e.length)&&i.splice(0,1),\"/\"==e.substr(e.length-1,1)&&i.splice(i.length-1,1),i}(0,r.path),r.queryKey=function(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(t,e,n){e&&(i[e]=n)}),i}(0,r.query),r}let BZ=(()=>{class t extends oZ{constructor(t,e={}){super(),t&&\"object\"==typeof t&&(e=t,t=null),t?(t=NZ(t),e.hostname=t.host,e.secure=\"https\"===t.protocol||\"wss\"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=NZ(e.host).host),uZ(this,e),this.secure=null!=e.secure?e.secure:\"undefined\"!=typeof location&&\"https:\"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?\"443\":\"80\"),this.hostname=e.hostname||(\"undefined\"!=typeof location?location.hostname:\"localhost\"),this.port=e.port||(\"undefined\"!=typeof location&&location.port?location.port:this.secure?\"443\":\"80\"),this.transports=e.transports||[\"polling\",\"websocket\"],this.readyState=\"\",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:\"/engine.io\",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:\"t\",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\\/$/,\"\")+\"/\",\"string\"==typeof this.opts.query&&(this.opts.query=function(t){let e={},i=t.split(\"&\");for(let n=0,s=i.length;n<s;n++){let t=i[n].split(\"=\");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return e}(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,\"function\"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener(\"beforeunload\",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),\"localhost\"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose(\"transport close\",{description:\"network connection lost\"})},addEventListener(\"offline\",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=4,e.transport=t,this.id&&(e.sid=this.id);const i=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new DZ[t](i)}open(){let e;if(this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&-1!==this.transports.indexOf(\"websocket\"))e=\"websocket\";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved(\"error\",\"No transports available\")},0);e=this.transports[0]}this.readyState=\"opening\";try{e=this.createTransport(e)}catch(i){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on(\"drain\",this.onDrain.bind(this)).on(\"packet\",this.onPacket.bind(this)).on(\"error\",this.onError.bind(this)).on(\"close\",t=>this.onClose(\"transport close\",t))}probe(e){let i=this.createTransport(e),n=!1;t.priorWebsocketSuccess=!1;const s=()=>{n||(i.send([{type:\"ping\",data:\"probe\"}]),i.once(\"packet\",e=>{if(!n)if(\"pong\"===e.type&&\"probe\"===e.data){if(this.upgrading=!0,this.emitReserved(\"upgrading\",i),!i)return;t.priorWebsocketSuccess=\"websocket\"===i.name,this.transport.pause(()=>{n||\"closed\"!==this.readyState&&(h(),this.setTransport(i),i.send([{type:\"upgrade\"}]),this.emitReserved(\"upgrade\",i),i=null,this.upgrading=!1,this.flush())})}else{const t=new Error(\"probe error\");t.transport=i.name,this.emitReserved(\"upgradeError\",t)}}))};function r(){n||(n=!0,h(),i.close(),i=null)}const o=t=>{const e=new Error(\"probe error: \"+t);e.transport=i.name,r(),this.emitReserved(\"upgradeError\",e)};function a(){o(\"transport closed\")}function l(){o(\"socket closed\")}function c(t){i&&t.name!==i.name&&r()}const h=()=>{i.removeListener(\"open\",s),i.removeListener(\"error\",o),i.removeListener(\"close\",a),this.off(\"close\",l),this.off(\"upgrading\",c)};i.once(\"open\",s),i.once(\"error\",o),i.once(\"close\",a),this.once(\"close\",l),this.once(\"upgrading\",c),i.open()}onOpen(){if(this.readyState=\"open\",t.priorWebsocketSuccess=\"websocket\"===this.transport.name,this.emitReserved(\"open\"),this.flush(),\"open\"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if(\"opening\"===this.readyState||\"open\"===this.readyState||\"closing\"===this.readyState)switch(this.emitReserved(\"packet\",t),this.emitReserved(\"heartbeat\"),t.type){case\"open\":this.onHandshake(JSON.parse(t.data));break;case\"ping\":this.resetPingTimeout(),this.sendPacket(\"pong\"),this.emitReserved(\"ping\"),this.emitReserved(\"pong\");break;case\"error\":const e=new Error(\"server error\");e.code=t.data,this.onError(e);break;case\"message\":this.emitReserved(\"data\",t.data),this.emitReserved(\"message\",t.data)}}onHandshake(t){this.emitReserved(\"handshake\",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),\"closed\"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose(\"ping timeout\")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved(\"drain\"):this.flush()}flush(){if(\"closed\"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved(\"flush\")}}getWritablePackets(){if(!(this.maxPayload&&\"polling\"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let e=0;e<this.writeBuffer.length;e++){const i=this.writeBuffer[e].data;if(i&&(t+=dZ(i)),e>0&&t>this.maxPayload)return this.writeBuffer.slice(0,e);t+=2}return this.writeBuffer}write(t,e,i){return this.sendPacket(\"message\",t,e,i),this}send(t,e,i){return this.sendPacket(\"message\",t,e,i),this}sendPacket(t,e,i,n){if(\"function\"==typeof e&&(n=e,e=void 0),\"function\"==typeof i&&(n=i,i=null),\"closing\"===this.readyState||\"closed\"===this.readyState)return;(i=i||{}).compress=!1!==i.compress;const s={type:t,data:e,options:i};this.emitReserved(\"packetCreate\",s),this.writeBuffer.push(s),n&&this.once(\"flush\",n),this.flush()}close(){const t=()=>{this.onClose(\"forced close\"),this.transport.close()},e=()=>{this.off(\"upgrade\",e),this.off(\"upgradeError\",e),t()},i=()=>{this.once(\"upgrade\",e),this.once(\"upgradeError\",e)};return(\"opening\"===this.readyState||\"open\"===this.readyState)&&(this.readyState=\"closing\",this.writeBuffer.length?this.once(\"drain\",()=>{this.upgrading?i():t()}):this.upgrading?i():t()),this}onError(e){t.priorWebsocketSuccess=!1,this.emitReserved(\"error\",e),this.onClose(\"transport error\",e)}onClose(t,e){(\"opening\"===this.readyState||\"open\"===this.readyState||\"closing\"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners(\"close\"),this.transport.close(),this.transport.removeAllListeners(),\"function\"==typeof removeEventListener&&removeEventListener(\"offline\",this.offlineEventListener,!1),this.readyState=\"closed\",this.id=null,this.emitReserved(\"close\",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let i=0;const n=t.length;for(;i<n;i++)~this.transports.indexOf(t[i])&&e.push(t[i]);return e}}return t.protocol=4,t})();const zZ=\"function\"==typeof ArrayBuffer,VZ=Object.prototype.toString,$Z=\"function\"==typeof Blob||\"undefined\"!=typeof Blob&&\"[object BlobConstructor]\"===VZ.call(Blob),UZ=\"function\"==typeof File||\"undefined\"!=typeof File&&\"[object FileConstructor]\"===VZ.call(File);function jZ(t){return zZ&&(t instanceof ArrayBuffer||(t=>\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer)(t))||$Z&&t instanceof Blob||UZ&&t instanceof File}function HZ(t,e){if(!t||\"object\"!=typeof t)return!1;if(Array.isArray(t)){for(let e=0,i=t.length;e<i;e++)if(HZ(t[e]))return!0;return!1}if(jZ(t))return!0;if(t.toJSON&&\"function\"==typeof t.toJSON&&1===arguments.length)return HZ(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&HZ(t[i]))return!0;return!1}function GZ(t){const e=[],i=t;return i.data=WZ(t.data,e),i.attachments=e.length,{packet:i,buffers:e}}function WZ(t,e){if(!t)return t;if(jZ(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=WZ(t[n],e);return i}if(\"object\"==typeof t&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=WZ(t[n],e));return i}return t}function qZ(t,e){return t.data=YZ(t.data,e),t.attachments=void 0,t}function YZ(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=YZ(t[i],e);else if(\"object\"==typeof t)for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=YZ(t[i],e));return t}const ZZ=5;var KZ=(()=>(function(t){t[t.CONNECT=0]=\"CONNECT\",t[t.DISCONNECT=1]=\"DISCONNECT\",t[t.EVENT=2]=\"EVENT\",t[t.ACK=3]=\"ACK\",t[t.CONNECT_ERROR=4]=\"CONNECT_ERROR\",t[t.BINARY_EVENT=5]=\"BINARY_EVENT\",t[t.BINARY_ACK=6]=\"BINARY_ACK\"}(KZ||(KZ={})),KZ))();class XZ{constructor(t){this.replacer=t}encode(t){return t.type!==KZ.EVENT&&t.type!==KZ.ACK||!HZ(t)?[this.encodeAsString(t)]:(t.type=t.type===KZ.EVENT?KZ.BINARY_EVENT:KZ.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=\"\"+t.type;return(t.type===KZ.BINARY_EVENT||t.type===KZ.BINARY_ACK)&&(e+=t.attachments+\"-\"),t.nsp&&\"/\"!==t.nsp&&(e+=t.nsp+\",\"),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=GZ(t),i=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(i),n}}class QZ extends oZ{constructor(t){super(),this.reviver=t}add(t){let e;if(\"string\"==typeof t)e=this.decodeString(t),e.type===KZ.BINARY_EVENT||e.type===KZ.BINARY_ACK?(this.reconstructor=new JZ(e),0===e.attachments&&super.emitReserved(\"decoded\",e)):super.emitReserved(\"decoded\",e);else{if(!jZ(t)&&!t.base64)throw new Error(\"Unknown type: \"+t);if(!this.reconstructor)throw new Error(\"got binary data when not reconstructing a packet\");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved(\"decoded\",e))}}decodeString(t){let e=0;const i={type:Number(t.charAt(0))};if(void 0===KZ[i.type])throw new Error(\"unknown packet type \"+i.type);if(i.type===KZ.BINARY_EVENT||i.type===KZ.BINARY_ACK){const n=e+1;for(;\"-\"!==t.charAt(++e)&&e!=t.length;);const s=t.substring(n,e);if(s!=Number(s)||\"-\"!==t.charAt(e))throw new Error(\"Illegal attachments\");i.attachments=Number(s)}if(\"/\"===t.charAt(e+1)){const n=e+1;for(;++e&&\",\"!==t.charAt(e)&&e!==t.length;);i.nsp=t.substring(n,e)}else i.nsp=\"/\";const n=t.charAt(e+1);if(\"\"!==n&&Number(n)==n){const n=e+1;for(;++e;){const i=t.charAt(e);if(null==i||Number(i)!=i){--e;break}if(e===t.length)break}i.id=Number(t.substring(n,e+1))}if(t.charAt(++e)){const n=this.tryParse(t.substr(e));if(!QZ.isPayloadValid(i.type,n))throw new Error(\"invalid payload\");i.data=n}return i}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case KZ.CONNECT:return\"object\"==typeof e;case KZ.DISCONNECT:return void 0===e;case KZ.CONNECT_ERROR:return\"string\"==typeof e||\"object\"==typeof e;case KZ.EVENT:case KZ.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case KZ.ACK:case KZ.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class JZ{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=qZ(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function tK(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const eK=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class iK extends oZ{constructor(t,e,i){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,i&&i.auth&&(this.auth=i.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[tK(t,\"open\",this.onopen.bind(this)),tK(t,\"packet\",this.onpacket.bind(this)),tK(t,\"error\",this.onerror.bind(this)),tK(t,\"close\",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),\"open\"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift(\"message\"),this.emit.apply(this,t),this}emit(t,...e){if(eK.hasOwnProperty(t))throw new Error('\"'+t+'\" is a reserved event name');e.unshift(t);const i={type:KZ.EVENT,data:e,options:{}};if(i.options.compress=!1!==this.flags.compress,\"function\"==typeof e[e.length-1]){const t=this.ids++,n=e.pop();this._registerAckCallback(t,n),i.id=t}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(t,e){const i=this.flags.timeout;if(void 0===i)return void(this.acks[t]=e);const n=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error(\"operation has timed out\"))},i);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(n),e.apply(this,[null,...t])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){\"function\"==typeof this.auth?this.auth(t=>{this.packet({type:KZ.CONNECT,data:t})}):this.packet({type:KZ.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved(\"connect_error\",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved(\"disconnect\",t,e)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case KZ.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid):this.emitReserved(\"connect_error\",new Error(\"It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)\"));break;case KZ.EVENT:case KZ.BINARY_EVENT:this.onevent(t);break;case KZ.ACK:case KZ.BINARY_ACK:this.onack(t);break;case KZ.DISCONNECT:this.ondisconnect();break;case KZ.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved(\"connect_error\",e)}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const i of e)i.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let i=!1;return function(...n){i||(i=!0,e.packet({type:KZ.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];\"function\"==typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved(\"connect\")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose(\"io server disconnect\")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:KZ.DISCONNECT}),this.destroy(),this.connected&&this.onclose(\"io client disconnect\"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let i=0;i<e.length;i++)if(t===e[i])return e.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const i of e)i.apply(this,t.data)}}}function nK(t){this.ms=(t=t||{}).min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}nK.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-i:t+i}return 0|Math.min(t,this.max)},nK.prototype.reset=function(){this.attempts=0},nK.prototype.setMin=function(t){this.ms=t},nK.prototype.setMax=function(t){this.max=t},nK.prototype.setJitter=function(t){this.jitter=t};class sK extends oZ{constructor(t,e){var i;super(),this.nsps={},this.subs=[],t&&\"object\"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||\"/socket.io\",this.opts=e,uZ(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(i=e.randomizationFactor)&&void 0!==i?i:.5),this.backoff=new nK({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState=\"closed\",this.uri=t;const s=e.parser||n;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf(\"open\"))return this;this.engine=new BZ(this.uri,this.opts);const e=this.engine,i=this;this._readyState=\"opening\",this.skipReconnect=!1;const n=tK(e,\"open\",function(){i.onopen(),t&&t()}),s=tK(e,\"error\",e=>{i.cleanup(),i._readyState=\"closed\",this.emitReserved(\"error\",e),t?t(e):i.maybeReconnectOnOpen()});if(!1!==this._timeout){const t=this._timeout;0===t&&n();const i=this.setTimeoutFn(()=>{n(),e.close(),e.emit(\"error\",new Error(\"timeout\"))},t);this.opts.autoUnref&&i.unref(),this.subs.push(function(){clearTimeout(i)})}return this.subs.push(n),this.subs.push(s),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState=\"open\",this.emitReserved(\"open\");const t=this.engine;this.subs.push(tK(t,\"ping\",this.onping.bind(this)),tK(t,\"data\",this.ondata.bind(this)),tK(t,\"error\",this.onerror.bind(this)),tK(t,\"close\",this.onclose.bind(this)),tK(this.decoder,\"decoded\",this.ondecoded.bind(this)))}onping(){this.emitReserved(\"ping\")}ondata(t){this.decoder.add(t)}ondecoded(t){this.emitReserved(\"packet\",t)}onerror(t){this.emitReserved(\"error\",t)}socket(t,e){let i=this.nsps[t];return i||(i=new iK(this,t,e),this.nsps[t]=i),i}_destroy(t){const e=Object.keys(this.nsps);for(const i of e)if(this.nsps[i].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let i=0;i<e.length;i++)this.engine.write(e[i],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose(\"forced close\"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState=\"closed\",this.emitReserved(\"close\",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved(\"reconnect_failed\"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved(\"reconnect_attempt\",t.backoff.attempts),!t.skipReconnect&&t.open(e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved(\"reconnect_error\",e)):t.onreconnect()}))},e);this.opts.autoUnref&&i.unref(),this.subs.push(function(){clearTimeout(i)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved(\"reconnect\",t)}}const rK={};function oK(t,e){\"object\"==typeof t&&(e=t,t=void 0);const i=function(t,e=\"\",i){let n=t;i=i||\"undefined\"!=typeof location&&location,null==t&&(t=i.protocol+\"//\"+i.host),\"string\"==typeof t&&(\"/\"===t.charAt(0)&&(t=\"/\"===t.charAt(1)?i.protocol+t:i.host+t),/^(https?|wss?):\\/\\//.test(t)||(t=void 0!==i?i.protocol+\"//\"+t:\"https://\"+t),n=NZ(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port=\"80\":/^(http|ws)s$/.test(n.protocol)&&(n.port=\"443\")),n.path=n.path||\"/\";const s=-1!==n.host.indexOf(\":\")?\"[\"+n.host+\"]\":n.host;return n.id=n.protocol+\"://\"+s+\":\"+n.port+e,n.href=n.protocol+\"://\"+s+(i&&i.port===n.port?\"\":\":\"+n.port),n}(t,(e=e||{}).path||\"/socket.io\"),n=i.source,s=i.id;let r;return e.forceNew||e[\"force new connection\"]||!1===e.multiplex||rK[s]&&i.path in rK[s].nsps?r=new sK(n,e):(rK[s]||(rK[s]=new sK(n,e)),r=rK[s]),i.query&&!e.query&&(e.query=i.queryKey),r.socket(i.path,e)}Object.assign(oK,{Manager:sK,Socket:iK,io:oK,connect:oK});let aK=(()=>{class t{constructor(t,e,i){this.authenticationService=t,this.mapConfigService=e,this.offlineService=i,this.events$=new C,this.enabled$=JT([this.authenticationService.user$,this.mapConfigService.enableWebsockets$,this.offlineService.isOffline$]).pipe(M(([t,e,i])=>!!t&&e&&!i),Tf()),this.connected$=new Jp(!1),this.enabled$.subscribe(t=>{var e;t?this.connect():null===(e=this.socket)||void 0===e||e.disconnect()})}connect(){var t;null===(t=this.socket)||void 0===t||t.disconnect(),console.log(\"WS: connecting\"),this.socket=oK(window.__anaisSettings.ANAIS_SERVER_URL,{path:\"/ws\",rememberUpgrade:!0,transports:[\"websocket\"]}),this.socket.on(\"connect\",()=>{console.log(\"WS: connected\"),this.connected$.next(!0)}),this.socket.on(\"disconnect\",t=>Hp(this,void 0,void 0,function*(){console.error(`WS: disconnected ${t}`),this.connected$.next(!1),\"io server disconnect\"===t&&this.connect()})),this.socket.on(\"connect_error\",t=>Hp(this,void 0,void 0,function*(){console.error(\"WS: connect_error\",t),\"websocket error\"!==t.message&&(yield hU(2e3),this.connect())})),this.socket.on(\"event\",t=>{console.log(\"WS: event\",t),this.events$.next(t)})}subscribeForEvents(t){this.socket.emit(\"subscribe\",t)}unsubscribeForEvents(t){this.socket.emit(\"unsubscribe\",t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(rH),Mn(qU),Mn(MY))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),lK=(()=>{class t{constructor(t,e,i,n,s,r,o){this.appInitService=t,this.authenticationService=e,this.mapStateService=i,this.notificationsService=n,this.offlineService=s,this.portsStateService=r,this.workerService=o,this.ports$=new Jp(null),this.portsPanelState$=new Jp({nameFilter:\"\",flagFilter:[],sourceFilter:[],scrollIndex:0}),this.ports$.subscribe(t=>{this.portsStateService.updatePortById(t)}),this.authenticationService.user$.pipe(Af(t=>!!t),FO()).subscribe(()=>{this.appInitService.initialized$.pipe(Af(t=>t)).subscribe(()=>{this.mapStateService.showPortsLayer$.pipe(Af(t=>t),FO()).subscribe(()=>Hp(this,void 0,void 0,function*(){const t=yield this.offlineService.isOffline$.value?this.workerService.offline.listPorts():this.workerService.ports.listPorts();t.forEach((t,e)=>{t.color=sG[e%sG.length]}),this.ports$.next(t),this.notificationsService.subscribeForEvents(\"ports\")}))})})}updateScrollIndex(t){this.portsPanelState$.value.scrollIndex=t,this.portsPanelState$.next(this.portsPanelState$.value)}updateFlagFilter(t){this.portsPanelState$.value.flagFilter=t,this.portsPanelState$.next(this.portsPanelState$.value)}updateSourceFilter(t){this.portsPanelState$.value.sourceFilter=t,this.portsPanelState$.next(this.portsPanelState$.value)}updateNameFilter(t){this.portsPanelState$.value.nameFilter=t,this.portsPanelState$.next(this.portsPanelState$.value)}addPort(t){var e;this.ports$.value.push(t),t.color=sG[(e=sG.length-1,Math.floor(Math.random()*(e-0+1)+0))],this.ports$.next(this.ports$.value)}updatePort(t){const e=t.id,i=this.ports$.value.find(t=>t.id===e);i&&(Object.assign(i,t),this.ports$.next(this.ports$.value))}deletePort(t){this.ports$.next(this.ports$.value.filter(e=>e.id!==t))}}return t.\\u0275fac=function(e){return new(e||t)(Mn(jY),Mn(rH),Mn(Fq),Mn(aK),Mn(MY),Mn(pW),Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),cK=(()=>{class t{constructor(t,e,i,n,s,r,o,a,l,c,h,u,d,p,f,m,g,A){this.alertRulesService=t,this.alertsService=e,this.annotationsService=i,this.drawingService=n,this.eventsService=s,this.filterConfigurationsService=r,this.fleetsService=o,this.groupsService=a,this.historyService=l,this.interactionsService=c,this.mapService=h,this.mapConfigService=u,this.offlineService=d,this.portsService=p,this.timeRangeService=f,this.uiService=m,this.workerService=g,this.zonesService=A,this.initialized=!1}init(){return Hp(this,void 0,void 0,function*(){yield this.workerService.view.reset();const t=this.offlineService.getOfflineData();t?(this.groupsService.setGroups(t.groups),this.fleetsService.setFleets(t.fleets),this.zonesService.setZones(t.zones),this.annotationsService.setAnnotations(t.annotations),this.alertRulesService.setAlertRules(t.rules)):(yield Promise.all([this.groupsService.refreshGroups(),this.fleetsService.refreshFleets(),this.zonesService.refreshZones(),this.annotationsService.refreshAnnotations()]),yield this.alertRulesService.refreshAlertRules()),this.initialized=!0})}destroy(){this.alertRulesService.clear(),this.fleetsService.clear(),this.zonesService.clear(),this.annotationsService.clear(),this.filterConfigurationsService.clear(),this.mapConfigService.clear(),this.drawingService.clearZones(),this.zonesService.clear(),this.groupsService.clear(),this.initialized=!1}}return t.\\u0275fac=function(e){return new(e||t)(Mn(DH),Mn(LH),Mn(BH),Mn(zH),Mn(FY),Mn(NY),Mn(zY),Mn(UY),Mn(Fj),Mn(DY),Mn(Pj),Mn(qU),Mn(MY),Mn(lK),Mn(Kq),Mn(_H),Mn(sH),Mn(OH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),hK=(()=>{class t{constructor(t,e,i,n){this.authenticationService=t,this.initializationService=e,this.uiService=i,this.router=n}canActivateChild(t,e){return Hp(this,void 0,void 0,function*(){return this.authenticationService.isAuthenticated()?(this.initializationService.initialized||(yield this.initializationService.init()),!0):(this.uiService.error(\"Vous devez \\xeatre authentifi\\xe9\"),yield this.router.navigateByUrl(`/login?redirect=${e.url}`),!1)})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(rH),Mn(cK),Mn(_H),Mn(pL))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),uK=(()=>{class t{constructor(t){this.offlineService=t}canDeactivate(){return!this.offlineService.loading}}return t.\\u0275fac=function(e){return new(e||t)(Mn(MY))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),dK=(()=>{class t{constructor(t,e,i){this.authenticationService=t,this.uiService=e,this.router=i}canActivateChild(t,e){var i,n;return Hp(this,void 0,void 0,function*(){return!!(null===(n=null===(i=this.authenticationService.user$.value)||void 0===i?void 0:i.permissions)||void 0===n?void 0:n.port_edition)||(this.uiService.error(\"Vous n'avez pas les permissions requises.\"),yield this.router.navigateByUrl(\"/\"),!1)})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(rH),Mn(_H),Mn(pL))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),pK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-about-dialog\"]],decls:122,vars:0,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[\"href\",\"https://beta.gouv.fr/startups/anais.html\"],[\"href\",\"https://beta.gouv.fr/apropos/\"],[1,\"about-dialog__faq-title\"],[1,\"about-dialog__faq\"],[\"href\",\"https://beta.gouv.fr/startups/sepia.html\"],[\"href\",\"/3rdpartylicenses.txt\"],[\"href\",\"https://www.marineregions.org/\"],[\"href\",\"https://doi.org/10.14284/386\"]],template:function(t,e){1&t&&(La(0,\"h1\",0),xl(1,\" \\xc0 propos d'ANAIS \"),Na(2,\"div\",1),La(3,\"button\",2),La(4,\"mat-icon\"),xl(5,\"close\"),Fa(),Fa(),Fa(),La(6,\"div\"),La(7,\"h3\"),xl(8,\"ANAIS comme Analyse des Incoh\\xe9rences de Situation maritime\"),Fa(),La(9,\"p\"),xl(10,\" C'est un projet men\\xe9 en \\xab start-up d'\\xc9tat \\xbb, cr\\xe9\\xe9 par la Marine et pour la Marine, avec le soutien de l'Agence de l'Innovation de D\\xe9fense et de la fabrique num\\xe9rique. \"),Fa(),La(11,\"p\"),xl(12,\" La vocation premi\\xe8re d'ANAIS est d'apporter un service op\\xe9rationnel sans limite de licence, au plus proche du besoin op\\xe9rationnel. \"),Fa(),La(13,\"p\"),xl(14,\" L'objectif est d'avoir la main sur les d\\xe9veloppements. Il n'y a pas de logique commerciale ni contractuelle, ni de licence. \"),Fa(),La(15,\"p\"),xl(16,\" Nous allons faire \\xe9voluer ANAIS au plus pr\\xe8s des besoins des utilisateurs et rajouter au fur et \\xe0 mesure des id\\xe9es, des donn\\xe9es et des algorithmes. \"),Fa(),La(17,\"p\"),xl(18,\" ANAIS est \\xe0 utiliser en compl\\xe9ment des outils commerciaux. \"),Fa(),La(19,\"div\"),xl(20,\" Pour plus d'informations, vous pouvez consulter la \"),La(21,\"a\",3),xl(22,\"fiche produit sur beta.gouv\"),Fa(),xl(23,\" ou bien obtenir plus d'informations sur la \"),La(24,\"a\",4),xl(25,\"m\\xe9thode de d\\xe9veloppement beta.gouv\"),Fa(),xl(26,\". \"),Fa(),La(27,\"h3\",5),xl(28,\"Questions r\\xe9currentes\"),Fa(),La(29,\"div\",6),La(30,\"div\"),La(31,\"h4\"),xl(32,\"Quels sont les navigateurs compatibles ?\"),Fa(),xl(33,\" Nous visons \\xe0 rendre ANAIS compatible avec Chrome >= 56 et Firefox >= 52 (version utilis\\xe9e sur intradef). Il est recommand\\xe9 d'utiliser des versions \"),La(34,\"strong\"),xl(35,\"r\\xe9centes\"),Fa(),xl(36,\" de navigateurs afin de profiter des derni\\xe8res optimisations de performance. \"),Na(37,\"br\"),La(38,\"strong\"),xl(39,\"Internet Explorer et Edge ne sont pas test\\xe9s et ne sont probablement pas compatibles.\"),Fa(),Fa(),La(40,\"div\"),La(41,\"h4\"),xl(42,\"Compatibilit\\xe9 ISPT ?\"),Fa(),xl(43,\" ANAIS fonctionne sur le r\\xe9seau intradef avec les PC ISPT \\xe0 condition d'autoriser le d\\xe9blocage des serveurs utilis\\xe9s par ANAIS : \"),La(44,\"em\"),xl(45,\"anais.beta.gouv.fr\"),Fa(),xl(46,\" et tous les serveurs en \"),La(47,\"em\"),xl(48,\"*.anais.beta.gouv.fr\"),Fa(),xl(49,\". \"),Fa(),La(50,\"div\"),La(51,\"h4\"),xl(52,\"Quelles sont les donn\\xe9es utilis\\xe9es ? D'o\\xf9 viennent-elles ?\"),Fa(),xl(53,\" Les donn\\xe9es AIS proviennent de 2 fournisseurs : l'agence europ\\xe9enne de s\\xe9curit\\xe9 maritime (EMSA) avec le flux IMDATE (EMSA's Integrated Maritime Data Environment (IMDatE)) et CLS (couverture mondiale). \"),Na(54,\"br\"),xl(55,\" Les donn\\xe9es ADS-B des a\\xe9ronefs de notre partenaire \"),La(56,\"a\",7),xl(57,\"SEPIA\"),Fa(),xl(58,\" : ADSBHub, ELia-AF-Gao-1, ELia-AF-Gossi-1, ELia-AF-Niamey-2, FlightRadar24, Ghost, Glidernet, RTB. \"),Fa(),La(59,\"div\"),La(60,\"h4\"),xl(61,\"\\xc0 quoi servent les r\\xe8gles d'alertes ?\"),Fa(),xl(62,\" Les r\\xe8gles d'alertes permettent de configurer des crit\\xe8res et des filtres afin de lever des alertes sur des comportements bien pr\\xe9cis. Par exemple, un transbordement dans une zone. Le but des alertes est de notifier l'utilisateur automatiquement quand un comportement suspect est d\\xe9tect\\xe9. \"),Fa(),La(63,\"div\"),La(64,\"h4\"),xl(65,\"Il semble y avoir des faux-positifs sur les \\xe9v\\xe9nements !\"),Fa(),xl(66,\" La d\\xe9tection automatique des transbordements et routes erratiques est complexe. Nous essayons d'optimiser les algorithmes afin de g\\xe9rer au mieux les cas particuliers. Nous pr\\xe9voyons notamment d'exclure les zones de port car les \\xe9v\\xe9nements dans les ports sont non pertinents. \"),Fa(),La(67,\"div\"),La(68,\"h4\"),xl(69,\"Les performances sont mauvaises ! Je passe mon temps \\xe0 attendre...\"),Fa(),xl(70,\" Nous faisons notre maximum afin d'am\\xe9liorer les performances du syst\\xe8me. N'h\\xe9sitez-pas \\xe0 nous contacter pour qu'on puisse trouver un moyen d'adapter ANAIS \\xe0 votre usage. \"),Fa(),La(71,\"div\"),La(72,\"h4\"),xl(73,\"Confidentialit\\xe9\"),Fa(),xl(74,\" La connexion au serveur utilise le protocole HTTPS (TLS 1.2) et un certificat Let's Encrypt. Les serveurs et la bases de donn\\xe9es sont h\\xe9berg\\xe9s chez OVH. \"),Fa(),La(75,\"div\"),La(76,\"h4\"),xl(77,\"J'ai des id\\xe9es d'am\\xe9liorations !\"),Fa(),xl(78,\" L'\\xe9quipe derri\\xe8re ANAIS est ouverte \\xe0 toute remarque et proposition d'am\\xe9lioration. Elle se r\\xe9serve n\\xe9anmoins le droit de prioriser et d'adapter les fonctionnalit\\xe9s afin de r\\xe9pondre \\xe0 la majorit\\xe9 des utilisateurs. Vous pouvez utiliser le chat pour dialoguer directement avec l'\\xe9quipe. \"),Fa(),La(79,\"div\"),La(80,\"h4\"),xl(81,\"Je suis dans un navire / avion et j'ai un d\\xe9bit internet trop petit pour ANAIS\"),Fa(),xl(82,\" Nous avons travaill\\xe9 et travaillons toujours pour optimiser au maximum l'utilisation du d\\xe9bit. Ainsi, nous avons ajout\\xe9 des param\\xe8tres afin de limiter l'utilisation de la bande passante en environnement contraint. Ces param\\xe8tres sont accessibles via le menu \"),La(83,\"em\"),xl(84,\"Param\\xe8tres\"),Fa(),xl(85,\". \"),La(86,\"ul\"),La(87,\"li\"),xl(88,\"Activer la \"),La(89,\"em\"),xl(90,\"Restriction de carte\"),Fa(),xl(91,\" afin de ne charger qu'une zone pr\\xe9d\\xe9finie de la surface du globe\"),Fa(),La(92,\"li\"),xl(93,\"Augmenter l'\"),La(94,\"em\"),xl(95,\"intervalle de rafraichissement des derni\\xe8res positions des navires\"),Fa(),Fa(),La(96,\"li\"),xl(97,\"Augmenter la \"),La(98,\"em\"),xl(99,\"p\\xe9riode de temps par d\\xe9faut\"),Fa(),xl(100,\" pour les traces que l'on r\\xe9cup\\xe8re quand on consulte une fiche navire\"),Fa(),La(101,\"li\"),xl(102,\"Activer la \"),La(103,\"em\"),xl(104,\"limite de zoom minimum\"),Fa(),xl(105,\" afin de ne pas charger trop de navires d'un coup\"),Fa(),Fa(),Fa(),Fa(),La(106,\"h3\",5),xl(107,\"Outils Open Source\"),Fa(),La(108,\"p\"),xl(109,\" Ce projet se base enti\\xe8rement sur des outils open source dont les licences sont visibles \\xe0 cet \"),La(110,\"a\",8),xl(111,\"endroit\"),Fa(),xl(112,\". \"),Fa(),La(113,\"p\"),xl(114,\" Autres cr\\xe9dits :\"),Na(115,\"br\"),xl(116,\" - Flanders Marine Institute (2019). Maritime Boundaries Geodatabase: Maritime Boundaries and Exclusive Economic Zones (200NM), version 11. Available online at \"),La(117,\"a\",9),xl(118,\"https://www.marineregions.org/\"),Fa(),xl(119,\". \"),La(120,\"a\",10),xl(121,\"https://doi.org/10.14284/386\"),Fa(),Fa(),Fa())},directives:[rk,Ly,sk,uE],styles:[\".about-dialog__faq-title[_ngcontent-%COMP%]{margin-top:32px}.about-dialog__faq[_ngcontent-%COMP%]{display:grid;grid-gap:1em;grid-template-columns:1fr 1fr}\"]}),t})(),fK=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.titleService=t,this.router=e,this.dialog=i,this.mapService=n,this.routeService=s}ngOnInit(){this.titleService.setTitle(\"\\xc0 propos - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.dialogRef||this.createDialog()}createDialog(){this.dialogRef=this.dialog.open(pK,{height:\"90vh\",width:\"90vw\",maxWidth:\"90vw\",closeOnNavigation:!0}),this.dialogRef.afterClosed().subscribe((t=!0)=>Hp(this,void 0,void 0,function*(){if(t){const t=this.routeService.previousUrl||\"\";yield this.router.navigateByUrl(t)}}))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(pL),Oa(ik),Oa(Pj),Oa(Nj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-about-loader\"]],features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();const mK=[\"*\",[[\"mat-toolbar-row\"]]],gK=[\"*\",\"mat-toolbar-row\"],AK=Bb(class{constructor(t){this._elementRef=t}});let vK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"mat-toolbar-row\"]],hostAttrs:[1,\"mat-toolbar-row\"],exportAs:[\"matToolbarRow\"]}),t})(),_K=(()=>{class t extends AK{constructor(t,e,i){super(t),this._platform=e,this._document=i}ngAfterViewInit(){this._platform.isBrowser&&(this._checkToolbarMixedModes(),this._toolbarRows.changes.subscribe(()=>this._checkToolbarMixedModes()))}_checkToolbarMixedModes(){}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Hf),Oa(Fu))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-toolbar\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,vK,5),2&t){let t;Mh(t=Ph())&&(e._toolbarRows=t)}},hostAttrs:[1,\"mat-toolbar\"],hostVars:4,hostBindings:function(t,e){2&t&&hl(\"mat-toolbar-multiple-rows\",e._toolbarRows.length>0)(\"mat-toolbar-single-row\",0===e._toolbarRows.length)},inputs:{color:\"color\"},exportAs:[\"matToolbar\"],features:[Uo],ngContentSelectors:gK,decls:2,vars:0,template:function(t,e){1&t&&(Qa(mK),Ja(0),Ja(1,1))},styles:[\".cdk-high-contrast-active .mat-toolbar{outline:solid 1px}.mat-toolbar-row,.mat-toolbar-single-row{display:flex;box-sizing:border-box;padding:0 16px;width:100%;flex-direction:row;align-items:center;white-space:nowrap}.mat-toolbar-multiple-rows{display:flex;box-sizing:border-box;flex-direction:column;width:100%}\\n\"],encapsulation:2,changeDetection:0}),t})(),bK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[Fb],Fb]}),t})(),yK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-admin-page\"]],decls:29,vars:3,consts:[[1,\"page\"],[\"color\",\"primary\"],[1,\"mat-h1\",\"ma-0\",\"pr-3\"],[\"mat-button\",\"\",\"routerLink\",\"/\"],[3,\"vertical\"],[\"mat-button\",\"\",\"routerLink\",\"/admin/users\"],[1,\"mr-2\"],[\"mat-button\",\"\",\"routerLink\",\"/admin/groups\"],[\"mat-button\",\"\",\"routerLink\",\"/admin/maintenance\"],[1,\"page__content\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"mat-toolbar\",1),La(2,\"div\",2),xl(3,\"Administration ANAIS\"),Fa(),La(4,\"a\",3),La(5,\"mat-icon\"),xl(6,\"chevron_left\"),Fa(),La(7,\"span\"),xl(8,\"Retour \\xe0 l'interface\"),Fa(),Fa(),Na(9,\"mat-divider\",4),La(10,\"a\",5),La(11,\"mat-icon\",6),xl(12,\"supervisor_account\"),Fa(),La(13,\"span\"),xl(14,\"Utilisateurs\"),Fa(),Fa(),Na(15,\"mat-divider\",4),La(16,\"a\",7),La(17,\"mat-icon\",6),xl(18,\"groups\"),Fa(),La(19,\"span\"),xl(20,\"Groupes\"),Fa(),Fa(),Na(21,\"mat-divider\",4),La(22,\"a\",8),La(23,\"mat-icon\",6),xl(24,\"build\"),Fa(),La(25,\"span\"),xl(26,\"Maintenance\"),Fa(),Fa(),Fa(),La(27,\"div\",9),Na(28,\"router-outlet\"),Fa(),Fa()),2&t&&(Cr(9),Ra(\"vertical\",!0),Cr(6),Ra(\"vertical\",!0),Cr(6),Ra(\"vertical\",!0))},directives:[_K,Fy,gL,uE,Xq,_L],styles:[\".page[_ngcontent-%COMP%]{height:100%;max-height:100vh;overflow:auto}.page__content[_ngcontent-%COMP%]{max-width:1280px;padding:16px;margin:0 auto}\"]}),t})();var wK=(()=>(function(t){t.Planned=\"info\",t.InProgress=\"in_progress\"}(wK||(wK={})),wK))();const xK=[\"input\"],SK=function(t){return{enterDuration:t}},CK=[\"*\"],kK=new Ji(\"mat-radio-default-options\",{providedIn:\"root\",factory:function(){return{color:\"accent\"}}});let EK=0;const MK={provide:Uy,useExisting:at(()=>OK),multi:!0};class TK{constructor(t,e){this.source=t,this.value=e}}const IK=new Ji(\"MatRadioGroup\");let PK=(()=>{class t{constructor(t){this._changeDetector=t,this._value=null,this._name=\"mat-radio-group-\"+EK++,this._selected=null,this._isInitialized=!1,this._labelPosition=\"after\",this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=()=>{},this.onTouched=()=>{},this.change=new gh}get name(){return this._name}set name(t){this._name=t,this._updateRadioButtonNames()}get labelPosition(){return this._labelPosition}set labelPosition(t){this._labelPosition=\"before\"===t?\"before\":\"after\",this._markRadiosForCheck()}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}_checkSelectedRadioButton(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}get selected(){return this._selected}set selected(t){this._selected=t,this.value=t?t.value:null,this._checkSelectedRadioButton()}get disabled(){return this._disabled}set disabled(t){this._disabled=Lf(t),this._markRadiosForCheck()}get required(){return this._required}set required(t){this._required=Lf(t),this._markRadiosForCheck()}ngAfterContentInit(){this._isInitialized=!0}_touch(){this.onTouched&&this.onTouched()}_updateRadioButtonNames(){this._radios&&this._radios.forEach(t=>{t.name=this.name,t._markForCheck()})}_updateSelectedRadioFromValue(){this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach(t=>{t.checked=this.value===t.value,t.checked&&(this._selected=t)}))}_emitChangeEvent(){this._isInitialized&&this.change.emit(new TK(this._selected,this._value))}_markRadiosForCheck(){this._radios&&this._radios.forEach(t=>t._markForCheck())}writeValue(t){this.value=t,this._changeDetector.markForCheck()}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetector.markForCheck()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc))},t.\\u0275dir=Xt({type:t,inputs:{name:\"name\",labelPosition:\"labelPosition\",value:\"value\",selected:\"selected\",disabled:\"disabled\",required:\"required\",color:\"color\"},outputs:{change:\"change\"}}),t})(),OK=(()=>{class t extends PK{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"mat-radio-group\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,FK,5),2&t){let t;Mh(t=Ph())&&(e._radios=t)}},hostAttrs:[\"role\",\"radiogroup\",1,\"mat-radio-group\"],exportAs:[\"matRadioGroup\"],features:[Yl([MK,{provide:IK,useExisting:t}]),Uo]}),t})();class RK{constructor(t){this._elementRef=t}}const DK=zb(Vb(RK));let LK=(()=>{class t extends DK{constructor(t,e,i,n,s,r,o,a){super(e),this._changeDetector=i,this._focusMonitor=n,this._radioDispatcher=s,this._providerOverride=o,this._uniqueId=\"mat-radio-\"+ ++EK,this.id=this._uniqueId,this.change=new gh,this._checked=!1,this._value=null,this._removeUniqueSelectionListener=()=>{},this.radioGroup=t,this._noopAnimations=\"NoopAnimations\"===r,a&&(this.tabIndex=Ff(a,0)),this._removeUniqueSelectionListener=s.listen((t,e)=>{t!==this.id&&e===this.name&&(this.checked=!1)})}get checked(){return this._checked}set checked(t){const e=Lf(t);this._checked!==e&&(this._checked=e,e&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!e&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),e&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}get value(){return this._value}set value(t){this._value!==t&&(this._value=t,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===t),this.checked&&(this.radioGroup.selected=this)))}get labelPosition(){return this._labelPosition||this.radioGroup&&this.radioGroup.labelPosition||\"after\"}set labelPosition(t){this._labelPosition=t}get disabled(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled}set disabled(t){this._setDisabled(Lf(t))}get required(){return this._required||this.radioGroup&&this.radioGroup.required}set required(t){this._required=Lf(t)}get color(){return this._color||this.radioGroup&&this.radioGroup.color||this._providerOverride&&this._providerOverride.color||\"accent\"}set color(t){this._color=t}get inputId(){return`${this.id||this._uniqueId}-input`}focus(t,e){e?this._focusMonitor.focusVia(this._inputElement,e,t):this._inputElement.nativeElement.focus(t)}_markForCheck(){this._changeDetector.markForCheck()}ngOnInit(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.checked&&(this.radioGroup.selected=this),this.name=this.radioGroup.name)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{!t&&this.radioGroup&&this.radioGroup._touch()})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}_emitChangeEvent(){this.change.emit(new TK(this,this._value))}_isRippleDisabled(){return this.disableRipple||this.disabled}_onInputClick(t){t.stopPropagation()}_onInputInteraction(t){if(t.stopPropagation(),!this.checked&&!this.disabled){const t=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),t&&this.radioGroup._emitChangeEvent())}}_setDisabled(t){this._disabled!==t&&(this._disabled=t,this._changeDetector.markForCheck())}}return t.\\u0275fac=function(e){return new(e||t)(Oa(PK),Oa(ic),Oa(Mc),Oa(Vm),Oa(Lg),Oa(String),Oa(void 0),Oa(String))},t.\\u0275dir=Xt({type:t,viewQuery:function(t,e){if(1&t&&Th(xK,5),2&t){let t;Mh(t=Ph())&&(e._inputElement=t.first)}},inputs:{id:\"id\",checked:\"checked\",value:\"value\",labelPosition:\"labelPosition\",disabled:\"disabled\",required:\"required\",color:\"color\",name:\"name\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"]},outputs:{change:\"change\"},features:[Uo]}),t})(),FK=(()=>{class t extends LK{constructor(t,e,i,n,s,r,o,a){super(t,e,i,n,s,r,o,a)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(IK,8),Oa(ic),Oa(Mc),Oa(Vm),Oa(Lg),Oa(wb,8),Oa(kK,8),Yi(\"tabindex\"))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-radio-button\"]],hostAttrs:[1,\"mat-radio-button\"],hostVars:17,hostBindings:function(t,e){1&t&&Ga(\"focus\",function(){return e._inputElement.nativeElement.focus()}),2&t&&(ia(\"tabindex\",null)(\"id\",e.id)(\"aria-label\",null)(\"aria-labelledby\",null)(\"aria-describedby\",null),hl(\"mat-radio-checked\",e.checked)(\"mat-radio-disabled\",e.disabled)(\"_mat-animation-noopable\",e._noopAnimations)(\"mat-primary\",\"primary\"===e.color)(\"mat-accent\",\"accent\"===e.color)(\"mat-warn\",\"warn\"===e.color))},inputs:{disableRipple:\"disableRipple\",tabIndex:\"tabIndex\"},exportAs:[\"matRadioButton\"],features:[Uo],ngContentSelectors:CK,decls:13,vars:20,consts:[[1,\"mat-radio-label\"],[\"label\",\"\"],[1,\"mat-radio-container\"],[1,\"mat-radio-outer-circle\"],[1,\"mat-radio-inner-circle\"],[\"type\",\"radio\",1,\"mat-radio-input\",\"cdk-visually-hidden\",3,\"id\",\"checked\",\"disabled\",\"tabIndex\",\"required\",\"change\",\"click\"],[\"input\",\"\"],[\"mat-ripple\",\"\",1,\"mat-radio-ripple\",\"mat-focus-indicator\",3,\"matRippleTrigger\",\"matRippleDisabled\",\"matRippleCentered\",\"matRippleRadius\",\"matRippleAnimation\"],[1,\"mat-ripple-element\",\"mat-radio-persistent-ripple\"],[1,\"mat-radio-label-content\"],[2,\"display\",\"none\"]],template:function(t,e){if(1&t&&(Qa(),La(0,\"label\",0,1),La(2,\"span\",2),Na(3,\"span\",3),Na(4,\"span\",4),La(5,\"input\",5,6),Ga(\"change\",function(t){return e._onInputInteraction(t)})(\"click\",function(t){return e._onInputClick(t)}),Fa(),La(7,\"span\",7),Na(8,\"span\",8),Fa(),Fa(),La(9,\"span\",9),La(10,\"span\",10),xl(11,\"\\xa0\"),Fa(),Ja(12),Fa(),Fa()),2&t){const t=aa(1);ia(\"for\",e.inputId),Cr(5),Ra(\"id\",e.inputId)(\"checked\",e.checked)(\"disabled\",e.disabled)(\"tabIndex\",e.tabIndex)(\"required\",e.required),ia(\"name\",e.name)(\"value\",e.value)(\"aria-label\",e.ariaLabel)(\"aria-labelledby\",e.ariaLabelledby)(\"aria-describedby\",e.ariaDescribedby),Cr(2),Ra(\"matRippleTrigger\",t)(\"matRippleDisabled\",e._isRippleDisabled())(\"matRippleCentered\",!0)(\"matRippleRadius\",20)(\"matRippleAnimation\",ih(18,SK,e._noopAnimations?0:150)),Cr(2),hl(\"mat-radio-label-before\",\"before\"==e.labelPosition)}},directives:[py],styles:[\".mat-radio-button{display:inline-block;-webkit-tap-highlight-color:transparent;outline:0}.mat-radio-label{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;display:inline-flex;align-items:center;white-space:nowrap;vertical-align:middle;width:100%}.mat-radio-container{box-sizing:border-box;display:inline-block;position:relative;width:20px;height:20px;flex-shrink:0}.mat-radio-outer-circle{box-sizing:border-box;display:block;height:20px;left:0;position:absolute;top:0;transition:border-color ease 280ms;width:20px;border-width:2px;border-style:solid;border-radius:50%}._mat-animation-noopable .mat-radio-outer-circle{transition:none}.mat-radio-inner-circle{border-radius:50%;box-sizing:border-box;display:block;height:20px;left:0;position:absolute;top:0;opacity:0;transition:transform ease 280ms,background-color ease 280ms,opacity linear 1ms 280ms;width:20px;transform:scale(0.001);-webkit-print-color-adjust:exact;color-adjust:exact}.mat-radio-checked .mat-radio-inner-circle{transform:scale(0.5);opacity:1;transition:transform ease 280ms,background-color ease 280ms}.cdk-high-contrast-active .mat-radio-checked .mat-radio-inner-circle{border:solid 10px}._mat-animation-noopable .mat-radio-inner-circle{transition:none}.mat-radio-label-content{-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto;display:inline-block;order:0;line-height:inherit;padding-left:8px;padding-right:0}[dir=rtl] .mat-radio-label-content{padding-right:8px;padding-left:0}.mat-radio-label-content.mat-radio-label-before{order:-1;padding-left:0;padding-right:8px}[dir=rtl] .mat-radio-label-content.mat-radio-label-before{padding-right:0;padding-left:8px}.mat-radio-disabled,.mat-radio-disabled .mat-radio-label{cursor:default}.mat-radio-button .mat-radio-ripple{position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-radio-button .mat-radio-ripple .mat-ripple-element:not(.mat-radio-persistent-ripple){opacity:.16}.mat-radio-persistent-ripple{width:100%;height:100%;transform:none;top:0;left:0}.mat-radio-container:hover .mat-radio-persistent-ripple{opacity:.04}.mat-radio-button:not(.mat-radio-disabled).cdk-keyboard-focused .mat-radio-persistent-ripple,.mat-radio-button:not(.mat-radio-disabled).cdk-program-focused .mat-radio-persistent-ripple{opacity:.12}.mat-radio-persistent-ripple,.mat-radio-disabled .mat-radio-container:hover .mat-radio-persistent-ripple{opacity:0}@media(hover: none){.mat-radio-container:hover .mat-radio-persistent-ripple{display:none}}.mat-radio-input{bottom:0;left:50%}.cdk-high-contrast-active .mat-radio-button:not(.mat-radio-disabled).cdk-keyboard-focused .mat-radio-ripple,.cdk-high-contrast-active .mat-radio-button:not(.mat-radio-disabled).cdk-program-focused .mat-radio-ripple{outline:solid 3px}.cdk-high-contrast-active .mat-radio-disabled{opacity:.5}\\n\"],encapsulation:2,changeDetection:0}),t})(),NK=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[fy,Fb],Fb]}),t})();const BK=[\"class\",\"page\"];function zK(t,e){if(1&t&&(La(0,\"div\"),xl(1),La(2,\"button\",11),xl(3,\"Terminer\"),Fa(),Fa()),2&t){const t=Ka();Cr(1),kl(\" Maintenance active \",t.maintenance.message,\" - \",t.maintenance.type,\" \"),Cr(1),Ra(\"app-async-action\",t.removeMaintenance)}}function VK(t,e){1&t&&(La(0,\"div\"),xl(1,\" Aucune maintenance active\\n\"),Fa())}function $K(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"Le message est obligatoire\"),Fa())}let UK=(()=>{class t{constructor(t,e,i,n){this.formBuilder=t,this.title=e,this.workerService=i,this.authenticationService=n,this.AppMaintenanceType=wK,this.setMaintenance=()=>Hp(this,void 0,void 0,function*(){this.maintenanceForm.valid&&(yield this.workerService.application.enableMaintenanceMode({message:this.maintenanceForm.controls.message.value,type:this.maintenanceForm.controls.type.value}),yield this.workerService.application.refreshHealthState())}),this.removeMaintenance=()=>Hp(this,void 0,void 0,function*(){yield this.workerService.application.disableMaintenanceMode(),yield this.workerService.application.refreshHealthState()})}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.title.setTitle(\"Configuration - ANAIS\"),this.maintenanceForm=this.formBuilder.group({message:[\"\",[Xy.required]],type:[wK.Planned,[Xy.required]]}),this.workerService.applicationHealth$.subscribe(t=>{this.maintenance=null==t?void 0:t.maintenance})})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Lx),Oa(jp),Oa(sH),Oa(rH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-maintenance\",8,\"page\"]],attrs:BK,decls:22,vars:8,consts:[[1,\"mat-h1\"],[4,\"ngIf\"],[1,\"mat-h2\",\"mt-3\"],[3,\"formGroup\"],[1,\"d-block\"],[\"matInput\",\"\",\"placeholder\",\"...\",\"formControlName\",\"message\",\"required\",\"\"],[1,\"d-flex\"],[1,\"mr-2\"],[\"formControlName\",\"type\"],[\"color\",\"primary\",3,\"value\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",1,\"mt-2\",3,\"app-async-action\",\"disabled\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",3,\"app-async-action\"]],template:function(t,e){1&t&&(La(0,\"h1\",0),xl(1,\"Maintenance\"),Fa(),oa(2,zK,4,3,\"div\",1),oa(3,VK,2,0,\"div\",1),La(4,\"h2\",2),xl(5,\"D\\xe9finir un message de maintenance\"),Fa(),La(6,\"form\",3),La(7,\"mat-form-field\",4),La(8,\"mat-label\"),xl(9,\"Message\"),Fa(),Na(10,\"input\",5),oa(11,$K,2,0,\"mat-error\",1),Fa(),La(12,\"div\",6),La(13,\"label\",7),xl(14,\"Type :\"),Fa(),La(15,\"mat-radio-group\",8),La(16,\"mat-radio-button\",9),xl(17,\"Planifi\\xe9e (message informatif seulement)\"),Fa(),La(18,\"mat-radio-button\",9),xl(19,\"En cours (d\\xe9connecte l'API de la base de donn\\xe9es)\"),Fa(),Fa(),Fa(),La(20,\"button\",10),xl(21,\"D\\xe9finir\"),Fa(),Fa()),2&t&&(Cr(2),Ra(\"ngIf\",e.maintenance),Cr(1),Ra(\"ngIf\",!e.maintenance),Cr(3),Ra(\"formGroup\",e.maintenanceForm),Cr(5),Ra(\"ngIf\",e.maintenanceForm.get(\"message\").hasError(\"required\")),Cr(5),Ra(\"value\",e.AppMaintenanceType.Planned),Cr(2),Ra(\"value\",e.AppMaintenanceType.InProgress),Cr(2),Ra(\"app-async-action\",e.setMaintenance)(\"disabled\",!e.maintenanceForm.valid))},directives:[Vd,sx,Cw,dx,AS,aS,ES,Gy,Sw,_x,Ex,OK,FK,Ly,Jq,eS],styles:[\".mat-radio-button[_ngcontent-%COMP%]{display:block;margin-bottom:.5em}\"]}),t})();const jK=[[[\"caption\"]],[[\"colgroup\"],[\"col\"]]],HK=[\"caption\",\"colgroup, col\"];function GK(t){return class extends t{constructor(...t){super(...t),this._sticky=!1,this._hasStickyChanged=!1}get sticky(){return this._sticky}set sticky(t){const e=this._sticky;this._sticky=Lf(t),this._hasStickyChanged=e!==this._sticky}hasStickyChanged(){const t=this._hasStickyChanged;return this._hasStickyChanged=!1,t}resetStickyChanged(){this._hasStickyChanged=!1}}}const WK=new Ji(\"CDK_TABLE\");let qK=(()=>{class t{constructor(t){this.template=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkCellDef\",\"\"]]}),t})(),YK=(()=>{class t{constructor(t){this.template=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkHeaderCellDef\",\"\"]]}),t})(),ZK=(()=>{class t{constructor(t){this.template=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkFooterCellDef\",\"\"]]}),t})();class KK{}const XK=GK(KK);let QK=(()=>{class t extends XK{constructor(t){super(),this._table=t,this._stickyEnd=!1}get name(){return this._name}set name(t){this._setNameInput(t)}get stickyEnd(){return this._stickyEnd}set stickyEnd(t){const e=this._stickyEnd;this._stickyEnd=Lf(t),this._hasStickyChanged=e!==this._stickyEnd}_updateColumnCssClassName(){this._columnCssClassName=[`cdk-column-${this.cssClassFriendlyName}`]}_setNameInput(t){t&&(this._name=t,this.cssClassFriendlyName=t.replace(/[^a-z0-9_-]/gi,\"-\"),this._updateColumnCssClassName())}}return t.\\u0275fac=function(e){return new(e||t)(Oa(WK,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkColumnDef\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,qK,5),Ih(i,YK,5),Ih(i,ZK,5)),2&t){let t;Mh(t=Ph())&&(e.cell=t.first),Mh(t=Ph())&&(e.headerCell=t.first),Mh(t=Ph())&&(e.footerCell=t.first)}},inputs:{sticky:\"sticky\",name:[\"cdkColumnDef\",\"name\"],stickyEnd:\"stickyEnd\"},features:[Yl([{provide:\"MAT_SORT_HEADER_COLUMN_DEF\",useExisting:t}]),Uo]}),t})();class JK{constructor(t,e){const i=e.nativeElement.classList;for(const n of t._columnCssClassName)i.add(n)}}let tX=(()=>{class t extends JK{constructor(t,e){super(t,e)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(QK),Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"cdk-header-cell\"],[\"th\",\"cdk-header-cell\",\"\"]],hostAttrs:[\"role\",\"columnheader\",1,\"cdk-header-cell\"],features:[Uo]}),t})(),eX=(()=>{class t extends JK{constructor(t,e){var i;if(super(t,e),1===(null===(i=t._table)||void 0===i?void 0:i._elementRef.nativeElement.nodeType)){const i=t._table._elementRef.nativeElement.getAttribute(\"role\");e.nativeElement.setAttribute(\"role\",\"grid\"===i||\"treegrid\"===i?\"gridcell\":\"cell\")}}}return t.\\u0275fac=function(e){return new(e||t)(Oa(QK),Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"cdk-cell\"],[\"td\",\"cdk-cell\",\"\"]],hostAttrs:[1,\"cdk-cell\"],features:[Uo]}),t})();class iX{constructor(){this.tasks=[],this.endTasks=[]}}const nX=new Ji(\"_COALESCED_STYLE_SCHEDULER\");let sX=(()=>{class t{constructor(t){this._ngZone=t,this._currentSchedule=null,this._destroyed=new C}schedule(t){this._createScheduleIfNeeded(),this._currentSchedule.tasks.push(t)}scheduleEnd(t){this._createScheduleIfNeeded(),this._currentSchedule.endTasks.push(t)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_createScheduleIfNeeded(){this._currentSchedule||(this._currentSchedule=new iX,this._getScheduleObservable().pipe(Of(this._destroyed)).subscribe(()=>{for(;this._currentSchedule.tasks.length||this._currentSchedule.endTasks.length;){const t=this._currentSchedule;this._currentSchedule=new iX;for(const e of t.tasks)e();for(const e of t.endTasks)e()}this._currentSchedule=null}))}_getScheduleObservable(){return this._ngZone.isStable?B(Promise.resolve(void 0)):this._ngZone.onStable.pipe(xf(1))}}return t.\\u0275fac=function(e){return new(e||t)(Mn(nu))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac}),t})(),rX=(()=>{class t{constructor(t,e){this.template=t,this._differs=e}ngOnChanges(t){if(!this._columnsDiffer){const e=t.columns&&t.columns.currentValue||[];this._columnsDiffer=this._differs.find(e).create(),this._columnsDiffer.diff(e)}}getColumnsDiff(){return this._columnsDiffer.diff(this.columns)}extractCellTemplate(t){return this instanceof lX?t.headerCell.template:this instanceof uX?t.footerCell.template:t.cell.template}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc),Oa(yc))},t.\\u0275dir=Xt({type:t,features:[he]}),t})();class oX extends rX{}const aX=GK(oX);let lX=(()=>{class t extends aX{constructor(t,e,i){super(t,e),this._table=i}ngOnChanges(t){super.ngOnChanges(t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc),Oa(yc),Oa(WK,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkHeaderRowDef\",\"\"]],inputs:{columns:[\"cdkHeaderRowDef\",\"columns\"],sticky:[\"cdkHeaderRowDefSticky\",\"sticky\"]},features:[Uo,he]}),t})();class cX extends rX{}const hX=GK(cX);let uX=(()=>{class t extends hX{constructor(t,e,i){super(t,e),this._table=i}ngOnChanges(t){super.ngOnChanges(t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc),Oa(yc),Oa(WK,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkFooterRowDef\",\"\"]],inputs:{columns:[\"cdkFooterRowDef\",\"columns\"],sticky:[\"cdkFooterRowDefSticky\",\"sticky\"]},features:[Uo,he]}),t})(),dX=(()=>{class t extends rX{constructor(t,e,i){super(t,e),this._table=i}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc),Oa(yc),Oa(WK,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkRowDef\",\"\"]],inputs:{columns:[\"cdkRowDefColumns\",\"columns\"],when:[\"cdkRowDefWhen\",\"when\"]},features:[Uo]}),t})(),pX=(()=>{class t{constructor(e){this._viewContainer=e,t.mostRecentCellOutlet=this}ngOnDestroy(){t.mostRecentCellOutlet===this&&(t.mostRecentCellOutlet=null)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Vc))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkCellOutlet\",\"\"]]}),t.mostRecentCellOutlet=null,t})(),fX=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"cdk-header-row\"],[\"tr\",\"cdk-header-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"cdk-header-row\"],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Va(0,0)},directives:[pX],encapsulation:2}),t})(),mX=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"cdk-row\"],[\"tr\",\"cdk-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"cdk-row\"],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Va(0,0)},directives:[pX],encapsulation:2}),t})(),gX=(()=>{class t{constructor(t){this.templateRef=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc))},t.\\u0275dir=Xt({type:t,selectors:[[\"ng-template\",\"cdkNoDataRow\",\"\"]]}),t})();const AX=[\"top\",\"bottom\",\"left\",\"right\"];class vX{constructor(t,e,i,n,s=!0,r=!0,o){this._isNativeHtmlTable=t,this._stickCellCss=e,this.direction=i,this._coalescedStyleScheduler=n,this._isBrowser=s,this._needsPositionStickyOnElement=r,this._positionListener=o,this._cachedCellWidths=[],this._borderCellCss={top:`${e}-border-elem-top`,bottom:`${e}-border-elem-bottom`,left:`${e}-border-elem-left`,right:`${e}-border-elem-right`}}clearStickyPositioning(t,e){const i=[];for(const n of t)if(n.nodeType===n.ELEMENT_NODE){i.push(n);for(let t=0;t<n.children.length;t++)i.push(n.children[t])}this._coalescedStyleScheduler.schedule(()=>{for(const t of i)this._removeStickyStyle(t,e)})}updateStickyColumns(t,e,i,n=!0){if(!t.length||!this._isBrowser||!e.some(t=>t)&&!i.some(t=>t))return void(this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:[]}),this._positionListener.stickyEndColumnsUpdated({sizes:[]})));const s=t[0],r=s.children.length,o=this._getCellWidths(s,n),a=this._getStickyStartColumnPositions(o,e),l=this._getStickyEndColumnPositions(o,i),c=e.lastIndexOf(!0),h=i.indexOf(!0);this._coalescedStyleScheduler.schedule(()=>{const n=\"rtl\"===this.direction,s=n?\"right\":\"left\",u=n?\"left\":\"right\";for(const o of t)for(let t=0;t<r;t++){const n=o.children[t];e[t]&&this._addStickyStyle(n,s,a[t],t===c),i[t]&&this._addStickyStyle(n,u,l[t],t===h)}this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:-1===c?[]:o.slice(0,c+1).map((t,i)=>e[i]?t:null)}),this._positionListener.stickyEndColumnsUpdated({sizes:-1===h?[]:o.slice(h).map((t,e)=>i[e+h]?t:null).reverse()}))})}stickRows(t,e,i){if(!this._isBrowser)return;const n=\"bottom\"===i?t.slice().reverse():t,s=\"bottom\"===i?e.slice().reverse():e,r=[],o=[],a=[];for(let c=0,h=0;c<n.length;c++){if(!s[c])continue;r[c]=h;const t=n[c];a[c]=this._isNativeHtmlTable?Array.from(t.children):[t];const e=t.getBoundingClientRect().height;h+=e,o[c]=e}const l=s.lastIndexOf(!0);this._coalescedStyleScheduler.schedule(()=>{var t,e;for(let o=0;o<n.length;o++){if(!s[o])continue;const t=r[o],e=o===l;for(const n of a[o])this._addStickyStyle(n,i,t,e)}\"top\"===i?null===(t=this._positionListener)||void 0===t||t.stickyHeaderRowsUpdated({sizes:o,offsets:r,elements:a}):null===(e=this._positionListener)||void 0===e||e.stickyFooterRowsUpdated({sizes:o,offsets:r,elements:a})})}updateStickyFooterContainer(t,e){if(!this._isNativeHtmlTable)return;const i=t.querySelector(\"tfoot\");this._coalescedStyleScheduler.schedule(()=>{e.some(t=>!t)?this._removeStickyStyle(i,[\"bottom\"]):this._addStickyStyle(i,\"bottom\",0,!1)})}_removeStickyStyle(t,e){for(const i of e)t.style[i]=\"\",t.classList.remove(this._borderCellCss[i]);AX.some(i=>-1===e.indexOf(i)&&t.style[i])?t.style.zIndex=this._getCalculatedZIndex(t):(t.style.zIndex=\"\",this._needsPositionStickyOnElement&&(t.style.position=\"\"),t.classList.remove(this._stickCellCss))}_addStickyStyle(t,e,i,n){t.classList.add(this._stickCellCss),n&&t.classList.add(this._borderCellCss[e]),t.style[e]=`${i}px`,t.style.zIndex=this._getCalculatedZIndex(t),this._needsPositionStickyOnElement&&(t.style.cssText+=\"position: -webkit-sticky; position: sticky; \")}_getCalculatedZIndex(t){const e={top:100,bottom:10,left:1,right:1};let i=0;for(const n of AX)t.style[n]&&(i+=e[n]);return i?`${i}`:\"\"}_getCellWidths(t,e=!0){if(!e&&this._cachedCellWidths.length)return this._cachedCellWidths;const i=[],n=t.children;for(let s=0;s<n.length;s++)i.push(n[s].getBoundingClientRect().width);return this._cachedCellWidths=i,i}_getStickyStartColumnPositions(t,e){const i=[];let n=0;for(let s=0;s<t.length;s++)e[s]&&(i[s]=n,n+=t[s]);return i}_getStickyEndColumnPositions(t,e){const i=[];let n=0;for(let s=t.length;s>0;s--)e[s]&&(i[s]=n,n+=t[s]);return i}}const _X=new Ji(\"CDK_SPL\");let bX=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Vc),Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"rowOutlet\",\"\"]]}),t})(),yX=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Vc),Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"headerRowOutlet\",\"\"]]}),t})(),wX=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Vc),Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"footerRowOutlet\",\"\"]]}),t})(),xX=(()=>{class t{constructor(t,e){this.viewContainer=t,this.elementRef=e}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Vc),Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"noDataRowOutlet\",\"\"]]}),t})(),SX=(()=>{class t{constructor(t,e,i,n,s,r,o,a,l,c,h){this._differs=t,this._changeDetectorRef=e,this._elementRef=i,this._dir=s,this._platform=o,this._viewRepeater=a,this._coalescedStyleScheduler=l,this._viewportRuler=c,this._stickyPositioningListener=h,this._onDestroy=new C,this._columnDefsByName=new Map,this._customColumnDefs=new Set,this._customRowDefs=new Set,this._customHeaderRowDefs=new Set,this._customFooterRowDefs=new Set,this._headerRowDefChanged=!0,this._footerRowDefChanged=!0,this._stickyColumnStylesNeedReset=!0,this._forceRecalculateCellWidths=!0,this._cachedRenderRowsMap=new Map,this.stickyCssClass=\"cdk-table-sticky\",this.needsPositionStickyOnElement=!0,this._isShowingNoDataRow=!1,this._multiTemplateDataRows=!1,this._fixedLayout=!1,this.contentChanged=new gh,this.viewChange=new Jp({start:0,end:Number.MAX_VALUE}),n||this._elementRef.nativeElement.setAttribute(\"role\",\"table\"),this._document=r,this._isNativeHtmlTable=\"TABLE\"===this._elementRef.nativeElement.nodeName}get trackBy(){return this._trackByFn}set trackBy(t){this._trackByFn=t}get dataSource(){return this._dataSource}set dataSource(t){this._dataSource!==t&&this._switchDataSource(t)}get multiTemplateDataRows(){return this._multiTemplateDataRows}set multiTemplateDataRows(t){this._multiTemplateDataRows=Lf(t),this._rowOutlet&&this._rowOutlet.viewContainer.length&&(this._forceRenderDataRows(),this.updateStickyColumnStyles())}get fixedLayout(){return this._fixedLayout}set fixedLayout(t){this._fixedLayout=Lf(t),this._forceRecalculateCellWidths=!0,this._stickyColumnStylesNeedReset=!0}ngOnInit(){this._setupStickyStyler(),this._isNativeHtmlTable&&this._applyNativeTableSections(),this._dataDiffer=this._differs.find([]).create((t,e)=>this.trackBy?this.trackBy(e.dataIndex,e.data):e),this._viewportRuler.change().pipe(Of(this._onDestroy)).subscribe(()=>{this._forceRecalculateCellWidths=!0})}ngAfterContentChecked(){this._cacheRowDefs(),this._cacheColumnDefs();const t=this._renderUpdatedColumns()||this._headerRowDefChanged||this._footerRowDefChanged;this._stickyColumnStylesNeedReset=this._stickyColumnStylesNeedReset||t,this._forceRecalculateCellWidths=t,this._headerRowDefChanged&&(this._forceRenderHeaderRows(),this._headerRowDefChanged=!1),this._footerRowDefChanged&&(this._forceRenderFooterRows(),this._footerRowDefChanged=!1),this.dataSource&&this._rowDefs.length>0&&!this._renderChangeSubscription?this._observeRenderChanges():this._stickyColumnStylesNeedReset&&this.updateStickyColumnStyles(),this._checkStickyStates()}ngOnDestroy(){this._rowOutlet.viewContainer.clear(),this._noDataRowOutlet.viewContainer.clear(),this._headerRowOutlet.viewContainer.clear(),this._footerRowOutlet.viewContainer.clear(),this._cachedRenderRowsMap.clear(),this._onDestroy.next(),this._onDestroy.complete(),Ig(this.dataSource)&&this.dataSource.disconnect(this)}renderRows(){this._renderRows=this._getAllRenderRows();const t=this._dataDiffer.diff(this._renderRows);if(!t)return this._updateNoDataRow(),void this.contentChanged.next();const e=this._rowOutlet.viewContainer;this._viewRepeater.applyChanges(t,e,(t,e,i)=>this._getEmbeddedViewArgs(t.item,i),t=>t.item.data,t=>{1===t.operation&&t.context&&this._renderCellTemplateForItem(t.record.item.rowDef,t.context)}),this._updateRowIndexContext(),t.forEachIdentityChange(t=>{e.get(t.currentIndex).context.$implicit=t.item.data}),this._updateNoDataRow(),this.updateStickyColumnStyles(),this.contentChanged.next()}addColumnDef(t){this._customColumnDefs.add(t)}removeColumnDef(t){this._customColumnDefs.delete(t)}addRowDef(t){this._customRowDefs.add(t)}removeRowDef(t){this._customRowDefs.delete(t)}addHeaderRowDef(t){this._customHeaderRowDefs.add(t),this._headerRowDefChanged=!0}removeHeaderRowDef(t){this._customHeaderRowDefs.delete(t),this._headerRowDefChanged=!0}addFooterRowDef(t){this._customFooterRowDefs.add(t),this._footerRowDefChanged=!0}removeFooterRowDef(t){this._customFooterRowDefs.delete(t),this._footerRowDefChanged=!0}setNoDataRow(t){this._customNoDataRow=t}updateStickyHeaderRowStyles(){const t=this._getRenderedRows(this._headerRowOutlet),e=this._elementRef.nativeElement.querySelector(\"thead\");e&&(e.style.display=t.length?\"\":\"none\");const i=this._headerRowDefs.map(t=>t.sticky);this._stickyStyler.clearStickyPositioning(t,[\"top\"]),this._stickyStyler.stickRows(t,i,\"top\"),this._headerRowDefs.forEach(t=>t.resetStickyChanged())}updateStickyFooterRowStyles(){const t=this._getRenderedRows(this._footerRowOutlet),e=this._elementRef.nativeElement.querySelector(\"tfoot\");e&&(e.style.display=t.length?\"\":\"none\");const i=this._footerRowDefs.map(t=>t.sticky);this._stickyStyler.clearStickyPositioning(t,[\"bottom\"]),this._stickyStyler.stickRows(t,i,\"bottom\"),this._stickyStyler.updateStickyFooterContainer(this._elementRef.nativeElement,i),this._footerRowDefs.forEach(t=>t.resetStickyChanged())}updateStickyColumnStyles(){const t=this._getRenderedRows(this._headerRowOutlet),e=this._getRenderedRows(this._rowOutlet),i=this._getRenderedRows(this._footerRowOutlet);(this._isNativeHtmlTable&&!this._fixedLayout||this._stickyColumnStylesNeedReset)&&(this._stickyStyler.clearStickyPositioning([...t,...e,...i],[\"left\",\"right\"]),this._stickyColumnStylesNeedReset=!1),t.forEach((t,e)=>{this._addStickyColumnStyles([t],this._headerRowDefs[e])}),this._rowDefs.forEach(t=>{const i=[];for(let n=0;n<e.length;n++)this._renderRows[n].rowDef===t&&i.push(e[n]);this._addStickyColumnStyles(i,t)}),i.forEach((t,e)=>{this._addStickyColumnStyles([t],this._footerRowDefs[e])}),Array.from(this._columnDefsByName.values()).forEach(t=>t.resetStickyChanged())}_getAllRenderRows(){const t=[],e=this._cachedRenderRowsMap;this._cachedRenderRowsMap=new Map;for(let i=0;i<this._data.length;i++){let n=this._data[i];const s=this._getRenderRowsForData(n,i,e.get(n));this._cachedRenderRowsMap.has(n)||this._cachedRenderRowsMap.set(n,new WeakMap);for(let e=0;e<s.length;e++){let i=s[e];const n=this._cachedRenderRowsMap.get(i.data);n.has(i.rowDef)?n.get(i.rowDef).push(i):n.set(i.rowDef,[i]),t.push(i)}}return t}_getRenderRowsForData(t,e,i){return this._getRowDefs(t,e).map(n=>{const s=i&&i.has(n)?i.get(n):[];if(s.length){const t=s.shift();return t.dataIndex=e,t}return{data:t,rowDef:n,dataIndex:e}})}_cacheColumnDefs(){this._columnDefsByName.clear(),CX(this._getOwnDefs(this._contentColumnDefs),this._customColumnDefs).forEach(t=>{this._columnDefsByName.has(t.name),this._columnDefsByName.set(t.name,t)})}_cacheRowDefs(){this._headerRowDefs=CX(this._getOwnDefs(this._contentHeaderRowDefs),this._customHeaderRowDefs),this._footerRowDefs=CX(this._getOwnDefs(this._contentFooterRowDefs),this._customFooterRowDefs),this._rowDefs=CX(this._getOwnDefs(this._contentRowDefs),this._customRowDefs);const t=this._rowDefs.filter(t=>!t.when);this._defaultRowDef=t[0]}_renderUpdatedColumns(){const t=(t,e)=>t||!!e.getColumnsDiff(),e=this._rowDefs.reduce(t,!1);e&&this._forceRenderDataRows();const i=this._headerRowDefs.reduce(t,!1);i&&this._forceRenderHeaderRows();const n=this._footerRowDefs.reduce(t,!1);return n&&this._forceRenderFooterRows(),e||i||n}_switchDataSource(t){this._data=[],Ig(this.dataSource)&&this.dataSource.disconnect(this),this._renderChangeSubscription&&(this._renderChangeSubscription.unsubscribe(),this._renderChangeSubscription=null),t||(this._dataDiffer&&this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear()),this._dataSource=t}_observeRenderChanges(){if(!this.dataSource)return;let t;Ig(this.dataSource)?t=this.dataSource.connect(this):ig(this.dataSource)?t=this.dataSource:Array.isArray(this.dataSource)&&(t=tf(this.dataSource)),this._renderChangeSubscription=t.pipe(Of(this._onDestroy)).subscribe(t=>{this._data=t||[],this.renderRows()})}_forceRenderHeaderRows(){this._headerRowOutlet.viewContainer.length>0&&this._headerRowOutlet.viewContainer.clear(),this._headerRowDefs.forEach((t,e)=>this._renderRow(this._headerRowOutlet,t,e)),this.updateStickyHeaderRowStyles()}_forceRenderFooterRows(){this._footerRowOutlet.viewContainer.length>0&&this._footerRowOutlet.viewContainer.clear(),this._footerRowDefs.forEach((t,e)=>this._renderRow(this._footerRowOutlet,t,e)),this.updateStickyFooterRowStyles()}_addStickyColumnStyles(t,e){const i=Array.from(e.columns||[]).map(t=>this._columnDefsByName.get(t)),n=i.map(t=>t.sticky),s=i.map(t=>t.stickyEnd);this._stickyStyler.updateStickyColumns(t,n,s,!this._fixedLayout||this._forceRecalculateCellWidths)}_getRenderedRows(t){const e=[];for(let i=0;i<t.viewContainer.length;i++){const n=t.viewContainer.get(i);e.push(n.rootNodes[0])}return e}_getRowDefs(t,e){if(1==this._rowDefs.length)return[this._rowDefs[0]];let i=[];if(this.multiTemplateDataRows)i=this._rowDefs.filter(i=>!i.when||i.when(e,t));else{let n=this._rowDefs.find(i=>i.when&&i.when(e,t))||this._defaultRowDef;n&&i.push(n)}return i}_getEmbeddedViewArgs(t,e){return{templateRef:t.rowDef.template,context:{$implicit:t.data},index:e}}_renderRow(t,e,i,n={}){const s=t.viewContainer.createEmbeddedView(e.template,n,i);return this._renderCellTemplateForItem(e,n),s}_renderCellTemplateForItem(t,e){for(let i of this._getCellTemplates(t))pX.mostRecentCellOutlet&&pX.mostRecentCellOutlet._viewContainer.createEmbeddedView(i,e);this._changeDetectorRef.markForCheck()}_updateRowIndexContext(){const t=this._rowOutlet.viewContainer;for(let e=0,i=t.length;e<i;e++){const n=t.get(e).context;n.count=i,n.first=0===e,n.last=e===i-1,n.even=e%2==0,n.odd=!n.even,this.multiTemplateDataRows?(n.dataIndex=this._renderRows[e].dataIndex,n.renderIndex=e):n.index=this._renderRows[e].dataIndex}}_getCellTemplates(t){return t&&t.columns?Array.from(t.columns,e=>{const i=this._columnDefsByName.get(e);return t.extractCellTemplate(i)}):[]}_applyNativeTableSections(){const t=this._document.createDocumentFragment(),e=[{tag:\"thead\",outlets:[this._headerRowOutlet]},{tag:\"tbody\",outlets:[this._rowOutlet,this._noDataRowOutlet]},{tag:\"tfoot\",outlets:[this._footerRowOutlet]}];for(const i of e){const e=this._document.createElement(i.tag);e.setAttribute(\"role\",\"rowgroup\");for(const t of i.outlets)e.appendChild(t.elementRef.nativeElement);t.appendChild(e)}this._elementRef.nativeElement.appendChild(t)}_forceRenderDataRows(){this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear(),this.renderRows()}_checkStickyStates(){const t=(t,e)=>t||e.hasStickyChanged();this._headerRowDefs.reduce(t,!1)&&this.updateStickyHeaderRowStyles(),this._footerRowDefs.reduce(t,!1)&&this.updateStickyFooterRowStyles(),Array.from(this._columnDefsByName.values()).reduce(t,!1)&&(this._stickyColumnStylesNeedReset=!0,this.updateStickyColumnStyles())}_setupStickyStyler(){this._stickyStyler=new vX(this._isNativeHtmlTable,this.stickyCssClass,this._dir?this._dir.value:\"ltr\",this._coalescedStyleScheduler,this._platform.isBrowser,this.needsPositionStickyOnElement,this._stickyPositioningListener),(this._dir?this._dir.change:tf()).pipe(Of(this._onDestroy)).subscribe(t=>{this._stickyStyler.direction=t,this.updateStickyColumnStyles()})}_getOwnDefs(t){return t.filter(t=>!t._table||t._table===this)}_updateNoDataRow(){const t=this._customNoDataRow||this._noDataRow;if(t){const e=0===this._rowOutlet.viewContainer.length;if(e!==this._isShowingNoDataRow){const i=this._noDataRowOutlet.viewContainer;e?i.createEmbeddedView(t.templateRef):i.clear(),this._isShowingNoDataRow=e}}}}return t.\\u0275fac=function(e){return new(e||t)(Oa(yc),Oa(Mc),Oa(ic),Yi(\"role\"),Oa(Eg,8),Oa(Fu),Oa(Hf),Oa(Fg),Oa(nX),Oa(Gg),Oa(_X,12))},t.\\u0275cmp=Gt({type:t,selectors:[[\"cdk-table\"],[\"table\",\"cdk-table\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,gX,5),Ih(i,QK,5),Ih(i,dX,5),Ih(i,lX,5),Ih(i,uX,5)),2&t){let t;Mh(t=Ph())&&(e._noDataRow=t.first),Mh(t=Ph())&&(e._contentColumnDefs=t),Mh(t=Ph())&&(e._contentRowDefs=t),Mh(t=Ph())&&(e._contentHeaderRowDefs=t),Mh(t=Ph())&&(e._contentFooterRowDefs=t)}},viewQuery:function(t,e){if(1&t&&(Th(bX,7),Th(yX,7),Th(wX,7),Th(xX,7)),2&t){let t;Mh(t=Ph())&&(e._rowOutlet=t.first),Mh(t=Ph())&&(e._headerRowOutlet=t.first),Mh(t=Ph())&&(e._footerRowOutlet=t.first),Mh(t=Ph())&&(e._noDataRowOutlet=t.first)}},hostAttrs:[1,\"cdk-table\"],hostVars:2,hostBindings:function(t,e){2&t&&hl(\"cdk-table-fixed-layout\",e.fixedLayout)},inputs:{trackBy:\"trackBy\",dataSource:\"dataSource\",multiTemplateDataRows:\"multiTemplateDataRows\",fixedLayout:\"fixedLayout\"},outputs:{contentChanged:\"contentChanged\"},exportAs:[\"cdkTable\"],features:[Yl([{provide:WK,useExisting:t},{provide:Fg,useClass:Og},{provide:nX,useClass:sX},{provide:_X,useValue:null}])],ngContentSelectors:HK,decls:6,vars:0,consts:[[\"headerRowOutlet\",\"\"],[\"rowOutlet\",\"\"],[\"noDataRowOutlet\",\"\"],[\"footerRowOutlet\",\"\"]],template:function(t,e){1&t&&(Qa(jK),Ja(0),Ja(1,1),Va(2,0),Va(3,1),Va(4,2),Va(5,3))},directives:[yX,bX,xX,wX],styles:[\".cdk-table-fixed-layout{table-layout:fixed}\\n\"],encapsulation:2}),t})();function CX(t,e){return t.concat(Array.from(e))}let kX=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[Xg]]}),t})();const EX=[[[\"caption\"]],[[\"colgroup\"],[\"col\"]]],MX=[\"caption\",\"colgroup, col\"];let TX=(()=>{class t extends SX{constructor(){super(...arguments),this.stickyCssClass=\"mat-table-sticky\",this.needsPositionStickyOnElement=!1}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-table\"],[\"table\",\"mat-table\",\"\"]],hostAttrs:[1,\"mat-table\"],hostVars:2,hostBindings:function(t,e){2&t&&hl(\"mat-table-fixed-layout\",e.fixedLayout)},exportAs:[\"matTable\"],features:[Yl([{provide:Fg,useClass:Og},{provide:SX,useExisting:t},{provide:WK,useExisting:t},{provide:nX,useClass:sX},{provide:_X,useValue:null}]),Uo],ngContentSelectors:MX,decls:6,vars:0,consts:[[\"headerRowOutlet\",\"\"],[\"rowOutlet\",\"\"],[\"noDataRowOutlet\",\"\"],[\"footerRowOutlet\",\"\"]],template:function(t,e){1&t&&(Qa(EX),Ja(0),Ja(1,1),Va(2,0),Va(3,1),Va(4,2),Va(5,3))},directives:[yX,bX,xX,wX],styles:['mat-table{display:block}mat-header-row{min-height:56px}mat-row,mat-footer-row{min-height:48px}mat-row,mat-header-row,mat-footer-row{display:flex;border-width:0;border-bottom-width:1px;border-style:solid;align-items:center;box-sizing:border-box}mat-row::after,mat-header-row::after,mat-footer-row::after{display:inline-block;min-height:inherit;content:\"\"}mat-cell:first-of-type,mat-header-cell:first-of-type,mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] mat-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}mat-cell:last-of-type,mat-header-cell:last-of-type,mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] mat-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}mat-cell,mat-header-cell,mat-footer-cell{flex:1;display:flex;align-items:center;overflow:hidden;word-wrap:break-word;min-height:inherit}table.mat-table{border-spacing:0}tr.mat-header-row{height:56px}tr.mat-row,tr.mat-footer-row{height:48px}th.mat-header-cell{text-align:left}[dir=rtl] th.mat-header-cell{text-align:right}th.mat-header-cell,td.mat-cell,td.mat-footer-cell{padding:0;border-bottom-width:1px;border-bottom-style:solid}th.mat-header-cell:first-of-type,td.mat-cell:first-of-type,td.mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] th.mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] td.mat-cell:first-of-type:not(:only-of-type),[dir=rtl] td.mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}th.mat-header-cell:last-of-type,td.mat-cell:last-of-type,td.mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] th.mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] td.mat-cell:last-of-type:not(:only-of-type),[dir=rtl] td.mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}.mat-table-sticky{position:-webkit-sticky !important;position:sticky !important}.mat-table-fixed-layout{table-layout:fixed}\\n'],encapsulation:2}),t})(),IX=(()=>{class t extends qK{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matCellDef\",\"\"]],features:[Yl([{provide:qK,useExisting:t}]),Uo]}),t})(),PX=(()=>{class t extends YK{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matHeaderCellDef\",\"\"]],features:[Yl([{provide:YK,useExisting:t}]),Uo]}),t})(),OX=(()=>{class t extends QK{get name(){return this._name}set name(t){this._setNameInput(t)}_updateColumnCssClassName(){super._updateColumnCssClassName(),this._columnCssClassName.push(`mat-column-${this.cssClassFriendlyName}`)}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matColumnDef\",\"\"]],inputs:{sticky:\"sticky\",name:[\"matColumnDef\",\"name\"]},features:[Yl([{provide:QK,useExisting:t},{provide:\"MAT_SORT_HEADER_COLUMN_DEF\",useExisting:t}]),Uo]}),t})(),RX=(()=>{class t extends tX{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"mat-header-cell\"],[\"th\",\"mat-header-cell\",\"\"]],hostAttrs:[\"role\",\"columnheader\",1,\"mat-header-cell\"],features:[Uo]}),t})(),DX=(()=>{class t extends eX{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"mat-cell\"],[\"td\",\"mat-cell\",\"\"]],hostAttrs:[\"role\",\"gridcell\",1,\"mat-cell\"],features:[Uo]}),t})(),LX=(()=>{class t extends lX{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matHeaderRowDef\",\"\"]],inputs:{columns:[\"matHeaderRowDef\",\"columns\"],sticky:[\"matHeaderRowDefSticky\",\"sticky\"]},features:[Yl([{provide:lX,useExisting:t}]),Uo]}),t})(),FX=(()=>{class t extends dX{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matRowDef\",\"\"]],inputs:{columns:[\"matRowDefColumns\",\"columns\"],when:[\"matRowDefWhen\",\"when\"]},features:[Yl([{provide:dX,useExisting:t}]),Uo]}),t})(),NX=(()=>{class t extends fX{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-header-row\"],[\"tr\",\"mat-header-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"mat-header-row\"],exportAs:[\"matHeaderRow\"],features:[Yl([{provide:fX,useExisting:t}]),Uo],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Va(0,0)},directives:[pX],encapsulation:2}),t})(),BX=(()=>{class t extends mX{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-row\"],[\"tr\",\"mat-row\",\"\"]],hostAttrs:[\"role\",\"row\",1,\"mat-row\"],exportAs:[\"matRow\"],features:[Yl([{provide:mX,useExisting:t}]),Uo],decls:1,vars:0,consts:[[\"cdkCellOutlet\",\"\"]],template:function(t,e){1&t&&Va(0,0)},directives:[pX],encapsulation:2}),t})(),zX=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[kX,Fb],Fb]}),t})();class VX extends Tg{constructor(t=[]){super(),this._renderData=new Jp([]),this._filter=new Jp(\"\"),this._internalPageChanges=new C,this._renderChangesSubscription=null,this.sortingDataAccessor=(t,e)=>{const i=t[e];if(Nf(i)){const t=Number(i);return t<9007199254740991?t:i}return i},this.sortData=(t,e)=>{const i=e.active,n=e.direction;return i&&\"\"!=n?t.sort((t,e)=>{let s=this.sortingDataAccessor(t,i),r=this.sortingDataAccessor(e,i);const o=typeof s,a=typeof r;o!==a&&(\"number\"===o&&(s+=\"\"),\"number\"===a&&(r+=\"\"));let l=0;return null!=s&&null!=r?s>r?l=1:s<r&&(l=-1):null!=s?l=1:null!=r&&(l=-1),l*(\"asc\"==n?1:-1)}):t},this.filterPredicate=(t,e)=>{const i=Object.keys(t).reduce((e,i)=>e+t[i]+\"\\u25ec\",\"\").toLowerCase(),n=e.trim().toLowerCase();return-1!=i.indexOf(n)},this._data=new Jp(t),this._updateChangeSubscription()}get data(){return this._data.value}set data(t){this._data.next(t),this._renderChangesSubscription||this._filterData(t)}get filter(){return this._filter.value}set filter(t){this._filter.next(t),this._renderChangesSubscription||this._filterData(this.data)}get sort(){return this._sort}set sort(t){this._sort=t,this._updateChangeSubscription()}get paginator(){return this._paginator}set paginator(t){this._paginator=t,this._updateChangeSubscription()}_updateChangeSubscription(){var t;const e=this._sort?q(this._sort.sortChange,this._sort.initialized):tf(null),i=this._paginator?q(this._paginator.page,this._internalPageChanges,this._paginator.initialized):tf(null),n=JT([this._data,this._filter]).pipe(M(([t])=>this._filterData(t))),s=JT([n,e]).pipe(M(([t])=>this._orderData(t))),r=JT([s,i]).pipe(M(([t])=>this._pageData(t)));null===(t=this._renderChangesSubscription)||void 0===t||t.unsubscribe(),this._renderChangesSubscription=r.subscribe(t=>this._renderData.next(t))}_filterData(t){return this.filteredData=null==this.filter||\"\"===this.filter?t:t.filter(t=>this.filterPredicate(t,this.filter)),this.paginator&&this._updatePaginator(this.filteredData.length),this.filteredData}_orderData(t){return this.sort?this.sortData(t.slice(),this.sort):t}_pageData(t){if(!this.paginator)return t;const e=this.paginator.pageIndex*this.paginator.pageSize;return t.slice(e,e+this.paginator.pageSize)}_updatePaginator(t){Promise.resolve().then(()=>{const e=this.paginator;if(e&&(e.length=t,e.pageIndex>0)){const t=Math.ceil(e.length/e.pageSize)-1||0,i=Math.min(e.pageIndex,t);i!==e.pageIndex&&(e.pageIndex=i,this._internalPageChanges.next())}})}connect(){return this._renderChangesSubscription||this._updateChangeSubscription(),this._renderData}disconnect(){var t;null===(t=this._renderChangesSubscription)||void 0===t||t.unsubscribe(),this._renderChangesSubscription=null}}class $X extends VX{}function UX(t,e){1&t&&(La(0,\"th\",16),xl(1,\"Action\"),Fa())}function jX(t,e){if(1&t&&(La(0,\"td\",17),xl(1),Fa()),2&t){const t=e.$implicit;Cr(1),Sl(t.action)}}function HX(t,e){1&t&&(La(0,\"th\",16),xl(1,\"Invit\\xe9\"),Fa())}function GX(t,e){if(1&t&&(La(0,\"td\",17),xl(1),Fa()),2&t){const t=e.$implicit;Cr(1),Sl(t.guest?\"\\u2713\":\"\")}}function WX(t,e){1&t&&(La(0,\"th\",16),xl(1,\"Contributeur\"),Fa())}function qX(t,e){if(1&t&&(La(0,\"td\",17),xl(1),Fa()),2&t){const t=e.$implicit;Cr(1),Sl(t.contributor?\"\\u2713\":\"\")}}function YX(t,e){1&t&&(La(0,\"th\",16),xl(1,\"Propri\\xe9taire\"),Fa())}function ZX(t,e){if(1&t&&(La(0,\"td\",17),xl(1),Fa()),2&t){const t=e.$implicit;Cr(1),Sl(t.owner?\"\\u2713\":\"\")}}function KX(t,e){1&t&&(La(0,\"th\",16),xl(1,\"Administrateur\"),Fa())}function XX(t,e){if(1&t&&(La(0,\"td\",17),xl(1),Fa()),2&t){const t=e.$implicit;Cr(1),Sl(t.admin?\"\\u2713\":\"\")}}function QX(t,e){1&t&&Na(0,\"tr\",18)}function JX(t,e){1&t&&Na(0,\"tr\",19)}const tQ=!0,eQ=!1,iQ=[{guest:tQ,contributor:tQ,owner:tQ,admin:tQ,action:\"Voir la liste des membres\"},{guest:tQ,contributor:tQ,owner:tQ,admin:eQ,action:\"Acc\\xe9der aux donn\\xe9es du groupe*\"},{guest:eQ,contributor:tQ,owner:tQ,admin:eQ,action:\"Modifier/Supprimer les donn\\xe9es du groupe*\"},{guest:eQ,contributor:eQ,owner:tQ,admin:tQ,action:\"Ajouter/Supprimer des membres\"},{guest:eQ,contributor:eQ,owner:tQ,admin:tQ,action:\"Renommer le groupe\"},{guest:eQ,contributor:eQ,owner:eQ,admin:tQ,action:\"Supprimer le groupe\"}];let nQ=(()=>{class t{constructor(){this.displayedColumns=[\"action\",\"guest\",\"contributor\",\"owner\",\"admin\"],this.dataSource=iQ}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-role-permissions-dialog\"]],decls:29,vars:3,consts:[[1,\"d-flex\"],[1,\"dialog-title\",\"u-flex\",\"px-3\"],[\"mat-button\",\"\",\"title\",\"Fermer la fen\\xeatre\",3,\"mat-dialog-close\"],[1,\"pa-3\"],[1,\"mat-body\"],[\"mat-table\",\"\",1,\"mt-2\",2,\"width\",\"100%\",3,\"dataSource\"],[\"matColumnDef\",\"action\"],[\"mat-header-cell\",\"\",\"class\",\"pa-3\",4,\"matHeaderCellDef\"],[\"mat-cell\",\"\",\"class\",\"pa-3\",4,\"matCellDef\"],[\"matColumnDef\",\"guest\"],[\"matColumnDef\",\"contributor\"],[\"matColumnDef\",\"owner\"],[\"matColumnDef\",\"admin\"],[\"mat-header-row\",\"\",4,\"matHeaderRowDef\"],[\"mat-row\",\"\",4,\"matRowDef\",\"matRowDefColumns\"],[1,\"mat-small\"],[\"mat-header-cell\",\"\",1,\"pa-3\"],[\"mat-cell\",\"\",1,\"pa-3\"],[\"mat-header-row\",\"\"],[\"mat-row\",\"\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"h1\",1),xl(2,\" R\\xf4les et permissions \"),Fa(),La(3,\"button\",2),La(4,\"mat-icon\"),xl(5,\"close\"),Fa(),Fa(),Fa(),La(6,\"div\",3),La(7,\"p\",4),xl(8,\" Le tableau ci-dessous recense les permissions des utilisateurs membres d'un groupe selon leur r\\xf4le dans le groupe. \"),Fa(),La(9,\"table\",5),Ba(10,6),oa(11,UX,2,0,\"th\",7),oa(12,jX,2,1,\"td\",8),za(),Ba(13,9),oa(14,HX,2,0,\"th\",7),oa(15,GX,2,1,\"td\",8),za(),Ba(16,10),oa(17,WX,2,0,\"th\",7),oa(18,qX,2,1,\"td\",8),za(),Ba(19,11),oa(20,YX,2,0,\"th\",7),oa(21,ZX,2,1,\"td\",8),za(),Ba(22,12),oa(23,KX,2,0,\"th\",7),oa(24,XX,2,1,\"td\",8),za(),oa(25,QX,1,0,\"tr\",13),oa(26,JX,1,0,\"tr\",14),Fa(),La(27,\"p\",15),xl(28,\" * Les donn\\xe9es du groupe d\\xe9signent les flottes, annotations, zones et r\\xe8gles. \"),Fa(),Fa()),2&t&&(Cr(9),Ra(\"dataSource\",e.dataSource),Cr(16),Ra(\"matHeaderRowDef\",e.displayedColumns),Cr(1),Ra(\"matRowDefColumns\",e.displayedColumns))},directives:[Ly,sk,uE,TX,OX,PX,IX,LX,FX,RX,DX,NX,BX],encapsulation:2}),t})();var sQ=(()=>(function(t){t.User=\"user\",t.Admin=\"admin\"}(sQ||(sQ={})),sQ))();function rQ(t,e){let i;const n=[];for(;null!==(i=t.exec(e));)i.index===t.lastIndex&&t.lastIndex++,n.push(i.slice(1));return n}const oQ=/(?:\\W|^)([0-9]{9})(?!\\w)/g,aQ=/(?:\\W|^)([0-9]{7})(?!\\w)/g,lQ=/(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))/g,cQ=/([+-]?\\d{1,2}(?:\\.\\d{1,14})?)\\s*[NSns]?[, ]+([+-]?\\d{1,3}(?:\\.\\d{1,14})?)\\s*[EWew]?/g;function hQ(t){return rQ(cQ,t).map(([t,e])=>({lat:parseFloat(t),lon:parseFloat(e)})).filter(t=>mQ(t))}const uQ=/(\\d{1,2})\\D+(\\d{1,2}(?:\\.\\d*)?)\\D*([NSns])[, -]+(\\d{1,3})\\D+(\\d{1,2}(?:\\.\\d*)?)\\D*([EWew])/g;function dQ(t){return rQ(uQ,t).map(([t,e,i,n,s,r])=>({lat:(parseFloat(t)+parseFloat(e)/60)*(\"Nn\".includes(i)?1:-1),lon:(parseFloat(n)+parseFloat(s)/60)*(\"Ee\".includes(r)?1:-1)})).filter(t=>mQ(t))}const pQ=/(\\d{1,2})\\D+(\\d{1,2})[^.0-9]+(\\d{1,2}(?:\\.\\d*)?)\\D*([NSns])[, -]+(\\d{1,3})\\D+(\\d{1,2})[^.0-9]+(\\d{1,2}(?:\\.\\d*)?)\\D*([EWew])/g;function fQ(t){return rQ(pQ,t).map(([t,e,i,n,s,r,o,a])=>({lat:(parseFloat(t)+parseFloat(e)/60+parseFloat(i)/3600)*(\"Nn\".includes(n)?1:-1),lon:(parseFloat(s)+parseFloat(r)/60+parseFloat(o)/3600)*(\"Ee\".includes(a)?1:-1)})).filter(t=>mQ(t))}function mQ(t){return t.lat>=-85.06&&t.lat<=85.06&&t.lon>=-180&&t.lon<=180}function gQ(t){const e=t.value.match(lQ);return(null==e?void 0:e.length)>0?null:{missingEmails:!0}}function AQ(t,e){if(1&t&&(La(0,\"span\",2),xl(1),Fa()),2&t){const t=Ka();cl(\"background-color\",t.roleInfo.backgroundColor),Cr(1),Sl(t.roleInfo.label)}}function vQ(t,e){if(1&t&&(La(0,\"mat-option\",7),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.role),Cr(1),Cl(\" \",t.label,\" \")}}function _Q(t,e){if(1&t){const t=$a();La(0,\"span\",3),Ga(\"click\",function(){return Fe(t),Ka().openSelect()}),xl(1),Fa(),La(2,\"mat-select\",4,5),Ga(\"selectionChange\",function(e){return Fe(t),Ka().updateRole(e.value)}),oa(4,vQ,2,2,\"mat-option\",6),Fa()}if(2&t){const t=Ka();cl(\"background-color\",t.roleInfo.backgroundColor),Cr(1),Cl(\" \",t.roleInfo.label,\" \"),Cr(1),Ra(\"value\",t.role),Cr(2),Ra(\"ngForOf\",t.RoleInfos)}}let bQ=(()=>{class t{constructor(){this.editable=!1,this.update$=new gh,this.RoleInfos=$Y}ngOnChanges(t){t.role&&(this.roleInfo=$Y.find(t=>t.role===this.role))}openSelect(){this.select.open()}updateRole(t){this.role=t,this.roleInfo=$Y.find(t=>t.role===this.role),this.update$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-member-role-chip\"]],viewQuery:function(t,e){if(1&t&&Th(qT,5),2&t){let t;Mh(t=Ph())&&(e.select=t.first)}},inputs:{role:\"role\",editable:\"editable\"},outputs:{update$:\"update$\"},features:[he],decls:2,vars:2,consts:[[\"class\",\"role-chip\",3,\"backgroundColor\",4,\"ngIf\"],[3,\"ngIf\"],[1,\"role-chip\"],[\"title\",\"Cliquer pour changer\",1,\"role-chip\",\"role-chip--editable\",3,\"click\"],[1,\"select\",3,\"value\",\"selectionChange\"],[\"select\",\"\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"]],template:function(t,e){1&t&&(oa(0,AQ,2,3,\"span\",0),oa(1,_Q,5,5,\"ng-template\",1)),2&t&&(Ra(\"ngIf\",!e.editable),Cr(1),Ra(\"ngIf\",e.editable))},directives:[Vd,qT,Bd,ky],styles:[\"[_nghost-%COMP%]{position:relative}.role-chip[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:6px;line-height:1em;color:#fff}.role-chip--editable[_ngcontent-%COMP%]{cursor:pointer}.select[_ngcontent-%COMP%]{position:absolute;left:0;top:0;height:1px;width:1px;overflow:hidden;visibility:hidden}\"],changeDetection:0}),t})();function yQ(t,e){if(1&t){const t=$a();La(0,\"button\",14),Ga(\"click\",function(){return Fe(t),Ka(2).startEdition()}),La(1,\"mat-icon\"),xl(2,\"edit\"),Fa(),Fa()}}function wQ(t,e){if(1&t){const t=$a();La(0,\"button\",15),Ga(\"click\",function(){return Fe(t),Ka(2).deleteGroup()}),La(1,\"mat-icon\"),xl(2,\"delete\"),Fa(),Fa()}}function xQ(t,e){if(1&t&&(La(0,\"div\",10),La(1,\"div\",11),xl(2),Fa(),oa(3,yQ,3,0,\"button\",12),oa(4,wQ,3,0,\"button\",13),Fa()),2&t){const t=Ka();Cr(2),Cl(\" \",t.group.name,\" \"),Cr(1),Ra(\"ngIf\",t.canEdit),Cr(1),Ra(\"ngIf\",t.canDelete)}}function SQ(t,e){if(1&t){const t=$a();La(0,\"form\",16),La(1,\"mat-form-field\",17),La(2,\"mat-label\"),xl(3,\"Nom du groupe\"),Fa(),Na(4,\"input\",18),Fa(),La(5,\"button\",19),La(6,\"mat-icon\"),xl(7,\" check \"),Fa(),Fa(),La(8,\"button\",20),Ga(\"click\",function(){return Fe(t),Ka().showEditForm=!1}),La(9,\"mat-icon\"),xl(10,\" clear \"),Fa(),Fa(),Fa()}if(2&t){const t=Ka();Ra(\"formGroup\",t.editForm),Cr(5),Ra(\"app-async-action\",t.saveEdition)(\"disabled\",!t.editForm.valid)}}function CQ(t,e){if(1&t&&(La(0,\"mat-hint\"),xl(1),Fa()),2&t){const t=Ka(2);Cr(1),El(\"\",t.extractedEmailsCount,\" email\",t.extractedEmailsCount>1?\"s\":\"\",\" reconnu\",t.extractedEmailsCount>1?\"s\":\"\",\".\")}}function kQ(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"Aucun email reconnu\"),Fa())}function EQ(t,e){if(1&t){const t=$a();La(0,\"h4\",21),xl(1,\"Ajouter des membres\"),Fa(),La(2,\"form\",22),La(3,\"mat-form-field\",23),La(4,\"mat-label\"),xl(5,\"Email(s)\"),Fa(),Na(6,\"textarea\",24),oa(7,CQ,2,3,\"mat-hint\",25),oa(8,kQ,2,0,\"mat-error\",25),Fa(),La(9,\"app-member-role-chip\",26),Ga(\"update$\",function(e){return Fe(t),Ka().addMembersForm.controls.role.setValue(e)}),Fa(),La(10,\"button\",27),xl(11),Fa(),Fa()}if(2&t){const t=Ka();Cr(2),Ra(\"formGroup\",t.addMembersForm),Cr(5),Ra(\"ngIf\",t.extractedEmailsCount>0),Cr(1),Ra(\"ngIf\",t.addMembersForm.controls.emails.touched&&t.addMembersForm.controls.emails.hasError(\"missingEmails\")),Cr(1),Ra(\"role\",t.addMembersForm.controls.role.value)(\"editable\",!0),Cr(1),Ra(\"app-async-action\",t.addMembers)(\"disabled\",!t.addMembersForm.valid),Cr(1),Cl(\"Ajouter \",t.extractedEmailsCount>1?\"les utilisateurs\":\"l'utilisateur\",\"\")}}function MQ(t,e){1&t&&(La(0,\"div\",28),xl(1,\"Aucun membre\"),Fa())}function TQ(t,e){if(1&t){const t=$a();La(0,\"button\",32),Ga(\"click\",function(){Fe(t);const e=Ka().$implicit;return Ka().removeMember(e.id)}),La(1,\"mat-icon\"),xl(2,\"delete\"),Fa(),Fa()}}function IQ(t,e){if(1&t){const t=$a();La(0,\"div\",29),La(1,\"div\",30),xl(2),Fa(),La(3,\"app-member-role-chip\",26),Ga(\"update$\",function(e){const i=Fe(t).$implicit;return Ka().updateMemberRole(i.id,e)}),Fa(),oa(4,TQ,3,0,\"button\",31),Fa()}if(2&t){const t=e.$implicit,i=Ka();Cr(2),Sl(t.email),Cr(1),Ra(\"role\",t.role)(\"editable\",i.canEdit),Cr(1),Ra(\"ngIf\",i.canEdit)}}let PQ=(()=>{class t extends Gq{constructor(t,e,i,n){super(),this.dialog=t,this.formBuilder=e,this.uiService=i,this.workerService=n,this.update$=new gh,this.delete$=new gh,this.showEditForm=!1,this.extractedEmails=[],this.extractedEmailsCount=0,this.saveEdition=()=>Hp(this,void 0,void 0,function*(){yield this.workerService.groups.update(this.group.id,{name:this.editForm.value.name}),this.notifyUpdate(),this.cancelEdition()}),this.addMembers=()=>Hp(this,void 0,void 0,function*(){const t=yield Promise.all(this.extractedEmails.map(t=>Hp(this,void 0,void 0,function*(){try{const e=yield this.workerService.users.getByEmail(t);return{email:t,id:null==e?void 0:e.id}}catch(e){return{email:t,id:null}}}))),e=t.filter(t=>!!t.id).map(t=>({user_id:t.id,role:this.addMembersForm.value.role}));if(0===e.length)throw new Error(\"Aucun compte ANAIS n'a \\xe9t\\xe9 trouv\\xe9 ANAIS.\");if(yield this.workerService.groups.addGroupMembers(this.group.id,e),this.notifyUpdate(),t.length!==e.length){const e=t.filter(t=>!t.id).map(t=>t.email);this.uiService.success(`Aucun compte ANAIS n'a \\xe9t\\xe9 trouv\\xe9 pour les emails suivants : ${e.join(\", \")}`)}}),this.updateMemberRole=(t,e)=>Hp(this,void 0,void 0,function*(){yield this.workerService.groups.updateGroupMember(this.group.id,t,{role:e}),this.notifyUpdate()}),this.removeMember=t=>Hp(this,void 0,void 0,function*(){this.uiService.confirm({title:\"Suppression du membre\",message:\"Confirmez-vous la suppression du membre de ce groupe ?\",action:e=>Hp(this,void 0,void 0,function*(){e&&(yield this.workerService.groups.removeGroupMember(this.group.id,t),this.notifyUpdate())})})})}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.ensureMandatoryInputParams(\"group\"),this.addMembersForm=this.formBuilder.group({emails:[\"\",[gQ]],role:[VY.Guest]}),this.canEdit=[sQ.Admin,VY.Owner,VY.Contributor].includes(this.permissions),this.canDelete=this.permissions===sQ.Admin,this.subscriptions.push(this.addMembersForm.controls.emails.valueChanges.subscribe(t=>{var e;const i=t.match(lQ);this.extractedEmails=null!=i?i:[],this.extractedEmailsCount=null!==(e=null==i?void 0:i.length)&&void 0!==e?e:0}))})}notifyUpdate(){this.update$.emit(this.group)}startEdition(){this.editForm=this.formBuilder.group({name:[this.group.name,[Xy.required]]}),this.showEditForm=!0}cancelEdition(){this.showEditForm=!1}deleteGroup(){this.uiService.confirm({title:\"Suppression\",message:\"Confirmez-vous la suppression de ce groupe ?\",action:t=>Hp(this,void 0,void 0,function*(){t&&(yield this.workerService.groups.delete(this.group.id),this.delete$.emit())})})}trackById(t,e){return e.id}openRolePermissionsDialog(){this.dialog.open(nQ,{panelClass:\"no-border-dialog\",autoFocus:!1,closeOnNavigation:!1})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ik),Oa(Lx),Oa(_H),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-group-management\"]],inputs:{group:\"group\",permissions:\"permissions\"},outputs:{update$:\"update$\",delete$:\"delete$\"},features:[Uo],decls:13,vars:7,consts:[[\"class\",\"d-flex\",4,\"ngIf\"],[\"class\",\"d-flex\",3,\"formGroup\",4,\"ngIf\"],[2,\"border\",\"1px solid #dbdbdb\",\"padding\",\"16px\"],[3,\"ngIf\"],[\"mat-button\",\"\",1,\"mt-2\",3,\"click\"],[1,\"mini-icon\",\"mr-1\"],[1,\"subheading-1\",\"mx-1\"],[1,\"table\"],[\"class\",\"no-member-message\",4,\"ngIf\"],[\"class\",\"d-flex-center row\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[1,\"d-flex\"],[1,\"pa-3\",\"u-flex\",\"d-flex-center\",\"group-name\"],[\"mat-button\",\"\",\"title\",\"Editer le nom du groupe\",3,\"click\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer ce groupe\",3,\"click\",4,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Editer le nom du groupe\",3,\"click\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer ce groupe\",3,\"click\"],[1,\"d-flex\",3,\"formGroup\"],[\"appearance\",\"outline\",1,\"simple-form-field\",\"u-flex\",\"pa-2\",\"mr-3\"],[\"matInput\",\"\",\"formControlName\",\"name\",\"required\",\"\",1,\"group-name\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Enregistrer les changements\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Annuler l'\\xe9dition\",3,\"click\"],[1,\"subheading-1\",\"mx-1\",\"mt-0\",\"mb-1\"],[1,\"d-flex-center\",3,\"formGroup\"],[\"appearance\",\"outline\",1,\"u-flex\",\"mt-3\"],[\"matInput\",\"\",\"formControlName\",\"emails\",\"cdkTextareaAutosize\",\"\",\"cdkAutosizeMinRows\",\"1\",\"cdkAutosizeMaxRows\",\"6\",\"required\",\"\"],[4,\"ngIf\"],[1,\"mx-2\",3,\"role\",\"editable\",\"update$\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",3,\"app-async-action\",\"disabled\"],[1,\"no-member-message\"],[1,\"d-flex-center\",\"row\"],[1,\"u-flex\",\"px-2\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Retirer ce membre\",3,\"click\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Retirer ce membre\",3,\"click\"]],template:function(t,e){1&t&&(oa(0,xQ,5,3,\"div\",0),oa(1,SQ,11,3,\"form\",1),La(2,\"div\",2),oa(3,EQ,12,8,\"ng-template\",3),La(4,\"a\",4),Ga(\"click\",function(){return e.openRolePermissionsDialog()}),La(5,\"mat-icon\",5),xl(6,\"help\"),Fa(),xl(7,\" Plus d'information sur les permissions \"),Fa(),Fa(),La(8,\"h4\",6),xl(9),Fa(),La(10,\"div\",7),oa(11,MQ,2,0,\"div\",8),oa(12,IQ,5,4,\"div\",9),Fa()),2&t&&(Ra(\"ngIf\",!e.showEditForm),Cr(1),Ra(\"ngIf\",e.showEditForm),Cr(2),Ra(\"ngIf\",e.canEdit),Cr(6),Cl(\"Membres (\",e.group.members.length,\")\"),Cr(2),Ra(\"ngIf\",0===e.group.members.length),Cr(1),Ra(\"ngForOf\",e.group.members)(\"ngForTrackBy\",e.trackById))},directives:[Vd,Fy,uE,Bd,Ly,sx,Cw,dx,AS,aS,ES,Gy,Sw,_x,Ex,Jq,yS,bQ,oS,eS],styles:[\".group-name[_ngcontent-%COMP%]{font-size:1.2em}.row[_ngcontent-%COMP%]{line-height:36px}.row[_ngcontent-%COMP%]:nth-child(odd){background-color:#f5f5f5}\"]}),t})();function OQ(t,e){if(1&t){const t=$a();La(0,\"div\",1),La(1,\"a\",2),La(2,\"mat-icon\"),xl(3,\"arrow_back_ios\"),Fa(),xl(4,\" Retour aux groupes \"),Fa(),Fa(),La(5,\"app-group-management\",3),Ga(\"update$\",function(){return Fe(t),Ka().onUpdate()})(\"delete$\",function(){return Fe(t),Ka().redirectToGroupsList()}),Fa()}if(2&t){const t=Ka();Cr(5),Ra(\"group\",t.group)}}let RQ=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o){super(),this.activatedRoute=t,this.title=e,this.router=i,this.mapConfigService=n,this.notificationsService=s,this.uiService=r,this.workerService=o}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.subscriptions.push(this.activatedRoute.paramMap.subscribe(t=>Hp(this,void 0,void 0,function*(){this.groupId=t.get(\"groupId\"),yield this.fetchGroup()})),this.notificationsService.events$.pipe(Af(t=>\"group\"===t.kind&&t.id===this.groupId)).subscribe(t=>Hp(this,void 0,void 0,function*(){var e,i;\"delete\"===t.type?(this.uiService.success(`Le groupe \\`${(null===(e=this.group)||void 0===e?void 0:e.name)||\"\"}\\` vient d'\\xeatre supprim\\xe9.`),yield this.redirectToGroupsList()):(this.uiService.success(`Le groupe \\`${(null===(i=this.group)||void 0===i?void 0:i.name)||\"\"}\\` vient d'\\xeatre mis \\xe0 jour.`),yield this.fetchGroup())})))})}fetchGroup(){return Hp(this,void 0,void 0,function*(){this.group=yield this.workerService.groups.getGroup(this.groupId),this.title.setTitle(`Groupe ${this.group.name} - ANAIS`)})}onUpdate(){return Hp(this,void 0,void 0,function*(){yield this.fetchGroup()})}redirectToGroupsList(){return Hp(this,void 0,void 0,function*(){yield this.router.navigateByUrl(\"/admin/groups\")})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(GR),Oa(jp),Oa(pL),Oa(qU),Oa(aK),Oa(_H),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-manage-group-page\"]],features:[Uo],decls:1,vars:1,consts:[[3,\"ngIf\"],[1,\"d-flex\",2,\"background-color\",\"#fff\"],[\"mat-button\",\"\",\"title\",\"Revenir \\xe0 la liste\",\"routerLink\",\"/admin/groups\",2,\"line-height\",\"36px\"],[\"permissions\",\"admin\",3,\"group\",\"update$\",\"delete$\"]],template:function(t,e){1&t&&oa(0,OQ,6,1,\"ng-template\",0),2&t&&Ra(\"ngIf\",e.group)},directives:[Vd,Fy,gL,uE,PQ],styles:[\"\"]}),t})();const DQ=function(t){return[\"/admin/groups/\",t]};function LQ(t,e){if(1&t&&(La(0,\"a\",9),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"routerLink\",ih(2,DQ,t.id)),Cr(1),Cl(\" \",t.name,\"\\n\")}}let FQ=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.formBuilder=t,this.title=e,this.notificationsService=i,this.uiService=n,this.workerService=s,this.groups=[],this.createGroup=()=>Hp(this,void 0,void 0,function*(){this.createGroupForm.valid&&(yield this.workerService.groups.create({name:this.createGroupForm.controls.name.value}),yield this.refreshGroups(),this.createGroupForm.reset())})}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.title.setTitle(\"Gestion des groupes - ANAIS\"),this.createGroupForm=this.formBuilder.group({name:[\"\",[Xy.required]]}),this.subscriptions.push(this.notificationsService.events$.pipe(Af(t=>\"group\"===t.kind)).subscribe(()=>Hp(this,void 0,void 0,function*(){this.uiService.success(\"Les groupes ont \\xe9t\\xe9 mis \\xe0 jour.\"),yield this.refreshGroups()}))),yield this.refreshGroups()})}refreshGroups(){return Hp(this,void 0,void 0,function*(){this.groups=yield this.workerService.groups.listAllGroups()})}trackById(t,e){return e.id}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Lx),Oa(jp),Oa(aK),Oa(_H),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-manage-groups-page\"]],features:[Uo],decls:15,vars:6,consts:[[1,\"mat-h1\"],[2,\"border\",\"1px solid #dbdbdb\",\"padding\",\"16px\"],[1,\"subheading-1\",\"mx-1\",\"mt-0\",\"mb-1\"],[1,\"d-flex-center\",3,\"formGroup\"],[\"appearance\",\"outline\",1,\"simple-form-field\",\"u-flex\",\"mr-3\"],[\"matInput\",\"\",\"formControlName\",\"name\",\"required\",\"\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",3,\"app-async-action\",\"disabled\"],[1,\"subheading-1\",\"mx-1\"],[\"mat-button\",\"\",\"class\",\"mat-elevation-z2 pa-3 my-3 d-block u-left\",\"style\",\"background-color: #f9f9f9;\",3,\"routerLink\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[\"mat-button\",\"\",1,\"mat-elevation-z2\",\"pa-3\",\"my-3\",\"d-block\",\"u-left\",2,\"background-color\",\"#f9f9f9\",3,\"routerLink\"]],template:function(t,e){1&t&&(La(0,\"h1\",0),xl(1,\"Gestion des groupes\"),Fa(),La(2,\"div\",1),La(3,\"h4\",2),xl(4,\"Nouveau groupe\"),Fa(),La(5,\"form\",3),La(6,\"mat-form-field\",4),La(7,\"mat-label\"),xl(8,\"Nom du groupe\"),Fa(),Na(9,\"input\",5),Fa(),La(10,\"button\",6),xl(11,\"Cr\\xe9er le groupe\"),Fa(),Fa(),Fa(),La(12,\"h4\",7),xl(13),Fa(),oa(14,LQ,2,4,\"a\",8)),2&t&&(Cr(5),Ra(\"formGroup\",e.createGroupForm),Cr(5),Ra(\"app-async-action\",e.createGroup)(\"disabled\",!e.createGroupForm.valid),Cr(3),Cl(\"Groupes (\",e.groups.length,\")\"),Cr(1),Ra(\"ngForOf\",e.groups)(\"ngForTrackBy\",e.trackById))},directives:[sx,Cw,dx,AS,aS,ES,Gy,Sw,_x,Ex,Ly,Jq,Bd,Fy,gL],styles:[\"\"]}),t})();const NQ=[\"mat-sort-header\",\"\"];function BQ(t,e){if(1&t){const t=$a();La(0,\"div\",3),Ga(\"@arrowPosition.start\",function(){return Fe(t),Ka()._disableViewStateAnimation=!0})(\"@arrowPosition.done\",function(){return Fe(t),Ka()._disableViewStateAnimation=!1}),Na(1,\"div\",4),La(2,\"div\",5),Na(3,\"div\",6),Na(4,\"div\",7),Na(5,\"div\",8),Fa(),Fa()}if(2&t){const t=Ka();Ra(\"@arrowOpacity\",t._getArrowViewState())(\"@arrowPosition\",t._getArrowViewState())(\"@allowChildren\",t._getArrowDirectionState()),Cr(2),Ra(\"@indicator\",t._getArrowDirectionState()),Cr(1),Ra(\"@leftPointer\",t._getArrowDirectionState()),Cr(1),Ra(\"@rightPointer\",t._getArrowDirectionState())}}const zQ=[\"*\"],VQ=new Ji(\"MAT_SORT_DEFAULT_OPTIONS\"),$Q=Ub(Nb(class{}));let UQ=(()=>{class t extends $Q{constructor(t){super(),this._defaultOptions=t,this.sortables=new Map,this._stateChanges=new C,this.start=\"asc\",this._direction=\"\",this.sortChange=new gh}get direction(){return this._direction}set direction(t){this._direction=t}get disableClear(){return this._disableClear}set disableClear(t){this._disableClear=Lf(t)}register(t){this.sortables.set(t.id,t)}deregister(t){this.sortables.delete(t.id)}sort(t){this.active!=t.id?(this.active=t.id,this.direction=t.start?t.start:this.start):this.direction=this.getNextSortDirection(t),this.sortChange.emit({active:this.active,direction:this.direction})}getNextSortDirection(t){var e,i,n;if(!t)return\"\";const s=null!==(i=null!==(e=null==t?void 0:t.disableClear)&&void 0!==e?e:this.disableClear)&&void 0!==i?i:!!(null===(n=this._defaultOptions)||void 0===n?void 0:n.disableClear);let r=function(t,e){let i=[\"asc\",\"desc\"];return\"desc\"==t&&i.reverse(),e||i.push(\"\"),i}(t.start||this.start,s),o=r.indexOf(this.direction)+1;return o>=r.length&&(o=0),r[o]}ngOnInit(){this._markInitialized()}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(VQ,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matSort\",\"\"]],hostAttrs:[1,\"mat-sort\"],inputs:{disabled:[\"matSortDisabled\",\"disabled\"],start:[\"matSortStart\",\"start\"],direction:[\"matSortDirection\",\"direction\"],disableClear:[\"matSortDisableClear\",\"disableClear\"],active:[\"matSortActive\",\"active\"]},outputs:{sortChange:\"matSortChange\"},exportAs:[\"matSort\"],features:[Uo,he]}),t})();const jQ=Rb.ENTERING+\" \"+Ob.STANDARD_CURVE,HQ={indicator:BA(\"indicator\",[UA(\"active-asc, asc\",$A({transform:\"translateY(0px)\"})),UA(\"active-desc, desc\",$A({transform:\"translateY(10px)\"})),HA(\"active-asc <=> active-desc\",zA(jQ))]),leftPointer:BA(\"leftPointer\",[UA(\"active-asc, asc\",$A({transform:\"rotate(-45deg)\"})),UA(\"active-desc, desc\",$A({transform:\"rotate(45deg)\"})),HA(\"active-asc <=> active-desc\",zA(jQ))]),rightPointer:BA(\"rightPointer\",[UA(\"active-asc, asc\",$A({transform:\"rotate(45deg)\"})),UA(\"active-desc, desc\",$A({transform:\"rotate(-45deg)\"})),HA(\"active-asc <=> active-desc\",zA(jQ))]),arrowOpacity:BA(\"arrowOpacity\",[UA(\"desc-to-active, asc-to-active, active\",$A({opacity:1})),UA(\"desc-to-hint, asc-to-hint, hint\",$A({opacity:.54})),UA(\"hint-to-desc, active-to-desc, desc, hint-to-asc, active-to-asc, asc, void\",$A({opacity:0})),HA(\"* => asc, * => desc, * => active, * => hint, * => void\",zA(\"0ms\")),HA(\"* <=> *\",zA(jQ))]),arrowPosition:BA(\"arrowPosition\",[HA(\"* => desc-to-hint, * => desc-to-active\",zA(jQ,jA([$A({transform:\"translateY(-25%)\"}),$A({transform:\"translateY(0)\"})]))),HA(\"* => hint-to-desc, * => active-to-desc\",zA(jQ,jA([$A({transform:\"translateY(0)\"}),$A({transform:\"translateY(25%)\"})]))),HA(\"* => asc-to-hint, * => asc-to-active\",zA(jQ,jA([$A({transform:\"translateY(25%)\"}),$A({transform:\"translateY(0)\"})]))),HA(\"* => hint-to-asc, * => active-to-asc\",zA(jQ,jA([$A({transform:\"translateY(0)\"}),$A({transform:\"translateY(-25%)\"})]))),UA(\"desc-to-hint, asc-to-hint, hint, desc-to-active, asc-to-active, active\",$A({transform:\"translateY(0)\"})),UA(\"hint-to-desc, active-to-desc, desc\",$A({transform:\"translateY(-25%)\"})),UA(\"hint-to-asc, active-to-asc, asc\",$A({transform:\"translateY(25%)\"}))]),allowChildren:BA(\"allowChildren\",[HA(\"* <=> *\",[WA(\"@*\",GA(),{optional:!0})])])};let GQ=(()=>{class t{constructor(){this.changes=new C}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({factory:function(){return new t},token:t,providedIn:\"root\"}),t})();const WQ={provide:GQ,deps:[[new Ln,new Nn,GQ]],useFactory:function(t){return t||new GQ}},qQ=Nb(class{});let YQ=(()=>{class t extends qQ{constructor(t,e,i,n,s,r,o){super(),this._intl=t,this._changeDetectorRef=e,this._sort=i,this._columnDef=n,this._focusMonitor=s,this._elementRef=r,this._ariaDescriber=o,this._showIndicatorHint=!1,this._viewState={},this._arrowDirection=\"\",this._disableViewStateAnimation=!1,this.arrowPosition=\"after\",this._sortActionDescription=\"Sort\",this._handleStateChanges()}get sortActionDescription(){return this._sortActionDescription}set sortActionDescription(t){this._updateSortActionDescription(t)}get disableClear(){return this._disableClear}set disableClear(t){this._disableClear=Lf(t)}ngOnInit(){!this.id&&this._columnDef&&(this.id=this._columnDef.name),this._updateArrowDirection(),this._setAnimationTransitionState({toState:this._isSorted()?\"active\":this._arrowDirection}),this._sort.register(this),this._sortButton=this._elementRef.nativeElement.querySelector('[role=\"button\"]'),this._updateSortActionDescription(this._sortActionDescription)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{const e=!!t;e!==this._showIndicatorHint&&(this._setIndicatorHintVisible(e),this._changeDetectorRef.markForCheck())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._sort.deregister(this),this._rerenderSubscription.unsubscribe()}_setIndicatorHintVisible(t){this._isDisabled()&&t||(this._showIndicatorHint=t,this._isSorted()||(this._updateArrowDirection(),this._setAnimationTransitionState(this._showIndicatorHint?{fromState:this._arrowDirection,toState:\"hint\"}:{fromState:\"hint\",toState:this._arrowDirection})))}_setAnimationTransitionState(t){this._viewState=t||{},this._disableViewStateAnimation&&(this._viewState={toState:t.toState})}_toggleOnInteraction(){this._sort.sort(this),(\"hint\"===this._viewState.toState||\"active\"===this._viewState.toState)&&(this._disableViewStateAnimation=!0)}_handleClick(){this._isDisabled()||this._sort.sort(this)}_handleKeydown(t){!this._isDisabled()&&(32===t.keyCode||13===t.keyCode)&&(t.preventDefault(),this._toggleOnInteraction())}_isSorted(){return this._sort.active==this.id&&(\"asc\"===this._sort.direction||\"desc\"===this._sort.direction)}_getArrowDirectionState(){return`${this._isSorted()?\"active-\":\"\"}${this._arrowDirection}`}_getArrowViewState(){const t=this._viewState.fromState;return(t?`${t}-to-`:\"\")+this._viewState.toState}_updateArrowDirection(){this._arrowDirection=this._isSorted()?this._sort.direction:this.start||this._sort.start}_isDisabled(){return this._sort.disabled||this.disabled}_getAriaSortAttribute(){return this._isSorted()?\"asc\"==this._sort.direction?\"ascending\":\"descending\":\"none\"}_renderArrow(){return!this._isDisabled()||this._isSorted()}_updateSortActionDescription(t){var e,i;this._sortButton&&(null===(e=this._ariaDescriber)||void 0===e||e.removeDescription(this._sortButton,this._sortActionDescription),null===(i=this._ariaDescriber)||void 0===i||i.describe(this._sortButton,t)),this._sortActionDescription=t}_handleStateChanges(){this._rerenderSubscription=q(this._sort.sortChange,this._sort._stateChanges,this._intl.changes).subscribe(()=>{this._isSorted()&&(this._updateArrowDirection(),(\"hint\"===this._viewState.toState||\"active\"===this._viewState.toState)&&(this._disableViewStateAnimation=!0),this._setAnimationTransitionState({fromState:this._arrowDirection,toState:\"active\"}),this._showIndicatorHint=!1),!this._isSorted()&&this._viewState&&\"active\"===this._viewState.toState&&(this._disableViewStateAnimation=!1,this._setAnimationTransitionState({fromState:\"active\",toState:this._arrowDirection})),this._changeDetectorRef.markForCheck()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(GQ),Oa(Mc),Oa(UQ,8),Oa(\"MAT_SORT_HEADER_COLUMN_DEF\",8),Oa(Vm),Oa(ic),Oa(gm,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"\",\"mat-sort-header\",\"\"]],hostAttrs:[1,\"mat-sort-header\"],hostVars:3,hostBindings:function(t,e){1&t&&Ga(\"click\",function(){return e._handleClick()})(\"keydown\",function(t){return e._handleKeydown(t)})(\"mouseenter\",function(){return e._setIndicatorHintVisible(!0)})(\"mouseleave\",function(){return e._setIndicatorHintVisible(!1)}),2&t&&(ia(\"aria-sort\",e._getAriaSortAttribute()),hl(\"mat-sort-header-disabled\",e._isDisabled()))},inputs:{disabled:\"disabled\",arrowPosition:\"arrowPosition\",sortActionDescription:\"sortActionDescription\",disableClear:\"disableClear\",id:[\"mat-sort-header\",\"id\"],start:\"start\"},exportAs:[\"matSortHeader\"],features:[Uo],attrs:NQ,ngContentSelectors:zQ,decls:4,vars:6,consts:[[\"role\",\"button\",1,\"mat-sort-header-container\",\"mat-focus-indicator\"],[1,\"mat-sort-header-content\"],[\"class\",\"mat-sort-header-arrow\",4,\"ngIf\"],[1,\"mat-sort-header-arrow\"],[1,\"mat-sort-header-stem\"],[1,\"mat-sort-header-indicator\"],[1,\"mat-sort-header-pointer-left\"],[1,\"mat-sort-header-pointer-right\"],[1,\"mat-sort-header-pointer-middle\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0),La(1,\"div\",1),Ja(2),Fa(),oa(3,BQ,6,6,\"div\",2),Fa()),2&t&&(hl(\"mat-sort-header-sorted\",e._isSorted())(\"mat-sort-header-position-before\",\"before\"==e.arrowPosition),ia(\"tabindex\",e._isDisabled()?null:0),Cr(3),Ra(\"ngIf\",e._renderArrow()))},directives:[Vd],styles:[\".mat-sort-header-container{display:flex;cursor:pointer;align-items:center;letter-spacing:normal;outline:0}[mat-sort-header].cdk-keyboard-focused .mat-sort-header-container,[mat-sort-header].cdk-program-focused .mat-sort-header-container{border-bottom:solid 1px currentColor}.mat-sort-header-disabled .mat-sort-header-container{cursor:default}.mat-sort-header-content{text-align:center;display:flex;align-items:center}.mat-sort-header-position-before{flex-direction:row-reverse}.mat-sort-header-arrow{height:12px;width:12px;min-width:12px;position:relative;display:flex;opacity:0}.mat-sort-header-arrow,[dir=rtl] .mat-sort-header-position-before .mat-sort-header-arrow{margin:0 0 0 6px}.mat-sort-header-position-before .mat-sort-header-arrow,[dir=rtl] .mat-sort-header-arrow{margin:0 6px 0 0}.mat-sort-header-stem{background:currentColor;height:10px;width:2px;margin:auto;display:flex;align-items:center}.cdk-high-contrast-active .mat-sort-header-stem{width:0;border-left:solid 2px}.mat-sort-header-indicator{width:100%;height:2px;display:flex;align-items:center;position:absolute;top:0;left:0}.mat-sort-header-pointer-middle{margin:auto;height:2px;width:2px;background:currentColor;transform:rotate(45deg)}.cdk-high-contrast-active .mat-sort-header-pointer-middle{width:0;height:0;border-top:solid 2px;border-left:solid 2px}.mat-sort-header-pointer-left,.mat-sort-header-pointer-right{background:currentColor;width:6px;height:2px;position:absolute;top:0}.cdk-high-contrast-active .mat-sort-header-pointer-left,.cdk-high-contrast-active .mat-sort-header-pointer-right{width:0;height:0;border-left:solid 6px;border-top:solid 2px}.mat-sort-header-pointer-left{transform-origin:right;left:0}.mat-sort-header-pointer-right{transform-origin:left;right:0}\\n\"],encapsulation:2,data:{animation:[HQ.indicator,HQ.leftPointer,HQ.rightPointer,HQ.arrowOpacity,HQ.arrowPosition,HQ.allowChildren]},changeDetection:0}),t})(),ZQ=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({providers:[WQ],imports:[[np,Fb]]}),t})();function KQ(t,e){if(1&t&&(La(0,\"div\"),xl(1),Fa()),2&t){const t=e.$implicit;Cr(1),kl(\" \",t.email,\" - \",t.status,\" \")}}let XQ=(()=>{class t extends Gq{constructor(t,e){super(),this.data=t,this.workerService=e,this.workFinished=!1}ngOnInit(){this.accountsStatuses=this.data.emails.map(t=>({email:t,status:\"En attente\"})),Promise.all(this.accountsStatuses.map(t=>Hp(this,void 0,void 0,function*(){try{yield this.workerService.users.create({email:t.email,profile:this.data.profile}),t.status=\"OK\"}catch(e){console.log(\"err\",t.email,e),t.status=e.message.includes('duplicate key value violates unique constraint \"user_email_key\"')?\"D\\xe9j\\xe0 pr\\xe9sent\":`KO : ${null==e?void 0:e.message}`}}))).finally(()=>{this.workFinished=!0})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(XC),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-create-users-dialog\"]],features:[Uo],decls:11,vars:3,consts:[[1,\"d-flex\"],[1,\"dialog-title\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer la fen\\xeatre\",3,\"disabled\",\"mat-dialog-close\"],[1,\"dialog-content\"],[4,\"ngFor\",\"ngForOf\"],[\"mat-button\",\"\",\"title\",\"Fermer la fen\\xeatre\",1,\"d-block-center\",\"mt-3\",3,\"disabled\",\"mat-dialog-close\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"h1\",1),xl(2,\" Cr\\xe9ation de comptes utilisateurs \"),Fa(),Na(3,\"div\",2),La(4,\"button\",3),La(5,\"mat-icon\"),xl(6,\"close\"),Fa(),Fa(),Fa(),La(7,\"div\",4),oa(8,KQ,2,2,\"div\",5),La(9,\"button\",6),xl(10,\" Fermer la fen\\xeatre \"),Fa(),Fa()),2&t&&(Cr(4),Ra(\"disabled\",!e.workFinished),Cr(4),Ra(\"ngForOf\",e.accountsStatuses),Cr(1),Ra(\"disabled\",!e.workFinished))},directives:[Ly,sk,uE,Bd],encapsulation:2}),t})();const QQ=[\"*\"];let JQ=(()=>{class t{constructor(){this.title=\"\",this.bgColor=\"#55575f\",this.color=\"#ffffff\"}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-chip\"]],inputs:{title:\"title\",bgColor:\"bgColor\",color:\"color\"},ngContentSelectors:QQ,decls:2,vars:5,consts:[[1,\"chip\",3,\"title\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0),Ja(1),Fa()),2&t&&(cl(\"color\",e.color)(\"background-color\",e.bgColor),Ra(\"title\",e.title))},styles:[\".chip[_ngcontent-%COMP%]{display:inline-block;padding:4px 5px;border-radius:5px;font-size:12px}\"],changeDetection:0}),t})();function tJ(t,e){if(1&t){const t=$a();La(0,\"button\",25),Ga(\"click\",function(){Fe(t);const e=Ka();return e.filterValue=\"\",e.filterUsers(\"\")}),La(1,\"mat-icon\"),xl(2,\"close\"),Fa(),Fa()}}function eJ(t,e){1&t&&(La(0,\"th\",26),xl(1,\"Email\"),Fa())}function iJ(t,e){1&t&&(La(0,\"app-chip\",30),xl(1,\"Admin\"),Fa())}function nJ(t,e){1&t&&(La(0,\"app-chip\",31),xl(1,\"C'est vous !\"),Fa())}function sJ(t,e){if(1&t&&(La(0,\"td\",27),xl(1),oa(2,iJ,2,0,\"app-chip\",28),oa(3,nJ,2,0,\"app-chip\",29),Fa()),2&t){const t=e.$implicit,i=Ka();Cr(1),Cl(\" \",t.email,\" \"),Cr(1),Ra(\"ngIf\",\"admin\"===t.profile),Cr(1),Ra(\"ngIf\",t.id===i.authenticationService.getUserId())}}function rJ(t,e){1&t&&(La(0,\"th\",26),xl(1,\"Date de cr\\xe9ation\"),Fa())}function oJ(t,e){if(1&t&&(La(0,\"td\",27),xl(1),ch(2,\"date\"),Fa()),2&t){const t=e.$implicit;Cr(1),Sl(uh(2,1,t.created_at,\"yyyy-MM-dd HH:mm\"))}}function aJ(t,e){1&t&&(La(0,\"th\",26),xl(1,\"Derni\\xe8re activit\\xe9\"),Fa())}function lJ(t,e){if(1&t&&(La(0,\"td\",27),xl(1),ch(2,\"date\"),Fa()),2&t){const t=e.$implicit;Cr(1),Sl(uh(2,1,t.last_activity,\"yyyy-MM-dd HH:mm\"))}}function cJ(t,e){1&t&&(La(0,\"th\",26),xl(1,\"Unit\\xe9\"),Fa())}function hJ(t,e){if(1&t){const t=$a();La(0,\"td\",27),La(1,\"mat-form-field\"),La(2,\"input\",32),Ga(\"ngModelChange\",function(e){return Fe(t).$implicit.note=e})(\"ngModelChange\",function(e){const i=Fe(t).$implicit;return Ka().onUserNoteUpdate(i,e)}),Fa(),Fa(),Fa()}if(2&t){const t=e.$implicit;Cr(2),Ra(\"ngModel\",t.note)}}function uJ(t,e){1&t&&(La(0,\"th\",26),xl(1,\"Permissions\"),Fa())}function dJ(t,e){if(1&t){const t=$a();La(0,\"td\",27),xl(1,\" Ports\\xa0: \"),La(2,\"mat-checkbox\",33),Ga(\"ngModelChange\",function(e){const i=Fe(t).$implicit;return Ka().updatePermission(i,\"port_edition_validation\",e)}),xl(3,\"Validation\"),Fa(),Fa()}if(2&t){const t=e.$implicit;Cr(2),Ra(\"ngModel\",t.permissions.port_edition_validation)}}function pJ(t,e){1&t&&Na(0,\"th\",34)}function fJ(t,e){if(1&t){const t=$a();La(0,\"button\",38),Ga(\"click\",function(){Fe(t);const e=Ka().$implicit;return Ka().deleteUser(e.id)}),La(1,\"mat-icon\"),xl(2,\"delete\"),Fa(),Fa()}}function mJ(t,e){if(1&t&&(La(0,\"td\",27),La(1,\"button\",35),La(2,\"mat-icon\"),xl(3,\"mail\"),Fa(),Fa(),La(4,\"button\",36),La(5,\"mat-icon\"),xl(6,\"link\"),Fa(),Fa(),oa(7,fJ,3,0,\"button\",37),Fa()),2&t){const t=e.$implicit,i=Ka();Cr(1),Ra(\"app-async-action\",i.sendWelcomeEmail.bind(i,t.id)),Cr(3),Ra(\"app-async-action\",i.retrieveInvitationLink.bind(i,t.id)),Cr(3),Ra(\"ngIf\",t.id!==i.authenticationService.getUserId())}}function gJ(t,e){1&t&&Na(0,\"tr\",39)}function AJ(t,e){1&t&&Na(0,\"tr\",40)}function vJ(t,e){if(1&t&&(La(0,\"mat-hint\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),El(\"\",t.extractedEmailsCount,\" email\",t.extractedEmailsCount>1?\"s\":\"\",\" reconnu\",t.extractedEmailsCount>1?\"s\":\"\",\".\")}}function _J(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"Aucun email reconnu\"),Fa())}const bJ=function(){return[10,20,100]};let yJ=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o){super(),this.dialog=t,this.formBuilder=e,this.title=i,this.workerService=n,this.authenticationService=s,this.configService=r,this.uiService=o,this.displayedColumns=[\"email\",\"created_at\",\"last_activity\",\"note\",\"permissions\",\"actions\"],this.pendingNoteUpdates=new Map,this.extractedEmails=[],this.extractedEmailsCount=0,this.createUser=()=>Hp(this,void 0,void 0,function*(){this.createUserForm.valid&&(1===this.extractedEmailsCount?(yield this.workerService.users.create({email:this.extractedEmails[0],profile:this.createUserForm.controls.admin.value?\"admin\":\"user\"}),this.uiService.success(\"L'utilisateur a bien \\xe9t\\xe9 cr\\xe9\\xe9. Il recevra un email avec un lien vers l'application et les instructions pour d\\xe9finir son mot de passe.\")):yield this.openCreateUsersDialog(this.extractedEmails,this.createUserForm.controls.admin.value?\"admin\":\"user\"),this.createUserForm.controls.emails.reset(\"\"),this.createUserForm.controls.emails.status=\"VALID\",yield this.refreshList())}),this.refreshList=()=>Hp(this,void 0,void 0,function*(){this.usersDataSource.data=yield this.workerService.users.list()})}ngOnInit(){this.title.setTitle(\"Gestion des utilisateurs - ANAIS\"),this.createUserForm=this.formBuilder.group({emails:[\"\",[gQ]],admin:[!1]}),this.subscriptions.push(this.createUserForm.controls.emails.valueChanges.subscribe(t=>{var e;const i=t.match(lQ);this.extractedEmails=null!=i?i:[],this.extractedEmailsCount=null!==(e=null==i?void 0:i.length)&&void 0!==e?e:0})),this.usersDataSource=new $X([]),this.usersDataSource.filterPredicate=this.filterPredicate}ngAfterViewInit(){this.subscriptions.push(this.paginator.page.subscribe(t=>{this.configService.set(\"adminManageUsersPageSize\",t.pageSize)}),this.sort.sortChange.subscribe(t=>{this.configService.set(\"adminManageUsersSort\",{id:t.active,start:t.direction})})),this.paginator.pageSize=this.configService.adminManageUsersPageSize,this.usersDataSource.paginator=this.paginator,this.usersDataSource.sort=this.sort,setTimeout(()=>Hp(this,void 0,void 0,function*(){this.sort.sort(this.configService.adminManageUsersSort),yield this.refreshList()}))}deleteUser(t){this.uiService.confirm({title:\"Suppression\",message:\"Confirmez-vous la suppression de cet utilisateur ?\",action:e=>Hp(this,void 0,void 0,function*(){e&&(yield this.workerService.users.delete(t),this.usersDataSource.data=this.usersDataSource.data.filter(e=>e.id!==t))})})}sendWelcomeEmail(t){return Hp(this,void 0,void 0,function*(){yield this.workerService.users.sendWelcomeEmail(t),this.uiService.success(\"Un email d'invitation a \\xe9t\\xe9 envoy\\xe9 \\xe0 l'utilisateur\")})}retrieveInvitationLink(t){return Hp(this,void 0,void 0,function*(){const e=yield this.workerService.users.retrieveInvitationLink(t);this.uiService.success(`Voici le lien \\xe0 partager avec l'utilisateur : ${e}`)})}filterUsers(t){this.usersDataSource.filter=pU(t.trim()),this.usersDataSource.paginator&&this.usersDataSource.paginator.firstPage()}filterPredicate(t,e){return pU(t.email).includes(e)||pU(t.note).includes(e)}onUserNoteUpdate(t,e){return Hp(this,void 0,void 0,function*(){const i=this.pendingNoteUpdates.get(t.id);i&&clearTimeout(i),this.pendingNoteUpdates.set(t.id,window.setTimeout(()=>Hp(this,void 0,void 0,function*(){yield this.workerService.users.updateNote(t.id,e),this.pendingNoteUpdates.delete(t.id)}),500))})}updatePermission(t,e,i){return Hp(this,void 0,void 0,function*(){t.permissions[e]=i,yield this.workerService.users.updatePermission(t.id,e,i)})}openCreateUsersDialog(t,e){return Hp(this,void 0,void 0,function*(){return new Promise(i=>{this.createUsersDialogRef=this.dialog.open(XQ,{data:{emails:t,profile:e},autoFocus:!0,closeOnNavigation:!1}),this.createUsersDialogRef.afterClosed().subscribe(()=>{i()})})})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ik),Oa(Lx),Oa(jp),Oa(sH),Oa(rH),Oa(WU),Oa(_H))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-manage-users-page\"]],viewQuery:function(t,e){if(1&t&&(Th(UQ,5),Th(II,5)),2&t){let t;Mh(t=Ph())&&(e.sort=t.first),Mh(t=Ph())&&(e.paginator=t.first)}},features:[Uo],decls:48,vars:14,consts:[[1,\"mat-h1\"],[1,\"d-flex-center\",2,\"justify-content\",\"space-between\"],[\"matInput\",\"\",\"placeholder\",\"utilisateur@exemple.com\",3,\"ngModel\",\"ngModelChange\",\"keyup\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"aria-label\",\"Clear\",3,\"click\",4,\"ngIf\"],[\"mat-stroked-button\",\"\",3,\"app-async-action\"],[\"mat-table\",\"\",\"matSort\",\"\",\"matSortActive\",\"email\",\"matSortDirection\",\"asc\",1,\"table\",3,\"dataSource\"],[\"matColumnDef\",\"email\"],[\"mat-header-cell\",\"\",\"mat-sort-header\",\"\",4,\"matHeaderCellDef\"],[\"mat-cell\",\"\",4,\"matCellDef\"],[\"matColumnDef\",\"created_at\"],[\"matColumnDef\",\"last_activity\"],[\"matColumnDef\",\"note\"],[\"matColumnDef\",\"permissions\"],[\"matColumnDef\",\"actions\"],[\"mat-header-cell\",\"\",4,\"matHeaderCellDef\"],[\"mat-header-row\",\"\",4,\"matHeaderRowDef\"],[\"mat-row\",\"\",4,\"matRowDef\",\"matRowDefColumns\"],[\"showFirstLastButtons\",\"\",3,\"pageSizeOptions\"],[1,\"mat-h2\"],[1,\"d-flex-center\",3,\"formGroup\"],[\"appearance\",\"outline\",1,\"u-flex\",\"mt-3\"],[\"matInput\",\"\",\"formControlName\",\"emails\",\"cdkTextareaAutosize\",\"\",\"cdkAutosizeMinRows\",\"1\",\"cdkAutosizeMaxRows\",\"6\",\"required\",\"\"],[4,\"ngIf\"],[\"color\",\"primary\",\"title\",\"Un administrateur peut g\\xe9rer les utilisateurs (pour l'instant...)\",\"formControlName\",\"admin\",1,\"mx-3\"],[\"mat-raised-button\",\"\",\"color\",\"primary\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"aria-label\",\"Clear\",3,\"click\"],[\"mat-header-cell\",\"\",\"mat-sort-header\",\"\"],[\"mat-cell\",\"\"],[\"bgColor\",\"#1aaa55\",4,\"ngIf\"],[\"class\",\"ml-1\",\"bgColor\",\"#2d60eb\",4,\"ngIf\"],[\"bgColor\",\"#1aaa55\"],[\"bgColor\",\"#2d60eb\",1,\"ml-1\"],[\"matInput\",\"\",\"type\",\"text\",\"title\",\"Unit\\xe9\",3,\"ngModel\",\"ngModelChange\"],[\"color\",\"primary\",1,\"d-block\",3,\"ngModel\",\"ngModelChange\"],[\"mat-header-cell\",\"\"],[\"mat-icon-button\",\"\",\"title\",\"Envoyer un email d'invitation\",3,\"app-async-action\"],[\"mat-icon-button\",\"\",\"title\",\"G\\xe9n\\xe9rer un lien d'invitation\",3,\"app-async-action\"],[\"mat-icon-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer cet utilisateur\",3,\"click\",4,\"ngIf\"],[\"mat-icon-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer cet utilisateur\",3,\"click\"],[\"mat-header-row\",\"\"],[\"mat-row\",\"\"]],template:function(t,e){1&t&&(La(0,\"h1\",0),xl(1,\"Gestion des utilisateurs\"),Fa(),La(2,\"div\"),La(3,\"div\",1),La(4,\"mat-form-field\"),La(5,\"mat-label\"),xl(6,\"Filtre\"),Fa(),La(7,\"input\",2),Ga(\"ngModelChange\",function(t){return e.filterValue=t})(\"keyup\",function(t){return e.filterUsers(t.target.value)}),Fa(),oa(8,tJ,3,0,\"button\",3),Fa(),La(9,\"button\",4),xl(10,\"Rafraichir la liste\"),Fa(),Fa(),La(11,\"table\",5),Ba(12,6),oa(13,eJ,2,0,\"th\",7),oa(14,sJ,4,3,\"td\",8),za(),Ba(15,9),oa(16,rJ,2,0,\"th\",7),oa(17,oJ,3,4,\"td\",8),za(),Ba(18,10),oa(19,aJ,2,0,\"th\",7),oa(20,lJ,3,4,\"td\",8),za(),Ba(21,11),oa(22,cJ,2,0,\"th\",7),oa(23,hJ,3,1,\"td\",8),za(),Ba(24,12),oa(25,uJ,2,0,\"th\",7),oa(26,dJ,4,1,\"td\",8),za(),Ba(27,13),oa(28,pJ,1,0,\"th\",14),oa(29,mJ,8,3,\"td\",8),za(),oa(30,gJ,1,0,\"tr\",15),oa(31,AJ,1,0,\"tr\",16),Fa(),Na(32,\"mat-paginator\",17),Fa(),La(33,\"h2\",18),xl(34,\"Cr\\xe9ation de comptes utilisateur\"),Fa(),La(35,\"p\"),xl(36,\" Les utilisateurs cr\\xe9\\xe9s recevront un email avec un lien pour d\\xe9finir leur mot de passe. Vous pouvez copier du texte multi-lignes contenant des emails. Ces derniers seront extraits automatiquement.\\n\"),Fa(),La(37,\"form\",19),La(38,\"mat-form-field\",20),La(39,\"mat-label\"),xl(40,\"Email(s)\"),Fa(),Na(41,\"textarea\",21),oa(42,vJ,2,3,\"mat-hint\",22),oa(43,_J,2,0,\"mat-error\",22),Fa(),La(44,\"mat-checkbox\",23),xl(45,\"Administrateur\"),Fa(),La(46,\"button\",24),xl(47),Fa(),Fa()),2&t&&(Cr(7),Ra(\"ngModel\",e.filterValue),Cr(1),Ra(\"ngIf\",e.filterValue),Cr(1),Ra(\"app-async-action\",e.refreshList),Cr(2),Ra(\"dataSource\",e.usersDataSource),Cr(19),Ra(\"matHeaderRowDef\",e.displayedColumns),Cr(1),Ra(\"matRowDefColumns\",e.displayedColumns),Cr(1),Ra(\"pageSizeOptions\",eh(13,bJ)),Cr(5),Ra(\"formGroup\",e.createUserForm),Cr(5),Ra(\"ngIf\",e.extractedEmailsCount>0),Cr(1),Ra(\"ngIf\",e.createUserForm.get(\"emails\").touched&&e.createUserForm.get(\"emails\").hasError(\"missingEmails\")),Cr(3),Ra(\"app-async-action\",e.createUser)(\"disabled\",!e.createUserForm.valid),Cr(1),Cl(\"Cr\\xe9er \",e.extractedEmailsCount>1?\"les utilisateurs\":\"l'utilisateur\",\"\"))},directives:[AS,aS,ES,Gy,Sw,nx,Vd,Ly,Jq,TX,UQ,OX,PX,IX,LX,FX,II,sx,Cw,dx,yS,_x,Ex,hY,dS,uE,RX,YQ,DX,JQ,NX,BX,oS,eS],pipes:[ip],styles:[\".table[_ngcontent-%COMP%]{width:100%}.table[_ngcontent-%COMP%]     td.mat-cell{padding:0 4px!important;font-size:13px}.table[_ngcontent-%COMP%]     td.mat-cell:first-of-type{padding-left:24px!important}.table[_ngcontent-%COMP%]     td.mat-cell:last-of-type{padding-right:24px!important}\"]}),t})();function wJ(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"L'email est obligatoire\"),Fa())}function xJ(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"L'email doit \\xeatre valide\"),Fa())}function SJ(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"Le mot de passe est obligatoire\"),Fa())}const CJ=function(){return[\"/reset-password\"]};let kJ=(()=>{class t{constructor(t,e,i,n){this.formBuilder=t,this.router=e,this.authenticationService=i,this.uiService=n,this.login=()=>Hp(this,void 0,void 0,function*(){if(this.loginForm.valid)try{yield this.authenticationService.login(this.loginForm.value);const t=new URLSearchParams(window.location.search).get(\"redirect\");yield this.router.navigateByUrl(null!=t?t:\"/\")}catch(t){this.uiService.error(t.message)}})}ngOnInit(){return Hp(this,void 0,void 0,function*(){if(this.loginForm=this.formBuilder.group({email:[window.__anaisSettings.DEV_LOGINAUTOFILL_EMAIL||\"\",[Xy.required,Xy.email]],password:[window.__anaisSettings.DEV_LOGINAUTOFILL_PASSWORD||\"\",[Xy.required]]}),this.authenticationService.isAuthenticated()){const t=new URLSearchParams(window.location.search).get(\"redirect\");yield this.router.navigateByUrl(null!=t?t:\"/\")}else null!==new URLSearchParams(window.location.search).get(\"expired\")&&this.uiService.error(\"Votre session a expir\\xe9. Veuillez vous authentifier \\xe0 nouveau.\")})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Lx),Oa(pL),Oa(rH),Oa(_H))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-login-page\"]],decls:23,vars:7,consts:[[1,\"unauthenticated-page\",\"mat-typography\"],[\"novalidate\",\"\",1,\"unauthenticated-page__form\",3,\"formGroup\"],[\"src\",\"./assets/images/logo_anais.png\",\"alt\",\"Logo ANAIS\",1,\"login-page__logo\"],[\"matPrefix\",\"\",1,\"login-page__prefix-icon\"],[\"type\",\"email\",\"matInput\",\"\",\"placeholder\",\"utilisateur@exemple.com\",\"formControlName\",\"email\",\"required\",\"\"],[4,\"ngIf\"],[\"type\",\"password\",\"matInput\",\"\",\"color\",\"white\",\"placeholder\",\"******\",\"formControlName\",\"password\",\"required\",\"\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",1,\"login-page__login-btn\",3,\"app-async-action\"],[\"mat-button\",\"\",1,\"mt-3\",\"login-page__reset-password-button\",3,\"routerLink\"],[\"src\",\"./assets/images/logo_fabnum.png\",\"alt\",\"Logo Fabrique num\\xe9rique\",1,\"login-page__fabnumlogo\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"form\",1),Na(2,\"img\",2),La(3,\"mat-form-field\"),La(4,\"mat-label\"),xl(5,\"Email\"),Fa(),La(6,\"mat-icon\",3),xl(7,\"perm_identity\"),Fa(),Na(8,\"input\",4),oa(9,wJ,2,0,\"mat-error\",5),oa(10,xJ,2,0,\"mat-error\",5),Fa(),La(11,\"mat-form-field\"),La(12,\"mat-label\"),xl(13,\"Mot de passe\"),Fa(),La(14,\"mat-icon\",3),xl(15,\"lock\"),Fa(),Na(16,\"input\",6),oa(17,SJ,2,0,\"mat-error\",5),Fa(),La(18,\"button\",7),xl(19,\"Se connecter\"),Fa(),La(20,\"button\",8),xl(21,\" J'ai perdu mon mot de passe \"),Fa(),Fa(),Na(22,\"img\",9),Fa()),2&t&&(Cr(1),Ra(\"formGroup\",e.loginForm),Cr(8),Ra(\"ngIf\",e.loginForm.get(\"email\").hasError(\"required\")),Cr(1),Ra(\"ngIf\",e.loginForm.get(\"email\").hasError(\"email\")),Cr(7),Ra(\"ngIf\",e.loginForm.get(\"password\").hasError(\"required\")),Cr(1),Ra(\"app-async-action\",e.login),Cr(2),Ra(\"routerLink\",eh(6,CJ)))},directives:[sx,Cw,dx,AS,aS,uE,hS,ES,Gy,Sw,_x,Ex,Vd,Ly,Jq,mL,eS],styles:[\".login-page__login-btn[_ngcontent-%COMP%]{margin-top:2em;background-color:#fff!important}.login-page__login-btn[_ngcontent-%COMP%]:hover     .mat-button-focus-overlay{opacity:.18}.login-page__logo[_ngcontent-%COMP%]{width:350px;max-height:83px;margin-bottom:3em}.login-page__fabnumlogo[_ngcontent-%COMP%]{margin-top:3em;width:200px;max-height:86px}.login-page__prefix-icon[_ngcontent-%COMP%]{margin-right:.5em}.login-page__reset-password-button[_ngcontent-%COMP%]{color:#fff;font-weight:300;line-height:2em;height:2em}\",\"[_nghost-%COMP%]{flex:1}.unauthenticated-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:auto;background-image:url(/assets/images/login_background.jpg);background-size:cover;background-position:70% 50%}.unauthenticated-page__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:300px;color:#fff;background-color:rgba(0,55,146,.95);padding:2.5em 2.5em 1em;border-radius:2em;box-shadow:0 16px 24px 2px rgba(0,55,146,.64),0 6px 30px 5px rgba(0,55,146,.62)}.unauthenticated-page__form[_ngcontent-%COMP%]     .mat-form-field-label{color:#fff}\"]}),t})(),EJ=(()=>{class t extends Gq{constructor(t,e){super(),this.router=t,this.workerService=e}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.subscriptions.push(this.workerService.applicationHealth$.pipe(kf(1)).subscribe(t=>Hp(this,void 0,void 0,function*(){var e;(null===(e=null==t?void 0:t.maintenance)||void 0===e?void 0:e.type)!==wK.InProgress&&(yield this.router.navigateByUrl(\"/\"))}))),yield this.workerService.application.refreshHealthState()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(pL),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-maintenance-wall-page\"]],features:[Uo],decls:4,vars:0,consts:[[1,\"unauthenticated-page\",\"mat-typography\"],[1,\"unauthenticated-page__form\"],[1,\"maintenance-page__title\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"h3\",2),xl(3,\"Maintenance en cours\"),Fa(),Fa(),Fa())},styles:[\".maintenance-page__title[_ngcontent-%COMP%]{font-weight:bold;font-size:2.5em}\",\"[_nghost-%COMP%]{flex:1}.unauthenticated-page[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:auto;background-image:url(/assets/images/login_background.jpg);background-size:cover;background-position:70% 50%}.unauthenticated-page__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;min-width:300px;color:#fff;background-color:rgba(0,55,146,.95);padding:2.5em 2.5em 1em;border-radius:2em;box-shadow:0 16px 24px 2px rgba(0,55,146,.64),0 6px 30px 5px rgba(0,55,146,.62)}.unauthenticated-page__form[_ngcontent-%COMP%]     .mat-form-field-label{color:#fff}\"]}),t})(),MJ=(()=>{class t{ngOnChanges(t){var e;t.flag&&(this.country=kq(null===(e=t.flag.currentValue)||void 0===e?void 0:e.toLowerCase())),t.mmsi&&(this.country=function(t){return kq(Eq[t.substr(0,3)])}(`${t.mmsi.currentValue}`))}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-flag\"]],inputs:{mmsi:\"mmsi\",flag:\"flag\",iso3:\"iso3\"},features:[he],decls:1,vars:2,consts:[[3,\"className\",\"title\"]],template:function(t,e){1&t&&Na(0,\"span\",0),2&t&&Ra(\"className\",\"fi fi-\"+e.country.flag)(\"title\",e.country.name)},styles:[\"[_nghost-%COMP%]{display:inline-flex;font-size:1.5em}\"],changeDetection:0}),t})();const TJ=function(t){return{transform:t}};function IJ(t,e){if(1&t&&(xl(0),La(1,\"mat-icon\",8),xl(2,\"arrow_right_alt\"),Fa()),2&t){const t=Ka(2);Cl(\" \",t.aircraft.track,\"\\xb0 \"),Cr(1),Ra(\"ngStyle\",ih(2,TJ,\"rotate(\"+(t.aircraft.track-90)+\"deg)\"))}}function PJ(t,e){1&t&&xl(0,\" ? \")}function OJ(t,e){if(1&t&&(Na(0,\"mat-divider\"),La(1,\"div\",0),La(2,\"div\",1),La(3,\"div\",2),xl(4,\"Squawk\"),Fa(),La(5,\"strong\"),xl(6),Fa(),Fa(),Na(7,\"mat-divider\",3),La(8,\"div\",1),La(9,\"div\",2),xl(10,\"Vitesse / Cap\"),Fa(),La(11,\"strong\",5),xl(12),oa(13,IJ,3,4,\"ng-template\",6),oa(14,PJ,1,0,\"ng-template\",null,7,Lh),Fa(),Fa(),Na(16,\"mat-divider\",3),La(17,\"div\",1),La(18,\"div\",2),xl(19,\"Destination\"),Fa(),La(20,\"strong\"),xl(21),Fa(),Fa(),Fa()),2&t){const t=aa(15),e=Ka();Cr(6),Cl(\" \",e.aircraft.squawk||\"?\",\" \"),Cr(1),Ra(\"vertical\",!0),Cr(5),Cl(\" \",e.aircraft.speed?e.aircraft.speed+\" kt\":\"?\",\" / \"),Cr(1),Ra(\"ngIf\",e.aircraft.track)(\"ngIfElse\",t),Cr(3),Ra(\"vertical\",!0),Cr(5),kl(\" \",e.aircraft.fromIcao||\"?\",\" \\u2192 \",e.aircraft.toIcao||\"?\",\" \")}}function RJ(t,e){if(1&t&&(Na(0,\"mat-divider\"),La(1,\"div\",0),La(2,\"div\",1),La(3,\"div\",9),xl(4,\"VSI\"),Fa(),La(5,\"strong\"),xl(6),Fa(),Fa(),Na(7,\"mat-divider\",3),La(8,\"div\",1),La(9,\"div\",2),xl(10,\"Propri\\xe9taire\"),Fa(),La(11,\"strong\"),xl(12),Fa(),Fa(),Fa(),Na(13,\"mat-divider\"),La(14,\"div\",0),La(15,\"div\",1),La(16,\"div\",2),xl(17,\"Providers\"),Fa(),La(18,\"strong\"),xl(19),Fa(),Fa(),Fa()),2&t){const t=Ka();Cr(6),Cl(\"\",t.aircraft.vsi?t.aircraft.vsi:\"?\",\" \"),Cr(1),Ra(\"vertical\",!0),Cr(5),Cl(\"\",t.aircraft.registeredOwners||\"?\",\" \"),Cr(7),Sl((null==t.aircraft||null==t.aircraft.providers?null:t.aircraft.providers.length)>0?null==t.aircraft?null:t.aircraft.providers.join(\", \"):\"?\")}}let DJ=(()=>{class t extends Gq{constructor(t){super(),this.mapStateConfig=t,this.positionInput=null,this.full=!1,this.extensive=!1,this.position=null,this.stringPosition=\"\"}ngOnInit(){this.ensureMandatoryInputParams(\"aircraft\")}ngOnChanges(t){t.positionInput&&(this.position=this.positionInput),t.aircraft&&!this.positionInput&&(this.position=this.aircraft),this.stringPosition=this.mapStateConfig.coordinateSystem$.value.format([this.position.lon,this.position.lat])}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Fq))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-aircraft-infos\"]],inputs:{aircraft:\"aircraft\",positionInput:[\"position\",\"positionInput\"],full:\"full\",extensive:\"extensive\"},features:[Uo,he],decls:33,vars:10,consts:[[1,\"aircraft-infos__row\"],[1,\"aircraft-infos__info-cell\"],[1,\"aircraft-infos__info-label\"],[3,\"vertical\"],[3,\"ngIf\"],[1,\"d-flex-center\"],[3,\"ngIf\",\"ngIfElse\"],[\"unknown\",\"\"],[1,\"aircraft-infos__course-icon\",3,\"ngStyle\"],[\"title\",\"Vertical Speed Indicator\",1,\"aircraft-infos__info-label\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"div\",2),xl(3,\"ICAO\"),Fa(),La(4,\"strong\"),xl(5),Fa(),Fa(),Na(6,\"mat-divider\",3),La(7,\"div\",1),La(8,\"div\",2),xl(9,\"Callsign\"),Fa(),La(10,\"strong\"),xl(11),Fa(),Fa(),Na(12,\"mat-divider\",3),La(13,\"div\",1),La(14,\"div\",2),xl(15,\"Registration\"),Fa(),La(16,\"strong\"),xl(17),Fa(),Fa(),Fa(),oa(18,OJ,22,8,\"ng-template\",4),Na(19,\"mat-divider\"),La(20,\"div\",0),La(21,\"div\",1),La(22,\"div\",2),xl(23,\"Altitude\"),Fa(),La(24,\"strong\"),xl(25),Fa(),Fa(),Na(26,\"mat-divider\",3),La(27,\"div\",1),La(28,\"div\",2),xl(29,\"Position\"),Fa(),La(30,\"strong\"),xl(31),Fa(),Fa(),Fa(),oa(32,RJ,20,4,\"ng-template\",4)),2&t&&(Cr(5),Sl(e.aircraft.icao),Cr(1),Ra(\"vertical\",!0),Cr(5),Sl(e.aircraft.callsign||\"?\"),Cr(1),Ra(\"vertical\",!0),Cr(5),Sl(e.aircraft.registration||\"?\"),Cr(1),Ra(\"ngIf\",e.full||e.extensive),Cr(7),Sl(e.position.altitude?e.position.altitude+\" ft\":\"?\"),Cr(1),Ra(\"vertical\",!0),Cr(5),Sl(e.stringPosition),Cr(1),Ra(\"ngIf\",e.full))},directives:[Xq,Vd,uE,qd],styles:['.aircraft-infos[_ngcontent-%COMP%]{background-color:#e7ecf0;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.2);border-radius:2px}.aircraft-infos[_ngcontent-%COMP%]:after{content:\" \";position:absolute;top:100%;left:50%;margin-left:-12px;border-width:12px;border-style:solid;border-color:#cdd1d4 transparent transparent transparent}.aircraft-infos__header[_ngcontent-%COMP%]{background-color:#cdd1d4;display:flex}.aircraft-infos__link[_ngcontent-%COMP%]{flex:1;padding:0;line-height:inherit;text-align:inherit;font-size:inherit;font-weight:inherit}.aircraft-infos__link[_ngcontent-%COMP%]     .mat-button-wrapper{display:flex}.aircraft-infos__flag[_ngcontent-%COMP%]{margin:5px}.aircraft-infos__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px 0;flex:1}.aircraft-infos__name[_ngcontent-%COMP%]{font-size:1.2em}.aircraft-infos__type[_ngcontent-%COMP%]{font-size:.9em;color:#555}.aircraft-infos__row[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;font-size:.9em}.aircraft-infos__info-cell[_ngcontent-%COMP%]{padding:.4em;text-align:center}.aircraft-infos__info-label[_ngcontent-%COMP%]{color:gray;font-weight:500;padding-bottom:.2em}.aircraft-infos__course-icon[_ngcontent-%COMP%]{line-height:.7em;height:.7em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.aircraft-infos__footer[_ngcontent-%COMP%]{background-color:#cdd1d4;padding-left:.4em;display:flex;align-items:center;font-size:.85em;line-height:36px}.aircraft-infos__signal-label[_ngcontent-%COMP%]{font-weight:500;color:#595959}'],changeDetection:0}),t})();function LJ(t,e){1&t&&Na(0,\"div\",3)}function FJ(t,e){if(1&t&&(La(0,\"a\",19),La(1,\"img\",20),Ga(\"load\",function(t){return t.target.style.display=\"block\"})(\"error\",function(t){return t.target.remove()}),Fa(),Fa()),2&t){const t=Ka(2);Ra(\"href\",t.aircraft.photoLink,Ss),Cr(1),Ra(\"src\",t.aircraft.photoURL,Ss)}}function NJ(t,e){1&t&&(La(0,\"a\",21),Na(1,\"img\",22),Fa()),2&t&&el(\"href\",\"https://www.flightradar24.com/\",Ka(2).aircraft.callsign,\"\",Ss)}function BJ(t,e){if(1&t){const t=$a();La(0,\"div\",4),La(1,\"div\",5),Na(2,\"app-flag\",6),La(3,\"div\",7),La(4,\"div\",8),xl(5),Fa(),La(6,\"small\",9),xl(7),Fa(),Fa(),Fa(),La(8,\"div\",10),xl(9,\"R\\xe9ception : \"),La(10,\"span\",11),ch(11,\"timeago\"),xl(12),ch(13,\"date\"),Fa(),Fa(),Fa(),oa(14,FJ,2,2,\"a\",12),ch(15,\"async\"),La(16,\"div\",5),La(17,\"button\",13),Ga(\"click\",function(){return Fe(t),Ka().locateAircraft()})(\"dblclick\",function(){return Fe(t),Ka().locateAndZoomToAircraft()}),La(18,\"mat-icon\"),xl(19,\"center_focus_strong\"),Fa(),Fa(),La(20,\"a\",14),Na(21,\"img\",15),Fa(),oa(22,NJ,2,1,\"a\",16),La(23,\"button\",17),Ga(\"click\",function(){return Fe(t),Ka().openExportDataDialog()}),La(24,\"mat-icon\"),xl(25,\"file_download\"),Fa(),Fa(),Fa(),Na(26,\"mat-divider\"),Na(27,\"app-aircraft-infos\",18)}if(2&t){const t=Ka();Cr(2),Ra(\"flag\",t.aircraft.country.flag),Cr(3),Sl(t.aircraft.callsign||\"?\"),Cr(2),Sl(t.aircraft.type||\"?\"),Cr(3),tl(\"title\",hh(11,10,1e3*t.aircraft.timestamp)),Cr(2),Sl(dh(13,12,1e3*t.aircraft.timestamp,\"yyyy-MM-dd HH:mm:ss z\",t.mapConfigService.useUTCDates$.value&&\"+00\")),Cr(2),Ra(\"ngIf\",hh(15,16,t.aircraft.photoURL&&t.mapConfigService.showMarineTrafficPhotos$)),Cr(6),el(\"href\",\"https://globe.adsbexchange.com/?icao=\",t.aircraft.icao,\"\",Ss),Cr(2),Ra(\"ngIf\",t.aircraft.callsign),Cr(5),Ra(\"aircraft\",t.aircraft)(\"full\",!0)}}let zJ=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o,a,l,c,h){super(),this.activatedRoute=t,this.changeDetectorRef=e,this.titleService=i,this.router=n,this.configService=s,this.exportService=r,this.interactionsService=o,this.mapService=a,this.mapConfigService=l,this.selectionService=c,this.uiService=h,this.loading=!1,this.aircraft=null}ngOnInit(){this.subscriptions.push(this.selectionService.openEntity$.pipe(kf(1),Af(t=>t.type===NH.Aircraft&&t.id===this.icao)).subscribe(t=>Hp(this,void 0,void 0,function*(){if(t.error){this.loading=!1,this.uiService.error(`L'a\\xe9ronef ${this.icao} est inconnu. Il a pu atterrir ou son signal n'est plus capt\\xe9 depuis plus de 5 minutes.`);const t=QH(this.router);return t?yield this.router.navigateByUrl(t):this.mapService.hasBooted$.value?yield this.router.navigateByUrl(`/${this.mapService.view$.value.toURL()}`):yield this.router.navigateByUrl(\"/\"),void this.changeDetectorRef.markForCheck()}if(!t.entity)return;this.loading=!1;const e=t.entity;this.mapService.hasBooted$.value||this.mapService.locate([e.lon,e.lat]),this.titleService.setTitle(`A\\xe9ronef ${e.callsign||\"?\"} / ${e.icao} - ANAIS`),this.aircraft=e,this.changeDetectorRef.markForCheck()})),this.activatedRoute.paramMap.subscribe(t=>{this.loading=!0,this.icao=t.get(\"icao\"),this.selectionService.openEntity(NH.Aircraft,this.icao),this.changeDetectorRef.markForCheck()}))}ngOnDestroy(){super.ngOnDestroy(),this.selectionService.closeOpenEntity()}locateAircraft(){this.mapService.centerOnLonLat([this.aircraft.lon,this.aircraft.lat])}locateAndZoomToAircraft(){this.mapService.locate([this.aircraft.lon,this.aircraft.lat])}openExportDataDialog(){this.exportService.openExportDataDialog({icaos:[this.icao],label:`de l'a\\xe9ronef ${this.aircraft.callsign||\"?\"} / ${this.aircraft.icao}`})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(GR),Oa(Mc),Oa(jp),Oa(pL),Oa(WU),Oa(CY),Oa(DY),Oa(Pj),Oa(qU),Oa(IY),Oa(_H))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-aircraft-details-panel\"]],features:[Uo],decls:3,vars:2,consts:[[1,\"panel\",\"aircraft-details-panel\"],[\"class\",\"loader\",4,\"ngIf\"],[3,\"ngIf\"],[1,\"loader\"],[1,\"panel__header\",\"d-flex-column\"],[1,\"d-flex\"],[1,\"ma-1\",3,\"flag\"],[1,\"ma-1\",\"u-flex\"],[1,\"aircraft-details-panel__name\"],[1,\"aircraft-details-panel__type\"],[1,\"aircraft-details-panel__reception\"],[3,\"title\"],[\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",\"title\",\"Voir la photo\",3,\"href\",4,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Centrer la vue sur l'a\\xe9ronef\",1,\"aircraft-details-panel__action\",3,\"click\",\"dblclick\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la page ADSB Exchange\",\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",1,\"aircraft-details-panel__action\",3,\"href\"],[\"src\",\"/assets/images/adsbexchange-icon.png\",\"width\",\"20\",\"alt\",\"ADSB Exchange\"],[\"mat-button\",\"\",\"class\",\"aircraft-details-panel__action\",\"title\",\"Ouvrir la page Flightradar24\",\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",3,\"href\",4,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Exporter les donn\\xe9es de l'a\\xe9ronef au format CSV\",1,\"aircraft-details-panel__action\",3,\"click\"],[1,\"aircraft-details-panel__infos\",3,\"aircraft\",\"full\"],[\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",\"title\",\"Voir la photo\",3,\"href\"],[\"referrerpolicy\",\"no-referrer\",1,\"d-block\",2,\"display\",\"none\",3,\"src\",\"load\",\"error\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la page Flightradar24\",\"target\",\"_blank\",\"rel\",\"noopener\",\"referrerpolicy\",\"no-referrer\",1,\"aircraft-details-panel__action\",3,\"href\"],[\"src\",\"/assets/images/flightradar24-icon.png\",\"width\",\"20\",\"alt\",\"Flightradar24\"]],template:function(t,e){1&t&&(La(0,\"div\",0),oa(1,LJ,1,0,\"div\",1),oa(2,BJ,28,18,\"ng-template\",2),Fa()),2&t&&(Cr(1),Ra(\"ngIf\",e.loading),Cr(1),Ra(\"ngIf\",!e.loading&&e.aircraft))},directives:[Vd,MJ,Ly,uE,Fy,Xq,DJ],pipes:[$F,ip,tp],styles:[\".aircraft-details-panel[_ngcontent-%COMP%]{max-width:310px}.aircraft-details-panel__name[_ngcontent-%COMP%]{font-size:1.4em;font-weight:500}.aircraft-details-panel__type[_ngcontent-%COMP%]{font-size:.9em;color:#432e2e}.aircraft-details-panel__reception[_ngcontent-%COMP%]{font-size:14px;padding-left:.5em;padding-right:.5em;padding-bottom:.5em}.aircraft-details-panel__action[_ngcontent-%COMP%]{flex:1;min-width:inherit}.aircraft-details-panel__infos[_ngcontent-%COMP%]{font-size:.9em}.aircraft-details-panel__section[_ngcontent-%COMP%]{margin-top:.4em}.aircraft-details-panel__section--nopadding[_ngcontent-%COMP%]   .mat-expansion-panel-body[_ngcontent-%COMP%]{padding:0}.aircraft-details-panel__section-row[_ngcontent-%COMP%]{display:flex}.aircraft-details-panel__subheader[_ngcontent-%COMP%]{background-color:#abb8cb}.aircraft-details-panel__subheader[_ngcontent-%COMP%]:focus, .aircraft-details-panel__subheader[_ngcontent-%COMP%]:hover{background-color:#bbc5d5!important}.aircraft-details-panel__label[_ngcontent-%COMP%]{font-weight:300}\"],changeDetection:0}),t})();function VJ(t){return[[\"timestamp\",\"rule_name\",\"mmsi\",\"ship_name\",\"lon\",\"lat\",\"hdms\"].join(\",\"),...t.map(t=>function(t){return[wq(1e3*t.start),_U(t.rule_name),t.mmsi,_U(t.ship_name),t.lon,t.lat,j$([t.lon,t.lat])]}(t).join(\",\"))].join(\"\\n\")}let $J=(()=>{class t{constructor(t,e,i){this.drawingService=t,this.zonesLayerService=e,this.zonesService=i,this.editedZone$=new Jp(null),this.tooManyHexagons$=new Jp(!1),this.editedZone$.subscribe(t=>{this.tooManyHexagons$.next(t&&t.h3indexes.length>130)})}clear(){this.editedZone$.next(null)}startEditing(t){this.editedZone$.next(t),this.zonesLayerService.clear(),this.drawingSubscription=this.drawingService.editZone(t.h3indexes).subscribe(t=>{this.updateZoneH3Indexes(t),this.zonesLayerService.updateZones([{name:\"\",h3indexes:this.editedZone$.value.h3indexes}])})}updateZoneName(t){this.editedZone$.value.name=t,this.editedZone$.next(this.editedZone$.value)}updateZoneH3Indexes(t){this.editedZone$.value.h3indexes=t,this.editedZone$.next(this.editedZone$.value)}saveEditedZone(){return Hp(this,void 0,void 0,function*(){const t=this.editedZone$.value;if(!t.name||0===t.h3indexes.length)throw new Error(\"La zone est incompl\\xe8te\");if(t.h3indexes.length>130)throw new Error(`La zone contient trop d'hexagones : ${t.h3indexes.length} / 130 maximum`);return t.id?yield this.zonesService.updateZone(t):t.id=yield this.zonesService.createZone(t),this.cancelEditing(),t})}cancelEditing(){this.drawingSubscription&&this.drawingSubscription.unsubscribe(),this.editedZone$.next(null),this.drawingService.stopEditingZone()}}return t.\\u0275fac=function(e){return new(e||t)(Mn(zH),Mn(LY),Mn(OH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function UJ(t,e){if(1&t&&(hi(),Na(0,\"circle\",3)),2&t){const t=Ka();cl(\"animation-name\",\"mat-progress-spinner-stroke-rotate-\"+t._spinnerAnimationLabel)(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ia(\"r\",t._getCircleRadius())}}function jJ(t,e){if(1&t&&(hi(),Na(0,\"circle\",3)),2&t){const t=Ka();cl(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ia(\"r\",t._getCircleRadius())}}function HJ(t,e){if(1&t&&(hi(),Na(0,\"circle\",3)),2&t){const t=Ka();cl(\"animation-name\",\"mat-progress-spinner-stroke-rotate-\"+t._spinnerAnimationLabel)(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ia(\"r\",t._getCircleRadius())}}function GJ(t,e){if(1&t&&(hi(),Na(0,\"circle\",3)),2&t){const t=Ka();cl(\"stroke-dashoffset\",t._getStrokeDashOffset(),\"px\")(\"stroke-dasharray\",t._getStrokeCircumference(),\"px\")(\"stroke-width\",t._getCircleStrokeWidth(),\"%\"),ia(\"r\",t._getCircleRadius())}}const WJ=\".mat-progress-spinner{display:block;position:relative;overflow:hidden}.mat-progress-spinner svg{position:absolute;transform:rotate(-90deg);top:0;left:0;transform-origin:center;overflow:visible}.mat-progress-spinner circle{fill:transparent;transform-origin:center;transition:stroke-dashoffset 225ms linear}._mat-animation-noopable.mat-progress-spinner circle{transition:none;animation:none}.cdk-high-contrast-active .mat-progress-spinner circle{stroke:currentColor;stroke:CanvasText}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] svg{animation:mat-progress-spinner-linear-rotate 2000ms linear infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] svg{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition-property:stroke;animation-duration:4000ms;animation-timing-function:cubic-bezier(0.35, 0, 0.25, 1);animation-iteration-count:infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-animation[mode=indeterminate] circle{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] svg{animation:mat-progress-spinner-stroke-rotate-fallback 10000ms cubic-bezier(0.87, 0.03, 0.33, 1) infinite}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] svg{transition:none;animation:none}.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition-property:stroke}._mat-animation-noopable.mat-progress-spinner.mat-progress-spinner-indeterminate-fallback-animation[mode=indeterminate] circle{transition:none;animation:none}@keyframes mat-progress-spinner-linear-rotate{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes mat-progress-spinner-stroke-rotate-100{0%{stroke-dashoffset:268.606171575px;transform:rotate(0)}12.5%{stroke-dashoffset:56.5486677px;transform:rotate(0)}12.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(72.5deg)}25%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(72.5deg)}25.0001%{stroke-dashoffset:268.606171575px;transform:rotate(270deg)}37.5%{stroke-dashoffset:56.5486677px;transform:rotate(270deg)}37.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(161.5deg)}50%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(161.5deg)}50.0001%{stroke-dashoffset:268.606171575px;transform:rotate(180deg)}62.5%{stroke-dashoffset:56.5486677px;transform:rotate(180deg)}62.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(251.5deg)}75%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(251.5deg)}75.0001%{stroke-dashoffset:268.606171575px;transform:rotate(90deg)}87.5%{stroke-dashoffset:56.5486677px;transform:rotate(90deg)}87.5001%{stroke-dashoffset:56.5486677px;transform:rotateX(180deg) rotate(341.5deg)}100%{stroke-dashoffset:268.606171575px;transform:rotateX(180deg) rotate(341.5deg)}}@keyframes mat-progress-spinner-stroke-rotate-fallback{0%{transform:rotate(0deg)}25%{transform:rotate(1170deg)}50%{transform:rotate(2340deg)}75%{transform:rotate(3510deg)}100%{transform:rotate(4680deg)}}\\n\",qJ=Bb(class{constructor(t){this._elementRef=t}},\"primary\"),YJ=new Ji(\"mat-progress-spinner-default-options\",{providedIn:\"root\",factory:function(){return{diameter:100}}});class ZJ extends qJ{constructor(t,e,i,n,s){super(t),this._document=i,this._diameter=100,this._value=0,this._fallbackAnimation=!1,this.mode=\"determinate\";const r=ZJ._diameters;this._spinnerAnimationLabel=this._getSpinnerAnimationLabel(),r.has(i.head)||r.set(i.head,new Set([100])),this._fallbackAnimation=e.EDGE||e.TRIDENT,this._noopAnimations=\"NoopAnimations\"===n&&!!s&&!s._forceAnimations,s&&(s.diameter&&(this.diameter=s.diameter),s.strokeWidth&&(this.strokeWidth=s.strokeWidth))}get diameter(){return this._diameter}set diameter(t){this._diameter=Ff(t),this._spinnerAnimationLabel=this._getSpinnerAnimationLabel(),!this._fallbackAnimation&&this._styleRoot&&this._attachStyleNode()}get strokeWidth(){return this._strokeWidth||this.diameter/10}set strokeWidth(t){this._strokeWidth=Ff(t)}get value(){return\"determinate\"===this.mode?this._value:0}set value(t){this._value=Math.max(0,Math.min(100,Ff(t)))}ngOnInit(){const t=this._elementRef.nativeElement;this._styleRoot=em(t)||this._document.head,this._attachStyleNode(),t.classList.add(`mat-progress-spinner-indeterminate${this._fallbackAnimation?\"-fallback\":\"\"}-animation`)}_getCircleRadius(){return(this.diameter-10)/2}_getViewBox(){const t=2*this._getCircleRadius()+this.strokeWidth;return`0 0 ${t} ${t}`}_getStrokeCircumference(){return 2*Math.PI*this._getCircleRadius()}_getStrokeDashOffset(){return\"determinate\"===this.mode?this._getStrokeCircumference()*(100-this._value)/100:this._fallbackAnimation&&\"indeterminate\"===this.mode?.2*this._getStrokeCircumference():null}_getCircleStrokeWidth(){return this.strokeWidth/this.diameter*100}_attachStyleNode(){const t=this._styleRoot,e=this._diameter,i=ZJ._diameters;let n=i.get(t);if(!n||!n.has(e)){const s=this._document.createElement(\"style\");s.setAttribute(\"mat-spinner-animation\",this._spinnerAnimationLabel),s.textContent=this._getAnimationText(),t.appendChild(s),n||(n=new Set,i.set(t,n)),n.add(e)}}_getAnimationText(){const t=this._getStrokeCircumference();return\"\\n @keyframes mat-progress-spinner-stroke-rotate-DIAMETER {\\n    0%      { stroke-dashoffset: START_VALUE;  transform: rotate(0); }\\n    12.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(0); }\\n    12.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(72.5deg); }\\n    25%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(72.5deg); }\\n\\n    25.0001%   { stroke-dashoffset: START_VALUE;  transform: rotate(270deg); }\\n    37.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(270deg); }\\n    37.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(161.5deg); }\\n    50%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(161.5deg); }\\n\\n    50.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(180deg); }\\n    62.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(180deg); }\\n    62.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(251.5deg); }\\n    75%     { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(251.5deg); }\\n\\n    75.0001%  { stroke-dashoffset: START_VALUE;  transform: rotate(90deg); }\\n    87.5%   { stroke-dashoffset: END_VALUE;    transform: rotate(90deg); }\\n    87.5001%  { stroke-dashoffset: END_VALUE;    transform: rotateX(180deg) rotate(341.5deg); }\\n    100%    { stroke-dashoffset: START_VALUE;  transform: rotateX(180deg) rotate(341.5deg); }\\n  }\\n\".replace(/START_VALUE/g,\"\"+.95*t).replace(/END_VALUE/g,\"\"+.2*t).replace(/DIAMETER/g,`${this._spinnerAnimationLabel}`)}_getSpinnerAnimationLabel(){return this.diameter.toString().replace(\".\",\"_\")}}ZJ.\\u0275fac=function(t){return new(t||ZJ)(Oa(ic),Oa(Hf),Oa(Fu,8),Oa(wb,8),Oa(YJ))},ZJ.\\u0275cmp=Gt({type:ZJ,selectors:[[\"mat-progress-spinner\"]],hostAttrs:[\"role\",\"progressbar\",\"tabindex\",\"-1\",1,\"mat-progress-spinner\"],hostVars:10,hostBindings:function(t,e){2&t&&(ia(\"aria-valuemin\",\"determinate\"===e.mode?0:null)(\"aria-valuemax\",\"determinate\"===e.mode?100:null)(\"aria-valuenow\",\"determinate\"===e.mode?e.value:null)(\"mode\",e.mode),cl(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),hl(\"_mat-animation-noopable\",e._noopAnimations))},inputs:{color:\"color\",mode:\"mode\",diameter:\"diameter\",strokeWidth:\"strokeWidth\",value:\"value\"},exportAs:[\"matProgressSpinner\"],features:[Uo],decls:3,vars:8,consts:[[\"preserveAspectRatio\",\"xMidYMid meet\",\"focusable\",\"false\",\"aria-hidden\",\"true\",3,\"ngSwitch\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"animation-name\",\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\"]],template:function(t,e){1&t&&(hi(),La(0,\"svg\",0),oa(1,UJ,1,9,\"circle\",1),oa(2,jJ,1,7,\"circle\",2),Fa()),2&t&&(cl(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),Ra(\"ngSwitch\",\"indeterminate\"===e.mode),ia(\"viewBox\",e._getViewBox()),Cr(1),Ra(\"ngSwitchCase\",!0),Cr(1),Ra(\"ngSwitchCase\",!1))},directives:[Hd,Gd],styles:[WJ],encapsulation:2,changeDetection:0}),ZJ._diameters=new WeakMap;let KJ=(()=>{class t extends ZJ{constructor(t,e,i,n,s){super(t,e,i,n,s),this.mode=\"indeterminate\"}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Hf),Oa(Fu,8),Oa(wb,8),Oa(YJ))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-spinner\"]],hostAttrs:[\"role\",\"progressbar\",\"mode\",\"indeterminate\",1,\"mat-spinner\",\"mat-progress-spinner\"],hostVars:6,hostBindings:function(t,e){2&t&&(cl(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),hl(\"_mat-animation-noopable\",e._noopAnimations))},inputs:{color:\"color\"},features:[Uo],decls:3,vars:8,consts:[[\"preserveAspectRatio\",\"xMidYMid meet\",\"focusable\",\"false\",\"aria-hidden\",\"true\",3,\"ngSwitch\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"animation-name\",\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\",3,\"stroke-dashoffset\",\"stroke-dasharray\",\"stroke-width\",4,\"ngSwitchCase\"],[\"cx\",\"50%\",\"cy\",\"50%\"]],template:function(t,e){1&t&&(hi(),La(0,\"svg\",0),oa(1,HJ,1,9,\"circle\",1),oa(2,GJ,1,7,\"circle\",2),Fa()),2&t&&(cl(\"width\",e.diameter,\"px\")(\"height\",e.diameter,\"px\"),Ra(\"ngSwitch\",\"indeterminate\"===e.mode),ia(\"viewBox\",e._getViewBox()),Cr(1),Ra(\"ngSwitchCase\",!0),Cr(1),Ra(\"ngSwitchCase\",!1))},directives:[Hd,Gd],styles:[WJ],encapsulation:2,changeDetection:0}),t})(),XJ=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[Fb,np],Fb]}),t})(),QJ=(()=>{class t{validate(t){return(t=>{var e;const i=t.get(\"aisInterruption\"),n=t.get(\"transhipment\"),s=t.get(\"erraticRoute\"),r=t.get(\"speed\"),o=t.get(\"passageInZone\"),a=t.get(\"spoofing\"),l=t.get(\"zone\");if(!(i&&n&&s&&r&&o&&a))return null;const c=[i,n,s,r,o,a];if(c.some(t=>!t.value))return null;const h={};return c.every(t=>!t.value.enable)&&(h.missingCriterion=!0),(null===(e=l.value)||void 0===e?void 0:e.zones.length)>0||(h.missingZone=!0),h})(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"appAlertRule\",\"\"]],features:[Yl([{provide:Yy,useExisting:t,multi:!0}])]}),t})();const JJ=[\"*\"],t0=new Ji(\"MatChipRemove\"),e0=new Ji(\"MatChipAvatar\"),i0=new Ji(\"MatChipTrailingIcon\");class n0{constructor(t){this._elementRef=t}}const s0=Vb(Bb(zb(n0),\"primary\"),-1);let r0=(()=>{class t extends s0{constructor(t,e,i,n,s,r,o,a){super(t),this._ngZone=e,this._changeDetectorRef=s,this._hasFocus=!1,this.chipListSelectable=!0,this._chipListMultiple=!1,this._chipListDisabled=!1,this._selected=!1,this._selectable=!0,this._disabled=!1,this._removable=!0,this._onFocus=new C,this._onBlur=new C,this.selectionChange=new gh,this.destroyed=new gh,this.removed=new gh,this._addHostClassName(),this._chipRippleTarget=r.createElement(\"div\"),this._chipRippleTarget.classList.add(\"mat-chip-ripple\"),this._elementRef.nativeElement.appendChild(this._chipRippleTarget),this._chipRipple=new uy(this,e,this._chipRippleTarget,i),this._chipRipple.setupTriggerEvents(t),this.rippleConfig=n||{},this._animationsDisabled=\"NoopAnimations\"===o,this.tabIndex=null!=a&&parseInt(a)||-1}get rippleDisabled(){return this.disabled||this.disableRipple||this._animationsDisabled||!!this.rippleConfig.disabled}get selected(){return this._selected}set selected(t){const e=Lf(t);e!==this._selected&&(this._selected=e,this._dispatchSelectionChange())}get value(){return void 0!==this._value?this._value:this._elementRef.nativeElement.textContent}set value(t){this._value=t}get selectable(){return this._selectable&&this.chipListSelectable}set selectable(t){this._selectable=Lf(t)}get disabled(){return this._chipListDisabled||this._disabled}set disabled(t){this._disabled=Lf(t)}get removable(){return this._removable}set removable(t){this._removable=Lf(t)}get ariaSelected(){return this.selectable&&(this._chipListMultiple||this.selected)?this.selected.toString():null}_addHostClassName(){const t=\"mat-basic-chip\",e=this._elementRef.nativeElement;e.hasAttribute(t)||e.tagName.toLowerCase()===t?e.classList.add(t):e.classList.add(\"mat-standard-chip\")}ngOnDestroy(){this.destroyed.emit({chip:this}),this._chipRipple._removeTriggerEvents()}select(){this._selected||(this._selected=!0,this._dispatchSelectionChange(),this._changeDetectorRef.markForCheck())}deselect(){this._selected&&(this._selected=!1,this._dispatchSelectionChange(),this._changeDetectorRef.markForCheck())}selectViaInteraction(){this._selected||(this._selected=!0,this._dispatchSelectionChange(!0),this._changeDetectorRef.markForCheck())}toggleSelected(t=!1){return this._selected=!this.selected,this._dispatchSelectionChange(t),this._changeDetectorRef.markForCheck(),this.selected}focus(){this._hasFocus||(this._elementRef.nativeElement.focus(),this._onFocus.next({chip:this})),this._hasFocus=!0}remove(){this.removable&&this.removed.emit({chip:this})}_handleClick(t){this.disabled?t.preventDefault():t.stopPropagation()}_handleKeydown(t){if(!this.disabled)switch(t.keyCode){case 46:case 8:this.remove(),t.preventDefault();break;case 32:this.selectable&&this.toggleSelected(!0),t.preventDefault()}}_blur(){this._ngZone.onStable.pipe(xf(1)).subscribe(()=>{this._ngZone.run(()=>{this._hasFocus=!1,this._onBlur.next({chip:this})})})}_dispatchSelectionChange(t=!1){this.selectionChange.emit({source:this,isUserInput:t,selected:this._selected})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(nu),Oa(Hf),Oa(dy,8),Oa(Mc),Oa(Fu),Oa(wb,8),Yi(\"tabindex\"))},t.\\u0275dir=Xt({type:t,selectors:[[\"mat-basic-chip\"],[\"\",\"mat-basic-chip\",\"\"],[\"mat-chip\"],[\"\",\"mat-chip\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,e0,5),Ih(i,i0,5),Ih(i,t0,5)),2&t){let t;Mh(t=Ph())&&(e.avatar=t.first),Mh(t=Ph())&&(e.trailingIcon=t.first),Mh(t=Ph())&&(e.removeIcon=t.first)}},hostAttrs:[\"role\",\"option\",1,\"mat-chip\",\"mat-focus-indicator\"],hostVars:14,hostBindings:function(t,e){1&t&&Ga(\"click\",function(t){return e._handleClick(t)})(\"keydown\",function(t){return e._handleKeydown(t)})(\"focus\",function(){return e.focus()})(\"blur\",function(){return e._blur()}),2&t&&(ia(\"tabindex\",e.disabled?null:e.tabIndex)(\"disabled\",e.disabled||null)(\"aria-disabled\",e.disabled.toString())(\"aria-selected\",e.ariaSelected),hl(\"mat-chip-selected\",e.selected)(\"mat-chip-with-avatar\",e.avatar)(\"mat-chip-with-trailing-icon\",e.trailingIcon||e.removeIcon)(\"mat-chip-disabled\",e.disabled)(\"_mat-animation-noopable\",e._animationsDisabled))},inputs:{color:\"color\",disableRipple:\"disableRipple\",tabIndex:\"tabIndex\",selected:\"selected\",value:\"value\",selectable:\"selectable\",disabled:\"disabled\",removable:\"removable\"},outputs:{selectionChange:\"selectionChange\",destroyed:\"destroyed\",removed:\"removed\"},exportAs:[\"matChip\"],features:[Uo]}),t})(),o0=(()=>{class t{constructor(t,e){this._parentChip=t,\"BUTTON\"===e.nativeElement.nodeName&&e.nativeElement.setAttribute(\"type\",\"button\")}_handleClick(t){const e=this._parentChip;e.removable&&!e.disabled&&e.remove(),t.stopPropagation()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(r0),Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matChipRemove\",\"\"]],hostAttrs:[1,\"mat-chip-remove\",\"mat-chip-trailing-icon\"],hostBindings:function(t,e){1&t&&Ga(\"click\",function(t){return e._handleClick(t)})},features:[Yl([{provide:t0,useExisting:t}])]}),t})();const a0=new Ji(\"mat-chips-default-options\"),l0=$b(class{constructor(t,e,i,n){this._defaultErrorStateMatcher=t,this._parentForm=e,this._parentFormGroup=i,this.ngControl=n}});let c0=0;class h0{constructor(t,e){this.source=t,this.value=e}}let u0=(()=>{class t extends l0{constructor(t,e,i,n,s,r,o){super(r,n,s,o),this._elementRef=t,this._changeDetectorRef=e,this._dir=i,this.controlType=\"mat-chip-list\",this._lastDestroyedChipIndex=null,this._destroyed=new C,this._uid=\"mat-chip-list-\"+c0++,this._tabIndex=0,this._userTabIndex=null,this._onTouched=()=>{},this._onChange=()=>{},this._multiple=!1,this._compareWith=(t,e)=>t===e,this._required=!1,this._disabled=!1,this.ariaOrientation=\"horizontal\",this._selectable=!0,this.change=new gh,this.valueChange=new gh,this.ngControl&&(this.ngControl.valueAccessor=this)}get selected(){var t,e;return this.multiple?(null===(t=this._selectionModel)||void 0===t?void 0:t.selected)||[]:null===(e=this._selectionModel)||void 0===e?void 0:e.selected[0]}get role(){return this.empty?null:\"listbox\"}get multiple(){return this._multiple}set multiple(t){this._multiple=Lf(t),this._syncChipsState()}get compareWith(){return this._compareWith}set compareWith(t){this._compareWith=t,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(t){this.writeValue(t),this._value=t}get id(){return this._chipInput?this._chipInput.id:this._uid}get required(){return this._required}set required(t){this._required=Lf(t),this.stateChanges.next()}get placeholder(){return this._chipInput?this._chipInput.placeholder:this._placeholder}set placeholder(t){this._placeholder=t,this.stateChanges.next()}get focused(){return this._chipInput&&this._chipInput.focused||this._hasFocusedChip()}get empty(){return(!this._chipInput||this._chipInput.empty)&&(!this.chips||0===this.chips.length)}get shouldLabelFloat(){return!this.empty||this.focused}get disabled(){return this.ngControl?!!this.ngControl.disabled:this._disabled}set disabled(t){this._disabled=Lf(t),this._syncChipsState()}get selectable(){return this._selectable}set selectable(t){this._selectable=Lf(t),this.chips&&this.chips.forEach(t=>t.chipListSelectable=this._selectable)}set tabIndex(t){this._userTabIndex=t,this._tabIndex=t}get chipSelectionChanges(){return q(...this.chips.map(t=>t.selectionChange))}get chipFocusChanges(){return q(...this.chips.map(t=>t._onFocus))}get chipBlurChanges(){return q(...this.chips.map(t=>t._onBlur))}get chipRemoveChanges(){return q(...this.chips.map(t=>t.destroyed))}ngAfterContentInit(){this._keyManager=new ym(this.chips).withWrap().withVerticalOrientation().withHomeAndEnd().withHorizontalOrientation(this._dir?this._dir.value:\"ltr\"),this._dir&&this._dir.change.pipe(Of(this._destroyed)).subscribe(t=>this._keyManager.withHorizontalOrientation(t)),this._keyManager.tabOut.pipe(Of(this._destroyed)).subscribe(()=>{this._allowFocusEscape()}),this.chips.changes.pipe(hg(null),Of(this._destroyed)).subscribe(()=>{this.disabled&&Promise.resolve().then(()=>{this._syncChipsState()}),this._resetChips(),this._initializeSelection(),this._updateTabIndex(),this._updateFocusForDestroyedChips(),this.stateChanges.next()})}ngOnInit(){this._selectionModel=new Dg(this.multiple,void 0,!1),this.stateChanges.next()}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==this._disabled&&(this.disabled=!!this.ngControl.disabled))}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this.stateChanges.complete(),this._dropSubscriptions()}registerInput(t){this._chipInput=t,this._elementRef.nativeElement.setAttribute(\"data-mat-chip-input\",t.id)}setDescribedByIds(t){this._ariaDescribedby=t.join(\" \")}writeValue(t){this.chips&&this._setSelectionByValue(t,!1)}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this.stateChanges.next()}onContainerClick(t){this._originatesFromChip(t)||this.focus()}focus(t){this.disabled||this._chipInput&&this._chipInput.focused||(this.chips.length>0?(this._keyManager.setFirstItemActive(),this.stateChanges.next()):(this._focusInput(t),this.stateChanges.next()))}_focusInput(t){this._chipInput&&this._chipInput.focus(t)}_keydown(t){const e=t.target;e&&e.classList.contains(\"mat-chip\")&&(this._keyManager.onKeydown(t),this.stateChanges.next())}_updateTabIndex(){this._tabIndex=this._userTabIndex||(0===this.chips.length?-1:0)}_updateFocusForDestroyedChips(){if(null!=this._lastDestroyedChipIndex)if(this.chips.length){const t=Math.min(this._lastDestroyedChipIndex,this.chips.length-1);this._keyManager.setActiveItem(t)}else this.focus();this._lastDestroyedChipIndex=null}_isValidIndex(t){return t>=0&&t<this.chips.length}_setSelectionByValue(t,e=!0){if(this._clearSelection(),this.chips.forEach(t=>t.deselect()),Array.isArray(t))t.forEach(t=>this._selectValue(t,e)),this._sortValues();else{const i=this._selectValue(t,e);i&&e&&this._keyManager.setActiveItem(i)}}_selectValue(t,e=!0){const i=this.chips.find(e=>null!=e.value&&this._compareWith(e.value,t));return i&&(e?i.selectViaInteraction():i.select(),this._selectionModel.select(i)),i}_initializeSelection(){Promise.resolve().then(()=>{(this.ngControl||this._value)&&(this._setSelectionByValue(this.ngControl?this.ngControl.value:this._value,!1),this.stateChanges.next())})}_clearSelection(t){this._selectionModel.clear(),this.chips.forEach(e=>{e!==t&&e.deselect()}),this.stateChanges.next()}_sortValues(){this._multiple&&(this._selectionModel.clear(),this.chips.forEach(t=>{t.selected&&this._selectionModel.select(t)}),this.stateChanges.next())}_propagateChanges(t){let e=null;e=Array.isArray(this.selected)?this.selected.map(t=>t.value):this.selected?this.selected.value:t,this._value=e,this.change.emit(new h0(this,e)),this.valueChange.emit(e),this._onChange(e),this._changeDetectorRef.markForCheck()}_blur(){this._hasFocusedChip()||this._keyManager.setActiveItem(-1),this.disabled||(this._chipInput?setTimeout(()=>{this.focused||this._markAsTouched()}):this._markAsTouched())}_markAsTouched(){this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next()}_allowFocusEscape(){-1!==this._tabIndex&&(this._tabIndex=-1,setTimeout(()=>{this._tabIndex=this._userTabIndex||0,this._changeDetectorRef.markForCheck()}))}_resetChips(){this._dropSubscriptions(),this._listenToChipsFocus(),this._listenToChipsSelection(),this._listenToChipsRemoved()}_dropSubscriptions(){this._chipFocusSubscription&&(this._chipFocusSubscription.unsubscribe(),this._chipFocusSubscription=null),this._chipBlurSubscription&&(this._chipBlurSubscription.unsubscribe(),this._chipBlurSubscription=null),this._chipSelectionSubscription&&(this._chipSelectionSubscription.unsubscribe(),this._chipSelectionSubscription=null),this._chipRemoveSubscription&&(this._chipRemoveSubscription.unsubscribe(),this._chipRemoveSubscription=null)}_listenToChipsSelection(){this._chipSelectionSubscription=this.chipSelectionChanges.subscribe(t=>{t.source.selected?this._selectionModel.select(t.source):this._selectionModel.deselect(t.source),this.multiple||this.chips.forEach(t=>{!this._selectionModel.isSelected(t)&&t.selected&&t.deselect()}),t.isUserInput&&this._propagateChanges()})}_listenToChipsFocus(){this._chipFocusSubscription=this.chipFocusChanges.subscribe(t=>{let e=this.chips.toArray().indexOf(t.chip);this._isValidIndex(e)&&this._keyManager.updateActiveItem(e),this.stateChanges.next()}),this._chipBlurSubscription=this.chipBlurChanges.subscribe(()=>{this._blur(),this.stateChanges.next()})}_listenToChipsRemoved(){this._chipRemoveSubscription=this.chipRemoveChanges.subscribe(t=>{const e=t.chip,i=this.chips.toArray().indexOf(t.chip);this._isValidIndex(i)&&e._hasFocus&&(this._lastDestroyedChipIndex=i)})}_originatesFromChip(t){let e=t.target;for(;e&&e!==this._elementRef.nativeElement;){if(e.classList.contains(\"mat-chip\"))return!0;e=e.parentElement}return!1}_hasFocusedChip(){return this.chips&&this.chips.some(t=>t._hasFocus)}_syncChipsState(){this.chips&&this.chips.forEach(t=>{t._chipListDisabled=this._disabled,t._chipListMultiple=this.multiple})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa(Eg,8),Oa(Jw,8),Oa(dx,8),Oa(iy),Oa(ww,10))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-chip-list\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,r0,5),2&t){let t;Mh(t=Ph())&&(e.chips=t)}},hostAttrs:[1,\"mat-chip-list\"],hostVars:15,hostBindings:function(t,e){1&t&&Ga(\"focus\",function(){return e.focus()})(\"blur\",function(){return e._blur()})(\"keydown\",function(t){return e._keydown(t)}),2&t&&(Il(\"id\",e._uid),ia(\"tabindex\",e.disabled?null:e._tabIndex)(\"aria-describedby\",e._ariaDescribedby||null)(\"aria-required\",e.role?e.required:null)(\"aria-disabled\",e.disabled.toString())(\"aria-invalid\",e.errorState)(\"aria-multiselectable\",e.multiple)(\"role\",e.role)(\"aria-orientation\",e.ariaOrientation),hl(\"mat-chip-list-disabled\",e.disabled)(\"mat-chip-list-invalid\",e.errorState)(\"mat-chip-list-required\",e.required))},inputs:{ariaOrientation:[\"aria-orientation\",\"ariaOrientation\"],multiple:\"multiple\",compareWith:\"compareWith\",value:\"value\",required:\"required\",placeholder:\"placeholder\",disabled:\"disabled\",selectable:\"selectable\",tabIndex:\"tabIndex\",errorStateMatcher:\"errorStateMatcher\"},outputs:{change:\"change\",valueChange:\"valueChange\"},exportAs:[\"matChipList\"],features:[Yl([{provide:nS,useExisting:t}]),Uo],ngContentSelectors:JJ,decls:2,vars:0,consts:[[1,\"mat-chip-list-wrapper\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0),Ja(1),Fa())},styles:['.mat-chip{position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;transform:translateZ(0);border:none;-webkit-appearance:none;-moz-appearance:none}.mat-standard-chip{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:inline-flex;padding:7px 12px;border-radius:16px;align-items:center;cursor:default;min-height:32px;height:1px}._mat-animation-noopable.mat-standard-chip{transition:none;animation:none}.mat-standard-chip .mat-chip-remove{border:none;-webkit-appearance:none;-moz-appearance:none;padding:0;background:none}.mat-standard-chip .mat-chip-remove.mat-icon,.mat-standard-chip .mat-chip-remove .mat-icon{width:18px;height:18px;font-size:18px}.mat-standard-chip::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit;opacity:0;content:\"\";pointer-events:none;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-standard-chip:hover::after{opacity:.12}.mat-standard-chip:focus{outline:none}.mat-standard-chip:focus::after{opacity:.16}.cdk-high-contrast-active .mat-standard-chip{outline:solid 1px}.cdk-high-contrast-active .mat-standard-chip:focus{outline:dotted 2px}.mat-standard-chip.mat-chip-disabled::after{opacity:0}.mat-standard-chip.mat-chip-disabled .mat-chip-remove,.mat-standard-chip.mat-chip-disabled .mat-chip-trailing-icon{cursor:default}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar,.mat-standard-chip.mat-chip-with-avatar{padding-top:0;padding-bottom:0}.mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-right:8px;padding-left:0}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon.mat-chip-with-avatar{padding-left:8px;padding-right:0}.mat-standard-chip.mat-chip-with-trailing-icon{padding-top:7px;padding-bottom:7px;padding-right:8px;padding-left:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-trailing-icon{padding-left:8px;padding-right:12px}.mat-standard-chip.mat-chip-with-avatar{padding-left:0;padding-right:12px}[dir=rtl] .mat-standard-chip.mat-chip-with-avatar{padding-right:0;padding-left:12px}.mat-standard-chip .mat-chip-avatar{width:24px;height:24px;margin-right:8px;margin-left:4px}[dir=rtl] .mat-standard-chip .mat-chip-avatar{margin-left:8px;margin-right:4px}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{width:18px;height:18px;cursor:pointer}.mat-standard-chip .mat-chip-remove,.mat-standard-chip .mat-chip-trailing-icon{margin-left:8px;margin-right:0}[dir=rtl] .mat-standard-chip .mat-chip-remove,[dir=rtl] .mat-standard-chip .mat-chip-trailing-icon{margin-right:8px;margin-left:0}.mat-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit;overflow:hidden}.mat-chip-list-wrapper{display:flex;flex-direction:row;flex-wrap:wrap;align-items:center;margin:-4px}.mat-chip-list-wrapper input.mat-input-element,.mat-chip-list-wrapper .mat-standard-chip{margin:4px}.mat-chip-list-stacked .mat-chip-list-wrapper{flex-direction:column;align-items:flex-start}.mat-chip-list-stacked .mat-chip-list-wrapper .mat-standard-chip{width:100%}.mat-chip-avatar{border-radius:50%;justify-content:center;align-items:center;display:flex;overflow:hidden;object-fit:cover}input.mat-chip-input{width:150px;margin:4px;flex:1 0 150px}\\n'],encapsulation:2,changeDetection:0}),t})();const d0={separatorKeyCodes:[13]};let p0=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({providers:[iy,{provide:a0,useValue:d0}],imports:[[Fb]]}),t})();const f0=[\"mat-menu-item\",\"\"];function m0(t,e){1&t&&(hi(),La(0,\"svg\",2),Na(1,\"polygon\",3),Fa())}const g0=[\"*\"];function A0(t,e){if(1&t){const t=$a();La(0,\"div\",0),Ga(\"keydown\",function(e){return Fe(t),Ka()._handleKeydown(e)})(\"click\",function(){return Fe(t),Ka().closed.emit(\"click\")})(\"@transformMenu.start\",function(e){return Fe(t),Ka()._onAnimationStart(e)})(\"@transformMenu.done\",function(e){return Fe(t),Ka()._onAnimationDone(e)}),La(1,\"div\",1),Ja(2),Fa(),Fa()}if(2&t){const t=Ka();Ra(\"id\",t.panelId)(\"ngClass\",t._classList)(\"@transformMenu\",t._panelAnimationState),ia(\"aria-label\",t.ariaLabel||null)(\"aria-labelledby\",t.ariaLabelledby||null)(\"aria-describedby\",t.ariaDescribedby||null)}}const v0={transformMenu:BA(\"transformMenu\",[UA(\"void\",$A({opacity:0,transform:\"scale(0.8)\"})),HA(\"void => enter\",zA(\"120ms cubic-bezier(0, 0, 0.2, 1)\",$A({opacity:1,transform:\"scale(1)\"}))),HA(\"* => void\",zA(\"100ms 25ms linear\",$A({opacity:0})))]),fadeInItems:BA(\"fadeInItems\",[UA(\"showing\",$A({opacity:1})),HA(\"void => *\",[$A({opacity:0}),zA(\"400ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)\")])])},_0=new Ji(\"MatMenuContent\");let b0=(()=>{class t{constructor(t,e,i,n,s,r,o){this._template=t,this._componentFactoryResolver=e,this._appRef=i,this._injector=n,this._viewContainerRef=s,this._document=r,this._changeDetectorRef=o,this._attached=new C}attach(t={}){this._portal||(this._portal=new qp(this._template,this._viewContainerRef)),this.detach(),this._outlet||(this._outlet=new Kp(this._document.createElement(\"div\"),this._componentFactoryResolver,this._appRef,this._injector));const e=this._template.elementRef.nativeElement;e.parentNode.insertBefore(this._outlet.outletElement,e),this._changeDetectorRef&&this._changeDetectorRef.markForCheck(),this._portal.attach(this._outlet,t),this._attached.next()}detach(){this._portal.isAttached&&this._portal.detach()}ngOnDestroy(){this._outlet&&this._outlet.dispose()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc),Oa(Ql),Oa(Su),Oa(Vo),Oa(Vc),Oa(Fu),Oa(Mc))},t.\\u0275dir=Xt({type:t}),t})(),y0=(()=>{class t extends b0{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"ng-template\",\"matMenuContent\",\"\"]],features:[Yl([{provide:_0,useExisting:t}]),Uo]}),t})();const w0=new Ji(\"MAT_MENU_PANEL\"),x0=zb(Nb(class{}));let S0=(()=>{class t extends x0{constructor(t,e,i,n,s){super(),this._elementRef=t,this._focusMonitor=i,this._parentMenu=n,this._changeDetectorRef=s,this.role=\"menuitem\",this._hovered=new C,this._focused=new C,this._highlighted=!1,this._triggersSubmenu=!1,n&&n.addItem&&n.addItem(this)}focus(t,e){this._focusMonitor&&t?this._focusMonitor.focusVia(this._getHostElement(),t,e):this._getHostElement().focus(e),this._focused.next(this)}ngAfterViewInit(){this._focusMonitor&&this._focusMonitor.monitor(this._elementRef,!1)}ngOnDestroy(){this._focusMonitor&&this._focusMonitor.stopMonitoring(this._elementRef),this._parentMenu&&this._parentMenu.removeItem&&this._parentMenu.removeItem(this),this._hovered.complete(),this._focused.complete()}_getTabIndex(){return this.disabled?\"-1\":\"0\"}_getHostElement(){return this._elementRef.nativeElement}_checkDisabled(t){this.disabled&&(t.preventDefault(),t.stopPropagation())}_handleMouseEnter(){this._hovered.next(this)}getLabel(){var t,e;const i=this._elementRef.nativeElement.cloneNode(!0),n=i.querySelectorAll(\"mat-icon, .material-icons\");for(let s=0;s<n.length;s++){const e=n[s];null===(t=e.parentNode)||void 0===t||t.removeChild(e)}return(null===(e=i.textContent)||void 0===e?void 0:e.trim())||\"\"}_setHighlighted(t){var e;this._highlighted=t,null===(e=this._changeDetectorRef)||void 0===e||e.markForCheck()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Fu),Oa(Vm),Oa(w0,8),Oa(Mc))},t.\\u0275cmp=Gt({type:t,selectors:[[\"\",\"mat-menu-item\",\"\"]],hostAttrs:[1,\"mat-focus-indicator\"],hostVars:10,hostBindings:function(t,e){1&t&&Ga(\"click\",function(t){return e._checkDisabled(t)})(\"mouseenter\",function(){return e._handleMouseEnter()}),2&t&&(ia(\"role\",e.role)(\"tabindex\",e._getTabIndex())(\"aria-disabled\",e.disabled.toString())(\"disabled\",e.disabled||null),hl(\"mat-menu-item\",!0)(\"mat-menu-item-highlighted\",e._highlighted)(\"mat-menu-item-submenu-trigger\",e._triggersSubmenu))},inputs:{disabled:\"disabled\",disableRipple:\"disableRipple\",role:\"role\"},exportAs:[\"matMenuItem\"],features:[Uo],attrs:f0,ngContentSelectors:g0,decls:3,vars:3,consts:[[\"matRipple\",\"\",1,\"mat-menu-ripple\",3,\"matRippleDisabled\",\"matRippleTrigger\"],[\"class\",\"mat-menu-submenu-icon\",\"viewBox\",\"0 0 5 10\",\"focusable\",\"false\",4,\"ngIf\"],[\"viewBox\",\"0 0 5 10\",\"focusable\",\"false\",1,\"mat-menu-submenu-icon\"],[\"points\",\"0,0 5,5 0,10\"]],template:function(t,e){1&t&&(Qa(),Ja(0),Na(1,\"div\",0),oa(2,m0,2,0,\"svg\",1)),2&t&&(Cr(1),Ra(\"matRippleDisabled\",e.disableRipple||e.disabled)(\"matRippleTrigger\",e._getHostElement()),Cr(1),Ra(\"ngIf\",e._triggersSubmenu))},directives:[py,Vd],encapsulation:2,changeDetection:0}),t})();const C0=new Ji(\"mat-menu-default-options\",{providedIn:\"root\",factory:function(){return{overlapTrigger:!1,xPosition:\"after\",yPosition:\"below\",backdropClass:\"cdk-overlay-transparent-backdrop\"}}});let k0=0,E0=(()=>{class t{constructor(t,e,i){this._elementRef=t,this._ngZone=e,this._defaultOptions=i,this._xPosition=this._defaultOptions.xPosition,this._yPosition=this._defaultOptions.yPosition,this._directDescendantItems=new vh,this._tabSubscription=d.EMPTY,this._classList={},this._panelAnimationState=\"void\",this._animationDone=new C,this.overlayPanelClass=this._defaultOptions.overlayPanelClass||\"\",this.backdropClass=this._defaultOptions.backdropClass,this._overlapTrigger=this._defaultOptions.overlapTrigger,this._hasBackdrop=this._defaultOptions.hasBackdrop,this.closed=new gh,this.close=this.closed,this.panelId=\"mat-menu-panel-\"+k0++}get xPosition(){return this._xPosition}set xPosition(t){this._xPosition=t,this.setPositionClasses()}get yPosition(){return this._yPosition}set yPosition(t){this._yPosition=t,this.setPositionClasses()}get overlapTrigger(){return this._overlapTrigger}set overlapTrigger(t){this._overlapTrigger=Lf(t)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(t){this._hasBackdrop=Lf(t)}set panelClass(t){const e=this._previousPanelClass;e&&e.length&&e.split(\" \").forEach(t=>{this._classList[t]=!1}),this._previousPanelClass=t,t&&t.length&&(t.split(\" \").forEach(t=>{this._classList[t]=!0}),this._elementRef.nativeElement.className=\"\")}get classList(){return this.panelClass}set classList(t){this.panelClass=t}ngOnInit(){this.setPositionClasses()}ngAfterContentInit(){this._updateDirectDescendants(),this._keyManager=new ym(this._directDescendantItems).withWrap().withTypeAhead().withHomeAndEnd(),this._tabSubscription=this._keyManager.tabOut.subscribe(()=>this.closed.emit(\"tab\")),this._directDescendantItems.changes.pipe(hg(this._directDescendantItems),fg(t=>q(...t.map(t=>t._focused)))).subscribe(t=>this._keyManager.updateActiveItem(t))}ngOnDestroy(){this._directDescendantItems.destroy(),this._tabSubscription.unsubscribe(),this.closed.complete()}_hovered(){return this._directDescendantItems.changes.pipe(hg(this._directDescendantItems),fg(t=>q(...t.map(t=>t._hovered))))}addItem(t){}removeItem(t){}_handleKeydown(t){const e=t.keyCode,i=this._keyManager;switch(e){case 27:ef(t)||(t.preventDefault(),this.closed.emit(\"keydown\"));break;case 37:this.parentMenu&&\"ltr\"===this.direction&&this.closed.emit(\"keydown\");break;case 39:this.parentMenu&&\"rtl\"===this.direction&&this.closed.emit(\"keydown\");break;default:(38===e||40===e)&&i.setFocusOrigin(\"keyboard\"),i.onKeydown(t)}}focusFirstItem(t=\"program\"){this.lazyContent?this._ngZone.onStable.pipe(xf(1)).subscribe(()=>this._focusFirstItem(t)):this._focusFirstItem(t)}_focusFirstItem(t){const e=this._keyManager;if(e.setFocusOrigin(t).setFirstItemActive(),!e.activeItem&&this._directDescendantItems.length){let t=this._directDescendantItems.first._getHostElement().parentElement;for(;t;){if(\"menu\"===t.getAttribute(\"role\")){t.focus();break}t=t.parentElement}}}resetActiveItem(){this._keyManager.setActiveItem(-1)}setElevation(t){const e=Math.min(this._baseElevation+t,24),i=`${this._elevationPrefix}${e}`,n=Object.keys(this._classList).find(t=>t.startsWith(this._elevationPrefix));(!n||n===this._previousElevation)&&(this._previousElevation&&(this._classList[this._previousElevation]=!1),this._classList[i]=!0,this._previousElevation=i)}setPositionClasses(t=this.xPosition,e=this.yPosition){const i=this._classList;i[\"mat-menu-before\"]=\"before\"===t,i[\"mat-menu-after\"]=\"after\"===t,i[\"mat-menu-above\"]=\"above\"===e,i[\"mat-menu-below\"]=\"below\"===e}_startAnimation(){this._panelAnimationState=\"enter\"}_resetAnimation(){this._panelAnimationState=\"void\"}_onAnimationDone(t){this._animationDone.next(t),this._isAnimating=!1}_onAnimationStart(t){this._isAnimating=!0,\"enter\"===t.toState&&0===this._keyManager.activeItemIndex&&(t.element.scrollTop=0)}_updateDirectDescendants(){this._allItems.changes.pipe(hg(this._allItems)).subscribe(t=>{this._directDescendantItems.reset(t.filter(t=>t._parentMenu===this)),this._directDescendantItems.notifyOnChanges()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(nu),Oa(C0))},t.\\u0275dir=Xt({type:t,contentQueries:function(t,e,i){if(1&t&&(Ih(i,_0,5),Ih(i,S0,5),Ih(i,S0,4)),2&t){let t;Mh(t=Ph())&&(e.lazyContent=t.first),Mh(t=Ph())&&(e._allItems=t),Mh(t=Ph())&&(e.items=t)}},viewQuery:function(t,e){if(1&t&&Th(Rc,5),2&t){let t;Mh(t=Ph())&&(e.templateRef=t.first)}},inputs:{backdropClass:\"backdropClass\",xPosition:\"xPosition\",yPosition:\"yPosition\",overlapTrigger:\"overlapTrigger\",hasBackdrop:\"hasBackdrop\",panelClass:[\"class\",\"panelClass\"],classList:\"classList\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"]},outputs:{closed:\"closed\",close:\"close\"}}),t})(),T0=(()=>{class t extends E0{constructor(t,e,i){super(t,e,i),this._elevationPrefix=\"mat-elevation-z\",this._baseElevation=4}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(nu),Oa(C0))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-menu\"]],hostVars:3,hostBindings:function(t,e){2&t&&ia(\"aria-label\",null)(\"aria-labelledby\",null)(\"aria-describedby\",null)},exportAs:[\"matMenu\"],features:[Yl([{provide:w0,useExisting:t}]),Uo],ngContentSelectors:g0,decls:1,vars:0,consts:[[\"tabindex\",\"-1\",\"role\",\"menu\",1,\"mat-menu-panel\",3,\"id\",\"ngClass\",\"keydown\",\"click\"],[1,\"mat-menu-content\"]],template:function(t,e){1&t&&(Qa(),oa(0,A0,3,6,\"ng-template\"))},directives:[Fd],styles:[\"mat-menu{display:none}.mat-menu-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;max-height:calc(100vh - 48px);border-radius:4px;outline:0;min-height:64px}.mat-menu-panel.ng-animating{pointer-events:none}.cdk-high-contrast-active .mat-menu-panel{outline:solid 1px}.mat-menu-content:not(:empty){padding-top:8px;padding-bottom:8px}.mat-menu-item{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:transparent;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:48px;height:48px;padding:0 16px;text-align:left;text-decoration:none;max-width:100%;position:relative}.mat-menu-item::-moz-focus-inner{border:0}.mat-menu-item[disabled]{cursor:default}[dir=rtl] .mat-menu-item{text-align:right}.mat-menu-item .mat-icon{margin-right:16px;vertical-align:middle}.mat-menu-item .mat-icon svg{vertical-align:top}[dir=rtl] .mat-menu-item .mat-icon{margin-left:16px;margin-right:0}.mat-menu-item[disabled]{pointer-events:none}.cdk-high-contrast-active .mat-menu-item{margin-top:1px}.cdk-high-contrast-active .mat-menu-item.cdk-program-focused,.cdk-high-contrast-active .mat-menu-item.cdk-keyboard-focused,.cdk-high-contrast-active .mat-menu-item-highlighted{outline:dotted 1px}.mat-menu-item-submenu-trigger{padding-right:32px}[dir=rtl] .mat-menu-item-submenu-trigger{padding-right:16px;padding-left:32px}.mat-menu-submenu-icon{position:absolute;top:50%;right:16px;transform:translateY(-50%);width:5px;height:10px;fill:currentColor}[dir=rtl] .mat-menu-submenu-icon{right:auto;left:16px;transform:translateY(-50%) scaleX(-1)}.cdk-high-contrast-active .mat-menu-submenu-icon{fill:CanvasText}button.mat-menu-item{width:100%}.mat-menu-item .mat-menu-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}\\n\"],encapsulation:2,data:{animation:[v0.transformMenu,v0.fadeInItems]},changeDetection:0}),t})();const I0=new Ji(\"mat-menu-scroll-strategy\"),P0={provide:I0,deps:[MA],useFactory:function(t){return()=>t.scrollStrategies.reposition()}},O0=Qf({passive:!0});let R0=(()=>{class t{constructor(t,e,i,n,s,r,o,a){this._overlay=t,this._element=e,this._viewContainerRef=i,this._menuItemInstance=r,this._dir=o,this._focusMonitor=a,this._overlayRef=null,this._menuOpen=!1,this._closingActionsSubscription=d.EMPTY,this._hoverSubscription=d.EMPTY,this._menuCloseSubscription=d.EMPTY,this._handleTouchStart=t=>{Tm(t)||(this._openedBy=\"touch\")},this._openedBy=void 0,this._ariaHaspopup=!0,this.restoreFocus=!0,this.menuOpened=new gh,this.onMenuOpen=this.menuOpened,this.menuClosed=new gh,this.onMenuClose=this.menuClosed,this._scrollStrategy=n,this._parentMaterialMenu=s instanceof E0?s:void 0,e.nativeElement.addEventListener(\"touchstart\",this._handleTouchStart,O0),r&&(r._triggersSubmenu=this.triggersSubmenu())}get _ariaExpanded(){return this.menuOpen||null}get _ariaControl(){return this.menuOpen?this.menu.panelId:null}get _deprecatedMatMenuTriggerFor(){return this.menu}set _deprecatedMatMenuTriggerFor(t){this.menu=t}get menu(){return this._menu}set menu(t){t!==this._menu&&(this._menu=t,this._menuCloseSubscription.unsubscribe(),t&&(this._menuCloseSubscription=t.close.subscribe(t=>{this._destroyMenu(t),(\"click\"===t||\"tab\"===t)&&this._parentMaterialMenu&&this._parentMaterialMenu.closed.emit(t)})))}ngAfterContentInit(){this._checkMenu(),this._handleHover()}ngOnDestroy(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=null),this._element.nativeElement.removeEventListener(\"touchstart\",this._handleTouchStart,O0),this._menuCloseSubscription.unsubscribe(),this._closingActionsSubscription.unsubscribe(),this._hoverSubscription.unsubscribe()}get menuOpen(){return this._menuOpen}get dir(){return this._dir&&\"rtl\"===this._dir.value?\"rtl\":\"ltr\"}triggersSubmenu(){return!(!this._menuItemInstance||!this._parentMaterialMenu)}toggleMenu(){return this._menuOpen?this.closeMenu():this.openMenu()}openMenu(){if(this._menuOpen)return;this._checkMenu();const t=this._createOverlay(),e=t.getConfig();this._setPosition(e.positionStrategy),e.hasBackdrop=null==this.menu.hasBackdrop?!this.triggersSubmenu():this.menu.hasBackdrop,t.attach(this._getPortal()),this.menu.lazyContent&&this.menu.lazyContent.attach(this.menuData),this._closingActionsSubscription=this._menuClosingActions().subscribe(()=>this.closeMenu()),this._initMenu(),this.menu instanceof E0&&this.menu._startAnimation()}closeMenu(){this.menu.close.emit()}focus(t,e){this._focusMonitor&&t?this._focusMonitor.focusVia(this._element,t,e):this._element.nativeElement.focus(e)}updatePosition(){var t;null===(t=this._overlayRef)||void 0===t||t.updatePosition()}_destroyMenu(t){if(!this._overlayRef||!this.menuOpen)return;const e=this.menu;this._closingActionsSubscription.unsubscribe(),this._overlayRef.detach(),this.restoreFocus&&(\"keydown\"===t||!this._openedBy||!this.triggersSubmenu())&&this.focus(this._openedBy),this._openedBy=void 0,e instanceof E0?(e._resetAnimation(),e.lazyContent?e._animationDone.pipe(Af(t=>\"void\"===t.toState),xf(1),Of(e.lazyContent._attached)).subscribe({next:()=>e.lazyContent.detach(),complete:()=>this._setIsMenuOpen(!1)}):this._setIsMenuOpen(!1)):(this._setIsMenuOpen(!1),e.lazyContent&&e.lazyContent.detach())}_initMenu(){this.menu.parentMenu=this.triggersSubmenu()?this._parentMaterialMenu:void 0,this.menu.direction=this.dir,this._setMenuElevation(),this.menu.focusFirstItem(this._openedBy||\"program\"),this._setIsMenuOpen(!0)}_setMenuElevation(){if(this.menu.setElevation){let t=0,e=this.menu.parentMenu;for(;e;)t++,e=e.parentMenu;this.menu.setElevation(t)}}_setIsMenuOpen(t){this._menuOpen=t,this._menuOpen?this.menuOpened.emit():this.menuClosed.emit(),this.triggersSubmenu()&&this._menuItemInstance._setHighlighted(t)}_checkMenu(){}_createOverlay(){if(!this._overlayRef){const t=this._getOverlayConfig();this._subscribeToPositions(t.positionStrategy),this._overlayRef=this._overlay.create(t),this._overlayRef.keydownEvents().subscribe()}return this._overlayRef}_getOverlayConfig(){return new cA({positionStrategy:this._overlay.position().flexibleConnectedTo(this._element).withLockedPosition().withGrowAfterOpen().withTransformOriginOn(\".mat-menu-panel, .mat-mdc-menu-panel\"),backdropClass:this.menu.backdropClass||\"cdk-overlay-transparent-backdrop\",panelClass:this.menu.overlayPanelClass,scrollStrategy:this._scrollStrategy(),direction:this._dir})}_subscribeToPositions(t){this.menu.setPositionClasses&&t.positionChanges.subscribe(t=>{this.menu.setPositionClasses(\"start\"===t.connectionPair.overlayX?\"after\":\"before\",\"top\"===t.connectionPair.overlayY?\"below\":\"above\")})}_setPosition(t){let[e,i]=\"before\"===this.menu.xPosition?[\"end\",\"start\"]:[\"start\",\"end\"],[n,s]=\"above\"===this.menu.yPosition?[\"bottom\",\"top\"]:[\"top\",\"bottom\"],[r,o]=[n,s],[a,l]=[e,i],c=0;this.triggersSubmenu()?(l=e=\"before\"===this.menu.xPosition?\"start\":\"end\",i=a=\"end\"===e?\"start\":\"end\",c=\"bottom\"===n?8:-8):this.menu.overlapTrigger||(r=\"top\"===n?\"bottom\":\"top\",o=\"top\"===s?\"bottom\":\"top\"),t.withPositions([{originX:e,originY:r,overlayX:a,overlayY:n,offsetY:c},{originX:i,originY:r,overlayX:l,overlayY:n,offsetY:c},{originX:e,originY:o,overlayX:a,overlayY:s,offsetY:-c},{originX:i,originY:o,overlayX:l,overlayY:s,offsetY:-c}])}_menuClosingActions(){const t=this._overlayRef.backdropClick(),e=this._overlayRef.detachments();return q(t,this._parentMaterialMenu?this._parentMaterialMenu.closed:tf(),this._parentMaterialMenu?this._parentMaterialMenu._hovered().pipe(Af(t=>t!==this._menuItemInstance),Af(()=>this._menuOpen)):tf(),e)}_handleMousedown(t){Mm(t)||(this._openedBy=0===t.button?\"mouse\":void 0,this.triggersSubmenu()&&t.preventDefault())}_handleKeydown(t){const e=t.keyCode;(13===e||32===e)&&(this._openedBy=\"keyboard\"),this.triggersSubmenu()&&(39===e&&\"ltr\"===this.dir||37===e&&\"rtl\"===this.dir)&&(this._openedBy=\"keyboard\",this.openMenu())}_handleClick(t){this.triggersSubmenu()?(t.stopPropagation(),this.openMenu()):this.toggleMenu()}_handleHover(){!this.triggersSubmenu()||!this._parentMaterialMenu||(this._hoverSubscription=this._parentMaterialMenu._hovered().pipe(Af(t=>t===this._menuItemInstance&&!t.disabled),Oj(0,eg)).subscribe(()=>{this._openedBy=\"mouse\",this.menu instanceof E0&&this.menu._isAnimating?this.menu._animationDone.pipe(xf(1),Oj(0,eg),Of(this._parentMaterialMenu._hovered())).subscribe(()=>this.openMenu()):this.openMenu()}))}_getPortal(){return(!this._portal||this._portal.templateRef!==this.menu.templateRef)&&(this._portal=new qp(this.menu.templateRef,this._viewContainerRef)),this._portal}}return t.\\u0275fac=function(e){return new(e||t)(Oa(MA),Oa(ic),Oa(Vc),Oa(I0),Oa(w0,8),Oa(S0,10),Oa(Eg,8),Oa(Vm))},t.\\u0275dir=Xt({type:t,hostVars:3,hostBindings:function(t,e){1&t&&Ga(\"mousedown\",function(t){return e._handleMousedown(t)})(\"keydown\",function(t){return e._handleKeydown(t)})(\"click\",function(t){return e._handleClick(t)}),2&t&&ia(\"aria-haspopup\",e._ariaHaspopup)(\"aria-expanded\",e._ariaExpanded)(\"aria-controls\",e._ariaControl)},inputs:{restoreFocus:[\"matMenuTriggerRestoreFocus\",\"restoreFocus\"],_deprecatedMatMenuTriggerFor:[\"mat-menu-trigger-for\",\"_deprecatedMatMenuTriggerFor\"],menu:[\"matMenuTriggerFor\",\"menu\"],menuData:[\"matMenuTriggerData\",\"menuData\"]},outputs:{menuOpened:\"menuOpened\",onMenuOpen:\"onMenuOpen\",menuClosed:\"menuClosed\",onMenuClose:\"onMenuClose\"}}),t})(),D0=(()=>{class t extends R0{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-menu-trigger-for\",\"\"],[\"\",\"matMenuTriggerFor\",\"\"]],hostAttrs:[1,\"mat-menu-trigger\"],exportAs:[\"matMenuTrigger\"],features:[Uo]}),t})(),L0=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({providers:[P0],imports:[[np,Fb,fy,DA],Kg,Fb]}),t})(),F0=(()=>{class t extends Gq{constructor(t){super(),this.editZoneService=t,this.saveEmitter=new gh,this.cancelEmitter=new gh,this.isZoneValid=!1,this.save=()=>Hp(this,void 0,void 0,function*(){if(this.isZoneValid){const t=yield this.editZoneService.saveEditedZone();this.saveEmitter.next(t)}})}ngOnInit(){this.editZoneService.startEditing(this.initialZone?uU(this.initialZone):function(t={}){var e,i,n;return Object.assign(Object.assign({},t),{name:null!==(e=t.name)&&void 0!==e?e:\"\",h3indexes:null!==(i=t.h3indexes)&&void 0!==i?i:[],group_id:null!==(n=t.group_id)&&void 0!==n?n:\"\"})}({group_id:this.groupId})),this.subscriptions.push(this.editZoneService.editedZone$.subscribe(t=>{this.zone=t,this.isZoneValid=function(t){return!!t&&t.name&&t.h3indexes.length>0&&t.h3indexes.length<=130}(t)}))}updateZoneName(t){this.editZoneService.updateZoneName(t)}cancel(){this.editZoneService.cancelEditing(),this.cancelEmitter.next()}}return t.\\u0275fac=function(e){return new(e||t)(Oa($J))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-zone-form\"]],inputs:{initialZone:\"initialZone\",groupId:\"groupId\"},outputs:{saveEmitter:\"save\",cancelEmitter:\"cancel\"},features:[Uo],decls:8,vars:3,consts:[[1,\"u-flex\",\"ml-2\",\"auto-width\"],[\"matInput\",\"\",\"placeholder\",\"Nom de la zone\",3,\"ngModel\",\"ngModelChange\",\"keyup.enter\"],[\"mat-button\",\"\",\"title\",\"Enregistrer\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Annuler\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"mat-form-field\",0),La(1,\"input\",1),Ga(\"ngModelChange\",function(t){return e.updateZoneName(t)})(\"keyup.enter\",function(){return e.save()}),Fa(),Fa(),La(2,\"button\",2),La(3,\"mat-icon\"),xl(4,\"check\"),Fa(),Fa(),La(5,\"button\",3),Ga(\"click\",function(){return e.cancel()}),La(6,\"mat-icon\"),xl(7,\"cancel\"),Fa(),Fa()),2&t&&(Cr(1),Ra(\"ngModel\",e.zone.name),Cr(1),Ra(\"app-async-action\",e.save)(\"disabled\",!e.isZoneValid))},directives:[AS,ES,Gy,Sw,nx,Ly,Jq,uE],styles:[\"[_nghost-%COMP%]{display:flex}\"]}),t})();function N0(t,e){if(1&t){const t=$a();La(0,\"app-zone-form\",2),Ga(\"save\",function(e){return Fe(t),Ka().updateZone(e)})(\"cancel\",function(){return Fe(t),Ka().hideEditForm()}),Fa()}2&t&&Ra(\"initialZone\",Ka().zone)}function B0(t,e){if(1&t){const t=$a();La(0,\"button\",5),Ga(\"click\",function(){return Fe(t),Ka(2).showEditForm()}),La(1,\"mat-icon\"),xl(2,\"edit\"),Fa(),Fa(),La(3,\"button\",6),Ga(\"click\",function(){return Fe(t),Ka(2).deleteZone()}),La(4,\"mat-icon\"),xl(5,\"delete\"),Fa(),Fa()}if(2&t){const t=Ka(2);Ra(\"disabled\",t.disableEdition),Cr(3),Ra(\"disabled\",t.disableEdition||!!t.mustDeleteAssociatedAlertRulesErrorMessage)(\"title\",t.mustDeleteAssociatedAlertRulesErrorMessage)}}function z0(t,e){if(1&t){const t=$a();La(0,\"button\",3),Ga(\"click\",function(){return Fe(t),Ka().locate()}),xl(1),Fa(),oa(2,B0,6,3,\"ng-template\",4)}if(2&t){const t=Ka();Cr(1),Cl(\" \",t.zone.name,\" \"),Cr(1),Ra(\"ngIf\",t.editable)}}let V0=(()=>{class t extends Gq{constructor(t,e,i,n){super(),this.alertRulesService=t,this.mapService=e,this.uiService=i,this.zonesService=n,this.editable=!1,this.disableEdition=!1,this.trueDeletion=!1,this.deleteEmitter=new gh,this.editMode=!1,this.editedZoneSubscription=new d}ngOnInit(){this.ensureMandatoryInputParams(\"zone\");const t=this.alertRulesService.alertRulesNamesByZoneId[this.zone.id]||[];this.mustDeleteAssociatedAlertRulesErrorMessage=this.trueDeletion&&t.length>0?`Cette zone est utilis\\xe9e par les r\\xe8gles suivantes : ${t.join(\", \")}. Veuillez supprimer la zone de ces r\\xe8gles avant de pouvoir supprimer cette zone.`:\"\"}locate(){this.mapService.fitOnHexagons(this.zone.h3indexes)}showEditForm(){this.editMode=!0,this.locate()}hideEditForm(){this.editMode=!1}updateZone(t){Object.assign(this.zone,t),this.hideEditForm()}deleteZone(){this.trueDeletion?this.uiService.confirm({title:\"Suppression\",message:\"Une fois supprim\\xe9e, cette zone ne sera plus accessible et sera supprim\\xe9e de toute les r\\xe8gles qui l'utilisent. Confirmez-vous la suppression de cette zone ?\",action:t=>Hp(this,void 0,void 0,function*(){t&&(yield this.zonesService.deleteZone(this.zone.id),this.deleteEmitter.next(null))})}):this.deleteEmitter.next(null)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(DH),Oa(Pj),Oa(_H),Oa(OH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-zone-item\"]],inputs:{zone:\"zone\",editable:\"editable\",disableEdition:\"disableEdition\",trueDeletion:\"trueDeletion\"},outputs:{deleteEmitter:\"delete\"},features:[Uo],decls:3,vars:2,consts:[[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"u-flex\",3,\"initialZone\",\"save\",\"cancel\"],[\"mat-button\",\"\",\"title\",\"Visualiser la zone\",1,\"u-flex\",3,\"click\"],[3,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"\\xc9diter la zone\",3,\"disabled\",\"click\"],[\"mat-button\",\"\",\"title\",\"Supprimer la zone\",3,\"disabled\",\"title\",\"click\"]],template:function(t,e){if(1&t&&(oa(0,N0,1,1,\"ng-template\",0),oa(1,z0,3,2,\"ng-template\",null,1,Lh)),2&t){const t=aa(2);Ra(\"ngIf\",e.editMode)(\"ngIfElse\",t)}},directives:[Vd,F0,Ly,uE],styles:[\"[_nghost-%COMP%]{display:flex}\"]}),t})();const $0=[\"*\"],U0=[[[\"\",\"mat-list-avatar\",\"\"],[\"\",\"mat-list-icon\",\"\"],[\"\",\"matListAvatar\",\"\"],[\"\",\"matListIcon\",\"\"]],[[\"\",\"mat-line\",\"\"],[\"\",\"matLine\",\"\"]],\"*\"],j0=[\"[mat-list-avatar], [mat-list-icon], [matListAvatar], [matListIcon]\",\"[mat-line], [matLine]\",\"*\"],H0=Nb(zb(class{})),G0=zb(class{}),W0=new Ji(\"MatList\"),q0=new Ji(\"MatNavList\");let Y0=(()=>{class t extends H0{constructor(t){super(),this._elementRef=t,this._stateChanges=new C,\"action-list\"===this._getListType()&&t.nativeElement.classList.add(\"mat-action-list\")}_getListType(){const t=this._elementRef.nativeElement.nodeName.toLowerCase();return\"mat-list\"===t?\"list\":\"mat-action-list\"===t?\"action-list\":null}ngOnChanges(){this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-list\"],[\"mat-action-list\"]],hostAttrs:[1,\"mat-list\",\"mat-list-base\"],inputs:{disableRipple:\"disableRipple\",disabled:\"disabled\"},exportAs:[\"matList\"],features:[Yl([{provide:W0,useExisting:t}]),Uo,he],ngContentSelectors:$0,decls:1,vars:0,template:function(t,e){1&t&&(Qa(),Ja(0))},styles:['.mat-subheader{display:flex;box-sizing:border-box;padding:16px;align-items:center}.mat-list-base .mat-subheader{margin:0}.mat-list-base{padding-top:8px;display:block;-webkit-tap-highlight-color:transparent}.mat-list-base .mat-subheader{height:48px;line-height:16px}.mat-list-base .mat-subheader:first-child{margin-top:-8px}.mat-list-base .mat-list-item,.mat-list-base .mat-list-option{display:block;height:48px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base .mat-list-item .mat-list-item-content,.mat-list-base .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base .mat-list-item .mat-list-item-content-reverse,.mat-list-base .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base .mat-list-item .mat-list-item-ripple,.mat-list-base .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar,.mat-list-base .mat-list-option.mat-list-item-with-avatar{height:56px}.mat-list-base .mat-list-item.mat-2-line,.mat-list-base .mat-list-option.mat-2-line{height:72px}.mat-list-base .mat-list-item.mat-3-line,.mat-list-base .mat-list-option.mat-3-line{height:88px}.mat-list-base .mat-list-item.mat-multi-line,.mat-list-base .mat-list-option.mat-multi-line{height:auto}.mat-list-base .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base .mat-list-item .mat-list-text,.mat-list-base .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base .mat-list-item .mat-list-text>*,.mat-list-base .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base .mat-list-item .mat-list-text:empty,.mat-list-base .mat-list-option .mat-list-text:empty{display:none}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base .mat-list-item .mat-list-avatar,.mat-list-base .mat-list-option .mat-list-avatar{flex-shrink:0;width:40px;height:40px;border-radius:50%;object-fit:cover}.mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:72px;width:calc(100% - 72px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:72px}.mat-list-base .mat-list-item .mat-list-icon,.mat-list-base .mat-list-option .mat-list-icon{flex-shrink:0;width:24px;height:24px;font-size:24px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:64px;width:calc(100% - 64px)}[dir=rtl] .mat-list-base .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:64px}.mat-list-base .mat-list-item .mat-divider,.mat-list-base .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base .mat-list-item .mat-divider,[dir=rtl] .mat-list-base .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-list-base[dense]{padding-top:4px;display:block}.mat-list-base[dense] .mat-subheader{height:40px;line-height:8px}.mat-list-base[dense] .mat-subheader:first-child{margin-top:-4px}.mat-list-base[dense] .mat-list-item,.mat-list-base[dense] .mat-list-option{display:block;height:40px;-webkit-tap-highlight-color:transparent;width:100%;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-item-content,.mat-list-base[dense] .mat-list-option .mat-list-item-content{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;padding:0 16px;position:relative;height:inherit}.mat-list-base[dense] .mat-list-item .mat-list-item-content-reverse,.mat-list-base[dense] .mat-list-option .mat-list-item-content-reverse{display:flex;align-items:center;padding:0 16px;flex-direction:row-reverse;justify-content:space-around}.mat-list-base[dense] .mat-list-item .mat-list-item-ripple,.mat-list-base[dense] .mat-list-option .mat-list-item-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar{height:48px}.mat-list-base[dense] .mat-list-item.mat-2-line,.mat-list-base[dense] .mat-list-option.mat-2-line{height:60px}.mat-list-base[dense] .mat-list-item.mat-3-line,.mat-list-base[dense] .mat-list-option.mat-3-line{height:76px}.mat-list-base[dense] .mat-list-item.mat-multi-line,.mat-list-base[dense] .mat-list-option.mat-multi-line{height:auto}.mat-list-base[dense] .mat-list-item.mat-multi-line .mat-list-item-content,.mat-list-base[dense] .mat-list-option.mat-multi-line .mat-list-item-content{padding-top:16px;padding-bottom:16px}.mat-list-base[dense] .mat-list-item .mat-list-text,.mat-list-base[dense] .mat-list-option .mat-list-text{display:flex;flex-direction:column;flex:auto;box-sizing:border-box;overflow:hidden;padding:0}.mat-list-base[dense] .mat-list-item .mat-list-text>*,.mat-list-base[dense] .mat-list-option .mat-list-text>*{margin:0;padding:0;font-weight:normal;font-size:inherit}.mat-list-base[dense] .mat-list-item .mat-list-text:empty,.mat-list-base[dense] .mat-list-option .mat-list-text:empty{display:none}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:0;padding-left:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:0}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-left:0;padding-right:16px}[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-item.mat-list-option .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar .mat-list-item-content-reverse .mat-list-text,[dir=rtl] .mat-list-base[dense] .mat-list-option.mat-list-option .mat-list-item-content-reverse .mat-list-text{padding-right:0;padding-left:16px}.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-item.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content-reverse .mat-list-text,.mat-list-base[dense] .mat-list-option.mat-list-item-with-avatar.mat-list-option .mat-list-item-content .mat-list-text{padding-right:16px;padding-left:16px}.mat-list-base[dense] .mat-list-item .mat-list-avatar,.mat-list-base[dense] .mat-list-option .mat-list-avatar{flex-shrink:0;width:36px;height:36px;border-radius:50%;object-fit:cover}.mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:68px;width:calc(100% - 68px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-avatar~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-avatar~.mat-divider-inset{margin-left:auto;margin-right:68px}.mat-list-base[dense] .mat-list-item .mat-list-icon,.mat-list-base[dense] .mat-list-option .mat-list-icon{flex-shrink:0;width:20px;height:20px;font-size:20px;box-sizing:content-box;border-radius:50%;padding:4px}.mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:60px;width:calc(100% - 60px)}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-list-icon~.mat-divider-inset,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-list-icon~.mat-divider-inset{margin-left:auto;margin-right:60px}.mat-list-base[dense] .mat-list-item .mat-divider,.mat-list-base[dense] .mat-list-option .mat-divider{position:absolute;bottom:0;left:0;width:100%;margin:0}[dir=rtl] .mat-list-base[dense] .mat-list-item .mat-divider,[dir=rtl] .mat-list-base[dense] .mat-list-option .mat-divider{margin-left:auto;margin-right:0}.mat-list-base[dense] .mat-list-item .mat-divider.mat-divider-inset,.mat-list-base[dense] .mat-list-option .mat-divider.mat-divider-inset{position:absolute}.mat-nav-list a{text-decoration:none;color:inherit}.mat-nav-list .mat-list-item{cursor:pointer;outline:none}mat-action-list button{background:none;color:inherit;border:none;font:inherit;outline:inherit;-webkit-tap-highlight-color:transparent;text-align:left}[dir=rtl] mat-action-list button{text-align:right}mat-action-list button::-moz-focus-inner{border:0}mat-action-list .mat-list-item{cursor:pointer;outline:inherit}.mat-list-option:not(.mat-list-item-disabled){cursor:pointer;outline:none}.mat-list-item-disabled{pointer-events:none}.cdk-high-contrast-active .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active :host .mat-list-item-disabled{opacity:.5}.cdk-high-contrast-active .mat-selection-list:focus{outline-style:dotted}.cdk-high-contrast-active .mat-list-option:hover,.cdk-high-contrast-active .mat-list-option:focus,.cdk-high-contrast-active .mat-nav-list .mat-list-item:hover,.cdk-high-contrast-active .mat-nav-list .mat-list-item:focus,.cdk-high-contrast-active mat-action-list .mat-list-item:hover,.cdk-high-contrast-active mat-action-list .mat-list-item:focus{outline:dotted 1px;z-index:1}.cdk-high-contrast-active .mat-list-single-selected-option::after{content:\"\";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}.cdk-high-contrast-active [dir=rtl] .mat-list-single-selected-option::after{right:auto;left:16px}@media(hover: none){.mat-list-option:not(.mat-list-single-selected-option):not(.mat-list-item-disabled):hover,.mat-nav-list .mat-list-item:not(.mat-list-item-disabled):hover,.mat-action-list .mat-list-item:not(.mat-list-item-disabled):hover{background:none}}\\n'],encapsulation:2,changeDetection:0}),t})(),Z0=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-list-avatar\",\"\"],[\"\",\"matListAvatar\",\"\"]],hostAttrs:[1,\"mat-list-avatar\"]}),t})(),K0=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-list-icon\",\"\"],[\"\",\"matListIcon\",\"\"]],hostAttrs:[1,\"mat-list-icon\"]}),t})(),X0=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-subheader\",\"\"],[\"\",\"matSubheader\",\"\"]],hostAttrs:[1,\"mat-subheader\"]}),t})(),Q0=(()=>{class t extends G0{constructor(t,e,i,n){super(),this._element=t,this._isInteractiveList=!1,this._destroyed=new C,this._disabled=!1,this._isInteractiveList=!!(i||n&&\"action-list\"===n._getListType()),this._list=i||n;const s=this._getHostElement();\"button\"===s.nodeName.toLowerCase()&&!s.hasAttribute(\"type\")&&s.setAttribute(\"type\",\"button\"),this._list&&this._list._stateChanges.pipe(Of(this._destroyed)).subscribe(()=>{e.markForCheck()})}get disabled(){return this._disabled||!(!this._list||!this._list.disabled)}set disabled(t){this._disabled=Lf(t)}ngAfterContentInit(){!function(t,e,i=\"mat\"){t.changes.pipe(hg(t)).subscribe(({length:t})=>{sy(e,`${i}-2-line`,!1),sy(e,`${i}-3-line`,!1),sy(e,`${i}-multi-line`,!1),2===t||3===t?sy(e,`${i}-${t}-line`,!0):t>3&&sy(e,`${i}-multi-line`,!0)})}(this._lines,this._element)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_isRippleDisabled(){return!this._isInteractiveList||this.disableRipple||!(!this._list||!this._list.disableRipple)}_getHostElement(){return this._element.nativeElement}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa(q0,8),Oa(W0,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-list-item\"],[\"a\",\"mat-list-item\",\"\"],[\"button\",\"mat-list-item\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,Z0,5),Ih(i,K0,5),Ih(i,ny,5)),2&t){let t;Mh(t=Ph())&&(e._avatar=t.first),Mh(t=Ph())&&(e._icon=t.first),Mh(t=Ph())&&(e._lines=t)}},hostAttrs:[1,\"mat-list-item\",\"mat-focus-indicator\"],hostVars:6,hostBindings:function(t,e){2&t&&hl(\"mat-list-item-disabled\",e.disabled)(\"mat-list-item-avatar\",e._avatar||e._icon)(\"mat-list-item-with-avatar\",e._avatar||e._icon)},inputs:{disableRipple:\"disableRipple\",disabled:\"disabled\"},exportAs:[\"matListItem\"],features:[Uo],ngContentSelectors:j0,decls:6,vars:2,consts:[[1,\"mat-list-item-content\"],[\"mat-ripple\",\"\",1,\"mat-list-item-ripple\",3,\"matRippleTrigger\",\"matRippleDisabled\"],[1,\"mat-list-text\"]],template:function(t,e){1&t&&(Qa(U0),La(0,\"div\",0),Na(1,\"div\",1),Ja(2),La(3,\"div\",2),Ja(4,1),Fa(),Ja(5,2),Fa()),2&t&&(Cr(1),Ra(\"matRippleTrigger\",e._getHostElement())(\"matRippleDisabled\",e._isRippleDisabled()))},directives:[py],encapsulation:2,changeDetection:0}),t})(),J0=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[ry,fy,Fb,gy,np],ry,Fb,gy,Qq]}),t})();function t1(t,e){1&t&&(La(0,\"div\",4),xl(1,\" Ce filtre restreint les alertes \\xe0 certaines zones. \"),Fa())}function e1(t,e){1&t&&(La(0,\"div\",13),xl(1,\" Au moins une zone est n\\xe9cessaire pour d\\xe9finir la r\\xe8gle. \"),Fa())}function i1(t,e){if(1&t){const t=$a();La(0,\"app-zone-item\",14),Ga(\"delete\",function(){const e=Fe(t).$implicit;return Ka(2).deleteZone(e)}),Fa()}if(2&t){const t=e.$implicit,i=Ka(2);Ra(\"zone\",t)(\"editable\",!0)(\"disableEdition\",!i.zonesEditable)}}function n1(t,e){if(1&t){const t=$a();La(0,\"app-zone-form\",15),Ga(\"save\",function(e){return Fe(t),Ka(2).addCreatedZone(e)})(\"cancel\",function(){return Fe(t),Ka(2).hideCreateZoneForm()}),Fa()}2&t&&Ra(\"groupId\",Ka(2).groupId)}function s1(t,e){if(1&t){const t=$a();La(0,\"button\",16),La(1,\"span\"),xl(2,\"\\xa0Ajouter une zone\"),Fa(),Fa(),La(3,\"button\",17),Ga(\"click\",function(){return Fe(t),Ka(2).displayCreateZoneForm()}),xl(4,\" Cr\\xe9er une zone \"),Fa()}if(2&t){Ka();const t=aa(6),e=Ka();Ra(\"matMenuTriggerFor\",t)(\"disabled\",!e.zonesEditable),Cr(3),Ra(\"disabled\",!e.zonesEditable)}}function r1(t,e){if(1&t){const t=$a();La(0,\"button\",18),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka(2).addZone(e)}),xl(1),Fa()}if(2&t){const t=e.$implicit;Cr(1),Cl(\" \",t.name,\" \")}}function o1(t,e){if(1&t&&(oa(0,e1,2,0,\"div\",5),oa(1,i1,1,3,\"app-zone-item\",6),La(2,\"div\",7),oa(3,n1,1,1,\"app-zone-form\",8),oa(4,s1,5,3,\"ng-template\",9),Fa(),La(5,\"mat-menu\",10,11),oa(7,r1,2,1,\"button\",12),Fa()),2&t){const t=Ka();Ra(\"ngIf\",0===t.criterion.zones.length),Cr(1),Ra(\"ngForOf\",t.criterion.zones)(\"ngForTrackBy\",t.trackById),Cr(2),Ra(\"ngIf\",t.showCreateZoneForm),Cr(1),Ra(\"ngIf\",!t.showCreateZoneForm),Cr(3),Ra(\"ngForOf\",t.availableZones)}}function a1(t,e){if(1&t){const t=$a();La(0,\"mat-list-item\"),La(1,\"button\",21),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka(2).viewZone(e)}),xl(2),Fa(),Fa()}if(2&t){const t=e.$implicit;Cr(2),Cl(\" \",t.name,\" \")}}function l1(t,e){if(1&t&&(La(0,\"mat-list\",19),oa(1,a1,3,1,\"mat-list-item\",20),Fa()),2&t){const t=Ka();Cr(1),Ra(\"ngForOf\",t.criterion.zones)(\"ngForTrackBy\",t.trackById)}}let c1=(()=>{class t extends Gq{constructor(t,e,i){super(),this.editZoneService=t,this.mapService=e,this.zonesService=i,this.updateZones=new gh,this.availableZones=[],this.showCreateZoneForm=!1,this.zonesEditable=!0,this.usedZonesIds$=new Jp([]),this.groupId$=new Jp(null)}ngOnInit(){this.usedZonesIds$.next(this.criterion.zones.map(t=>t.id)),this.subscriptions.push(JT([this.zonesService.zones$,this.usedZonesIds$,this.groupId$]).subscribe(([t,e,i])=>{this.availableZones=t.filter(t=>t.group_id===i&&!e.includes(t.id))}),this.usedZonesIds$.pipe(kf(1)).subscribe(()=>{this.updateZones.next(null)}),this.editZoneService.editedZone$.pipe(Tf(),Oj(0)).subscribe(t=>{this.zonesEditable=!t}))}ngOnChanges(t){t.groupId&&(this.groupId$.next(t.groupId.currentValue),t.groupId.firstChange||(this.criterion.zones=[],this.usedZonesIds$.next([])))}displayCreateZoneForm(){this.showCreateZoneForm=!0}hideCreateZoneForm(){this.showCreateZoneForm=!1}addCreatedZone(t){this.criterion.zones.push(t),this.hideCreateZoneForm(),this.onChange(this.criterion)}viewZone(t){this.mapService.fitOnHexagons(t.h3indexes)}deleteZone(t){this.criterion.zones.splice(this.criterion.zones.findIndex(e=>e===t),1),this.usedZonesIds$.next(this.usedZonesIds$.value.filter(e=>e!==t.id)),this.onChange(this.criterion)}addZone(t){this.criterion.zones.push(t),this.usedZonesIds$.next(this.usedZonesIds$.value.concat(t.id)),this.onChange(this.criterion)}trackById(t,e){return e.id}writeValue(t){this.criterion=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){}}return t.\\u0275fac=function(e){return new(e||t)(Oa($J),Oa(Pj),Oa(OH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-zone-filter\"]],inputs:{criterion:[\"ngModel\",\"criterion\"],editable:\"editable\",groupId:\"groupId\"},outputs:{updateZones:\"updateZones\"},features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo,he],decls:5,vars:4,consts:[[1,\"alert-rule-criterion\"],[\"class\",\"alert-rule-criterion__description\",4,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"alert-rule-criterion__description\"],[\"class\",\"alert-rule-criterion__description error-message\",4,\"ngIf\"],[3,\"zone\",\"editable\",\"disableEdition\",\"delete\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[1,\"criterion-content\"],[\"class\",\"u-flex\",3,\"groupId\",\"save\",\"cancel\",4,\"ngIf\"],[3,\"ngIf\"],[1,\"add-zones-menu\"],[\"addZonesMenu\",\"matMenu\"],[\"mat-menu-item\",\"\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[1,\"alert-rule-criterion__description\",\"error-message\"],[3,\"zone\",\"editable\",\"disableEdition\",\"delete\"],[1,\"u-flex\",3,\"groupId\",\"save\",\"cancel\"],[\"mat-button\",\"\",\"title\",\"Ajouter une zone existante\",3,\"matMenuTriggerFor\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Cr\\xe9er une nouvelle zone\",3,\"disabled\",\"click\"],[\"mat-menu-item\",\"\",3,\"click\"],[\"dense\",\"\"],[4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[\"mat-button\",\"\",\"title\",\"Visualiser la zone\",1,\"u-flex\",3,\"click\"]],template:function(t,e){if(1&t&&(La(0,\"div\",0),oa(1,t1,2,0,\"div\",1),oa(2,o1,8,6,\"ng-template\",2),oa(3,l1,2,2,\"ng-template\",null,3,Lh),Fa()),2&t){const t=aa(4);ia(\"data-test\",\"criterion-zone\"),Cr(1),Ra(\"ngIf\",e.editable),Cr(1),Ra(\"ngIf\",e.editable)(\"ngIfElse\",t)}},directives:[Vd,Bd,T0,V0,F0,Ly,D0,S0,Y0,Q0],styles:[\".alert-rule-criterion[_ngcontent-%COMP%]{padding:.5em}.alert-rule-criterion__description[_ngcontent-%COMP%]{margin-bottom:.5em;font-size:14px}.add-zones-menu[_ngcontent-%COMP%]{max-height:256px}\"]}),t})();const h1=[\"thumbContainer\"],u1=[\"toggleBar\"],d1=[\"input\"],p1=function(t){return{enterDuration:t}},f1=[\"*\"],m1=new Ji(\"mat-slide-toggle-default-options\",{providedIn:\"root\",factory:()=>({disableToggleValue:!1})});let g1=0;const A1={provide:Uy,useExisting:at(()=>b1),multi:!0};class v1{constructor(t,e){this.source=t,this.checked=e}}const _1=Vb(Bb(zb(Nb(class{constructor(t){this._elementRef=t}}))));let b1=(()=>{class t extends _1{constructor(t,e,i,n,s,r){super(t),this._focusMonitor=e,this._changeDetectorRef=i,this.defaults=s,this._onChange=t=>{},this._onTouched=()=>{},this._uniqueId=\"mat-slide-toggle-\"+ ++g1,this._required=!1,this._checked=!1,this.name=null,this.id=this._uniqueId,this.labelPosition=\"after\",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new gh,this.toggleChange=new gh,this.tabIndex=parseInt(n)||0,this.color=this.defaultColor=s.color||\"accent\",this._noopAnimations=\"NoopAnimations\"===r}get required(){return this._required}set required(t){this._required=Lf(t)}get checked(){return this._checked}set checked(t){this._checked=Lf(t),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{\"keyboard\"===t||\"program\"===t?this._inputElement.nativeElement.focus():t||Promise.resolve().then(()=>this._onTouched())})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}_onChangeEvent(t){t.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(t){t.stopPropagation()}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}focus(t,e){e?this._focusMonitor.focusVia(this._inputElement,e,t):this._inputElement.nativeElement.focus(t)}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(new v1(this,this.checked))}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Vm),Oa(Mc),Yi(\"tabindex\"),Oa(m1),Oa(wb,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-slide-toggle\"]],viewQuery:function(t,e){if(1&t&&(Th(h1,5),Th(u1,5),Th(d1,5)),2&t){let t;Mh(t=Ph())&&(e._thumbEl=t.first),Mh(t=Ph())&&(e._thumbBarEl=t.first),Mh(t=Ph())&&(e._inputElement=t.first)}},hostAttrs:[1,\"mat-slide-toggle\"],hostVars:12,hostBindings:function(t,e){2&t&&(Il(\"id\",e.id),ia(\"tabindex\",e.disabled?null:-1)(\"aria-label\",null)(\"aria-labelledby\",null),hl(\"mat-checked\",e.checked)(\"mat-disabled\",e.disabled)(\"mat-slide-toggle-label-before\",\"before\"==e.labelPosition)(\"_mat-animation-noopable\",e._noopAnimations))},inputs:{disabled:\"disabled\",disableRipple:\"disableRipple\",color:\"color\",tabIndex:\"tabIndex\",name:\"name\",id:\"id\",labelPosition:\"labelPosition\",ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],required:\"required\",checked:\"checked\",ariaDescribedby:[\"aria-describedby\",\"ariaDescribedby\"]},outputs:{change:\"change\",toggleChange:\"toggleChange\"},exportAs:[\"matSlideToggle\"],features:[Yl([A1]),Uo],ngContentSelectors:f1,decls:16,vars:20,consts:[[1,\"mat-slide-toggle-label\"],[\"label\",\"\"],[1,\"mat-slide-toggle-bar\"],[\"toggleBar\",\"\"],[\"type\",\"checkbox\",\"role\",\"switch\",1,\"mat-slide-toggle-input\",\"cdk-visually-hidden\",3,\"id\",\"required\",\"tabIndex\",\"checked\",\"disabled\",\"change\",\"click\"],[\"input\",\"\"],[1,\"mat-slide-toggle-thumb-container\"],[\"thumbContainer\",\"\"],[1,\"mat-slide-toggle-thumb\"],[\"mat-ripple\",\"\",1,\"mat-slide-toggle-ripple\",\"mat-focus-indicator\",3,\"matRippleTrigger\",\"matRippleDisabled\",\"matRippleCentered\",\"matRippleRadius\",\"matRippleAnimation\"],[1,\"mat-ripple-element\",\"mat-slide-toggle-persistent-ripple\"],[1,\"mat-slide-toggle-content\",3,\"cdkObserveContent\"],[\"labelContent\",\"\"],[2,\"display\",\"none\"]],template:function(t,e){if(1&t&&(Qa(),La(0,\"label\",0,1),La(2,\"div\",2,3),La(4,\"input\",4,5),Ga(\"change\",function(t){return e._onChangeEvent(t)})(\"click\",function(t){return e._onInputClick(t)}),Fa(),La(6,\"div\",6,7),Na(8,\"div\",8),La(9,\"div\",9),Na(10,\"div\",10),Fa(),Fa(),Fa(),La(11,\"span\",11,12),Ga(\"cdkObserveContent\",function(){return e._onLabelTextChange()}),La(13,\"span\",13),xl(14,\"\\xa0\"),Fa(),Ja(15),Fa(),Fa()),2&t){const t=aa(1),i=aa(12);ia(\"for\",e.inputId),Cr(2),hl(\"mat-slide-toggle-bar-no-side-margin\",!i.textContent||!i.textContent.trim()),Cr(2),Ra(\"id\",e.inputId)(\"required\",e.required)(\"tabIndex\",e.tabIndex)(\"checked\",e.checked)(\"disabled\",e.disabled),ia(\"name\",e.name)(\"aria-checked\",e.checked.toString())(\"aria-label\",e.ariaLabel)(\"aria-labelledby\",e.ariaLabelledby)(\"aria-describedby\",e.ariaDescribedby),Cr(5),Ra(\"matRippleTrigger\",t)(\"matRippleDisabled\",e.disableRipple||e.disabled)(\"matRippleCentered\",!0)(\"matRippleRadius\",20)(\"matRippleAnimation\",ih(18,p1,e._noopAnimations?0:150))}},directives:[py,am],styles:[\".mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:transparent}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}.cdk-high-contrast-active .mat-slide-toggle.cdk-keyboard-focused .mat-slide-toggle-bar{outline:2px dotted;outline-offset:5px}\\n\"],encapsulation:2,changeDetection:0}),t})(),y1=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({}),t})(),w1=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[y1,fy,Fb,lm],y1,Fb]}),t})();const x1={speed:{key:\"speed\",title:\"Vitesse\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si la vitesse du navire est comprise dans un intervalle.\"},erraticRoute:{key:\"erraticRoute\",title:\"Route erratique\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte quand un navire change plusieurs fois de direction dans un intervalle de temps court.\"},transhipment:{key:\"transhipment\",title:\"Transbordement\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte quand deux navires ont des positions tr\\xe8s proches et une vitesse r\\xe9duite pendant un intervalle de temps prolong\\xe9.\"},aisInterruption:{key:\"aisInterruption\",title:\"Coupure AIS\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si un navire n'\\xe9met plus de donn\\xe9es AIS pendant un intervalle de temps.\"},passageInZone:{key:\"passageInZone\",title:\"Passage dans des zones\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si un navire passe dans certaines zones. Si plusieurs zones sont choisies, un navire doit \\xeatre pass\\xe9 dans toutes les zones pour d\\xe9clencher une alerte.\"},spoofing:{key:\"spoofing\",title:\"Spoofing AIS\",description:\"Ce crit\\xe8re d\\xe9clenche une alerte si un navire change de nom ou de MMSI en conservant le m\\xeame IMO.\"},identifier:{key:\"identifier\",title:\"Identifiant\",description:\"Ce filtre restreint les alertes aux navires dont les identifiants (nom, MMSI, IMO) correspondent \\xe0 ceux recherch\\xe9s.\"},fleet:{key:\"fleet\",title:\"Flotte\",description:\"Ce filtre restreint les alertes aux navires faisant partie des flottes s\\xe9lectionn\\xe9es.\"},flag:{key:\"flag\",title:\"Pavillon\",description:\"Ce filtre restreint les alertes aux navires dont le pavillon correspond \\xe0 ceux recherch\\xe9s.\"},type:{key:\"type\",title:\"Type de navire\",description:\"Ce filtre restreint les alertes aux navires dont le type du navire correspond \\xe0 ceux recherch\\xe9s.\"},time:{key:\"time\",title:\"P\\xe9riode d'analyse\",soon:!0,description:\"Ce filtre restreint l'analyse \\xe0 une p\\xe9riode de temps.\"},zone:{key:\"zone\",title:\"Zone\",description:\"Ce filtre restreint les alertes \\xe0 certaines zones.\"}};let S1=(()=>{class t extends Gq{constructor(){super(...arguments),this.editable=!1,this.criteriaLabels=x1}get enable(){var t;return null===(t=this.criterion)||void 0===t?void 0:t.enable}set enable(t){this.criterion.enable=t,this.onChange(this.criterion)}writeValue(t){this.criterion=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,inputs:{criterion:[\"ngModel\",\"criterion\"],editable:\"editable\"},features:[Uo]}),t})(),C1=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-chip-coming-soon\"]],decls:2,vars:0,consts:[[\"title\",\"Cette fonctionnalit\\xe9 n'est pas encore impl\\xe9ment\\xe9e mais le sera tr\\xe8s bient\\xf4t !\",1,\"chip\"]],template:function(t,e){1&t&&(La(0,\"div\",0),xl(1,\"Bient\\xf4t\"),Fa())},styles:[\".chip[_ngcontent-%COMP%]{display:inline-block;padding:3px 6px;border-radius:8px;font-size:.7em;line-height:1.5em;background-color:#55575f;color:#fff}\"],changeDetection:0}),t})();function k1(t,e){if(1&t){const t=$a();La(0,\"mat-slide-toggle\",6),Ga(\"ngModelChange\",function(e){return Fe(t),Ka().enableChange.next(e)}),Fa()}if(2&t){const t=Ka();Ra(\"name\",t.type.key)(\"title\",t.enable?\"D\\xe9sactiver\":\"Activer\")(\"ngModel\",t.enable)(\"disabled\",!t.editable)}}function E1(t,e){1&t&&Na(0,\"app-chip-coming-soon\")}function M1(t,e){if(1&t&&(La(0,\"div\",7),xl(1),Fa()),2&t){const t=Ka();Cr(1),Cl(\" \",t.type.description,\" \")}}function T1(t,e){1&t&&Ja(0,0,[\"*ngIf\",\"enable || enable === undefined\"])}const I1=[\"*\"];let P1=(()=>{class t extends Gq{constructor(){super(...arguments),this.enableChange=new gh}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alert-rule-criterion\"]],inputs:{type:\"type\",enable:\"enable\",editable:\"editable\"},outputs:{enableChange:\"enableChange\"},features:[Uo],ngContentSelectors:I1,decls:8,vars:8,consts:[[1,\"alert-rule-criterion\"],[1,\"alert-rule-criterion__title\"],[\"class\",\"alert-rule-criterion__toggle\",\"color\",\"primary\",3,\"name\",\"title\",\"ngModel\",\"disabled\",\"ngModelChange\",4,\"ngIf\"],[1,\"u-flex\"],[4,\"ngIf\"],[\"class\",\"alert-rule-criterion__description\",4,\"ngIf\"],[\"color\",\"primary\",1,\"alert-rule-criterion__toggle\",3,\"name\",\"title\",\"ngModel\",\"disabled\",\"ngModelChange\"],[1,\"alert-rule-criterion__description\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0),La(1,\"div\",1),xl(2),oa(3,k1,1,4,\"mat-slide-toggle\",2),Na(4,\"div\",3),oa(5,E1,1,0,\"app-chip-coming-soon\",4),Fa(),oa(6,M1,2,1,\"div\",5),oa(7,T1,1,0,\"ng-content\",4),Fa()),2&t&&(hl(\"alert-rule-criterion--active\",e.enable),ia(\"data-test\",\"criterion-\"+e.type.key),Cr(2),Cl(\" \",e.type.title,\" \"),Cr(1),Ra(\"ngIf\",void 0!==e.enable),Cr(2),Ra(\"ngIf\",e.type.soon),Cr(1),Ra(\"ngIf\",e.editable),Cr(1),Ra(\"ngIf\",e.enable||void 0===e.enable))},directives:[Vd,b1,Sw,nx,C1],styles:[\".alert-rule-criterion[_ngcontent-%COMP%]{padding:.5em}.alert-rule-criterion--active[_ngcontent-%COMP%]{background-color:#e6e9f7}.alert-rule-criterion__title[_ngcontent-%COMP%]{display:flex;margin:0;padding:.5em;color:#1515a6;font-size:18px}.alert-rule-criterion__toggle[_ngcontent-%COMP%]{margin-left:.5em}.alert-rule-criterion__description[_ngcontent-%COMP%]{margin-bottom:.5em;font-size:14px}\"],changeDetection:0}),t})(),O1=(()=>{class t extends S1{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ais-interruption-criterion\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),Fa()),2&t&&Ra(\"type\",e.criteriaLabels.aisInterruption)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[P1],encapsulation:2,changeDetection:0}),t})(),R1=(()=>{class t extends S1{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-transhipment-criterion\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),Fa()),2&t&&Ra(\"type\",e.criteriaLabels.transhipment)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[P1],encapsulation:2,changeDetection:0}),t})(),D1=(()=>{class t extends S1{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-erratic-route-criterion\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),Fa()),2&t&&Ra(\"type\",e.criteriaLabels.erraticRoute)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[P1],encapsulation:2,changeDetection:0}),t})();function L1(t,e){if(1&t){const t=$a();La(0,\"div\",4),La(1,\"ngx-slider\",5),Ga(\"valueChange\",function(e){return Fe(t),Ka(2).criterion.min=e})(\"highValueChange\",function(e){return Fe(t),Ka(2).criterion.max=e}),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(1),Ra(\"value\",t.criterion.min)(\"highValue\",t.criterion.max)(\"options\",t.speedSliderOptions)}}function F1(t,e){if(1&t&&xl(0),2&t){const t=Ka(2);kl(\" Vitesse : entre \",t.criterion.min,\" et \",t.criterion.max,\" \")}}function N1(t,e){if(1&t&&(oa(0,L1,2,3,\"ng-template\",2),oa(1,F1,1,2,\"ng-template\",null,3,Lh)),2&t){const t=aa(2);Ra(\"ngIf\",Ka().editable)(\"ngIfElse\",t)}}let B1=(()=>{class t extends S1{constructor(){super(...arguments),this.speedSliderOptions={floor:0,ceil:100,animate:!1}}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-speed-criterion\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\",\"app-slider\"],[\"name\",\"speed\",3,\"value\",\"highValue\",\"options\",\"valueChange\",\"highValueChange\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),oa(1,N1,3,2,\"ng-template\",1),Fa()),2&t&&(Ra(\"type\",e.criteriaLabels.speed)(\"enable\",e.enable)(\"editable\",e.editable),Cr(1),Ra(\"ngIf\",e.criterion.enable))},directives:[P1,Vd,kT],encapsulation:2,changeDetection:0}),t})();function z1(t,e,i){for(let n in e)if(e.hasOwnProperty(n)){const s=e[n];s?t.setProperty(n,s,(null==i?void 0:i.has(n))?\"important\":\"\"):t.removeProperty(n)}return t}function V1(t,e){const i=e?\"\":\"none\";z1(t.style,{\"touch-action\":e?\"\":\"none\",\"-webkit-user-drag\":e?\"\":\"none\",\"-webkit-tap-highlight-color\":e?\"\":\"transparent\",\"user-select\":i,\"-ms-user-select\":i,\"-webkit-user-select\":i,\"-moz-user-select\":i})}function $1(t,e,i){z1(t.style,{position:e?\"\":\"fixed\",top:e?\"\":\"0\",opacity:e?\"\":\"0\",left:e?\"\":\"-999em\"},i)}function U1(t,e){return e&&\"none\"!=e?t+\" \"+e:t}function j1(t){const e=t.toLowerCase().indexOf(\"ms\")>-1?1:1e3;return parseFloat(t)*e}function H1(t,e){return t.getPropertyValue(e).split(\",\").map(t=>t.trim())}function G1(t){const e=t.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}}function W1(t,e,i){const{top:n,bottom:s,left:r,right:o}=t;return i>=n&&i<=s&&e>=r&&e<=o}function q1(t,e,i){t.top+=e,t.bottom=t.top+t.height,t.left+=i,t.right=t.left+t.width}function Y1(t,e,i,n){const{top:s,right:r,bottom:o,left:a,width:l,height:c}=t,h=l*e,u=c*e;return n>s-u&&n<o+u&&i>a-h&&i<r+h}class Z1{constructor(t,e){this._document=t,this._viewportRuler=e,this.positions=new Map}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this._viewportRuler.getViewportScrollPosition()}),t.forEach(t=>{this.positions.set(t,{scrollPosition:{top:t.scrollTop,left:t.scrollLeft},clientRect:G1(t)})})}handleScroll(t){const e=nm(t),i=this.positions.get(e);if(!i)return null;const n=e===this._document?e.documentElement:e,s=i.scrollPosition;let r,o;if(e===this._document){const t=this._viewportRuler.getViewportScrollPosition();r=t.top,o=t.left}else r=e.scrollTop,o=e.scrollLeft;const a=s.top-r,l=s.left-o;return this.positions.forEach((t,i)=>{t.clientRect&&e!==i&&n.contains(i)&&q1(t.clientRect,a,l)}),s.top=r,s.left=o,{top:a,left:l}}}function K1(t){const e=t.cloneNode(!0),i=e.querySelectorAll(\"[id]\"),n=t.nodeName.toLowerCase();e.removeAttribute(\"id\");for(let s=0;s<i.length;s++)i[s].removeAttribute(\"id\");return\"canvas\"===n?t2(t,e):(\"input\"===n||\"select\"===n||\"textarea\"===n)&&J1(t,e),X1(\"canvas\",t,e,t2),X1(\"input, textarea, select\",t,e,J1),e}function X1(t,e,i,n){const s=e.querySelectorAll(t);if(s.length){const e=i.querySelectorAll(t);for(let t=0;t<s.length;t++)n(s[t],e[t])}}let Q1=0;function J1(t,e){\"file\"!==e.type&&(e.value=t.value),\"radio\"===e.type&&e.name&&(e.name=`mat-clone-${e.name}-${Q1++}`)}function t2(t,e){const i=e.getContext(\"2d\");if(i)try{i.drawImage(t,0,0)}catch(n){}}const e2=Qf({passive:!0}),i2=Qf({passive:!1}),n2=new Set([\"position\"]);class s2{constructor(t,e,i,n,s,r){this._config=e,this._document=i,this._ngZone=n,this._viewportRuler=s,this._dragDropRegistry=r,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=!1,this._moveEvents=new C,this._pointerMoveSubscription=d.EMPTY,this._pointerUpSubscription=d.EMPTY,this._scrollSubscription=d.EMPTY,this._resizeSubscription=d.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction=\"ltr\",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new C,this.started=new C,this.released=new C,this.ended=new C,this.entered=new C,this.exited=new C,this.dropped=new C,this.moved=this._moveEvents,this._pointerDown=t=>{if(this.beforeStarted.next(),this._handles.length){const e=this._handles.find(e=>{const i=nm(t);return!!i&&(i===e||e.contains(i))});e&&!this._disabledHandles.has(e)&&!this.disabled&&this._initializeDragSequence(e,t)}else this.disabled||this._initializeDragSequence(this._rootElement,t)},this._pointerMove=t=>{const e=this._getPointerPositionOnPage(t);if(!this._hasStartedDragging){if(Math.abs(e.x-this._pickupPositionOnPage.x)+Math.abs(e.y-this._pickupPositionOnPage.y)>=this._config.dragStartThreshold){const e=Date.now()>=this._dragStartTime+this._getDragStartDelay(t),i=this._dropContainer;if(!e)return void this._endDragSequence(t);(!i||!i.isDragging()&&!i.isReceiving())&&(t.preventDefault(),this._hasStartedDragging=!0,this._ngZone.run(()=>this._startDragSequence(t)))}return}this._boundaryElement&&(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=(this._preview||this._rootElement).getBoundingClientRect()),t.preventDefault();const i=this._getConstrainedPointerPosition(e);if(this._hasMoved=!0,this._lastKnownPointerPosition=e,this._updatePointerDirectionDelta(i),this._dropContainer)this._updateActiveDropContainer(i,e);else{const t=this._activeTransform;t.x=i.x-this._pickupPositionOnPage.x+this._passiveTransform.x,t.y=i.y-this._pickupPositionOnPage.y+this._passiveTransform.y,this._applyRootElementTransform(t.x,t.y),\"undefined\"!=typeof SVGElement&&this._rootElement instanceof SVGElement&&this._rootElement.setAttribute(\"transform\",`translate(${t.x} ${t.y})`)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:i,event:t,distance:this._getDragDistance(i),delta:this._pointerDirectionDelta})})},this._pointerUp=t=>{this._endDragSequence(t)},this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new Z1(i,s),r.registerDragItem(this)}get disabled(){return this._disabled||!(!this._dropContainer||!this._dropContainer.disabled)}set disabled(t){const e=Lf(t);e!==this._disabled&&(this._disabled=e,this._toggleNativeDragInteractions(),this._handles.forEach(t=>V1(t,e)))}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(t=>Vf(t)),this._handles.forEach(t=>V1(t,this.disabled)),this._toggleNativeDragInteractions();const e=new Set;return this._disabledHandles.forEach(t=>{this._handles.indexOf(t)>-1&&e.add(t)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){const e=Vf(t);return e!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{e.addEventListener(\"mousedown\",this._pointerDown,i2),e.addEventListener(\"touchstart\",this._pointerDown,e2)}),this._initialTransform=void 0,this._rootElement=e),\"undefined\"!=typeof SVGElement&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?Vf(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&a2(this._rootElement),a2(this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeSubscriptions(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||\"\",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),V1(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),V1(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){const t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){const t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeSubscriptions(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe()}_destroyPreview(){this._preview&&a2(this._preview),this._previewRef&&this._previewRef.destroy(),this._preview=this._previewRef=null}_destroyPlaceholder(){this._placeholder&&a2(this._placeholder),this._placeholderRef&&this._placeholderRef.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeSubscriptions(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),this._hasStartedDragging))if(this.released.next({source:this}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;const e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){l2(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();const e=this._dropContainer;if(e){const t=this._rootElement,i=t.parentNode,n=this._placeholder=this._createPlaceholderElement(),s=this._anchor=this._anchor||this._document.createComment(\"\"),r=this._getShadowRoot();i.insertBefore(s,t),this._initialTransform=t.style.transform||\"\",this._preview=this._createPreviewElement(),$1(t,!1,n2),this._document.body.appendChild(i.replaceChild(n,t)),this._getPreviewInsertionPoint(i,r).appendChild(this._preview),this.started.next({source:this}),e.start(),this._initialContainer=e,this._initialIndex=e.getItemIndex(this)}else this.started.next({source:this}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(e?e.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();const i=this.isDragging(),n=l2(e),s=!n&&0!==e.button,r=this._rootElement,o=nm(e),a=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+800>Date.now(),l=n?Tm(e):Mm(e);if(o&&o.draggable&&\"mousedown\"===e.type&&e.preventDefault(),i||s||a||l)return;this._handles.length&&(this._rootElementTapHighlight=r.style.webkitTapHighlightColor||\"\",r.style.webkitTapHighlightColor=\"transparent\"),this._hasStartedDragging=this._hasMoved=!1,this._removeSubscriptions(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>this._updateOnScroll(t)),this._boundaryElement&&(this._boundaryRect=G1(this._boundaryElement));const c=this._previewTemplate;this._pickupPositionInElement=c&&c.template&&!c.matchSize?{x:0,y:0}:this._getPointerPositionInElement(t,e);const h=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:h.x,y:h.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){$1(this._rootElement,!0,n2),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{const e=this._dropContainer,i=e.getItemIndex(this),n=this._getPointerPositionOnPage(t),s=this._getDragDistance(n),r=e._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:s,dropPoint:n}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:r,distance:s,dropPoint:n}),e.drop(this,i,this._initialIndex,this._initialContainer,r,s,n),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:i,y:n}){let s=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!s&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(s=this._initialContainer),s&&s!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=s,this._dropContainer.enter(this,t,e,s===this._initialContainer&&s.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:s,currentIndex:s.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,n),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_createPreviewElement(){const t=this._previewTemplate,e=this.previewClass,i=t?t.template:null;let n;if(i&&t){const e=t.matchSize?this._rootElement.getBoundingClientRect():null,s=t.viewContainer.createEmbeddedView(i,t.context);s.detectChanges(),n=c2(s,this._document),this._previewRef=s,t.matchSize?h2(n,e):n.style.transform=r2(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else{const t=this._rootElement;n=K1(t),h2(n,t.getBoundingClientRect()),this._initialTransform&&(n.style.transform=this._initialTransform)}return z1(n.style,{\"pointer-events\":\"none\",margin:\"0\",position:\"fixed\",top:\"0\",left:\"0\",\"z-index\":`${this._config.zIndex||1e3}`},n2),V1(n,!1),n.classList.add(\"cdk-drag-preview\"),n.setAttribute(\"dir\",this._direction),e&&(Array.isArray(e)?e.forEach(t=>n.classList.add(t)):n.classList.add(e)),n}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();const t=this._placeholder.getBoundingClientRect();this._preview.classList.add(\"cdk-drag-animating\"),this._applyPreviewTransform(t.left,t.top);const e=function(t){const e=getComputedStyle(t),i=H1(e,\"transition-property\"),n=i.find(t=>\"transform\"===t||\"all\"===t);if(!n)return 0;const s=i.indexOf(n),r=H1(e,\"transition-duration\"),o=H1(e,\"transition-delay\");return j1(r[s])+j1(o[s])}(this._preview);return 0===e?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(t=>{const i=e=>{var s;(!e||nm(e)===this._preview&&\"transform\"===e.propertyName)&&(null===(s=this._preview)||void 0===s||s.removeEventListener(\"transitionend\",i),t(),clearTimeout(n))},n=setTimeout(i,1.5*e);this._preview.addEventListener(\"transitionend\",i)}))}_createPlaceholderElement(){const t=this._placeholderTemplate,e=t?t.template:null;let i;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),i=c2(this._placeholderRef,this._document)):i=K1(this._rootElement),i.classList.add(\"cdk-drag-placeholder\"),i}_getPointerPositionInElement(t,e){const i=this._rootElement.getBoundingClientRect(),n=t===this._rootElement?null:t,s=n?n.getBoundingClientRect():i,r=l2(e)?e.targetTouches[0]:e,o=this._getViewportScrollPosition();return{x:s.left-i.left+(r.pageX-s.left-o.left),y:s.top-i.top+(r.pageY-s.top-o.top)}}_getPointerPositionOnPage(t){const e=this._getViewportScrollPosition(),i=l2(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,n=i.pageX-e.left,s=i.pageY-e.top;if(this._ownerSVGElement){const t=this._ownerSVGElement.getScreenCTM();if(t){const e=this._ownerSVGElement.createSVGPoint();return e.x=n,e.y=s,e.matrixTransform(t.inverse())}}return{x:n,y:s}}_getConstrainedPointerPosition(t){const e=this._dropContainer?this._dropContainer.lockAxis:null;let{x:i,y:n}=this.constrainPosition?this.constrainPosition(t,this):t;if(\"x\"===this.lockAxis||\"x\"===e?n=this._pickupPositionOnPage.y:(\"y\"===this.lockAxis||\"y\"===e)&&(i=this._pickupPositionOnPage.x),this._boundaryRect){const{x:t,y:e}=this._pickupPositionInElement,s=this._boundaryRect,r=this._previewRect,o=s.top+e,a=s.bottom-(r.height-e);i=o2(i,s.left+t,s.right-(r.width-t)),n=o2(n,o,a)}return{x:i,y:n}}_updatePointerDirectionDelta(t){const{x:e,y:i}=t,n=this._pointerDirectionDelta,s=this._pointerPositionAtLastDirectionChange,r=Math.abs(e-s.x),o=Math.abs(i-s.y);return r>this._config.pointerDirectionChangeThreshold&&(n.x=e>s.x?1:-1,s.x=e),o>this._config.pointerDirectionChangeThreshold&&(n.y=i>s.y?1:-1,s.y=i),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;const t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,V1(this._rootElement,t))}_removeRootElementListeners(t){t.removeEventListener(\"mousedown\",this._pointerDown,i2),t.removeEventListener(\"touchstart\",this._pointerDown,e2)}_applyRootElementTransform(t,e){const i=r2(t,e);null==this._initialTransform&&(this._initialTransform=this._rootElement.style.transform&&\"none\"!=this._rootElement.style.transform?this._rootElement.style.transform:\"\"),this._rootElement.style.transform=U1(i,this._initialTransform)}_applyPreviewTransform(t,e){var i;const n=(null===(i=this._previewTemplate)||void 0===i?void 0:i.template)?void 0:this._initialTransform,s=r2(t,e);this._preview.style.transform=U1(s,n)}_getDragDistance(t){const e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(0===t&&0===e||this.isDragging()||!this._boundaryElement)return;const i=this._boundaryElement.getBoundingClientRect(),n=this._rootElement.getBoundingClientRect();if(0===i.width&&0===i.height||0===n.width&&0===n.height)return;const s=i.left-n.left,r=n.right-i.right,o=i.top-n.top,a=n.bottom-i.bottom;i.width>n.width?(s>0&&(t+=s),r>0&&(t-=r)):t=0,i.height>n.height?(o>0&&(e+=o),a>0&&(e-=a)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){const e=this.dragStartDelay;return\"number\"==typeof e?e:l2(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){const e=this._parentPositions.handleScroll(t);if(e){const i=nm(t);this._boundaryRect&&(i===this._document||i!==this._boundaryElement&&i.contains(this._boundaryElement))&&q1(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){const t=this._parentPositions.positions.get(this._document);return t?t.scrollPosition:this._viewportRuler.getViewportScrollPosition()}_getShadowRoot(){return void 0===this._cachedShadowRoot&&(this._cachedShadowRoot=em(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){const i=this._previewContainer||\"global\";if(\"parent\"===i)return t;if(\"global\"===i){const t=this._document;return e||t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement||t.msFullscreenElement||t.body}return Vf(i)}}function r2(t,e){return`translate3d(${Math.round(t)}px, ${Math.round(e)}px, 0)`}function o2(t,e,i){return Math.max(e,Math.min(i,t))}function a2(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function l2(t){return\"t\"===t.type[0]}function c2(t,e){const i=t.rootNodes;if(1===i.length&&i[0].nodeType===e.ELEMENT_NODE)return i[0];const n=e.createElement(\"div\");return i.forEach(t=>n.appendChild(t)),n}function h2(t,e){t.style.width=`${e.width}px`,t.style.height=`${e.height}px`,t.style.transform=r2(e.left,e.top)}function u2(t,e,i){const n=d2(e,t.length-1),s=d2(i,t.length-1);if(n===s)return;const r=t[n],o=s<n?-1:1;for(let a=n;a!==s;a+=o)t[a]=t[a+o];t[s]=r}function d2(t,e){return Math.max(0,Math.min(e,t))}class p2{constructor(t,e,i,n,s){this._dragDropRegistry=e,this._ngZone=n,this._viewportRuler=s,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new C,this.entered=new C,this.exited=new C,this.dropped=new C,this.sorted=new C,this._isDragging=!1,this._itemPositions=[],this._previousSwap={drag:null,delta:0,overlaps:!1},this._draggables=[],this._siblings=[],this._orientation=\"vertical\",this._activeSiblings=new Set,this._direction=\"ltr\",this._viewportScrollSubscription=d.EMPTY,this._verticalScrollDirection=0,this._horizontalScrollDirection=0,this._stopScrollTimers=new C,this._cachedShadowRoot=null,this._startScrollInterval=()=>{this._stopScrolling(),Wq(0,Zm).pipe(Of(this._stopScrollTimers)).subscribe(()=>{const t=this._scrollNode,e=this.autoScrollStep;1===this._verticalScrollDirection?m2(t,-e):2===this._verticalScrollDirection&&m2(t,e),1===this._horizontalScrollDirection?g2(t,-e):2===this._horizontalScrollDirection&&g2(t,e)})},this.element=Vf(t),this._document=i,this.withScrollableParents([this.element]),e.registerDropContainer(this),this._parentPositions=new Z1(i,s)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,i,n){let s;this._draggingStarted(),null==n?(s=this.sortingDisabled?this._draggables.indexOf(t):-1,-1===s&&(s=this._getItemIndexFromPointerPosition(t,e,i))):s=n;const r=this._activeDraggables,o=r.indexOf(t),a=t.getPlaceholderElement();let l=r[s];if(l===t&&(l=r[s+1]),o>-1&&r.splice(o,1),l&&!this._dragDropRegistry.isDragging(l)){const e=l.getRootElement();e.parentElement.insertBefore(a,e),r.splice(s,0,t)}else if(this._shouldEnterAsFirstChild(e,i)){const e=r[0].getRootElement();e.parentNode.insertBefore(a,e),r.unshift(t)}else Vf(this.element).appendChild(a),r.push(t);a.style.transform=\"\",this._cacheItemPositions(),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,i,n,s,r,o){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:i,container:this,previousContainer:n,isPointerOverContainer:s,distance:r,dropPoint:o})}withItems(t){const e=this._draggables;return this._draggables=t,t.forEach(t=>t._withDropContainer(this)),this.isDragging()&&(e.filter(t=>t.isDragging()).every(e=>-1===t.indexOf(e))?this._reset():this._cacheItems()),this}withDirection(t){return this._direction=t,this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){return this._orientation=t,this}withScrollableParents(t){const e=Vf(this.element);return this._scrollableElements=-1===t.indexOf(e)?[e,...t]:t.slice(),this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?f2(\"horizontal\"===this._orientation&&\"rtl\"===this._direction?this._itemPositions.slice().reverse():this._itemPositions,e=>e.drag===t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,i,n){if(this.sortingDisabled||!this._clientRect||!Y1(this._clientRect,.05,e,i))return;const s=this._itemPositions,r=this._getItemIndexFromPointerPosition(t,e,i,n);if(-1===r&&s.length>0)return;const o=\"horizontal\"===this._orientation,a=f2(s,e=>e.drag===t),l=s[r],c=l.clientRect,h=a>r?1:-1,u=this._getItemOffsetPx(s[a].clientRect,c,h),d=this._getSiblingOffsetPx(a,s,h),p=s.slice();u2(s,a,r),this.sorted.next({previousIndex:a,currentIndex:r,container:this,item:t}),s.forEach((e,i)=>{if(p[i]===e)return;const n=e.drag===t,s=n?u:d,r=n?t.getPlaceholderElement():e.drag.getRootElement();e.offset+=s,o?(r.style.transform=U1(`translate3d(${Math.round(e.offset)}px, 0, 0)`,e.initialTransform),q1(e.clientRect,0,s)):(r.style.transform=U1(`translate3d(0, ${Math.round(e.offset)}px, 0)`,e.initialTransform),q1(e.clientRect,s,0))}),this._previousSwap.overlaps=W1(c,e,i),this._previousSwap.drag=l.drag,this._previousSwap.delta=o?n.x:n.y}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let i,n=0,s=0;if(this._parentPositions.positions.forEach((r,o)=>{o===this._document||!r.clientRect||i||Y1(r.clientRect,.05,t,e)&&([n,s]=function(t,e,i,n){const s=A2(e,n),r=v2(e,i);let o=0,a=0;if(s){const e=t.scrollTop;1===s?e>0&&(o=1):t.scrollHeight-e>t.clientHeight&&(o=2)}if(r){const e=t.scrollLeft;1===r?e>0&&(a=1):t.scrollWidth-e>t.clientWidth&&(a=2)}return[o,a]}(o,r.clientRect,t,e),(n||s)&&(i=o))}),!n&&!s){const{width:r,height:o}=this._viewportRuler.getViewportSize(),a={width:r,height:o,top:0,right:r,bottom:o,left:0};n=A2(a,e),s=v2(a,t),i=window}i&&(n!==this._verticalScrollDirection||s!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=s,this._scrollNode=i,(n||s)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){const t=Vf(this.element).style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||\"\",t.scrollSnapType=t.msScrollSnapType=\"none\",this._cacheItems(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){const t=Vf(this.element);this._parentPositions.cache(this._scrollableElements),this._clientRect=this._parentPositions.positions.get(t).clientRect}_cacheItemPositions(){const t=\"horizontal\"===this._orientation;this._itemPositions=this._activeDraggables.map(t=>{const e=t.getVisibleElement();return{drag:t,offset:0,initialTransform:e.style.transform||\"\",clientRect:G1(e)}}).sort((e,i)=>t?e.clientRect.left-i.clientRect.left:e.clientRect.top-i.clientRect.top)}_reset(){this._isDragging=!1;const t=Vf(this.element).style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._activeDraggables.forEach(t=>{var e;const i=t.getRootElement();if(i){const n=null===(e=this._itemPositions.find(e=>e.drag===t))||void 0===e?void 0:e.initialTransform;i.style.transform=n||\"\"}}),this._siblings.forEach(t=>t._stopReceiving(this)),this._activeDraggables=[],this._itemPositions=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1,this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_getSiblingOffsetPx(t,e,i){const n=\"horizontal\"===this._orientation,s=e[t].clientRect,r=e[t+-1*i];let o=s[n?\"width\":\"height\"]*i;if(r){const t=n?\"left\":\"top\",e=n?\"right\":\"bottom\";-1===i?o-=r.clientRect[t]-s[e]:o+=s[t]-r.clientRect[e]}return o}_getItemOffsetPx(t,e,i){const n=\"horizontal\"===this._orientation;let s=n?e.left-t.left:e.top-t.top;return-1===i&&(s+=n?e.width-t.width:e.height-t.height),s}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;const i=this._itemPositions,n=\"horizontal\"===this._orientation;if(i[0].drag!==this._activeDraggables[0]){const s=i[i.length-1].clientRect;return n?t>=s.right:e>=s.bottom}{const s=i[0].clientRect;return n?t<=s.left:e<=s.top}}_getItemIndexFromPointerPosition(t,e,i,n){const s=\"horizontal\"===this._orientation,r=f2(this._itemPositions,({drag:r,clientRect:o},a,l)=>{if(r===t)return l.length<2;if(n){const t=s?n.x:n.y;if(r===this._previousSwap.drag&&this._previousSwap.overlaps&&t===this._previousSwap.delta)return!1}return s?e>=Math.floor(o.left)&&e<Math.floor(o.right):i>=Math.floor(o.top)&&i<Math.floor(o.bottom)});return-1!==r&&this.sortPredicate(r,t,this)?r:-1}_cacheItems(){this._activeDraggables=this._draggables.slice(),this._cacheItemPositions(),this._cacheParentPositions()}_isOverContainer(t,e){return null!=this._clientRect&&W1(this._clientRect,t,e)}_getSiblingContainerFromPosition(t,e,i){return this._siblings.find(n=>n._canReceive(t,e,i))}_canReceive(t,e,i){if(!this._clientRect||!W1(this._clientRect,e,i)||!this.enterPredicate(t,this))return!1;const n=this._getShadowRoot().elementFromPoint(e,i);if(!n)return!1;const s=Vf(this.element);return n===s||s.contains(n)}_startReceiving(t,e){const i=this._activeSiblings;!i.has(t)&&e.every(t=>this.enterPredicate(t,this)||this._draggables.indexOf(t)>-1)&&(i.add(t),this._cacheParentPositions(),this._listenToScrollEvents())}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe()}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){const e=this._parentPositions.handleScroll(t);e&&(this._itemPositions.forEach(({clientRect:t})=>{q1(t,e.top,e.left)}),this._itemPositions.forEach(({drag:t})=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()}))}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){const t=em(Vf(this.element));this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){const t=this._activeDraggables.filter(t=>t.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}}function f2(t,e){for(let i=0;i<t.length;i++)if(e(t[i],i,t))return i;return-1}function m2(t,e){t===window?t.scrollBy(0,e):t.scrollTop+=e}function g2(t,e){t===window?t.scrollBy(e,0):t.scrollLeft+=e}function A2(t,e){const{top:i,bottom:n,height:s}=t,r=.05*s;return e>=i-r&&e<=i+r?1:e>=n-r&&e<=n+r?2:0}function v2(t,e){const{left:i,right:n,width:s}=t,r=.05*s;return e>=i-r&&e<=i+r?1:e>=n-r&&e<=n+r?2:0}const _2=Qf({passive:!1,capture:!0});let b2=(()=>{class t{constructor(t,e){this._ngZone=t,this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=[],this._globalListeners=new Map,this._draggingPredicate=t=>t.isDragging(),this.pointerMove=new C,this.pointerUp=new C,this.scroll=new C,this._preventDefaultWhileDragging=t=>{this._activeDragInstances.length>0&&t.preventDefault()},this._persistentTouchmoveListener=t=>{this._activeDragInstances.length>0&&(this._activeDragInstances.some(this._draggingPredicate)&&t.preventDefault(),this.pointerMove.next(t))},this._document=e}registerDropContainer(t){this._dropInstances.has(t)||this._dropInstances.add(t)}registerDragItem(t){this._dragInstances.add(t),1===this._dragInstances.size&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener(\"touchmove\",this._persistentTouchmoveListener,_2)})}removeDropContainer(t){this._dropInstances.delete(t)}removeDragItem(t){this._dragInstances.delete(t),this.stopDragging(t),0===this._dragInstances.size&&this._document.removeEventListener(\"touchmove\",this._persistentTouchmoveListener,_2)}startDragging(t,e){if(!(this._activeDragInstances.indexOf(t)>-1)&&(this._activeDragInstances.push(t),1===this._activeDragInstances.length)){const t=e.type.startsWith(\"touch\");this._globalListeners.set(t?\"touchend\":\"mouseup\",{handler:t=>this.pointerUp.next(t),options:!0}).set(\"scroll\",{handler:t=>this.scroll.next(t),options:!0}).set(\"selectstart\",{handler:this._preventDefaultWhileDragging,options:_2}),t||this._globalListeners.set(\"mousemove\",{handler:t=>this.pointerMove.next(t),options:_2}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((t,e)=>{this._document.addEventListener(e,t.handler,t.options)})})}}stopDragging(t){const e=this._activeDragInstances.indexOf(t);e>-1&&(this._activeDragInstances.splice(e,1),0===this._activeDragInstances.length&&this._clearGlobalListeners())}isDragging(t){return this._activeDragInstances.indexOf(t)>-1}scrolled(t){const e=[this.scroll];return t&&t!==this._document&&e.push(new b(e=>this._ngZone.runOutsideAngular(()=>{const i=t=>{this._activeDragInstances.length&&e.next(t)};return t.addEventListener(\"scroll\",i,!0),()=>{t.removeEventListener(\"scroll\",i,!0)}}))),q(...e)}ngOnDestroy(){this._dragInstances.forEach(t=>this.removeDragItem(t)),this._dropInstances.forEach(t=>this.removeDropContainer(t)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((t,e)=>{this._document.removeEventListener(e,t.handler,t.options)}),this._globalListeners.clear()}}return t.\\u0275fac=function(e){return new(e||t)(Mn(nu),Mn(Fu))},t.\\u0275prov=mt({factory:function(){return new t(Mn(nu),Mn(Fu))},token:t,providedIn:\"root\"}),t})();const y2={dragStartThreshold:5,pointerDirectionChangeThreshold:5};let w2=(()=>{class t{constructor(t,e,i,n){this._document=t,this._ngZone=e,this._viewportRuler=i,this._dragDropRegistry=n}createDrag(t,e=y2){return new s2(t,e,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(t){return new p2(t,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(Fu),Mn(nu),Mn(Gg),Mn(b2))},t.\\u0275prov=mt({factory:function(){return new t(Mn(Fu),Mn(nu),Mn(Gg),Mn(b2))},token:t,providedIn:\"root\"}),t})();const x2=new Ji(\"CDK_DRAG_PARENT\"),S2=new Ji(\"CdkDropListGroup\"),C2=new Ji(\"CDK_DRAG_CONFIG\");let k2=0;const E2=new Ji(\"CdkDropList\");let M2=(()=>{class t{constructor(e,i,n,s,r,o,a){this.element=e,this._changeDetectorRef=n,this._scrollDispatcher=s,this._dir=r,this._group=o,this._destroyed=new C,this.connectedTo=[],this.id=\"cdk-drop-list-\"+k2++,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.dropped=new gh,this.entered=new gh,this.exited=new gh,this.sorted=new gh,this._unsortedItems=new Set,this._dropListRef=i.createDropList(e),this._dropListRef.data=this,a&&this._assignDefaults(a),this._dropListRef.enterPredicate=(t,e)=>this.enterPredicate(t.data,e.data),this._dropListRef.sortPredicate=(t,e,i)=>this.sortPredicate(t,e.data,i.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),t._dropLists.push(this),o&&o._items.add(this)}get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(t){this._dropListRef.disabled=this._disabled=Lf(t)}addItem(t){this._unsortedItems.add(t),this._dropListRef.isDragging()&&this._syncItemsWithRef()}removeItem(t){this._unsortedItems.delete(t),this._dropListRef.isDragging()&&this._syncItemsWithRef()}getSortedItems(){return Array.from(this._unsortedItems).sort((t,e)=>t._dragRef.getVisibleElement().compareDocumentPosition(e._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){const e=t._dropLists.indexOf(this);e>-1&&t._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(hg(this._dir.value),Of(this._destroyed)).subscribe(t=>e.withDirection(t)),e.beforeStarted.subscribe(()=>{const i=Bf(this.connectedTo).map(e=>\"string\"==typeof e?t._dropLists.find(t=>t.id===e):e);if(this._group&&this._group._items.forEach(t=>{-1===i.indexOf(t)&&i.push(t)}),!this._scrollableParentsResolved){const t=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(t=>t.getElementRef().nativeElement);this._dropListRef.withScrollableParents(t),this._scrollableParentsResolved=!0}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=Lf(this.sortingDisabled),e.autoScrollDisabled=Lf(this.autoScrollDisabled),e.autoScrollStep=Ff(this.autoScrollStep,2),e.connectedTo(i.filter(t=>t&&t!==this).map(t=>t._dropListRef)).withOrientation(this.orientation)})}_handleEvents(t){t.beforeStarted.subscribe(()=>{this._syncItemsWithRef(),this._changeDetectorRef.markForCheck()}),t.entered.subscribe(t=>{this.entered.emit({container:this,item:t.item.data,currentIndex:t.currentIndex})}),t.exited.subscribe(t=>{this.exited.emit({container:this,item:t.item.data}),this._changeDetectorRef.markForCheck()}),t.sorted.subscribe(t=>{this.sorted.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,container:this,item:t.item.data})}),t.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,item:t.item.data,isPointerOverContainer:t.isPointerOverContainer,distance:t.distance,dropPoint:t.dropPoint}),this._changeDetectorRef.markForCheck()})}_assignDefaults(t){const{lockAxis:e,draggingDisabled:i,sortingDisabled:n,listAutoScrollDisabled:s,listOrientation:r}=t;this.disabled=null!=i&&i,this.sortingDisabled=null!=n&&n,this.autoScrollDisabled=null!=s&&s,this.orientation=r||\"vertical\",e&&(this.lockAxis=e)}_syncItemsWithRef(){this._dropListRef.withItems(this.getSortedItems().map(t=>t._dragRef))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(w2),Oa(Mc),Oa(jg),Oa(Eg,8),Oa(S2,12),Oa(C2,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkDropList\",\"\"],[\"cdk-drop-list\"]],hostAttrs:[1,\"cdk-drop-list\"],hostVars:7,hostBindings:function(t,e){2&t&&(ia(\"id\",e.id),hl(\"cdk-drop-list-disabled\",e.disabled)(\"cdk-drop-list-dragging\",e._dropListRef.isDragging())(\"cdk-drop-list-receiving\",e._dropListRef.isReceiving()))},inputs:{connectedTo:[\"cdkDropListConnectedTo\",\"connectedTo\"],id:\"id\",enterPredicate:[\"cdkDropListEnterPredicate\",\"enterPredicate\"],sortPredicate:[\"cdkDropListSortPredicate\",\"sortPredicate\"],disabled:[\"cdkDropListDisabled\",\"disabled\"],sortingDisabled:[\"cdkDropListSortingDisabled\",\"sortingDisabled\"],autoScrollDisabled:[\"cdkDropListAutoScrollDisabled\",\"autoScrollDisabled\"],orientation:[\"cdkDropListOrientation\",\"orientation\"],lockAxis:[\"cdkDropListLockAxis\",\"lockAxis\"],data:[\"cdkDropListData\",\"data\"],autoScrollStep:[\"cdkDropListAutoScrollStep\",\"autoScrollStep\"]},outputs:{dropped:\"cdkDropListDropped\",entered:\"cdkDropListEntered\",exited:\"cdkDropListExited\",sorted:\"cdkDropListSorted\"},exportAs:[\"cdkDropList\"],features:[Yl([{provide:S2,useValue:void 0},{provide:E2,useExisting:t}])]}),t._dropLists=[],t})();const T2=new Ji(\"CdkDragHandle\");let I2=(()=>{class t{constructor(t,e){this.element=t,this._stateChanges=new C,this._disabled=!1,this._parentDrag=e}get disabled(){return this._disabled}set disabled(t){this._disabled=Lf(t),this._stateChanges.next(this)}ngOnDestroy(){this._stateChanges.complete()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(x2,12))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkDragHandle\",\"\"]],hostAttrs:[1,\"cdk-drag-handle\"],inputs:{disabled:[\"cdkDragHandleDisabled\",\"disabled\"]},features:[Yl([{provide:T2,useExisting:t}])]}),t})();const P2=new Ji(\"CdkDragPlaceholder\");let O2=(()=>{class t{constructor(t){this.templateRef=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc))},t.\\u0275dir=Xt({type:t,selectors:[[\"ng-template\",\"cdkDragPlaceholder\",\"\"]],inputs:{data:\"data\"},features:[Yl([{provide:P2,useExisting:t}])]}),t})();const R2=new Ji(\"CdkDragPreview\");let D2=(()=>{class t{constructor(e,i,n,s,r,o,a,l,c,h,u){this.element=e,this.dropContainer=i,this._ngZone=s,this._viewContainerRef=r,this._dir=a,this._changeDetectorRef=c,this._selfHandle=h,this._parentDrag=u,this._destroyed=new C,this.started=new gh,this.released=new gh,this.ended=new gh,this.entered=new gh,this.exited=new gh,this.dropped=new gh,this.moved=new b(t=>{const e=this._dragRef.moved.pipe(M(t=>({source:this,pointerPosition:t.pointerPosition,event:t.event,delta:t.delta,distance:t.distance}))).subscribe(t);return()=>{e.unsubscribe()}}),this._dragRef=l.createDrag(e,{dragStartThreshold:o&&null!=o.dragStartThreshold?o.dragStartThreshold:5,pointerDirectionChangeThreshold:o&&null!=o.pointerDirectionChangeThreshold?o.pointerDirectionChangeThreshold:5,zIndex:null==o?void 0:o.zIndex}),this._dragRef.data=this,t._dragInstances.push(this),o&&this._assignDefaults(o),i&&(this._dragRef._withDropContainer(i._dropListRef),i.addItem(this)),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(t){this._disabled=Lf(t),this._dragRef.disabled=this._disabled}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(xf(1),Of(this._destroyed)).subscribe(()=>{this._updateRootElement(),this._setupHandlesListener(),this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)})})}ngOnChanges(t){const e=t.rootElementSelector,i=t.freeDragPosition;e&&!e.firstChange&&this._updateRootElement(),i&&!i.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);const e=t._dragInstances.indexOf(this);e>-1&&t._dragInstances.splice(e,1),this._ngZone.runOutsideAngular(()=>{this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_updateRootElement(){const t=this.element.nativeElement,e=this.rootElementSelector?L2(t,this.rootElementSelector):t;this._dragRef.withRootElement(e||t)}_getBoundaryElement(){const t=this.boundaryElement;return t?\"string\"==typeof t?L2(this.element.nativeElement,t):Vf(t):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){const t=this._dir,i=this.dragStartDelay,n=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,s=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.dragStartDelay=\"object\"==typeof i&&i?i:Ff(i),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(n).withPreviewTemplate(s).withPreviewContainer(this.previewContainer||\"global\"),t&&e.withDirection(t.value)}}),e.beforeStarted.pipe(xf(1)).subscribe(()=>{var i,n;if(this._parentDrag)return void e.withParent(this._parentDrag._dragRef);let s=this.element.nativeElement.parentElement;for(;s;){if(null===(i=s.classList)||void 0===i?void 0:i.contains(\"cdk-drag\")){e.withParent((null===(n=t._dragInstances.find(t=>t.element.nativeElement===s))||void 0===n?void 0:n._dragRef)||null);break}s=s.parentElement}})}_handleEvents(t){t.started.subscribe(()=>{this.started.emit({source:this}),this._changeDetectorRef.markForCheck()}),t.released.subscribe(()=>{this.released.emit({source:this})}),t.ended.subscribe(t=>{this.ended.emit({source:this,distance:t.distance,dropPoint:t.dropPoint}),this._changeDetectorRef.markForCheck()}),t.entered.subscribe(t=>{this.entered.emit({container:t.container.data,item:this,currentIndex:t.currentIndex})}),t.exited.subscribe(t=>{this.exited.emit({container:t.container.data,item:this})}),t.dropped.subscribe(t=>{this.dropped.emit({previousIndex:t.previousIndex,currentIndex:t.currentIndex,previousContainer:t.previousContainer.data,container:t.container.data,isPointerOverContainer:t.isPointerOverContainer,item:this,distance:t.distance,dropPoint:t.dropPoint})})}_assignDefaults(t){const{lockAxis:e,dragStartDelay:i,constrainPosition:n,previewClass:s,boundaryElement:r,draggingDisabled:o,rootElementSelector:a,previewContainer:l}=t;this.disabled=null!=o&&o,this.dragStartDelay=i||0,e&&(this.lockAxis=e),n&&(this.constrainPosition=n),s&&(this.previewClass=s),r&&(this.boundaryElement=r),a&&(this.rootElementSelector=a),l&&(this.previewContainer=l)}_setupHandlesListener(){this._handles.changes.pipe(hg(this._handles),sf(t=>{const e=t.filter(t=>t._parentDrag===this).map(t=>t.element);this._selfHandle&&this.rootElementSelector&&e.push(this.element),this._dragRef.withHandles(e)}),fg(t=>q(...t.map(t=>t._stateChanges.pipe(hg(t))))),Of(this._destroyed)).subscribe(t=>{const e=this._dragRef,i=t.element.nativeElement;t.disabled?e.disableHandle(i):e.enableHandle(i)})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(E2,12),Oa(Fu),Oa(nu),Oa(Vc),Oa(C2,8),Oa(Eg,8),Oa(w2),Oa(Mc),Oa(T2,10),Oa(x2,12))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"cdkDrag\",\"\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,R2,5),Ih(i,P2,5),Ih(i,T2,5)),2&t){let t;Mh(t=Ph())&&(e._previewTemplate=t.first),Mh(t=Ph())&&(e._placeholderTemplate=t.first),Mh(t=Ph())&&(e._handles=t)}},hostAttrs:[1,\"cdk-drag\"],hostVars:4,hostBindings:function(t,e){2&t&&hl(\"cdk-drag-disabled\",e.disabled)(\"cdk-drag-dragging\",e._dragRef.isDragging())},inputs:{disabled:[\"cdkDragDisabled\",\"disabled\"],dragStartDelay:[\"cdkDragStartDelay\",\"dragStartDelay\"],lockAxis:[\"cdkDragLockAxis\",\"lockAxis\"],constrainPosition:[\"cdkDragConstrainPosition\",\"constrainPosition\"],previewClass:[\"cdkDragPreviewClass\",\"previewClass\"],boundaryElement:[\"cdkDragBoundary\",\"boundaryElement\"],rootElementSelector:[\"cdkDragRootElement\",\"rootElementSelector\"],previewContainer:[\"cdkDragPreviewContainer\",\"previewContainer\"],data:[\"cdkDragData\",\"data\"],freeDragPosition:[\"cdkDragFreeDragPosition\",\"freeDragPosition\"]},outputs:{started:\"cdkDragStarted\",released:\"cdkDragReleased\",ended:\"cdkDragEnded\",entered:\"cdkDragEntered\",exited:\"cdkDragExited\",dropped:\"cdkDragDropped\",moved:\"cdkDragMoved\"},exportAs:[\"cdkDrag\"],features:[Yl([{provide:x2,useExisting:t}]),he]}),t._dragInstances=[],t})();function L2(t,e){let i=t.parentElement;for(;i;){if(i.matches?i.matches(e):i.msMatchesSelector(e))return i;i=i.parentElement}return null}let F2=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({providers:[w2],imports:[Kg]}),t})();function N2(t,e){if(1&t&&(La(0,\"mat-option\",9),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.value),Cr(1),Cl(\" \",t.label,\" \")}}function B2(t,e){if(1&t){const t=$a();La(0,\"div\"),La(1,\"mat-form-field\",5),La(2,\"mat-label\"),xl(3,\"Intervalle de temps\"),Fa(),La(4,\"mat-select\",6),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).criterion.timeWindow=e}),oa(5,N2,2,2,\"mat-option\",7),Fa(),Fa(),La(6,\"mat-checkbox\",8),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).criterion.sequential=e}),xl(7,\" Passages ordonn\\xe9s \"),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(4),Ra(\"ngModel\",t.criterion.timeWindow)(\"disabled\",!t.editable),Cr(1),Ra(\"ngForOf\",t.timeWindows),Cr(1),Ra(\"ngModel\",t.criterion.sequential)(\"disabled\",!t.editable)}}function z2(t,e){if(1&t&&(La(0,\"div\",21),xl(1),Fa()),2&t){const t=Ka().index;Cr(1),Sl(t+1)}}function V2(t,e){1&t&&(La(0,\"mat-icon\",22),xl(1,\"drag_handle\"),Fa())}function $2(t,e){if(1&t){const t=$a();La(0,\"mat-list-item\",17),Ga(\"cdkDragStarted\",function(){return Fe(t),Ka(3).startReorderingPassages()}),oa(1,z2,2,1,\"div\",18),oa(2,V2,2,0,\"mat-icon\",19),La(3,\"app-zone-item\",20),Ga(\"delete\",function(){const e=Fe(t).$implicit;return Ka(3).deleteZone(e.zone)}),Fa(),Fa()}if(2&t){const t=e.$implicit,i=Ka(3);Cr(1),Ra(\"ngIf\",i.criterion.sequential),Cr(1),Ra(\"ngIf\",i.zonesEditable),Cr(1),Ra(\"zone\",t.zone)(\"editable\",!0)(\"disableEdition\",!i.zonesEditable)}}function U2(t,e){if(1&t){const t=$a();La(0,\"app-zone-form\",23),Ga(\"save\",function(e){return Fe(t),Ka(3).addCreatedZone(e)})(\"cancel\",function(){return Fe(t),Ka(3).hideCreateZoneForm()}),Fa()}2&t&&Ra(\"groupId\",Ka(3).groupId)}function j2(t,e){if(1&t){const t=$a();La(0,\"button\",24),La(1,\"span\"),xl(2,\"\\xa0Ajouter une zone\"),Fa(),Fa(),La(3,\"button\",25),Ga(\"click\",function(){return Fe(t),Ka(3).displayCreateZoneForm()}),xl(4,\" Cr\\xe9er une zone \"),Fa()}if(2&t){Ka();const t=aa(6),e=Ka(2);Ra(\"matMenuTriggerFor\",t)(\"disabled\",!e.zonesEditable),Cr(3),Ra(\"disabled\",!e.zonesEditable)}}function H2(t,e){if(1&t){const t=$a();La(0,\"button\",26),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka(3).addZone(e)}),xl(1),Fa()}if(2&t){const t=e.$implicit;Cr(1),Cl(\" \",t.name,\" \")}}function G2(t,e){if(1&t){const t=$a();La(0,\"mat-list\",10),Ga(\"cdkDropListDropped\",function(e){return Fe(t),Ka(2).reorderPassage(e)}),oa(1,$2,4,5,\"mat-list-item\",11),Fa(),La(2,\"div\",12),oa(3,U2,1,1,\"app-zone-form\",13),oa(4,j2,5,3,\"ng-template\",1),Fa(),La(5,\"mat-menu\",14,15),oa(7,H2,2,1,\"button\",16),Fa()}if(2&t){const t=Ka(2);Cr(1),Ra(\"ngForOf\",t.criterion.passages)(\"ngForTrackBy\",t.trackById),Cr(2),Ra(\"ngIf\",t.showCreateZoneForm),Cr(1),Ra(\"ngIf\",!t.showCreateZoneForm),Cr(3),Ra(\"ngForOf\",t.availableZones)}}function W2(t,e){if(1&t&&(La(0,\"div\",21),xl(1),Fa()),2&t){const t=Ka().index;Cr(1),Sl(t+1)}}function q2(t,e){if(1&t){const t=$a();La(0,\"mat-list-item\"),oa(1,W2,2,1,\"div\",18),La(2,\"button\",29),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka(3).viewZone(e.zone)}),xl(3),Fa(),Fa()}if(2&t){const t=e.$implicit,i=Ka(3);Cr(1),Ra(\"ngIf\",i.criterion.sequential),Cr(2),Cl(\" \",t.zone.name,\" \")}}function Y2(t,e){if(1&t&&(La(0,\"mat-list\",27),oa(1,q2,4,2,\"mat-list-item\",28),Fa()),2&t){const t=Ka(2);Cr(1),Ra(\"ngForOf\",t.criterion.passages)}}function Z2(t,e){if(1&t&&(oa(0,B2,8,5,\"div\",2),oa(1,G2,8,5,\"ng-template\",3),oa(2,Y2,2,1,\"ng-template\",null,4,Lh)),2&t){const t=aa(3),e=Ka();Ra(\"ngIf\",e.criterion.passages.length>1),Cr(1),Ra(\"ngIf\",e.editable)(\"ngIfElse\",t)}}let K2=(()=>{class t extends S1{constructor(t,e,i){super(),this.editZoneService=t,this.mapService=e,this.zonesService=i,this.updateZones=new gh,this.timeWindows=yH,this.reorderingPassages=!1,this.availableZones=[],this.showCreateZoneForm=!1,this.zonesEditable=!0,this.usedZonesIds$=new Jp([]),this.groupId$=new Jp(null)}ngOnInit(){this.usedZonesIds$.next(this.criterion.passages.map(t=>t.zone.id)),this.subscriptions.push(JT([this.zonesService.zones$,this.usedZonesIds$,this.groupId$]).subscribe(([t,e,i])=>{this.availableZones=t.filter(t=>t.group_id===i&&!e.includes(t.id))}),this.usedZonesIds$.pipe(kf(1)).subscribe(()=>{this.updateZones.next(null)}),this.editZoneService.editedZone$.pipe(Tf(),Oj(0)).subscribe(t=>{this.zonesEditable=!t}))}ngOnChanges(t){t.groupId&&(this.groupId$.next(t.groupId.currentValue),t.groupId.firstChange||(this.criterion.passages=[],this.usedZonesIds$.next([])))}get passages(){return this.criterion.passages.map(t=>t.zone.name).join(\", \")}displayCreateZoneForm(){this.showCreateZoneForm=!0}hideCreateZoneForm(){this.showCreateZoneForm=!1}addCreatedZone(t){this.criterion.passages.push({zone:t}),this.hideCreateZoneForm()}viewZone(t){this.mapService.fitOnHexagons(t.h3indexes)}deleteZone(t){this.criterion.passages.splice(this.criterion.passages.findIndex(e=>e.zone===t),1),this.usedZonesIds$.next(this.usedZonesIds$.value.filter(e=>e!==t.id))}addZone(t){this.criterion.passages.push({zone:t}),this.usedZonesIds$.next(this.usedZonesIds$.value.concat(t.id))}trackById(t,e){return e.zone.id}startReorderingPassages(){this.reorderingPassages=!0}reorderPassage(t){this.reorderingPassages=!1,u2(this.criterion.passages,t.previousIndex,t.currentIndex)}}return t.\\u0275fac=function(e){return new(e||t)(Oa($J),Oa(Pj),Oa(OH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-passage-in-zone-criterion\"]],inputs:{groupId:\"groupId\"},outputs:{updateZones:\"updateZones\"},features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo,he],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[4,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"mr-2\"],[3,\"ngModel\",\"disabled\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[\"color\",\"primary\",\"matTooltip\",\"Cette option active le passage des zones dans l'ordre d\\xe9fini\",3,\"ngModel\",\"disabled\",\"ngModelChange\"],[3,\"value\"],[\"dense\",\"\",\"cdkDropList\",\"\",3,\"cdkDropListDropped\"],[\"cdkDrag\",\"\",3,\"cdkDragStarted\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[1,\"criterion-content\"],[\"class\",\"u-flex\",3,\"groupId\",\"save\",\"cancel\",4,\"ngIf\"],[1,\"add-zones-menu\"],[\"addZonesMenu\",\"matMenu\"],[\"mat-menu-item\",\"\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[\"cdkDrag\",\"\",3,\"cdkDragStarted\"],[\"class\",\"criterion__sequence-number\",4,\"ngIf\"],[\"class\",\"criterion__drag-handle\",\"cdkDragHandle\",\"\",\"title\",\"R\\xe9ordonner\",4,\"ngIf\"],[1,\"u-flex\",3,\"zone\",\"editable\",\"disableEdition\",\"delete\"],[1,\"criterion__sequence-number\"],[\"cdkDragHandle\",\"\",\"title\",\"R\\xe9ordonner\",1,\"criterion__drag-handle\"],[1,\"u-flex\",3,\"groupId\",\"save\",\"cancel\"],[\"mat-button\",\"\",\"title\",\"Ajouter une zone existante\",3,\"matMenuTriggerFor\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Cr\\xe9er une nouvelle zone\",3,\"disabled\",\"click\"],[\"mat-menu-item\",\"\",3,\"click\"],[\"dense\",\"\"],[4,\"ngFor\",\"ngForOf\"],[\"mat-button\",\"\",\"title\",\"Visualiser la zone\",1,\"u-flex\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),oa(1,Z2,4,3,\"ng-template\",1),Fa()),2&t&&(Ra(\"type\",e.criteriaLabels.passageInZone)(\"enable\",e.enable)(\"editable\",e.editable),Cr(1),Ra(\"ngIf\",e.criterion.enable))},directives:[P1,Vd,AS,aS,qT,Sw,nx,Bd,hY,mI,ky,Y0,M2,T0,Q0,D2,V0,uE,I2,F0,Ly,D0,S0],styles:[\".criterion__sequence-number[_ngcontent-%COMP%]{font-size:1.2em;font-weight:bold;margin-right:.5em}.criterion__drag-handle[_ngcontent-%COMP%]{cursor:move;margin-right:.5em}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12);background-color:#e6e9f7;font-size:12px}.cdk-drag-preview[_ngcontent-%COMP%]    >.mat-list-item-content{display:flex;align-items:center;padding:0 16px;height:inherit}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}\"]}),t})(),X2=(()=>{class t extends S1{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-spoofing-criterion\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:1,vars:3,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),Fa()),2&t&&Ra(\"type\",e.criteriaLabels.spoofing)(\"enable\",e.enable)(\"editable\",e.editable)},directives:[P1],encapsulation:2,changeDetection:0}),t})();const Q2=[\"panel\"];function J2(t,e){if(1&t&&(La(0,\"div\",0,1),Ja(2),Fa()),2&t){const t=e.id,i=Ka();Ra(\"id\",i.id)(\"ngClass\",i._classList),ia(\"aria-label\",i.ariaLabel||null)(\"aria-labelledby\",i._getPanelAriaLabelledby(t))}}const t3=[\"*\"];let e3=0;class i3{constructor(t,e){this.source=t,this.option=e}}const n3=zb(class{}),s3=new Ji(\"mat-autocomplete-default-options\",{providedIn:\"root\",factory:function(){return{autoActiveFirstOption:!1}}});let r3=(()=>{class t extends n3{constructor(t,e,i,n){super(),this._changeDetectorRef=t,this._elementRef=e,this._activeOptionChanges=d.EMPTY,this.showPanel=!1,this._isOpen=!1,this.displayWith=null,this.optionSelected=new gh,this.opened=new gh,this.closed=new gh,this.optionActivated=new gh,this._classList={},this.id=\"mat-autocomplete-\"+e3++,this.inertGroups=(null==n?void 0:n.SAFARI)||!1,this._autoActiveFirstOption=!!i.autoActiveFirstOption}get isOpen(){return this._isOpen&&this.showPanel}get autoActiveFirstOption(){return this._autoActiveFirstOption}set autoActiveFirstOption(t){this._autoActiveFirstOption=Lf(t)}set classList(t){this._classList=t&&t.length?$f(t).reduce((t,e)=>(t[e]=!0,t),{}):{},this._setVisibilityClasses(this._classList),this._elementRef.nativeElement.className=\"\"}ngAfterContentInit(){this._keyManager=new bm(this.options).withWrap(),this._activeOptionChanges=this._keyManager.change.subscribe(t=>{this.isOpen&&this.optionActivated.emit({source:this,option:this.options.toArray()[t]||null})}),this._setVisibility()}ngOnDestroy(){this._activeOptionChanges.unsubscribe()}_setScrollTop(t){this.panel&&(this.panel.nativeElement.scrollTop=t)}_getScrollTop(){return this.panel?this.panel.nativeElement.scrollTop:0}_setVisibility(){this.showPanel=!!this.options.length,this._setVisibilityClasses(this._classList),this._changeDetectorRef.markForCheck()}_emitSelectEvent(t){const e=new i3(this,t);this.optionSelected.emit(e)}_getPanelAriaLabelledby(t){return this.ariaLabel?null:this.ariaLabelledby?(t?t+\" \":\"\")+this.ariaLabelledby:t}_setVisibilityClasses(t){t[this._visibleClass]=this.showPanel,t[this._hiddenClass]=!this.showPanel}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(ic),Oa(s3),Oa(Hf))},t.\\u0275dir=Xt({type:t,viewQuery:function(t,e){if(1&t&&(Th(Rc,7),Th(Q2,5)),2&t){let t;Mh(t=Ph())&&(e.template=t.first),Mh(t=Ph())&&(e.panel=t.first)}},inputs:{displayWith:\"displayWith\",autoActiveFirstOption:\"autoActiveFirstOption\",classList:[\"class\",\"classList\"],ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"],panelWidth:\"panelWidth\"},outputs:{optionSelected:\"optionSelected\",opened:\"opened\",closed:\"closed\",optionActivated:\"optionActivated\"},features:[Uo]}),t})(),o3=(()=>{class t extends r3{constructor(){super(...arguments),this._visibleClass=\"mat-autocomplete-visible\",this._hiddenClass=\"mat-autocomplete-hidden\"}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-autocomplete\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,yy,5),Ih(i,ky,5)),2&t){let t;Mh(t=Ph())&&(e.optionGroups=t),Mh(t=Ph())&&(e.options=t)}},hostAttrs:[1,\"mat-autocomplete\"],inputs:{disableRipple:\"disableRipple\"},exportAs:[\"matAutocomplete\"],features:[Yl([{provide:Ay,useExisting:t}]),Uo],ngContentSelectors:t3,decls:1,vars:0,consts:[[\"role\",\"listbox\",1,\"mat-autocomplete-panel\",3,\"id\",\"ngClass\"],[\"panel\",\"\"]],template:function(t,e){1&t&&(Qa(),oa(0,J2,3,4,\"ng-template\"))},directives:[Fd],styles:[\".mat-autocomplete-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;visibility:hidden;max-width:none;max-height:256px;position:relative;width:100%;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.mat-autocomplete-panel.mat-autocomplete-visible{visibility:visible}.mat-autocomplete-panel.mat-autocomplete-hidden{visibility:hidden}.mat-autocomplete-panel-above .mat-autocomplete-panel{border-radius:0;border-top-left-radius:4px;border-top-right-radius:4px}.mat-autocomplete-panel .mat-divider-horizontal{margin-top:-1px}.cdk-high-contrast-active .mat-autocomplete-panel{outline:solid 1px}mat-autocomplete{display:none}\\n\"],encapsulation:2,changeDetection:0}),t})(),a3=(()=>{class t{constructor(t){this.elementRef=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic))},t.\\u0275dir=Xt({type:t}),t})(),l3=(()=>{class t extends a3{}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matAutocompleteOrigin\",\"\"]],exportAs:[\"matAutocompleteOrigin\"],features:[Uo]}),t})();const c3=new Ji(\"mat-autocomplete-scroll-strategy\"),h3={provide:c3,deps:[MA],useFactory:function(t){return()=>t.scrollStrategies.reposition()}},u3={provide:Uy,useExisting:at(()=>p3),multi:!0};let d3=(()=>{class t{constructor(t,e,i,n,s,r,o,a,l,c,h){this._element=t,this._overlay=e,this._viewContainerRef=i,this._zone=n,this._changeDetectorRef=s,this._dir=o,this._formField=a,this._document=l,this._viewportRuler=c,this._defaults=h,this._componentDestroyed=!1,this._autocompleteDisabled=!1,this._manuallyFloatingLabel=!1,this._viewportSubscription=d.EMPTY,this._canOpenOnNextFocus=!0,this._closeKeyEventStream=new C,this._windowBlurHandler=()=>{this._canOpenOnNextFocus=this._document.activeElement!==this._element.nativeElement||this.panelOpen},this._onChange=()=>{},this._onTouched=()=>{},this.position=\"auto\",this.autocompleteAttribute=\"off\",this._overlayAttached=!1,this.optionSelections=UC(()=>this.autocomplete&&this.autocomplete.options?q(...this.autocomplete.options.map(t=>t.onSelectionChange)):this._zone.onStable.pipe(xf(1),fg(()=>this.optionSelections))),this._scrollStrategy=r}get autocompleteDisabled(){return this._autocompleteDisabled}set autocompleteDisabled(t){this._autocompleteDisabled=Lf(t)}ngAfterViewInit(){const t=this._getWindow();void 0!==t&&this._zone.runOutsideAngular(()=>t.addEventListener(\"blur\",this._windowBlurHandler))}ngOnChanges(t){t.position&&this._positionStrategy&&(this._setStrategyPositions(this._positionStrategy),this.panelOpen&&this._overlayRef.updatePosition())}ngOnDestroy(){const t=this._getWindow();void 0!==t&&t.removeEventListener(\"blur\",this._windowBlurHandler),this._viewportSubscription.unsubscribe(),this._componentDestroyed=!0,this._destroyPanel(),this._closeKeyEventStream.complete()}get panelOpen(){return this._overlayAttached&&this.autocomplete.showPanel}openPanel(){this._attachOverlay(),this._floatLabel()}closePanel(){this._resetLabel(),this._overlayAttached&&(this.panelOpen&&this.autocomplete.closed.emit(),this.autocomplete._isOpen=this._overlayAttached=!1,this._overlayRef&&this._overlayRef.hasAttached()&&(this._overlayRef.detach(),this._closingActionsSubscription.unsubscribe()),this._componentDestroyed||this._changeDetectorRef.detectChanges())}updatePosition(){this._overlayAttached&&this._overlayRef.updatePosition()}get panelClosingActions(){return q(this.optionSelections,this.autocomplete._keyManager.tabOut.pipe(Af(()=>this._overlayAttached)),this._closeKeyEventStream,this._getOutsideClickStream(),this._overlayRef?this._overlayRef.detachments().pipe(Af(()=>this._overlayAttached)):tf()).pipe(M(t=>t instanceof Sy?t:null))}get activeOption(){return this.autocomplete&&this.autocomplete._keyManager?this.autocomplete._keyManager.activeItem:null}_getOutsideClickStream(){return q(qm(this._document,\"click\"),qm(this._document,\"auxclick\"),qm(this._document,\"touchend\")).pipe(Af(t=>{const e=nm(t),i=this._formField?this._formField._elementRef.nativeElement:null,n=this.connectedTo?this.connectedTo.elementRef.nativeElement:null;return this._overlayAttached&&e!==this._element.nativeElement&&(!i||!i.contains(e))&&(!n||!n.contains(e))&&!!this._overlayRef&&!this._overlayRef.overlayElement.contains(e)}))}writeValue(t){Promise.resolve(null).then(()=>this._setTriggerValue(t))}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this._element.nativeElement.disabled=t}_handleKeydown(t){const e=t.keyCode;if(27===e&&!ef(t)&&t.preventDefault(),this.activeOption&&13===e&&this.panelOpen)this.activeOption._selectViaInteraction(),this._resetActiveItem(),t.preventDefault();else if(this.autocomplete){const i=this.autocomplete._keyManager.activeItem,n=38===e||40===e;this.panelOpen||9===e?this.autocomplete._keyManager.onKeydown(t):n&&this._canOpen()&&this.openPanel(),(n||this.autocomplete._keyManager.activeItem!==i)&&this._scrollToOption(this.autocomplete._keyManager.activeItemIndex||0)}}_handleInput(t){let e=t.target,i=e.value;\"number\"===e.type&&(i=\"\"==i?null:parseFloat(i)),this._previousValue!==i&&(this._previousValue=i,this._onChange(i),this._canOpen()&&this._document.activeElement===t.target&&this.openPanel())}_handleFocus(){this._canOpenOnNextFocus?this._canOpen()&&(this._previousValue=this._element.nativeElement.value,this._attachOverlay(),this._floatLabel(!0)):this._canOpenOnNextFocus=!0}_floatLabel(t=!1){this._formField&&\"auto\"===this._formField.floatLabel&&(t?this._formField._animateAndLockLabel():this._formField.floatLabel=\"always\",this._manuallyFloatingLabel=!0)}_resetLabel(){this._manuallyFloatingLabel&&(this._formField.floatLabel=\"auto\",this._manuallyFloatingLabel=!1)}_subscribeToClosingActions(){return q(this._zone.onStable.pipe(xf(1)),this.autocomplete.options.changes.pipe(sf(()=>this._positionStrategy.reapplyLastPosition()),Oj(0))).pipe(fg(()=>{const t=this.panelOpen;return this._resetActiveItem(),this.autocomplete._setVisibility(),this.panelOpen&&(this._overlayRef.updatePosition(),t!==this.panelOpen&&this.autocomplete.opened.emit()),this.panelClosingActions}),xf(1)).subscribe(t=>this._setValueAndClose(t))}_destroyPanel(){this._overlayRef&&(this.closePanel(),this._overlayRef.dispose(),this._overlayRef=null)}_setTriggerValue(t){const e=this.autocomplete&&this.autocomplete.displayWith?this.autocomplete.displayWith(t):t,i=null!=e?e:\"\";this._formField?this._formField._control.value=i:this._element.nativeElement.value=i,this._previousValue=i}_setValueAndClose(t){t&&t.source&&(this._clearPreviousSelectedOption(t.source),this._setTriggerValue(t.source.value),this._onChange(t.source.value),this._element.nativeElement.focus(),this.autocomplete._emitSelectEvent(t.source)),this.closePanel()}_clearPreviousSelectedOption(t){this.autocomplete.options.forEach(e=>{e!==t&&e.selected&&e.deselect()})}_attachOverlay(){var t;let e=this._overlayRef;e?(this._positionStrategy.setOrigin(this._getConnectedElement()),e.updateSize({width:this._getPanelWidth()})):(this._portal=new qp(this.autocomplete.template,this._viewContainerRef,{id:null===(t=this._formField)||void 0===t?void 0:t.getLabelId()}),e=this._overlay.create(this._getOverlayConfig()),this._overlayRef=e,e.keydownEvents().subscribe(t=>{(27===t.keyCode&&!ef(t)||38===t.keyCode&&ef(t,\"altKey\"))&&(this._closeKeyEventStream.next(),this._resetActiveItem(),t.stopPropagation(),t.preventDefault())}),this._viewportSubscription=this._viewportRuler.change().subscribe(()=>{this.panelOpen&&e&&e.updateSize({width:this._getPanelWidth()})})),e&&!e.hasAttached()&&(e.attach(this._portal),this._closingActionsSubscription=this._subscribeToClosingActions());const i=this.panelOpen;this.autocomplete._setVisibility(),this.autocomplete._isOpen=this._overlayAttached=!0,this.panelOpen&&i!==this.panelOpen&&this.autocomplete.opened.emit()}_getOverlayConfig(){var t;return new cA({positionStrategy:this._getOverlayPosition(),scrollStrategy:this._scrollStrategy(),width:this._getPanelWidth(),direction:this._dir,panelClass:null===(t=this._defaults)||void 0===t?void 0:t.overlayPanelClass})}_getOverlayPosition(){const t=this._overlay.position().flexibleConnectedTo(this._getConnectedElement()).withFlexibleDimensions(!1).withPush(!1);return this._setStrategyPositions(t),this._positionStrategy=t,t}_setStrategyPositions(t){const e=[{originX:\"start\",originY:\"bottom\",overlayX:\"start\",overlayY:\"top\"},{originX:\"end\",originY:\"bottom\",overlayX:\"end\",overlayY:\"top\"}],i=this._aboveClass,n=[{originX:\"start\",originY:\"top\",overlayX:\"start\",overlayY:\"bottom\",panelClass:i},{originX:\"end\",originY:\"top\",overlayX:\"end\",overlayY:\"bottom\",panelClass:i}];let s;s=\"above\"===this.position?n:\"below\"===this.position?e:[...e,...n],t.withPositions(s)}_getConnectedElement(){return this.connectedTo?this.connectedTo.elementRef:this._formField?this._formField.getConnectedOverlayOrigin():this._element}_getPanelWidth(){return this.autocomplete.panelWidth||this._getHostWidth()}_getHostWidth(){return this._getConnectedElement().nativeElement.getBoundingClientRect().width}_resetActiveItem(){const t=this.autocomplete;t.autoActiveFirstOption?t._keyManager.setFirstItemActive():t._keyManager.setActiveItem(-1)}_canOpen(){const t=this._element.nativeElement;return!t.readOnly&&!t.disabled&&!this._autocompleteDisabled}_getWindow(){var t;return(null===(t=this._document)||void 0===t?void 0:t.defaultView)||window}_scrollToOption(t){const e=this.autocomplete,i=Ey(t,e.options,e.optionGroups);if(0===t&&1===i)e._setScrollTop(0);else if(e.panel){const i=e.options.toArray()[t];if(i){const t=i._getHostElement(),n=My(t.offsetTop,t.offsetHeight,e._getScrollTop(),e.panel.nativeElement.offsetHeight);e._setScrollTop(n)}}}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(MA),Oa(Vc),Oa(nu),Oa(Mc),Oa(c3),Oa(Eg,8),Oa(gS,9),Oa(Fu,8),Oa(Gg),Oa(s3,8))},t.\\u0275dir=Xt({type:t,inputs:{position:[\"matAutocompletePosition\",\"position\"],autocompleteAttribute:[\"autocomplete\",\"autocompleteAttribute\"],autocompleteDisabled:[\"matAutocompleteDisabled\",\"autocompleteDisabled\"],autocomplete:[\"matAutocomplete\",\"autocomplete\"],connectedTo:[\"matAutocompleteConnectedTo\",\"connectedTo\"]},features:[he]}),t})(),p3=(()=>{class t extends d3{constructor(){super(...arguments),this._aboveClass=\"mat-autocomplete-panel-above\"}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"input\",\"matAutocomplete\",\"\"],[\"textarea\",\"matAutocomplete\",\"\"]],hostAttrs:[1,\"mat-autocomplete-trigger\"],hostVars:7,hostBindings:function(t,e){1&t&&Ga(\"focusin\",function(){return e._handleFocus()})(\"blur\",function(){return e._onTouched()})(\"input\",function(t){return e._handleInput(t)})(\"keydown\",function(t){return e._handleKeydown(t)}),2&t&&ia(\"autocomplete\",e.autocompleteAttribute)(\"role\",e.autocompleteDisabled?null:\"combobox\")(\"aria-autocomplete\",e.autocompleteDisabled?null:\"list\")(\"aria-activedescendant\",e.panelOpen&&e.activeOption?e.activeOption.id:null)(\"aria-expanded\",e.autocompleteDisabled?null:e.panelOpen.toString())(\"aria-owns\",e.autocompleteDisabled||!e.panelOpen||null==e.autocomplete?null:e.autocomplete.id)(\"aria-haspopup\",!e.autocompleteDisabled)},exportAs:[\"matAutocompleteTrigger\"],features:[Yl([u3]),Uo]}),t})(),f3=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({providers:[h3],imports:[[DA,Ty,Fb,np],Kg,Ty,Fb]}),t})();const m3=[\"searchInput\"];function g3(t,e){1&t&&(La(0,\"mat-icon\",10),xl(1,\"cached\"),Fa())}function A3(t,e){1&t&&(La(0,\"mat-option\",11),xl(1,\" Aucun r\\xe9sultat \"),Fa())}function v3(t,e){if(1&t&&(La(0,\"mat-option\",12),La(1,\"div\",13),La(2,\"div\",14),La(3,\"div\",15),Na(4,\"app-flag\",16),La(5,\"div\",17),La(6,\"div\",18),xl(7),Fa(),La(8,\"small\",19),xl(9),Fa(),Fa(),Fa(),La(10,\"div\",20),La(11,\"mat-icon\",21),xl(12,\"access_time\"),Fa(),La(13,\"div\",22),ch(14,\"timeago\"),xl(15),ch(16,\"date\"),Fa(),Fa(),Fa(),La(17,\"div\",23),La(18,\"div\"),xl(19),Fa(),La(20,\"div\"),xl(21),Fa(),La(22,\"div\"),xl(23),Fa(),Fa(),Fa(),Fa()),2&t){const t=e.$implicit,i=Ka();Ra(\"value\",t)(\"disabled\",t.alreadyExists)(\"title\",t.alreadyExists?\"Ce navire est d\\xe9j\\xe0 dans la flotte\":\"Ajouter ce navire\"),Cr(4),Ra(\"flag\",t.country.flag),Cr(3),Sl(t.name||\"?\"),Cr(2),Sl(t.cargo?i.vesselTypeLabelsByType[t.cargo]:\"?\"),Cr(4),tl(\"title\",hh(14,11,1e3*t.timestamp)),Cr(2),Sl(dh(16,13,1e3*t.timestamp,\"yyyy-MM-dd HH:mm:ss z\",i.mapConfigService.useUTCDates$.value&&\"+00\")),Cr(4),Cl(\"MMSI \",t.mmsi,\"\"),Cr(2),Cl(\"IMO \",t.imo||\"?\",\"\"),Cr(2),Cl(\"Callsign \",t.callsign||\"?\",\"\")}}let _3=(()=>{class t extends Gq{constructor(t,e,i){super(),this.errorHandler=t,this.mapConfigService=e,this.workerService=i,this.allowTextValue=!1,this.existingItems=[],this.selectItem=new gh,this.searchFormControl=new Yw,this.noResults=!1,this.loadingResults=!1,this.vesselTypeLabelsByType=oU,this.existingMMSIs={}}ngOnInit(){this.subscriptions.push(this.searchFormControl.valueChanges.pipe(pf(300),M(t=>\"string\"==typeof t?t:void 0===t?\"\":\"object\"==typeof t&&(null==t?void 0:t.name)||\"\"),M(t=>t.trim()),Tf(),sf(()=>{this.loadingResults=!0,this.noResults=!1}),fg(t=>\"\"===t?tf(null):UC(()=>Hp(this,void 0,void 0,function*(){try{return yield this.workerService.ships.findShips(t.toUpperCase())}catch(e){return e.name===aB.Unauthorized&&this.errorHandler.handleError(e),[]}})))).subscribe(t=>{var e;this.loadingResults=!1,this.noResults=0===(null==t?void 0:t.length),this.searchResults=t,null===(e=this.searchResults)||void 0===e||e.forEach(t=>{t.alreadyExists=this.existingMMSIs[t.mmsi]})}))}ngOnChanges(t){t.existingItems&&(this.existingMMSIs=this.existingItems.reduce((t,e)=>(t[e]=!0,t),{}))}selectShip(t){t&&(this.selectItem.emit(t),this.searchFormControl.reset(\"\"),this.inputElement.nativeElement.focus())}selectValue(){this.allowTextValue&&this.searchFormControl.value&&(this.selectItem.emit(this.searchFormControl.value),this.searchFormControl.reset(\"\"))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rs),Oa(qU),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ship-identifier-input\"]],viewQuery:function(t,e){if(1&t&&Th(m3,5),2&t){let t;Mh(t=Ph())&&(e.inputElement=t.first)}},inputs:{allowTextValue:\"allowTextValue\",existingItems:\"existingItems\"},outputs:{selectItem:\"selectItem\"},features:[Uo,he],decls:10,vars:6,consts:[[\"matAutocompleteOrigin\",\"\",1,\"ship-identifier-input\"],[\"origin\",\"matAutocompleteOrigin\"],[1,\"d-block\"],[\"type\",\"search\",\"placeholder\",\"Nom, MMSI, IMO...\",\"matInput\",\"\",1,\"simple-form-field\",3,\"formControl\",\"matAutocomplete\",\"matAutocompleteConnectedTo\",\"keyup.enter\"],[\"searchInput\",\"\"],[\"class\",\"spin\",\"matSuffix\",\"\",4,\"ngIf\"],[3,\"optionSelected\"],[\"autocomplete\",\"matAutocomplete\"],[\"class\",\"ship-identifier-input__no-results\",4,\"ngIf\"],[\"class\",\"ship-identifier-input__result-item-wrapper\",3,\"value\",\"disabled\",\"title\",4,\"ngFor\",\"ngForOf\"],[\"matSuffix\",\"\",1,\"spin\"],[1,\"ship-identifier-input__no-results\"],[1,\"ship-identifier-input__result-item-wrapper\",3,\"value\",\"disabled\",\"title\"],[1,\"result-item\"],[1,\"result-item__col1\"],[1,\"u-flex\",\"d-flex-center\"],[1,\"result-item__flag\",3,\"flag\"],[1,\"d-flex-column\"],[1,\"result-item__name\"],[1,\"result-item__type\"],[1,\"result-item__timestamp\"],[\"title\",\"R\\xe9ception\"],[3,\"title\"],[1,\"result-item__col2\"]],template:function(t,e){if(1&t&&(La(0,\"div\",0,1),La(2,\"mat-form-field\",2),La(3,\"input\",3,4),Ga(\"keyup.enter\",function(){return e.selectValue()}),Fa(),oa(5,g3,2,0,\"mat-icon\",5),La(6,\"mat-autocomplete\",6,7),Ga(\"optionSelected\",function(){return e.selectShip(e.searchFormControl.value)}),oa(8,A3,2,0,\"mat-option\",8),oa(9,v3,24,17,\"mat-option\",9),Fa(),Fa(),Fa()),2&t){const t=aa(1),i=aa(7);Cr(3),Ra(\"formControl\",e.searchFormControl)(\"matAutocomplete\",i)(\"matAutocompleteConnectedTo\",t),Cr(2),Ra(\"ngIf\",e.loadingResults),Cr(3),Ra(\"ngIf\",e.noResults),Cr(1),Ra(\"ngForOf\",e.searchResults)}},directives:[l3,AS,ES,Gy,p3,Sw,hx,Vd,o3,Bd,uE,dS,ky,MJ],pipes:[$F,ip],styles:[\".ship-identifier-input[_ngcontent-%COMP%]{flex:1;display:flex;color:#50647f}.ship-identifier-input__no-results[_ngcontent-%COMP%]{pointer-events:none}.ship-identifier-input__result-item-wrapper[_ngcontent-%COMP%]{line-height:16px;padding:0;height:56px}.ship-identifier-input__result-item-wrapper[aria-disabled=true][_ngcontent-%COMP%]{cursor:not-allowed}.result-item[_ngcontent-%COMP%]{padding:0 4px;font-size:12px;display:flex}.result-item__col1[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.result-item__col2[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:right}.result-item__flag[_ngcontent-%COMP%]{margin-right:4px}.result-item__name[_ngcontent-%COMP%]{font-size:14px}.result-item__type[_ngcontent-%COMP%]{line-height:1em;font-size:11px}.result-item__timestamp[_ngcontent-%COMP%]{display:flex;align-items:center;color:gray}.result-item__timestamp[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{font-size:1em;height:1em;width:1em;margin-right:.3em;margin-left:.3em}\",\"[_nghost-%COMP%]{flex:1;display:flex}\"]}),t})();function b3(t,e){if(1&t){const t=$a();La(0,\"mat-chip\",7),Ga(\"removed\",function(){const e=Fe(t).index;return Ka(3).criterion.identifiers.splice(e,1)}),xl(1),La(2,\"mat-icon\",8),xl(3,\"cancel\"),Fa(),Fa()}if(2&t){const t=e.$implicit;Ra(\"selectable\",!1),Cr(1),Cl(\" \",t,\" \")}}function y3(t,e){if(1&t){const t=$a();La(0,\"mat-chip-list\"),oa(1,b3,4,2,\"mat-chip\",4),Fa(),La(2,\"div\",5),La(3,\"app-ship-identifier-input\",6),Ga(\"selectItem\",function(e){return Fe(t),Ka(2).addIdentifier(e)}),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(1),Ra(\"ngForOf\",t.criterion.identifiers),Cr(2),Ra(\"allowTextValue\",!0)}}function w3(t,e){1&t&&xl(0),2&t&&Cl(\" Identifiants : \",Ka(2).criterion.identifiers.join(\", \"),\" \")}function x3(t,e){if(1&t&&(oa(0,y3,4,2,\"ng-template\",2),oa(1,w3,1,1,\"ng-template\",null,3,Lh)),2&t){const t=aa(2);Ra(\"ngIf\",Ka().editable)(\"ngIfElse\",t)}}let S3=(()=>{class t extends S1{addIdentifier(t){t&&this.criterion.identifiers.push(t instanceof String?t:t.name)}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-identifier-filter\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[\"disableRipple\",\"\",\"removable\",\"\",3,\"selectable\",\"removed\",4,\"ngFor\",\"ngForOf\"],[1,\"criterion-content\"],[3,\"allowTextValue\",\"selectItem\"],[\"disableRipple\",\"\",\"removable\",\"\",3,\"selectable\",\"removed\"],[\"matChipRemove\",\"\",\"title\",\"Retirer ce filtre\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),oa(1,x3,3,2,\"ng-template\",1),Fa()),2&t&&(Ra(\"type\",e.criteriaLabels.identifier)(\"enable\",e.enable)(\"editable\",e.editable),Cr(1),Ra(\"ngIf\",e.criterion.enable))},directives:[P1,Vd,u0,Bd,_3,r0,uE,o0],encapsulation:2,changeDetection:0}),t})(),C3=(()=>{class t{constructor(){this.values=[],this.key=\"\",this.text=\"Tout s\\xe9lectionner\"}isChecked(){return this.model.value&&this.values.length&&this.model.value.length===this.values.length}isIndeterminate(){return this.model.value&&this.values.length&&this.model.value.length&&this.model.value.length<this.values.length}toggleSelection(t){this.model.update.emit(t.checked?this.key?this.values.map(t=>t[this.key]):this.values:[])}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-select-check-all\"]],inputs:{model:\"model\",values:\"values\",key:\"key\",text:\"text\"},decls:2,vars:4,consts:[[\"color\",\"primary\",1,\"mat-option\",3,\"disableRipple\",\"indeterminate\",\"checked\",\"click\",\"change\"]],template:function(t,e){1&t&&(La(0,\"mat-checkbox\",0),Ga(\"click\",function(t){return t.stopPropagation()})(\"change\",function(t){return e.toggleSelection(t)}),xl(1),Fa()),2&t&&(Ra(\"disableRipple\",!0)(\"indeterminate\",e.isIndeterminate())(\"checked\",e.isChecked()),Cr(1),Cl(\" \",e.text,\" \"))},directives:[hY],styles:[\"\"]}),t})();function k3(t,e){if(1&t&&(La(0,\"mat-option\",10),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.id),Cr(1),Cl(\" \",t.name,\" \")}}function E3(t,e){if(1&t){const t=$a();La(0,\"div\",4),La(1,\"mat-form-field\",5),La(2,\"mat-label\"),xl(3,\"Flottes\"),Fa(),La(4,\"mat-select\",6,7),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).criterion.fleets=e}),Na(6,\"app-select-check-all\",8),oa(7,k3,2,2,\"mat-option\",9),Fa(),Fa(),Fa()}if(2&t){const t=aa(5),e=Ka(2);Cr(4),Ra(\"ngModel\",e.criterion.fleets),Cr(2),Ra(\"model\",t)(\"values\",e.availableFleets)(\"key\",\"id\"),Cr(1),Ra(\"ngForOf\",e.availableFleets)}}function M3(t,e){1&t&&xl(0),2&t&&Cl(\" Flottes : \",Ka(2).fleetNames.join(\", \"),\" \")}function T3(t,e){if(1&t&&(oa(0,E3,8,5,\"ng-template\",2),oa(1,M3,1,1,\"ng-template\",null,3,Lh)),2&t){const t=aa(2);Ra(\"ngIf\",Ka().editable)(\"ngIfElse\",t)}}let I3=(()=>{class t extends S1{constructor(t){super(),this.fleetsService=t,this.availableFleets=[],this.groupId$=new Jp(null)}ngOnInit(){this.subscriptions.push(JT([this.fleetsService.fleets$,this.groupId$]).subscribe(([t,e])=>{this.availableFleets=t.filter(t=>t.group_id===e)}))}ngOnChanges(t){t.groupId&&(this.groupId$.next(t.groupId.currentValue),t.groupId.firstChange||(this.criterion.fleets=[]))}get fleetNames(){return this.criterion.fleets.map(t=>{var e;return(null!==(e=this.fleetsService.fleetsById[t])&&void 0!==e?e:{}).name}).filter(t=>!!t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(zY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-fleet-filter\"]],inputs:{groupId:\"groupId\"},features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo,he],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\"],[1,\"d-block\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"fleetSelection\",\"ngModel\"],[3,\"model\",\"values\",\"key\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),oa(1,T3,3,2,\"ng-template\",1),Fa()),2&t&&(Ra(\"type\",e.criteriaLabels.fleet)(\"enable\",e.enable)(\"editable\",e.editable),Cr(1),Ra(\"ngIf\",e.criterion.enable))},directives:[P1,Vd,AS,aS,qT,Sw,nx,C3,Bd,ky],encapsulation:2,changeDetection:0}),t})();function P3(t,e){if(1&t&&(La(0,\"mat-option\",10),Na(1,\"app-flag\",11),xl(2),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.flag),Cr(1),Ra(\"flag\",t.flag),Cr(1),Cl(\" \",t.name,\" \")}}function O3(t,e){if(1&t){const t=$a();La(0,\"div\",4),La(1,\"mat-form-field\",5),La(2,\"mat-label\"),xl(3,\"Pavillon\"),Fa(),La(4,\"mat-select\",6,7),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).criterion.flags=e}),Na(6,\"app-select-check-all\",8),oa(7,P3,3,3,\"mat-option\",9),Fa(),Fa(),Fa()}if(2&t){const t=aa(5),e=Ka(2);Cr(4),Ra(\"ngModel\",e.criterion.flags),Cr(2),Ra(\"model\",t)(\"values\",e.countries)(\"key\",\"flag\"),Cr(1),Ra(\"ngForOf\",e.countries)}}function R3(t,e){if(1&t&&(La(0,\"mat-option\",10),Na(1,\"app-flag\",11),xl(2),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.flag),Cr(1),Ra(\"flag\",t.flag),Cr(1),Cl(\" \",t.name,\" \")}}function D3(t,e){if(1&t){const t=$a();La(0,\"mat-select\",12,7),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).criterion.flags=e}),Na(2,\"app-select-check-all\",8),oa(3,R3,3,3,\"mat-option\",9),Fa()}if(2&t){const t=aa(1),e=Ka(2);Ra(\"ngModel\",e.criterion.flags),Cr(2),Ra(\"model\",t)(\"values\",e.countries)(\"key\",\"flag\"),Cr(1),Ra(\"ngForOf\",e.countries)}}function L3(t,e){if(1&t&&(oa(0,O3,8,5,\"ng-template\",2),oa(1,D3,4,5,\"ng-template\",null,3,Lh)),2&t){const t=aa(2);Ra(\"ngIf\",Ka().editable)(\"ngIfElse\",t)}}let F3=(()=>{class t extends S1{constructor(){super(...arguments),this.countries=CH}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-flag-filter\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\"],[1,\"d-block\",\"px-3\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"countrySelection\",\"ngModel\"],[3,\"model\",\"values\",\"key\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"],[3,\"flag\"],[\"multiple\",\"\",\"disabled\",\"\",3,\"ngModel\",\"ngModelChange\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),oa(1,L3,3,2,\"ng-template\",1),Fa()),2&t&&(Ra(\"type\",e.criteriaLabels.flag)(\"enable\",e.enable)(\"editable\",e.editable),Cr(1),Ra(\"ngIf\",e.criterion.enable))},directives:[P1,Vd,AS,aS,qT,Sw,nx,C3,Bd,ky,MJ],encapsulation:2,changeDetection:0}),t})();function N3(t,e){if(1&t&&(La(0,\"mat-option\",10),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.key),Cr(1),Cl(\" \",t.name,\" \")}}function B3(t,e){if(1&t){const t=$a();La(0,\"div\",4),La(1,\"mat-form-field\",5),La(2,\"mat-label\"),xl(3,\"Types\"),Fa(),La(4,\"mat-select\",6,7),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).criterion.types=e}),Na(6,\"app-select-check-all\",8),oa(7,N3,2,2,\"mat-option\",9),Fa(),Fa(),Fa()}if(2&t){const t=aa(5),e=Ka(2);Cr(4),Ra(\"ngModel\",e.criterion.types),Cr(2),Ra(\"model\",t)(\"values\",e.vesselTypes)(\"key\",\"key\"),Cr(1),Ra(\"ngForOf\",e.vesselTypes)}}function z3(t,e){1&t&&xl(0),2&t&&Cl(\" \",Ka(2).criteriaTypes.join(\", \"),\" \")}function V3(t,e){if(1&t&&(oa(0,B3,8,5,\"ng-template\",2),oa(1,z3,1,1,\"ng-template\",null,3,Lh)),2&t){const t=aa(2);Ra(\"ngIf\",Ka().editable)(\"ngIfElse\",t)}}let $3=(()=>{class t extends S1{constructor(){super(...arguments),this.typesControl=new Yw,this.vesselTypes=rU,this.vesselTypeLabelsByType=oU}get criteriaTypes(){return this.criterion.types.map(t=>aU[t].name)}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-type-filter\"]],features:[Yl([{provide:Uy,useExisting:t,multi:!0}]),Uo],decls:2,vars:4,consts:[[3,\"type\",\"enable\",\"editable\",\"enableChange\"],[3,\"ngIf\"],[3,\"ngIf\",\"ngIfElse\"],[\"readonly\",\"\"],[1,\"criterion-content\"],[1,\"d-block\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"typeSelection\",\"ngModel\"],[3,\"model\",\"values\",\"key\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"]],template:function(t,e){1&t&&(La(0,\"app-alert-rule-criterion\",0),Ga(\"enableChange\",function(t){return e.enable=t}),oa(1,V3,3,2,\"ng-template\",1),Fa()),2&t&&(Ra(\"type\",e.criteriaLabels.type)(\"enable\",e.enable)(\"editable\",e.editable),Cr(1),Ra(\"ngIf\",e.criterion.enable))},directives:[P1,Vd,AS,aS,qT,Sw,nx,C3,Bd,ky],encapsulation:2,changeDetection:0}),t})();function U3(t,e){1&t&&Va(0)}const j3=function(t){return{alert:t}};function H3(t,e){if(1&t&&oa(0,U3,1,0,\"ng-container\",6),2&t){const t=Ka();Ra(\"ngTemplateOutlet\",t.titleRef)(\"ngTemplateOutletContext\",ih(2,j3,t.alert))}}function G3(t,e){1&t&&Va(0)}function W3(t,e){if(1&t&&(La(0,\"div\",10),oa(1,G3,1,0,\"ng-container\",6),Fa(),La(2,\"div\",11),ch(3,\"timeago\"),La(4,\"mat-icon\",12),xl(5,\"access_time\"),Fa(),xl(6),ch(7,\"date\"),Fa()),2&t){const t=Ka();Cr(1),Ra(\"ngTemplateOutlet\",t.titleRef)(\"ngTemplateOutletContext\",ih(10,j3,t.alert)),Cr(1),tl(\"title\",hh(3,4,1e3*t.alert.start)),Cr(4),Cl(\" \",dh(7,6,1e3*t.alert.start,\"yyyy-MM-dd HH:mm:ss z\",t.mapConfigService.useUTCDates$.value&&\"+00\"),\" \")}}function q3(t,e){1&t&&(La(0,\"button\",13),La(1,\"mat-icon\"),xl(2,\"more_vert\"),Fa(),Fa()),2&t&&(Ka(),Ra(\"matMenuTriggerFor\",aa(6)))}function Y3(t,e){1&t&&Va(0)}function Z3(t,e){if(1&t){const t=$a();La(0,\"button\",14),Ga(\"click\",function(){return Fe(t),Ka().unreadAlert()}),La(1,\"mat-icon\"),xl(2,\"markunread\"),Fa(),xl(3,\" Marquer comme non-lu \"),Fa()}}function K3(t,e){if(1&t){const t=$a();La(0,\"button\",15),Ga(\"click\",function(){return Fe(t),Ka().readAlert()}),La(1,\"mat-icon\"),xl(2,\"drafts\"),Fa(),xl(3,\" Marquer comme lu \"),Fa()}}let X3=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.configService=t,this.historyService=e,this.mapConfigService=i,this.offlineService=n,this.mapService=s,this.workerService=r,this.highlight=!1,this.simple=!0,this.update=new gh}ngOnInit(){this.ensureMandatoryInputParams(\"alert\")}locateAlert(){return Hp(this,void 0,void 0,function*(){this.configService.devMode&&console.log(\"locate-alert\",JSON.stringify(this.alert,null,2)),this.mapService.pingLocation([this.alert.lon,this.alert.lat]),this.mapService.centerOnLonLat([this.alert.lon,this.alert.lat]),this.alert.read||(yield this.readAlert())})}locateAndZoom(){this.mapService.locate([this.alert.lon,this.alert.lat])}readAlert(){return Hp(this,void 0,void 0,function*(){yield this.workerService.alerts.markAlertAsRead(this.alert.id),this.alert.read=!0,this.emitUpdate()})}unreadAlert(){return Hp(this,void 0,void 0,function*(){yield this.workerService.alerts.markAlertAsUnread(this.alert.id),this.alert.read=!1,this.emitUpdate()})}emitUpdate(){this.update.emit(this.alert)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(WU),Oa(Fj),Oa(qU),Oa(MY),Oa(Pj),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alert-item\"]],inputs:{alert:\"alert\",titleRef:\"titleRef\",menuItemsRef:\"menuItemsRef\",highlight:\"highlight\",simple:\"simple\"},outputs:{update:\"update\"},features:[Uo],decls:14,vars:13,consts:[[1,\"alert-item\"],[\"mat-button\",\"\",\"title\",\"Localiser l'alerte (double-clic = zoom)\",1,\"alert-item__content\",3,\"click\",\"dblclick\"],[3,\"ngIf\"],[\"mat-button\",\"\",\"class\",\"alert-item__actions-button\",\"title\",\"Actions\",3,\"matMenuTriggerFor\",4,\"ngIf\"],[1,\"u-wide-menu\"],[\"alertActionsMenu\",\"matMenu\"],[4,\"ngTemplateOutlet\",\"ngTemplateOutletContext\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme non-lu\",3,\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme lu\",3,\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"Visualiser la situation des navires\",3,\"click\"],[1,\"alert-item__title\"],[1,\"alert-item__timestamp\",3,\"title\"],[\"title\",\"R\\xe9ception\",1,\"mini-icon\",\"mr-1\"],[\"mat-button\",\"\",\"title\",\"Actions\",1,\"alert-item__actions-button\",3,\"matMenuTriggerFor\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme non-lu\",3,\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Marquer comme lu\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"button\",1),Ga(\"click\",function(){return e.locateAlert()})(\"dblclick\",function(){return e.locateAndZoom()}),oa(2,H3,1,4,\"ng-template\",2),oa(3,W3,8,12,\"ng-template\",2),Fa(),oa(4,q3,3,1,\"button\",3),La(5,\"mat-menu\",4,5),oa(7,Y3,1,0,\"ng-container\",6),oa(8,Z3,4,0,\"button\",7),oa(9,K3,4,0,\"button\",8),La(10,\"button\",9),Ga(\"click\",function(){return e.historyService.setTimestamp(e.alert.start)}),La(11,\"mat-icon\"),xl(12,\"history\"),Fa(),xl(13,\" Visualiser la situation des navires \"),Fa(),Fa(),Fa()),2&t&&(hl(\"alert-item--unread\",!e.alert.read)(\"alert-item--highlighted\",e.highlight),Cr(2),Ra(\"ngIf\",!e.simple),Cr(1),Ra(\"ngIf\",e.simple),Cr(1),Ra(\"ngIf\",!e.offlineService.isOffline$.value),Cr(3),Ra(\"ngTemplateOutlet\",e.menuItemsRef)(\"ngTemplateOutletContext\",ih(11,j3,e.alert)),Cr(1),Ra(\"ngIf\",e.alert.read),Cr(1),Ra(\"ngIf\",!e.alert.read))},directives:[Ly,Vd,T0,Yd,S0,uE,D0],pipes:[$F,ip],styles:[\".alert-item[_ngcontent-%COMP%]{flex:1;display:flex;align-items:stretch;justify-content:stretch;transition:2s ease-out background-color;min-height:82px;padding-left:6px}.alert-item--unread[_ngcontent-%COMP%]{font-weight:600;border-left:6px solid #3778ff;padding-left:0}.alert-item--highlighted[_ngcontent-%COMP%]{background-color:#f32121;transition:0s}.alert-item__content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:stretch;justify-content:center;line-height:24px;padding:.5em;font-weight:inherit!important;text-align:left}.alert-item__title[_ngcontent-%COMP%]{padding:0;width:100%;display:flex;justify-content:space-between;align-items:center;font-size:1.1em}.alert-item__actions-button[_ngcontent-%COMP%]{min-width:inherit!important}.alert-item__timestamp[_ngcontent-%COMP%]{color:#424242;font-weight:500;display:flex;align-items:center}\"],changeDetection:0}),t})();const Q3=[\"alertElements\"];function J3(t,e){if(1&t&&xl(0),2&t){const t=Ka();Cl(\" \",t.activeRulesFiltersCount>0?t.activeRulesFiltersCount+\" filtre(s) de r\\xe8gles actif(s)\":\"Aucun filtre de r\\xe8gles actif\",\" \")}}function t4(t,e){1&t&&xl(0,\" Afficher les filtres \")}function e4(t,e){if(1&t&&(La(0,\"mat-option\",15),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.id),Cr(1),Cl(\" \",t.name,\" \")}}function i4(t,e){if(1&t){const t=$a();La(0,\"h3\",6),xl(1,\" R\\xe8gles d'alertes \"),La(2,\"button\",12),Ga(\"click\",function(){return Fe(t),Ka().resetRulesFilters()}),xl(3,\" R\\xe9initialiser \"),Fa(),Fa(),La(4,\"mat-list-item\"),La(5,\"mat-form-field\"),La(6,\"mat-label\"),xl(7,\"R\\xe8gles\"),Fa(),La(8,\"mat-select\",13),Ga(\"ngModelChange\",function(e){return Fe(t),Ka().updateAlertRulesFilter(e)}),oa(9,e4,2,2,\"mat-option\",14),Fa(),Fa(),Fa()}if(2&t){const t=Ka();Cr(8),Ra(\"ngModel\",t.alertsFilter.rules),Cr(1),Ra(\"ngForOf\",t.alertRules)}}function n4(t,e){if(1&t){const t=$a();La(0,\"app-alert-item\",18,19),Ga(\"update\",function(e){const i=Fe(t).$implicit;return Ka(2).updateAlert(i.id,e)}),Fa()}if(2&t){const t=e.$implicit,i=Ka(2);Ra(\"titleRef\",i.alertTitleRef)(\"simple\",i.simpleItems)(\"menuItemsRef\",i.alertMenuItemsRef)(\"alert\",t)(\"highlight\",t.id===i.highlightedAlertId),ia(\"data-id\",t.id)}}function s4(t,e){if(1&t&&(La(0,\"div\",16),oa(1,n4,2,6,\"app-alert-item\",17),Fa()),2&t){const t=Ka();Cr(1),Ra(\"ngForOf\",t.displayedAlerts)(\"ngForTrackBy\",t.trackByIndex)}}function r4(t,e){1&t&&(La(0,\"div\",20),xl(1,\" Aucune alerte ne correspond aux filtres\\n\"),Fa())}function o4(t,e){1&t&&(La(0,\"div\",20),xl(1,\" Aucune alerte pour cette p\\xe9riode\\n\"),Fa())}let a4=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.changeDetectorRef=t,this.ngZone=e,this.alertRulesService=i,this.configService=n,this.interactionsService=s,this.enableRuleFilters=!1,this.simpleItems=!0,this.alertRules=[],this.alertsFilter=new kU,this.filteredAlerts=[],this.displayedAlerts=[],this.currentAlertsPageIndex=0,this.alertsPageSize=30,this.highlightedAlertId=null,this.alertsFilter$=new Jp(new kU),this.currentAlertsPageIndex$=new Jp(0),this.filteredAlerts$=new Jp([])}ngOnInit(){if(this.ensureMandatoryInputParams(\"alerts$\"),this.subscriptions.push(this.alertRulesService.alertRules$.pipe(FO()).subscribe(t=>{this.alertRules=t,this.alertRules.map(t=>t.id)})),this.configService.alertsFilter){const t=this.alertRules.map(t=>t.id);this.configService.alertsFilter.rules=this.configService.alertsFilter.rules.filter(e=>t.includes(e)),this.alertsFilter$.next(this.configService.alertsFilter)}else this.resetRulesFilters();this.subscriptions.push(this.alerts$.subscribe(t=>{this.alerts=t})),this.subscriptions.push(JT([this.alerts$,this.alertsFilter$]).pipe(M(([t,e])=>t.filter(t=>(0===e.rules.length||e.rules.includes(t.rule_id))&&(e.showReadAlerts||!t.read)&&(e.showFalsePositiveAlerts||!t.false_positive)))).subscribe(t=>{this.filteredAlerts=t,this.filteredAlerts$.next(t)})),this.subscriptions.push(JT([this.filteredAlerts$,this.currentAlertsPageIndex$]).pipe(Af(([t,e])=>{if(0===t.length&&0!==e)return this.showAlertsPage(0),!1;const i=e*this.alertsPageSize;if(0===t.slice(i,i+this.alertsPageSize).length&&t.length>0){const e=Math.ceil(t.length/this.alertsPageSize)-1;return this.showAlertsPage(-1===e?0:e),!1}return!0}),M(([t,e])=>{const i=e*this.alertsPageSize;return t.slice(i,i+this.alertsPageSize)})).subscribe(t=>{this.displayedAlerts=t,this.changeDetectorRef.markForCheck()})),this.subscriptions.push(this.alertsFilter$.subscribe(t=>{this.alertsFilter=t,this.configService.set(\"alertsFilter\",t),this.showAlertsPage(0)})),this.subscriptions.push(this.interactionsService.selectAlertFeature$.subscribe(t=>{const e=this.getPageIndexForAlertId(t.id);-1!==e&&this.currentAlertsPageIndex!==e&&this.showAlertsPage(e),setTimeout(()=>{const e=this.alertElements.find(e=>e.nativeElement.dataset.id===t.id);e&&e.nativeElement.scrollIntoView({behavior:\"smooth\"})},225),this.highlightedAlertId=t.id,this.ngZone.run(()=>{setTimeout(()=>{this.highlightedAlertId=null,this.changeDetectorRef.markForCheck()},16),this.changeDetectorRef.markForCheck()})}))}get activeRulesFiltersCount(){const t=this.alertsFilter.rules.length;return t===this.alertRules.length?0:t}updateShowReadAlerts(t){this.alertsFilter.showReadAlerts=t,this.triggerAlertsFilterUpdate()}updateShowFalsePositiveAlerts(t){this.alertsFilter.showFalsePositiveAlerts=t,this.triggerAlertsFilterUpdate()}updateAlertRulesFilter(t){this.alertsFilter.rules=t,this.triggerAlertsFilterUpdate()}resetRulesFilters(){this.updateAlertRulesFilter(this.alertRules.map(t=>t.id))}triggerAlertsFilterUpdate(){this.alertsFilter$.next(this.alertsFilter)}showAlertsPage(t){this.currentAlertsPageIndex$.next(t),this.currentAlertsPageIndex=t}trackByIndex(t){return t}updateAlert(t,e){const i=this.alerts.find(e=>e.id===t);if(!i)throw new Error(`Missing alert with id '${t}'`);Object.assign(i,e),this.alerts$.next(this.alerts)}getPageIndexForAlertId(t){const e=this.filteredAlerts.findIndex(e=>e.id===t);if(-1===e)return-1;const i=Math.ceil((e+1)/this.alertsPageSize)-1;return-1===i?0:i}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(nu),Oa(DH),Oa(WU),Oa(DY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alerts-list\"]],viewQuery:function(t,e){if(1&t&&Th(Q3,5,ic),2&t){let t;Mh(t=Ph())&&(e.alertElements=t)}},inputs:{alerts$:\"alerts$\",enableRuleFilters:\"enableRuleFilters\",alertTitleRef:\"alertTitleRef\",alertMenuItemsRef:\"alertMenuItemsRef\",simpleItems:\"simpleItems\"},features:[Uo],decls:19,vars:12,consts:[[\"mat-button\",\"\",\"title\",\"Filtrer les alertes\",1,\"alerts-list__filters\",3,\"color\",\"matMenuTriggerFor\"],[3,\"ngIf\",\"ngIfElse\"],[\"disabledRuleFilters\",\"\"],[1,\"u-wide-menu\"],[\"alertsFilterMenu\",\"matMenu\"],[3,\"click\"],[\"mat-subheader\",\"\"],[\"color\",\"primary\",3,\"ngModel\",\"ngModelChange\"],[3,\"ngIf\"],[\"class\",\"scrollable\",4,\"ngIf\"],[\"class\",\"panel__content u-center\",4,\"ngIf\"],[\"showFirstLastButtons\",\"\",\"hidePageSize\",\"\",3,\"pageIndex\",\"length\",\"pageSize\",\"page\"],[\"mat-button\",\"\",\"title\",\"R\\xe9initialiser les filtres\",1,\"alerts-list__reset-filters-btn\",3,\"click\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"],[1,\"scrollable\"],[3,\"titleRef\",\"simple\",\"menuItemsRef\",\"alert\",\"highlight\",\"update\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"titleRef\",\"simple\",\"menuItemsRef\",\"alert\",\"highlight\",\"update\"],[\"alertElements\",\"\"],[1,\"panel__content\",\"u-center\"]],template:function(t,e){if(1&t&&(La(0,\"button\",0),La(1,\"mat-icon\"),xl(2,\"filter_list\"),Fa(),oa(3,J3,1,1,\"ng-template\",1),oa(4,t4,1,0,\"ng-template\",null,2,Lh),Fa(),La(6,\"mat-menu\",3,4),La(8,\"mat-list\",5),Ga(\"click\",function(t){return t.stopPropagation()}),La(9,\"h2\",6),xl(10,\"Filtres\"),Fa(),La(11,\"mat-list-item\"),La(12,\"mat-checkbox\",7),Ga(\"ngModelChange\",function(t){return e.updateShowReadAlerts(t)}),xl(13,\"Afficher les alertes lues\"),Fa(),Fa(),oa(14,i4,10,2,\"ng-template\",8),Fa(),Fa(),oa(15,s4,2,2,\"div\",9),oa(16,r4,2,0,\"div\",10),oa(17,o4,2,0,\"div\",10),La(18,\"mat-paginator\",11),Ga(\"page\",function(t){return e.showAlertsPage(t.pageIndex)}),Fa()),2&t){const t=aa(5),i=aa(7);Ra(\"color\",e.activeRulesFiltersCount?\"primary\":\"default\")(\"matMenuTriggerFor\",i),Cr(3),Ra(\"ngIf\",e.enableRuleFilters)(\"ngIfElse\",t),Cr(9),Ra(\"ngModel\",e.alertsFilter.showReadAlerts),Cr(2),Ra(\"ngIf\",e.enableRuleFilters),Cr(1),Ra(\"ngIf\",e.displayedAlerts.length),Cr(1),Ra(\"ngIf\",!e.filteredAlerts.length&&e.alerts.length),Cr(1),Ra(\"ngIf\",!e.alerts.length),Cr(1),Ra(\"pageIndex\",e.currentAlertsPageIndex)(\"length\",e.filteredAlerts.length)(\"pageSize\",e.alertsPageSize)}},directives:[Ly,D0,uE,Vd,T0,Y0,X0,Q0,hY,Sw,nx,II,AS,aS,qT,Bd,ky,X3],styles:[\"[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.alerts-list__filters[_ngcontent-%COMP%]{background-color:#e4e7ec;width:100%}.alerts-list__reset-filters-btn[_ngcontent-%COMP%]{margin-left:2em}\"],changeDetection:0}),t})();function l4(t,e){if(1&t&&(La(0,\"div\",10),La(1,\"mat-icon\",11),xl(2,\"access_time\"),Fa(),La(3,\"div\",12),ch(4,\"timeago\"),xl(5),ch(6,\"date\"),Fa(),Fa()),2&t){const t=Ka();Cr(3),tl(\"title\",hh(4,2,1e3*t.ship.timestamp)),Cr(2),Cl(\" \",dh(6,4,1e3*t.ship.timestamp,\"yyyy-MM-dd HH:mm:ss z\",t.useUTCDates&&\"+00\"),\" \")}}let c4=(()=>{class t extends Gq{constructor(t,e){super(),this.changeDetectorRef=t,this.mapConfigService=e,this.showTimestamp=!1,this.useUTCDates=!1,this.vesselTypeLabelsByType=oU}ngOnInit(){this.ensureMandatoryInputParams(\"ship\"),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t,this.changeDetectorRef.markForCheck()}))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(qU))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ship-item-small\"]],inputs:{ship:\"ship\",showTimestamp:\"showTimestamp\"},features:[Uo],decls:23,vars:7,consts:[[1,\"ship-item\"],[1,\"ship-item__col1\"],[1,\"u-flex\",\"d-flex-center\"],[1,\"ship-item__flag\",3,\"mmsi\"],[1,\"d-flex-column\"],[1,\"ship-item__name\"],[1,\"ship-item__type\"],[\"class\",\"ship-item__timestamp\",\"title\",\"Derni\\xe8re r\\xe9ception\",4,\"ngIf\"],[1,\"ship-item__col2\"],[1,\"ship-item__label\"],[\"title\",\"Derni\\xe8re r\\xe9ception\",1,\"ship-item__timestamp\"],[1,\"mini-icon\",\"mr-1\"],[3,\"title\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"div\",2),Na(3,\"app-flag\",3),La(4,\"div\",4),La(5,\"div\",5),xl(6),Fa(),La(7,\"small\",6),xl(8),Fa(),Fa(),Fa(),oa(9,l4,7,8,\"div\",7),Fa(),La(10,\"div\",8),La(11,\"div\"),La(12,\"span\",9),xl(13,\"MMSI\"),Fa(),xl(14),Fa(),La(15,\"div\"),La(16,\"span\",9),xl(17,\"IMO\"),Fa(),xl(18),Fa(),La(19,\"div\"),La(20,\"span\",9),xl(21,\"Callsign\"),Fa(),xl(22),Fa(),Fa(),Fa()),2&t&&(Cr(3),Ra(\"mmsi\",e.ship.mmsi),Cr(3),Sl(e.ship.name||\"?\"),Cr(2),Sl(e.ship.cargo?e.vesselTypeLabelsByType[e.ship.cargo]:\"?\"),Cr(1),Ra(\"ngIf\",e.showTimestamp),Cr(5),Cl(\" \",e.ship.mmsi,\"\"),Cr(4),Cl(\" \",e.ship.imo||\"?\",\"\"),Cr(4),Cl(\" \",e.ship.callsign||\"?\",\"\"))},directives:[MJ,Vd,uE],pipes:[$F,ip],styles:[\"[_nghost-%COMP%]{flex:1;display:block;position:relative}.ship-item[_ngcontent-%COMP%]{font-size:12px;line-height:16px;display:flex}.ship-item__col1[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.ship-item__col2[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:right}.ship-item__flag[_ngcontent-%COMP%]{margin-right:4px}.ship-item__name[_ngcontent-%COMP%]{font-size:14px}.ship-item__type[_ngcontent-%COMP%]{line-height:1em;font-size:11px}.ship-item__timestamp[_ngcontent-%COMP%]{margin-top:4px;display:flex;align-items:center;color:gray}.ship-item__timestamp[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{font-size:1em;height:1em;width:1em;margin-right:.3em;margin-left:.3em}.ship-item__label[_ngcontent-%COMP%]{color:gray;font-size:10px}\"],changeDetection:0}),t})();function h4(t,e){1&t&&Na(0,\"mat-spinner\",5)}function u4(t,e){1&t&&(La(0,\"mat-error\",31),xl(1,\" Ce champ ne peut \\xeatre vide. \"),Fa())}function d4(t,e){if(1&t){const t=$a();La(0,\"mat-form-field\",25),La(1,\"input\",26,27),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.name=e}),Fa(),oa(3,u4,2,0,\"mat-error\",28),Fa(),La(4,\"button\",29),Ga(\"click\",function(){return Fe(t),Ka(2).save()}),La(5,\"mat-icon\"),xl(6,\"check\"),Fa(),Fa(),La(7,\"button\",30),La(8,\"mat-icon\"),xl(9,\"clear\"),Fa(),Fa()}if(2&t){const t=aa(2);Ka();const e=aa(1),i=Ka();Cr(1),Ra(\"ngModel\",i.alertRule.name),Cr(2),Ra(\"ngIf\",null==t.errors?null:t.errors.required),Cr(1),Ra(\"disabled\",!e.form.valid),Cr(3),Ra(\"routerLink\",i.newRule?\"/alerts/rules\":\"/alerts/rules/\"+i.alertRule.id)}}function p4(t,e){if(1&t){const t=$a();Na(0,\"div\",15),La(1,\"button\",33),La(2,\"mat-icon\"),xl(3,\"create\"),Fa(),Fa(),La(4,\"button\",34),Ga(\"click\",function(){return Fe(t),Ka(3).delete()}),La(5,\"mat-icon\"),xl(6,\"delete\"),Fa(),Fa()}if(2&t){const t=Ka(3);Cr(1),Ra(\"routerLink\",\"/alerts/rules/\"+t.alertRule.id+\"/edit\")}}function f4(t,e){if(1&t&&(La(0,\"h2\",32),xl(1),Fa(),oa(2,p4,7,1,\"ng-template\",4)),2&t){const t=Ka(2);Cr(1),Cl(\" \",t.alertRule.name,\" \"),Cr(1),Ra(\"ngIf\",t.canEdit)}}function m4(t,e){if(1&t&&(La(0,\"mat-option\",39),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.id),Cr(1),Cl(\" \",t.name,\" \")}}function g4(t,e){if(1&t){const t=$a();La(0,\"div\",35),La(1,\"mat-form-field\",36),La(2,\"mat-label\"),xl(3,\"Groupe\"),Fa(),La(4,\"mat-select\",37),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.group_id=e}),oa(5,m4,2,2,\"mat-option\",38),Fa(),La(6,\"mat-hint\"),xl(7,\" Attention, changer le groupe r\\xe9initialisera les zones et flottes utilis\\xe9es \"),Fa(),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(4),Ra(\"ngModel\",t.alertRule.group_id),Cr(1),Ra(\"ngForOf\",t.updatableGroups)}}function A4(t,e){1&t&&(La(0,\"div\",18),La(1,\"mat-chip-list\",13),La(2,\"mat-chip\",40),xl(3,\" Configuration incorrecte \"),Fa(),Fa(),Fa())}function v4(t,e){if(1&t){const t=$a();xl(0,\" \\xa0 \"),La(1,\"mat-slide-toggle\",41),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.active=e}),Fa()}if(2&t){const t=Ka(2);Cr(1),Ra(\"title\",t.alertRule.active?\"D\\xe9sactiver\":\"Activer\")(\"ngModel\",t.alertRule.active)}}function _4(t,e){1&t&&(La(0,\"div\",42),xl(1,\" Une r\\xe8gle active va permettre au serveur d'analyser les donn\\xe9es en temps r\\xe9el et remonter des alertes en fonction des crit\\xe8res choisis. \"),Fa(),La(2,\"div\",42),xl(3,\" Une r\\xe8gle d\\xe9sactiv\\xe9e ne remontera aucune nouvelle alerte. \"),Fa(),Na(4,\"br\"))}function b4(t,e){if(1&t){const t=$a();La(0,\"div\"),xl(1,\" Rapport quotidien \"),La(2,\"mat-icon\",43),xl(3,\"help\"),Fa(),xl(4,\" :\\xa0 \"),La(5,\"mat-slide-toggle\",44),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.enableDailyReport=e}),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(5),Ra(\"title\",t.alertRule.enableDailyReport?\"D\\xe9sactiver le rapport\":\"Activer le rapport\")(\"ngModel\",t.alertRule.enableDailyReport)(\"disabled\",!t.editMode)}}function y4(t,e){1&t&&(La(0,\"div\",45),xl(1,\" Au moins un crit\\xe8re est n\\xe9cessaire pour d\\xe9clencher les alertes. \"),Fa())}function w4(t,e){if(1&t){const t=$a();La(0,\"app-ais-interruption-criterion\",46),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.aisInterruption=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.aisInterruption)(\"editable\",t.editMode)}}function x4(t,e){if(1&t){const t=$a();La(0,\"app-transhipment-criterion\",47),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.transhipment=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.transhipment)(\"editable\",t.editMode)}}function S4(t,e){if(1&t){const t=$a();La(0,\"app-erratic-route-criterion\",48),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.erraticRoute=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.erraticRoute)(\"editable\",t.editMode)}}function C4(t,e){if(1&t){const t=$a();La(0,\"app-speed-criterion\",49),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.speed=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.speed)(\"editable\",t.editMode)}}function k4(t,e){if(1&t){const t=$a();La(0,\"app-passage-in-zone-criterion\",50),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.passageInZone=e})(\"updateZones\",function(){return Fe(t),Ka(2).refreshAlertRulesZones()}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.passageInZone)(\"editable\",t.editMode)(\"groupId\",t.alertRule.group_id?t.alertRule.group_id:null)}}function E4(t,e){if(1&t){const t=$a();La(0,\"app-spoofing-criterion\",51),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.spoofing=e}),Fa()}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.spoofing)(\"editable\",t.editMode)}}function M4(t,e){if(1&t){const t=$a();La(0,\"app-identifier-filter\",52),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.identifier=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.identifier)(\"editable\",t.editMode)}}function T4(t,e){if(1&t){const t=$a();La(0,\"app-fleet-filter\",53),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.fleet=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.fleet)(\"editable\",t.editMode)(\"groupId\",t.alertRule.group_id?t.alertRule.group_id:null)}}function I4(t,e){if(1&t){const t=$a();La(0,\"app-flag-filter\",54),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.flag=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.flag)(\"editable\",t.editMode)}}function P4(t,e){if(1&t){const t=$a();La(0,\"app-type-filter\",55),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).alertRule.criteria.type=e}),Fa(),Na(1,\"mat-divider\")}if(2&t){const t=Ka(2);Ra(\"ngModel\",t.alertRule.criteria.type)(\"editable\",t.editMode)}}function O4(t,e){if(1&t&&(Na(0,\"app-ship-item-small\",62),La(1,\"div\",63),ch(2,\"timeago\"),La(3,\"mat-icon\",64),xl(4,\"access_time\"),Fa(),xl(5),ch(6,\"date\"),Fa()),2&t){const t=e.alert,i=Ka(3);Ra(\"ship\",t.ship),Cr(1),tl(\"title\",hh(2,3,1e3*t.start)),Cr(4),Cl(\" \",dh(6,5,1e3*t.start,\"yyyy-MM-dd HH:mm:ss z\",i.useUTCDates&&\"+00\"),\" \")}}const R4=function(t){return[\"/ships/\",t]};function D4(t,e){if(1&t){const t=$a();La(0,\"button\",65),La(1,\"mat-icon\"),xl(2,\"info\"),Fa(),xl(3,\" Voir d\\xe9tail Navire \"),Fa(),La(4,\"button\",66),Ga(\"click\",function(){const e=Fe(t).alert;return Ka(3).locateShip(e.mmsi)}),La(5,\"mat-icon\"),xl(6,\"center_focus_strong\"),Fa(),xl(7,\" Voir position Navire \"),Fa()}2&t&&Ra(\"routerLink\",ih(1,R4,e.alert.mmsi))}function L4(t,e){if(1&t){const t=$a();La(0,\"div\",56),La(1,\"h4\",57),xl(2,\"Alertes\"),Fa(),La(3,\"button\",58),Ga(\"click\",function(){return Fe(t),Ka(2).exportAlertsAsCSV()}),La(4,\"mat-icon\"),xl(5,\"file_download\"),Fa(),Fa(),Fa(),Na(6,\"app-alerts-list\",59),oa(7,O4,7,9,\"ng-template\",null,60,Lh),oa(9,D4,8,3,\"ng-template\",null,61,Lh)}if(2&t){const t=aa(8),e=aa(10),i=Ka(2);Cr(3),Ra(\"disabled\",0===i.alerts$.value.length),Cr(3),Ra(\"alerts$\",i.alerts$)(\"simpleItems\",!1)(\"alertTitleRef\",t)(\"alertMenuItemsRef\",e)}}function F4(t,e){if(1&t){const t=$a();La(0,\"ng-form\",6,7),La(2,\"div\",8),oa(3,d4,10,4,\"ng-template\",4),oa(4,f4,3,2,\"ng-template\",4),Fa(),La(5,\"div\",9),oa(6,g4,8,2,\"div\",10),oa(7,A4,4,0,\"div\",11),La(8,\"div\",12),xl(9,\" \\xc9tat :\\xa0 \"),La(10,\"mat-chip-list\",13),La(11,\"mat-chip\",14),xl(12),Fa(),Fa(),oa(13,v4,2,2,\"ng-template\",4),Na(14,\"div\",15),La(15,\"button\",16),Ga(\"click\",function(){Fe(t);const e=Ka();return e.showColorPicker=!e.showColorPicker}),Fa(),La(16,\"input\",17),Ga(\"colorPickerChange\",function(e){return Fe(t),Ka().alertRule.color=e})(\"cpToggleChange\",function(e){return Fe(t),Ka().showColorPicker=e}),Fa(),Fa(),La(17,\"div\",18),oa(18,_4,5,0,\"ng-template\",4),oa(19,b4,6,3,\"div\",19),Na(20,\"br\"),xl(21,\" R\\xe9sum\\xe9 : \"),Na(22,\"div\",20),Fa(),Na(23,\"mat-divider\"),La(24,\"h3\",21),xl(25,\"Zone\"),Fa(),La(26,\"app-zone-filter\",22),Ga(\"ngModelChange\",function(e){return Fe(t),Ka().alertRule.criteria.zone=e})(\"updateZones\",function(){return Fe(t),Ka().refreshAlertRulesZones()}),Fa(),Na(27,\"mat-divider\"),La(28,\"h3\",21),xl(29,\"Crit\\xe8res\"),Fa(),oa(30,y4,2,0,\"div\",23),oa(31,w4,2,2,\"ng-template\",4),oa(32,x4,2,2,\"ng-template\",4),oa(33,S4,2,2,\"ng-template\",4),oa(34,C4,2,2,\"ng-template\",4),oa(35,k4,2,3,\"ng-template\",4),oa(36,E4,1,2,\"ng-template\",4),La(37,\"h3\",21),xl(38,\"Filtres\"),Fa(),La(39,\"div\",24),xl(40,\" L'ajout de filtres \\xe0 une r\\xe8gle permet de diminuer le nombre d'alertes. \"),Fa(),La(41,\"h4\",21),xl(42,\"Sur navire\"),Fa(),oa(43,M4,2,2,\"ng-template\",4),oa(44,T4,2,3,\"ng-template\",4),oa(45,I4,2,2,\"ng-template\",4),oa(46,P4,2,2,\"ng-template\",4),oa(47,L4,11,5,\"ng-template\",4),Fa(),Fa()}if(2&t){const t=aa(1),e=Ka();Cr(3),Ra(\"ngIf\",e.editMode),Cr(1),Ra(\"ngIf\",!e.editMode),Cr(2),Ra(\"ngIf\",e.editMode&&e.newRule&&e.updatableGroups.length>1),Cr(1),Ra(\"ngIf\",!e.editMode&&!e.alertRule.validZone),Cr(4),Ra(\"disabled\",!e.alertRule.active),Cr(1),Cl(\" \",e.alertRule.active?\"Active\":\"D\\xe9sactiv\\xe9e\",\" \"),Cr(1),Ra(\"ngIf\",e.editMode),Cr(2),cl(\"background-color\",e.alertRule.color),Ra(\"disabled\",!e.editMode)(\"title\",e.editMode?\"Changer la couleur des alertes de la r\\xe8gle\":\"Couleur des alertes de la r\\xe8gle\"),Cr(1),Ra(\"colorPicker\",e.alertRule.color)(\"cpAlphaChannel\",\"disabled\")(\"cpOutputFormat\",\"hex\")(\"cpToggle\",e.showColorPicker),Cr(2),Ra(\"ngIf\",e.editMode),Cr(1),Ra(\"ngIf\",!e.alertRule.group_id),Cr(3),Ra(\"innerHTML\",e.summaryHtml,xs),Cr(4),Ra(\"ngModel\",e.alertRule.criteria.zone)(\"editable\",e.editMode)(\"groupId\",e.alertRule.group_id?e.alertRule.group_id:null),Cr(4),Ra(\"ngIf\",null==t.errors?null:t.errors.missingCriterion),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.aisInterruption.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.transhipment.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.erraticRoute.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.speed.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.passageInZone.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.spoofing.enable),Cr(7),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.identifier.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.fleet.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.flag.enable),Cr(1),Ra(\"ngIf\",e.editMode||e.alertRule.criteria.type.enable),Cr(1),Ra(\"ngIf\",!e.editMode)}}let N4=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o,a,l,c,h,u,d,p,f,m){super(),this.activatedRoute=t,this.domSanitizer=e,this.router=i,this.titleService=n,this.alertsService=s,this.alertRulesService=r,this.configService=o,this.editZoneService=a,this.fleetsService=l,this.groupsService=c,this.mapConfigService=h,this.mapService=u,this.timeRangeService=d,this.zonesLayerService=p,this.uiService=f,this.workerService=m,this.alertRuleId$=new Jp(null),this.alertRule$=new Jp(null),this.alerts$=new Jp([]),this.editMode=!1,this.newRule=!1,this.showColorPicker=!1,this.canEdit=!1,this.useUTCDates=!1,this.summary=\"\",this.summaryHtml=\"\",this.updatableGroups=[],this.save=()=>Hp(this,void 0,void 0,function*(){if(this.newRule){const t=yield this.alertRulesService.createAlertRule(this.alertRule);yield this.router.navigateByUrl(`/alerts/rules/${t}`)}else yield this.alertRulesService.updateAlertRule(this.alertRule),yield this.router.navigateByUrl(`/alerts/rules/${this.alertRule.id}`)})}ngOnInit(){this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t}),this.activatedRoute.data.subscribe(t=>{this.editMode=!!t.edit,this.newRule=!!t.new}),this.alertRuleId$.pipe(kf(1)).subscribe(t=>Hp(this,void 0,void 0,function*(){this.editMode?yield this.editAlertRule(t):yield this.viewAlertRule(t)})),JT([this.activatedRoute.paramMap,this.activatedRoute.queryParams]).subscribe(([t,e])=>Hp(this,void 0,void 0,function*(){this.newRule?(this.alertRule=function(t){const e={name:\"\",active:!0,criteria:{},color:\"#5e12e2\",enableDailyReport:!1,validZone:!1,group_id:null!=t?t:\"\"};return SH(e.criteria),e}(e.groupId),this.titleService.setTitle(\"Nouvelle r\\xe8gle - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView()):this.alertRuleId$.next(t.get(\"alertRuleId\"))})),this.groupsService.updatableGroups$.subscribe(t=>{this.updatableGroups=t}),this.alertRule$.pipe(kf(1)).subscribe(t=>{this.titleService.setTitle(`R\\xe8gle ${t.name} - ANAIS`),this.alertRule=t,this.refreshAlertRulesSummary(),this.refreshAlertRulesZones()}),JT([this.alertRule$.pipe(kf(1)),this.groupsService.updatableGroups$]).subscribe(([t,e])=>{this.canEdit=null===t.group_id||e.some(e=>e.id===t.group_id)})),this.subscriptions.push(this.editMode?this.editZoneService.editedZone$.pipe(kf(1),Tf(),Oj(0)).subscribe(t=>{t||(this.refreshAlertRulesZones(),this.refreshAlertRulesSummary())}):JT([this.alertRuleId$,this.timeRangeService.timeRange$]).subscribe(([t,e])=>Hp(this,void 0,void 0,function*(){if(t){const i=yield this.workerService.alertRules.getAlertRuleAlerts(t,e.start,e.end),[n,s]=this.alertRulesService.getAlertRuleColor(t);i.forEach(t=>{t.color=n,t.rgbVecColor=s}),this.alertsService.updateAlerts(i),this.alerts$.next(i)}})))}ngOnDestroy(){super.ngOnDestroy(),this.zonesLayerService.clear(),this.editZoneService.cancelEditing(),this.alertsService.updateAlerts([]),this.alertRulesService.deselectAlertRule()}ngDoCheck(){this.refreshAlertRulesSummary()}editAlertRule(t){return Hp(this,void 0,void 0,function*(){yield this.fetchAlertRule(t)})}viewAlertRule(t){return Hp(this,void 0,void 0,function*(){this.alertRuleId!==t&&(this.alertRuleId=t),yield this.fetchAlertRule(t)})}refreshAlertRulesZones(){this.zonesLayerService.updateZones(function(t){return[].concat(t.criteria.passageInZone.enable?t.criteria.passageInZone.passages.flatMap(t=>t.zone):[]).concat(t.criteria.zone.enable?t.criteria.zone.zones:[])}(this.alertRule))}refreshAlertRulesSummary(){if(this.alertRule){const t=function(t,e){var i,n,s,r,o,a,l,c,h,u,d;const p=[\"Tous les navires \"],f=[];if((null===(i=t.criteria.identifier)||void 0===i?void 0:i.enable)&&f.push(`<br>- dont les identifiants sont ${t.criteria.identifier.identifiers.map(t=>`<em>${vU(t)}</em>`).join(\" OU \")}`),null===(n=t.criteria.fleet)||void 0===n?void 0:n.enable){const i=t.criteria.fleet.fleets.map(t=>{var i,n;return null===(n=null!==(i=e.find(e=>e.id===t))&&void 0!==i?i:{})||void 0===n?void 0:n.name}).filter(t=>!!t);f.push(`<br>- faisant partie ${t.criteria.fleet.fleets.length>1?\"des flottes\":\"de la flotte\"} ${i.map(t=>`<em>${vU(t)}</em>`).join(\" OU \")}`)}(null===(s=t.criteria.flag)||void 0===s?void 0:s.enable)&&f.push(t.criteria.flag.flags.length<5?`<br>- de pavillon ${t.criteria.flag.flags.map(t=>`<span class=\"fi fi-${vU(t)}\" style=\"margin-right: 5px\"></span><em>${kH[t]}</em>`).join(\" OU \")}`:`<br>- de ${t.criteria.flag.flags.length} pavillons`),(null===(r=t.criteria.type)||void 0===r?void 0:r.enable)&&f.push(`<br>- de type ${t.criteria.type.types.map(t=>`<em>${aU[t].name}</em>`).join(\" OU \")}`),f.length>0&&(p.push(\":\"),p.push(f.join(\"\")),p.push(\"<br>\"));const m=[];if((null===(o=t.criteria.aisInterruption)||void 0===o?void 0:o.enable)&&m.push(\"<br>- coup\\xe9 leur transmission AIS\"),(null===(a=t.criteria.transhipment)||void 0===a?void 0:a.enable)&&m.push(\"<br>- particip\\xe9 \\xe0 un transbordement\"),(null===(l=t.criteria.erraticRoute)||void 0===l?void 0:l.enable)&&m.push(\"<br>- navigu\\xe9 de fa\\xe7on erratique\"),(null===(c=t.criteria.speed)||void 0===c?void 0:c.enable)&&m.push(`<br>- eu une vitesse entre <em>${t.criteria.speed.min}</em> et <em>${t.criteria.speed.max}</em> noeuds`),null===(h=t.criteria.passageInZone)||void 0===h?void 0:h.enable){const e=t.criteria.passageInZone.sequential?\" PUIS \":\" ET \";m.push(`<br>- navigu\\xe9 dans ${t.criteria.passageInZone.passages.length>1?\"les zones\":\"la zone\"} ${t.criteria.passageInZone.passages.map(t=>`<em>${vU(t.zone.name)}</em>`).join(e)}`),t.criteria.passageInZone.passages.length>1&&m.push(` dans un intervalle de ${wH[t.criteria.passageInZone.timeWindow]}`)}return(null===(u=t.criteria.spoofing)||void 0===u?void 0:u.enable)&&m.push(\"<br>- modifi\\xe9 ses identifiants AIS\"),0===m.length?\"Il faut s\\xe9lectionner au moins un crit\\xe8re avant d'avoir une r\\xe8gle applicable\":(p.push(\"ayant :\"),p.push(m.join(\"\")),(null===(d=t.criteria.zone)||void 0===d?void 0:d.enable)&&p.push(`<br>dans ${t.criteria.zone.zones.length>1?\"les zones\":\"la zone\"} ${t.criteria.zone.zones.map(t=>`<em>${vU(t.name)}</em>`).join(\" OU \")}`),p.push(\".\"),p.join(\"\"))}(this.alertRule,this.fleetsService.fleets$.value);t!==this.summary&&(this.summary=t,this.summaryHtml=this.domSanitizer.bypassSecurityTrustHtml(t))}}delete(){this.uiService.confirm({title:\"Suppression\",message:\"Une fois supprim\\xe9e, cette r\\xe8gle ne sera plus accessible. Confirmez-vous la suppression de cette r\\xe8gle ?\",action:t=>Hp(this,void 0,void 0,function*(){t&&(yield this.alertRulesService.deleteAlertRule(this.alertRule.id),yield this.router.navigateByUrl(\"/alerts/rules\"))})})}locateShip(t){return Hp(this,void 0,void 0,function*(){const e=yield this.workerService.ships.getShip(t);this.mapService.centerOnLonLat([e.lon,e.lat])})}fetchAlertRule(t){return Hp(this,void 0,void 0,function*(){try{this.alertRule$.next(yield this.alertRulesService.selectAlertRule(t))}catch(e){throw e.notfound?(this.router.navigateByUrl(\"/alerts/rules\").catch(()=>{}),new Error(`La r\\xe8gle <${t}> n'existe pas.`)):e}})}exportAlertsAsCSV(){const t=this.timeRangeService.timeRange$.value,e=yq(t.start),i=yq(t.end);this.alerts$.value.forEach(t=>{t.rule_name=this.alertRule.name}),bY(VJ(this.alerts$.value),`anais-alerts-${this.alertRule.name}-${e}-${i}.csv`,\"text/csv\")}}return t.\\u0275fac=function(e){return new(e||t)(Oa(GR),Oa(Np),Oa(pL),Oa(jp),Oa(LH),Oa(DH),Oa(WU),Oa($J),Oa(zY),Oa(UY),Oa(qU),Oa(Pj),Oa(Kq),Oa(LY),Oa(_H),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alert-rule-panel\"]],features:[Uo],decls:8,vars:2,consts:[[1,\"panel\"],[1,\"d-flex\",2,\"background-color\",\"#fff\"],[\"mat-button\",\"\",\"title\",\"Revenir \\xe0 la liste\",\"routerLink\",\"/alerts/rules\",1,\"back-button\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"name\",\"form\",\"appAlertRule\",\"\",1,\"alert-rule-panel\",\"panel\",\"unscrollable\"],[\"form\",\"ngForm\"],[1,\"panel__header\"],[1,\"scrollable\"],[\"class\",\"d-flex-baseline\",4,\"ngIf\"],[\"class\",\"panel__content\",4,\"ngIf\"],[1,\"panel__content\",\"alert-rule-panel__header\"],[1,\"d-inline\"],[\"color\",\"primary\",\"selected\",\"\",\"disableRipple\",\"\",3,\"disabled\"],[1,\"u-flex\"],[\"mat-mini-fab\",\"\",1,\"alert-rule-panel__color-picker-button\",3,\"disabled\",\"title\",\"click\"],[\"name\",\"color\",1,\"alert-rule-panel__color-picker-attach\",3,\"colorPicker\",\"cpAlphaChannel\",\"cpOutputFormat\",\"cpToggle\",\"colorPickerChange\",\"cpToggleChange\"],[1,\"panel__content\"],[4,\"ngIf\"],[1,\"alert-rule-panel__summary\",3,\"innerHTML\"],[1,\"panel__subtitle\"],[\"name\",\"zone\",3,\"ngModel\",\"editable\",\"groupId\",\"ngModelChange\",\"updateZones\"],[\"class\",\"criterion-content alert-rule-panel__error-msg\",4,\"ngIf\"],[1,\"criterion-content\"],[1,\"alert-rule-panel__name-input\"],[\"matInput\",\"\",\"name\",\"name\",\"placeholder\",\"Nom de la r\\xe8gle\",\"required\",\"\",\"maxlength\",\"64\",3,\"ngModel\",\"ngModelChange\"],[\"name\",\"ngModel\"],[\"class\",\"input-error\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Enregistrer les changements\",\"data-test\",\"save-rule\",3,\"disabled\",\"click\"],[\"mat-button\",\"\",\"title\",\"Annuler l'\\xe9dition\",3,\"routerLink\"],[1,\"input-error\"],[1,\"panel__title\"],[\"mat-button\",\"\",\"title\",\"Modifier\",3,\"routerLink\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer la r\\xe8gle\",3,\"click\"],[1,\"d-flex-baseline\"],[1,\"pa-2\",\"u-flex\"],[\"name\",\"group_id\",3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"],[\"color\",\"warn\",\"selected\",\"\",\"disableRipple\",\"\",\"title\",\"La configuration de cette r\\xe8gle est incorrecte. Elle doit contenir au moins une zone de filtrage.\"],[\"name\",\"active\",\"color\",\"primary\",3,\"title\",\"ngModel\",\"ngModelChange\"],[1,\"alert-rule-panel__description\"],[\"matTooltip\",\"Recevoir par email un rapport quotidien des alertes de la veille (jours UTC)\",\"matTooltipPosition\",\"above\",1,\"help-icon\"],[\"name\",\"enableDailyReport\",\"color\",\"primary\",3,\"title\",\"ngModel\",\"disabled\",\"ngModelChange\"],[1,\"criterion-content\",\"alert-rule-panel__error-msg\"],[\"name\",\"aisInterruption\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"transhipment\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"erraticRoute\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"speed\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"passageInZone\",3,\"ngModel\",\"editable\",\"groupId\",\"ngModelChange\",\"updateZones\"],[\"name\",\"spoofing\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"identifier\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"fleet\",3,\"ngModel\",\"editable\",\"groupId\",\"ngModelChange\"],[\"name\",\"flag\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[\"name\",\"type\",3,\"ngModel\",\"editable\",\"ngModelChange\"],[1,\"d-flex-center\"],[1,\"u-flex\",\"my-0\",\"pa-2\"],[\"mat-button\",\"\",\"title\",\"Exporter les alertes au format CSV\",3,\"disabled\",\"click\"],[3,\"alerts$\",\"simpleItems\",\"alertTitleRef\",\"alertMenuItemsRef\"],[\"alertTitleRef\",\"\"],[\"alertMenuItemsRef\",\"\"],[1,\"alert__ship\",3,\"ship\"],[1,\"alert__timestamp\",3,\"title\"],[\"title\",\"Date de l'alerte\",1,\"mini-icon\",\"mr-1\"],[\"mat-menu-item\",\"\",3,\"routerLink\"],[\"mat-menu-item\",\"\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"a\",2),La(3,\"mat-icon\"),xl(4,\"arrow_back_ios\"),Fa(),xl(5,\" R\\xe8gles d'alerte \"),Fa(),Fa(),oa(6,h4,1,0,\"mat-spinner\",3),oa(7,F4,48,33,\"ng-template\",4),Fa()),2&t&&(Cr(6),Ra(\"ngIf\",!e.alertRule),Cr(1),Ra(\"ngIf\",e.alertRule))},directives:[Fy,gL,uE,Vd,KJ,Jw,QJ,u0,r0,Ly,bO,Xq,c1,Sw,nx,AS,ES,Gy,Ex,Px,mL,eS,aS,qT,Bd,oS,ky,b1,mI,O1,R1,D1,B1,K2,X2,S3,I3,F3,$3,a4,c4,S0],pipes:[$F,ip],styles:[\"[_nghost-%COMP%]{display:flex;overflow:hidden}.back-button[_ngcontent-%COMP%]{line-height:36px}.alert-rule-panel__name-input[_ngcontent-%COMP%]{margin:.5em;flex:1;font-size:20px}.alert-rule-panel__header[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}.alert-rule-panel__color-picker-button[_ngcontent-%COMP%]{margin-left:16px;margin-right:8px;height:30px;width:30px}  .alert-rule-panel__color-picker-button.mat-fab:not(.mat-button-disabled):active:not([class*=mat-elevation-z]),   .alert-rule-panel__color-picker-button.mat-mini-fab:not(.mat-button-disabled):active:not([class*=mat-elevation-z]){box-shadow:0 5px 7px -2px rgba(0,0,0,.2),0 8px 14px 2px rgba(0,0,0,.14),0 4px 20px 2px rgba(0,0,0,.12)!important}.alert-rule-panel__color-picker-attach[_ngcontent-%COMP%]{opacity:0;width:1px;height:1px;pointer-events:none}.alert-rule-panel__description[_ngcontent-%COMP%]{margin-top:.5em;font-size:14px}.alert-rule-panel__summary[_ngcontent-%COMP%]     em{font-size:1.1em;font-weight:500;font-style:normal;color:#1515a6}.alert-rule-panel__error-msg[_ngcontent-%COMP%]{color:#ce1d1d}.alert__timestamp[_ngcontent-%COMP%]{color:gray;display:flex;align-items:center}\"]}),t})(),B4=0;const z4=new Ji(\"CdkAccordion\");let V4=(()=>{class t{constructor(){this._stateChanges=new C,this._openCloseAllActions=new C,this.id=\"cdk-accordion-\"+B4++,this._multi=!1}get multi(){return this._multi}set multi(t){this._multi=Lf(t)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(t){this._stateChanges.next(t)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"cdk-accordion\"],[\"\",\"cdkAccordion\",\"\"]],inputs:{multi:\"multi\"},exportAs:[\"cdkAccordion\"],features:[Yl([{provide:z4,useExisting:t}]),he]}),t})(),$4=0,U4=(()=>{class t{constructor(t,e,i){this.accordion=t,this._changeDetectorRef=e,this._expansionDispatcher=i,this._openCloseAllSubscription=d.EMPTY,this.closed=new gh,this.opened=new gh,this.destroyed=new gh,this.expandedChange=new gh,this.id=\"cdk-accordion-child-\"+$4++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=i.listen((t,e)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===e&&this.id!==t&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(t){t=Lf(t),this._expanded!==t&&(this._expanded=t,this.expandedChange.emit(t),t?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(t){this._disabled=Lf(t)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(t=>{this.disabled||(this.expanded=t)})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(z4,12),Oa(Mc),Oa(Lg))},t.\\u0275dir=Xt({type:t,selectors:[[\"cdk-accordion-item\"],[\"\",\"cdkAccordionItem\",\"\"]],inputs:{expanded:\"expanded\",disabled:\"disabled\"},outputs:{closed:\"closed\",opened:\"opened\",destroyed:\"destroyed\",expandedChange:\"expandedChange\"},exportAs:[\"cdkAccordionItem\"],features:[Yl([{provide:z4,useValue:void 0}])]}),t})(),j4=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({}),t})();const H4=[\"body\"];function G4(t,e){}const W4=[[[\"mat-expansion-panel-header\"]],\"*\",[[\"mat-action-row\"]]],q4=[\"mat-expansion-panel-header\",\"*\",\"mat-action-row\"];function Y4(t,e){1&t&&Na(0,\"span\",2),2&t&&Ra(\"@indicatorRotate\",Ka()._getExpandedState())}const Z4=[[[\"mat-panel-title\"]],[[\"mat-panel-description\"]],\"*\"],K4=[\"mat-panel-title\",\"mat-panel-description\",\"*\"],X4=new Ji(\"MAT_ACCORDION\"),Q4=\"225ms cubic-bezier(0.4,0.0,0.2,1)\",J4={indicatorRotate:BA(\"indicatorRotate\",[UA(\"collapsed, void\",$A({transform:\"rotate(0deg)\"})),UA(\"expanded\",$A({transform:\"rotate(180deg)\"})),HA(\"expanded <=> collapsed, void => collapsed\",zA(Q4))]),bodyExpansion:BA(\"bodyExpansion\",[UA(\"collapsed, void\",$A({height:\"0px\",visibility:\"hidden\"})),UA(\"expanded\",$A({height:\"*\",visibility:\"visible\"})),HA(\"expanded <=> collapsed, void => collapsed\",zA(Q4))])};let t5=(()=>{class t{constructor(t){this._template=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Rc))},t.\\u0275dir=Xt({type:t,selectors:[[\"ng-template\",\"matExpansionPanelContent\",\"\"]]}),t})(),e5=0;const i5=new Ji(\"MAT_EXPANSION_PANEL_DEFAULT_OPTIONS\");let n5=(()=>{class t extends U4{constructor(t,e,i,n,s,r,o){super(t,e,i),this._viewContainerRef=n,this._animationMode=r,this._hideToggle=!1,this.afterExpand=new gh,this.afterCollapse=new gh,this._inputChanges=new C,this._headerId=\"mat-expansion-panel-header-\"+e5++,this._bodyAnimationDone=new C,this.accordion=t,this._document=s,this._bodyAnimationDone.pipe(Tf((t,e)=>t.fromState===e.fromState&&t.toState===e.toState)).subscribe(t=>{\"void\"!==t.fromState&&(\"expanded\"===t.toState?this.afterExpand.emit():\"collapsed\"===t.toState&&this.afterCollapse.emit())}),o&&(this.hideToggle=o.hideToggle)}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(t){this._hideToggle=Lf(t)}get togglePosition(){return this._togglePosition||this.accordion&&this.accordion.togglePosition}set togglePosition(t){this._togglePosition=t}_hasSpacing(){return!!this.accordion&&this.expanded&&\"default\"===this.accordion.displayMode}_getExpandedState(){return this.expanded?\"expanded\":\"collapsed\"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this.opened.pipe(hg(null),Af(()=>this.expanded&&!this._portal),xf(1)).subscribe(()=>{this._portal=new qp(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(t){this._inputChanges.next(t)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const t=this._document.activeElement,e=this._body.nativeElement;return t===e||e.contains(t)}return!1}}return t.\\u0275fac=function(e){return new(e||t)(Oa(X4,12),Oa(Mc),Oa(Lg),Oa(Vc),Oa(Fu),Oa(wb,8),Oa(i5,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-expansion-panel\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,t5,5),2&t){let t;Mh(t=Ph())&&(e._lazyContent=t.first)}},viewQuery:function(t,e){if(1&t&&Th(H4,5),2&t){let t;Mh(t=Ph())&&(e._body=t.first)}},hostAttrs:[1,\"mat-expansion-panel\"],hostVars:6,hostBindings:function(t,e){2&t&&hl(\"mat-expanded\",e.expanded)(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode)(\"mat-expansion-panel-spacing\",e._hasSpacing())},inputs:{disabled:\"disabled\",expanded:\"expanded\",hideToggle:\"hideToggle\",togglePosition:\"togglePosition\"},outputs:{opened:\"opened\",closed:\"closed\",expandedChange:\"expandedChange\",afterExpand:\"afterExpand\",afterCollapse:\"afterCollapse\"},exportAs:[\"matExpansionPanel\"],features:[Yl([{provide:X4,useValue:void 0}]),Uo,he],ngContentSelectors:q4,decls:7,vars:4,consts:[[\"role\",\"region\",1,\"mat-expansion-panel-content\",3,\"id\"],[\"body\",\"\"],[1,\"mat-expansion-panel-body\"],[3,\"cdkPortalOutlet\"]],template:function(t,e){1&t&&(Qa(W4),Ja(0),La(1,\"div\",0,1),Ga(\"@bodyExpansion.done\",function(t){return e._bodyAnimationDone.next(t)}),La(3,\"div\",2),Ja(4,1),oa(5,G4,0,0,\"ng-template\",3),Fa(),Ja(6,2),Fa()),2&t&&(Cr(1),Ra(\"@bodyExpansion\",e._getExpandedState())(\"id\",e.id),ia(\"aria-labelledby\",e._headerId),Cr(4),Ra(\"cdkPortalOutlet\",e._portal))},directives:[Xp],styles:[\".mat-expansion-panel{box-sizing:content-box;display:block;margin:0;border-radius:4px;overflow:hidden;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);position:relative}.mat-accordion .mat-expansion-panel:not(.mat-expanded),.mat-accordion .mat-expansion-panel:not(.mat-expansion-panel-spacing){border-radius:0}.mat-accordion .mat-expansion-panel:first-of-type{border-top-right-radius:4px;border-top-left-radius:4px}.mat-accordion .mat-expansion-panel:last-of-type{border-bottom-right-radius:4px;border-bottom-left-radius:4px}.cdk-high-contrast-active .mat-expansion-panel{outline:solid 1px}.mat-expansion-panel.ng-animate-disabled,.ng-animate-disabled .mat-expansion-panel,.mat-expansion-panel._mat-animation-noopable{transition:none}.mat-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.mat-expansion-panel-body{padding:0 24px 16px}.mat-expansion-panel-spacing{margin:16px 0}.mat-accordion>.mat-expansion-panel-spacing:first-child,.mat-accordion>*:first-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-top:0}.mat-accordion>.mat-expansion-panel-spacing:last-child,.mat-accordion>*:last-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-bottom:0}.mat-action-row{border-top-style:solid;border-top-width:1px;display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px}.mat-action-row button.mat-button-base,.mat-action-row button.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-action-row button.mat-button-base,[dir=rtl] .mat-action-row button.mat-mdc-button-base{margin-left:0;margin-right:8px}\\n\"],encapsulation:2,data:{animation:[J4.bodyExpansion]},changeDetection:0}),t})();class s5{}const r5=Vb(s5);let o5=(()=>{class t extends r5{constructor(t,e,i,n,s,r,o){super(),this.panel=t,this._element=e,this._focusMonitor=i,this._changeDetectorRef=n,this._animationMode=r,this._parentChangeSubscription=d.EMPTY;const a=t.accordion?t.accordion._stateChanges.pipe(Af(t=>!(!t.hideToggle&&!t.togglePosition))):yf;this.tabIndex=parseInt(o||\"\")||0,this._parentChangeSubscription=q(t.opened,t.closed,a,t._inputChanges.pipe(Af(t=>!!(t.hideToggle||t.disabled||t.togglePosition)))).subscribe(()=>this._changeDetectorRef.markForCheck()),t.closed.pipe(Af(()=>t._containsFocus())).subscribe(()=>i.focusVia(e,\"program\")),s&&(this.expandedHeight=s.expandedHeight,this.collapsedHeight=s.collapsedHeight)}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_getTogglePosition(){return this.panel.togglePosition}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_getHeaderHeight(){const t=this._isExpanded();return t&&this.expandedHeight?this.expandedHeight:!t&&this.collapsedHeight?this.collapsedHeight:null}_keydown(t){switch(t.keyCode){case 32:case 13:ef(t)||(t.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(t))}}focus(t,e){t?this._focusMonitor.focusVia(this._element,t,e):this._element.nativeElement.focus(e)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(t=>{t&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(n5,1),Oa(ic),Oa(Vm),Oa(Mc),Oa(i5,8),Oa(wb,8),Yi(\"tabindex\"))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-expansion-panel-header\"]],hostAttrs:[\"role\",\"button\",1,\"mat-expansion-panel-header\",\"mat-focus-indicator\"],hostVars:15,hostBindings:function(t,e){1&t&&Ga(\"click\",function(){return e._toggle()})(\"keydown\",function(t){return e._keydown(t)}),2&t&&(ia(\"id\",e.panel._headerId)(\"tabindex\",e.tabIndex)(\"aria-controls\",e._getPanelId())(\"aria-expanded\",e._isExpanded())(\"aria-disabled\",e.panel.disabled),cl(\"height\",e._getHeaderHeight()),hl(\"mat-expanded\",e._isExpanded())(\"mat-expansion-toggle-indicator-after\",\"after\"===e._getTogglePosition())(\"mat-expansion-toggle-indicator-before\",\"before\"===e._getTogglePosition())(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode))},inputs:{tabIndex:\"tabIndex\",expandedHeight:\"expandedHeight\",collapsedHeight:\"collapsedHeight\"},features:[Uo],ngContentSelectors:K4,decls:5,vars:1,consts:[[1,\"mat-content\"],[\"class\",\"mat-expansion-indicator\",4,\"ngIf\"],[1,\"mat-expansion-indicator\"]],template:function(t,e){1&t&&(Qa(Z4),La(0,\"span\",0),Ja(1),Ja(2,1),Ja(3,2),Fa(),oa(4,Y4,1,1,\"span\",1)),2&t&&(Cr(4),Ra(\"ngIf\",e._showToggle()))},directives:[Vd],styles:['.mat-expansion-panel-header{display:flex;flex-direction:row;align-items:center;padding:0 24px;border-radius:inherit;transition:height 225ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-expansion-panel-header._mat-animation-noopable{transition:none}.mat-expansion-panel-header:focus,.mat-expansion-panel-header:hover{outline:none}.mat-expansion-panel-header.mat-expanded:focus,.mat-expansion-panel-header.mat-expanded:hover{background:inherit}.mat-expansion-panel-header:not([aria-disabled=true]){cursor:pointer}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before{flex-direction:row-reverse}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 16px 0 0}[dir=rtl] .mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 0 0 16px}.mat-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.mat-expansion-panel-header-title,.mat-expansion-panel-header-description{display:flex;flex-grow:1;margin-right:16px}[dir=rtl] .mat-expansion-panel-header-title,[dir=rtl] .mat-expansion-panel-header-description{margin-right:0;margin-left:16px}.mat-expansion-panel-header-description{flex-grow:2}.mat-expansion-indicator::after{border-style:solid;border-width:0 2px 2px 0;content:\"\";display:inline-block;padding:3px;transform:rotate(45deg);vertical-align:middle}.cdk-high-contrast-active .mat-expansion-panel .mat-expansion-panel-header.cdk-keyboard-focused:not([aria-disabled=true])::before,.cdk-high-contrast-active .mat-expansion-panel .mat-expansion-panel-header.cdk-program-focused:not([aria-disabled=true])::before,.cdk-high-contrast-active .mat-expansion-panel:not(.mat-expanded) .mat-expansion-panel-header:hover:not([aria-disabled=true])::before{top:0;left:0;right:0;bottom:0;position:absolute;box-sizing:border-box;pointer-events:none;border:3px solid;border-radius:4px;content:\"\"}.cdk-high-contrast-active .mat-expansion-panel-content{border-top:1px solid;border-top-left-radius:0;border-top-right-radius:0}\\n'],encapsulation:2,data:{animation:[J4.indicatorRotate]},changeDetection:0}),t})(),a5=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"mat-panel-title\"]],hostAttrs:[1,\"mat-expansion-panel-header-title\"]}),t})(),l5=(()=>{class t extends V4{constructor(){super(...arguments),this._ownHeaders=new vh,this._hideToggle=!1,this.displayMode=\"default\",this.togglePosition=\"after\"}get hideToggle(){return this._hideToggle}set hideToggle(t){this._hideToggle=Lf(t)}ngAfterContentInit(){this._headers.changes.pipe(hg(this._headers)).subscribe(t=>{this._ownHeaders.reset(t.filter(t=>t.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new ym(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(t){this._keyManager.onKeydown(t)}_handleHeaderFocus(t){this._keyManager.updateActiveItem(t)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275dir=Xt({type:t,selectors:[[\"mat-accordion\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,o5,5),2&t){let t;Mh(t=Ph())&&(e._headers=t)}},hostAttrs:[1,\"mat-accordion\"],hostVars:2,hostBindings:function(t,e){2&t&&hl(\"mat-accordion-multi\",e.multi)},inputs:{multi:\"multi\",displayMode:\"displayMode\",togglePosition:\"togglePosition\",hideToggle:\"hideToggle\"},exportAs:[\"matAccordion\"],features:[Yl([{provide:X4,useExisting:t}]),Uo]}),t})(),c5=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[np,Fb,j4,Qp]]}),t})();const h5=BA(\"fadeAnimation\",[HA(\":enter\",[$A({opacity:0}),zA(500,$A({opacity:1}))]),HA(\":leave\",[$A({pointerEvents:\"none\",transform:\"scale(1)\"}),zA(500,$A({opacity:0,transform:\"scale(0)\",height:0}))])]),u5=BA(\"bodyExpansion\",[UA(\"collapsed, void\",$A({height:\"0px\",visibility:\"hidden\"})),UA(\"expanded\",$A({height:\"*\",visibility:\"visible\"})),HA(\"expanded <=> collapsed, void => collapsed\",zA(Q4))]);function d5(t,e){if(1&t){const t=$a();La(0,\"div\",1),La(1,\"h1\",2),xl(2,\" Gestion du groupe \"),Fa(),La(3,\"button\",3),La(4,\"mat-icon\"),xl(5,\"close\"),Fa(),Fa(),Fa(),La(6,\"div\",4),La(7,\"app-group-management\",5),Ga(\"update$\",function(){return Fe(t),Ka().onUpdate()})(\"delete$\",function(){return Fe(t),Ka().onDelete()}),Fa(),Fa()}if(2&t){const t=Ka();Cr(7),Ra(\"group\",t.group)(\"permissions\",t.group.role)}}let p5=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o){super(),this.data=t,this.dialogRef=e,this.notificationsService=i,this.mapConfigService=n,this.groupsService=s,this.uiService=r,this.workerService=o}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.groupId=this.data.groupId,this.subscriptions.push(this.notificationsService.events$.pipe(Af(t=>\"group\"===t.kind&&t.id===this.groupId)).subscribe(t=>Hp(this,void 0,void 0,function*(){var e,i;\"delete\"===t.type?(this.uiService.success(`Le groupe \\`${(null===(e=this.group)||void 0===e?void 0:e.name)||\"\"}\\` vient d'\\xeatre supprim\\xe9.`),this.onDelete()):(this.uiService.success(`Le groupe \\`${(null===(i=this.group)||void 0===i?void 0:i.name)||\"\"}\\` vient d'\\xeatre mis \\xe0 jour.`),yield this.fetchGroup())}))),yield this.fetchGroup()})}fetchGroup(){return Hp(this,void 0,void 0,function*(){this.group=yield this.workerService.groups.getGroup(this.groupId)})}onUpdate(){return Hp(this,void 0,void 0,function*(){this.mapConfigService.enableWebsockets$.value||(yield this.fetchGroup())})}onDelete(){this.dialogRef.close(),this.mapConfigService.enableWebsockets$.value||this.groupsService.removeGroup(this.groupId)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(XC),Oa(ZC),Oa(aK),Oa(qU),Oa(UY),Oa(_H),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-manage-group-dialog\"]],features:[Uo],decls:1,vars:1,consts:[[3,\"ngIf\"],[1,\"d-flex\"],[1,\"u-flex\",\"px-3\"],[\"mat-button\",\"\",\"title\",\"Fermer la fen\\xeatre\",3,\"mat-dialog-close\"],[1,\"pa-3\"],[3,\"group\",\"permissions\",\"update$\",\"delete$\"]],template:function(t,e){1&t&&oa(0,d5,8,2,\"ng-template\",0),2&t&&Ra(\"ngIf\",e.group)},directives:[Vd,Ly,sk,uE,PQ],styles:[\"\"]}),t})();const f5=\"anais-config-expansion\";let m5=(()=>{class t{constructor(){this.expansions={};try{this.expansions=JSON.parse(localStorage.getItem(f5))||{}}catch(t){}}updateExpansionState(t,e){this.expansions[t]=e,localStorage.setItem(f5,JSON.stringify(this.expansions))}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),g5=(()=>{class t{constructor(){this.RoleInfos=$Y}ngOnChanges(t){t.role&&(this.roleInfo=$Y.find(t=>t.role===this.role))}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-member-role-help-icon\"]],inputs:{role:\"role\"},features:[he],decls:2,vars:1,consts:[[1,\"help-icon\",3,\"title\"]],template:function(t,e){1&t&&(La(0,\"mat-icon\",0),xl(1,\" help\\n\"),Fa()),2&t&&Ra(\"title\",\"Vous faites partie de ce groupe avec le r\\xf4le : \"+e.roleInfo.label)},directives:[uE],styles:[\"[_nghost-%COMP%]{line-height:0}.help-icon[_ngcontent-%COMP%]{font-size:16px!important;width:16px!important;height:16px!important;cursor:help}\"],changeDetection:0}),t})();const A5=[\"createTemplate\"],v5=[\"resourceTemplate\"];function _5(t,e){if(1&t){const t=$a();La(0,\"button\",12),Ga(\"click\",function(e){Fe(t);const i=Ka().$implicit,n=Ka();return e.stopPropagation(),n.openGroupDialog(i)}),La(1,\"mat-icon\"),xl(2,\"settings\"),Fa(),Fa()}}function b5(t,e){1&t&&Va(0)}const y5=function(t){return{group:t}};function w5(t,e){if(1&t&&oa(0,b5,1,0,\"ng-container\",13),2&t){const t=Ka().$implicit;Ra(\"ngTemplateOutlet\",Ka().createTemplate)(\"ngTemplateOutletContext\",ih(2,y5,t))}}function x5(t,e){if(1&t&&(La(0,\"p\",14),xl(1),Fa()),2&t){const t=Ka(2);Cr(1),Sl(t.emptyMessage)}}function S5(t,e){1&t&&Va(0)}const C5=function(t,e){return{resource:t,group:e}};function k5(t,e){if(1&t&&(Ba(0),oa(1,S5,1,0,\"ng-container\",13),za()),2&t){const t=e.$implicit,i=Ka().$implicit,n=Ka();Cr(1),Ra(\"ngTemplateOutlet\",n.resourceTemplate)(\"ngTemplateOutletContext\",nh(2,C5,t,i))}}function E5(t,e){if(1&t){const t=$a();La(0,\"mat-expansion-panel\",3),Ga(\"expandedChange\",function(e){const i=Fe(t).$implicit;return Ka().saveGroupExpansion(i.id,e)}),La(1,\"mat-expansion-panel-header\",4),La(2,\"mat-panel-title\",5),La(3,\"span\",9),xl(4),Fa(),Na(5,\"app-member-role-help-icon\",10),Fa(),oa(6,_5,3,0,\"button\",11),Fa(),La(7,\"div\",0),oa(8,w5,1,4,\"ng-template\",6),oa(9,x5,2,1,\"p\",7),oa(10,k5,2,5,\"ng-container\",8),Fa(),Fa()}if(2&t){const t=e.$implicit,i=Ka();Ra(\"expanded\",t.expanded),Cr(4),Sl(t.name),Cr(1),Ra(\"role\",t.role),Cr(1),Ra(\"ngIf\",\"owner\"===t.role&&!i.isOffline),Cr(2),Ra(\"ngIf\",\"guest\"!==t.role&&!i.isOffline),Cr(1),Ra(\"ngIf\",0===t[i.resourcesKey].length),Cr(1),Ra(\"ngForOf\",t[i.resourcesKey])(\"ngForTrackBy\",i.trackById)}}function M5(t,e){1&t&&Va(0)}function T5(t,e){1&t&&oa(0,M5,1,0,\"ng-container\",15),2&t&&Ra(\"ngTemplateOutlet\",Ka().createTemplate)}function I5(t,e){if(1&t&&(La(0,\"p\",14),xl(1),Fa()),2&t){const t=Ka();Cr(1),Sl(t.emptyMessage)}}function P5(t,e){1&t&&Va(0)}const O5=function(t,e){return{resource:t,editable:e}};function R5(t,e){if(1&t&&(Ba(0),oa(1,P5,1,0,\"ng-container\",13),za()),2&t){const t=e.$implicit,i=Ka();Cr(1),Ra(\"ngTemplateOutlet\",i.resourceTemplate)(\"ngTemplateOutletContext\",nh(2,O5,t,!i.isOffline))}}let D5=(()=>{class t extends Gq{constructor(t,e,i,n){super(),this.dialog=t,this.expansionPersistenceService=e,this.groupsService=i,this.offlineService=n,this.groups=[],this.resources=[],this.personalResourcesPanelExpanded=!1,this.disablePanelAnimation=!0,this.loading=!0,this.isOffline=!1}ngOnInit(){var t;return Hp(this,void 0,void 0,function*(){this.ensureMandatoryInputParams(\"resources$\",\"resourcesKey\",\"privateResourcesTitle\",\"emptyMessage\"),this.personalResourcesPanelExpanded=null!==(t=this.expansionPersistenceService.expansions[`${this.resourcesKey}-null`])&&void 0!==t&&t,this.subscriptions.push(JT([this.groupsService.groups$,this.resources$]).pipe(pf(16)).subscribe(([t,e])=>{var i;const n=this.expansionPersistenceService.expansions,s=t.reduce((t,e)=>{var i;return t[e.id]=e,e[this.resourcesKey]=[],e.expanded=null!==(i=n[`${this.resourcesKey}-${e.id}`])&&void 0!==i&&i,t},{});this.personalResourcesPanelExpanded=null!==(i=n[`${this.resourcesKey}-null`])&&void 0!==i&&i;const r=[];e.forEach(t=>{if(t.group_id){const e=s[t.group_id];if(!e)return void console.log(`Le groupe ${t.group_id} de la ressource ${t.name} est inconnu`);e[this.resourcesKey]||(e[this.resourcesKey]=[]),e[this.resourcesKey].push(t)}else r.push(t)}),this.resources=r,this.groups=t,setTimeout(()=>{this.loading=!1})}),this.offlineService.isOffline$.subscribe(t=>{this.isOffline=t}))})}ngAfterViewInit(){this.ensureMandatoryInputParams(\"createTemplate\",\"resourceTemplate\"),setTimeout(()=>{this.disablePanelAnimation=!1})}trackById(t,e){return e.id}openGroupDialog(t){this.dialog.open(p5,{data:{groupId:t.id},panelClass:\"no-border-dialog\",maxHeight:\"90vh\",minWidth:\"40vw\",maxWidth:\"90vw\",autoFocus:!1,closeOnNavigation:!0})}saveGroupExpansion(t,e){this.loading||this.expansionPersistenceService.updateExpansionState(`${this.resourcesKey}-${t}`,e)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ik),Oa(m5),Oa(UY),Oa(MY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-resources-panel\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,A5,5),Ih(i,v5,5)),2&t){let t;Mh(t=Ph())&&(e.createTemplate=t.first),Mh(t=Ph())&&(e.resourceTemplate=t.first)}},inputs:{resources$:\"resources$\",resourcesKey:\"resourcesKey\",privateResourcesTitle:\"privateResourcesTitle\",emptyMessage:\"emptyMessage\"},features:[Uo],decls:11,vars:12,consts:[[1,\"d-flex-column\"],[\"displayMode\",\"flat\",3,\"multi\"],[\"class\",\"resources-panel mat-elevation-z0\",\"togglePosition\",\"before\",3,\"expanded\",\"expandedChange\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[\"togglePosition\",\"before\",1,\"resources-panel\",\"mat-elevation-z0\",3,\"expanded\",\"expandedChange\"],[1,\"resources-panel__header\"],[1,\"d-flex-center\"],[3,\"ngIf\"],[\"class\",\"px-3\",4,\"ngIf\"],[4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[1,\"mr-2\"],[3,\"role\"],[\"mat-button\",\"\",\"title\",\"Afficher les param\\xe8tres de ce groupe\",3,\"click\",4,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Afficher les param\\xe8tres de ce groupe\",3,\"click\"],[4,\"ngTemplateOutlet\",\"ngTemplateOutletContext\"],[1,\"px-3\"],[4,\"ngTemplateOutlet\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"mat-accordion\",1),oa(2,E5,11,8,\"mat-expansion-panel\",2),La(3,\"mat-expansion-panel\",3),Ga(\"expandedChange\",function(t){return e.saveGroupExpansion(null,t)}),La(4,\"mat-expansion-panel-header\",4),La(5,\"mat-panel-title\",5),xl(6),Fa(),Fa(),La(7,\"div\",0),oa(8,T5,1,1,\"ng-template\",6),oa(9,I5,2,1,\"p\",7),oa(10,R5,2,5,\"ng-container\",8),Fa(),Fa(),Fa(),Fa()),2&t&&(hl(\"d-hidden\",e.loading),Cr(1),Ra(\"multi\",!0),Cr(1),Ra(\"ngForOf\",e.groups)(\"ngForTrackBy\",e.trackById),Cr(1),Ra(\"@.disabled\",e.disablePanelAnimation)(\"expanded\",e.personalResourcesPanelExpanded),Cr(3),Cl(\" \",e.privateResourcesTitle,\" \"),Cr(2),Ra(\"ngIf\",!e.isOffline),Cr(1),Ra(\"ngIf\",0===e.resources.length),Cr(1),Ra(\"ngForOf\",e.resources)(\"ngForTrackBy\",e.trackById))},directives:[l5,Bd,n5,o5,a5,Vd,g5,Ly,uE,Yd],styles:[\".resources-panel__header[_ngcontent-%COMP%]{background-color:#e6ebf1}.resources-panel__header[_ngcontent-%COMP%]:focus, .resources-panel__header[_ngcontent-%COMP%]:hover{background-color:#d6dee8!important}.resources-panel[_ngcontent-%COMP%]     .mat-expanded{height:48px!important}.resources-panel[_ngcontent-%COMP%]     .mat-expansion-panel-body{padding:0}.resources-panel[_ngcontent-%COMP%]     .mat-expansion-panel-header{padding-right:0}.resources-panel[_ngcontent-%COMP%]     .mat-content{height:100%}\"],data:{animation:[h5]}}),t})();function L5(t,e){1&t&&(La(0,\"mat-chip\",13),xl(1,\"D\\xe9sactiv\\xe9e\"),Fa()),2&t&&Ra(\"disabled\",!0)}function F5(t,e){1&t&&(La(0,\"mat-chip\",14),xl(1,\" Incorrecte \"),Fa())}function N5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),kl(\"\",t.criteriaLabels.identifier.title,\" : \",t.alertRule.criteria.identifier.identifiers.join(\", \"),\"\")}}function B5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),kl(\"\",t.criteriaLabels.fleet.title,\" : \",t.fleets,\"\")}}function z5(t,e){1&t&&Na(0,\"app-flag\",18),2&t&&Ra(\"flag\",e.$implicit)}function V5(t,e){1&t&&oa(0,z5,1,1,\"app-flag\",17),2&t&&Ra(\"ngForOf\",Ka(2).alertRule.criteria.flag.flags)}function $5(t,e){1&t&&xl(0),2&t&&Cl(\" \",Ka(2).alertRule.criteria.flag.flags.length,\" pavillons \")}function U5(t,e){if(1&t&&(La(0,\"li\"),xl(1),oa(2,V5,1,1,\"ng-template\",15),oa(3,$5,1,1,\"ng-template\",null,16,Lh),Fa()),2&t){const t=aa(4),e=Ka();Cr(1),Cl(\" \",e.criteriaLabels.flag.title,\" : \"),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.flag.flags.length<5)(\"ngIfElse\",t)}}function j5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),kl(\"\",t.criteriaLabels.type.title,\" : \",t.types,\"\")}}function H5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),El(\"\",t.criteriaLabels.speed.title,\" : [\",t.alertRule.criteria.speed.min,\", \",t.alertRule.criteria.speed.max,\"]\")}}function G5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),Sl(t.criteriaLabels.erraticRoute.title)}}function W5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),Sl(t.criteriaLabels.transhipment.title)}}function q5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),Sl(t.criteriaLabels.aisInterruption.title)}}function Y5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),kl(\"\",t.criteriaLabels.passageInZone.title,\" : \",t.passages,\"\")}}function Z5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),Sl(t.criteriaLabels.spoofing.title)}}function K5(t,e){if(1&t&&(La(0,\"li\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),kl(\"\",t.criteriaLabels.zone.title,\" : \",t.zones,\"\")}}let X5=(()=>{class t extends Gq{constructor(t){super(),this.fleetsService=t,this.criteriaLabels=x1,this.countriesLabelByFlag=kH}get passages(){return this.alertRule.criteria.passageInZone.passages.map(t=>t.zone.name).join(\", \")}get fleets(){return this.alertRule.criteria.fleet.fleets.map(t=>{var e;return(null!==(e=this.fleetsService.fleetsById[t])&&void 0!==e?e:{}).name}).join(\", \")}get zones(){return this.alertRule.criteria.zone.zones.map(t=>t.name).join(\", \")}get types(){return this.alertRule.criteria.type.types.map(t=>aU[t].name).join(\", \")}}return t.\\u0275fac=function(e){return new(e||t)(Oa(zY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alert-rule-item\"]],inputs:{alertRule:\"alertRule\"},features:[Uo],decls:28,vars:16,consts:[[1,\"alert-rule-item\"],[1,\"alert-rule-item__header\"],[1,\"alert-rule-item__title\"],[1,\"d-inline\",\"u-flex\",\"alert-rule-item__state\"],[\"color\",\"primary\",\"selected\",\"\",\"disableRipple\",\"\",3,\"disabled\",4,\"ngIf\"],[\"color\",\"warn\",\"selected\",\"\",\"disableRipple\",\"\",\"title\",\"La configuration de cette r\\xe8gle est incorrecte. Elle doit contenir au moins une zone de filtrage.\",4,\"ngIf\"],[1,\"alert-rule-item__indicators\"],[\"title\",\"Statistiques\",1,\"mr-1\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des derni\\xe8res 24 heures\"],[1,\"mx-1\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des 7 derniers jours\"],[1,\"alert-rule-item__criteria\"],[4,\"ngIf\"],[\"color\",\"primary\",\"selected\",\"\",\"disableRipple\",\"\",3,\"disabled\"],[\"color\",\"warn\",\"selected\",\"\",\"disableRipple\",\"\",\"title\",\"La configuration de cette r\\xe8gle est incorrecte. Elle doit contenir au moins une zone de filtrage.\"],[3,\"ngIf\",\"ngIfElse\"],[\"tooManyFlags\",\"\"],[\"style\",\"margin: 4px\",3,\"flag\",4,\"ngFor\",\"ngForOf\"],[2,\"margin\",\"4px\",3,\"flag\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"h4\",1),La(2,\"div\",2),xl(3),Fa(),La(4,\"mat-chip-list\",3),oa(5,L5,2,1,\"mat-chip\",4),oa(6,F5,2,0,\"mat-chip\",5),Fa(),La(7,\"div\",6),La(8,\"mat-icon\",7),xl(9,\"trending_up\"),Fa(),La(10,\"span\",8),xl(11),Fa(),La(12,\"span\",9),xl(13,\"/\"),Fa(),La(14,\"span\",10),xl(15),Fa(),Fa(),Fa(),La(16,\"ul\",11),oa(17,N5,2,2,\"li\",12),oa(18,B5,2,2,\"li\",12),oa(19,U5,5,3,\"li\",12),oa(20,j5,2,2,\"li\",12),oa(21,H5,2,3,\"li\",12),oa(22,G5,2,1,\"li\",12),oa(23,W5,2,1,\"li\",12),oa(24,q5,2,1,\"li\",12),oa(25,Y5,2,2,\"li\",12),oa(26,Z5,2,1,\"li\",12),oa(27,K5,2,2,\"li\",12),Fa(),Fa()),2&t&&(Cr(3),Sl(e.alertRule.name),Cr(2),Ra(\"ngIf\",!e.alertRule.active),Cr(1),Ra(\"ngIf\",!e.alertRule.validZone),Cr(5),Sl(e.alertRule.alertsSummary.lastDay),Cr(4),Sl(e.alertRule.alertsSummary.lastWeek),Cr(2),Ra(\"ngIf\",e.alertRule.criteria.identifier.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.fleet.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.flag.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.type.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.speed.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.erraticRoute.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.transhipment.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.aisInterruption.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.passageInZone.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.spoofing.enable),Cr(1),Ra(\"ngIf\",e.alertRule.criteria.zone.enable))},directives:[u0,Vd,uE,r0,Bd,MJ],styles:[\".alert-rule-item__header[_ngcontent-%COMP%]{color:#1515a6;text-align:left;margin-top:8px;display:flex;align-items:center}.alert-rule-item__title[_ngcontent-%COMP%]{word-break:break-word;margin-right:8px}.alert-rule-item__state[_ngcontent-%COMP%]{pointer-events:none;touch-action:none}.alert-rule-item__indicators[_ngcontent-%COMP%]{font-size:14px;margin-left:8px;display:flex;align-items:center;pointer-events:all!important}.alert-rule-item__criteria[_ngcontent-%COMP%]{text-align:left;margin:0;line-height:18px;padding-left:1em}\"],changeDetection:0}),t})();function Q5(t,e){1&t&&(La(0,\"div\",5),La(1,\"mat-icon\",6),xl(2,\"warning\"),Fa(),xl(3,\" La configuration de certaines r\\xe8gles est incorrecte. Veuillez revoir leur configuration afin de les rendre \\xe0 nouveau effectives. \"),Fa())}const J5=function(t){return{groupId:t}};function t6(t,e){if(1&t&&(La(0,\"button\",7),La(1,\"mat-icon\"),xl(2,\"add\"),Fa(),xl(3,\" Nouvelle r\\xe8gle \"),Fa()),2&t){const t=e.group;Ra(\"queryParams\",ih(1,J5,t?t.id:null))}}function e6(t,e){if(1&t&&(La(0,\"button\",8),Na(1,\"app-alert-rule-item\",9),Fa()),2&t){const t=e.resource;Ra(\"routerLink\",\"/alerts/rules/\"+t.id)(\"@fadeAnimation\",void 0),Cr(1),Ra(\"alertRule\",t)}}let i6=(()=>{class t extends Gq{constructor(t,e,i){super(),this.titleService=t,this.alertRulesService=e,this.mapService=i}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des r\\xe8gles - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.alertRulesService.alertRules$.subscribe(t=>{this.containsInvalidAlertRule=t.some(t=>!t.validZone)})})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(DH),Oa(Pj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alert-rules-panel\"]],features:[Uo],decls:7,vars:2,consts:[[\"joyrideStep\",\"rules-panel\",\"stepPosition\",\"right\",\"title\",\"R\\xe8gles d'alertes\",\"text\",\"C'est ici que vous pouvez cr\\xe9er et visualiser des r\\xe8gles personnalis\\xe9es afin d'\\xeatre alert\\xe9 automatiquement de comportements de navires r\\xe9pondant \\xe0 des algorithmes et des filtres que vous aurez choisis. Par exemple: navires avec pavillon espagnol, de type p\\xeacheur, \\xe9tant pass\\xe9s \\xe0 proximit\\xe9 des c\\xf4tes Corse et ayant transbord\\xe9.\",1,\"panel\"],[\"class\",\"d-flex-center error-message panel__content mat-body\",4,\"ngIf\"],[\"resourcesKey\",\"rules\",\"privateResourcesTitle\",\"R\\xe8gles priv\\xe9es\",\"emptyMessage\",\"Aucune r\\xe8gle\",1,\"scrollable\",3,\"resources$\"],[\"createTemplate\",\"\"],[\"resourceTemplate\",\"\"],[1,\"d-flex-center\",\"error-message\",\"panel__content\",\"mat-body\"],[1,\"mr-2\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",\"routerLink\",\"/alerts/rules/new\",1,\"ma-2\",3,\"queryParams\"],[\"mat-button\",\"\",3,\"routerLink\"],[3,\"alertRule\"]],template:function(t,e){1&t&&(La(0,\"div\",0),oa(1,Q5,4,0,\"div\",1),La(2,\"app-resources-panel\",2),oa(3,t6,4,3,\"ng-template\",null,3,Lh),oa(5,e6,2,3,\"ng-template\",null,4,Lh),Fa(),Fa()),2&t&&(Cr(1),Ra(\"ngIf\",e.containsInvalidAlertRule),Cr(1),Ra(\"resources$\",e.alertRulesService.alertRules$))},directives:[AF,Vd,D5,uE,Ly,mL,X5],styles:[\"[_nghost-%COMP%]{display:flex;overflow:hidden}.alert-rules-panel__rules[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:stretch}.alert-rules-panel__rules[_ngcontent-%COMP%]     .mat-button{white-space:normal}\"],data:{animation:[h5]}}),t})();function n6(t,e){1&t&&Na(0,\"mat-spinner\",8)}function s6(t,e){if(1&t&&(La(0,\"div\",4),La(1,\"div\",9),La(2,\"div\",10),La(3,\"mat-icon\",11),xl(4,\"trending_up\"),Fa(),xl(5,\" Dernier jour \"),Fa(),xl(6),Fa(),La(7,\"div\",12),La(8,\"div\",10),La(9,\"mat-icon\",11),xl(10,\"trending_up\"),Fa(),xl(11,\" Derni\\xe8re semaine \"),Fa(),xl(12),Fa(),Fa()),2&t){const t=Ka();Cr(6),Cl(\" \",t.alertsSummary.lastDay,\" \"),Cr(6),Cl(\" \",t.alertsSummary.lastWeek,\" \")}}function r6(t,e){1&t&&Na(0,\"mat-spinner\",8)}function o6(t,e){if(1&t&&(La(0,\"div\",16),La(1,\"mat-icon\",11),xl(2,\"warning\"),Fa(),xl(3),Fa(),Na(4,\"app-ship-item-small\",17),La(5,\"div\",18),ch(6,\"timeago\"),La(7,\"mat-icon\",19),xl(8,\"access_time\"),Fa(),xl(9),ch(10,\"date\"),Fa()),2&t){const t=e.alert,i=Ka(2);Cr(3),Cl(\" \",t.rule_name,\" \"),Cr(1),Ra(\"ship\",t.ship),Cr(1),tl(\"title\",hh(6,4,1e3*t.start)),Cr(4),Cl(\" \",dh(10,6,1e3*t.start,\"yyyy-MM-dd HH:mm:ss z\",i.useUTCDates&&\"+00\"),\" \")}}const a6=function(t){return[\"/alerts/rules/\",t]},l6=function(t){return[\"/ships/\",t]};function c6(t,e){if(1&t){const t=$a();La(0,\"button\",20),La(1,\"mat-icon\"),xl(2,\"info\"),Fa(),xl(3,\" Voir la r\\xe8gle \"),Fa(),La(4,\"button\",20),La(5,\"mat-icon\"),xl(6,\"info\"),Fa(),xl(7,\" Voir d\\xe9tail Navire \"),Fa(),La(8,\"button\",21),Ga(\"click\",function(){const e=Fe(t).alert;return Ka(2).locateShip(e.mmsi)}),La(9,\"mat-icon\"),xl(10,\"center_focus_strong\"),Fa(),xl(11,\" Voir position actuelle Navire \"),Fa()}if(2&t){const t=e.alert;Ra(\"routerLink\",ih(2,a6,t.rule_id)),Cr(4),Ra(\"routerLink\",ih(4,l6,t.mmsi))}}function h6(t,e){if(1&t&&(Na(0,\"app-alerts-list\",13),oa(1,o6,11,10,\"ng-template\",null,14,Lh),oa(3,c6,12,6,\"ng-template\",null,15,Lh)),2&t){const t=aa(2),e=aa(4);Ra(\"alerts$\",Ka().alerts$)(\"enableRuleFilters\",!0)(\"simpleItems\",!1)(\"alertTitleRef\",t)(\"alertMenuItemsRef\",e)}}let u6=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o){super(),this.titleService=t,this.alertRulesService=e,this.alertsService=i,this.mapService=n,this.mapConfigService=s,this.timeRangeService=r,this.workerService=o,this.alerts$=new Jp([]),this.alertsSummary=null,this.alertsLoaded=!1,this.useUTCDates=!1}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Alertes - ANAIS\"),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t}),this.timeRangeService.timeRange$.subscribe(t=>Hp(this,void 0,void 0,function*(){const e=yield this.workerService.alerts.list(t.start,t.end);e.forEach(t=>{const[e,i]=this.alertRulesService.getAlertRuleColor(t.rule_id);t.color=e,t.rgbVecColor=i}),this.alertsService.updateAlerts(e),this.alerts$.next(e),this.alertsLoaded=!0})),q(tf(0),Wq(3e5)).subscribe(()=>Hp(this,void 0,void 0,function*(){this.alertsSummary=yield this.workerService.alerts.getAlertsSummary()})))})}ngOnDestroy(){super.ngOnDestroy(),this.alertsService.updateAlerts([])}locateShip(t){return Hp(this,void 0,void 0,function*(){const e=yield this.workerService.ships.getShip(t);this.mapService.pingLocation([e.lon,e.lat]),this.mapService.centerOnLonLat([e.lon,e.lat])})}exportAlertsAsCSV(){const t=this.timeRangeService.timeRange$.value,e=yq(t.start),i=yq(t.end);this.alerts$.value.forEach(t=>{t.ship_name=t.ship.name}),bY(VJ(this.alerts$.value),`anais-alerts-${e}-${i}.csv`,\"text/csv\")}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(DH),Oa(LH),Oa(Pj),Oa(qU),Oa(Kq),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alerts-dashboard\"]],features:[Uo],decls:13,vars:5,consts:[[\"joyrideStep\",\"alerts-panel\",\"stepPosition\",\"right\",\"title\",\"Tableau de bord des alertes\",\"text\",\"Cet endroit contient un tableau de bord de toutes les alertes lev\\xe9es par toutes vos r\\xe8gles.\",1,\"panel\"],[1,\"panel__title\"],[\"class\",\"small-spinner\",\"strokeWidth\",\"4\",\"diameter\",\"60\",4,\"ngIf\"],[\"class\",\"d-flex\",4,\"ngIf\"],[1,\"d-flex\"],[1,\"u-flex\",\"my-0\",\"pa-2\"],[\"mat-button\",\"\",\"title\",\"Exporter les alertes au format CSV\",3,\"disabled\",\"click\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"60\",1,\"small-spinner\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des derni\\xe8res 24 heures\",1,\"indicator\",\"mat-elevation-z8\"],[1,\"indicator__label\"],[1,\"mr-1\"],[\"title\",\"Nombre d'alertes lev\\xe9es au cours des 7 derniers jours\",1,\"indicator\",\"mat-elevation-z8\"],[3,\"alerts$\",\"enableRuleFilters\",\"simpleItems\",\"alertTitleRef\",\"alertMenuItemsRef\"],[\"alertTitleRef\",\"\"],[\"alertMenuItemsRef\",\"\"],[1,\"d-flex-center\"],[1,\"alert__ship\",3,\"ship\"],[1,\"alert__timestamp\",3,\"title\"],[\"title\",\"Date de l'alerte\",1,\"mini-icon\",\"mr-1\"],[\"mat-menu-item\",\"\",3,\"routerLink\"],[\"mat-menu-item\",\"\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"h2\",1),xl(2,\"Indicateurs\"),Fa(),oa(3,n6,1,0,\"mat-spinner\",2),oa(4,s6,13,2,\"div\",3),La(5,\"div\",4),La(6,\"h2\",5),xl(7,\"Alertes\"),Fa(),La(8,\"button\",6),Ga(\"click\",function(){return e.exportAlertsAsCSV()}),La(9,\"mat-icon\"),xl(10,\"file_download\"),Fa(),Fa(),Fa(),oa(11,r6,1,0,\"mat-spinner\",2),oa(12,h6,5,5,\"ng-template\",7),Fa()),2&t&&(Cr(3),Ra(\"ngIf\",!e.alertsSummary),Cr(1),Ra(\"ngIf\",e.alertsSummary),Cr(4),Ra(\"disabled\",0===e.alerts$.value.length),Cr(3),Ra(\"ngIf\",!e.alertsLoaded),Cr(1),Ra(\"ngIf\",e.alertsLoaded))},directives:[AF,Vd,Ly,uE,KJ,a4,c4,S0,mL],pipes:[$F,ip],styles:[\"[_nghost-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.indicator[_ngcontent-%COMP%]{flex:1;padding:.7em 8px 8px;position:relative;margin:8px;font-size:1.5em;display:flex;justify-content:center;align-items:center;min-height:3em;border-radius:4px}.indicator__label[_ngcontent-%COMP%]{position:absolute;top:0;left:4px;color:#8c8c8c;font-size:12px;display:flex;align-items:center}.alert__ship[_ngcontent-%COMP%]{border-left:1px solid grey;padding-left:3px;display:block}.alert__timestamp[_ngcontent-%COMP%]{color:gray;display:flex;align-items:center}\"]}),t})();function d6(t,e){1&t&&Ja(0)}const p6=[\"*\"];function f6(t,e){}const m6=function(t){return{animationDuration:t}},g6=function(t,e){return{value:t,params:e}},A6=[\"tabBodyWrapper\"],v6=[\"tabHeader\"];function _6(t,e){}function b6(t,e){1&t&&oa(0,_6,0,0,\"ng-template\",9),2&t&&Ra(\"cdkPortalOutlet\",Ka().$implicit.templateLabel)}function y6(t,e){1&t&&xl(0),2&t&&Sl(Ka().$implicit.textLabel)}function w6(t,e){if(1&t){const t=$a();La(0,\"div\",6),Ga(\"click\",function(){const e=Fe(t),i=e.$implicit,n=e.index,s=Ka(),r=aa(1);return s._handleClick(i,r,n)})(\"cdkFocusChange\",function(e){const i=Fe(t).index;return Ka()._tabFocusChanged(e,i)}),La(1,\"div\",7),oa(2,b6,1,1,\"ng-template\",8),oa(3,y6,1,1,\"ng-template\",8),Fa(),Fa()}if(2&t){const t=e.$implicit,i=e.index,n=Ka();hl(\"mat-tab-label-active\",n.selectedIndex==i),Ra(\"id\",n._getTabLabelId(i))(\"disabled\",t.disabled)(\"matRippleDisabled\",t.disabled||n.disableRipple),ia(\"tabIndex\",n._getTabIndex(t,i))(\"aria-posinset\",i+1)(\"aria-setsize\",n._tabs.length)(\"aria-controls\",n._getTabContentId(i))(\"aria-selected\",n.selectedIndex==i)(\"aria-label\",t.ariaLabel||null)(\"aria-labelledby\",!t.ariaLabel&&t.ariaLabelledby?t.ariaLabelledby:null),Cr(2),Ra(\"ngIf\",t.templateLabel),Cr(1),Ra(\"ngIf\",!t.templateLabel)}}function x6(t,e){if(1&t){const t=$a();La(0,\"mat-tab-body\",10),Ga(\"_onCentered\",function(){return Fe(t),Ka()._removeTabBodyWrapperHeight()})(\"_onCentering\",function(e){return Fe(t),Ka()._setTabBodyWrapperHeight(e)}),Fa()}if(2&t){const t=e.$implicit,i=e.index,n=Ka();hl(\"mat-tab-body-active\",n.selectedIndex===i),Ra(\"id\",n._getTabContentId(i))(\"content\",t.content)(\"position\",t.position)(\"origin\",t.origin)(\"animationDuration\",n.animationDuration),ia(\"tabindex\",null!=n.contentTabIndex&&n.selectedIndex===i?n.contentTabIndex:null)(\"aria-labelledby\",n._getTabLabelId(i))}}const S6=[\"tabListContainer\"],C6=[\"tabList\"],k6=[\"nextPaginator\"],E6=[\"previousPaginator\"],M6=[\"mat-tab-nav-bar\",\"\"],T6=new Ji(\"MatInkBarPositioner\",{providedIn:\"root\",factory:function(){return t=>({left:t?(t.offsetLeft||0)+\"px\":\"0\",width:t?(t.offsetWidth||0)+\"px\":\"0\"})}});let I6=(()=>{class t{constructor(t,e,i,n){this._elementRef=t,this._ngZone=e,this._inkBarPositioner=i,this._animationMode=n}alignToElement(t){this.show(),\"undefined\"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this._setStyles(t))}):this._setStyles(t)}show(){this._elementRef.nativeElement.style.visibility=\"visible\"}hide(){this._elementRef.nativeElement.style.visibility=\"hidden\"}_setStyles(t){const e=this._inkBarPositioner(t),i=this._elementRef.nativeElement;i.style.left=e.left,i.style.width=e.width}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(nu),Oa(T6),Oa(wb,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"mat-ink-bar\"]],hostAttrs:[1,\"mat-ink-bar\"],hostVars:2,hostBindings:function(t,e){2&t&&hl(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode)}}),t})();const P6=new Ji(\"MatTabContent\"),O6=new Ji(\"MatTabLabel\"),R6=new Ji(\"MAT_TAB\"),D6=Nb(class{}),L6=new Ji(\"MAT_TAB_GROUP\");let F6=(()=>{class t extends D6{constructor(t,e){super(),this._viewContainerRef=t,this._closestTabGroup=e,this.textLabel=\"\",this._contentPortal=null,this._stateChanges=new C,this.position=null,this.origin=null,this.isActive=!1}get templateLabel(){return this._templateLabel}set templateLabel(t){this._setTemplateLabelInput(t)}get content(){return this._contentPortal}ngOnChanges(t){(t.hasOwnProperty(\"textLabel\")||t.hasOwnProperty(\"disabled\"))&&this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}ngOnInit(){this._contentPortal=new qp(this._explicitContent||this._implicitContent,this._viewContainerRef)}_setTemplateLabelInput(t){t&&t._closestTab===this&&(this._templateLabel=t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Vc),Oa(L6,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-tab\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,O6,5),Ih(i,P6,7,Rc)),2&t){let t;Mh(t=Ph())&&(e.templateLabel=t.first),Mh(t=Ph())&&(e._explicitContent=t.first)}},viewQuery:function(t,e){if(1&t&&Th(Rc,7),2&t){let t;Mh(t=Ph())&&(e._implicitContent=t.first)}},inputs:{disabled:\"disabled\",textLabel:[\"label\",\"textLabel\"],ariaLabel:[\"aria-label\",\"ariaLabel\"],ariaLabelledby:[\"aria-labelledby\",\"ariaLabelledby\"]},exportAs:[\"matTab\"],features:[Yl([{provide:R6,useExisting:t}]),Uo,he],ngContentSelectors:p6,decls:1,vars:0,template:function(t,e){1&t&&(Qa(),oa(0,d6,1,0,\"ng-template\"))},encapsulation:2}),t})();const N6={translateTab:BA(\"translateTab\",[UA(\"center, void, left-origin-center, right-origin-center\",$A({transform:\"none\"})),UA(\"left\",$A({transform:\"translate3d(-100%, 0, 0)\",minHeight:\"1px\"})),UA(\"right\",$A({transform:\"translate3d(100%, 0, 0)\",minHeight:\"1px\"})),HA(\"* => left, * => right, left => center, right => center\",zA(\"{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)\")),HA(\"void => left-origin-center\",[$A({transform:\"translate3d(-100%, 0, 0)\"}),zA(\"{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)\")]),HA(\"void => right-origin-center\",[$A({transform:\"translate3d(100%, 0, 0)\"}),zA(\"{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)\")])])};let B6=(()=>{class t extends Xp{constructor(t,e,i,n){super(t,e,n),this._host=i,this._centeringSub=d.EMPTY,this._leavingSub=d.EMPTY}ngOnInit(){super.ngOnInit(),this._centeringSub=this._host._beforeCentering.pipe(hg(this._host._isCenterPosition(this._host._position))).subscribe(t=>{t&&!this.hasAttached()&&this.attach(this._host._content)}),this._leavingSub=this._host._afterLeavingCenter.subscribe(()=>{this.detach()})}ngOnDestroy(){super.ngOnDestroy(),this._centeringSub.unsubscribe(),this._leavingSub.unsubscribe()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Ql),Oa(Vc),Oa(at(()=>V6)),Oa(Fu))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matTabBodyHost\",\"\"]],features:[Uo]}),t})(),z6=(()=>{class t{constructor(t,e,i){this._elementRef=t,this._dir=e,this._dirChangeSubscription=d.EMPTY,this._translateTabComplete=new C,this._onCentering=new gh,this._beforeCentering=new gh,this._afterLeavingCenter=new gh,this._onCentered=new gh(!0),this.animationDuration=\"500ms\",e&&(this._dirChangeSubscription=e.change.subscribe(t=>{this._computePositionAnimationState(t),i.markForCheck()})),this._translateTabComplete.pipe(Tf((t,e)=>t.fromState===e.fromState&&t.toState===e.toState)).subscribe(t=>{this._isCenterPosition(t.toState)&&this._isCenterPosition(this._position)&&this._onCentered.emit(),this._isCenterPosition(t.fromState)&&!this._isCenterPosition(this._position)&&this._afterLeavingCenter.emit()})}set position(t){this._positionIndex=t,this._computePositionAnimationState()}ngOnInit(){\"center\"==this._position&&null!=this.origin&&(this._position=this._computePositionFromOrigin(this.origin))}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._translateTabComplete.complete()}_onTranslateTabStarted(t){const e=this._isCenterPosition(t.toState);this._beforeCentering.emit(e),e&&this._onCentering.emit(this._elementRef.nativeElement.clientHeight)}_getLayoutDirection(){return this._dir&&\"rtl\"===this._dir.value?\"rtl\":\"ltr\"}_isCenterPosition(t){return\"center\"==t||\"left-origin-center\"==t||\"right-origin-center\"==t}_computePositionAnimationState(t=this._getLayoutDirection()){this._position=this._positionIndex<0?\"ltr\"==t?\"left\":\"right\":this._positionIndex>0?\"ltr\"==t?\"right\":\"left\":\"center\"}_computePositionFromOrigin(t){const e=this._getLayoutDirection();return\"ltr\"==e&&t<=0||\"rtl\"==e&&t>0?\"left-origin-center\":\"right-origin-center\"}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Eg,8),Oa(Mc))},t.\\u0275dir=Xt({type:t,inputs:{animationDuration:\"animationDuration\",position:\"position\",_content:[\"content\",\"_content\"],origin:\"origin\"},outputs:{_onCentering:\"_onCentering\",_beforeCentering:\"_beforeCentering\",_afterLeavingCenter:\"_afterLeavingCenter\",_onCentered:\"_onCentered\"}}),t})(),V6=(()=>{class t extends z6{constructor(t,e,i){super(t,e,i)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Eg,8),Oa(Mc))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-tab-body\"]],viewQuery:function(t,e){if(1&t&&Th(Xp,5),2&t){let t;Mh(t=Ph())&&(e._portalHost=t.first)}},hostAttrs:[1,\"mat-tab-body\"],features:[Uo],decls:3,vars:6,consts:[[\"cdkScrollable\",\"\",1,\"mat-tab-body-content\"],[\"content\",\"\"],[\"matTabBodyHost\",\"\"]],template:function(t,e){1&t&&(La(0,\"div\",0,1),Ga(\"@translateTab.start\",function(t){return e._onTranslateTabStarted(t)})(\"@translateTab.done\",function(t){return e._translateTabComplete.next(t)}),oa(2,f6,0,0,\"ng-template\",2),Fa()),2&t&&Ra(\"@translateTab\",nh(3,g6,e._position,ih(1,m6,e.animationDuration)))},directives:[B6],styles:[\".mat-tab-body-content{height:100%;overflow:auto}.mat-tab-group-dynamic-height .mat-tab-body-content{overflow:hidden}\\n\"],encapsulation:2,data:{animation:[N6.translateTab]}}),t})();const $6=new Ji(\"MAT_TABS_CONFIG\");let U6=0;class j6{}const H6=Bb(zb(class{constructor(t){this._elementRef=t}}),\"primary\");let G6=(()=>{class t extends H6{constructor(t,e,i,n){var s;super(t),this._changeDetectorRef=e,this._animationMode=n,this._tabs=new vh,this._indexToSelect=0,this._tabBodyWrapperHeight=0,this._tabsSubscription=d.EMPTY,this._tabLabelSubscription=d.EMPTY,this._selectedIndex=null,this.headerPosition=\"above\",this.selectedIndexChange=new gh,this.focusChange=new gh,this.animationDone=new gh,this.selectedTabChange=new gh(!0),this._groupId=U6++,this.animationDuration=i&&i.animationDuration?i.animationDuration:\"500ms\",this.disablePagination=!(!i||null==i.disablePagination)&&i.disablePagination,this.dynamicHeight=!(!i||null==i.dynamicHeight)&&i.dynamicHeight,this.contentTabIndex=null!==(s=null==i?void 0:i.contentTabIndex)&&void 0!==s?s:null}get dynamicHeight(){return this._dynamicHeight}set dynamicHeight(t){this._dynamicHeight=Lf(t)}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){this._indexToSelect=Ff(t,null)}get animationDuration(){return this._animationDuration}set animationDuration(t){this._animationDuration=/^\\d+$/.test(t)?t+\"ms\":t}get contentTabIndex(){return this._contentTabIndex}set contentTabIndex(t){this._contentTabIndex=Ff(t,null)}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){const e=this._elementRef.nativeElement;e.classList.remove(`mat-background-${this.backgroundColor}`),t&&e.classList.add(`mat-background-${t}`),this._backgroundColor=t}ngAfterContentChecked(){const t=this._indexToSelect=this._clampTabIndex(this._indexToSelect);if(this._selectedIndex!=t){const e=null==this._selectedIndex;if(!e){this.selectedTabChange.emit(this._createChangeEvent(t));const e=this._tabBodyWrapper.nativeElement;e.style.minHeight=e.clientHeight+\"px\"}Promise.resolve().then(()=>{this._tabs.forEach((e,i)=>e.isActive=i===t),e||(this.selectedIndexChange.emit(t),this._tabBodyWrapper.nativeElement.style.minHeight=\"\")})}this._tabs.forEach((e,i)=>{e.position=i-t,null!=this._selectedIndex&&0==e.position&&!e.origin&&(e.origin=t-this._selectedIndex)}),this._selectedIndex!==t&&(this._selectedIndex=t,this._changeDetectorRef.markForCheck())}ngAfterContentInit(){this._subscribeToAllTabChanges(),this._subscribeToTabLabels(),this._tabsSubscription=this._tabs.changes.subscribe(()=>{if(this._clampTabIndex(this._indexToSelect)===this._selectedIndex){const t=this._tabs.toArray();for(let e=0;e<t.length;e++)if(t[e].isActive){this._indexToSelect=this._selectedIndex=e;break}}this._changeDetectorRef.markForCheck()})}_subscribeToAllTabChanges(){this._allTabs.changes.pipe(hg(this._allTabs)).subscribe(t=>{this._tabs.reset(t.filter(t=>t._closestTabGroup===this||!t._closestTabGroup)),this._tabs.notifyOnChanges()})}ngOnDestroy(){this._tabs.destroy(),this._tabsSubscription.unsubscribe(),this._tabLabelSubscription.unsubscribe()}realignInkBar(){this._tabHeader&&this._tabHeader._alignInkBarToSelectedTab()}focusTab(t){const e=this._tabHeader;e&&(e.focusIndex=t)}_focusChanged(t){this.focusChange.emit(this._createChangeEvent(t))}_createChangeEvent(t){const e=new j6;return e.index=t,this._tabs&&this._tabs.length&&(e.tab=this._tabs.toArray()[t]),e}_subscribeToTabLabels(){this._tabLabelSubscription&&this._tabLabelSubscription.unsubscribe(),this._tabLabelSubscription=q(...this._tabs.map(t=>t._stateChanges)).subscribe(()=>this._changeDetectorRef.markForCheck())}_clampTabIndex(t){return Math.min(this._tabs.length-1,Math.max(t||0,0))}_getTabLabelId(t){return`mat-tab-label-${this._groupId}-${t}`}_getTabContentId(t){return`mat-tab-content-${this._groupId}-${t}`}_setTabBodyWrapperHeight(t){if(!this._dynamicHeight||!this._tabBodyWrapperHeight)return;const e=this._tabBodyWrapper.nativeElement;e.style.height=this._tabBodyWrapperHeight+\"px\",this._tabBodyWrapper.nativeElement.offsetHeight&&(e.style.height=t+\"px\")}_removeTabBodyWrapperHeight(){const t=this._tabBodyWrapper.nativeElement;this._tabBodyWrapperHeight=t.clientHeight,t.style.height=\"\",this.animationDone.emit()}_handleClick(t,e,i){t.disabled||(this.selectedIndex=e.focusIndex=i)}_getTabIndex(t,e){return t.disabled?null:this.selectedIndex===e?0:-1}_tabFocusChanged(t,e){t&&\"mouse\"!==t&&\"touch\"!==t&&(this._tabHeader.focusIndex=e)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa($6,8),Oa(wb,8))},t.\\u0275dir=Xt({type:t,inputs:{headerPosition:\"headerPosition\",animationDuration:\"animationDuration\",disablePagination:\"disablePagination\",dynamicHeight:\"dynamicHeight\",contentTabIndex:\"contentTabIndex\",selectedIndex:\"selectedIndex\",backgroundColor:\"backgroundColor\"},outputs:{selectedIndexChange:\"selectedIndexChange\",focusChange:\"focusChange\",animationDone:\"animationDone\",selectedTabChange:\"selectedTabChange\"},features:[Uo]}),t})(),W6=(()=>{class t extends G6{constructor(t,e,i,n){super(t,e,i,n)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa($6,8),Oa(wb,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-tab-group\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,F6,5),2&t){let t;Mh(t=Ph())&&(e._allTabs=t)}},viewQuery:function(t,e){if(1&t&&(Th(A6,5),Th(v6,5)),2&t){let t;Mh(t=Ph())&&(e._tabBodyWrapper=t.first),Mh(t=Ph())&&(e._tabHeader=t.first)}},hostAttrs:[1,\"mat-tab-group\"],hostVars:4,hostBindings:function(t,e){2&t&&hl(\"mat-tab-group-dynamic-height\",e.dynamicHeight)(\"mat-tab-group-inverted-header\",\"below\"===e.headerPosition)},inputs:{color:\"color\",disableRipple:\"disableRipple\"},exportAs:[\"matTabGroup\"],features:[Yl([{provide:L6,useExisting:t}]),Uo],decls:6,vars:7,consts:[[3,\"selectedIndex\",\"disableRipple\",\"disablePagination\",\"indexFocused\",\"selectFocusedIndex\"],[\"tabHeader\",\"\"],[\"class\",\"mat-tab-label mat-focus-indicator\",\"role\",\"tab\",\"matTabLabelWrapper\",\"\",\"mat-ripple\",\"\",\"cdkMonitorElementFocus\",\"\",3,\"id\",\"mat-tab-label-active\",\"disabled\",\"matRippleDisabled\",\"click\",\"cdkFocusChange\",4,\"ngFor\",\"ngForOf\"],[1,\"mat-tab-body-wrapper\"],[\"tabBodyWrapper\",\"\"],[\"role\",\"tabpanel\",3,\"id\",\"mat-tab-body-active\",\"content\",\"position\",\"origin\",\"animationDuration\",\"_onCentered\",\"_onCentering\",4,\"ngFor\",\"ngForOf\"],[\"role\",\"tab\",\"matTabLabelWrapper\",\"\",\"mat-ripple\",\"\",\"cdkMonitorElementFocus\",\"\",1,\"mat-tab-label\",\"mat-focus-indicator\",3,\"id\",\"disabled\",\"matRippleDisabled\",\"click\",\"cdkFocusChange\"],[1,\"mat-tab-label-content\"],[3,\"ngIf\"],[3,\"cdkPortalOutlet\"],[\"role\",\"tabpanel\",3,\"id\",\"content\",\"position\",\"origin\",\"animationDuration\",\"_onCentered\",\"_onCentering\"]],template:function(t,e){1&t&&(La(0,\"mat-tab-header\",0,1),Ga(\"indexFocused\",function(t){return e._focusChanged(t)})(\"selectFocusedIndex\",function(t){return e.selectedIndex=t}),oa(2,w6,4,14,\"div\",2),Fa(),La(3,\"div\",3,4),oa(5,x6,1,9,\"mat-tab-body\",5),Fa()),2&t&&(Ra(\"selectedIndex\",e.selectedIndex||0)(\"disableRipple\",e.disableRipple)(\"disablePagination\",e.disablePagination),Cr(2),Ra(\"ngForOf\",e._tabs),Cr(1),hl(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode),Cr(2),Ra(\"ngForOf\",e._tabs))},directives:function(){return[Q6,Bd,Y6,py,$m,Vd,Xp,V6]},styles:[\".mat-tab-group{display:flex;flex-direction:column;max-width:100%}.mat-tab-group.mat-tab-group-inverted-header{flex-direction:column-reverse}.mat-tab-label{height:48px;padding:0 24px;cursor:pointer;box-sizing:border-box;opacity:.6;min-width:160px;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;position:relative}.mat-tab-label:focus{outline:none}.mat-tab-label:focus:not(.mat-tab-disabled){opacity:1}.cdk-high-contrast-active .mat-tab-label:focus{outline:dotted 2px;outline-offset:-2px}.mat-tab-label.mat-tab-disabled{cursor:default}.cdk-high-contrast-active .mat-tab-label.mat-tab-disabled{opacity:.5}.mat-tab-label .mat-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}.cdk-high-contrast-active .mat-tab-label{opacity:1}@media(max-width: 599px){.mat-tab-label{padding:0 12px}}@media(max-width: 959px){.mat-tab-label{padding:0 12px}}.mat-tab-group[mat-stretch-tabs]>.mat-tab-header .mat-tab-label{flex-basis:0;flex-grow:1}.mat-tab-body-wrapper{position:relative;overflow:hidden;display:flex;transition:height 500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable.mat-tab-body-wrapper{transition:none;animation:none}.mat-tab-body{top:0;left:0;right:0;bottom:0;position:absolute;display:block;overflow:hidden;outline:0;flex-basis:100%}.mat-tab-body.mat-tab-body-active{position:relative;overflow-x:hidden;overflow-y:auto;z-index:1;flex-grow:1}.mat-tab-group.mat-tab-group-dynamic-height .mat-tab-body.mat-tab-body-active{overflow-y:hidden}\\n\"],encapsulation:2}),t})();const q6=Nb(class{});let Y6=(()=>{class t extends q6{constructor(t){super(),this.elementRef=t}focus(){this.elementRef.nativeElement.focus()}getOffsetLeft(){return this.elementRef.nativeElement.offsetLeft}getOffsetWidth(){return this.elementRef.nativeElement.offsetWidth}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"matTabLabelWrapper\",\"\"]],hostVars:3,hostBindings:function(t,e){2&t&&(ia(\"aria-disabled\",!!e.disabled),hl(\"mat-tab-disabled\",e.disabled))},inputs:{disabled:\"disabled\"},features:[Uo]}),t})();const Z6=Qf({passive:!0});let K6=(()=>{class t{constructor(t,e,i,n,s,r,o){this._elementRef=t,this._changeDetectorRef=e,this._viewportRuler=i,this._dir=n,this._ngZone=s,this._platform=r,this._animationMode=o,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new C,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new C,this.disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new gh,this.indexFocused=new gh,s.runOutsideAngular(()=>{qm(t.nativeElement,\"mouseleave\").pipe(Of(this._destroyed)).subscribe(()=>{this._stopInterval()})})}get selectedIndex(){return this._selectedIndex}set selectedIndex(t){t=Ff(t),this._selectedIndex!=t&&(this._selectedIndexChanged=!0,this._selectedIndex=t,this._keyManager&&this._keyManager.updateActiveItem(t))}ngAfterViewInit(){qm(this._previousPaginator.nativeElement,\"touchstart\",Z6).pipe(Of(this._destroyed)).subscribe(()=>{this._handlePaginatorPress(\"before\")}),qm(this._nextPaginator.nativeElement,\"touchstart\",Z6).pipe(Of(this._destroyed)).subscribe(()=>{this._handlePaginatorPress(\"after\")})}ngAfterContentInit(){const t=this._dir?this._dir.change:tf(\"ltr\"),e=this._viewportRuler.change(150),i=()=>{this.updatePagination(),this._alignInkBarToSelectedTab()};this._keyManager=new ym(this._items).withHorizontalOrientation(this._getLayoutDirection()).withHomeAndEnd().withWrap(),this._keyManager.updateActiveItem(this._selectedIndex),\"undefined\"!=typeof requestAnimationFrame?requestAnimationFrame(i):i(),q(t,e,this._items.changes).pipe(Of(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>Promise.resolve().then(i)),this._keyManager.withHorizontalOrientation(this._getLayoutDirection())}),this._keyManager.change.pipe(Of(this._destroyed)).subscribe(t=>{this.indexFocused.emit(t),this._setTabFocus(t)})}ngAfterContentChecked(){this._tabLabelCount!=this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._alignInkBarToSelectedTab(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(t){if(!ef(t))switch(t.keyCode){case 13:case 32:this.focusIndex!==this.selectedIndex&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(t));break;default:this._keyManager.onKeydown(t)}}_onContentChanges(){const t=this._elementRef.nativeElement.textContent;t!==this._currentTextContent&&(this._currentTextContent=t||\"\",this._ngZone.run(()=>{this.updatePagination(),this._alignInkBarToSelectedTab(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(t){!this._isValidIndex(t)||this.focusIndex===t||!this._keyManager||this._keyManager.setActiveItem(t)}_isValidIndex(t){if(!this._items)return!0;const e=this._items?this._items.toArray()[t]:null;return!!e&&!e.disabled}_setTabFocus(t){if(this._showPaginationControls&&this._scrollToLabel(t),this._items&&this._items.length){this._items.toArray()[t].focus();const e=this._tabListContainer.nativeElement;e.scrollLeft=\"ltr\"==this._getLayoutDirection()?0:e.scrollWidth-e.offsetWidth}}_getLayoutDirection(){return this._dir&&\"rtl\"===this._dir.value?\"rtl\":\"ltr\"}_updateTabScrollPosition(){if(this.disablePagination)return;const t=this.scrollDistance,e=\"ltr\"===this._getLayoutDirection()?-t:t;this._tabList.nativeElement.style.transform=`translateX(${Math.round(e)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0)}get scrollDistance(){return this._scrollDistance}set scrollDistance(t){this._scrollTo(t)}_scrollHeader(t){return this._scrollTo(this._scrollDistance+(\"before\"==t?-1:1)*this._tabListContainer.nativeElement.offsetWidth/3)}_handlePaginatorClick(t){this._stopInterval(),this._scrollHeader(t)}_scrollToLabel(t){if(this.disablePagination)return;const e=this._items?this._items.toArray()[t]:null;if(!e)return;const i=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:n,offsetWidth:s}=e.elementRef.nativeElement;let r,o;\"ltr\"==this._getLayoutDirection()?(r=n,o=r+s):(o=this._tabList.nativeElement.offsetWidth-n,r=o-s);const a=this.scrollDistance,l=this.scrollDistance+i;r<a?this.scrollDistance-=a-r+60:o>l&&(this.scrollDistance+=o-l+60)}_checkPaginationEnabled(){if(this.disablePagination)this._showPaginationControls=!1;else{const t=this._tabList.nativeElement.scrollWidth>this._elementRef.nativeElement.offsetWidth;t||(this.scrollDistance=0),t!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=t}}_checkScrollingControls(){this.disablePagination?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=0==this.scrollDistance,this._disableScrollAfter=this.scrollDistance==this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){return this._tabList.nativeElement.scrollWidth-this._tabListContainer.nativeElement.offsetWidth||0}_alignInkBarToSelectedTab(){const t=this._items&&this._items.length?this._items.toArray()[this.selectedIndex]:null,e=t?t.elementRef.nativeElement:null;e?this._inkBar.alignToElement(e):this._inkBar.hide()}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(t,e){e&&null!=e.button&&0!==e.button||(this._stopInterval(),og(650,100).pipe(Of(q(this._stopScrolling,this._destroyed))).subscribe(()=>{const{maxScrollDistance:e,distance:i}=this._scrollHeader(t);(0===i||i>=e)&&this._stopInterval()}))}_scrollTo(t){if(this.disablePagination)return{maxScrollDistance:0,distance:0};const e=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(e,t)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:e,distance:this._scrollDistance}}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa(Gg),Oa(Eg,8),Oa(nu),Oa(Hf),Oa(wb,8))},t.\\u0275dir=Xt({type:t,inputs:{disablePagination:\"disablePagination\"}}),t})(),X6=(()=>{class t extends K6{constructor(t,e,i,n,s,r,o){super(t,e,i,n,s,r,o),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=Lf(t)}_itemSelected(t){t.preventDefault()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa(Gg),Oa(Eg,8),Oa(nu),Oa(Hf),Oa(wb,8))},t.\\u0275dir=Xt({type:t,inputs:{disableRipple:\"disableRipple\"},features:[Uo]}),t})(),Q6=(()=>{class t extends X6{constructor(t,e,i,n,s,r,o){super(t,e,i,n,s,r,o)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Mc),Oa(Gg),Oa(Eg,8),Oa(nu),Oa(Hf),Oa(wb,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-tab-header\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,Y6,4),2&t){let t;Mh(t=Ph())&&(e._items=t)}},viewQuery:function(t,e){if(1&t&&(Th(I6,7),Th(S6,7),Th(C6,7),Th(k6,5),Th(E6,5)),2&t){let t;Mh(t=Ph())&&(e._inkBar=t.first),Mh(t=Ph())&&(e._tabListContainer=t.first),Mh(t=Ph())&&(e._tabList=t.first),Mh(t=Ph())&&(e._nextPaginator=t.first),Mh(t=Ph())&&(e._previousPaginator=t.first)}},hostAttrs:[1,\"mat-tab-header\"],hostVars:4,hostBindings:function(t,e){2&t&&hl(\"mat-tab-header-pagination-controls-enabled\",e._showPaginationControls)(\"mat-tab-header-rtl\",\"rtl\"==e._getLayoutDirection())},inputs:{selectedIndex:\"selectedIndex\"},outputs:{selectFocusedIndex:\"selectFocusedIndex\",indexFocused:\"indexFocused\"},features:[Uo],ngContentSelectors:p6,decls:13,vars:8,consts:[[\"aria-hidden\",\"true\",\"mat-ripple\",\"\",1,\"mat-tab-header-pagination\",\"mat-tab-header-pagination-before\",\"mat-elevation-z4\",3,\"matRippleDisabled\",\"click\",\"mousedown\",\"touchend\"],[\"previousPaginator\",\"\"],[1,\"mat-tab-header-pagination-chevron\"],[1,\"mat-tab-label-container\",3,\"keydown\"],[\"tabListContainer\",\"\"],[\"role\",\"tablist\",1,\"mat-tab-list\",3,\"cdkObserveContent\"],[\"tabList\",\"\"],[1,\"mat-tab-labels\"],[\"aria-hidden\",\"true\",\"mat-ripple\",\"\",1,\"mat-tab-header-pagination\",\"mat-tab-header-pagination-after\",\"mat-elevation-z4\",3,\"matRippleDisabled\",\"mousedown\",\"click\",\"touchend\"],[\"nextPaginator\",\"\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0,1),Ga(\"click\",function(){return e._handlePaginatorClick(\"before\")})(\"mousedown\",function(t){return e._handlePaginatorPress(\"before\",t)})(\"touchend\",function(){return e._stopInterval()}),Na(2,\"div\",2),Fa(),La(3,\"div\",3,4),Ga(\"keydown\",function(t){return e._handleKeydown(t)}),La(5,\"div\",5,6),Ga(\"cdkObserveContent\",function(){return e._onContentChanges()}),La(7,\"div\",7),Ja(8),Fa(),Na(9,\"mat-ink-bar\"),Fa(),Fa(),La(10,\"div\",8,9),Ga(\"mousedown\",function(t){return e._handlePaginatorPress(\"after\",t)})(\"click\",function(){return e._handlePaginatorClick(\"after\")})(\"touchend\",function(){return e._stopInterval()}),Na(12,\"div\",2),Fa()),2&t&&(hl(\"mat-tab-header-pagination-disabled\",e._disableScrollBefore),Ra(\"matRippleDisabled\",e._disableScrollBefore||e.disableRipple),Cr(5),hl(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode),Cr(5),hl(\"mat-tab-header-pagination-disabled\",e._disableScrollAfter),Ra(\"matRippleDisabled\",e._disableScrollAfter||e.disableRipple))},directives:[py,am,I6],styles:['.mat-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.mat-tab-header-pagination{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:32px;cursor:pointer;z-index:2;-webkit-tap-highlight-color:transparent;touch-action:none}.mat-tab-header-pagination-controls-enabled .mat-tab-header-pagination{display:flex}.mat-tab-header-pagination-before,.mat-tab-header-rtl .mat-tab-header-pagination-after{padding-left:4px}.mat-tab-header-pagination-before .mat-tab-header-pagination-chevron,.mat-tab-header-rtl .mat-tab-header-pagination-after .mat-tab-header-pagination-chevron{transform:rotate(-135deg)}.mat-tab-header-rtl .mat-tab-header-pagination-before,.mat-tab-header-pagination-after{padding-right:4px}.mat-tab-header-rtl .mat-tab-header-pagination-before .mat-tab-header-pagination-chevron,.mat-tab-header-pagination-after .mat-tab-header-pagination-chevron{transform:rotate(45deg)}.mat-tab-header-pagination-chevron{border-style:solid;border-width:2px 2px 0 0;content:\"\";height:8px;width:8px}.mat-tab-header-pagination-disabled{box-shadow:none;cursor:default}.mat-tab-list{flex-grow:1;position:relative;transition:transform 500ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-ink-bar{position:absolute;bottom:0;height:2px;transition:500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable.mat-ink-bar{transition:none;animation:none}.mat-tab-group-inverted-header .mat-ink-bar{bottom:auto;top:0}.cdk-high-contrast-active .mat-ink-bar{outline:solid 2px;height:0}.mat-tab-labels{display:flex}[mat-align-tabs=center]>.mat-tab-header .mat-tab-labels{justify-content:center}[mat-align-tabs=end]>.mat-tab-header .mat-tab-labels{justify-content:flex-end}.mat-tab-label-container{display:flex;flex-grow:1;overflow:hidden;z-index:1}._mat-animation-noopable.mat-tab-list{transition:none;animation:none}.mat-tab-label{height:48px;padding:0 24px;cursor:pointer;box-sizing:border-box;opacity:.6;min-width:160px;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;position:relative}.mat-tab-label:focus{outline:none}.mat-tab-label:focus:not(.mat-tab-disabled){opacity:1}.cdk-high-contrast-active .mat-tab-label:focus{outline:dotted 2px;outline-offset:-2px}.mat-tab-label.mat-tab-disabled{cursor:default}.cdk-high-contrast-active .mat-tab-label.mat-tab-disabled{opacity:.5}.mat-tab-label .mat-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}.cdk-high-contrast-active .mat-tab-label{opacity:1}@media(max-width: 599px){.mat-tab-label{min-width:72px}}\\n'],encapsulation:2}),t})(),J6=(()=>{class t extends K6{constructor(t,e,i,n,s,r,o){super(t,n,s,e,i,r,o),this._disableRipple=!1,this.color=\"primary\"}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){const e=this._elementRef.nativeElement.classList;e.remove(`mat-background-${this.backgroundColor}`),t&&e.add(`mat-background-${t}`),this._backgroundColor=t}get disableRipple(){return this._disableRipple}set disableRipple(t){this._disableRipple=Lf(t)}_itemSelected(){}ngAfterContentInit(){this._items.changes.pipe(hg(null),Of(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}updateActiveLink(){if(!this._items)return;const t=this._items.toArray();for(let e=0;e<t.length;e++)if(t[e].active)return this.selectedIndex=e,void this._changeDetectorRef.markForCheck();this.selectedIndex=-1,this._inkBar.hide()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Eg,8),Oa(nu),Oa(Mc),Oa(Gg),Oa(Hf),Oa(wb,8))},t.\\u0275dir=Xt({type:t,inputs:{color:\"color\",backgroundColor:\"backgroundColor\",disableRipple:\"disableRipple\"},features:[Uo]}),t})(),t8=(()=>{class t extends J6{constructor(t,e,i,n,s,r,o){super(t,e,i,n,s,r,o)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Eg,8),Oa(nu),Oa(Mc),Oa(Gg),Oa(Hf),Oa(wb,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"\",\"mat-tab-nav-bar\",\"\"]],contentQueries:function(t,e,i){if(1&t&&Ih(i,n8,5),2&t){let t;Mh(t=Ph())&&(e._items=t)}},viewQuery:function(t,e){if(1&t&&(Th(I6,7),Th(S6,7),Th(C6,7),Th(k6,5),Th(E6,5)),2&t){let t;Mh(t=Ph())&&(e._inkBar=t.first),Mh(t=Ph())&&(e._tabListContainer=t.first),Mh(t=Ph())&&(e._tabList=t.first),Mh(t=Ph())&&(e._nextPaginator=t.first),Mh(t=Ph())&&(e._previousPaginator=t.first)}},hostAttrs:[1,\"mat-tab-nav-bar\",\"mat-tab-header\"],hostVars:10,hostBindings:function(t,e){2&t&&hl(\"mat-tab-header-pagination-controls-enabled\",e._showPaginationControls)(\"mat-tab-header-rtl\",\"rtl\"==e._getLayoutDirection())(\"mat-primary\",\"warn\"!==e.color&&\"accent\"!==e.color)(\"mat-accent\",\"accent\"===e.color)(\"mat-warn\",\"warn\"===e.color)},inputs:{color:\"color\"},exportAs:[\"matTabNavBar\",\"matTabNav\"],features:[Uo],attrs:M6,ngContentSelectors:p6,decls:13,vars:8,consts:[[\"aria-hidden\",\"true\",\"mat-ripple\",\"\",1,\"mat-tab-header-pagination\",\"mat-tab-header-pagination-before\",\"mat-elevation-z4\",3,\"matRippleDisabled\",\"click\",\"mousedown\",\"touchend\"],[\"previousPaginator\",\"\"],[1,\"mat-tab-header-pagination-chevron\"],[1,\"mat-tab-link-container\",3,\"keydown\"],[\"tabListContainer\",\"\"],[1,\"mat-tab-list\",3,\"cdkObserveContent\"],[\"tabList\",\"\"],[1,\"mat-tab-links\"],[\"aria-hidden\",\"true\",\"mat-ripple\",\"\",1,\"mat-tab-header-pagination\",\"mat-tab-header-pagination-after\",\"mat-elevation-z4\",3,\"matRippleDisabled\",\"mousedown\",\"click\",\"touchend\"],[\"nextPaginator\",\"\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0,1),Ga(\"click\",function(){return e._handlePaginatorClick(\"before\")})(\"mousedown\",function(t){return e._handlePaginatorPress(\"before\",t)})(\"touchend\",function(){return e._stopInterval()}),Na(2,\"div\",2),Fa(),La(3,\"div\",3,4),Ga(\"keydown\",function(t){return e._handleKeydown(t)}),La(5,\"div\",5,6),Ga(\"cdkObserveContent\",function(){return e._onContentChanges()}),La(7,\"div\",7),Ja(8),Fa(),Na(9,\"mat-ink-bar\"),Fa(),Fa(),La(10,\"div\",8,9),Ga(\"mousedown\",function(t){return e._handlePaginatorPress(\"after\",t)})(\"click\",function(){return e._handlePaginatorClick(\"after\")})(\"touchend\",function(){return e._stopInterval()}),Na(12,\"div\",2),Fa()),2&t&&(hl(\"mat-tab-header-pagination-disabled\",e._disableScrollBefore),Ra(\"matRippleDisabled\",e._disableScrollBefore||e.disableRipple),Cr(5),hl(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode),Cr(5),hl(\"mat-tab-header-pagination-disabled\",e._disableScrollAfter),Ra(\"matRippleDisabled\",e._disableScrollAfter||e.disableRipple))},directives:[py,am,I6],styles:['.mat-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.mat-tab-header-pagination{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:32px;cursor:pointer;z-index:2;-webkit-tap-highlight-color:transparent;touch-action:none}.mat-tab-header-pagination-controls-enabled .mat-tab-header-pagination{display:flex}.mat-tab-header-pagination-before,.mat-tab-header-rtl .mat-tab-header-pagination-after{padding-left:4px}.mat-tab-header-pagination-before .mat-tab-header-pagination-chevron,.mat-tab-header-rtl .mat-tab-header-pagination-after .mat-tab-header-pagination-chevron{transform:rotate(-135deg)}.mat-tab-header-rtl .mat-tab-header-pagination-before,.mat-tab-header-pagination-after{padding-right:4px}.mat-tab-header-rtl .mat-tab-header-pagination-before .mat-tab-header-pagination-chevron,.mat-tab-header-pagination-after .mat-tab-header-pagination-chevron{transform:rotate(45deg)}.mat-tab-header-pagination-chevron{border-style:solid;border-width:2px 2px 0 0;content:\"\";height:8px;width:8px}.mat-tab-header-pagination-disabled{box-shadow:none;cursor:default}.mat-tab-list{flex-grow:1;position:relative;transition:transform 500ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-tab-links{display:flex}[mat-align-tabs=center]>.mat-tab-link-container .mat-tab-links{justify-content:center}[mat-align-tabs=end]>.mat-tab-link-container .mat-tab-links{justify-content:flex-end}.mat-ink-bar{position:absolute;bottom:0;height:2px;transition:500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable.mat-ink-bar{transition:none;animation:none}.mat-tab-group-inverted-header .mat-ink-bar{bottom:auto;top:0}.cdk-high-contrast-active .mat-ink-bar{outline:solid 2px;height:0}.mat-tab-link-container{display:flex;flex-grow:1;overflow:hidden;z-index:1}.mat-tab-link{height:48px;padding:0 24px;cursor:pointer;box-sizing:border-box;opacity:.6;min-width:160px;text-align:center;display:inline-flex;justify-content:center;align-items:center;white-space:nowrap;vertical-align:top;text-decoration:none;position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent}.mat-tab-link:focus{outline:none}.mat-tab-link:focus:not(.mat-tab-disabled){opacity:1}.cdk-high-contrast-active .mat-tab-link:focus{outline:dotted 2px;outline-offset:-2px}.mat-tab-link.mat-tab-disabled{cursor:default}.cdk-high-contrast-active .mat-tab-link.mat-tab-disabled{opacity:.5}.mat-tab-link .mat-tab-label-content{display:inline-flex;justify-content:center;align-items:center;white-space:nowrap}.cdk-high-contrast-active .mat-tab-link{opacity:1}[mat-stretch-tabs] .mat-tab-link{flex-basis:0;flex-grow:1}.mat-tab-link.mat-tab-disabled{pointer-events:none}@media(max-width: 599px){.mat-tab-link{min-width:72px}}\\n'],encapsulation:2}),t})();const e8=Vb(zb(Nb(class{})));let i8=(()=>{class t extends e8{constructor(t,e,i,n,s,r){super(),this._tabNavBar=t,this.elementRef=e,this._focusMonitor=s,this._isActive=!1,this.rippleConfig=i||{},this.tabIndex=parseInt(n)||0,\"NoopAnimations\"===r&&(this.rippleConfig.animation={enterDuration:0,exitDuration:0})}get active(){return this._isActive}set active(t){Lf(t)!==this._isActive&&(this._isActive=t,this._tabNavBar.updateActiveLink())}get rippleDisabled(){return this.disabled||this.disableRipple||this._tabNavBar.disableRipple||!!this.rippleConfig.disabled}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(J6),Oa(ic),Oa(dy,8),Yi(\"tabindex\"),Oa(Vm),Oa(wb,8))},t.\\u0275dir=Xt({type:t,inputs:{active:\"active\"},features:[Uo]}),t})(),n8=(()=>{class t extends i8{constructor(t,e,i,n,s,r,o,a){super(t,e,s,r,o,a),this._tabLinkRipple=new uy(this,i,e,n),this._tabLinkRipple.setupTriggerEvents(e.nativeElement)}ngOnDestroy(){super.ngOnDestroy(),this._tabLinkRipple._removeTriggerEvents()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(t8),Oa(ic),Oa(nu),Oa(Hf),Oa(dy,8),Yi(\"tabindex\"),Oa(Vm),Oa(wb,8))},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"mat-tab-link\",\"\"],[\"\",\"matTabLink\",\"\"]],hostAttrs:[1,\"mat-tab-link\",\"mat-focus-indicator\"],hostVars:7,hostBindings:function(t,e){1&t&&Ga(\"focus\",function(){return e._handleFocus()}),2&t&&(ia(\"aria-current\",e.active?\"page\":null)(\"aria-disabled\",e.disabled)(\"tabIndex\",e.tabIndex),hl(\"mat-tab-disabled\",e.disabled)(\"mat-tab-label-active\",e.active))},inputs:{disabled:\"disabled\",disableRipple:\"disableRipple\",tabIndex:\"tabIndex\"},exportAs:[\"matTabLink\"],features:[Uo]}),t})(),s8=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[np,Fb,Qp,fy,lm,Wm],Fb]}),t})();function r8(t,e){if(1&t&&(La(0,\"a\",3,4),xl(2),Fa()),2&t){const t=e.$implicit,i=aa(1);el(\"title\",\"Onglet \",t.label,\"\"),Ra(\"routerLink\",t.link)(\"active\",i.isActive),Cr(2),Cl(\" \",t.label,\" \")}}let o8=(()=>{class t extends Gq{constructor(t){super(),this.mapService=t,this.tabs=[{label:\"Alertes\",link:\"/alerts/dashboard\"},{label:\"R\\xe8gles\",link:\"/alerts/rules\"}]}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.mapService.hasBooted$.value||this.mapService.resetToDefaultView()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alerts-panel\"]],features:[Uo],decls:4,vars:1,consts:[[1,\"panel\"],[\"mat-tab-nav-bar\",\"\",\"mat-align-tabs\",\"center\",1,\"tabs\"],[\"mat-tab-link\",\"\",\"routerLinkActive\",\"\",3,\"routerLink\",\"active\",\"title\",4,\"ngFor\",\"ngForOf\"],[\"mat-tab-link\",\"\",\"routerLinkActive\",\"\",3,\"routerLink\",\"active\",\"title\"],[\"rla\",\"routerLinkActive\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"nav\",1),oa(2,r8,3,4,\"a\",2),Fa(),Na(3,\"router-outlet\"),Fa()),2&t&&(Cr(2),Ra(\"ngForOf\",e.tabs))},directives:[t8,Bd,_L,gL,n8,vL],styles:[\".tabs[_ngcontent-%COMP%]{background-color:#f2c94c}\"]}),t})();class a8 extends r${constructor(t){super(),this.id_=void 0,this.geometryName_=\"geometry\",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t&&(\"function\"==typeof t.getSimplifiedGeometry?this.setGeometry(t):this.setProperties(t))}clone(){const t=new a8(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(QB(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=KB(t,\"change\",this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?function(t){if(\"function\"==typeof t)return t;{let e;return Array.isArray(t)?e=t:(sz(\"function\"==typeof t.getZIndex,41),e=[t]),function(){return e}}}(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}var l8=a8;class c8{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null}clone(){const t=this.getColor();return new c8({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}var h8=c8;class u8 extends xG{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(QB),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(KB(this.geometries_[t],\"change\",this.changed,this))}clone(){const t=new u8(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<lz(this.getExtent(),t,e))return n;const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)n=s[r].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){fz(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)vz(t,e[i].getExtent());return t}getGeometries(){return d8(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let s=0,r=i.length;s<r;++s){const r=i[s],o=r.getSimplifiedGeometry(t);e.push(o),o!==r&&(n=!0)}if(n){const t=new u8(null);return t.setGeometriesArray(e),t}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return\"GeometryCollection\"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=kz(this.getExtent()));const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(d8(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function d8(t){const e=[];for(let i=0,n=t.length;i<n;++i)e.push(t[i].clone());return e}var p8=u8;class f8{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=y$(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new f8({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return kB()}getImage(t){return kB()}getHitDetectionImage(){return kB()}getPixelRatio(t){return 1}getImageState(){return kB()}getImageSize(){return kB()}getOrigin(){return kB()}getSize(){return kB()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=y$(t)}listenImageChange(t){kB()}load(){kB()}unlistenImageChange(t){kB()}}var m8=f8;const g8=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,A8=/^([a-z]*)$|^hsla?\\(.*\\)$/i;function v8(t){return\"string\"==typeof t?t:x8(t)}function _8(t){const e=document.createElement(\"div\");if(e.style.color=t,\"\"!==e.style.color){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return\"\"}const b8=function(){const t={};let e=0;return function(i){let n;if(t.hasOwnProperty(i))n=t[i];else{if(e>=1024){let i=0;for(const n in t)0==(3&i++)&&(delete t[n],--e)}n=function(t){let e,i,n,s,r;if(A8.exec(t)&&(t=_8(t)),g8.exec(t)){const o=t.length-1;let a;a=o<=4?1:2;const l=4===o||8===o;e=parseInt(t.substr(1+0*a,a),16),i=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),s=l?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,i=(i<<4)+i,n=(n<<4)+n,l&&(s=(s<<4)+s)),r=[e,i,n,s/255]}else t.startsWith(\"rgba(\")?(r=t.slice(5,-1).split(\",\").map(Number),w8(r)):t.startsWith(\"rgb(\")?(r=t.slice(4,-1).split(\",\").map(Number),r.push(1),w8(r)):sz(!1,14);return r}(i),t[i]=n,++e}return n}}();function y8(t){return Array.isArray(t)?t:b8(t)}function w8(t){return t[0]=tV(t[0]+.5|0,0,255),t[1]=tV(t[1]+.5|0,0,255),t[2]=tV(t[2]+.5|0,0,255),t[3]=tV(t[3],0,1),t}function x8(t){let e=t[0];e!=(0|e)&&(e=e+.5|0);let i=t[1];i!=(0|i)&&(i=i+.5|0);let n=t[2];return n!=(0|n)&&(n=n+.5|0),\"rgba(\"+e+\",\"+i+\",\"+n+\",\"+(void 0===t[3]?1:Math.round(100*t[3])/100)+\")\"}function S8(t,e,i){return e+\":\"+t+\":\"+(i?v8(i):\"null\")}const C8=new class{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];0==(3&t++)&&!i.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=S8(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const s=S8(t,e,i);this.cache_[s]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}};let k8=null;class E8 extends CB{constructor(t,e,i,n,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=r,this.unlisten_=null,this.imageState_=s,this.size_=i,this.src_=e}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&2===this.imageState_){k8||(k8=jB(1,1)),k8.drawImage(this.image_,0,0);try{k8.getImageData(0,0,1,1),this.tainted_=!1}catch(t){k8=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(\"change\")}handleImageError_(){this.imageState_=3,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=2,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=jB(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(0===this.imageState_){this.image_||this.initializeImage_(),this.imageState_=1;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=JB(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||2!==this.imageState_)return;const e=this.image_,i=document.createElement(\"canvas\");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext(\"2d\");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation=\"multiply\",n.fillStyle=v8(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation=\"destination-in\",n.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}class M8 extends m8{constructor(t){super({opacity:void 0!==(t=t||{}).opacity?t.opacity:1,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,declutterMode:t.declutterMode}),this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:\"top-left\",this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:\"fraction\",this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:\"fraction\",this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;const e=void 0!==t.img?t.img:null;this.imgSize_=t.imgSize;let i=t.src;sz(!(void 0!==i&&e),4),sz(!e||e&&this.imgSize_,5),(void 0===i||0===i.length)&&e&&(i=e.src||MB(e)),sz(void 0!==i&&i.length>0,6);const n=void 0!==t.src?0:2;this.color_=void 0!==t.color?y8(t.color):null,this.iconImage_=function(t,e,i,n,s,r){let o=C8.get(e,n,r);return o||(o=new E8(t,e,i,n,s,r),C8.set(e,n,r,o)),o}(e,i,void 0!==this.imgSize_?this.imgSize_:null,this.crossOrigin_,n,this.color_),this.offset_=void 0!==t.offset?t.offset:[0,0],this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:\"top-left\",this.origin_=null,this.size_=void 0!==t.size?t.size:null}clone(){const t=this.getScale();return new M8({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const e=this.getSize();if(\"fraction\"==this.anchorXUnits_||\"fraction\"==this.anchorYUnits_){if(!e)return null;t=this.anchor_.slice(),\"fraction\"==this.anchorXUnits_&&(t[0]*=e[0]),\"fraction\"==this.anchorYUnits_&&(t[1]*=e[1])}if(\"top-left\"!=this.anchorOrigin_){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),(\"top-right\"==this.anchorOrigin_||\"bottom-right\"==this.anchorOrigin_)&&(t[0]=-t[0]+e[0]),(\"bottom-left\"==this.anchorOrigin_||\"bottom-right\"==this.anchorOrigin_)&&(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(\"top-left\"!=this.offsetOrigin_){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(\"top-right\"==this.offsetOrigin_||\"bottom-right\"==this.offsetOrigin_)&&(t[0]=i[0]-e[0]-t[0]),(\"bottom-left\"==this.offsetOrigin_||\"bottom-right\"==this.offsetOrigin_)&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(\"change\",t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(\"change\",t)}}var T8=M8;function I8(t,e,i,n,s,r,o){let a,l;const c=(i-e)/n;if(1===c)a=e;else if(2===c)a=e,l=s;else if(0!==c){let r=t[e],o=t[e+1],c=0;const h=[0];for(let s=e+n;s<i;s+=n){const e=t[s],i=t[s+1];c+=Math.sqrt((e-r)*(e-r)+(i-o)*(i-o)),h.push(c),r=e,o=i}const u=s*c,d=function(t,e,i){let n,s;i=i||mB;let r=0,o=t.length,a=!1;for(;r<o;)n=r+(o-r>>1),s=+i(t[n],e),s<0?r=n+1:(o=n,a=!s);return a?r:~r}(h,u);d<0?(l=(u-h[-d-2])/(h[-d-1]-h[-d-2]),a=e+(-d-2)*n):a=e+d*n}o=o>1?o:2,r=r||new Array(o);for(let h=0;h<o;++h)r[h]=void 0===a?NaN:void 0===l?t[a+h]:oV(t[a+h],t[a+n+h],l);return r}function P8(t,e,i,n,s,r){if(i==e)return null;let o;if(s<t[e+n-1])return r?(o=t.slice(e,e+n),o[n-1]=s,o):null;if(t[i-1]<s)return r?(o=t.slice(i-n,i),o[n-1]=s,o):null;if(s==t[e+n-1])return t.slice(e,e+n);let a=e/n,l=i/n;for(;a<l;){const e=a+l>>1;s<t[(e+1)*n-1]?l=e:a=e+1}const c=t[a*n-1];if(s==c)return t.slice((a-1)*n,(a-1)*n+n);const h=(s-c)/(t[(a+1)*n-1]-c);o=[];for(let u=0;u<n-1;++u)o.push(oV(t[(a-1)*n+u],t[a*n+u],h));return o.push(s),o}function O8(t,e,i,n){let s=t[e],r=t[e+1],o=0;for(let a=e+n;a<i;a+=n){const e=t[a],i=t[a+1];o+=Math.sqrt((e-s)*(e-s)+(i-r)*(i-r)),s=e,r=i}return o}class R8 extends CG{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}appendCoordinate(t){this.flatCoordinates?vB(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new R8(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<lz(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(EG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),TG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return u$(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return\"XYM\"!=this.layout&&\"XYZM\"!=this.layout?null:P8(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e=void 0!==e&&e)}getCoordinates(){return BG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return I8(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return O8(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=DG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new R8(e,\"XY\")}getType(){return\"LineString\"}intersectsExtent(t){return m$(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=OG(this.flatCoordinates,0,t,this.stride),this.changed()}}var D8=R8;class L8 extends CG{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let e=this.getLayout();const i=t,n=[],s=[];for(let t=0,r=i.length;t<r;++t){const r=i[t];0===t&&(e=r.getLayout()),vB(n,r.getFlatCoordinates()),s.push(n.length)}this.setFlatCoordinates(e,n),this.ends_=s}}appendLineString(t){this.flatCoordinates?vB(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new L8(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<lz(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(MG(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),IG(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))}getCoordinateAtM(t,e,i){return\"XYM\"!=this.layout&&\"XYZM\"!=this.layout||0===this.flatCoordinates.length?null:function(t,e,i,n,s,r,o){if(o)return P8(t,e,i[i.length-1],n,s,r);let a;if(s<t[n-1])return r?(a=t.slice(0,n),a[n-1]=s,a):null;if(t[t.length-1]<s)return r?(a=t.slice(t.length-n),a[n-1]=s,a):null;for(let l=0,c=i.length;l<c;++l){const r=i[l];if(e!=r){if(s<t[e+n-1])return null;if(s<=t[r-1])return P8(t,e,r,n,s,!1);e=r}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,e=void 0!==e&&e,i=void 0!==i&&i)}getCoordinates(){return zG(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new D8(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[];let s=0;for(let r=0,o=e.length;r<o;++r){const o=e[r],a=new D8(t.slice(s,o),i);n.push(a),s=o}return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const n=this.ends_,s=this.stride;for(let r=0,o=n.length;r<o;++r){const o=n[r];vB(t,I8(e,i,o,s,.5)),i=o}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,n,s,r,o,a){for(let l=0,c=i.length;l<c;++l){const c=i[l];o=DG(t,e,c,n,s,r,o),a.push(o),e=c}return o}(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new L8(e,\"XY\",i)}getType(){return\"MultiLineString\"}intersectsExtent(t){return function(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){if(m$(t,e,i[r],n,s))return!0;e=i[r]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=RG(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()}}var F8=L8;class N8 extends CG{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?vB(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new N8(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<lz(this.getExtent(),t,e))return n;const s=this.flatCoordinates,r=this.stride;for(let o=0,a=s.length;o<a;o+=r){const a=iV(t,e,s[o],s[o+1]);if(a<n){n=a;for(let t=0;t<r;++t)i[t]=s[o+t];i.length=r}}return n}getCoordinates(){return BG(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){return t<0||(this.flatCoordinates?this.flatCoordinates.length/this.stride:0)<=t?null:new WG(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,n=[];for(let s=0,r=t.length;s<r;s+=i){const r=new WG(t.slice(s,s+i),e);n.push(r)}return n}getType(){return\"MultiPoint\"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let n=0,s=e.length;n<s;n+=i)if(uz(t,e[n],e[n+1]))return!0;return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=OG(this.flatCoordinates,0,t,this.stride),this.changed()}}var B8=N8;class z8 extends CG{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let n=this.getLayout();const s=t,r=[],o=[];for(let t=0,e=s.length;t<e;++t){const e=s[t];0===t&&(n=e.getLayout());const i=r.length,a=e.getEnds();for(let t=0,n=a.length;t<n;++t)a[t]+=i;vB(r,e.getFlatCoordinates()),o.push(a)}e=n,t=r,i=o}void 0!==e&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(this.flatCoordinates){const i=this.flatCoordinates.length;vB(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let t=0,n=e.length;t<n;++t)e[t]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=this.endss_[n].slice();const i=new z8(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,n){return n<lz(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const o=i[r];s=MG(t,e,o,n,s),e=o[o.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,i,n,s,r,o,a,l,c,h){h=h||[NaN,NaN];for(let u=0,d=i.length;u<d;++u){const r=i[u];c=IG(t,e,r,n,s,true,o,a,l,c,h),e=r[r.length-1]}return c}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,0,t,e,i,n))}containsXY(t,e){return function(t,e,i,n,s,r){if(0===i.length)return!1;for(let o=0,a=i.length;o<a;++o){const a=i[o];if(f$(t,e,a,n,s,r))return!0;e=a[a.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return function(t,e,i,n){let s=0;for(let r=0,o=i.length;r<o;++r){const o=i[r];s+=UG(t,e,o,n),e=o[o.length-1]}return s}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),QG(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,VG(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=function(t,e,i,n){const s=[];let r=[1/0,1/0,-1/0,-1/0];for(let o=0,a=i.length;o<a;++o){const a=i[o];r=gz(t,e,a[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),e=a[a.length-1]}return s}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=function(t,e,i,n,s){let r=[];for(let o=0,a=i.length;o<a;++o){const a=i[o];r=qG(t,e,a,n,s,2*o,r),e=a[a.length-1]}return r}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new B8(this.getFlatInteriorPoints().slice(),\"XYM\")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;!function(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const s=i[r];if(!KG(t,e,s,n,undefined))return!1;s.length&&(e=s[s.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=QG(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=function(t,e,i,n,s,r,o,a){for(let l=0,c=i.length;l<c;++l){const c=i[l],h=[];o=NG(t,e,c,n,s,r,o,h),a.push(h),e=c[c.length-1]}return o}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new z8(e,\"XY\",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(0===t)e=0;else{const i=this.endss_[t-1];e=i[i.length-1]}const i=this.endss_[t].slice(),n=i[i.length-1];if(0!==e)for(let s=0,r=i.length;s<r;++s)i[s]-=e;return new tW(this.flatCoordinates.slice(e,n),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[];let s=0;for(let r=0,o=i.length;r<o;++r){const o=i[r].slice(),a=o[o.length-1];if(0!==s)for(let t=0,e=o.length;t<e;++t)o[t]-=s;const l=new tW(e.slice(s,a),t,o);n.push(l),s=a}return n}getType(){return\"MultiPolygon\"}intersectsExtent(t){return function(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const o=i[r];if(A$(t,e,o,n,s))return!0;e=o[o.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=function(t,e,i,n,s){s=s||[];let r=0;for(let o=0,a=i.length;o<a;++o){const a=RG(t,e,i[o],n,s[r]);0===a.length&&(a[0]=e),s[r++]=a,e=a[a.length-1]}return s.length=r,s}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{const t=i[i.length-1];this.flatCoordinates.length=0===t.length?0:t[t.length-1]}this.changed()}}var V8=z8;class $8{constructor(t){this.color_=void 0!==(t=t||{}).color?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=void 0!==t.lineDash?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new $8({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}var U8=$8;function j8(t){return Array.isArray(t)?x8(t):t}const H8=\"ol-hidden\",G8=\"ol-unselectable\",W8=\"ol-control\",q8=\"ol-collapsed\",Y8=new RegExp([\"^\\\\s*(?=(?:(?:[-a-z]+\\\\s*){0,2}(italic|oblique))?)\",\"(?=(?:(?:[-a-z]+\\\\s*){0,2}(small-caps))?)\",\"(?=(?:(?:[-a-z]+\\\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)\",\"(?:(?:normal|\\\\1|\\\\2|\\\\3)\\\\s*){0,3}((?:xx?-)?\",\"(?:small|large)|medium|smaller|larger|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx]))\",\"(?:\\\\s*\\\\/\\\\s*(normal|[\\\\.\\\\d]+(?:\\\\%|in|[cem]m|ex|p[ctx])?))\",\"?\\\\s*([-,\\\\\\\"\\\\'\\\\sa-z]+?)\\\\s*$\"].join(\"\"),\"i\"),Z8=[\"style\",\"variant\",\"weight\",\"size\",\"lineHeight\",\"family\"],K8=function(t){const e=t.match(Y8);if(!e)return null;const i={lineHeight:\"normal\",size:\"1.2em\",style:\"normal\",weight:\"normal\",variant:\"normal\"};for(let n=0,s=Z8.length;n<s;++n){const t=e[n+1];void 0!==t&&(i[Z8[n]]=t)}return i.families=i.family.split(/,\\s?/),i},X8=\"10px sans-serif\",Q8=\"#000\",J8=\"round\",t7=[],e7=\"round\",i7=\"#000\",n7=\"center\",s7=\"middle\",r7=[0,0,0,0],o7=new r$;let a7,l7=null;const c7={},h7=function(){const t=\"32px \",e=[\"monospace\",\"serif\"],i=e.length,n=\"wmytzilWMYTZIL@#/&?$%10\\uf013\";let s,r;function o(s,o,a){let l=!0;for(let c=0;c<i;++c){const i=e[c];if(r=p7(s+\" \"+o+\" \"+t+i,n),a!=i){const e=p7(s+\" \"+o+\" \"+t+a+\",\"+i,n);l=l&&e!=r}}return!!l}function a(){let t=!0;const e=o7.getKeys();for(let i=0,n=e.length;i<n;++i){const n=e[i];o7.get(n)<100&&(o.apply(this,n.split(\"\\n\"))?(xB(c7),l7=null,a7=void 0,o7.set(n,100)):(o7.set(n,o7.get(n)+1,!0),t=!1))}t&&(clearInterval(s),s=void 0)}return function(t){const e=K8(t);if(!e)return;const i=e.families;for(let n=0,r=i.length;n<r;++n){const t=i[n],r=e.style+\"\\n\"+e.weight+\"\\n\"+t;void 0===o7.get(r)&&(o7.set(r,100,!0),o(e.style,e.weight,t)||(o7.set(r,0,!0),void 0===s&&(s=setInterval(a,32))))}}}(),u7=function(){let t;return function(e){let i=c7[e];if(null==i){if(VB){const t=K8(e),n=d7(e,\"\\u017dg\");i=(isNaN(Number(t.lineHeight))?1.2:Number(t.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else t||(t=document.createElement(\"div\"),t.innerHTML=\"M\",t.style.minHeight=\"0\",t.style.maxHeight=\"none\",t.style.height=\"auto\",t.style.padding=\"0\",t.style.border=\"none\",t.style.position=\"absolute\",t.style.display=\"block\",t.style.left=\"-99999px\"),t.style.font=e,document.body.appendChild(t),i=t.offsetHeight,document.body.removeChild(t);c7[e]=i}return i}}();function d7(t,e){return l7||(l7=jB(1,1)),t!=a7&&(l7.font=t,a7=l7.font),l7.measureText(e)}function p7(t,e){return d7(t,e).width}function f7(t,e,i){if(e in i)return i[e];const n=e.split(\"\\n\").reduce((e,i)=>Math.max(e,p7(t,i)),0);return i[e]=n,n}class m7 extends m8{constructor(t){super({opacity:1,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=void 0!==t.fill?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=void 0!==t.radius?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=void 0!==t.angle?t.angle:0,this.stroke_=void 0!==t.stroke?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new m7({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,n=jB(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return 2}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(0===e||this.points_===1/0||\"bevel\"!==t&&\"miter\"!==t)return e;let n=this.radius_,s=void 0===this.radius2_?n:this.radius2_;if(n<s){const t=n;n=s,s=t}const r=2*Math.PI/(void 0===this.radius2_?this.points_:2*this.points_),o=s*Math.sin(r),a=n-Math.sqrt(s*s-o*o),l=Math.sqrt(o*o+a*a),c=l/o;if(\"miter\"===t&&c<=i)return c*e;const h=e/2/c,u=e/2*(a/l),d=Math.sqrt((n+h)*(n+h)+u*u)-n;if(void 0===this.radius2_||\"bevel\"===t)return 2*d;const p=n*Math.sin(r),f=s-Math.sqrt(n*n-p*p),m=Math.sqrt(p*p+f*f)/p;return m<=i?2*Math.max(d,m*e/2-s-n):2*d}createRenderOptions(){let t,e=e7,i=0,n=null,s=0,r=0;this.stroke_&&(t=this.stroke_.getColor(),null===t&&(t=i7),t=j8(t),r=this.stroke_.getWidth(),void 0===r&&(r=1),n=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),void 0===e&&(e=e7),i=this.stroke_.getMiterLimit(),void 0===i&&(i=10));const o=this.calculateLineJoinSize_(e,r,i),a=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:r,size:Math.ceil(2*a+o),lineDash:n,lineDashOffset:s,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let t=this.fill_.getColor();null===t&&(t=Q8),e.fillStyle=j8(t),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if(\"string\"==typeof e&&(e=y8(e)),null===e?i=1:Array.isArray(e)&&(i=4===e.length?e[3]:1),0===i){const e=jB(t.size,t.size);this.hitDetectionCanvas_=e.canvas,this.drawHitDetectionCanvas_(t,e)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=void 0===this.radius2_?i:this.radius2_;void 0!==this.radius2_&&(e*=2);const s=this.angle_-Math.PI/2,r=2*Math.PI/e;for(let o=0;o<e;o++){const e=s+o*r,a=o%2==0?i:n;t.lineTo(a*Math.cos(e),a*Math.sin(e))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Q8,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}var g7=m7;class A7 extends g7{constructor(t){super({points:1/0,fill:(t=t||{radius:5}).fill,radius:t.radius,stroke:t.stroke,scale:void 0!==t.scale?t.scale:1,rotation:void 0!==t.rotation?t.rotation:0,rotateWithView:void 0!==t.rotateWithView&&t.rotateWithView,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new A7({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}var v7=A7;class _7{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=x7,void 0!==t.geometry&&this.setGeometry(t.geometry),this.fill_=void 0!==t.fill?t.fill:null,this.image_=void 0!==t.image?t.image:null,this.renderer_=void 0!==t.renderer?t.renderer:null,this.hitDetectionRenderer_=void 0!==t.hitDetectionRenderer?t.hitDetectionRenderer:null,this.stroke_=void 0!==t.stroke?t.stroke:null,this.text_=void 0!==t.text?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&\"object\"==typeof t&&(t=t.clone()),new _7({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){\"function\"==typeof t?this.geometryFunction_=t:\"string\"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=x7,this.geometry_=t}setZIndex(t){this.zIndex_=t}}let b7=null;function y7(t,e){if(!b7){const t=new h8({color:\"rgba(255,255,255,0.4)\"}),e=new U8({color:\"#3399CC\",width:1.25});b7=[new _7({image:new v7({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return b7}function w7(){const t={},e=[255,255,255,1],i=[0,153,255,1];return t.Polygon=[new _7({fill:new h8({color:[255,255,255,.5]})})],t.MultiPolygon=t.Polygon,t.LineString=[new _7({stroke:new U8({color:e,width:5})}),new _7({stroke:new U8({color:i,width:3})})],t.MultiLineString=t.LineString,t.Circle=t.Polygon.concat(t.LineString),t.Point=[new _7({image:new v7({radius:6,fill:new h8({color:i}),stroke:new U8({color:e,width:1.5})}),zIndex:1/0})],t.MultiPoint=t.Point,t.GeometryCollection=t.Polygon.concat(t.LineString,t.Point),t}function x7(t){return t.getGeometry()}var S7=_7;class C7{constructor(t){this.font_=(t=t||{}).font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=y$(void 0!==t.scale?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=void 0!==t.fill?t.fill:new h8({color:\"#333\"}),this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4,this.placement_=void 0!==t.placement?t.placement:\"point\",this.overflow_=!!t.overflow,this.stroke_=void 0!==t.stroke?t.stroke:null,this.offsetX_=void 0!==t.offsetX?t.offsetX:0,this.offsetY_=void 0!==t.offsetY?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=void 0===t.padding?null:t.padding}clone(){const t=this.getScale();return new C7({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=y$(void 0!==t?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}var k7=C7,E7=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?EV(e.dataProjection):this.readProjection(t);e.extent&&i&&\"tile-pixels\"===i.getUnits()&&(i=EV(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return kB()}readFeature(t,e){return kB()}readFeatures(t,e){return kB()}readGeometry(t,e){return kB()}readProjection(t){return kB()}writeFeature(t,e){return kB()}writeFeatures(t,e){return kB()}writeGeometry(t,e){return kB()}};function M7(t,e,i){const n=i?EV(i.featureProjection):null,s=i?EV(i.dataProjection):null;let r;if(r=n&&s&&!RV(n,s)?(e?t.clone():t).transform(e?n:s,e?s:n):t,e&&i&&void 0!==i.decimals){const e=Math.pow(10,i.decimals),n=function(t){for(let i=0,n=t.length;i<n;++i)t[i]=Math.round(t[i]*e)/e;return t};r===t&&(r=t.clone()),r.applyTransform(n)}return r}function T7(t,e){const i=e?EV(e.featureProjection):null,n=e?EV(e.dataProjection):null;return i&&n&&!RV(i,n)?NV(t,n,i):t}const I7=\"http://www.w3.org/2001/XMLSchema-instance\";function P7(t,e){return J7().createElementNS(t,e)}function O7(t,e){return R7(t,e,[]).join(\"\")}function R7(t,e,i){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)i.push(e?String(t.nodeValue).replace(/(\\r\\n|\\r|\\n)/g,\"\"):t.nodeValue);else{let n;for(n=t.firstChild;n;n=n.nextSibling)R7(n,e,i)}return i}function D7(t){return\"documentElement\"in t}function L7(t){return(new DOMParser).parseFromString(t,\"application/xml\")}function F7(t,e){return function(i,n){const s=t.call(void 0!==e?e:this,i,n);void 0!==s&&vB(n[n.length-1],s)}}function N7(t,e){return function(i,n){const s=t.call(void 0!==e?e:this,i,n);void 0!==s&&n[n.length-1].push(s)}}function B7(t,e){return function(i,n){const s=t.call(void 0!==e?e:this,i,n);void 0!==s&&(n[n.length-1]=s)}}function z7(t,e,i){return function(n,s){const r=t.call(void 0!==i?i:this,n,s);if(void 0!==r){const t=s[s.length-1],i=void 0!==e?e:n.localName;let o;i in t?o=t[i]:(o=[],t[i]=o),o.push(r)}}}function V7(t,e,i){return function(n,s){const r=t.call(void 0!==i?i:this,n,s);void 0!==r&&(s[s.length-1][void 0!==e?e:n.localName]=r)}}function $7(t,e){return function(i,n,s){t.call(void 0!==e?e:this,i,n,s),s[s.length-1].node.appendChild(i)}}function U7(t,e){let i,n;return function(e,s,r){if(void 0===i){i={};const s={};s[e.localName]=t,i[e.namespaceURI]=s,n=j7(e.localName)}Z7(i,n,s,r)}}function j7(t,e){return function(i,n,s){let r=t;return void 0===r&&(r=s),P7(void 0!==e?e:n[n.length-1].node.namespaceURI,r)}}const H7=j7();function G7(t,e){const i=e.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=t[e[s]];return n}function W7(t,e,i){let n,s;for(i=void 0!==i?i:{},n=0,s=t.length;n<s;++n)i[t[n]]=e;return i}function q7(t,e,i,n){let s;for(s=e.firstElementChild;s;s=s.nextElementSibling){const e=t[s.namespaceURI];if(void 0!==e){const t=e[s.localName];void 0!==t&&t.call(n,s,i)}}}function Y7(t,e,i,n,s){return n.push(t),q7(e,i,n,s),n.pop()}function Z7(t,e,i,n,s,r){const o=(void 0!==s?s:i).length;let a,l;for(let c=0;c<o;++c)a=i[c],void 0!==a&&(l=e.call(void 0!==r?r:this,a,n,void 0!==s?s[c]:void 0),void 0!==l&&t[l.namespaceURI][l.localName].call(r,l,a,n))}function K7(t,e,i,n,s,r,o){return s.push(t),Z7(e,i,n,s,r,o),s.pop()}let X7,Q7;function J7(){return void 0===Q7&&\"undefined\"!=typeof document&&(Q7=document.implementation.createDocument(\"\",\"\",null)),Q7}var t9=class extends E7{constructor(){super(),this.xmlSerializer_=(void 0===X7&&\"undefined\"!=typeof XMLSerializer&&(X7=new XMLSerializer),X7)}getType(){return\"xml\"}readFeature(t,e){if(t){if(\"string\"==typeof t){const i=L7(t);return this.readFeatureFromDocument(i,e)}return D7(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e)}return null}readFeatureFromDocument(t,e){const i=this.readFeaturesFromDocument(t,e);return i.length>0?i[0]:null}readFeatureFromNode(t,e){return null}readFeatures(t,e){if(t){if(\"string\"==typeof t){const i=L7(t);return this.readFeaturesFromDocument(i,e)}return D7(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e)}return[]}readFeaturesFromDocument(t,e){const i=[];for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&vB(i,this.readFeaturesFromNode(n,e));return i}readFeaturesFromNode(t,e){return kB()}readGeometry(t,e){if(t){if(\"string\"==typeof t){const i=L7(t);return this.readGeometryFromDocument(i,e)}return D7(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e)}return null}readGeometryFromDocument(t,e){return null}readGeometryFromNode(t,e){return null}readProjection(t){if(t){if(\"string\"==typeof t){const e=L7(t);return this.readProjectionFromDocument(e)}return D7(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t)}return null}readProjectionFromDocument(t){return this.dataProjection}readProjectionFromNode(t){return this.dataProjection}writeFeature(t,e){const i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeatureNode(t,e){return null}writeFeatures(t,e){const i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeFeaturesNode(t,e){return null}writeGeometry(t,e){const i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)}writeGeometryNode(t,e){return null}};function e9(t){return function(t){const e=/^\\s*(true|1)|(false|0)\\s*$/.exec(t);if(e)return void 0!==e[1]||!1}(O7(t,!1))}function i9(t){const e=O7(t,!1),i=Date.parse(e);return isNaN(i)?void 0:i/1e3}function n9(t){return function(t){const e=/^\\s*([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)\\s*$/i.exec(t);if(e)return parseFloat(e[1])}(O7(t,!1))}function s9(t){return r9(O7(t,!1))}function r9(t){const e=/^\\s*(\\d+)\\s*$/.exec(t);if(e)return parseInt(e[1],10)}function o9(t){return O7(t,!1).trim()}function a9(t,e){h9(t,e?\"1\":\"0\")}function l9(t,e){const i=e.toPrecision();t.appendChild(J7().createTextNode(i))}function c9(t,e){const i=e.toString();t.appendChild(J7().createTextNode(i))}function h9(t,e){t.appendChild(J7().createTextNode(e))}const u9=[\"http://www.google.com/kml/ext/2.2\"],d9=[null,\"http://earth.google.com/kml/2.0\",\"http://earth.google.com/kml/2.1\",\"http://earth.google.com/kml/2.2\",\"http://www.opengis.net/kml/2.2\"],p9={fraction:\"fraction\",pixels:\"pixels\",insetPixels:\"pixels\"},f9=W7(d9,{ExtendedData:gtt,Region:Att,MultiGeometry:V7(att,\"geometry\"),LineString:V7(stt,\"geometry\"),LinearRing:V7(rtt,\"geometry\"),Point:V7(ltt,\"geometry\"),Polygon:V7(htt,\"geometry\"),Style:V7(dtt),StyleMap:function(t,e){const i=H9.call(this,t,e);if(!i)return;const n=e[e.length-1];Array.isArray(i)?n.Style=i:\"string\"==typeof i?n.styleUrl=i:sz(!1,38)},address:V7(o9),description:V7(o9),name:V7(o9),open:V7(e9),phoneNumber:V7(o9),styleUrl:V7($9),visibility:V7(e9)},W7(u9,{MultiTrack:V7(function(t,e){const i=Y7([],X9,t,e);if(i)return new F8(i)},\"geometry\"),Track:V7(J9,\"geometry\")})),m9=W7(d9,{ExtendedData:gtt,Region:Att,Link:function(t,e){q7(g9,t,e)},address:V7(o9),description:V7(o9),name:V7(o9),open:V7(e9),phoneNumber:V7(o9),visibility:V7(e9)}),g9=W7(d9,{href:V7(V9)}),A9=W7(d9,{LatLonAltBox:function(t,e){const i=Y7({},btt,t,e);if(!i)return;const n=e[e.length-1],s=[parseFloat(i.west),parseFloat(i.south),parseFloat(i.east),parseFloat(i.north)];n.extent=s,n.altitudeMode=i.altitudeMode,n.minAltitude=parseFloat(i.minAltitude),n.maxAltitude=parseFloat(i.maxAltitude)},Lod:function(t,e){const i=Y7({},ytt,t,e);if(!i)return;const n=e[e.length-1];n.minLodPixels=parseFloat(i.minLodPixels),n.maxLodPixels=parseFloat(i.maxLodPixels),n.minFadeExtent=parseFloat(i.minFadeExtent),n.maxFadeExtent=parseFloat(i.maxFadeExtent)}}),v9=W7(d9,[\"Document\",\"Placemark\"]),_9=W7(d9,{Document:$7(function(t,e,i){K7({node:t},ktt,Ett,e,i,void 0,this)}),Placemark:$7(Xtt)});let b9,y9,w9,x9,S9,C9,k9,E9,M9,T9=null,I9=null,P9=null,O9=null,R9=null,D9=null;function L9(t){return 32/Math.min(t[0],t[1])}function F9(t){return t}function N9(t,e,i){return Array.isArray(t)?t:\"string\"==typeof t?N9(i[t],e,i):e}function B9(t){const e=O7(t,!1),i=/^\\s*#?\\s*([0-9A-Fa-f]{8})\\s*$/.exec(e);if(i){const t=i[1];return[parseInt(t.substr(6,2),16),parseInt(t.substr(4,2),16),parseInt(t.substr(2,2),16),parseInt(t.substr(0,2),16)/255]}}function z9(t){let e=O7(t,!1);const i=[];e=e.replace(/\\s*,\\s*/g,\",\");const n=/^\\s*([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?),([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)(?:\\s+|,|$)(?:([+\\-]?\\d*\\.?\\d+(?:e[+\\-]?\\d+)?)(?:\\s+|$))?\\s*/i;let s;for(;s=n.exec(e);){const t=parseFloat(s[1]),n=parseFloat(s[2]),r=s[3]?parseFloat(s[3]):0;i.push(t,n,r),e=e.substr(s[0].length)}if(\"\"===e)return i}function V9(t){const e=O7(t,!1).trim();let i=t.baseURI;return(!i||\"about:blank\"==i)&&(i=window.location.href),i?new URL(e,i).href:e}function $9(t){const e=O7(t,!1).trim().replace(/^(?!.*#)/,\"#\");let i=t.baseURI;return(!i||\"about:blank\"==i)&&(i=window.location.href),i?new URL(e,i).href:e}function U9(t){return n9(t)}const j9=W7(d9,{Pair:function(t,e){const i=Y7({},vtt,t,e,this);if(!i)return;const n=i.key;if(n&&\"normal\"==n){const t=i.styleUrl;t&&(e[e.length-1]=t);const n=i.Style;n&&(e[e.length-1]=n)}}});function H9(t,e){return Y7(void 0,j9,t,e,this)}const G9=W7(d9,{Icon:V7(function(t,e){return Y7({},ttt,t,e)||null}),color:V7(B9),heading:V7(n9),hotSpot:V7(function(t){const e=t.getAttribute(\"xunits\"),i=t.getAttribute(\"yunits\");let n;return n=\"insetPixels\"!==e?\"insetPixels\"!==i?\"bottom-left\":\"top-left\":\"insetPixels\"!==i?\"bottom-right\":\"top-right\",{x:parseFloat(t.getAttribute(\"x\")),xunits:p9[e],y:parseFloat(t.getAttribute(\"y\")),yunits:p9[i],origin:n}}),scale:V7(U9)}),W9=W7(d9,{color:V7(B9),scale:V7(U9)}),q9=W7(d9,{color:V7(B9),width:V7(n9)}),Y9=W7(d9,{color:V7(B9),fill:V7(e9),outline:V7(e9)}),Z9=W7(d9,{coordinates:B7(z9)});function K9(t,e){return Y7(null,Z9,t,e)}const X9=W7(u9,{Track:N7(J9)}),Q9=W7(d9,{when:function(t,e){const i=e[e.length-1].whens,n=O7(t,!1),s=Date.parse(n);i.push(isNaN(s)?0:s)}},W7(u9,{coord:function(t,e){const i=e[e.length-1].coordinates,n=O7(t,!1),s=/^\\s*([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s+([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s+([+\\-]?\\d+(?:\\.\\d*)?(?:e[+\\-]?\\d*)?)\\s*$/i.exec(n);if(s){const t=parseFloat(s[1]),e=parseFloat(s[2]),n=parseFloat(s[3]);i.push([t,e,n])}else i.push([])}}));function J9(t,e){const i=Y7({coordinates:[],whens:[]},Q9,t,e);if(!i)return;const n=[],s=i.coordinates,r=i.whens;for(let o=0,a=Math.min(s.length,r.length);o<a;++o)3==s[o].length&&n.push(s[o][0],s[o][1],s[o][2],r[o]);return new D8(n,\"XYZM\")}const ttt=W7(d9,{href:V7(V9)},W7(u9,{x:V7(n9),y:V7(n9),w:V7(n9),h:V7(n9)})),ett=W7(d9,{coordinates:B7(z9)});function itt(t,e){return Y7(null,ett,t,e)}const ntt=W7(d9,{extrude:V7(e9),tessellate:V7(e9),altitudeMode:V7(o9)});function stt(t,e){const i=Y7({},ntt,t,e),n=itt(t,e);if(n){const t=new D8(n,\"XYZ\");return t.setProperties(i,!0),t}}function rtt(t,e){const i=Y7({},ntt,t,e),n=itt(t,e);if(n){const t=new tW(n,\"XYZ\",[n.length]);return t.setProperties(i,!0),t}}const ott=W7(d9,{LineString:N7(stt),LinearRing:N7(rtt),MultiGeometry:N7(att),Point:N7(ltt),Polygon:N7(htt)});function att(t,e){const i=Y7([],ott,t,e);if(!i)return null;if(0===i.length)return new p8(i);let n,s=!0;const r=i[0].getType();let o;for(let a=1,l=i.length;a<l;++a)if(o=i[a],o.getType()!=r){s=!1;break}if(s){let t,e;if(\"Point\"==r){const s=i[0];t=s.getLayout(),e=s.getFlatCoordinates();for(let t=1,n=i.length;t<n;++t)o=i[t],vB(e,o.getFlatCoordinates());n=new B8(e,t),ptt(n,i)}else\"LineString\"==r?(n=new F8(i),ptt(n,i)):\"Polygon\"==r?(n=new V8(i),ptt(n,i)):\"GeometryCollection\"==r?n=new p8(i):sz(!1,37)}else n=new p8(i);return n}function ltt(t,e){const i=Y7({},ntt,t,e),n=itt(t,e);if(n){const t=new WG(n,\"XYZ\");return t.setProperties(i,!0),t}}const ctt=W7(d9,{innerBoundaryIs:function(t,e){const i=Y7([],wtt,t,e);i.length>0&&e[e.length-1].push(...i)},outerBoundaryIs:function(t,e){const i=Y7(void 0,xtt,t,e);i&&(e[e.length-1][0]=i)}});function htt(t,e){const i=Y7({},ntt,t,e),n=Y7([null],ctt,t,e);if(n&&n[0]){const t=n[0],e=[t.length];for(let i=1,r=n.length;i<r;++i)vB(t,n[i]),e.push(t.length);const s=new tW(t,\"XYZ\",e);return s.setProperties(i,!0),s}}const utt=W7(d9,{IconStyle:function(t,e){const i=Y7({},G9,t,e);if(!i)return;const n=e[e.length-1],s=\"Icon\"in i?i.Icon:{},r=!(\"Icon\"in i)||Object.keys(s).length>0;let o;const a=s.href;a?o=a:r&&(o=C9);let l,c,h,u=\"bottom-left\";const d=i.hotSpot;let p;d?(l=[d.x,d.y],c=d.xunits,h=d.yunits,u=d.origin):/^https?:\\/\\/maps\\.(?:google|gstatic)\\.com\\//.test(o)&&(o.includes(\"pushpin\")?(l=y9,c=w9,h=x9):o.includes(\"arrow-reverse\")?(l=[54,42],c=w9,h=x9):o.includes(\"paddle\")&&(l=[32,1],c=w9,h=x9));const f=s.x,m=s.y;let g;void 0!==f&&void 0!==m&&(p=[f,m]);const A=s.w,v=s.h;let _;void 0!==A&&void 0!==v&&(g=[A,v]);const b=i.heading;void 0!==b&&(_=sV(b));const y=i.color;if(r){o==C9&&(g=S9);const t=new T8({anchor:l,anchorOrigin:u,anchorXUnits:c,anchorYUnits:h,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:\"bottom-left\",rotation:_,scale:i.scale,size:g,src:this.iconUrlFunction_(o),color:y}),e=t.getScaleArray()[0],s=t.getSize();if(null===s){const i=t.getImageState();if(0===i||1===i){const n=function(){const i=t.getImageState();if(0!==i&&1!==i){const i=t.getSize();if(i&&2==i.length){const n=L9(i);t.setScale(e*n)}t.unlistenImageChange(n)}};t.listenImageChange(n),0===i&&t.load()}}else if(2==s.length){const i=L9(s);t.setScale(e*i)}n.imageStyle=t}else n.imageStyle=k9},LabelStyle:function(t,e){const i=Y7({},W9,t,e);if(!i)return;const n=e[e.length-1],s=new k7({fill:new h8({color:\"color\"in i?i.color:b9}),scale:i.scale});n.textStyle=s},LineStyle:function(t,e){const i=Y7({},q9,t,e);if(!i)return;const n=e[e.length-1],s=new U8({color:\"color\"in i?i.color:b9,width:\"width\"in i?i.width:1});n.strokeStyle=s},PolyStyle:function(t,e){const i=Y7({},Y9,t,e);if(!i)return;const n=e[e.length-1],s=new h8({color:\"color\"in i?i.color:b9});n.fillStyle=s;const r=i.fill;void 0!==r&&(n.fill=r);const o=i.outline;void 0!==o&&(n.outline=o)}});function dtt(t,e){const i=Y7({},utt,t,e,this);if(!i)return null;let n=\"fillStyle\"in i?i.fillStyle:T9;const s=i.fill;let r;void 0!==s&&!s&&(n=null),\"imageStyle\"in i?i.imageStyle!=k9&&(r=i.imageStyle):r=I9;const o=\"textStyle\"in i?i.textStyle:O9,a=\"strokeStyle\"in i?i.strokeStyle:P9,l=i.outline;return void 0===l||l?[new S7({fill:n,image:r,stroke:a,text:o,zIndex:void 0})]:[new S7({geometry:function(t){const e=t.getGeometry(),i=e.getType();return\"GeometryCollection\"===i?new p8(e.getGeometriesArrayRecursive().filter(function(t){const e=t.getType();return\"Polygon\"!==e&&\"MultiPolygon\"!==e})):\"Polygon\"!==i&&\"MultiPolygon\"!==i?e:void 0},fill:n,image:r,stroke:a,text:o,zIndex:void 0}),new S7({geometry:function(t){const e=t.getGeometry(),i=e.getType();return\"GeometryCollection\"===i?new p8(e.getGeometriesArrayRecursive().filter(function(t){const e=t.getType();return\"Polygon\"===e||\"MultiPolygon\"===e})):\"Polygon\"===i||\"MultiPolygon\"===i?e:void 0},fill:n,stroke:null,zIndex:void 0})]}function ptt(t,e){const i=e.length,n=new Array(e.length),s=new Array(e.length),r=new Array(e.length);let o,a,l;o=!1,a=!1,l=!1;for(let c=0;c<i;++c){const t=e[c];n[c]=t.get(\"extrude\"),s[c]=t.get(\"tessellate\"),r[c]=t.get(\"altitudeMode\"),o=o||void 0!==n[c],a=a||void 0!==s[c],l=l||r[c]}o&&t.set(\"extrude\",n),a&&t.set(\"tessellate\",s),l&&t.set(\"altitudeMode\",r)}const ftt=W7(d9,{displayName:V7(o9),value:V7(o9)}),mtt=W7(d9,{Data:function(t,e){const i=t.getAttribute(\"name\");q7(ftt,t,e);const n=e[e.length-1];i&&n.displayName?n[i]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:null!==i?n[i]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(t,e){q7(_tt,t,e)}});function gtt(t,e){q7(mtt,t,e)}function Att(t,e){q7(A9,t,e)}const vtt=W7(d9,{Style:V7(dtt),key:V7(o9),styleUrl:V7($9)}),_tt=W7(d9,{SimpleData:function(t,e){const i=t.getAttribute(\"name\");if(null!==i){const n=o9(t);e[e.length-1][i]=n}}}),btt=W7(d9,{altitudeMode:V7(o9),minAltitude:V7(n9),maxAltitude:V7(n9),north:V7(n9),south:V7(n9),east:V7(n9),west:V7(n9)}),ytt=W7(d9,{minLodPixels:V7(n9),maxLodPixels:V7(n9),minFadeExtent:V7(n9),maxFadeExtent:V7(n9)}),wtt=W7(d9,{LinearRing:N7(K9)}),xtt=W7(d9,{LinearRing:B7(K9)});function Stt(t,e){const i=y8(e),n=[255*(4==i.length?i[3]:1),i[2],i[1],i[0]];for(let s=0;s<4;++s){const t=Math.floor(n[s]).toString(16);n[s]=1==t.length?\"0\"+t:t}h9(t,n.join(\"\"))}const Ctt=W7(d9,{Data:$7(function(t,e,i){t.setAttribute(\"name\",e.name);const n={node:t},s=e.value;\"object\"==typeof s?(null!==s&&s.displayName&&K7(n,Ctt,H7,[s.displayName],i,[\"displayName\"]),null!==s&&s.value&&K7(n,Ctt,H7,[s.value],i,[\"value\"])):K7(n,Ctt,H7,[s],i,[\"value\"])}),value:$7(function(t,e){h9(t,e)}),displayName:$7(function(t,e){!function(t,e){t.appendChild(J7().createCDATASection(e))}(t,e)})}),ktt=W7(d9,{Placemark:$7(Xtt)}),Ett=function(t,e,i){return P7(e[e.length-1].node.namespaceURI,\"Placemark\")},Mtt=j7(\"Data\"),Ttt=W7(d9,[\"href\"],W7(u9,[\"x\",\"y\",\"w\",\"h\"])),Itt=W7(d9,{href:$7(h9)},W7(u9,{x:$7(l9),y:$7(l9),w:$7(l9),h:$7(l9)})),Ptt=function(t,e,i){return P7(u9[0],\"gx:\"+i)},Ott=W7(d9,[\"scale\",\"heading\",\"Icon\",\"color\",\"hotSpot\"]),Rtt=W7(d9,{Icon:$7(function(t,e,i){const n={node:t};let s=Ttt[i[i.length-1].node.namespaceURI],r=G7(e,s);K7(n,Itt,H7,r,i,s),s=Ttt[u9[0]],r=G7(e,s),K7(n,Itt,Ptt,r,i,s)}),color:$7(Stt),heading:$7(l9),hotSpot:$7(function(t,e){t.setAttribute(\"x\",String(e.x)),t.setAttribute(\"y\",String(e.y)),t.setAttribute(\"xunits\",e.xunits),t.setAttribute(\"yunits\",e.yunits)}),scale:$7(aet)}),Dtt=W7(d9,[\"color\",\"scale\"]),Ltt=W7(d9,{color:$7(Stt),scale:$7(aet)}),Ftt=W7(d9,[\"color\",\"width\"]),Ntt=W7(d9,{color:$7(Stt),width:$7(l9)}),Btt={Point:\"Point\",LineString:\"LineString\",LinearRing:\"LinearRing\",Polygon:\"Polygon\",MultiPoint:\"MultiGeometry\",MultiLineString:\"MultiGeometry\",MultiPolygon:\"MultiGeometry\",GeometryCollection:\"MultiGeometry\"},ztt=function(t,e,i){if(t)return P7(e[e.length-1].node.namespaceURI,Btt[t.getType()])},Vtt=j7(\"Point\"),$tt=j7(\"LineString\"),Utt=j7(\"LinearRing\"),jtt=j7(\"Polygon\"),Htt=W7(d9,{LineString:$7(tet),Point:$7(tet),Polygon:$7(ret),GeometryCollection:$7(Gtt)});function Gtt(t,e,i){const n={node:t},s=e.getType();let r,o=[];\"GeometryCollection\"===s?(e.getGeometriesArrayRecursive().forEach(function(t){const e=t.getType();\"MultiPoint\"===e?o=o.concat(t.getPoints()):\"MultiLineString\"===e?o=o.concat(t.getLineStrings()):\"MultiPolygon\"===e?o=o.concat(t.getPolygons()):\"Point\"===e||\"LineString\"===e||\"Polygon\"===e?o.push(t):sz(!1,39)}),r=ztt):\"MultiPoint\"===s?(o=e.getPoints(),r=Vtt):\"MultiLineString\"===s?(o=e.getLineStrings(),r=$tt):\"MultiPolygon\"===s?(o=e.getPolygons(),r=jtt):sz(!1,39),K7(n,Htt,r,o,i)}const Wtt=W7(d9,{LinearRing:$7(tet)});function qtt(t,e,i){K7({node:t},Wtt,Utt,[e],i)}const Ytt=W7(d9,{ExtendedData:$7(function(t,e,i){const n={node:t},s=e.names,r=e.values,o=s.length;for(let a=0;a<o;a++)K7(n,Ctt,Mtt,[{name:s[a],value:r[a]}],i)}),MultiGeometry:$7(Gtt),LineString:$7(tet),LinearRing:$7(tet),Point:$7(tet),Polygon:$7(ret),Style:$7(function(t,e,i){const n={node:t},s={};if(e.pointStyles.length){const t=e.pointStyles[0].getText();t&&(s.LabelStyle=t);const i=e.pointStyles[0].getImage();i&&\"function\"==typeof i.getSrc&&(s.IconStyle=i)}if(e.lineStyles.length){const t=e.lineStyles[0].getStroke();t&&(s.LineStyle=t)}if(e.polyStyles.length){const t=e.polyStyles[0].getStroke();t&&!s.LineStyle&&(s.LineStyle=t),s.PolyStyle=e.polyStyles[0]}const r=cet[i[i.length-1].node.namespaceURI],o=G7(s,r);K7(n,het,H7,o,i,r)}),address:$7(h9),description:$7(h9),name:$7(h9),open:$7(a9),phoneNumber:$7(h9),styleUrl:$7(h9),visibility:$7(a9)}),Ztt=W7(d9,[\"name\",\"open\",\"visibility\",\"address\",\"phoneNumber\",\"description\",\"styleUrl\",\"Style\"]),Ktt=j7(\"ExtendedData\");function Xtt(t,e,i){const n={node:t};e.getId()&&t.setAttribute(\"id\",e.getId());const s=e.getProperties(),r={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};r[e.getGeometryName()]=1;const o=Object.keys(s||{}).sort().filter(function(t){return!r[t]}),a=e.getStyleFunction();if(a){const t=a(e,0);if(t){const i=Array.isArray(t)?t:[t];let n=i;if(e.getGeometry()&&(n=i.filter(function(t){const i=t.getGeometryFunction()(e);if(i){const t=i.getType();return\"GeometryCollection\"===t?i.getGeometriesArrayRecursive().filter(function(t){const e=t.getType();return\"Point\"===e||\"MultiPoint\"===e}).length:\"Point\"===t||\"MultiPoint\"===t}})),this.writeStyles_){let t=i,r=i;e.getGeometry()&&(t=i.filter(function(t){const i=t.getGeometryFunction()(e);if(i){const t=i.getType();return\"GeometryCollection\"===t?i.getGeometriesArrayRecursive().filter(function(t){const e=t.getType();return\"LineString\"===e||\"MultiLineString\"===e}).length:\"LineString\"===t||\"MultiLineString\"===t}}),r=i.filter(function(t){const i=t.getGeometryFunction()(e);if(i){const t=i.getType();return\"GeometryCollection\"===t?i.getGeometriesArrayRecursive().filter(function(t){const e=t.getType();return\"Polygon\"===e||\"MultiPolygon\"===e}).length:\"Polygon\"===t||\"MultiPolygon\"===t}})),s.Style={pointStyles:n,lineStyles:t,polyStyles:r}}if(n.length&&void 0===s.name){const t=n[0].getText();t&&(s.name=t.getText())}}}const l=Ztt[i[i.length-1].node.namespaceURI],c=G7(s,l);if(K7(n,Ytt,H7,c,i,l),o.length>0){const t=G7(s,o);K7(n,Ytt,Ktt,[{names:o,values:t}],i)}const h=i[0];let u=e.getGeometry();u&&(u=M7(u,!0,h)),K7(n,Ytt,ztt,[u],i)}const Qtt=W7(d9,[\"extrude\",\"tessellate\",\"altitudeMode\",\"coordinates\"]),Jtt=W7(d9,{extrude:$7(a9),tessellate:$7(a9),altitudeMode:$7(h9),coordinates:$7(function(t,e,i){const n=i[i.length-1],s=n.layout,r=n.stride;let o;\"XY\"==s||\"XYM\"==s?o=2:\"XYZ\"==s||\"XYZM\"==s?o=3:sz(!1,34);const a=e.length;let l=\"\";if(a>0){l+=e[0];for(let t=1;t<o;++t)l+=\",\"+e[t];for(let t=r;t<a;t+=r){l+=\" \"+e[t];for(let i=1;i<o;++i)l+=\",\"+e[t+i]}}h9(t,l)})});function tet(t,e,i){const n=e.getFlatCoordinates(),s={node:t};s.layout=e.getLayout(),s.stride=e.getStride();const r=e.getProperties();r.coordinates=n;const o=Qtt[i[i.length-1].node.namespaceURI],a=G7(r,o);K7(s,Jtt,H7,a,i,o)}const eet=W7(d9,[\"color\",\"fill\",\"outline\"]),iet=W7(d9,{outerBoundaryIs:$7(qtt),innerBoundaryIs:$7(qtt)}),net=j7(\"innerBoundaryIs\"),set=j7(\"outerBoundaryIs\");function ret(t,e,i){const n=e.getLinearRings(),s=n.shift(),r={node:t};K7(r,iet,net,n,i),K7(r,iet,set,[s],i)}const oet=W7(d9,{color:$7(Stt),fill:$7(a9),outline:$7(a9)});function aet(t,e){l9(t,Math.round(1e6*e)/1e6)}const cet=W7(d9,[\"IconStyle\",\"LabelStyle\",\"LineStyle\",\"PolyStyle\"]),het=W7(d9,{IconStyle:$7(function(t,e,i){const n={node:t},s={},r=e.getSrc(),o=e.getSize(),a=e.getImageSize(),l={href:r};if(o){l.w=o[0],l.h=o[1];const t=e.getAnchor(),i=e.getOrigin();i&&a&&0!==i[0]&&i[1]!==o[1]&&(l.x=i[0],l.y=a[1]-(i[1]+o[1])),!t||t[0]===o[0]/2&&t[1]===o[1]/2||(s.hotSpot={x:t[0],xunits:\"pixels\",y:o[1]-t[1],yunits:\"pixels\"})}s.Icon=l;let c=e.getScaleArray()[0],h=o;null===h&&(h=S9),2==h.length&&(c/=L9(h)),1!==c&&(s.scale=c);const u=e.getRotation();0!==u&&(s.heading=u);const d=e.getColor();d&&(s.color=d);const p=Ott[i[i.length-1].node.namespaceURI],f=G7(s,p);K7(n,Rtt,H7,f,i,p)}),LabelStyle:$7(function(t,e,i){const n={node:t},s={},r=e.getFill();r&&(s.color=r.getColor());const o=e.getScale();o&&1!==o&&(s.scale=o);const a=Dtt[i[i.length-1].node.namespaceURI],l=G7(s,a);K7(n,Ltt,H7,l,i,a)}),LineStyle:$7(function(t,e,i){const n={node:t},s={color:e.getColor(),width:Number(e.getWidth())||1},r=Ftt[i[i.length-1].node.namespaceURI],o=G7(s,r);K7(n,Ntt,H7,o,i,r)}),PolyStyle:$7(function(t,e,i){const n={node:t},s=e.getFill(),r=e.getStroke(),o={color:s?s.getColor():void 0,fill:!!s&&void 0,outline:!!r&&void 0},a=eet[i[i.length-1].node.namespaceURI],l=G7(o,a);K7(n,oet,H7,l,i,a)})});var uet=class extends t9{constructor(t){super(),t=t||{},D9||(b9=[255,255,255,1],T9=new h8({color:b9}),y9=[20,2],w9=\"pixels\",x9=\"pixels\",S9=[64,64],C9=\"https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png\",I9=new T8({anchor:y9,anchorOrigin:\"bottom-left\",anchorXUnits:w9,anchorYUnits:x9,crossOrigin:\"anonymous\",rotation:0,scale:L9(S9),size:S9,src:C9}),k9=\"NO_IMAGE\",P9=new U8({color:b9,width:1}),E9=new U8({color:[51,51,51,1],width:2}),O9=new k7({font:\"bold 16px Helvetica\",fill:T9,stroke:E9,scale:.8}),R9=new S7({fill:T9,image:I9,text:O9,stroke:P9,zIndex:0}),D9=[R9]),this.dataProjection=EV(\"EPSG:4326\"),this.defaultStyle_=t.defaultStyle?t.defaultStyle:D9,this.extractStyles_=void 0===t.extractStyles||t.extractStyles,this.writeStyles_=void 0===t.writeStyles||t.writeStyles,this.sharedStyles_={},this.showPointNames_=void 0===t.showPointNames||t.showPointNames,this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:\"anonymous\",this.iconUrlFunction_=t.iconUrlFunction?t.iconUrlFunction:F9,this.supportedMediaTypes=[\"application/vnd.google-earth.kml+xml\"]}readDocumentOrFolder_(t,e){const i=Y7([],W7(d9,{Document:F7(this.readDocumentOrFolder_,this),Folder:F7(this.readDocumentOrFolder_,this),Placemark:N7(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this);if(i)return i}readPlacemark_(t,e){const i=Y7({geometry:null},f9,t,e,this);if(!i)return;const n=new l8,s=t.getAttribute(\"id\");null!==s&&n.setId(s);const r=i.geometry;if(r&&M7(r,!1,e[0]),n.setGeometry(r),delete i.geometry,this.extractStyles_){const t=function(t,e,i,n,s){return function(r,o){let a=s,l=\"\",c=[];if(a){const t=r.getGeometry();if(t)if(t instanceof p8)c=t.getGeometriesArrayRecursive().filter(function(t){const e=t.getType();return\"Point\"===e||\"MultiPoint\"===e}),a=c.length>0;else{const e=t.getType();a=\"Point\"===e||\"MultiPoint\"===e}}a&&(l=r.get(\"name\"),a=a&&!!l,a&&/&[^&]+;/.test(l)&&(M9||(M9=document.createElement(\"textarea\")),M9.innerHTML=l,l=M9.value));let h=i;if(t?h=t:e&&(h=N9(e,i,n)),a){const t=function(t,e){const i=[0,0];let n=\"start\";const s=t.getImage();if(s){const t=s.getSize();if(t&&2==t.length){const e=s.getScaleArray(),r=s.getAnchor();i[0]=e[0]*(t[0]-r[0]),i[1]=e[1]*(t[1]/2-r[1]),n=\"left\"}}let r=t.getText();return r?(r=r.clone(),r.setFont(r.getFont()||O9.getFont()),r.setScale(r.getScale()||O9.getScale()),r.setFill(r.getFill()||O9.getFill()),r.setStroke(r.getStroke()||E9)):r=O9.clone(),r.setText(e),r.setOffsetX(i[0]),r.setOffsetY(i[1]),r.setTextAlign(n),new S7({image:s,text:r})}(h[0],l);return c.length>0?(t.setGeometry(new p8(c)),[t,new S7({geometry:h[0].getGeometry(),image:null,fill:h[0].getFill(),stroke:h[0].getStroke(),text:null})].concat(h.slice(1))):t}return h}}(i.Style,i.styleUrl,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);n.setStyle(t)}return delete i.Style,n.setProperties(i,!0),n}readSharedStyle_(t,e){const i=t.getAttribute(\"id\");if(null!==i){const n=dtt.call(this,t,e);if(n){let e,s=t.baseURI;(!s||\"about:blank\"==s)&&(s=window.location.href),e=s?new URL(\"#\"+i,s).href:\"#\"+i,this.sharedStyles_[e]=n}}}readSharedStyleMap_(t,e){const i=t.getAttribute(\"id\");if(null===i)return;const n=H9.call(this,t,e);if(!n)return;let s,r=t.baseURI;(!r||\"about:blank\"==r)&&(r=window.location.href),s=r?new URL(\"#\"+i,r).href:\"#\"+i,this.sharedStyles_[s]=n}readFeatureFromNode(t,e){return d9.includes(t.namespaceURI)&&this.readPlacemark_(t,[this.getReadOptions(t,e)])||null}readFeaturesFromNode(t,e){if(!d9.includes(t.namespaceURI))return[];let i;const n=t.localName;if(\"Document\"==n||\"Folder\"==n)return i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]),i||[];if(\"Placemark\"==n){const i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i?[i]:[]}if(\"kml\"==n){i=[];for(let n=t.firstElementChild;n;n=n.nextElementSibling){const t=this.readFeaturesFromNode(n,e);t&&vB(i,t)}return i}return[]}readName(t){if(t){if(\"string\"==typeof t){const e=L7(t);return this.readNameFromDocument(e)}return D7(t)?this.readNameFromDocument(t):this.readNameFromNode(t)}}readNameFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){const t=this.readNameFromNode(e);if(t)return t}}readNameFromNode(t){for(let e=t.firstElementChild;e;e=e.nextElementSibling)if(d9.includes(e.namespaceURI)&&\"name\"==e.localName)return o9(e);for(let e=t.firstElementChild;e;e=e.nextElementSibling){const t=e.localName;if(d9.includes(e.namespaceURI)&&(\"Document\"==t||\"Folder\"==t||\"Placemark\"==t||\"kml\"==t)){const t=this.readNameFromNode(e);if(t)return t}}}readNetworkLinks(t){const e=[];if(\"string\"==typeof t){const i=L7(t);vB(e,this.readNetworkLinksFromDocument(i))}else D7(t)?vB(e,this.readNetworkLinksFromDocument(t)):vB(e,this.readNetworkLinksFromNode(t));return e}readNetworkLinksFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&vB(e,this.readNetworkLinksFromNode(i));return e}readNetworkLinksFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(d9.includes(i.namespaceURI)&&\"NetworkLink\"==i.localName){const t=Y7({},m9,i,[]);e.push(t)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const t=i.localName;d9.includes(i.namespaceURI)&&(\"Document\"==t||\"Folder\"==t||\"kml\"==t)&&vB(e,this.readNetworkLinksFromNode(i))}return e}readRegion(t){const e=[];if(\"string\"==typeof t){const i=L7(t);vB(e,this.readRegionFromDocument(i))}else D7(t)?vB(e,this.readRegionFromDocument(t)):vB(e,this.readRegionFromNode(t));return e}readRegionFromDocument(t){const e=[];for(let i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&vB(e,this.readRegionFromNode(i));return e}readRegionFromNode(t){const e=[];for(let i=t.firstElementChild;i;i=i.nextElementSibling)if(d9.includes(i.namespaceURI)&&\"Region\"==i.localName){const t=Y7({},A9,i,[]);e.push(t)}for(let i=t.firstElementChild;i;i=i.nextElementSibling){const t=i.localName;d9.includes(i.namespaceURI)&&(\"Document\"==t||\"Folder\"==t||\"kml\"==t)&&vB(e,this.readRegionFromNode(i))}return e}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=P7(d9[4],\"kml\"),n=\"http://www.w3.org/2000/xmlns/\";i.setAttributeNS(n,\"xmlns:gx\",u9[0]),i.setAttributeNS(n,\"xmlns:xsi\",I7),i.setAttributeNS(I7,\"xsi:schemaLocation\",\"http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd\");const s={node:i},r={};t.length>1?r.Document=t:1==t.length&&(r.Placemark=t[0]);const o=v9[i.namespaceURI],a=G7(r,o);return K7(s,_9,H7,a,[e],o,this),i}};function det(t){const e=bV(t);return e<926?Math.round(100*e)/100+\" m\":Math.round(e/1852*100)/100+\" Nq\"}function pet(t,e){return Math.round(vV(OV(t),OV(e))/1852*100)/100}function fet(t,e){return`${met(e[0]-t[0],e[1]-t[1])}\\xb0 ${det(new D8([t,e]))}`}function met(t,e){return Math.round((450-180*Math.atan2(e,t)/Math.PI)%360)}function get(t){return\"string\"==typeof t?JSON.parse(t)||null:null!==t?t:null}var Aet=class extends E7{constructor(){super()}getType(){return\"json\"}readFeature(t,e){return this.readFeatureFromObject(get(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(get(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return kB()}readFeaturesFromObject(t,e){return kB()}readGeometry(t,e){return this.readGeometryFromObject(get(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return kB()}readProjection(t){return this.readProjectionFromObject(get(t))}readProjectionFromObject(t){return kB()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return kB()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return kB()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return kB()}};function vet(t,e){if(!t)return null;let i;switch(t.type){case\"Point\":i=function(t){return new WG(t.coordinates)}(t);break;case\"LineString\":i=function(t){return new D8(t.coordinates)}(t);break;case\"Polygon\":i=function(t){return new tW(t.coordinates)}(t);break;case\"MultiPoint\":i=function(t){return new B8(t.coordinates)}(t);break;case\"MultiLineString\":i=function(t){return new F8(t.coordinates)}(t);break;case\"MultiPolygon\":i=function(t){return new V8(t.coordinates)}(t);break;case\"GeometryCollection\":i=function(t,e){const i=t.geometries.map(function(t){return vet(t,undefined)});return new p8(i)}(t);break;default:throw new Error(\"Unsupported GeoJSON type: \"+t.type)}return M7(i,!1,e)}function _et(t,e){const i=(t=M7(t,!0,e)).getType();let n;switch(i){case\"Point\":n=function(t,e){return{type:\"Point\",coordinates:t.getCoordinates()}}(t);break;case\"LineString\":n=function(t,e){return{type:\"LineString\",coordinates:t.getCoordinates()}}(t);break;case\"Polygon\":n=function(t,e){let i;return e&&(i=e.rightHanded),{type:\"Polygon\",coordinates:t.getCoordinates(i)}}(t,e);break;case\"MultiPoint\":n=function(t,e){return{type:\"MultiPoint\",coordinates:t.getCoordinates()}}(t);break;case\"MultiLineString\":n=function(t,e){return{type:\"MultiLineString\",coordinates:t.getCoordinates()}}(t);break;case\"MultiPolygon\":n=function(t,e){let i;return e&&(i=e.rightHanded),{type:\"MultiPolygon\",coordinates:t.getCoordinates(i)}}(t,e);break;case\"GeometryCollection\":n=function(t,e){return delete(e=Object.assign({},e)).featureProjection,{type:\"GeometryCollection\",geometries:t.getGeometriesArray().map(function(t){return _et(t,e)})}}(t,e);break;case\"Circle\":n={type:\"GeometryCollection\",geometries:[]};break;default:throw new Error(\"Unsupported geometry type: \"+i)}return n}var bet=class extends Aet{constructor(t){t=t||{},super(),this.dataProjection=EV(t.dataProjection?t.dataProjection:\"EPSG:4326\"),t.featureProjection&&(this.defaultFeatureProjection=EV(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=[\"application/geo+json\",\"application/vnd.geo+json\"]}readFeatureFromObject(t,e){let i=null;i=\"Feature\"===t.type?t:{type:\"Feature\",geometry:t,properties:null};const n=vet(i.geometry,e),s=new l8;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&\"geometry_name\"in i!==void 0&&s.setGeometryName(i.geometry_name),s.setGeometry(n),\"id\"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(t,e){let i=null;if(\"FeatureCollection\"===t.type){i=[];const n=t.features;for(let t=0,s=n.length;t<s;++t)i.push(this.readFeatureFromObject(n[t],e))}else i=[this.readFeatureFromObject(t,e)];return i}readGeometryFromObject(t,e){return vet(t,e)}readProjectionFromObject(t){const e=t.crs;let i;return e?\"name\"==e.type?i=EV(e.properties.name):\"EPSG\"===e.type?i=EV(\"EPSG:\"+e.properties.code):sz(!1,36):i=this.dataProjection,i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:\"Feature\",geometry:null,properties:null},n=t.getId();if(void 0!==n&&(i.id=n),!t.hasProperties())return i;const s=t.getProperties(),r=t.getGeometry();return r&&(i.geometry=_et(r,e),delete s[t.getGeometryName()]),SB(s)||(i.properties=s),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let n=0,s=t.length;n<s;++n)i.push(this.writeFeatureObject(t[n],e));return{type:\"FeatureCollection\",features:i}}writeGeometryObject(t,e){return _et(t,this.adaptOptions(e))}};const yet=new class extends bet{writeGeometryObject(t,e){const i=(t=M7(t,!0,e)).getType();if(\"Circle\"===i)return{type:\"Circle\",center:t.getCenter(),radius:t.getRadius()};if(\"GeometryCollection\"===i){const[e,i]=t.getGeometries();if(\"Polygon\"===e.getType()&&\"Point\"===i.getType())return t.get(\"customGeom\")}return super.writeGeometryObject(t,e)}readGeometry(t,e){if(!t)return null;if(\"Circle\"===t.type){const i=new p8([new tW([]),new WG(PV(t.center))]),n=i.getGeometries(),s=eW(t.center,t.radius,128);return n[0].setCoordinates(s.getCoordinates().map(t=>t.map(t=>PV(t)))),i.setGeometries(n),i.set(\"customGeom\",{type:\"Circle\",center:t.center,radius:t.radius}),M7(i,!1,e)}return super.readGeometry(t,e)}}({featureProjection:\"EPSG:3857\",dataProjection:\"EPSG:4326\"}),wet=new S7,xet=new U8({color:\"rgba(0, 0, 0, 0.8)\"}),Cet=new h8({color:\"rgba(255, 255, 255, 0.2)\"}),ket=new h8({color:\"#000000\"}),Eet=new S7({image:new v7({radius:7,stroke:xet,fill:Cet})}),Met=new U8({color:\"rgba(195, 38, 125, 1)\",lineDash:[4,8],width:2}),Tet=new S7({image:new v7({radius:13,stroke:Met})}),Iet={Point(t){const e=new k7({text:t.name,font:\"12px sans-serif\",placement:\"point\",offsetY:-20,fill:ket}),i=[new S7({text:e,image:new v7({radius:7,stroke:new U8({color:t.color}),fill:new h8({color:`${t.color}9f`})})})];return t.editing&&i.push(Tet),i},LineString(t){const e=new k7({text:t.name,font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",offsetY:-5,overflow:!0,fill:ket}),i=new U8({color:t.color,width:2}),n=[new S7({stroke:t.editing?Met:i})],s=t.getGeometry();return s.forEachSegment((t,i)=>{n.push(new S7({geometry:new D8([t,i]),text:e}))}),t.editing&&s.getCoordinates().forEach(e=>{const s=new WG(e);n.push(new S7({geometry:s,image:new v7({radius:13,stroke:Met})})),n.push(new S7({geometry:s,image:new v7({radius:7,stroke:i,fill:new h8({color:t.color})})}))}),n},Polygon(t){const e=new k7({text:t.name,font:\"12px sans-serif\",placement:\"point\",fill:ket}),i=new U8({color:t.color}),n=[new S7({text:e,stroke:t.editing?Met:i,fill:new h8({color:`${t.color}3f`})})];return t.editing&&t.getGeometry().getCoordinates()[0].forEach(e=>{const s=new WG(e);n.push(new S7({geometry:s,image:new v7({radius:13,stroke:Met})})),n.push(new S7({geometry:s,image:new v7({radius:7,stroke:i,fill:new h8({color:t.color})})}))}),n},Circle(t){var e;const i=new k7({text:t.name,font:\"12px sans-serif\",placement:\"point\",offsetY:-20,fill:ket}),n=null!==(e=t.get(\"modifyGeometry\"))&&void 0!==e?e:t.getGeometry(),[s,r]=n.getGeometries(),o=new U8({color:t.color,width:2}),a=[new S7({geometry:r,text:i,image:t.editing?new v7({radius:7,stroke:new U8({color:t.color}),fill:new h8({color:`${t.color}9f`})}):null}),new S7({geometry:s,stroke:t.editing?Met:o})];if(t.editing){a.push(Tet);const t=yV(OV(r.getCoordinates()),n.get(\"customGeom\").radius,Math.PI/2),e=new D8([PV(OV(r.getCoordinates())),PV(t)]);a.push(new S7({geometry:e,text:new k7({text:det(e),font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",overflow:!0,fill:new h8({color:\"#000000\"})}),stroke:new U8({color:\"rgba(0, 0, 0, 0.8)\",lineDash:[10,10],width:2})}))}return a}};class Pet extends l8{constructor(t){var e,i;if(super({geometry:yet.readGeometry(t.geom)}),this.editing=!1,this.annotation=t,this.color=this.annotation.color,this.name=this.annotation.name,t.geom){const t=Iet[null!==(i=null===(e=this.getGeometry().get(\"customGeom\"))||void 0===e?void 0:e.type)&&void 0!==i?i:this.getGeometry().getType()];this.setStyle(t(this))}}updateColor(t){this.color=t,this.changed()}updateName(t){this.name=t,this.changed()}setEditingStyle(){var t,e;this.editing=!0,this.getGeometry()&&this.setStyle(Iet[null!==(e=null===(t=this.getGeometry().get(\"customGeom\"))||void 0===t?void 0:t.type)&&void 0!==e?e:this.getGeometry().getType()])}}function Oet(t,e){if(1&t){const t=$a();La(0,\"button\",9),Ga(\"click\",function(){return Fe(t),Ka().editAnnotation()}),La(1,\"mat-icon\"),xl(2,\"edit\"),Fa(),La(3,\"span\"),xl(4,\"\\xc9diter\"),Fa(),Fa()}2&t&&Ra(\"disabled\",Ka().disableEdition)}function Ret(t,e){if(1&t){const t=$a();La(0,\"button\",10),Ga(\"click\",function(){return Fe(t),Ka().deleteAnnotation()}),La(1,\"mat-icon\",11),xl(2,\"delete\"),Fa(),La(3,\"span\",12),xl(4,\"Supprimer\"),Fa(),Fa()}2&t&&Ra(\"disabled\",Ka().disableEdition)}let Det=(()=>{class t extends Gq{constructor(t,e,i,n){super(),this.annotationsService=t,this.mapConfigService=e,this.mapService=i,this.uiService=n,this.editable=!1,this.disableEdition=!1}ngOnInit(){this.ensureMandatoryInputParams(\"annotation\")}locateAnnotation(){switch(this.annotation.geom.type){case\"Point\":this.mapService.pingLocation(this.annotation.geom.coordinates),this.mapService.centerOnLonLat(this.annotation.geom.coordinates);break;case\"LineString\":case\"Polygon\":this.mapService.fitOn(yet.readGeometry(this.annotation.geom));break;case\"Circle\":this.mapService.fitOn(yet.readGeometry(this.annotation.geom).getGeometries()[0])}}editAnnotation(){this.locateAnnotation(),this.annotationsService.editAnnotation(this.annotation)}deleteAnnotation(){this.uiService.confirm({title:\"Suppression\",message:\"Confirmez-vous la suppression de cette annotation ?\",action:t=>Hp(this,void 0,void 0,function*(){t&&(yield this.annotationsService.deleteAnnotation(this.annotation.id))})})}exportAnnotation(){const t=new Pet(this.annotation);t.setProperties({name:this.annotation.name,description:this.annotation.description,color:this.annotation.color,created_at:this.annotation.created_at,updated_at:this.annotation.updated_at}),bY((new uet).writeFeatures([t],{featureProjection:\"EPSG:3857\"}),`annotation-${pU(this.annotation.name)}.kml`,\"application/vnd.google-earth.kml+xml\")}}return t.\\u0275fac=function(e){return new(e||t)(Oa(BH),Oa(qU),Oa(Pj),Oa(_H))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-annotation-item\"]],inputs:{annotation:\"annotation\",editable:\"editable\",disableEdition:\"disableEdition\"},features:[Uo],decls:18,vars:8,consts:[[1,\"d-flex\"],[\"mat-button\",\"\",\"title\",\"Localiser l'annotation\",1,\"u-flex\",3,\"click\"],[\"mat-button\",\"\",3,\"title\",\"click\"],[3,\"color\"],[\"mat-button\",\"\",\"title\",\"Actions\",3,\"matMenuTriggerFor\"],[\"menu\",\"matMenu\"],[\"mat-menu-item\",\"\",\"title\",\"\\xc9diter l'annotation\",3,\"disabled\",\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"Exporter l'annotation en KML\",3,\"disabled\",\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Supprimer l'annotation\",3,\"disabled\",\"click\",4,\"ngIf\"],[\"mat-menu-item\",\"\",\"title\",\"\\xc9diter l'annotation\",3,\"disabled\",\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Supprimer l'annotation\",3,\"disabled\",\"click\"],[\"color\",\"warn\"],[1,\"error-message\"]],template:function(t,e){if(1&t&&(La(0,\"div\",0),La(1,\"button\",1),Ga(\"click\",function(){return e.locateAnnotation()}),xl(2),Fa(),La(3,\"button\",2),Ga(\"click\",function(){return e.annotationsService.toggleAnnotationVisiblity(e.annotation)}),La(4,\"mat-icon\",3),xl(5),Fa(),Fa(),La(6,\"button\",4),La(7,\"mat-icon\"),xl(8,\"more_vert\"),Fa(),Fa(),La(9,\"mat-menu\",null,5),oa(11,Oet,5,1,\"button\",6),La(12,\"button\",7),Ga(\"click\",function(){return e.exportAnnotation()}),La(13,\"mat-icon\"),xl(14,\"file_download\"),Fa(),La(15,\"span\"),xl(16,\"Exporter en KML\"),Fa(),Fa(),oa(17,Ret,5,1,\"button\",8),Fa(),Fa()),2&t){const t=aa(10);Cr(2),Cl(\" \",e.annotation.name,\" \"),Cr(1),Ra(\"title\",e.annotation.visible?\"Masquer l'annotation\":\"Afficher l'annotation\"),Cr(1),Ra(\"color\",e.annotation.visible?\"primary\":\"default\"),Cr(1),Sl(e.annotation.visible?\"visibility\":\"visibility_off\"),Cr(1),Ra(\"matMenuTriggerFor\",t),Cr(5),Ra(\"ngIf\",e.editable),Cr(1),Ra(\"disabled\",\"Circle\"===e.annotation.geom.type),Cr(5),Ra(\"ngIf\",e.editable)}},directives:[Ly,uE,D0,T0,Vd,S0],styles:[\"\"],changeDetection:0}),t})();function Let(t,e){if(1&t){const t=$a();La(0,\"button\",6),Ga(\"click\",function(){const e=Fe(t).group;return Ka().annotationsService.createNewAnnotation(e?e.id:void 0)}),La(1,\"mat-icon\"),xl(2,\"add\"),Fa(),xl(3,\" Nouvelle annotation \"),Fa()}2&t&&Ra(\"disabled\",Ka().isEditingAnnotation)}function Fet(t,e){if(1&t&&Na(0,\"app-annotation-item\",7),2&t){const t=e.resource,i=e.group,n=Ka();Ra(\"annotation\",t)(\"editable\",!(n.isOffline||i&&\"guest\"===i.role))(\"disableEdition\",n.isEditingAnnotation)(\"@fadeAnimation\",void 0)}}let Net=(()=>{class t extends Gq{constructor(t,e,i,n){super(),this.titleService=t,this.annotationsService=e,this.mapService=i,this.offlineService=n,this.isEditingAnnotation=!1,this.isOffline=!1}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des annotations - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(this.annotationsService.editedAnnotation$.pipe(M(t=>!!t)).subscribe(t=>{this.isEditingAnnotation=t}),this.offlineService.isOffline$.subscribe(t=>{this.isOffline=t}))})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(BH),Oa(Pj),Oa(MY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-annotations-panel\"]],features:[Uo],decls:9,vars:1,consts:[[\"joyrideStep\",\"annotations-panel\",\"title\",\"Gestion des annotations\",\"text\",\"C'est ici que vous pouvez g\\xe9rer vos annotations sur la carte.\",1,\"panel\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\",\"u-flex\"],[\"resourcesKey\",\"annotations\",\"privateResourcesTitle\",\"Annotations priv\\xe9es\",\"emptyMessage\",\"Aucune annotation\",1,\"scrollable\",3,\"resources$\"],[\"createTemplate\",\"\"],[\"resourceTemplate\",\"\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",1,\"ma-2\",3,\"disabled\",\"click\"],[3,\"annotation\",\"editable\",\"disableEdition\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"h2\",2),xl(3,\"Annotations\"),Fa(),Fa(),La(4,\"app-resources-panel\",3),oa(5,Let,4,1,\"ng-template\",null,4,Lh),oa(7,Fet,1,4,\"ng-template\",null,5,Lh),Fa(),Fa()),2&t&&(Cr(4),Ra(\"resources$\",e.annotationsService.annotations$))},directives:[AF,D5,Ly,uE,Det],styles:[\"\"],data:{animation:[h5]}}),t})();var Bet=i(5709);const zet=[{group:\"UTC+14:00\",timezone:\"Pacific/Kiritimati\",label:\"Pacific/Kiritimati (+14)\"},{group:\"UTC+13:00\",timezone:\"Pacific/Apia\",label:\"Pacific/Apia (+13)\"},{group:\"UTC+13:00\",timezone:\"Pacific/Enderbury\",label:\"Pacific/Enderbury (+13)\"},{group:\"UTC+13:00\",timezone:\"Pacific/Fakaofo\",label:\"Pacific/Fakaofo (+13)\"},{group:\"UTC+13:00\",timezone:\"Pacific/Tongatapu\",label:\"Pacific/Tongatapu (+13)\"},{group:\"UTC+12:45\",timezone:\"Pacific/Chatham\",label:\"Pacific/Chatham (+12:45)\"},{group:\"UTC+12:00\",timezone:\"Antarctica/McMurdo\",label:\"Antarctica/McMurdo (NZST)\"},{group:\"UTC+12:00\",timezone:\"Asia/Anadyr\",label:\"Asia/Anadyr (+12)\"},{group:\"UTC+12:00\",timezone:\"Asia/Kamchatka\",label:\"Asia/Kamchatka (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Auckland\",label:\"Pacific/Auckland (NZST)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Fiji\",label:\"Pacific/Fiji (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Funafuti\",label:\"Pacific/Funafuti (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Kwajalein\",label:\"Pacific/Kwajalein (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Majuro\",label:\"Pacific/Majuro (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Nauru\",label:\"Pacific/Nauru (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Tarawa\",label:\"Pacific/Tarawa (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Wake\",label:\"Pacific/Wake (+12)\"},{group:\"UTC+12:00\",timezone:\"Pacific/Wallis\",label:\"Pacific/Wallis (+12)\"},{group:\"UTC+11:00\",timezone:\"Antarctica/Casey\",label:\"Antarctica/Casey (+11)\"},{group:\"UTC+11:00\",timezone:\"Antarctica/Macquarie\",label:\"Antarctica/Macquarie (+11)\"},{group:\"UTC+11:00\",timezone:\"Asia/Magadan\",label:\"Asia/Magadan (+11)\"},{group:\"UTC+11:00\",timezone:\"Asia/Sakhalin\",label:\"Asia/Sakhalin (+11)\"},{group:\"UTC+11:00\",timezone:\"Asia/Srednekolymsk\",label:\"Asia/Srednekolymsk (+11)\"},{group:\"UTC+11:00\",timezone:\"Pacific/Bougainville\",label:\"Pacific/Bougainville (+11)\"},{group:\"UTC+11:00\",timezone:\"Pacific/Efate\",label:\"Pacific/Efate (+11)\"},{group:\"UTC+11:00\",timezone:\"Pacific/Guadalcanal\",label:\"Pacific/Guadalcanal (+11)\"},{group:\"UTC+11:00\",timezone:\"Pacific/Kosrae\",label:\"Pacific/Kosrae (+11)\"},{group:\"UTC+11:00\",timezone:\"Pacific/Norfolk\",label:\"Pacific/Norfolk (+11)\"},{group:\"UTC+11:00\",timezone:\"Pacific/Noumea\",label:\"Pacific/Noumea (+11)\"},{group:\"UTC+11:00\",timezone:\"Pacific/Pohnpei\",label:\"Pacific/Pohnpei (+11)\"},{group:\"UTC+10:30\",timezone:\"Australia/Lord_Howe\",label:\"Australia/Lord Howe (+10:30)\"},{group:\"UTC+10:00\",timezone:\"Antarctica/DumontDUrville\",label:\"Antarctica/DumontDUrville (+10)\"},{group:\"UTC+10:00\",timezone:\"Asia/Ust-Nera\",label:\"Asia/Ust-Nera (+10)\"},{group:\"UTC+10:00\",timezone:\"Asia/Vladivostok\",label:\"Asia/Vladivostok (+10)\"},{group:\"UTC+10:00\",timezone:\"Australia/Brisbane\",label:\"Australia/Brisbane (AEST)\"},{group:\"UTC+10:00\",timezone:\"Australia/Currie\",label:\"Australia/Currie (AEST)\"},{group:\"UTC+10:00\",timezone:\"Australia/Hobart\",label:\"Australia/Hobart (AEST)\"},{group:\"UTC+10:00\",timezone:\"Australia/Lindeman\",label:\"Australia/Lindeman (AEST)\"},{group:\"UTC+10:00\",timezone:\"Australia/Melbourne\",label:\"Australia/Melbourne (AEST)\"},{group:\"UTC+10:00\",timezone:\"Australia/Sydney\",label:\"Australia/Sydney (AEST)\"},{group:\"UTC+10:00\",timezone:\"Pacific/Chuuk\",label:\"Pacific/Chuuk (+10)\"},{group:\"UTC+10:00\",timezone:\"Pacific/Guam\",label:\"Pacific/Guam (ChST)\"},{group:\"UTC+10:00\",timezone:\"Pacific/Port_Moresby\",label:\"Pacific/Port Moresby (+10)\"},{group:\"UTC+10:00\",timezone:\"Pacific/Saipan\",label:\"Pacific/Saipan (ChST)\"},{group:\"UTC+09:30\",timezone:\"Australia/Adelaide\",label:\"Australia/Adelaide (ACST)\"},{group:\"UTC+09:30\",timezone:\"Australia/Broken_Hill\",label:\"Australia/Broken Hill (ACST)\"},{group:\"UTC+09:30\",timezone:\"Australia/Darwin\",label:\"Australia/Darwin (ACST)\"},{group:\"UTC+09:00\",timezone:\"Asia/Chita\",label:\"Asia/Chita (+09)\"},{group:\"UTC+09:00\",timezone:\"Asia/Dili\",label:\"Asia/Dili (+09)\"},{group:\"UTC+09:00\",timezone:\"Asia/Jayapura\",label:\"Asia/Jayapura (WIT)\"},{group:\"UTC+09:00\",timezone:\"Asia/Khandyga\",label:\"Asia/Khandyga (+09)\"},{group:\"UTC+09:00\",timezone:\"Asia/Seoul\",label:\"Asia/Seoul (KST)\"},{group:\"UTC+09:00\",timezone:\"Asia/Tokyo\",label:\"Asia/Tokyo (JST)\"},{group:\"UTC+09:00\",timezone:\"Asia/Yakutsk\",label:\"Asia/Yakutsk (+09)\"},{group:\"UTC+09:00\",timezone:\"Pacific/Palau\",label:\"Pacific/Palau (+09)\"},{group:\"UTC+08:45\",timezone:\"Australia/Eucla\",label:\"Australia/Eucla (+08:45)\"},{group:\"UTC+08:30\",timezone:\"Asia/Pyongyang\",label:\"Asia/Pyongyang (KST)\"},{group:\"UTC+08:00\",timezone:\"Asia/Brunei\",label:\"Asia/Brunei (+08)\"},{group:\"UTC+08:00\",timezone:\"Asia/Choibalsan\",label:\"Asia/Choibalsan (+08)\"},{group:\"UTC+08:00\",timezone:\"Asia/Hong_Kong\",label:\"Asia/Hong Kong (HKT)\"},{group:\"UTC+08:00\",timezone:\"Asia/Irkutsk\",label:\"Asia/Irkutsk (+08)\"},{group:\"UTC+08:00\",timezone:\"Asia/Kuala_Lumpur\",label:\"Asia/Kuala Lumpur (+08)\"},{group:\"UTC+08:00\",timezone:\"Asia/Kuching\",label:\"Asia/Kuching (+08)\"},{group:\"UTC+08:00\",timezone:\"Asia/Macau\",label:\"Asia/Macau (CST)\"},{group:\"UTC+08:00\",timezone:\"Asia/Makassar\",label:\"Asia/Makassar (WITA)\"},{group:\"UTC+08:00\",timezone:\"Asia/Manila\",label:\"Asia/Manila (+08)\"},{group:\"UTC+08:00\",timezone:\"Asia/Shanghai\",label:\"Asia/Shanghai (CST)\"},{group:\"UTC+08:00\",timezone:\"Asia/Singapore\",label:\"Asia/Singapore (+08)\"},{group:\"UTC+08:00\",timezone:\"Asia/Taipei\",label:\"Asia/Taipei (CST)\"},{group:\"UTC+08:00\",timezone:\"Asia/Ulaanbaatar\",label:\"Asia/Ulaanbaatar (+08)\"},{group:\"UTC+08:00\",timezone:\"Australia/Perth\",label:\"Australia/Perth (AWST)\"},{group:\"UTC+07:00\",timezone:\"Antarctica/Davis\",label:\"Antarctica/Davis (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Bangkok\",label:\"Asia/Bangkok (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Barnaul\",label:\"Asia/Barnaul (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Ho_Chi_Minh\",label:\"Asia/Ho Chi Minh (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Hovd\",label:\"Asia/Hovd (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Jakarta\",label:\"Asia/Jakarta (WIB)\"},{group:\"UTC+07:00\",timezone:\"Asia/Krasnoyarsk\",label:\"Asia/Krasnoyarsk (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Novokuznetsk\",label:\"Asia/Novokuznetsk (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Novosibirsk\",label:\"Asia/Novosibirsk (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Phnom_Penh\",label:\"Asia/Phnom_Penh (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Pontianak\",label:\"Asia/Pontianak (WIB)\"},{group:\"UTC+07:00\",timezone:\"Asia/Tomsk\",label:\"Asia/Tomsk (+07)\"},{group:\"UTC+07:00\",timezone:\"Asia/Vientiane\",label:\"Asia/Vientiane (+07)\"},{group:\"UTC+07:00\",timezone:\"Indian/Christmas\",label:\"Indian/Christmas (+07)\"},{group:\"UTC+06:30\",timezone:\"Asia/Yangon\",label:\"Asia/Yangon (+06:30)\"},{group:\"UTC+06:30\",timezone:\"Indian/Cocos\",label:\"Indian/Cocos (+06:30)\"},{group:\"UTC+06:00\",timezone:\"Antarctica/Vostok\",label:\"Antarctica/Vostok (+06)\"},{group:\"UTC+06:00\",timezone:\"Asia/Almaty\",label:\"Asia/Almaty (+06)\"},{group:\"UTC+06:00\",timezone:\"Asia/Bishkek\",label:\"Asia/Bishkek (+06)\"},{group:\"UTC+06:00\",timezone:\"Asia/Dhaka\",label:\"Asia/Dhaka (+06)\"},{group:\"UTC+06:00\",timezone:\"Asia/Omsk\",label:\"Asia/Omsk (+06)\"},{group:\"UTC+06:00\",timezone:\"Asia/Qyzylorda\",label:\"Asia/Qyzylorda (+06)\"},{group:\"UTC+06:00\",timezone:\"Asia/Thimphu\",label:\"Asia/Thimphu (+06)\"},{group:\"UTC+06:00\",timezone:\"Asia/Urumqi\",label:\"Asia/Urumqi (+06)\"},{group:\"UTC+06:00\",timezone:\"Indian/Chagos\",label:\"Indian/Chagos (+06)\"},{group:\"UTC+05:45\",timezone:\"Asia/Kathmandu\",label:\"Asia/Kathmandu (+05:45)\"},{group:\"UTC+05:30\",timezone:\"Asia/Colombo\",label:\"Asia/Colombo (+05:30)\"},{group:\"UTC+05:30\",timezone:\"Asia/Kolkata\",label:\"Asia/Kolkata (IST)\"},{group:\"UTC+05:00\",timezone:\"Antarctica/Mawson\",label:\"Antarctica/Mawson (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Aqtau\",label:\"Asia/Aqtau (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Aqtobe\",label:\"Asia/Aqtobe (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Ashgabat\",label:\"Asia/Ashgabat (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Atyrau\",label:\"Asia/Atyrau (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Dushanbe\",label:\"Asia/Dushanbe (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Karachi\",label:\"Asia/Karachi (PKT)\"},{group:\"UTC+05:00\",timezone:\"Asia/Oral\",label:\"Asia/Oral (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Samarkand\",label:\"Asia/Samarkand (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Tashkent\",label:\"Asia/Tashkent (+05)\"},{group:\"UTC+05:00\",timezone:\"Asia/Yekaterinburg\",label:\"Asia/Yekaterinburg (+05)\"},{group:\"UTC+05:00\",timezone:\"Indian/Kerguelen\",label:\"Indian/Kerguelen (+05)\"},{group:\"UTC+05:00\",timezone:\"Indian/Maldives\",label:\"Indian/Maldives (+05)\"},{group:\"UTC+04:30\",timezone:\"Asia/Kabul\",label:\"Asia/Kabul (+04:30)\"},{group:\"UTC+04:30\",timezone:\"Asia/Tehran\",label:\"Asia/Tehran (+04:30)\"},{group:\"UTC+04:00\",timezone:\"Asia/Baku\",label:\"Asia/Baku (+04)\"},{group:\"UTC+04:00\",timezone:\"Asia/Dubai\",label:\"Asia/Dubai (+04)\"},{group:\"UTC+04:00\",timezone:\"Asia/Muscat\",label:\"Asia/Muscat (+04)\"},{group:\"UTC+04:00\",timezone:\"Asia/Tbilisi\",label:\"Asia/Tbilisi (+04)\"},{group:\"UTC+04:00\",timezone:\"Asia/Yerevan\",label:\"Asia/Yerevan (+04)\"},{group:\"UTC+04:00\",timezone:\"Europe/Astrakhan\",label:\"Europe/Astrakhan (+04)\"},{group:\"UTC+04:00\",timezone:\"Europe/Samara\",label:\"Europe/Samara (+04)\"},{group:\"UTC+04:00\",timezone:\"Europe/Saratov\",label:\"Europe/Saratov (+04)\"},{group:\"UTC+04:00\",timezone:\"Europe/Ulyanovsk\",label:\"Europe/Ulyanovsk (+04)\"},{group:\"UTC+04:00\",timezone:\"Indian/Mahe\",label:\"Indian/Mahe (+04)\"},{group:\"UTC+04:00\",timezone:\"Indian/Mauritius\",label:\"Indian/Mauritius (+04)\"},{group:\"UTC+04:00\",timezone:\"Indian/Reunion\",label:\"Indian/Reunion (+04)\"},{group:\"UTC+03:00\",timezone:\"Africa/Addis_Ababa\",label:\"Africa/Addis Ababa (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Asmara\",label:\"Africa/Asmara (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Dar_es_Salaam\",label:\"Africa/Dar es Salaam (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Djibouti\",label:\"Africa/Djibouti (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Juba\",label:\"Africa/Juba (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Kampala\",label:\"Africa/Kampala (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Khartoum\",label:\"Africa/Khartoum (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Mogadishu\",label:\"Africa/Mogadishu (EAT)\"},{group:\"UTC+03:00\",timezone:\"Africa/Nairobi\",label:\"Africa/Nairobi (EAT)\"},{group:\"UTC+03:00\",timezone:\"Antarctica/Syowa\",label:\"Antarctica/Syowa (+03)\"},{group:\"UTC+03:00\",timezone:\"Asia/Aden\",label:\"Asia/Aden (+03)\"},{group:\"UTC+03:00\",timezone:\"Asia/Amman\",label:\"Asia/Amman (EEST)\"},{group:\"UTC+03:00\",timezone:\"Asia/Baghdad\",label:\"Asia/Baghdad (+03)\"},{group:\"UTC+03:00\",timezone:\"Asia/Bahrain\",label:\"Asia/Bahrain (+03)\"},{group:\"UTC+03:00\",timezone:\"Asia/Beirut\",label:\"Asia/Beirut (EEST)\"},{group:\"UTC+03:00\",timezone:\"Asia/Damascus\",label:\"Asia/Damascus (EEST)\"},{group:\"UTC+03:00\",timezone:\"Asia/Famagusta\",label:\"Asia/Famagusta (+03)\"},{group:\"UTC+03:00\",timezone:\"Asia/Gaza\",label:\"Asia/Gaza (EEST)\"},{group:\"UTC+03:00\",timezone:\"Asia/Hebron\",label:\"Asia/Hebron (EEST)\"},{group:\"UTC+03:00\",timezone:\"Asia/Jerusalem\",label:\"Asia/Jerusalem (IDT)\"},{group:\"UTC+03:00\",timezone:\"Asia/Kuwait\",label:\"Asia/Kuwait (+03)\"},{group:\"UTC+03:00\",timezone:\"Asia/Nicosia\",label:\"Asia/Nicosia (EEST)\"},{group:\"UTC+03:00\",timezone:\"Asia/Qatar\",label:\"Asia/Qatar (+03)\"},{group:\"UTC+03:00\",timezone:\"Asia/Riyadh\",label:\"Asia/Riyadh (+03)\"},{group:\"UTC+03:00\",timezone:\"Europe/Athens\",label:\"Europe/Athens (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Bucharest\",label:\"Europe/Bucharest (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Chisinau\",label:\"Europe/Chisinau (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Helsinki\",label:\"Europe/Helsinki (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Istanbul\",label:\"Europe/Istanbul (+03)\"},{group:\"UTC+03:00\",timezone:\"Europe/Kiev\",label:\"Europe/Kiev (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Kirov\",label:\"Europe/Kirov (+03)\"},{group:\"UTC+03:00\",timezone:\"Europe/Mariehamn\",label:\"Europe/Mariehamn (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Minsk\",label:\"Europe/Minsk (+03)\"},{group:\"UTC+03:00\",timezone:\"Europe/Moscow\",label:\"Europe/Moscow (MSK)\"},{group:\"UTC+03:00\",timezone:\"Europe/Riga\",label:\"Europe/Riga (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Simferopol\",label:\"Europe/Simferopol (MSK)\"},{group:\"UTC+03:00\",timezone:\"Europe/Sofia\",label:\"Europe/Sofia (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Tallinn\",label:\"Europe/Tallinn (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Uzhgorod\",label:\"Europe/Uzhgorod (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Vilnius\",label:\"Europe/Vilnius (EEST)\"},{group:\"UTC+03:00\",timezone:\"Europe/Volgograd\",label:\"Europe/Volgograd (+03)\"},{group:\"UTC+03:00\",timezone:\"Europe/Zaporozhye\",label:\"Europe/Zaporozhye (EEST)\"},{group:\"UTC+03:00\",timezone:\"Indian/Antananarivo\",label:\"Indian/Antananarivo (EAT)\"},{group:\"UTC+03:00\",timezone:\"Indian/Comoro\",label:\"Indian/Comoro (EAT)\"},{group:\"UTC+03:00\",timezone:\"Indian/Mayotte\",label:\"Indian/Mayotte (EAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Blantyre\",label:\"Africa/Blantyre (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Bujumbura\",label:\"Africa/Bujumbura (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Cairo\",label:\"Africa/Cairo (EET)\"},{group:\"UTC+02:00\",timezone:\"Africa/Ceuta\",label:\"Africa/Ceuta (CEST)\"},{group:\"UTC+02:00\",timezone:\"Africa/Gaborone\",label:\"Africa/Gaborone (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Harare\",label:\"Africa/Harare (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Johannesburg\",label:\"Africa/Johannesburg (SAST)\"},{group:\"UTC+02:00\",timezone:\"Africa/Kigali\",label:\"Africa/Kigali (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Lubumbashi\",label:\"Africa/Lubumbashi (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Lusaka\",label:\"Africa/Lusaka (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Maputo\",label:\"Africa/Maputo (CAT)\"},{group:\"UTC+02:00\",timezone:\"Africa/Maseru\",label:\"Africa/Maseru (SAST)\"},{group:\"UTC+02:00\",timezone:\"Africa/Mbabane\",label:\"Africa/Mbabane (SAST)\"},{group:\"UTC+02:00\",timezone:\"Africa/Tripoli\",label:\"Africa/Tripoli (EET)\"},{group:\"UTC+02:00\",timezone:\"Antarctica/Troll\",label:\"Antarctica/Troll (+02)\"},{group:\"UTC+02:00\",timezone:\"Arctic/Longyearbyen\",label:\"Arctic/Longyearbyen (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Amsterdam\",label:\"Europe/Amsterdam (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Andorra\",label:\"Europe/Andorra (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Belgrade\",label:\"Europe/Belgrade (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Berlin\",label:\"Europe/Berlin (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Bratislava\",label:\"Europe/Bratislava (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Brussels\",label:\"Europe/Brussels (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Budapest\",label:\"Europe/Budapest (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Busingen\",label:\"Europe/Busingen (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Copenhagen\",label:\"Europe/Copenhagen (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Gibraltar\",label:\"Europe/Gibraltar (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Kaliningrad\",label:\"Europe/Kaliningrad (EET)\"},{group:\"UTC+02:00\",timezone:\"Europe/Ljubljana\",label:\"Europe/Ljubljana (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Luxembourg\",label:\"Europe/Luxembourg (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Madrid\",label:\"Europe/Madrid (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Malta\",label:\"Europe/Malta (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Monaco\",label:\"Europe/Monaco (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Oslo\",label:\"Europe/Oslo (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Paris\",label:\"Europe/Paris (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Podgorica\",label:\"Europe/Podgorica (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Prague\",label:\"Europe/Prague (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Rome\",label:\"Europe/Rome (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/San_Marino\",label:\"Europe/San Marino (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Sarajevo\",label:\"Europe/Sarajevo (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Skopje\",label:\"Europe/Skopje (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Stockholm\",label:\"Europe/Stockholm (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Tirane\",label:\"Europe/Tirane (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Vaduz\",label:\"Europe/Vaduz (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Vatican\",label:\"Europe/Vatican (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Vienna\",label:\"Europe/Vienna (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Warsaw\",label:\"Europe/Warsaw (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Zagreb\",label:\"Europe/Zagreb (CEST)\"},{group:\"UTC+02:00\",timezone:\"Europe/Zurich\",label:\"Europe/Zurich (CEST)\"},{group:\"UTC+01:00\",timezone:\"Africa/Algiers\",label:\"Africa/Algiers (CET)\"},{group:\"UTC+01:00\",timezone:\"Africa/Bangui\",label:\"Africa/Bangui (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Brazzaville\",label:\"Africa/Brazzaville (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Casablanca\",label:\"Africa/Casablanca (WEST)\"},{group:\"UTC+01:00\",timezone:\"Africa/Douala\",label:\"Africa/Douala (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/El_Aaiun\",label:\"Africa/El Aaiun (WEST)\"},{group:\"UTC+01:00\",timezone:\"Africa/Kinshasa\",label:\"Africa/Kinshasa (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Lagos\",label:\"Africa/Lagos (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Libreville\",label:\"Africa/Libreville (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Luanda\",label:\"Africa/Luanda (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Malabo\",label:\"Africa/Malabo (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Ndjamena\",label:\"Africa/Ndjamena (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Niamey\",label:\"Africa/Niamey (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Porto-Novo\",label:\"Africa/Porto-Novo (WAT)\"},{group:\"UTC+01:00\",timezone:\"Africa/Tunis\",label:\"Africa/Tunis (CET)\"},{group:\"UTC+01:00\",timezone:\"Africa/Windhoek\",label:\"Africa/Windhoek (WAT)\"},{group:\"UTC+01:00\",timezone:\"Atlantic/Canary\",label:\"Atlantic/Canary (WEST)\"},{group:\"UTC+01:00\",timezone:\"Atlantic/Faroe\",label:\"Atlantic/Faroe (WEST)\"},{group:\"UTC+01:00\",timezone:\"Atlantic/Madeira\",label:\"Atlantic/Madeira (WEST)\"},{group:\"UTC+01:00\",timezone:\"Europe/Dublin\",label:\"Europe/Dublin (IST)\"},{group:\"UTC+01:00\",timezone:\"Europe/Guernsey\",label:\"Europe/Guernsey (BST)\"},{group:\"UTC+01:00\",timezone:\"Europe/Isle_of_Man\",label:\"Europe/Isle of Man (BST)\"},{group:\"UTC+01:00\",timezone:\"Europe/Jersey\",label:\"Europe/Jersey (BST)\"},{group:\"UTC+01:00\",timezone:\"Europe/Lisbon\",label:\"Europe/Lisbon (WEST)\"},{group:\"UTC+01:00\",timezone:\"Europe/London\",label:\"Europe/London (BST)\"},{group:\"UTC\",timezone:\"Africa/Abidjan\",label:\"Africa/Abidjan (GMT)\"},{group:\"UTC\",timezone:\"Africa/Accra\",label:\"Africa/Accra (GMT)\"},{group:\"UTC\",timezone:\"Africa/Bamako\",label:\"Africa/Bamako (GMT)\"},{group:\"UTC\",timezone:\"Africa/Banjul\",label:\"Africa/Banjul (GMT)\"},{group:\"UTC\",timezone:\"Africa/Bissau\",label:\"Africa/Bissau (GMT)\"},{group:\"UTC\",timezone:\"Africa/Conakry\",label:\"Africa/Conakry (GMT)\"},{group:\"UTC\",timezone:\"Africa/Dakar\",label:\"Africa/Dakar (GMT)\"},{group:\"UTC\",timezone:\"Africa/Freetown\",label:\"Africa/Freetown (GMT)\"},{group:\"UTC\",timezone:\"Africa/Lome\",label:\"Africa/Lome (GMT)\"},{group:\"UTC\",timezone:\"Africa/Monrovia\",label:\"Africa/Monrovia (GMT)\"},{group:\"UTC\",timezone:\"Africa/Nouakchott\",label:\"Africa/Nouakchott (GMT)\"},{group:\"UTC\",timezone:\"Africa/Ouagadougou\",label:\"Africa/Ouagadougou (GMT)\"},{group:\"UTC\",timezone:\"Africa/Sao_Tome\",label:\"Africa/Sao_Tome (GMT)\"},{group:\"UTC\",timezone:\"America/Danmarkshavn\",label:\"America/Danmarkshavn (GMT)\"},{group:\"UTC\",timezone:\"America/Scoresbysund\",label:\"America/Scoresbysund (+00)\"},{group:\"UTC\",timezone:\"Atlantic/Azores\",label:\"Atlantic/Azores (+00)\"},{group:\"UTC\",timezone:\"Atlantic/Reykjavik\",label:\"Atlantic/Reykjavik (GMT)\"},{group:\"UTC\",timezone:\"Atlantic/St_Helena\",label:\"Atlantic/St_Helena (GMT)\"},{group:\"UTC\",timezone:\"UTC\",label:\"UTC (UTC)\"},{group:\"UTC-01:00\",timezone:\"Atlantic/Cape_Verde\",label:\"Atlantic/Cape Verde (-01)\"},{group:\"UTC-02:00\",timezone:\"America/Godthab\",label:\"America/Godthab (-02)\"},{group:\"UTC-02:00\",timezone:\"America/Miquelon\",label:\"America/Miquelon (-02)\"},{group:\"UTC-02:00\",timezone:\"America/Noronha\",label:\"America/Noronha (-02)\"},{group:\"UTC-02:00\",timezone:\"Atlantic/South_Georgia\",label:\"Atlantic/South Georgia (-02)\"},{group:\"UTC-02:30\",timezone:\"America/St_Johns\",label:\"America/St Johns (NDT)\"},{group:\"UTC-03:00\",timezone:\"America/Araguaina\",label:\"America/Araguaina (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Buenos_Aires\",label:\"America/Argentina/Buenos Aires (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Catamarca\",label:\"America/Argentina/Catamarca (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Cordoba\",label:\"America/Argentina/Cordoba (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Jujuy\",label:\"America/Argentina/Jujuy (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/La_Rioja\",label:\"America/Argentina/La Rioja (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Mendoza\",label:\"America/Argentina/Mendoza (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Rio_Gallegos\",label:\"America/Argentina/Rio Gallegos (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Salta\",label:\"America/Argentina/Salta (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/San_Juan\",label:\"America/Argentina/San Juan (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/San_Luis\",label:\"America/Argentina/San Luis (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Tucuman\",label:\"America/Argentina/Tucuman (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Argentina/Ushuaia\",label:\"America/Argentina/Ushuaia (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Bahia\",label:\"America/Bahia (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Belem\",label:\"America/Belem (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Cayenne\",label:\"America/Cayenne (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Fortaleza\",label:\"America/Fortaleza (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Glace_Bay\",label:\"America/Glace_Bay (ADT)\"},{group:\"UTC-03:00\",timezone:\"America/Goose_Bay\",label:\"America/Goose_Bay (ADT)\"},{group:\"UTC-03:00\",timezone:\"America/Halifax\",label:\"America/Halifax (ADT)\"},{group:\"UTC-03:00\",timezone:\"America/Maceio\",label:\"America/Maceio (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Moncton\",label:\"America/Moncton (ADT)\"},{group:\"UTC-03:00\",timezone:\"America/Montevideo\",label:\"America/Montevideo (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Paramaribo\",label:\"America/Paramaribo (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Punta_Arenas\",label:\"America/Punta Arenas (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Recife\",label:\"America/Recife (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Santarem\",label:\"America/Santarem (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Sao_Paulo\",label:\"America/Sao Paulo (-03)\"},{group:\"UTC-03:00\",timezone:\"America/Thule\",label:\"America/Thule (ADT)\"},{group:\"UTC-03:00\",timezone:\"Antarctica/Palmer\",label:\"Antarctica/Palmer (-03)\"},{group:\"UTC-03:00\",timezone:\"Antarctica/Rothera\",label:\"Antarctica/Rothera (-03)\"},{group:\"UTC-03:00\",timezone:\"Atlantic/Bermuda\",label:\"Atlantic/Bermuda (ADT)\"},{group:\"UTC-03:00\",timezone:\"Atlantic/Stanley\",label:\"Atlantic/Stanley (-03)\"},{group:\"UTC-04:00\",timezone:\"America/Anguilla\",label:\"America/Anguilla (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Antigua\",label:\"America/Antigua (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Aruba\",label:\"America/Aruba (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Asuncion\",label:\"America/Asuncion (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Barbados\",label:\"America/Barbados (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Blanc-Sablon\",label:\"America/Blanc-Sablon (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Boa_Vista\",label:\"America/Boa Vista (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Campo_Grande\",label:\"America/Campo Grande (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Caracas\",label:\"America/Caracas (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Cuiaba\",label:\"America/Cuiaba (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Curacao\",label:\"America/Curacao (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Detroit\",label:\"America/Detroit (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Dominica\",label:\"America/Dominica (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Grand_Turk\",label:\"America/Grand Turk (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Grenada\",label:\"America/Grenada (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Guadeloupe\",label:\"America/Guadeloupe (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Guyana\",label:\"America/Guyana (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Havana\",label:\"America/Havana (CDT)\"},{group:\"UTC-04:00\",timezone:\"America/Indiana/Indianapolis\",label:\"America/Indiana/Indianapolis (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Indiana/Marengo\",label:\"America/Indiana/Marengo (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Indiana/Petersburg\",label:\"America/Indiana/Petersburg (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Indiana/Vevay\",label:\"America/Indiana/Vevay (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Indiana/Vincennes\",label:\"America/Indiana/Vincennes (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Indiana/Winamac\",label:\"America/Indiana/Winamac (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Iqaluit\",label:\"America/Iqaluit (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Kentucky/Louisville\",label:\"America/Kentucky/Louisville (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Kentucky/Monticello\",label:\"America/Kentucky/Monticello (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Kralendijk\",label:\"America/Kralendijk (AST)\"},{group:\"UTC-04:00\",timezone:\"America/La_Paz\",label:\"America/La_Paz (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Lower_Princes\",label:\"America/Lower Princes (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Manaus\",label:\"America/Manaus (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Marigot\",label:\"America/Marigot (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Martinique\",label:\"America/Martinique (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Montserrat\",label:\"America/Montserrat (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Nassau\",label:\"America/Nassau (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/New_York\",label:\"America/New_York (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Nipigon\",label:\"America/Nipigon (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Pangnirtung\",label:\"America/Pangnirtung (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Port-au-Prince\",label:\"America/Port-au-Prince (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Port_of_Spain\",label:\"America/Port of Spain (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Porto_Velho\",label:\"America/Porto Velho (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Puerto_Rico\",label:\"America/Puerto Rico (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Santiago\",label:\"America/Santiago (-04)\"},{group:\"UTC-04:00\",timezone:\"America/Santo_Domingo\",label:\"America/Santo Domingo (AST)\"},{group:\"UTC-04:00\",timezone:\"America/St_Barthelemy\",label:\"America/St Barthelemy (AST)\"},{group:\"UTC-04:00\",timezone:\"America/St_Kitts\",label:\"America/St Kitts (AST)\"},{group:\"UTC-04:00\",timezone:\"America/St_Lucia\",label:\"America/St Lucia (AST)\"},{group:\"UTC-04:00\",timezone:\"America/St_Thomas\",label:\"America/St Thomas (AST)\"},{group:\"UTC-04:00\",timezone:\"America/St_Vincent\",label:\"America/St Vincent (AST)\"},{group:\"UTC-04:00\",timezone:\"America/Thunder_Bay\",label:\"America/Thunder Bay (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Toronto\",label:\"America/Toronto (EDT)\"},{group:\"UTC-04:00\",timezone:\"America/Tortola\",label:\"America/Tortola (AST)\"},{group:\"UTC-05:00\",timezone:\"America/Atikokan\",label:\"America/Atikokan (EST)\"},{group:\"UTC-05:00\",timezone:\"America/Bahia_Banderas\",label:\"America/Bahia Banderas (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Bogota\",label:\"America/Bogota (-05)\"},{group:\"UTC-05:00\",timezone:\"America/Cancun\",label:\"America/Cancun (EST)\"},{group:\"UTC-05:00\",timezone:\"America/Cayman\",label:\"America/Cayman (EST)\"},{group:\"UTC-05:00\",timezone:\"America/Chicago\",label:\"America/Chicago (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Eirunepe\",label:\"America/Eirunepe (-05)\"},{group:\"UTC-05:00\",timezone:\"America/Guayaquil\",label:\"America/Guayaquil (-05)\"},{group:\"UTC-05:00\",timezone:\"America/Indiana/Knox\",label:\"America/Indiana/Knox (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Indiana/Tell_City\",label:\"America/Indiana/Tell City (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Jamaica\",label:\"America/Jamaica (EST)\"},{group:\"UTC-05:00\",timezone:\"America/Lima\",label:\"America/Lima (-05)\"},{group:\"UTC-05:00\",timezone:\"America/Matamoros\",label:\"America/Matamoros (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Menominee\",label:\"America/Menominee (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Merida\",label:\"America/Merida (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Mexico_City\",label:\"America/Mexico City (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Monterrey\",label:\"America/Monterrey (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/North_Dakota/Beulah\",label:\"America/North Dakota/Beulah (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/North_Dakota/Center\",label:\"America/North Dakota/Center (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/North_Dakota/New_Salem\",label:\"America/North Dakota/New Salem (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Panama\",label:\"America/Panama (EST)\"},{group:\"UTC-05:00\",timezone:\"America/Rainy_River\",label:\"America/Rainy River (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Rankin_Inlet\",label:\"America/Rankin Inlet (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Resolute\",label:\"America/Resolute (CDT)\"},{group:\"UTC-05:00\",timezone:\"America/Rio_Branco\",label:\"America/Rio Branco (-05)\"},{group:\"UTC-05:00\",timezone:\"America/Winnipeg\",label:\"America/Winnipeg (CDT)\"},{group:\"UTC-06:00\",timezone:\"America/Belize\",label:\"America/Belize (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Boise\",label:\"America/Boise (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/Cambridge_Bay\",label:\"America/Cambridge Bay (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/Chihuahua\",label:\"America/Chihuahua (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/Costa_Rica\",label:\"America/Costa Rica (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Denver\",label:\"America/Denver (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/Edmonton\",label:\"America/Edmonton (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/El_Salvador\",label:\"America/El Salvador (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Guatemala\",label:\"America/Guatemala (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Inuvik\",label:\"America/Inuvik (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/Managua\",label:\"America/Managua (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Mazatlan\",label:\"America/Mazatlan (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/Ojinaga\",label:\"America/Ojinaga (MDT)\"},{group:\"UTC-06:00\",timezone:\"America/Regina\",label:\"America/Regina (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Swift_Current\",label:\"America/Swift Current (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Tegucigalpa\",label:\"America/Tegucigalpa (CST)\"},{group:\"UTC-06:00\",timezone:\"America/Yellowknife\",label:\"America/Yellowknife (MDT)\"},{group:\"UTC-06:00\",timezone:\"Pacific/Easter\",label:\"Pacific/Easter (-06)\"},{group:\"UTC-06:00\",timezone:\"Pacific/Galapagos\",label:\"Pacific/Galapagos (-06)\"},{group:\"UTC-07:00\",timezone:\"America/Creston\",label:\"America/Creston (MST)\"},{group:\"UTC-07:00\",timezone:\"America/Dawson\",label:\"America/Dawson (PDT)\"},{group:\"UTC-07:00\",timezone:\"America/Dawson_Creek\",label:\"America/Dawson Creek (MST)\"},{group:\"UTC-07:00\",timezone:\"America/Fort_Nelson\",label:\"America/Fort Nelson (MST)\"},{group:\"UTC-07:00\",timezone:\"America/Hermosillo\",label:\"America/Hermosillo (MST)\"},{group:\"UTC-07:00\",timezone:\"America/Los_Angeles\",label:\"America/Los Angeles (PDT)\"},{group:\"UTC-07:00\",timezone:\"America/Phoenix\",label:\"America/Phoenix (MST)\"},{group:\"UTC-07:00\",timezone:\"America/Tijuana\",label:\"America/Tijuana (PDT)\"},{group:\"UTC-07:00\",timezone:\"America/Vancouver\",label:\"America/Vancouver (PDT)\"},{group:\"UTC-07:00\",timezone:\"America/Whitehorse\",label:\"America/Whitehorse (PDT)\"},{group:\"UTC-08:00\",timezone:\"America/Anchorage\",label:\"America/Anchorage (AKDT)\"},{group:\"UTC-08:00\",timezone:\"America/Juneau\",label:\"America/Juneau (AKDT)\"},{group:\"UTC-08:00\",timezone:\"America/Metlakatla\",label:\"America/Metlakatla (AKDT)\"},{group:\"UTC-08:00\",timezone:\"America/Nome\",label:\"America/Nome (AKDT)\"},{group:\"UTC-08:00\",timezone:\"America/Sitka\",label:\"America/Sitka (AKDT)\"},{group:\"UTC-08:00\",timezone:\"America/Yakutat\",label:\"America/Yakutat (AKDT)\"},{group:\"UTC-08:00\",timezone:\"Pacific/Pitcairn\",label:\"Pacific/Pitcairn (-08)\"},{group:\"UTC-09:00\",timezone:\"America/Adak\",label:\"America/Adak (HDT)\"},{group:\"UTC-09:00\",timezone:\"Pacific/Gambier\",label:\"Pacific/Gambier (-09)\"},{group:\"UTC-09:30\",timezone:\"Pacific/Marquesas\",label:\"Pacific/Marquesas (-09:30)\"},{group:\"UTC-10:00\",timezone:\"Pacific/Honolulu\",label:\"Pacific/Honolulu (HST)\"},{group:\"UTC-10:00\",timezone:\"Pacific/Rarotonga\",label:\"Pacific/Rarotonga (-10)\"},{group:\"UTC-10:00\",timezone:\"Pacific/Tahiti\",label:\"Pacific/Tahiti (-10)\"},{group:\"UTC-11:00\",timezone:\"Pacific/Midway\",label:\"Pacific/Midway (SST)\"},{group:\"UTC-11:00\",timezone:\"Pacific/Niue\",label:\"Pacific/Niue (-11)\"},{group:\"UTC-11:00\",timezone:\"Pacific/Pago_Pago\",label:\"Pacific/Pago Pago (SST)\"}].reduce((t,e)=>(t[e.timezone]=e.group.substring(3)||\"00:00\",t),{});function Vet(t,e){if(1&t){const t=$a();La(0,\"button\",5),Ga(\"click\",function(){return Fe(t),Ka().locate()}),Na(1,\"app-flag\",6),La(2,\"span\",7),xl(3),Fa(),Fa()}if(2&t){const t=Ka();Cr(1),Ra(\"flag\",t.step.place.countryCode),Cr(2),Sl(t.step.place.name)}}function $et(t,e){if(1&t&&(La(0,\"button\",8),Na(1,\"app-flag\",6),La(2,\"span\",7),xl(3),Fa(),Fa()),2&t){const t=Ka();Ra(\"disabled\",!0),Cr(1),Ra(\"flag\",t.step.place.countryCode),Cr(2),Sl(t.step.place.name)}}function Uet(t,e){1&t&&(La(0,\"span\"),xl(1,\"(Estim\\xe9)\"),Fa())}function jet(t,e){if(1&t&&(La(0,\"span\",9),xl(1),ch(2,\"date\"),oa(3,Uet,2,0,\"span\",10),Fa()),2&t){const t=Ka();Cr(1),Cl(\" \",dh(2,2,t.step.date.value,\"yyyy-MM-dd HH:mm z\",t.step.date.timezoneOffset),\" \"),Cr(2),Ra(\"ngIf\",\"Estimated\"===t.step.date.type)}}let Het=(()=>{class t extends Gq{constructor(t){super(),this.mapService=t}ngOnInit(){this.step.date&&(this.step.date.timezoneOffset=zet[this.step.place.timeZoneId])}locate(){const[t,e]=this.step.place.latLong.split(\",\").map(t=>+t);this.mapService.pingLocation([e,t]),this.mapService.centerOnLonLat([e,t])}locateAndZoom(){const[t,e]=this.step.place.latLong.split(\",\").map(t=>+t);this.mapService.locate([e,t])}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-shipment-step\"]],inputs:{step:\"step\",label:\"label\",labelTitle:\"labelTitle\"},features:[Uo],decls:6,vars:5,consts:[[1,\"d-flex-center\",\"px-2\"],[1,\"shipment-step__label\",3,\"title\"],[\"mat-button\",\"\",\"class\",\"mx-2\",\"title\",\"Localiser le port\",3,\"click\",4,\"ngIf\"],[\"mat-button\",\"\",\"class\",\"mx-2\",\"title\",\"Localisation non disponible\",3,\"disabled\",4,\"ngIf\"],[\"class\",\"shipment-step__time\",4,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Localiser le port\",1,\"mx-2\",3,\"click\"],[3,\"flag\"],[1,\"ml-2\"],[\"mat-button\",\"\",\"title\",\"Localisation non disponible\",1,\"mx-2\",3,\"disabled\"],[1,\"shipment-step__time\"],[4,\"ngIf\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"span\",1),xl(2),Fa(),oa(3,Vet,4,2,\"button\",2),oa(4,$et,4,3,\"button\",3),oa(5,jet,4,6,\"span\",4),Fa()),2&t&&(Cr(1),Ra(\"title\",e.labelTitle),Cr(1),Cl(\"\",e.label,\"\\xa0:\"),Cr(1),Ra(\"ngIf\",e.step.place.latLong),Cr(1),Ra(\"ngIf\",!e.step.place.latLong),Cr(1),Ra(\"ngIf\",e.step.date))},directives:[Vd,Ly,MJ],pipes:[ip],styles:[\".mat-button{font-weight:normal;white-space:normal;padding:0 8px!important}  .mat-button[disabled]{cursor:not-allowed;color:inherit!important}.shipment-step__label[_ngcontent-%COMP%]{font-weight:600;cursor:help;min-width:42px}.shipment-step__time[_ngcontent-%COMP%]{color:#7c7c7c;font-size:.9em}\"],changeDetection:0}),t})();function Get(t,e){if(1&t&&(La(0,\"div\",1),xl(1),Fa()),2&t){const t=Ka();Cr(1),Cl(\"Bill of lading : \",t.voyage.billOfLadingNumber,\"\")}}function Wet(t,e){1&t&&Na(0,\"app-shipment-step\",11),2&t&&Ra(\"step\",Ka().voyage.collection)}function qet(t,e){1&t&&Na(0,\"app-shipment-step\",12),2&t&&Ra(\"step\",Ka().voyage.pol)}function Yet(t,e){1&t&&Na(0,\"app-shipment-step\",13),2&t&&Ra(\"step\",Ka().voyage.pod)}function Zet(t,e){1&t&&Na(0,\"app-shipment-step\",14),2&t&&Ra(\"step\",Ka().voyage.delivery)}function Ket(t,e){1&t&&xl(0),2&t&&Cl(\" \\xa0- IMO: \",Ka().$implicit.imo,\" \")}function Xet(t,e){if(1&t){const t=$a();La(0,\"div\"),La(1,\"button\",15),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka().locateShip(e.name)}),xl(2),oa(3,Ket,1,1,\"ng-template\",16),Fa(),La(4,\"button\",17),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka().openShip(e.name)}),La(5,\"mat-icon\"),xl(6,\"info\"),Fa(),Fa(),Fa()}if(2&t){const t=e.$implicit;Cr(2),Cl(\" \",t.name,\" \"),Cr(1),Ra(\"ngIf\",t.imo)}}function Qet(t,e){if(1&t){const t=$a();La(0,\"button\",18),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka().containerSearch.emit(e)}),xl(1),Fa()}if(2&t){const t=e.$implicit;Cr(1),Cl(\" \",t,\" \")}}let Jet=(()=>{class t extends Gq{constructor(t,e,i){super(),this.mapService=t,this.selectionService=e,this.workerService=i,this.containerSearch=new gh}ngOnInit(){this.voyage.containers.sort()}locate(t){const[e,i]=t.split(\",\").map(t=>+t);this.mapService.pingLocation([i,e]),this.mapService.locate([i,e])}openShip(t){return Hp(this,void 0,void 0,function*(){const e=yield this.findShipByName(t);this.selectionService.addToSelection(NH.Ship,e.mmsi)})}locateShip(t){return Hp(this,void 0,void 0,function*(){const e=yield this.findShipByName(t);this.mapService.pingLocation([e.lon,e.lat]),this.mapService.locate([e.lon,e.lat])})}findShipByName(t){return Hp(this,void 0,void 0,function*(){const e=yield this.workerService.ships.findShips(t);if(0===e.length)throw new Error(\"Navire inconnu (aucun r\\xe9sultat pour ce nom)\");const[i]=e;return i})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj),Oa(IY),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-shipment-voyage\"]],inputs:{voyage:\"voyage\"},outputs:{containerSearch:\"containerSearch\"},features:[Uo],decls:17,vars:10,consts:[[1,\"shipment-voyage__metadata\"],[1,\"pa-2\"],[\"class\",\"pa-2\",4,\"ngIf\"],[1,\"shipment-voyage__label\"],[\"label\",\"POR\",\"labelTitle\",\"Place Of Receipt\",3,\"step\",4,\"ngIf\"],[\"label\",\"POL\",\"labelTitle\",\"Port Of Loading\",3,\"step\",4,\"ngIf\"],[\"label\",\"POD\",\"labelTitle\",\"Port Of Discharge\",3,\"step\",4,\"ngIf\"],[\"label\",\"DEL\",\"labelTitle\",\"Place Of Delivery\",3,\"step\",4,\"ngIf\"],[4,\"ngFor\",\"ngForOf\"],[1,\"shipment-voyage__containers\"],[\"mat-button\",\"\",\"class\",\"shipment-voyage__container\",\"title\",\"Rechercher ce conteneur\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[\"label\",\"POR\",\"labelTitle\",\"Place Of Receipt\",3,\"step\"],[\"label\",\"POL\",\"labelTitle\",\"Port Of Loading\",3,\"step\"],[\"label\",\"POD\",\"labelTitle\",\"Port Of Discharge\",3,\"step\"],[\"label\",\"DEL\",\"labelTitle\",\"Place Of Delivery\",3,\"step\"],[\"mat-button\",\"\",\"title\",\"Localiser le navire\",3,\"click\"],[3,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la fiche navire\",3,\"click\"],[\"mat-button\",\"\",\"title\",\"Rechercher ce conteneur\",1,\"shipment-voyage__container\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),xl(2),Fa(),oa(3,Get,2,1,\"div\",2),Fa(),La(4,\"div\",3),xl(5,\"Route\"),Fa(),oa(6,Wet,1,1,\"app-shipment-step\",4),oa(7,qet,1,1,\"app-shipment-step\",5),oa(8,Yet,1,1,\"app-shipment-step\",6),oa(9,Zet,1,1,\"app-shipment-step\",7),La(10,\"div\",3),xl(11,\"Navires\"),Fa(),oa(12,Xet,7,2,\"div\",8),La(13,\"div\",3),xl(14),Fa(),La(15,\"div\",9),oa(16,Qet,2,1,\"button\",10),Fa()),2&t&&(Cr(2),Cl(\"Transporteur : \",e.voyage.transportParty,\"\"),Cr(1),Ra(\"ngIf\",e.voyage.billOfLadingNumber),Cr(3),Ra(\"ngIf\",e.voyage.collection),Cr(1),Ra(\"ngIf\",e.voyage.pol),Cr(1),Ra(\"ngIf\",e.voyage.pod),Cr(1),Ra(\"ngIf\",e.voyage.delivery),Cr(3),Ra(\"ngForOf\",e.voyage.vessels),Cr(2),kl(\"\",e.voyage.containers.length,\" conteneur\",e.voyage.containers.length>1?\"s\":\"\",\"\"),Cr(2),Ra(\"ngForOf\",e.voyage.containers))},directives:[Vd,Bd,Het,Ly,uE],styles:[\".mat-button{font-weight:normal;white-space:normal}.shipment-voyage__metadata[_ngcontent-%COMP%]{display:flex;justify-content:space-between;background-color:#c3c3c3}.shipment-voyage__label[_ngcontent-%COMP%]{font-size:1.2em;font-weight:600;color:gray;padding:8px;background-color:#f2f2f2}.shipment-voyage__containers[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.shipment-voyage__container[_ngcontent-%COMP%]{flex:auto}\"],changeDetection:0}),t})();const tit=[\"submitButton\"];function eit(t,e){if(1&t){const t=$a();La(0,\"button\",14),Ga(\"click\",function(){return Fe(t),Ka().f.containerId.reset()}),La(1,\"mat-icon\"),xl(2,\"close\"),Fa(),Fa()}}function iit(t,e){if(1&t&&(La(0,\"mat-error\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),Sl(t.f.containerId.errors.invalid)}}function nit(t,e){if(1&t){const t=$a();La(0,\"button\",14),Ga(\"click\",function(){return Fe(t),Ka().f.billOfLading.reset()}),La(1,\"mat-icon\"),xl(2,\"close\"),Fa(),Fa()}}function sit(t,e){1&t&&(La(0,\"div\",15),xl(1,\" Faites une recherche pour afficher les r\\xe9sultats. \"),Fa())}function rit(t,e){1&t&&(La(0,\"div\",15),xl(1,\" Aucun r\\xe9sultat \"),Fa())}function oit(t,e){if(1&t){const t=$a();La(0,\"app-shipment-voyage\",19),Ga(\"containerSearch\",function(e){return Fe(t),Ka(3).searchContainer(e)}),Fa()}2&t&&Ra(\"voyage\",e.$implicit)}function ait(t,e){if(1&t&&(La(0,\"div\",17),oa(1,oit,1,1,\"app-shipment-voyage\",18),Fa()),2&t){const t=Ka(2);Cr(1),Ra(\"ngForOf\",t.searchResults)}}function lit(t,e){if(1&t&&(oa(0,rit,2,0,\"div\",12),oa(1,ait,2,1,\"div\",16)),2&t){const t=Ka();Ra(\"ngIf\",0===t.searchResults.length),Cr(1),Ra(\"ngIf\",t.searchResults.length>0)}}function cit(t){return!t.value||t.dirty&&(0,Bet.Z)(t.value)?null:{invalid:\"Le num\\xe9ro doit \\xeatre au format ISO 6346 (ex: TEXU3070079).\"}}let hit=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.formBuilder=t,this.router=e,this.uiService=i,this.titleService=n,this.mapService=s,this.workerService=r,this.searchResults=null,this.search=()=>Hp(this,void 0,void 0,function*(){this.searchResults=null,this.searchForm.valid&&(this.searchResults=this.searchForm.controls.containerId.value?yield this.workerService.containers.findContainerTraceByContainerId(this.searchForm.controls.containerId.value):yield this.workerService.containers.findContainerTraceByBillOfLading(this.searchForm.controls.billOfLading.value))})}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Recherche de conteneur - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.searchForm=this.formBuilder.group({containerId:[\"\",[cit]],billOfLading:[\"\"]},{validator:t=>t.controls.containerId.value||t.controls.billOfLading.value?null:{needOneField:!0}}),this.searchForm.controls.containerId.valueChanges.subscribe(t=>{t?this.f.billOfLading.disable({emitEvent:!1}):this.f.billOfLading.enable({emitEvent:!1})}),this.searchForm.controls.billOfLading.valueChanges.subscribe(t=>{t?this.f.containerId.disable({emitEvent:!1}):this.f.containerId.enable({emitEvent:!1})}),window.__anaisSettings.LESTR_CONTAINERS_ENABLE||(this.uiService.error(\"La recherche de conteneurs est suspendue car notre exp\\xe9rimentation avec Semsoft est arriv\\xe9e \\xe0 terme.\"),yield this.router.navigateByUrl(\"/\"))})}get f(){return this.searchForm.controls}searchContainer(t){return Hp(this,void 0,void 0,function*(){this.searchForm.reset(),this.searchForm.controls.containerId.markAsDirty(),this.searchForm.controls.containerId.setValue(t),this.searchResults=null,setTimeout(()=>{this.submitButtonRef.nativeElement.click()})})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Lx),Oa(pL),Oa(_H),Oa(jp),Oa(Pj),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-container-search-panel\"]],viewQuery:function(t,e){if(1&t&&Th(tit,7,ic),2&t){let t;Mh(t=Ph())&&(e.submitButtonRef=t.first)}},features:[Uo],decls:24,vars:8,consts:[[\"joyrideStep\",\"container-search-panel\",\"title\",\"Recherche de conteneurs\",\"text\",\"C'est ici que vous pouvez rechercher des conteneurs.\",1,\"panel\",\"panel--medium\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\"],[1,\"pa-3\",\"d-flex-column\",3,\"formGroup\"],[\"matInput\",\"\",\"formControlName\",\"containerId\",\"minlength\",\"11\",\"maxlength\",\"11\"],[\"type\",\"button\",\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"aria-label\",\"R\\xe9initialiser le champ\",3,\"click\",4,\"ngIf\"],[4,\"ngIf\"],[1,\"u-center\"],[\"matInput\",\"\",\"formControlName\",\"billOfLading\"],[\"mat-stroked-button\",\"\",\"type\",\"submit\",\"title\",\"Lancer la rechercher\",3,\"app-async-action\",\"disabled\"],[\"submitButton\",\"\"],[1,\"mt-3\"],[\"class\",\"pa-3\",4,\"ngIf\"],[3,\"ngIf\"],[\"type\",\"button\",\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"aria-label\",\"R\\xe9initialiser le champ\",3,\"click\"],[1,\"pa-3\"],[\"class\",\"d-flex-column mat-body scrollable\",4,\"ngIf\"],[1,\"d-flex-column\",\"mat-body\",\"scrollable\"],[3,\"voyage\",\"containerSearch\",4,\"ngFor\",\"ngForOf\"],[3,\"voyage\",\"containerSearch\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"h2\",2),xl(3,\"Recherche de conteneurs\"),Fa(),Fa(),La(4,\"form\",3),La(5,\"mat-form-field\"),La(6,\"mat-label\"),xl(7,\"Num\\xe9ro de conteneur\"),Fa(),Na(8,\"input\",4),oa(9,eit,3,0,\"button\",5),oa(10,iit,2,1,\"mat-error\",6),Fa(),La(11,\"div\",7),xl(12,\"Ou\"),Fa(),La(13,\"mat-form-field\"),La(14,\"mat-label\"),xl(15,\"Bill of lading\"),Fa(),Na(16,\"input\",8),oa(17,nit,3,0,\"button\",5),Fa(),La(18,\"button\",9,10),xl(20,\"Rechercher\"),Fa(),Na(21,\"mat-divider\",11),Fa(),oa(22,sit,2,0,\"div\",12),oa(23,lit,2,2,\"ng-template\",13),Fa()),2&t&&(Cr(4),Ra(\"formGroup\",e.searchForm),Cr(5),Ra(\"ngIf\",e.f.containerId.value),Cr(1),Ra(\"ngIf\",null==e.f.containerId.errors?null:e.f.containerId.errors.invalid),Cr(7),Ra(\"ngIf\",e.f.billOfLading.value),Cr(1),Ra(\"app-async-action\",e.search)(\"disabled\",!e.searchForm.valid),Cr(4),Ra(\"ngIf\",null===e.searchResults),Cr(1),Ra(\"ngIf\",null!==e.searchResults))},directives:[AF,sx,Cw,dx,AS,aS,ES,Gy,Sw,_x,Tx,Px,Vd,Ly,Jq,Xq,dS,uE,eS,Bd,Jet],styles:[\"\"]}),t})();const uit=/@(.+),(.+),(.+)z(?:,(.+Z))?/;let dit=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.location=t,this.titleService=e,this.historyService=i,this.mapService=n,this.mapConfigService=s,this.routeService=r}ngOnInit(){if(!this.mapService.hasBooted$.value){const t=this.location.path().match(uit);if(t){const e=function(t,e){if(0!==e){const i=e+180;t[0]<e-180&&(t[0]+=360),t[0]>i&&(t[0]-=360)}return t}([+t[2],+t[1]],this.mapConfigService.longitudeCenter$.value);this.mapService.centerOnLonLat(e,+t[3]);const i=t[4];i&&this.historyService.setTimestamp(Math.ceil(new Date(i).getTime()/1e3))}else this.mapService.resetToDefaultView()}this.subscriptions.push(this.routeService.viewURL$.pipe(Af(t=>!!t)).subscribe(t=>{this.location.replaceState(`/${t}`),this.titleService.setTitle(`${t} - ANAIS`)}))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Xu),Oa(jp),Oa(Fj),Oa(Pj),Oa(qU),Oa(Nj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-empty-panel\"]],features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();function pit(t,e){if(1&t&&(La(0,\"div\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),El(\" \",t.extractedMMSIs.length,\" MMSI d\\xe9tect\\xe9\",t.extractedMMSIs.length>1?\"s\":\"\",\" : \",t.extractedMMSIs.length>0?t.extractedMMSIs.join(\", \"):\"-\",\" \")}}function fit(t,e){if(1&t&&(La(0,\"div\"),xl(1),Fa()),2&t){const t=Ka();Cr(1),El(\" \",t.extractedIMOs.length,\" IMO d\\xe9tect\\xe9\",t.extractedIMOs.length>1?\"s\":\"\",\" : \",t.extractedIMOs.length>0?t.extractedIMOs.join(\", \"):\"-\",\" \")}}let mit=(()=>{class t{constructor(t,e){this.dialogRef=t,this.workerService=e,this.textFormControl=new Yw(\"\"),this.extractedMMSIs=null,this.extractedIMOs=null,this.save=()=>Hp(this,void 0,void 0,function*(){const t=(yield Promise.all([(()=>Hp(this,void 0,void 0,function*(){return Promise.all(this.extractedMMSIs.map(t=>Hp(this,void 0,void 0,function*(){try{return yield this.workerService.ships.getShip(t)}catch(e){if(e.name!==aB.NotFound)throw e}})))}))(),(()=>Hp(this,void 0,void 0,function*(){return(yield Promise.all(this.extractedIMOs.map(t=>Hp(this,void 0,void 0,function*(){try{return yield this.workerService.ships.getShipsByIMO(t)}catch(e){if(e.name!==aB.NotFound)throw e}})))).flat()}))()])).flat();this.dialogRef.close(t)})}ngOnInit(){this.textFormControl.valueChanges.subscribe(t=>{this.extractedMMSIs=function(t){return rQ(oQ,t).map(([t])=>t)}(t),this.extractedIMOs=function(t){return rQ(aQ,t).map(([t])=>+t)}(t)})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ZC),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-fleet-ships-bulk-import-dialog\"]],decls:19,vars:6,consts:[[\"mat-dialog-title\",\"\"],[\"mat-dialog-content\",\"\",2,\"min-width\",\"600px\"],[1,\"d-flex-column-center\"],[\"appearance\",\"outline\",1,\"pa-1\",\"d-block\"],[\"matInput\",\"\",\"name\",\"text\",\"cdkTextareaAutosize\",\"\",\"cdkAutosizeMinRows\",\"4\",\"cdkAutosizeMaxRows\",\"15\",3,\"formControl\"],[4,\"ngIf\"],[\"mat-dialog-actions\",\"\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"color\",\"primary\",3,\"disabled\",\"app-async-action\"],[\"mat-button\",\"\",3,\"mat-dialog-close\"]],template:function(t,e){1&t&&(La(0,\"h1\",0),xl(1,\"Import en masse\"),Fa(),La(2,\"div\",1),La(3,\"p\"),xl(4,\"Utilisez la zone de texte ci-apr\\xe8s pour copiez-coller une liste de MMSI ou IMO (texte, CSV). Les MMSI et IMO seront extraits automatiquement avec les formats de 9 et 7 chiffres respectivement.\"),Fa(),La(5,\"div\",2),La(6,\"mat-form-field\",3),La(7,\"mat-label\"),xl(8,\"Liste de MMSI ou IMO (CSV, etc)\"),Fa(),La(9,\"textarea\",4),xl(10,\"      \"),Fa(),Fa(),oa(11,pit,2,3,\"div\",5),oa(12,fit,2,3,\"div\",5),Fa(),Fa(),La(13,\"div\",6),Na(14,\"div\",7),La(15,\"button\",8),xl(16,\" Enregistrer \"),Fa(),La(17,\"button\",9),xl(18,\" Annuler \"),Fa(),Fa()),2&t&&(Cr(9),Ra(\"formControl\",e.textFormControl),Cr(2),Ra(\"ngIf\",e.extractedMMSIs),Cr(1),Ra(\"ngIf\",e.extractedIMOs),Cr(3),Ra(\"disabled\",!(e.extractedMMSIs&&0!==e.extractedMMSIs.length||e.extractedIMOs&&0!==e.extractedIMOs.length))(\"app-async-action\",e.save),Cr(2),Ra(\"mat-dialog-close\",null))},directives:[rk,ok,AS,aS,ES,yS,Gy,Sw,hx,Vd,ak,Ly,Jq,sk],styles:[\"\"]}),t})();const git={0:\"Under way using engine\",1:\"At anchor\",2:\"Not under command\",3:\"Restricted manoeuverability\",4:\"Constrained by her draught\",5:\"Moored\",6:\"Aground\",7:\"Engaged in Fishing\",8:\"Under way sailing\",9:\"Reserved for future amendment of Navigational Status for HSC\",10:\"Reserved for future amendment of Navigational Status for WIG\",11:\"Reserved for future use\",12:\"Reserved for future use\",13:\"Reserved for future use\",14:\"AIS-SART is active\",15:\"Not defined (default)\"},Ait=Object.values(git).filter((t,e)=>e<9||15===e).map((t,e)=>({key:e,label:t}));function vit(t,e){if(1&t){const t=$a();La(0,\"button\",9),Ga(\"click\",function(){Fe(t);const e=Ka();return e.deleteItem.emit(e.ship)}),La(1,\"mat-icon\"),xl(2,\"delete\"),Fa(),Fa()}}const _it=function(t){return[\"./ships/\",t]};function bit(t,e){if(1&t&&(La(0,\"button\",10),La(1,\"mat-icon\"),xl(2,\"info\"),Fa(),Fa()),2&t){const t=Ka();Ra(\"routerLink\",ih(1,_it,t.ship.mmsi))}}let yit=(()=>{class t{constructor(t){this.mapService=t,this.editable=!1,this.deleteItem=new gh,this.navigationStatusByKey=git,this.vesselTypeLabelsByType=oU,this.hasPosition=!0}ngOnChanges(t){var e,i;t.ship&&(this.hasPosition=gU(null===(e=t.ship.currentValue)||void 0===e?void 0:e.lon)&&gU(null===(i=t.ship.currentValue)||void 0===i?void 0:i.lat))}locateShip(){this.mapService.centerOnLonLat([this.ship.lon,this.ship.lat])}locateAndZoomToShip(){this.mapService.locate([this.ship.lon,this.ship.lat])}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-fleet-ship-item\"]],inputs:{ship:\"ship\",editable:\"editable\"},outputs:{deleteItem:\"deleteItem\"},features:[he],decls:14,vars:8,consts:[[1,\"fleet-ship-item\"],[\"mat-button\",\"\",1,\"fleet-ship-item__link\",3,\"title\",\"disabled\",\"click\",\"dblclick\"],[1,\"fleet-ship-item__flag\",3,\"mmsi\"],[1,\"fleet-ship-item__title\"],[1,\"fleet-ship-item__name\"],[1,\"fleet-ship-item__type\"],[\"mat-button\",\"\",3,\"click\",4,\"ngIf\"],[\"mat-button\",\"\",3,\"routerLink\",4,\"ngIf\"],[1,\"fleet-ship-item\",\"ml-2\",\"mb-2\",\"mat-small\"],[\"mat-button\",\"\",3,\"click\"],[\"mat-button\",\"\",3,\"routerLink\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"button\",1),Ga(\"click\",function(){return e.locateShip()})(\"dblclick\",function(){return e.locateAndZoomToShip()}),Na(2,\"app-flag\",2),La(3,\"div\",3),La(4,\"strong\",4),xl(5),Fa(),La(6,\"small\",5),xl(7),Fa(),Fa(),Fa(),oa(8,vit,3,0,\"button\",6),oa(9,bit,3,3,\"button\",7),Fa(),La(10,\"div\",8),xl(11,\" Statut :\\xa0\"),La(12,\"strong\"),xl(13),Fa(),Fa()),2&t&&(Cr(1),Ra(\"title\",e.hasPosition?\"Localiser le navire\":\"Ce navire n'a pas de position\")(\"disabled\",!e.hasPosition),Cr(1),Ra(\"mmsi\",e.ship.mmsi),Cr(3),Sl(e.ship.name||\"?\"),Cr(2),Sl(e.ship.cargo?e.vesselTypeLabelsByType[e.ship.cargo]:\"?\"),Cr(1),Ra(\"ngIf\",e.editable),Cr(1),Ra(\"ngIf\",!e.editable),Cr(4),Sl(e.navigationStatusByKey[e.ship.status]||\"?\"))},directives:[Ly,MJ,Vd,uE,mL],styles:[\".fleet-ship-item[_ngcontent-%COMP%]{display:flex}.fleet-ship-item__button-content[_ngcontent-%COMP%]{display:flex}.fleet-ship-item__link[_ngcontent-%COMP%]{flex:1;padding:0;line-height:inherit;text-align:inherit;font-size:inherit;font-weight:inherit}.fleet-ship-item__link[_ngcontent-%COMP%]     .mat-button-wrapper{display:flex}.fleet-ship-item__flag[_ngcontent-%COMP%]{margin:5px}.fleet-ship-item__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px 0;flex:1}.fleet-ship-item__name[_ngcontent-%COMP%]{font-size:1.2em}.fleet-ship-item__type[_ngcontent-%COMP%]{font-size:.9em;color:#555}\"],changeDetection:0}),t})();function wit(t,e){1&t&&Na(0,\"mat-spinner\",5)}function xit(t,e){1&t&&(La(0,\"mat-error\",21),xl(1,\" Ce champ ne peut \\xeatre vide. \"),Fa())}function Sit(t,e){if(1&t){const t=$a();La(0,\"mat-form-field\",15),La(1,\"input\",16,17),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).fleet.name=e}),Fa(),oa(3,xit,2,0,\"mat-error\",18),Fa(),La(4,\"button\",19),La(5,\"mat-icon\"),xl(6,\"check\"),Fa(),Fa(),La(7,\"button\",20),La(8,\"mat-icon\"),xl(9,\"clear\"),Fa(),Fa()}if(2&t){const t=aa(2);Ka();const e=aa(1),i=Ka();Cr(1),Ra(\"ngModel\",i.fleet.name),Cr(2),Ra(\"ngIf\",null==t.errors?null:t.errors.required),Cr(1),Ra(\"app-async-action\",i.saveFleet)(\"disabled\",!e.form.valid),Cr(3),Ra(\"routerLink\",i.newFleet?\"/fleets\":\"/fleets/\"+i.fleet.id)}}function Cit(t,e){if(1&t){const t=$a();La(0,\"button\",23),La(1,\"mat-icon\"),xl(2,\"create\"),Fa(),Fa(),La(3,\"button\",24),La(4,\"mat-icon\"),xl(5,\"more_vert\"),Fa(),Fa(),La(6,\"mat-menu\",null,25),La(8,\"button\",26),Ga(\"click\",function(){return Fe(t),Ka(3).openExportDataDialog()}),La(9,\"mat-icon\"),xl(10,\"file_download\"),Fa(),La(11,\"span\"),xl(12,\"Exporter la flotte en CSV\"),Fa(),Fa(),La(13,\"button\",27),Ga(\"click\",function(){return Fe(t),Ka(3).deleteFleet()}),La(14,\"mat-icon\",28),xl(15,\"delete\"),Fa(),La(16,\"span\",28),xl(17,\"Supprimer\"),Fa(),Fa(),Fa()}if(2&t){const t=aa(7),e=Ka(3);Ra(\"routerLink\",\"/fleets/\"+e.fleet.id+\"/edit\"),Cr(3),Ra(\"matMenuTriggerFor\",t),Cr(5),Ra(\"disabled\",!e.fleet||0===e.fleet.ships.length)}}function kit(t,e){if(1&t&&(La(0,\"h2\",22),xl(1),Fa(),oa(2,Cit,18,3,\"ng-template\",4)),2&t){const t=Ka(2);Cr(1),Cl(\" \",t.fleet.name,\" \"),Cr(1),Ra(\"ngIf\",t.canEdit&&!t.offlineService.isOffline$.value)}}function Eit(t,e){if(1&t&&(La(0,\"button\",33),La(1,\"mat-icon\"),xl(2,\"stacked_line_chart\"),Fa(),Fa()),2&t){const t=Ka(3);hl(\"button-active\",t.fleetsService.displayFleetTrail$.value),Ra(\"title\",t.fleetsService.displayFleetTrail$.value?\"Masquer les traces des navires de la flotte\":\"Afficher les traces des navires de la flotte (le rafraichissement n'est pas automatique)\")(\"app-async-action\",t.fleetsService.toggleDisplayFleetTrails)}}function Mit(t,e){if(1&t){const t=$a();La(0,\"div\",29),La(1,\"button\",30),Ga(\"click\",function(){return Fe(t),Ka(2).fitOnFleet()}),La(2,\"mat-icon\"),xl(3,\"center_focus_strong\"),Fa(),Fa(),oa(4,Eit,3,4,\"button\",31),La(5,\"button\",32),Ga(\"click\",function(){return Fe(t),Ka(2).mapConfigService.toggleOtherShips()}),La(6,\"mat-icon\"),xl(7,\"directions_boat\"),Fa(),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(4),Ra(\"ngIf\",!t.offlineService.isOffline$.value),Cr(1),hl(\"button-active\",t.mapConfigService.showOtherShips$.value),el(\"title\",\"\",t.mapConfigService.showOtherShips$.value?\"Masquer\":\"Afficher\",\" les autres navires\")}}function Tit(t,e){if(1&t&&(La(0,\"mat-option\",38),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.id),Cr(1),Cl(\" \",t.name,\" \")}}function Iit(t,e){if(1&t){const t=$a();La(0,\"div\",34),La(1,\"mat-form-field\",35),La(2,\"mat-label\"),xl(3,\"Groupe\"),Fa(),La(4,\"mat-select\",36),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).fleet.group_id=e}),oa(5,Tit,2,2,\"mat-option\",37),Fa(),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(4),Ra(\"ngModel\",t.fleet.group_id),Cr(1),Ra(\"ngForOf\",t.updatableGroups)}}function Pit(t,e){1&t&&(La(0,\"p\",39),xl(1,\"Aucun navire n'a \\xe9t\\xe9 configur\\xe9\"),Fa())}function Oit(t,e){if(1&t){const t=$a();La(0,\"app-fleet-ship-item\",40),Ga(\"deleteItem\",function(e){return Fe(t),Ka(2).deleteShip(e)}),Fa()}if(2&t){const t=e.$implicit,i=Ka(2);Ra(\"ship\",t)(\"editable\",i.editMode)}}function Rit(t,e){if(1&t){const t=$a();La(0,\"div\",39),La(1,\"h3\"),xl(2,\"Ajouter des navires\"),Fa(),La(3,\"button\",41),Ga(\"click\",function(){return Fe(t),Ka(2).openBulkImportDialog()}),La(4,\"mat-icon\",42),xl(5,\"post_add\"),Fa(),La(6,\"span\"),xl(7,\"Import en masse\"),Fa(),Fa(),La(8,\"app-ship-identifier-input\",43),Ga(\"selectItem\",function(e){return Fe(t),Ka(2).addShipToFleet(e)}),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(8),Ra(\"existingItems\",t.fleetShipsIds)}}function Dit(t,e){if(1&t&&(La(0,\"div\",47),La(1,\"div\",48),La(2,\"mat-icon\",49),xl(3,\"warning\"),Fa(),xl(4),Fa(),La(5,\"div\"),xl(6),Fa(),Fa()),2&t){const t=e.alert;Cr(4),Cl(\" \",t.rule_name,\" \"),Cr(2),Sl(t.ship_name)}}const Lit=function(t){return[\"/ships/\",t]},Fit=function(t){return[\"/alerts/rules/\",t]};function Nit(t,e){if(1&t&&(La(0,\"button\",50),La(1,\"mat-icon\"),xl(2,\"info\"),Fa(),xl(3,\" Voir d\\xe9tail Navire \"),Fa(),La(4,\"button\",50),La(5,\"mat-icon\"),xl(6,\"info\"),Fa(),xl(7,\" Voir la r\\xe8gle \"),Fa()),2&t){const t=e.alert;Ra(\"routerLink\",ih(2,Lit,t.mmsi)),Cr(4),Ra(\"routerLink\",ih(4,Fit,t.rule_id))}}function Bit(t,e){if(1&t&&(La(0,\"h3\",12),xl(1,\"Alertes\"),Fa(),Na(2,\"app-alerts-list\",44),oa(3,Dit,7,2,\"ng-template\",null,45,Lh),oa(5,Nit,8,6,\"ng-template\",null,46,Lh)),2&t){const t=aa(4),e=aa(6),i=Ka(2);Cr(2),Ra(\"alerts$\",i.alerts$)(\"alertTitleRef\",t)(\"alertMenuItemsRef\",e)}}function zit(t,e){if(1&t&&(La(0,\"ng-form\",6,7),La(2,\"div\",8),oa(3,Sit,10,5,\"ng-template\",4),oa(4,kit,3,2,\"ng-template\",4),Fa(),Na(5,\"mat-divider\"),oa(6,Mit,8,4,\"div\",9),oa(7,Iit,6,2,\"div\",10),La(8,\"div\",11),La(9,\"h3\",12),xl(10,\"Navires\"),Fa(),oa(11,Pit,2,0,\"p\",13),oa(12,Oit,1,2,\"app-fleet-ship-item\",14),Na(13,\"mat-divider\"),oa(14,Rit,9,1,\"div\",13),oa(15,Bit,7,3,\"ng-template\",4),Fa(),Fa()),2&t){const t=Ka();Cr(3),Ra(\"ngIf\",t.editMode),Cr(1),Ra(\"ngIf\",!t.editMode),Cr(2),Ra(\"ngIf\",!t.editMode),Cr(1),Ra(\"ngIf\",t.editMode&&t.newFleet&&t.updatableGroups.length>1),Cr(4),Ra(\"ngIf\",0===t.fleet.ships.length),Cr(1),Ra(\"ngForOf\",t.fleet.ships),Cr(2),Ra(\"ngIf\",t.editMode),Cr(1),Ra(\"ngIf\",!t.editMode)}}let Vit=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o,a,l,c,h,u,p,f){super(),this.activatedRoute=t,this.router=e,this.dialog=i,this.titleService=n,this.configService=s,this.exportService=r,this.fleetsService=o,this.groupsService=a,this.interactionsService=l,this.mapService=c,this.mapConfigService=h,this.offlineService=u,this.timeRangeService=p,this.uiService=f,this.timeRangeSubscription=new d,this.componentDestroyed=!1,this.fleet$=new Jp(null),this.alerts$=new Jp([]),this.editMode=!1,this.newFleet=!1,this.canEdit=!1,this.fleetShipsIds=[],this.updatableGroups=[],this.saveFleet=()=>Hp(this,void 0,void 0,function*(){if(this.newFleet){const t=yield this.fleetsService.createFleet(this.fleet);yield this.router.navigateByUrl(`/fleets/${t}`)}else yield this.fleetsService.updateFleet(this.fleet),yield this.router.navigateByUrl(`/fleets/${this.fleet.id}`)})}ngOnInit(){this.subscriptions.push(this.activatedRoute.data.subscribe(t=>{this.editMode=!!t.edit,this.newFleet=!!t.new})),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(JT([this.activatedRoute.paramMap,this.activatedRoute.queryParams]).subscribe(([t,e])=>Hp(this,void 0,void 0,function*(){this.fleetsService.resetDisplayFleetTrails(),this.newFleet?(this.fleet=function(t){return{name:\"\",ships:[],group_id:null!=t?t:\"\"}}(e.groupId),this.titleService.setTitle(\"Nouvelle flotte - ANAIS\")):(this.fleetId=t.get(\"fleetId\"),yield this.fetchFleet())})),this.groupsService.updatableGroups$.subscribe(t=>{this.updatableGroups=t}),JT([this.fleet$.pipe(kf(1)),this.groupsService.updatableGroups$]).subscribe(([t,e])=>{this.canEdit=null===t.group_id||e.some(e=>e.id===t.group_id)}))}ngOnDestroy(){super.ngOnDestroy(),this.componentDestroyed=!0,this.fleetsService.deselectFleet(),this.timeRangeSubscription.unsubscribe(),this.fleetsService.resetDisplayFleetTrails()}refreshFleetShipsIds(){this.fleetShipsIds=this.fleet.ships.map(t=>t.mmsi)}fetchFleet(){return Hp(this,void 0,void 0,function*(){try{this.timeRangeSubscription.unsubscribe();const{fleet:t,alerts:e}=yield this.fleetsService.selectFleet(this.fleetId);if(t.group_id||(t.group_id=\"\"),this.componentDestroyed)return;this.fleet=t,this.fleet$.next(t),this.refreshFleetShipsIds(),this.alerts$.next(e),this.titleService.setTitle(`Flotte ${this.fleet.name} - ANAIS`),this.offlineService.isOffline$.value||(this.timeRangeSubscription=this.timeRangeService.timeRange$.pipe(kf(1)).subscribe(()=>Hp(this,void 0,void 0,function*(){this.fleet&&!this.editMode&&(yield this.fetchFleet())})))}catch(t){throw t.notfound?(this.router.navigateByUrl(\"/fleets\").catch(()=>{}),new Error(`La flotte <${this.fleetId}> n'existe pas.`)):t}})}deleteFleet(){this.uiService.confirm({title:\"Suppression\",message:\"Une fois supprim\\xe9e, cette flotte ne sera plus accessible. Confirmez-vous la suppression de cette flotte ?\",action:t=>Hp(this,void 0,void 0,function*(){t&&(yield this.fleetsService.deleteFleet(this.fleet.id),yield this.router.navigateByUrl(\"/fleets\"))})})}openExportDataDialog(){this.exportService.openExportDataDialog({mmsis:this.fleet.ships.map(t=>t.mmsi),label:`des navires de la flotte ${this.fleet.name}`})}addShipToFleet(t){t&&!this.fleet.ships.some(e=>e.mmsi===t.mmsi)&&(this.fleet.ships.push(t),this.refreshFleetShipsIds())}deleteShip(t){this.fleet.ships=this.fleet.ships.filter(e=>e!==t),this.refreshFleetShipsIds()}fitOnFleet(){if(this.fleet.ships.length>0){const{lon:t,lat:e}=this.fleet.ships[0],i=MU.New(t,e,t,e);this.fleet.ships.filter(t=>gU(t.lon)&&gU(t.lat)).forEach(t=>{i.addPoint(t.lon,t.lat)}),this.mapService.fitOn(i.toExtent())}}openBulkImportDialog(){this.dialog.open(mit,{autoFocus:!1,closeOnNavigation:!0}).afterClosed().subscribe(t=>{t instanceof Array&&t.forEach(t=>{this.addShipToFleet(t)})})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(GR),Oa(pL),Oa(ik),Oa(jp),Oa(WU),Oa(CY),Oa(zY),Oa(UY),Oa(DY),Oa(Pj),Oa(qU),Oa(MY),Oa(Kq),Oa(_H))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-fleet-panel\"]],features:[Uo],decls:9,vars:2,consts:[[1,\"panel\",\"fleet-panel\",\"u-flex\"],[1,\"d-flex\",2,\"background-color\",\"#fff\"],[\"mat-button\",\"\",\"title\",\"Revenir \\xe0 la liste\",\"routerLink\",\"/fleets\",1,\"back-button\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"name\",\"form\",1,\"d-flex-column\",\"unscrollable\"],[\"form\",\"ngForm\"],[1,\"panel__header\",\"panel__header--blue\"],[\"class\",\"d-flex\",4,\"ngIf\"],[\"class\",\"d-flex-baseline\",4,\"ngIf\"],[1,\"scrollable\"],[1,\"panel__subtitle\"],[\"class\",\"panel__content\",4,\"ngIf\"],[3,\"ship\",\"editable\",\"deleteItem\",4,\"ngFor\",\"ngForOf\"],[1,\"fleet-panel__name-input\"],[\"matInput\",\"\",\"name\",\"name\",\"placeholder\",\"Nom de la flotte\",\"required\",\"\",\"maxlength\",\"64\",3,\"ngModel\",\"ngModelChange\"],[\"name\",\"ngModel\"],[\"class\",\"input-error\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Enregistrer les changements\",\"data-test\",\"save-fleet\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Annuler l'\\xe9dition\",3,\"routerLink\"],[1,\"input-error\"],[1,\"panel__title\",\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Modifier\",3,\"routerLink\"],[\"mat-button\",\"\",\"title\",\"Autres actions\",3,\"matMenuTriggerFor\"],[\"menu\",\"matMenu\"],[\"mat-menu-item\",\"\",\"title\",\"Exporter les donn\\xe9es des navires de la flotte au format CSV\",3,\"disabled\",\"click\"],[\"mat-menu-item\",\"\",\"title\",\"Supprimer la flotte\",3,\"click\"],[\"color\",\"warn\"],[1,\"d-flex\"],[\"mat-button\",\"\",\"title\",\"Centrer sur la flotte\",1,\"d-block\",3,\"click\"],[\"mat-button\",\"\",\"class\",\"d-block\",3,\"title\",\"button-active\",\"app-async-action\",4,\"ngIf\"],[\"mat-button\",\"\",1,\"d-block\",3,\"title\",\"click\"],[\"mat-button\",\"\",1,\"d-block\",3,\"title\",\"app-async-action\"],[1,\"d-flex-baseline\"],[1,\"pa-2\",\"u-flex\"],[\"name\",\"group_id\",3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[3,\"value\"],[1,\"panel__content\"],[3,\"ship\",\"editable\",\"deleteItem\"],[\"mat-stroked-button\",\"\",\"title\",\"Ouvrir la fen\\xeatre d'import en masse\",1,\"d-block\",3,\"click\"],[1,\"mr-1\"],[1,\"pa-1\",3,\"existingItems\",\"selectItem\"],[3,\"alerts$\",\"alertTitleRef\",\"alertMenuItemsRef\"],[\"alertTitleRef\",\"\"],[\"alertMenuItemsRef\",\"\"],[1,\"fleet-panel__alert-item\"],[1,\"d-flex-center\"],[1,\"rule-name-icon\"],[\"mat-menu-item\",\"\",3,\"routerLink\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"a\",2),La(3,\"mat-icon\"),xl(4,\"arrow_back_ios\"),Fa(),xl(5,\" Flottes \"),Fa(),Fa(),oa(6,wit,1,0,\"mat-spinner\",3),oa(7,zit,16,8,\"ng-template\",4),Fa(),Na(8,\"router-outlet\")),2&t&&(Cr(6),Ra(\"ngIf\",!e.fleet),Cr(1),Ra(\"ngIf\",e.fleet))},directives:[Fy,gL,uE,Vd,_L,KJ,Jw,Xq,Bd,AS,ES,Gy,Ex,Px,Sw,nx,Ly,Jq,mL,eS,D0,T0,S0,aS,qT,ky,yit,_3,a4],styles:[\"[_nghost-%COMP%]{display:flex;height:100%}.back-button[_ngcontent-%COMP%]{line-height:36px}.fleet-panel[_ngcontent-%COMP%]{min-width:270px}.fleet-panel__name-input[_ngcontent-%COMP%]{margin:.5em;flex:1;font-size:20px}.rule-name-icon[_ngcontent-%COMP%]{font-size:20px;height:20px;width:20px;margin-right:.3em}  router-outlet+app-ship-details-panel{border-left:1px solid rgba(0,0,0,.12)}\"]}),t})();const $it=function(t){return{groupId:t}};function Uit(t,e){if(1&t&&(La(0,\"button\",6),La(1,\"mat-icon\"),xl(2,\"add\"),Fa(),xl(3,\" Nouvelle flotte \"),Fa()),2&t){const t=e.group;Ra(\"queryParams\",ih(1,$it,t?t.id:null))}}function jit(t,e){if(1&t&&(La(0,\"button\",7),xl(1),La(2,\"em\"),xl(3),Fa(),Fa()),2&t){const t=e.resource;Ra(\"routerLink\",\"/fleets/\"+t.id)(\"@fadeAnimation\",void 0),Cr(1),Cl(\" \",t.name,\" \"),Cr(2),kl(\"(\",t.ships.length,\" navire\",t.ships.length>1?\"s\":\"\",\")\")}}let Hit=(()=>{class t extends Gq{constructor(t,e,i){super(),this.titleService=t,this.fleetsService=e,this.mapService=i}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des flottes - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(zY),Oa(Pj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-fleets-panel\"]],features:[Uo],decls:9,vars:1,consts:[[\"joyrideStep\",\"fleets-panel\",\"title\",\"Flottes de navires\",\"text\",\"C'est ici que vous pouvez cr\\xe9er et suivre vos flottes de navires.\",1,\"panel\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\",\"u-flex\"],[\"resourcesKey\",\"fleets\",\"privateResourcesTitle\",\"Flottes priv\\xe9es\",\"emptyMessage\",\"Aucune flotte\",1,\"scrollable\",3,\"resources$\"],[\"createTemplate\",\"\"],[\"resourceTemplate\",\"\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",\"routerLink\",\"/fleets/new\",1,\"ma-2\",3,\"queryParams\"],[\"mat-button\",\"\",3,\"routerLink\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"h2\",2),xl(3,\"Flottes\"),Fa(),Fa(),La(4,\"app-resources-panel\",3),oa(5,Uit,4,3,\"ng-template\",null,4,Lh),oa(7,jit,4,5,\"ng-template\",null,5,Lh),Fa(),Fa()),2&t&&(Cr(4),Ra(\"resources$\",e.fleetsService.fleets$))},directives:[AF,D5,Ly,mL,uE],styles:[\"\"],data:{animation:[h5]}}),t})(),Git=(()=>{class t{constructor(t){this.workerService=t,this.companies$=new Jp(null),this.companiesFetched=null,this.companiesPanelState$=new Jp({nameFilter:\"\",scrollIndex:0})}fetchCompanies(){return Hp(this,void 0,void 0,function*(){this.companiesFetched||(this.companiesFetched=this.workerService.lloyds.listCompanies(),this.companies$.next(yield this.companiesFetched))})}updateScrollIndex(t){this.companiesPanelState$.value.scrollIndex=t,this.companiesPanelState$.next(this.companiesPanelState$.value)}updateNameFilter(t){this.companiesPanelState$.value.nameFilter=t,this.companiesPanelState$.next(this.companiesPanelState$.value)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function Wit(t,e){if(1&t){const t=$a();La(0,\"button\",11),Ga(\"click\",function(e){Fe(t);const i=Ka();return e.stopPropagation(),i.lloydsCompaniesService.updateNameFilter(\"\")}),La(1,\"mat-icon\"),xl(2,\"close\"),Fa(),Fa()}}function qit(t,e){1&t&&Na(0,\"mat-spinner\",12)}function Yit(t,e){1&t&&(La(0,\"p\",13),xl(1,\"Aucun r\\xe9sultat\"),Fa())}const Zit=function(t){return[\"/lloyds/companies/\",t]};function Kit(t,e){if(1&t&&(La(0,\"button\",14),xl(1),Fa()),2&t){const t=e.$implicit;tl(\"title\",t.name),Ra(\"routerLink\",ih(3,Zit,t.id)),Cr(1),Cl(\" \",t.name,\" \")}}let Xit=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.titleService=t,this.lloydsCompaniesService=e,this.mapService=i,this.offlineService=n,this.workerService=s,this.loading=!0,this.filteredCompanies=[],this.contentCheckCount=0}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des entreprises Lloyds - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(JT([this.lloydsCompaniesService.companiesPanelState$.pipe(sf(t=>{this.companiesPanelState=t})),this.lloydsCompaniesService.companies$.pipe(Af(t=>null!==t))]).pipe(M(([t,e])=>{if(0===t.nameFilter.length)return e;const i=pU(t.nameFilter);return e.filter(t=>t.normalizedName.includes(i))})).subscribe(t=>{this.filteredCompanies=t,this.loading=!1,this.scrollViewport&&this.scrollViewport.checkViewportSize()})),this.lloydsCompaniesService.fetchCompanies()})}ngAfterViewInit(){this.subscriptions.push(this.scrollViewport.scrolledIndexChange.pipe(kf(1)).subscribe(t=>{this.lloydsCompaniesService.updateScrollIndex(t)}))}ngAfterViewChecked(){this.contentCheckCount<5&&(this.scrollViewport.scrollToIndex(this.companiesPanelState.scrollIndex),this.contentCheckCount++)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(Git),Oa(Pj),Oa(MY),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-lloyds-companies-panel\"]],viewQuery:function(t,e){if(1&t&&Th(qg,5),2&t){let t;Mh(t=Ph())&&(e.scrollViewport=t.first)}},features:[Uo],decls:17,vars:6,consts:[[\"joyrideStep\",\"companies-panel\",\"title\",\"Recherche d'entreprises\",\"text\",\"Vous pouvez rechercher et acc\\xe9der aux entreprises inscrites au registre Lloyds.\",1,\"panel\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\",\"u-flex\"],[1,\"px-3\"],[1,\"d-block\",\"px-3\"],[\"matInput\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"title\",\"R\\xe9initialiser le filtre\",3,\"click\",4,\"ngIf\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[\"class\",\"px-3 u-center\",4,\"ngIf\"],[1,\"companies-scroll\",3,\"itemSize\"],[\"mat-button\",\"\",\"class\",\"d-block u-left button-events\",\"style\",\"height: 36px; overflow-x: hidden\",3,\"routerLink\",\"title\",4,\"cdkVirtualFor\",\"cdkVirtualForOf\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"title\",\"R\\xe9initialiser le filtre\",3,\"click\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[1,\"px-3\",\"u-center\"],[\"mat-button\",\"\",1,\"d-block\",\"u-left\",\"button-events\",2,\"height\",\"36px\",\"overflow-x\",\"hidden\",3,\"routerLink\",\"title\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"h2\",2),xl(3,\"Recherche d'entreprises\"),Fa(),Fa(),La(4,\"h3\",3),xl(5,\"Filtres\"),Fa(),La(6,\"mat-form-field\",4),La(7,\"mat-label\"),xl(8,\"Nom\"),Fa(),La(9,\"input\",5),Ga(\"ngModelChange\",function(t){return e.lloydsCompaniesService.updateNameFilter(t)}),Fa(),oa(10,Wit,3,0,\"button\",6),Fa(),La(11,\"h3\",3),xl(12,\"Liste\"),Fa(),oa(13,qit,1,0,\"mat-spinner\",7),oa(14,Yit,2,0,\"p\",8),La(15,\"cdk-virtual-scroll-viewport\",9),oa(16,Kit,2,5,\"button\",10),Fa(),Fa()),2&t&&(Cr(9),Ra(\"ngModel\",e.companiesPanelState.nameFilter),Cr(1),Ra(\"ngIf\",e.companiesPanelState.nameFilter.length>0),Cr(3),Ra(\"ngIf\",e.loading),Cr(1),Ra(\"ngIf\",!e.loading&&0===e.filteredCompanies.length),Cr(1),Ra(\"itemSize\",36),Cr(1),Ra(\"cdkVirtualForOf\",e.filteredCompanies))},directives:[AF,AS,aS,ES,Gy,Sw,nx,Vd,qg,Ug,Zg,Ly,dS,uE,KJ,mL],styles:[\".companies-scroll[_ngcontent-%COMP%]{flex:1;overflow-x:hidden}  .companies-scroll>.cdk-virtual-scroll-content-wrapper{width:100%}\"]}),t})();const Qit=[\"fleetNameInput\"];function Jit(t,e){if(1&t){const t=$a();La(0,\"button\",2),Ga(\"click\",function(){return Fe(t),Ka().toggleForm()}),La(1,\"mat-icon\"),xl(2,\"add\"),Fa(),xl(3,\" Nouvelle flotte\\n\"),Fa()}}function tnt(t,e){if(1&t){const t=$a();La(0,\"mat-form-field\",3),La(1,\"input\",4,5),Ga(\"ngModelChange\",function(e){return Fe(t),Ka().fleetName=e})(\"keyup.enter\",function(){return Fe(t),Ka().save()}),Fa(),Fa(),La(3,\"button\",6),La(4,\"mat-icon\"),xl(5,\"check\"),Fa(),Fa(),La(6,\"button\",7),Ga(\"click\",function(){return Fe(t),Ka().toggleForm()}),La(7,\"mat-icon\"),xl(8,\"cancel\"),Fa(),Fa()}if(2&t){const t=Ka();Cr(1),Ra(\"autofocus\",!0)(\"ngModel\",t.fleetName),Cr(2),Ra(\"app-async-action\",t.save)(\"disabled\",0===t.fleetName.length)}}let ent=(()=>{class t extends Gq{constructor(t){super(),this.fleetsService=t,this.showForm=!1,this.fleetName=\"\",this.createEmitter=new gh,this.save=()=>Hp(this,void 0,void 0,function*(){const t=yield this.fleetsService.createFleet({name:this.fleetName,group_id:this.groupId,ships:this.mmsis.map(t=>({mmsi:t}))});this.createEmitter.emit(t)})}ngOnInit(){this.ensureMandatoryInputParams(\"mmsis\")}toggleForm(){this.showForm=!this.showForm,this.showForm&&setTimeout(()=>{this.fleetNameInput.nativeElement.focus()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(zY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-create-fleet-button\"]],viewQuery:function(t,e){if(1&t&&Th(Qit,5),2&t){let t;Mh(t=Ph())&&(e.fleetNameInput=t.first)}},inputs:{groupId:\"groupId\",mmsis:\"mmsis\"},outputs:{createEmitter:\"create\"},features:[Uo],decls:2,vars:2,consts:[[\"mat-button\",\"\",\"class\",\"d-block\",3,\"click\",4,\"ngIf\"],[3,\"ngIf\"],[\"mat-button\",\"\",1,\"d-block\",3,\"click\"],[1,\"u-flex\",\"auto-width\"],[\"matInput\",\"\",\"placeholder\",\"Nom de la flotte\",3,\"autofocus\",\"ngModel\",\"ngModelChange\",\"keyup.enter\"],[\"fleetNameInput\",\"\"],[\"mat-button\",\"\",\"title\",\"Enregistrer\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Annuler\",3,\"click\"]],template:function(t,e){1&t&&(oa(0,Jit,4,0,\"button\",0),oa(1,tnt,9,4,\"ng-template\",1)),2&t&&(Ra(\"ngIf\",!e.showForm),Cr(1),Ra(\"ngIf\",e.showForm))},directives:[Vd,Ly,uE,AS,ES,Gy,Sw,nx,Jq],styles:[\"[_nghost-%COMP%]{display:flex;width:100%}\"]}),t})();function int(t,e){if(1&t){const t=$a();La(0,\"button\",11),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka(2).addShipsToFleet(e.id)}),xl(1),Fa()}if(2&t){const t=e.$implicit;Cr(1),Cl(\" \",t.name,\" \")}}function nnt(t,e){if(1&t){const t=$a();La(0,\"div\",6),La(1,\"div\",7),xl(2),Fa(),La(3,\"app-create-fleet-button\",10),Ga(\"create\",function(e){return Fe(t),Ka().closeDialog(e)}),Fa(),oa(4,int,2,1,\"button\",9),Fa()}if(2&t){const t=e.$implicit,i=Ka();Cr(2),Sl(t.name),Cr(1),Ra(\"groupId\",t.id)(\"mmsis\",i.data.mmsis),Cr(1),Ra(\"ngForOf\",t.fleets)}}function snt(t,e){if(1&t){const t=$a();La(0,\"button\",11),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka().addShipsToFleet(e.id)}),xl(1),Fa()}if(2&t){const t=e.$implicit;Cr(1),Cl(\" \",t.name,\" \")}}let rnt=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.data=t,this.fleetsService=e,this.groupsService=i,this.workerService=n,this.dialogRef=s,this.fleetGroups=[],this.personalFleets=[]}ngOnInit(){this.subscriptions.push(JT([this.groupsService.groups$,this.fleetsService.fleets$]).subscribe(([t,e])=>{const i=t.reduce((t,e)=>(t[e.id]=e,e.fleets=[],t),{}),n=[];e.forEach(t=>{if(t.group_id){const e=i[t.group_id];if(!e)return void console.log(`Le groupe ${t.group_id} de la flotte ${t.name} est inconnu`);e.fleets||(e.fleets=[]),e.fleets.push(t)}else n.push(t)}),this.fleetGroups=t.filter(t=>\"guest\"!==t.role),this.personalFleets=n}))}addShipsToFleet(t){return Hp(this,void 0,void 0,function*(){const e=yield this.workerService.fleets.get(t),i=BY(e);let n=!1;for(const t of this.data.mmsis)i.ships.includes(t)||(e.ships.push({mmsi:t}),n=!0);n&&(yield this.fleetsService.updateFleet(e)),this.dialogRef.close(t)})}closeDialog(t){this.dialogRef.close(t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(XC),Oa(zY),Oa(UY),Oa(sH),Oa(ZC))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-add-to-fleet-dialog\"]],features:[Uo],decls:15,vars:3,consts:[[1,\"d-flex\"],[1,\"dialog-title\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[1,\"d-flex-column\",\"dialog-content\",2,\"max-height\",\"60vh\",\"overflow\",\"auto\"],[\"class\",\"d-flex-column\",4,\"ngFor\",\"ngForOf\"],[1,\"d-flex-column\"],[1,\"py-1\"],[3,\"mmsis\",\"create\"],[\"mat-button\",\"\",\"title\",\"Ajouter \\xe0 la flotte\",3,\"click\",4,\"ngFor\",\"ngForOf\"],[3,\"groupId\",\"mmsis\",\"create\"],[\"mat-button\",\"\",\"title\",\"Ajouter \\xe0 la flotte\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"h1\",1),xl(2,\" Ajouter \\xe0 la flotte ... \"),Fa(),Na(3,\"div\",2),La(4,\"button\",3),La(5,\"mat-icon\"),xl(6,\"close\"),Fa(),Fa(),Fa(),Na(7,\"mat-divider\"),La(8,\"div\",4),oa(9,nnt,5,4,\"div\",5),La(10,\"div\",6),La(11,\"div\",7),xl(12,\"Flottes priv\\xe9es\"),Fa(),La(13,\"app-create-fleet-button\",8),Ga(\"create\",function(t){return e.closeDialog(t)}),Fa(),oa(14,snt,2,1,\"button\",9),Fa(),Fa()),2&t&&(Cr(9),Ra(\"ngForOf\",e.fleetGroups),Cr(4),Ra(\"mmsis\",e.data.mmsis),Cr(1),Ra(\"ngForOf\",e.personalFleets))},directives:[Ly,sk,uE,Xq,Bd,ent],styles:[\".dialog-title[_ngcontent-%COMP%]{margin:0;padding:16px}.dialog-content[_ngcontent-%COMP%]{padding:16px}\"],changeDetection:0}),t})();function ont(t){return`//${function(t){return rQ(ant,t).map(([t])=>t)}(t)[0]}`}const ant=/(?:https?:\\/\\/)?(\\S+)/gi;function lnt(t,e){if(1&t){const t=$a();La(0,\"button\",7),Ga(\"click\",function(){return Fe(t),Ka().locateShip()}),Na(1,\"app-flag\",8),La(2,\"div\",9),La(3,\"strong\",10),xl(4),Fa(),La(5,\"small\",11),xl(6),Fa(),Fa(),Fa()}if(2&t){const t=Ka();Ra(\"title\",t.hasPosition?\"Localiser le navire\":\"Ce navire n'a pas de position\")(\"disabled\",!t.hasPosition),Cr(1),Ra(\"mmsi\",t.ship.mmsi),Cr(3),Sl(t.ship.name||\"?\"),Cr(2),Sl(t.ship.cargo?t.vesselTypeLabelsByType[t.ship.cargo]:\"?\")}}function cnt(t,e){if(1&t&&(La(0,\"div\",12),Na(1,\"app-flag\",8),La(2,\"div\",9),La(3,\"strong\",10),xl(4),Fa(),La(5,\"small\",11),xl(6),Fa(),Fa(),Fa()),2&t){const t=Ka();Cr(1),Ra(\"mmsi\",t.ship.mmsi),Cr(3),Sl(t.ship.name||\"?\"),Cr(2),Sl(t.ship.cargo?t.vesselTypeLabelsByType[t.ship.cargo]:\"?\")}}const hnt=function(t){return[\"/ships/\",t]},unt=[\"*\"];let dnt=(()=>{class t extends Gq{constructor(t){super(),this.mapService=t,this.showLink=!0,this.vesselTypeLabelsByType=oU,this.hasPosition=!0}ngOnInit(){this.ensureMandatoryInputParams(\"ship\")}ngOnChanges(t){var e,i;t.ship&&(this.hasPosition=gU(null===(e=t.ship.currentValue)||void 0===e?void 0:e.lon)&&gU(null===(i=t.ship.currentValue)||void 0===i?void 0:i.lat))}locateShip(){this.mapService.pingLocation([this.ship.lon,this.ship.lat]),this.mapService.locate([this.ship.lon,this.ship.lat])}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ship-item\"]],inputs:{ship:\"ship\",showLink:\"showLink\"},features:[Uo,he],ngContentSelectors:unt,decls:15,vars:8,consts:[[1,\"ship-item__header\"],[\"mat-button\",\"\",\"class\",\"ship-item__link\",3,\"title\",\"disabled\",\"click\",4,\"ngIf\"],[\"class\",\"d-flex u-flex\",4,\"ngIf\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la fiche du navire\",1,\"d-center\",3,\"routerLink\"],[1,\"ship-item__row\"],[1,\"px-2\"],[1,\"ship-item__row\",\"ship-item__slot-row\"],[\"mat-button\",\"\",1,\"ship-item__link\",3,\"title\",\"disabled\",\"click\"],[1,\"ship-item__flag\",3,\"mmsi\"],[1,\"ship-item__title\"],[1,\"ship-item__name\"],[1,\"ship-item__type\"],[1,\"d-flex\",\"u-flex\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0),oa(1,lnt,7,5,\"button\",1),oa(2,cnt,7,3,\"div\",2),La(3,\"a\",3),La(4,\"mat-icon\"),xl(5,\"info\"),Fa(),Fa(),Fa(),La(6,\"div\",4),La(7,\"span\"),xl(8),Fa(),La(9,\"span\",5),xl(10),Fa(),La(11,\"span\"),xl(12),Fa(),Fa(),La(13,\"div\",6),Ja(14),Fa()),2&t&&(Cr(1),Ra(\"ngIf\",e.showLink),Cr(1),Ra(\"ngIf\",!e.showLink),Cr(1),Ra(\"routerLink\",ih(6,hnt,e.ship.mmsi)),Cr(5),Cl(\"MMSI \",e.ship.mmsi,\"\"),Cr(2),Cl(\"IMO \",e.ship.imo||\"?\",\"\"),Cr(2),Cl(\"Callsign \",e.ship.callsign||\"?\",\"\"))},directives:[Vd,Fy,gL,uE,Ly,MJ],styles:[\".ship-item__header[_ngcontent-%COMP%]{display:flex;padding:4px 4px 0}.ship-item__link[_ngcontent-%COMP%]{flex:1;padding:0;line-height:inherit;text-align:inherit;font-size:inherit;font-weight:inherit}.ship-item__link[_ngcontent-%COMP%]     .mat-button-wrapper{display:flex}.ship-item__flag[_ngcontent-%COMP%]{margin:5px}.ship-item__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px 0;flex:1}.ship-item__type[_ngcontent-%COMP%]{font-size:.9em;color:#555}.ship-item__row[_ngcontent-%COMP%]{padding:0 8px 4px;display:flex;justify-content:space-between;font-size:.9em;flex-wrap:wrap}.ship-item__slot-row[_ngcontent-%COMP%]:empty{display:none}\"],changeDetection:0}),t})();function pnt(t,e){1&t&&Na(0,\"mat-spinner\",5)}function fnt(t,e){if(1&t&&(La(0,\"a\",30),xl(1),Fa()),2&t){const t=Ka(2);Ra(\"href\",\"tel:\"+t.company.telephone,Ss),Cr(1),Sl(t.company.telephone)}}function mnt(t,e){1&t&&(La(0,\"span\",12),xl(1,\"?\"),Fa())}function gnt(t,e){if(1&t&&(La(0,\"a\",30),xl(1),Fa()),2&t){const t=Ka(2);Ra(\"href\",\"mailto:\"+t.company.email,Ss),Cr(1),Sl(t.company.email)}}function Ant(t,e){1&t&&(La(0,\"span\",12),xl(1,\"?\"),Fa())}function vnt(t,e){if(1&t&&(La(0,\"a\",30),xl(1),Fa()),2&t){const t=Ka(2);Ra(\"href\",t.websiteLink,Ss),Cr(1),Sl(t.company.website)}}function _nt(t,e){1&t&&(La(0,\"span\",12),xl(1,\"?\"),Fa())}function bnt(t,e){if(1&t&&(La(0,\"mat-option\",31),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.key),Cr(1),Cl(\" \",t.label,\" \")}}function ynt(t,e){if(1&t){const t=$a();La(0,\"button\",32),Ga(\"click\",function(e){Fe(t);const i=Ka(2);return e.stopPropagation(),i.updateRoleFilter([])}),La(1,\"mat-icon\"),xl(2,\"close\"),Fa(),Fa()}}function wnt(t,e){1&t&&(La(0,\"p\",33),xl(1,\"Aucun navire\"),Fa())}function xnt(t,e){if(1&t&&(La(0,\"app-ship-item\",34),La(1,\"div\"),La(2,\"span\",35),xl(3,\"BO\"),Fa(),La(4,\"span\",36),xl(5,\"CO\"),Fa(),La(6,\"span\",37),xl(7,\"RO\"),Fa(),La(8,\"span\",38),xl(9,\"TM\"),Fa(),La(10,\"span\",39),xl(11,\"TO\"),Fa(),Fa(),Fa()),2&t){const t=e.$implicit;Ra(\"ship\",t),Cr(2),hl(\"role--disabled\",!t.isbeneficialowner),Cr(2),hl(\"role--disabled\",!t.iscommercialoperator),Cr(2),hl(\"role--disabled\",!t.isregisteredowner),Cr(2),hl(\"role--disabled\",!t.istechnicalmanager),Cr(2),hl(\"role--disabled\",!t.isthirdpartoperator)}}function Snt(t,e){if(1&t){const t=$a();La(0,\"div\",6),La(1,\"h2\",7),xl(2),Fa(),Fa(),La(3,\"div\",8),La(4,\"div\",9),La(5,\"div\",10),La(6,\"span\",11),xl(7,\"All\\xe9geance\\xa0:\"),Fa(),La(8,\"span\",12),xl(9),Fa(),Fa(),La(10,\"div\",10),La(11,\"span\",11),xl(12,\"Si\\xe8ge social\\xa0:\"),Fa(),La(13,\"span\",12),xl(14),Fa(),Fa(),Fa(),La(15,\"div\"),La(16,\"div\",13),La(17,\"span\",11),xl(18,\"T\\xe9l\\xe9phone\\xa0:\"),Fa(),oa(19,fnt,2,2,\"a\",14),oa(20,mnt,2,0,\"span\",15),Fa(),La(21,\"div\",13),La(22,\"span\",11),xl(23,\"E-mail\\xa0:\"),Fa(),oa(24,gnt,2,2,\"a\",14),oa(25,Ant,2,0,\"span\",15),Fa(),La(26,\"div\",13),La(27,\"span\",11),xl(28,\"Site web\\xa0:\"),Fa(),oa(29,vnt,2,2,\"a\",14),oa(30,_nt,2,0,\"span\",15),Fa(),Fa(),La(31,\"div\",10),La(32,\"div\",16),xl(33,\"Adresse\"),Fa(),La(34,\"div\",12),xl(35),Fa(),La(36,\"div\",12),xl(37),Fa(),La(38,\"div\",12),xl(39),Fa(),La(40,\"div\",12),xl(41),Fa(),Fa(),Fa(),La(42,\"div\",17),La(43,\"h4\",18),xl(44,\"Navires li\\xe9s\"),Fa(),La(45,\"button\",19),Ga(\"click\",function(){return Fe(t),Ka().openExportDataDialog()}),La(46,\"mat-icon\"),xl(47,\"file_download\"),Fa(),Fa(),La(48,\"button\",20),Ga(\"click\",function(){return Fe(t),Ka().openAddToFleetDialog()}),La(49,\"mat-icon\"),xl(50,\"playlist_add\"),Fa(),Fa(),Fa(),La(51,\"mat-form-field\",21),La(52,\"mat-label\"),xl(53,\"Filtre par r\\xf4le\"),Fa(),La(54,\"mat-select\",22,23),Ga(\"ngModelChange\",function(e){return Fe(t),Ka().updateRoleFilter(e)}),Na(56,\"app-select-check-all\",24),oa(57,bnt,2,2,\"mat-option\",25),Fa(),oa(58,ynt,3,0,\"button\",26),La(59,\"mat-hint\"),xl(60,\"Mode \\xab ET \\xbb si multi-s\\xe9lection\"),Fa(),Fa(),oa(61,wnt,2,0,\"p\",27),ch(62,\"async\"),La(63,\"cdk-virtual-scroll-viewport\",28),oa(64,xnt,12,11,\"app-ship-item\",29),ch(65,\"async\"),Fa()}if(2&t){const t=aa(55),e=Ka();Cr(2),Sl(e.company.name),Cr(7),Sl(e.company.allegiancecountry||\"?\"),Cr(5),Sl(e.company.headofficecountry||\"?\"),Cr(5),Ra(\"ngIf\",e.company.telephone),Cr(1),Ra(\"ngIf\",!e.company.telephone),Cr(4),Ra(\"ngIf\",e.company.email),Cr(1),Ra(\"ngIf\",!e.company.email),Cr(4),Ra(\"ngIf\",e.company.website),Cr(1),Ra(\"ngIf\",!e.company.website),Cr(5),Sl(e.company.address||\"?\"),Cr(2),kl(\"\",e.company.postcode,\" \",e.company.town,\"\"),Cr(2),Sl(e.company.state),Cr(2),Sl(e.company.country),Cr(4),Ra(\"disabled\",0===e.filteredShips$.value.length),Cr(3),Ra(\"disabled\",0===e.filteredShips$.value.length),Cr(6),Ra(\"ngModel\",e.roleFilter),Cr(2),Ra(\"model\",t)(\"values\",e.companyRoles)(\"key\",\"key\"),Cr(1),Ra(\"ngForOf\",e.companyRoles),Cr(1),Ra(\"ngIf\",e.roleFilter.length>0),Cr(3),Ra(\"ngIf\",0===hh(62,25,e.filteredShips$).length),Cr(2),Ra(\"itemSize\",70),Cr(1),Ra(\"cdkVirtualForOf\",hh(65,27,e.filteredShips$))}}let Cnt=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o,a,l,c,h,u){super(),this.activatedRoute=t,this.titleService=e,this.dialog=i,this.configService=n,this.exportService=s,this.interactionsService=r,this.mapConfigService=o,this.mapService=a,this.offlineService=l,this.routeService=c,this.uiService=h,this.workerService=u,this.loading=!0,this.company=null,this.websiteLink=\"\",this.ships$=new Jp([]),this.filteredShips$=new Jp([]),this.companyRoles=[{label:\"Beneficial owner\",key:\"isbeneficialowner\"},{label:\"Commercial operator\",key:\"iscommercialoperator\"},{label:\"Registered owner\",key:\"isregisteredowner\"},{label:\"Technical manager\",key:\"istechnicalmanager\"},{label:\"Third-party operator\",key:\"isthirdpartoperator\"}],this.roleFilter=[],this.roleFilter$=new Jp(this.roleFilter)}ngOnInit(){return Hp(this,void 0,void 0,function*(){if(this.offlineService.isOffline$.value)return this.uiService.error(\"Cette page n'est pas disponible en mode hors-ligne\"),void(yield this.routeService.goToPreviousPage());this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.activatedRoute.paramMap.pipe(M(t=>t.get(\"companyId\"))).subscribe(t=>Hp(this,void 0,void 0,function*(){try{yield Promise.all([(()=>Hp(this,void 0,void 0,function*(){this.company=yield this.workerService.lloyds.getCompany(t),this.titleService.setTitle(`Entreprise ${this.company.name} - ANAIS`),this.websiteLink=ont(this.company.website)}))(),(()=>Hp(this,void 0,void 0,function*(){this.ships$.next(yield this.workerService.lloyds.listCompanyShips(t))}))()]),this.loading=!1}catch(e){this.uiService.error(`L'entreprise ${t} est inconnue.`),yield this.routeService.goToPreviousPage()}})),this.subscriptions.push(JT([this.ships$,this.roleFilter$]).pipe(M(([t,e])=>{if(0===e.length)return t;const i=e.reduce((t,e)=>(t[e]=!0,t),{});return t.filter(t=>(!i.isbeneficialowner||i.isbeneficialowner&&t.isbeneficialowner)&&(!i.iscommercialoperator||i.iscommercialoperator&&t.iscommercialoperator)&&(!i.isregisteredowner||i.isregisteredowner&&t.isregisteredowner)&&(!i.istechnicalmanager||i.istechnicalmanager&&t.istechnicalmanager)&&(!i.isthirdpartoperator||i.isthirdpartoperator&&t.isthirdpartoperator))})).subscribe(t=>{this.filteredShips$.next(t)}))})}updateRoleFilter(t){this.roleFilter=t,this.roleFilter$.next(t)}openAddToFleetDialog(){this.dialog.open(rnt,{panelClass:\"no-border-dialog\",maxHeight:\"90vh\",maxWidth:\"90vw\",minWidth:\"300px\",autoFocus:!1,closeOnNavigation:!0,hasBackdrop:!0,data:{mmsis:this.filteredShips$.value.map(t=>t.mmsi)}})}openExportDataDialog(){this.exportService.openExportDataDialog({mmsis:this.filteredShips$.value.map(t=>t.mmsi),label:`des navires li\\xe9s \\xe0 l'entreprise ${this.company.name}`})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(GR),Oa(jp),Oa(ik),Oa(WU),Oa(CY),Oa(DY),Oa(qU),Oa(Pj),Oa(MY),Oa(Nj),Oa(_H),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-lloyds-company-panel\"]],features:[Uo],decls:8,vars:2,consts:[[1,\"panel\",\"port-panel\",\"u-flex\"],[1,\"d-flex\",2,\"background-color\",\"#fff\"],[\"mat-button\",\"\",\"title\",\"Revenir \\xe0 la liste\",\"routerLink\",\"/lloyds/companies\",1,\"back-button\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\",\"u-flex\",2,\"font-size\",\"18px\"],[1,\"mat-body\"],[1,\"d-flex\"],[1,\"property\",\"u-flex\"],[1,\"property-label\",\"mr-1\"],[1,\"property-value\"],[1,\"property\"],[\"target\",\"_blank\",\"class\",\"property-value\",3,\"href\",4,\"ngIf\"],[\"class\",\"property-value\",4,\"ngIf\"],[1,\"property-label\"],[1,\"d-flex-center\"],[1,\"u-flex\",\"ml-2\",\"my-0\"],[\"mat-button\",\"\",\"title\",\"Exporter les donn\\xe9es des navires li\\xe9s \\xe0 l'entreprise au format CSV\",3,\"disabled\",\"click\"],[\"mat-button\",\"\",\"title\",\"Ajouter tous les navires \\xe0 une flotte\",1,\"ship-details-panel__action\",3,\"disabled\",\"click\"],[1,\"d-block\",\"px-3\"],[\"multiple\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"roleSelection\",\"ngModel\"],[3,\"model\",\"values\",\"key\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"title\",\"R\\xe9initialiser le filtre\",3,\"click\",4,\"ngIf\"],[\"class\",\"panel__content\",4,\"ngIf\"],[1,\"ships-scroll\",3,\"itemSize\"],[3,\"ship\",4,\"cdkVirtualFor\",\"cdkVirtualForOf\"],[\"target\",\"_blank\",1,\"property-value\",3,\"href\"],[3,\"value\"],[\"mat-button\",\"\",\"matSuffix\",\"\",\"mat-icon-button\",\"\",\"title\",\"R\\xe9initialiser le filtre\",3,\"click\"],[1,\"panel__content\"],[3,\"ship\"],[\"title\",\"Beneficial owner\",1,\"role\"],[\"title\",\"Commercial operator\",1,\"role\"],[\"title\",\"Registered owner\",1,\"role\"],[\"title\",\"Technical manager\",1,\"role\"],[\"title\",\"Third-party operator\",1,\"role\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"a\",2),La(3,\"mat-icon\"),xl(4,\"arrow_back_ios\"),Fa(),xl(5,\" Entreprises \"),Fa(),Fa(),oa(6,pnt,1,0,\"mat-spinner\",3),oa(7,Snt,66,29,\"ng-template\",4),Fa()),2&t&&(Cr(6),Ra(\"ngIf\",e.loading),Cr(1),Ra(\"ngIf\",!e.loading))},directives:[Fy,gL,uE,Vd,KJ,Ly,AS,aS,qT,Sw,nx,C3,Bd,oS,qg,Ug,Zg,ky,dS,dnt],pipes:[tp],styles:[\"[_nghost-%COMP%]{display:flex;height:100%}.back-button[_ngcontent-%COMP%]{line-height:36px}.property[_ngcontent-%COMP%]{padding:4px;border:1px solid rgba(0,0,0,.12);text-align:center;min-width:100px}.property--large[_ngcontent-%COMP%]{flex-basis:100%;display:flex;align-items:center}.property-label[_ngcontent-%COMP%]{color:gray;font-weight:500}.property-value[_ngcontent-%COMP%]{font-weight:bold}.ships-scroll[_ngcontent-%COMP%]{height:100%;overflow-x:hidden}  .ships-scroll>.cdk-virtual-scroll-content-wrapper{width:100%}.role[_ngcontent-%COMP%]{font-weight:500;margin-right:16px;cursor:help}.role--disabled[_ngcontent-%COMP%]{font-weight:400;color:#bbb}\"]}),t})(),knt=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.titleService=t,this.historyService=e,this.mapService=i,this.offlineService=n,this.selectionService=s}ngOnInit(){this.titleService.setTitle(\"Mode hors-ligne - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.historyService.resetTimestamp(),this.selectionService.clear(),setTimeout(()=>{this.offlineService.enterSetupMode()})}ngOnDestroy(){super.ngOnDestroy(),this.offlineService.exitSetupMode()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(Fj),Oa(Pj),Oa(MY),Oa(IY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-offline-loader\"]],features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})(),Ent=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.titleService=t,this.historyService=e,this.mapService=i,this.playbackService=n,this.selectionService=s}ngOnInit(){this.titleService.setTitle(\"Rejeu de situation - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.historyService.resetTimestamp(),this.selectionService.clear(),setTimeout(()=>{this.playbackService.enterPlaybackMode()})}ngOnDestroy(){super.ngOnDestroy(),this.playbackService.exitPlaybackMode()}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(Fj),Oa(Pj),Oa(Rq),Oa(IY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-playback-loader\"]],features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})(),Mnt=(()=>{class t{constructor(t,e,i){this.mapConfigService=t,this.mapService=e,this.uiService=i,this.isSelectingArea$=new Jp(!1),this.isSelectingArea$.pipe(kf(1)).subscribe(t=>{this.uiService.setDrawingMode(t)})}startSelectingArea(){this.isSelectingArea$.next(!0)}cancelSelectingArea(){this.isSelectingArea$.next(!1)}finishSelectingArea(){this.mapConfigService.updateRestrictedAreas(MU.fromOLExtent(this.mapService.view$.value.extent).toLatLonExtent()),this.cancelSelectingArea()}removeArea(){this.mapConfigService.updateRestrictedAreas(null)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(qU),Mn(Pj),Mn(_H))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();const Tnt=[\"sliderWrapper\"],Int=Qf({passive:!1}),Pnt={provide:Uy,useExisting:at(()=>Dnt),multi:!0};class Ont{}const Rnt=Vb(Bb(Nb(class{constructor(t){this._elementRef=t}}),\"accent\"));let Dnt=(()=>{class t extends Rnt{constructor(t,e,i,n,s,r,o,a){super(t),this._focusMonitor=e,this._changeDetectorRef=i,this._dir=n,this._ngZone=r,this._animationMode=a,this._invert=!1,this._max=100,this._min=0,this._step=1,this._thumbLabel=!1,this._tickInterval=0,this._value=null,this._vertical=!1,this.change=new gh,this.input=new gh,this.valueChange=new gh,this.onTouched=()=>{},this._percent=0,this._isSliding=null,this._isActive=!1,this._tickIntervalPercent=0,this._sliderDimensions=null,this._controlValueAccessorChangeFn=()=>{},this._dirChangeSubscription=d.EMPTY,this._pointerDown=t=>{this.disabled||this._isSliding||!Lnt(t)&&0!==t.button||this._ngZone.run(()=>{this._touchId=Lnt(t)?function(t,e){for(let i=0;i<t.touches.length;i++){const n=t.touches[i].target;if(e===n||e.contains(n))return t.touches[i].identifier}}(t,this._elementRef.nativeElement):void 0;const e=Fnt(t,this._touchId);if(e){const i=this.value;this._isSliding=\"pointer\",this._lastPointerEvent=t,t.preventDefault(),this._focusHostElement(),this._onMouseenter(),this._bindGlobalEvents(t),this._focusHostElement(),this._updateValueFromPosition(e),this._valueOnSlideStart=i,i!=this.value&&this._emitInputEvent()}})},this._pointerMove=t=>{if(\"pointer\"===this._isSliding){const e=Fnt(t,this._touchId);if(e){t.preventDefault();const i=this.value;this._lastPointerEvent=t,this._updateValueFromPosition(e),i!=this.value&&this._emitInputEvent()}}},this._pointerUp=t=>{\"pointer\"===this._isSliding&&(!Lnt(t)||\"number\"!=typeof this._touchId||Nnt(t.changedTouches,this._touchId))&&(t.preventDefault(),this._removeGlobalEvents(),this._isSliding=null,this._touchId=void 0,this._valueOnSlideStart!=this.value&&!this.disabled&&this._emitChangeEvent(),this._valueOnSlideStart=this._lastPointerEvent=null)},this._windowBlur=()=>{this._lastPointerEvent&&this._pointerUp(this._lastPointerEvent)},this._document=o,this.tabIndex=parseInt(s)||0,r.runOutsideAngular(()=>{const e=t.nativeElement;e.addEventListener(\"mousedown\",this._pointerDown,Int),e.addEventListener(\"touchstart\",this._pointerDown,Int)})}get invert(){return this._invert}set invert(t){this._invert=Lf(t)}get max(){return this._max}set max(t){this._max=Ff(t,this._max),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get min(){return this._min}set min(t){this._min=Ff(t,this._min),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get step(){return this._step}set step(t){this._step=Ff(t,this._step),this._step%1!=0&&(this._roundToDecimal=this._step.toString().split(\".\").pop().length),this._changeDetectorRef.markForCheck()}get thumbLabel(){return this._thumbLabel}set thumbLabel(t){this._thumbLabel=Lf(t)}get tickInterval(){return this._tickInterval}set tickInterval(t){this._tickInterval=\"auto\"===t?\"auto\":\"number\"==typeof t||\"string\"==typeof t?Ff(t,this._tickInterval):0}get value(){return null===this._value&&(this.value=this._min),this._value}set value(t){if(t!==this._value){let e=Ff(t,0);this._roundToDecimal&&e!==this.min&&e!==this.max&&(e=parseFloat(e.toFixed(this._roundToDecimal))),this._value=e,this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}}get vertical(){return this._vertical}set vertical(t){this._vertical=Lf(t)}get displayValue(){return this.displayWith?this.displayWith(this.value):this._roundToDecimal&&this.value&&this.value%1!=0?this.value.toFixed(this._roundToDecimal):this.value||0}focus(t){this._focusHostElement(t)}blur(){this._blurHostElement()}get percent(){return this._clamp(this._percent)}_shouldInvertAxis(){return this.vertical?!this.invert:this.invert}_isMinValue(){return 0===this.percent}_getThumbGap(){return this.disabled?7:this._isMinValue()&&!this.thumbLabel?this._isActive?10:7:0}_getTrackBackgroundStyles(){const t=this.vertical?`1, ${1-this.percent}, 1`:1-this.percent+\", 1, 1\";return{transform:`translate${this.vertical?\"Y\":\"X\"}(${this._shouldInvertMouseCoords()?\"-\":\"\"}${this._getThumbGap()}px) scale3d(${t})`}}_getTrackFillStyles(){const t=this.percent,e=this.vertical?`1, ${t}, 1`:`${t}, 1, 1`;return{transform:`translate${this.vertical?\"Y\":\"X\"}(${this._shouldInvertMouseCoords()?\"\":\"-\"}${this._getThumbGap()}px) scale3d(${e})`,display:0===t?\"none\":\"\"}}_getTicksContainerStyles(){return{transform:`translate${this.vertical?\"Y\":\"X\"}(${this.vertical||\"rtl\"!=this._getDirection()?\"-\":\"\"}${this._tickIntervalPercent/2*100}%)`}}_getTicksStyles(){let t=100*this._tickIntervalPercent,e={backgroundSize:this.vertical?`2px ${t}%`:`${t}% 2px`,transform:`translateZ(0) translate${this.vertical?\"Y\":\"X\"}(${this.vertical||\"rtl\"!=this._getDirection()?\"\":\"-\"}${t/2}%)${this.vertical||\"rtl\"!=this._getDirection()?\"\":\" rotate(180deg)\"}`};if(this._isMinValue()&&this._getThumbGap()){const t=this._shouldInvertAxis();let i;i=this.vertical?t?\"Bottom\":\"Top\":t?\"Right\":\"Left\",e[`padding${i}`]=`${this._getThumbGap()}px`}return e}_getThumbContainerStyles(){const t=this._shouldInvertAxis();return{transform:`translate${this.vertical?\"Y\":\"X\"}(-${100*((\"rtl\"!=this._getDirection()||this.vertical?t:!t)?this.percent:1-this.percent)}%)`}}_shouldInvertMouseCoords(){const t=this._shouldInvertAxis();return\"rtl\"!=this._getDirection()||this.vertical?t:!t}_getDirection(){return this._dir&&\"rtl\"==this._dir.value?\"rtl\":\"ltr\"}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{this._isActive=!!t&&\"keyboard\"!==t,this._changeDetectorRef.detectChanges()}),this._dir&&(this._dirChangeSubscription=this._dir.change.subscribe(()=>{this._changeDetectorRef.markForCheck()}))}ngOnDestroy(){const t=this._elementRef.nativeElement;t.removeEventListener(\"mousedown\",this._pointerDown,Int),t.removeEventListener(\"touchstart\",this._pointerDown,Int),this._lastPointerEvent=null,this._removeGlobalEvents(),this._focusMonitor.stopMonitoring(this._elementRef),this._dirChangeSubscription.unsubscribe()}_onMouseenter(){this.disabled||(this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent())}_onFocus(){this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent()}_onBlur(){this.onTouched()}_onKeydown(t){if(this.disabled||ef(t)||this._isSliding&&\"keyboard\"!==this._isSliding)return;const e=this.value;switch(t.keyCode){case 33:this._increment(10);break;case 34:this._increment(-10);break;case 35:this.value=this.max;break;case 36:this.value=this.min;break;case 37:this._increment(\"rtl\"==this._getDirection()?1:-1);break;case 38:this._increment(1);break;case 39:this._increment(\"rtl\"==this._getDirection()?-1:1);break;case 40:this._increment(-1);break;default:return}e!=this.value&&(this._emitInputEvent(),this._emitChangeEvent()),this._isSliding=\"keyboard\",t.preventDefault()}_onKeyup(){\"keyboard\"===this._isSliding&&(this._isSliding=null)}_getWindow(){return this._document.defaultView||window}_bindGlobalEvents(t){const e=this._document,i=Lnt(t),n=i?\"touchend\":\"mouseup\";e.addEventListener(i?\"touchmove\":\"mousemove\",this._pointerMove,Int),e.addEventListener(n,this._pointerUp,Int),i&&e.addEventListener(\"touchcancel\",this._pointerUp,Int);const s=this._getWindow();void 0!==s&&s&&s.addEventListener(\"blur\",this._windowBlur)}_removeGlobalEvents(){const t=this._document;t.removeEventListener(\"mousemove\",this._pointerMove,Int),t.removeEventListener(\"mouseup\",this._pointerUp,Int),t.removeEventListener(\"touchmove\",this._pointerMove,Int),t.removeEventListener(\"touchend\",this._pointerUp,Int),t.removeEventListener(\"touchcancel\",this._pointerUp,Int);const e=this._getWindow();void 0!==e&&e&&e.removeEventListener(\"blur\",this._windowBlur)}_increment(t){this.value=this._clamp((this.value||0)+this.step*t,this.min,this.max)}_updateValueFromPosition(t){if(!this._sliderDimensions)return;let e=this._clamp(((this.vertical?t.y:t.x)-(this.vertical?this._sliderDimensions.top:this._sliderDimensions.left))/(this.vertical?this._sliderDimensions.height:this._sliderDimensions.width));if(this._shouldInvertMouseCoords()&&(e=1-e),0===e)this.value=this.min;else if(1===e)this.value=this.max;else{const t=this._calculateValue(e),i=Math.round((t-this.min)/this.step)*this.step+this.min;this.value=this._clamp(i,this.min,this.max)}}_emitChangeEvent(){this._controlValueAccessorChangeFn(this.value),this.valueChange.emit(this.value),this.change.emit(this._createChangeEvent())}_emitInputEvent(){this.input.emit(this._createChangeEvent())}_updateTickIntervalPercent(){if(this.tickInterval&&this._sliderDimensions)if(\"auto\"==this.tickInterval){let t=this.vertical?this._sliderDimensions.height:this._sliderDimensions.width,e=Math.ceil(30/(t*this.step/(this.max-this.min)))*this.step;this._tickIntervalPercent=e/t}else this._tickIntervalPercent=this.tickInterval*this.step/(this.max-this.min)}_createChangeEvent(t=this.value){let e=new Ont;return e.source=this,e.value=t,e}_calculatePercentage(t){return((t||0)-this.min)/(this.max-this.min)}_calculateValue(t){return this.min+t*(this.max-this.min)}_clamp(t,e=0,i=1){return Math.max(e,Math.min(t,i))}_getSliderDimensions(){return this._sliderWrapper?this._sliderWrapper.nativeElement.getBoundingClientRect():null}_focusHostElement(t){this._elementRef.nativeElement.focus(t)}_blurHostElement(){this._elementRef.nativeElement.blur()}writeValue(t){this.value=t}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(Vm),Oa(Mc),Oa(Eg,8),Yi(\"tabindex\"),Oa(nu),Oa(Fu),Oa(wb,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-slider\"]],viewQuery:function(t,e){if(1&t&&Th(Tnt,5),2&t){let t;Mh(t=Ph())&&(e._sliderWrapper=t.first)}},hostAttrs:[\"role\",\"slider\",1,\"mat-slider\",\"mat-focus-indicator\"],hostVars:29,hostBindings:function(t,e){1&t&&Ga(\"focus\",function(){return e._onFocus()})(\"blur\",function(){return e._onBlur()})(\"keydown\",function(t){return e._onKeydown(t)})(\"keyup\",function(){return e._onKeyup()})(\"mouseenter\",function(){return e._onMouseenter()})(\"selectstart\",function(t){return t.preventDefault()}),2&t&&(Il(\"tabIndex\",e.tabIndex),ia(\"aria-disabled\",e.disabled)(\"aria-valuemax\",e.max)(\"aria-valuemin\",e.min)(\"aria-valuenow\",e.value)(\"aria-valuetext\",null==e.valueText?e.displayValue:e.valueText)(\"aria-orientation\",e.vertical?\"vertical\":\"horizontal\"),hl(\"mat-slider-disabled\",e.disabled)(\"mat-slider-has-ticks\",e.tickInterval)(\"mat-slider-horizontal\",!e.vertical)(\"mat-slider-axis-inverted\",e._shouldInvertAxis())(\"mat-slider-invert-mouse-coords\",e._shouldInvertMouseCoords())(\"mat-slider-sliding\",e._isSliding)(\"mat-slider-thumb-label-showing\",e.thumbLabel)(\"mat-slider-vertical\",e.vertical)(\"mat-slider-min-value\",e._isMinValue())(\"mat-slider-hide-last-tick\",e.disabled||e._isMinValue()&&e._getThumbGap()&&e._shouldInvertAxis())(\"_mat-animation-noopable\",\"NoopAnimations\"===e._animationMode))},inputs:{disabled:\"disabled\",color:\"color\",tabIndex:\"tabIndex\",invert:\"invert\",max:\"max\",min:\"min\",step:\"step\",thumbLabel:\"thumbLabel\",tickInterval:\"tickInterval\",value:\"value\",vertical:\"vertical\",displayWith:\"displayWith\",valueText:\"valueText\"},outputs:{change:\"change\",input:\"input\",valueChange:\"valueChange\"},exportAs:[\"matSlider\"],features:[Yl([Pnt]),Uo],decls:13,vars:6,consts:[[1,\"mat-slider-wrapper\"],[\"sliderWrapper\",\"\"],[1,\"mat-slider-track-wrapper\"],[1,\"mat-slider-track-background\",3,\"ngStyle\"],[1,\"mat-slider-track-fill\",3,\"ngStyle\"],[1,\"mat-slider-ticks-container\",3,\"ngStyle\"],[1,\"mat-slider-ticks\",3,\"ngStyle\"],[1,\"mat-slider-thumb-container\",3,\"ngStyle\"],[1,\"mat-slider-focus-ring\"],[1,\"mat-slider-thumb\"],[1,\"mat-slider-thumb-label\"],[1,\"mat-slider-thumb-label-text\"]],template:function(t,e){1&t&&(La(0,\"div\",0,1),La(2,\"div\",2),Na(3,\"div\",3),Na(4,\"div\",4),Fa(),La(5,\"div\",5),Na(6,\"div\",6),Fa(),La(7,\"div\",7),Na(8,\"div\",8),Na(9,\"div\",9),La(10,\"div\",10),La(11,\"span\",11),xl(12),Fa(),Fa(),Fa(),Fa()),2&t&&(Cr(3),Ra(\"ngStyle\",e._getTrackBackgroundStyles()),Cr(1),Ra(\"ngStyle\",e._getTrackFillStyles()),Cr(1),Ra(\"ngStyle\",e._getTicksContainerStyles()),Cr(1),Ra(\"ngStyle\",e._getTicksStyles()),Cr(1),Ra(\"ngStyle\",e._getThumbContainerStyles()),Cr(5),Sl(e.displayValue))},directives:[qd],styles:['.mat-slider{display:inline-block;position:relative;box-sizing:border-box;padding:8px;outline:none;vertical-align:middle}.mat-slider:not(.mat-slider-disabled):active,.mat-slider.mat-slider-sliding:not(.mat-slider-disabled){cursor:-webkit-grabbing;cursor:grabbing}.mat-slider-wrapper{-webkit-print-color-adjust:exact;color-adjust:exact;position:absolute}.mat-slider-track-wrapper{position:absolute;top:0;left:0;overflow:hidden}.mat-slider-track-fill{position:absolute;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-track-background{position:absolute;transform-origin:100% 100%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-ticks-container{position:absolute;left:0;top:0;overflow:hidden}.mat-slider-ticks{-webkit-background-clip:content-box;background-clip:content-box;background-repeat:repeat;box-sizing:border-box;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-container{position:absolute;z-index:1;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-focus-ring{position:absolute;width:30px;height:30px;border-radius:50%;transform:scale(0);opacity:0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider.cdk-keyboard-focused .mat-slider-focus-ring,.mat-slider.cdk-program-focused .mat-slider-focus-ring{transform:scale(1);opacity:1}.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb-label,.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb{cursor:-webkit-grab;cursor:grab}.mat-slider-thumb{position:absolute;right:-10px;bottom:-10px;box-sizing:border-box;width:20px;height:20px;border:3px solid transparent;border-radius:50%;transform:scale(0.7);transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-label{display:none;align-items:center;justify-content:center;position:absolute;width:28px;height:28px;border-radius:50%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-radius 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.cdk-high-contrast-active .mat-slider-thumb-label{outline:solid 1px}.mat-slider-thumb-label-text{z-index:1;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-sliding .mat-slider-track-fill,.mat-slider-sliding .mat-slider-track-background,.mat-slider-sliding .mat-slider-thumb-container{transition-duration:0ms}.mat-slider-has-ticks .mat-slider-wrapper::after{content:\"\";position:absolute;border-width:0;border-style:solid;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after,.mat-slider-has-ticks:hover:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after{opacity:1}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-disabled) .mat-slider-ticks,.mat-slider-has-ticks:hover:not(.mat-slider-disabled) .mat-slider-ticks{opacity:1}.mat-slider-thumb-label-showing .mat-slider-focus-ring{display:none}.mat-slider-thumb-label-showing .mat-slider-thumb-label{display:flex}.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:100% 100%}.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:0 0}.mat-slider:not(.mat-slider-disabled).cdk-focused.mat-slider-thumb-label-showing .mat-slider-thumb{transform:scale(0)}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label{border-radius:50% 50% 0}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label-text{opacity:1}.mat-slider:not(.mat-slider-disabled).cdk-mouse-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-touch-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-program-focused .mat-slider-thumb{border-width:2px;transform:scale(1)}.mat-slider-disabled .mat-slider-focus-ring{transform:scale(0);opacity:0}.mat-slider-disabled .mat-slider-thumb{border-width:4px;transform:scale(0.5)}.mat-slider-disabled .mat-slider-thumb-label{display:none}.mat-slider-horizontal{height:48px;min-width:128px}.mat-slider-horizontal .mat-slider-wrapper{height:2px;top:23px;left:8px;right:8px}.mat-slider-horizontal .mat-slider-wrapper::after{height:2px;border-left-width:2px;right:0;top:0}.mat-slider-horizontal .mat-slider-track-wrapper{height:2px;width:100%}.mat-slider-horizontal .mat-slider-track-fill{height:2px;width:100%;transform:scaleX(0)}.mat-slider-horizontal .mat-slider-track-background{height:2px;width:100%;transform:scaleX(1)}.mat-slider-horizontal .mat-slider-ticks-container{height:2px;width:100%}.cdk-high-contrast-active .mat-slider-horizontal .mat-slider-ticks-container{height:0;outline:solid 2px;top:1px}.mat-slider-horizontal .mat-slider-ticks{height:2px;width:100%}.mat-slider-horizontal .mat-slider-thumb-container{width:100%;height:0;top:50%}.mat-slider-horizontal .mat-slider-focus-ring{top:-15px;right:-15px}.mat-slider-horizontal .mat-slider-thumb-label{right:-14px;top:-40px;transform:translateY(26px) scale(0.01) rotate(45deg)}.mat-slider-horizontal .mat-slider-thumb-label-text{transform:rotate(-45deg)}.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(45deg)}.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label,.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label-text{transform:none}.mat-slider-vertical{width:48px;min-height:128px}.mat-slider-vertical .mat-slider-wrapper{width:2px;top:8px;bottom:8px;left:23px}.mat-slider-vertical .mat-slider-wrapper::after{width:2px;border-top-width:2px;bottom:0;left:0}.mat-slider-vertical .mat-slider-track-wrapper{height:100%;width:2px}.mat-slider-vertical .mat-slider-track-fill{height:100%;width:2px;transform:scaleY(0)}.mat-slider-vertical .mat-slider-track-background{height:100%;width:2px;transform:scaleY(1)}.mat-slider-vertical .mat-slider-ticks-container{width:2px;height:100%}.cdk-high-contrast-active .mat-slider-vertical .mat-slider-ticks-container{width:0;outline:solid 2px;left:1px}.mat-slider-vertical .mat-slider-focus-ring{bottom:-15px;left:-15px}.mat-slider-vertical .mat-slider-ticks{width:2px;height:100%}.mat-slider-vertical .mat-slider-thumb-container{height:100%;width:0;left:50%}.mat-slider-vertical .mat-slider-thumb{-webkit-backface-visibility:hidden;backface-visibility:hidden}.mat-slider-vertical .mat-slider-thumb-label{bottom:-14px;left:-40px;transform:translateX(26px) scale(0.01) rotate(-45deg)}.mat-slider-vertical .mat-slider-thumb-label-text{transform:rotate(45deg)}.mat-slider-vertical.cdk-focused .mat-slider-thumb-label{transform:rotate(-45deg)}[dir=rtl] .mat-slider-wrapper::after{left:0;right:auto}[dir=rtl] .mat-slider-horizontal .mat-slider-track-fill{transform-origin:100% 100%}[dir=rtl] .mat-slider-horizontal .mat-slider-track-background{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:100% 100%}.mat-slider._mat-animation-noopable .mat-slider-track-fill,.mat-slider._mat-animation-noopable .mat-slider-track-background,.mat-slider._mat-animation-noopable .mat-slider-ticks,.mat-slider._mat-animation-noopable .mat-slider-thumb-container,.mat-slider._mat-animation-noopable .mat-slider-focus-ring,.mat-slider._mat-animation-noopable .mat-slider-thumb,.mat-slider._mat-animation-noopable .mat-slider-thumb-label,.mat-slider._mat-animation-noopable .mat-slider-thumb-label-text,.mat-slider._mat-animation-noopable .mat-slider-has-ticks .mat-slider-wrapper::after{transition:none}\\n'],encapsulation:2,changeDetection:0}),t})();function Lnt(t){return\"t\"===t.type[0]}function Fnt(t,e){let i;return i=Lnt(t)?\"number\"==typeof e?Nnt(t.touches,e)||Nnt(t.changedTouches,e):t.touches[0]||t.changedTouches[0]:t,i?{x:i.clientX,y:i.clientY}:void 0}function Nnt(t,e){for(let i=0;i<t.length;i++)if(t[i].identifier===e)return t[i]}let Bnt=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[np,Fb],Fb]}),t})();const znt=\"anais-seen-glitters\";let Vnt=(()=>{class t{constructor(){this.glitters=[];try{this.glitters=JSON.parse(localStorage.getItem(znt))||[]}catch(t){}}viewItem(t){this.glitters.includes(t)||(this.glitters.push(t),localStorage.setItem(znt,JSON.stringify(this.glitters)))}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function $nt(t,e){if(1&t&&Na(0,\"div\",1),2&t){const t=e.$implicit;cl(\"left\",t.x)(\"top\",t.y),Ra(\"ngClass\",\"glitter__star glitter__star--delay-\"+t.delay)}}const Unt=[\"*\"],jnt=[200,800,1400,2e3,2600],Hnt=new Date((new Date).setMonth((new Date).getMonth()-2));let Gnt=(()=>{class t{constructor(t,e,i){this.changeDetectorRef=t,this.elementRef=e,this.glitterService=i,this.stars=[],this.active=!1,this.clickListener=()=>{this.stopGlitter()}}ngOnInit(){this.changeDetectorRef.detach(),this.active=!this.glitterService.glitters.includes(this.gid)&&(!this.date||new Date(this.date)>Hnt),this.elementRef.nativeElement.addEventListener(\"click\",this.clickListener,!0),this.changeDetectorRef.detectChanges()}ngOnDestroy(){this.elementRef.nativeElement.removeEventListener(\"click\",this.clickListener,!0)}ngAfterViewInit(){if(!this.active)return;let t;if(this.width&&this.height)t={clientWidth:this.width,clientHeight:this.height};else{if(t=this.elementRef.nativeElement.children[0],!t)throw new Error(`Missing child element for glitter ${this.gid}`);for(;0===t.clientHeight||0===t.clientWidth;)if(t=t.children[0],!t)return}const e=.05*t.clientWidth;this.minX=e,this.maxX=t.clientWidth-16-e;const i=.05*t.clientHeight;this.minY=i,this.maxY=t.clientHeight-16-i,jnt.forEach(t=>{setTimeout(()=>{this.createStar(t),this.changeDetectorRef.detectChanges()},t)})}createStar(t){this.stars.push({x:`${this.minX+Math.random()*(this.maxX-this.minX)}px`,y:`${this.minY+Math.random()*(this.maxY-this.minY)}px`,delay:t})}stopGlitter(){!this.active||(this.glitterService.viewItem(this.gid),this.stars=[],this.changeDetectorRef.detectChanges())}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(ic),Oa(Vnt))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-glitter\"]],inputs:{gid:\"gid\",date:\"date\",width:\"width\",height:\"height\"},ngContentSelectors:Unt,decls:2,vars:1,consts:[[3,\"ngClass\",\"left\",\"top\",4,\"ngFor\",\"ngForOf\"],[3,\"ngClass\"]],template:function(t,e){1&t&&(Qa(),Ja(0),oa(1,$nt,1,5,\"div\",0)),2&t&&(Cr(1),Ra(\"ngForOf\",e.stars))},directives:[Bd,Fd],styles:['[_nghost-%COMP%]{position:relative;display:block;line-height:0}.glitter__star[_ngcontent-%COMP%]{content:\" \";position:absolute;background-image:url(glitter-star.76372dc0eb5e11c5d423.png);background-position:center;height:16px;width:16px;-webkit-animation:glitter 3s linear infinite;animation:glitter 3s linear infinite;opacity:0;z-index:1;pointer-events:none;touch-action:none}.glitter__star--delay-200[_ngcontent-%COMP%]{-webkit-animation-delay:.2s;animation-delay:.2s}.glitter__star--delay-800[_ngcontent-%COMP%]{-webkit-animation-delay:.8s;animation-delay:.8s}.glitter__star--delay-1400[_ngcontent-%COMP%]{-webkit-animation-delay:1.4s;animation-delay:1.4s}.glitter__star--delay-2000[_ngcontent-%COMP%]{-webkit-animation-delay:2s;animation-delay:2s}.glitter__star--delay-2600[_ngcontent-%COMP%]{-webkit-animation-delay:2.6s;animation-delay:2.6s}@-webkit-keyframes glitter{0%{transform:scale(.3) rotate(0);opacity:0}25%{transform:scale(1) rotate(180deg);opacity:1}50%{transform:scale(.3) rotate(360deg);opacity:0}to{transform:scale(.3) rotate(0);opacity:0}}@keyframes glitter{0%{transform:scale(.3) rotate(0);opacity:0}25%{transform:scale(1) rotate(180deg);opacity:1}50%{transform:scale(.3) rotate(360deg);opacity:0}to{transform:scale(.3) rotate(0);opacity:0}}']}),t})(),Wnt=(()=>{class t{validate(t){return function(t){const e=parseInt(t.value,10);return!isNaN(e)&&e>=-180&&e<=180?null:{invalidLongitude:{value:t.value}}}(t)}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275dir=Xt({type:t,selectors:[[\"\",\"appLongitude\",\"\"]],features:[Yl([{provide:Yy,useExisting:t,multi:!0}])]}),t})();var qnt=i(2114),Ynt=i.n(qnt);let Znt=(()=>{class t{constructor(){this.sampleCode=\"const fs = require('fs')\\nconst http = require('http')\\n\\n// Avec cette configuration, l'URL \\xe0 configurer dans l'interface ANAIS est : http://localhost:3001/mysecret\\nconst accessKey = 'mysecret'\\nconst listenPort = 3001\\nconst geoPositionFilePath = '/tmp/position.log'\\n\\nconst headers = {\\n  'access-control-allow-origin': '*'\\n}\\nconst server = http.createServer(async (req, res) => {\\n  const key = req.url.slice(1)\\n  if (key !== accessKey) {\\n    res.writeHead(401, headers)\\n    res.end('')\\n  } else {\\n    res.writeHead(200, headers)\\n    // La r\\xe9ponse doit \\xeatre au format 'latitude,longitude' en projection EPSG:4326\\n    fs.createReadStream(geoPositionFilePath).pipe(res)\\n  }\\n})\\n\\nserver.listen(listenPort, '127.0.0.1', () => {\\n  console.log('GeoServer started on port %d', listenPort)\\n})\\n\"}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-geolocation-sample-server-dialog\"]],decls:19,vars:1,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[1,\"mat-typography\"],[\"href\",\"https://nodejs.org/\"]],template:function(t,e){1&t&&(La(0,\"h2\",0),xl(1,\" Configuration d'un serveur HTTP pour exposer la position \"),Na(2,\"div\",1),La(3,\"button\",2),La(4,\"mat-icon\"),xl(5,\"close\"),Fa(),Fa(),Fa(),La(6,\"mat-dialog-content\",3),La(7,\"p\"),xl(8,\"Le code JavaScript ci-dessous est a ex\\xe9cuter par \"),La(9,\"a\",4),xl(10,\"Node.js\"),Fa(),xl(11,\" et permet de d\\xe9marrer un serveur HTTP en local et exposer la position latitude et longitude \\xe0 partir d'un fichier.\"),Fa(),La(12,\"p\"),xl(13,\"Afin que l'interface d'ANAIS reconnaisse bien cette position, il faut que le serveur renvoie bien la position au format \"),La(14,\"em\"),xl(15,\"latitude,longitude\"),Fa(),xl(16,\" en projection EPSG:4326.\"),Fa(),La(17,\"pre\"),xl(18),Fa(),Fa()),2&t&&(Cr(18),Sl(e.sampleCode))},directives:[rk,Ly,sk,uE,ok],styles:[\"\"]}),t})();class Knt extends fB{constructor(t){super(\"error\"),this.code=t.code,this.message=t.message}}var Xnt=class extends r${constructor(t){super(),t=t||{},this.position_=null,this.transform_=CV,this.watchId_=void 0,this.addChangeListener(\"projection\",this.handleProjectionChanged_),this.addChangeListener(\"tracking\",this.handleTrackingChanged_),void 0!==t.projection&&this.setProjection(t.projection),void 0!==t.trackingOptions&&this.setTrackingOptions(t.trackingOptions),this.setTracking(void 0!==t.tracking&&t.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const t=this.getProjection();t&&(this.transform_=DV(EV(\"EPSG:4326\"),t),this.position_&&this.set(\"position\",this.transform_(this.position_)))}handleTrackingChanged_(){if(\"geolocation\"in navigator){const t=this.getTracking();t&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!t&&void 0!==this.watchId_&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(t){const e=t.coords;this.set(\"accuracy\",e.accuracy),this.set(\"altitude\",null===e.altitude?void 0:e.altitude),this.set(\"altitudeAccuracy\",null===e.altitudeAccuracy?void 0:e.altitudeAccuracy),this.set(\"heading\",null===e.heading?void 0:sV(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];const i=this.transform_(this.position_);this.set(\"position\",i),this.set(\"speed\",null===e.speed?void 0:e.speed);const n=eW(this.position_,e.accuracy);n.applyTransform(this.transform_),this.set(\"accuracyGeometry\",n),this.changed()}positionError_(t){this.dispatchEvent(new Knt(t))}getAccuracy(){return this.get(\"accuracy\")}getAccuracyGeometry(){return this.get(\"accuracyGeometry\")||null}getAltitude(){return this.get(\"altitude\")}getAltitudeAccuracy(){return this.get(\"altitudeAccuracy\")}getHeading(){return this.get(\"heading\")}getPosition(){return this.get(\"position\")}getProjection(){return this.get(\"projection\")}getSpeed(){return this.get(\"speed\")}getTracking(){return this.get(\"tracking\")}getTrackingOptions(){return this.get(\"trackingOptions\")}setProjection(t){this.set(\"projection\",EV(t))}setTracking(t){this.set(\"tracking\",t)}setTrackingOptions(t){this.set(\"trackingOptions\",t)}},Qnt=(()=>(function(t){t.Browser=\"browser\",t.FixedLocation=\"fixed_location\",t.Server=\"server\"}(Qnt||(Qnt={})),Qnt))();class Jnt{constructor(t={}){Object.assign(this,t)}}let tst=(()=>{class t{constructor(t){this.configService=t,this.enable$=new Jp(!1),this.source$=new Jp(Qnt.Browser),this.serverURL$=new Jp(\"\"),this.fixedLocation$=new Jp(null),this.showBearing$=new Jp(!1),this.location$=new Jp(null),this.headingAngle$=new Jp(-1),this.retrievalError$=new Jp(\"\"),this.validConfiguration$=new Jp(!1),this.locationFetchInterval=2e3,this.location$.subscribe(t=>{this.oldLocation&&t&&this.headingAngle$.next(met(t.lon-this.oldLocation.lon,t.lat-this.oldLocation.lat)),this.oldLocation=t}),this.source$.subscribe(()=>{this.oldLocation=null,this.headingAngle$.next(-1)}),this.geolocation=new Xnt({trackingOptions:{enableHighAccuracy:!0},tracking:!1}),this.geolocation.on(\"change:position\",()=>{const t=this.geolocation.getPosition();this.location$.next(t?new EU(t[0],t[1]):null)}),JT([this.enable$,this.serverURL$,this.fixedLocation$,this.source$]).subscribe(([t,e,i,n])=>{let s=!1;t&&n===Qnt.Server&&e?(this.fetchTimer&&window.clearInterval(this.fetchTimer),this.fetchTimer=window.setInterval(()=>Hp(this,void 0,void 0,function*(){if(this.serverURL$.value)try{this.location$.next(yield this.fetchLocation(this.serverURL$.value)),\"\"!==this.retrievalError$.value&&this.retrievalError$.next(\"\")}catch(t){this.retrievalError$.next(t.message)}}),this.locationFetchInterval),s=!0):(window.clearInterval(this.fetchTimer),this.fetchTimer=null);const r=t&&n===Qnt.Browser;if(r&&!this.geolocation.getTracking()){const t=this.geolocation.getPosition();this.location$.next(t?new EU(t[0],t[1]):null)}if(r&&(s=!0),this.geolocation.setTracking(r),t&&n===Qnt.FixedLocation&&i){const{lon:t,lat:e}=Ynt()(i);this.location$.next(new EU(t,e)),s=!0}t||\"\"!==this.retrievalError$.value&&this.retrievalError$.next(\"\"),this.validConfiguration$.next(s)}),this.loadConfig(),q(this.enable$,this.fixedLocation$,this.serverURL$,this.showBearing$,this.source$).subscribe(()=>{this.configService.set(\"geolocationConfig\",new Jnt({enable:this.enable$.value,fixedLocation:this.fixedLocation$.value,serverURL:this.serverURL$.value,showBearing:this.showBearing$.value,source:this.source$.value}))})}loadConfig(){const t=this.configService.geolocationConfig;t&&(gU(t.enable)&&this.enable$.next(t.enable),gU(t.fixedLocation)&&this.fixedLocation$.next(t.fixedLocation),gU(t.serverURL)&&this.serverURL$.next(t.serverURL),gU(t.showBearing)&&this.showBearing$.next(t.showBearing),gU(t.source)&&this.source$.next(t.source))}fetchLocation(t){return Hp(this,void 0,void 0,function*(){let e;try{e=yield fetch(t)}catch(n){throw new Error(`Impossible de r\\xe9cup\\xe9rer la position : ${n.message}. Le serveur est-il joignable ?`)}if(!e.ok)throw new Error(`Mauvais code retour (${e.status}). Une r\\xe9ponse de type 200 est attendue.`);const i=yield e.text();try{const t=i.split(\",\");if(2!==t.length)throw new Error(`Mauvais format. R\\xe9ponse re\\xe7ue : '${i.slice(0,50)}'`);const e=parseFloat(t[0]),n=parseFloat(t[1]);if(isNaN(e))throw new Error(`La latitude '${t[0]}' n'est pas un nombre valide`);if(isNaN(n))throw new Error(`La longitude '${t[0]}' n'est pas un nombre valide`);return new EU(n,e)}catch(n){throw new Error(`Impossible de d\\xe9coder la position : ${n.message}. Le format \"latitude,longitude\" est attendu.`)}})}updateEnable(t){this.enable$.next(t)}updateServerURL(t){this.serverURL$.next(t)}updateFixedLocation(t){this.fixedLocation$.next(t)}updateSource(t){this.source$.next(t),this.retrievalError$.next(\"\")}toggleShowBearing(){this.showBearing$.next(!this.showBearing$.value)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(WU))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function est(t,e){if(1&t){const t=$a();La(0,\"mat-form-field\",2),La(1,\"mat-label\"),xl(2,\"URL du serveur\"),Fa(),La(3,\"input\",10),Ga(\"ngModelChange\",function(e){return Fe(t),Ka(2).serverURL=e}),Fa(),Fa(),La(4,\"button\",11),Ga(\"click\",function(){return Fe(t),Ka(2).saveServerLocation()}),xl(5,\" Enregistrer \"),Fa(),La(6,\"button\",12),Ga(\"click\",function(){return Fe(t),Ka(2).tryFetchLocation()}),xl(7,\" Tester l'URL \"),Fa()}if(2&t){const t=Ka(2);Cr(3),Ra(\"ngModel\",t.serverURL)(\"disabled\",!t.geolocationLayerService.enable$.value),Cr(1),Ra(\"disabled\",!t.geolocationLayerService.enable$.value),Cr(2),Ra(\"disabled\",!t.serverURL||!t.geolocationLayerService.enable$.value)}}function ist(t,e){if(1&t){const t=$a();La(0,\"div\",13),xl(1),Fa(),La(2,\"button\",14),Ga(\"click\",function(){return Fe(t),Ka(2).editMode=!0}),xl(3,\" \\xc9diter \"),Fa()}if(2&t){const t=Ka(2);Cr(1),Sl(t.serverURL||\"Aucune URL configur\\xe9e\"),Cr(1),Ra(\"disabled\",!t.geolocationLayerService.enable$.value)}}function nst(t,e){if(1&t&&(La(0,\"div\",15),xl(1),Fa()),2&t){const t=Ka(2);Cr(1),Cl(\" \",t.fetchAttempt,\" \")}}function sst(t,e){1&t&&(La(0,\"p\",16),La(1,\"mat-icon\",2),xl(2,\"warning\"),Fa(),xl(3,\" Avec certaines versions de Firefox, il faut autoriser le chargement de contenu non s\\xe9curis\\xe9 (HTTP) afin d'acc\\xe9der \\xe0 votre serveur en local. \"),Fa(),Na(4,\"img\",17))}function rst(t,e){if(1&t){const t=$a();La(0,\"div\",1),La(1,\"div\",2),xl(2,\"URL du serveur :\"),Fa(),oa(3,est,8,4,\"ng-template\",7),oa(4,ist,4,2,\"ng-template\",7),Fa(),oa(5,nst,2,1,\"div\",8),La(6,\"div\"),xl(7,\" Pour mettre en oeuvre un serveur qui expose une position \\xe0 partir d'un fichier local, veuillez vous r\\xe9f\\xe9rer \\xe0 cet \"),La(8,\"button\",9),Ga(\"click\",function(){return Fe(t),Ka().openGeolocationSampleServerDialog()}),xl(9,\"exemple de serveur HTTP\"),Fa(),xl(10,\". \"),Na(11,\"br\"),xl(12,\" Sinon pour tester cette fonctionnalit\\xe9, vous pouvez \"),La(13,\"button\",9),Ga(\"click\",function(){return Fe(t),Ka().useSampleServer()}),xl(14,\"utiliser l'URL de test\"),Fa(),xl(15,\" qui simule une position GPS : \"),La(16,\"em\"),xl(17),Fa(),xl(18,\". \"),Fa(),oa(19,sst,5,0,\"ng-template\",7)}if(2&t){const t=Ka();Cr(3),Ra(\"ngIf\",t.editMode),Cr(1),Ra(\"ngIf\",!t.editMode),Cr(1),Ra(\"ngIf\",t.fetchAttempt),Cr(3),Ra(\"disabled\",!t.geolocationLayerService.enable$.value),Cr(5),Ra(\"disabled\",!t.geolocationLayerService.enable$.value),Cr(4),Sl(t.sampleServerURL),Cr(2),Ra(\"ngIf\",t.isFirefox)}}function ost(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"Ce champ est n\\xe9cessaire\"),Fa())}function ast(t,e){if(1&t){const t=$a();La(0,\"mat-form-field\",2),La(1,\"input\",18),Ga(\"accept\",function(e){return Fe(t),Ka(2).onFixedLocationUpdate(e)})(\"complete\",function(e){return Fe(t),Ka(2).onFixedLocationComplete(e)}),Fa(),oa(2,ost,2,0,\"mat-error\",19),Fa(),La(3,\"button\",20),Ga(\"click\",function(){return Fe(t),Ka(2).saveFixedLocation()}),xl(4,\" Enregistrer \"),Fa()}if(2&t){const t=Ka(2);Cr(1),Ra(\"formControl\",t.fixedLocation)(\"imask\",t.lonLatMask),Cr(1),Ra(\"ngIf\",null==t.fixedLocation.errors?null:t.fixedLocation.errors.mandatory),Cr(1),Ra(\"disabled\",!t.fixedLocation.valid||!t.geolocationLayerService.enable$.value)}}function lst(t,e){if(1&t){const t=$a();La(0,\"div\",13),xl(1),Fa(),La(2,\"button\",14),Ga(\"click\",function(){return Fe(t),Ka(2).editMode=!0}),xl(3,\" \\xc9diter \"),Fa()}if(2&t){const t=Ka(2);Cr(1),Sl(t.fixedLocation.value||\"Aucune position configur\\xe9e\"),Cr(1),Ra(\"disabled\",!t.geolocationLayerService.enable$.value)}}function cst(t,e){if(1&t&&(La(0,\"div\",1),La(1,\"div\",2),xl(2,\"Position :\"),Fa(),oa(3,ast,5,4,\"ng-template\",7),oa(4,lst,4,2,\"ng-template\",7),Fa()),2&t){const t=Ka();Cr(3),Ra(\"ngIf\",t.editMode),Cr(1),Ra(\"ngIf\",!t.editMode)}}let hst=(()=>{class t{constructor(t,e){this.dialog=t,this.geolocationLayerService=e,this.editMode=!1,this.fixedLocation=new Yw(\"\"),this.fetchAttempt=null,this.sampleServerURL=\"https://sample-geoserver.anais.beta.gouv.fr/\",this.lonLatMask={mask:\"LAT\\xb0`MIN'`MIN\\\"NS LON\\xb0`MIN'`MIN\\\"EW\",lazy:!1,blocks:{LON:{mask:fP,from:0,to:180},LAT:{mask:fP,from:0,to:85},NS:{mask:bP,enum:[\"N\",\"S\"]},EW:{mask:bP,enum:[\"E\",\"W\"]},MIN:{mask:fP,from:0,to:59}}}}ngOnInit(){this.geolocationLayerService.enable$.subscribe(t=>{t?this.fixedLocation.enable():this.fixedLocation.disable()}),this.geolocationLayerService.fixedLocation$.subscribe(t=>{this.fixedLocation.setValue(null!=t?t:\"\")}),this.geolocationLayerService.serverURL$.subscribe(t=>{this.serverURL=t}),this.geolocationLayerService.source$.subscribe(t=>{this.source=t,this.editMode=!1}),this.isFirefox=_Y.getParser(window.navigator.userAgent).isBrowser(\"firefox\")}updateEnable(t){this.geolocationLayerService.updateEnable(t)}updateSource(t){this.geolocationLayerService.updateSource(t)}saveServerLocation(){return Hp(this,void 0,void 0,function*(){try{\"\"!==this.serverURL&&(yield this.geolocationLayerService.fetchLocation(this.serverURL)),this.geolocationLayerService.updateServerURL(this.serverURL),this.editMode=!1,this.fetchAttempt=\"\"}catch(t){this.fetchAttempt=t.message}})}tryFetchLocation(){return Hp(this,void 0,void 0,function*(){try{const t=yield this.geolocationLayerService.fetchLocation(this.serverURL);this.fetchAttempt=`Position r\\xe9cup\\xe9r\\xe9e: latitude=${t.lat}, longitude=${t.lon}`}catch(t){this.fetchAttempt=t.message}})}openGeolocationSampleServerDialog(){this.dialog.open(Znt)}useSampleServer(){return Hp(this,void 0,void 0,function*(){this.serverURL=this.sampleServerURL,yield this.saveServerLocation()})}saveFixedLocation(){return Hp(this,void 0,void 0,function*(){this.fixedLocation.valid&&this.geolocationLayerService.updateFixedLocation(this.fixedLocation.value),this.editMode=!1})}onFixedLocationUpdate(t){this.fixedLocation.setErrors({mandatory:!0})}onFixedLocationComplete(t){try{Ynt()(t),this.fixedLocation.setErrors({mandatory:null}),this.fixedLocation.setValue(t,{emitEvent:!1})}catch(e){}}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ik),Oa(tst))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-geolocation-settings\"]],decls:14,vars:5,consts:[[\"color\",\"primary\",1,\"d-block\",\"mt-2\",3,\"ngModel\",\"ngModelChange\"],[1,\"d-flex-center\",\"mt-2\"],[1,\"mr-2\"],[3,\"ngModel\",\"disabled\",\"ngModelChange\"],[\"color\",\"primary\",\"value\",\"browser\"],[\"color\",\"primary\",\"value\",\"server\"],[\"color\",\"primary\",\"value\",\"fixed_location\"],[3,\"ngIf\"],[\"class\",\"mt-1\",4,\"ngIf\"],[\"mat-stroked-button\",\"\",1,\"text-link\",3,\"disabled\",\"click\"],[\"matInput\",\"\",3,\"ngModel\",\"disabled\",\"ngModelChange\"],[\"mat-stroked-button\",\"\",\"title\",\"Enregistrer l'URL du serveur\",3,\"disabled\",\"click\"],[\"mat-stroked-button\",\"\",\"title\",\"Tester la r\\xe9cup\\xe9ration de cette URL\",3,\"disabled\",\"click\"],[2,\"min-width\",\"180px\"],[\"mat-stroked-button\",\"\",1,\"ml-2\",3,\"disabled\",\"click\"],[1,\"mt-1\"],[1,\"firefox-warning-geolocation\"],[\"src\",\"assets/images/help-firefox-mixed-content-tutorial.png\",\"alt\",\"Configuration Firefox\",1,\"ml-3\"],[\"matInput\",\"\",3,\"formControl\",\"imask\",\"accept\",\"complete\"],[4,\"ngIf\"],[\"type\",\"submit\",\"mat-stroked-button\",\"\",\"title\",\"Enregistrer\",3,\"disabled\",\"click\"]],template:function(t,e){1&t&&(La(0,\"mat-slide-toggle\",0),Ga(\"ngModelChange\",function(t){return e.updateEnable(t)}),xl(1,\" Afficher la position GPS sur la carte\\n\"),Fa(),La(2,\"div\",1),La(3,\"label\",2),xl(4,\"Source :\"),Fa(),La(5,\"mat-radio-group\",3),Ga(\"ngModelChange\",function(t){return e.updateSource(t)}),La(6,\"mat-radio-button\",4),xl(7,\"API Navigateur\"),Fa(),La(8,\"mat-radio-button\",5),xl(9,\"Serveur\"),Fa(),La(10,\"mat-radio-button\",6),xl(11,\"Point de r\\xe9f\\xe9rence\"),Fa(),Fa(),Fa(),oa(12,rst,20,7,\"ng-template\",7),oa(13,cst,5,2,\"ng-template\",7)),2&t&&(Ra(\"ngModel\",e.geolocationLayerService.enable$.value),Cr(5),Ra(\"ngModel\",e.geolocationLayerService.source$.value)(\"disabled\",!e.geolocationLayerService.enable$.value),Cr(7),Ra(\"ngIf\",\"server\"===e.source),Cr(1),Ra(\"ngIf\",\"fixed_location\"===e.source))},directives:[b1,Sw,nx,OK,FK,Vd,Ly,AS,aS,ES,Gy,uE,hx,TP,eS],styles:[\".mat-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:16px}.firefox-warning-geolocation[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:.9em;color:#d41a1a}.text-link[_ngcontent-%COMP%]{padding:0 8px;line-height:2em}\"]}),t})();function ust(t,e){if(1&t&&(La(0,\"mat-option\",20),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.value),Cr(1),Cl(\" \",t.label,\" \")}}function dst(t,e){1&t&&(La(0,\"mat-chip\",25),xl(1,\"Restriction active\"),Fa())}function pst(t,e){if(1&t){const t=$a();La(0,\"mat-chip-list\",21),oa(1,dst,2,0,\"mat-chip\",22),Fa(),La(2,\"button\",23),Ga(\"click\",function(){return Fe(t),Ka(2).mapRestrictionService.removeArea()}),La(3,\"mat-icon\"),xl(4,\"delete\"),Fa(),Fa(),La(5,\"button\",24),Ga(\"click\",function(){return Fe(t),Ka(2).mapRestrictionService.startSelectingArea()}),La(6,\"mat-icon\"),xl(7,\"edit\"),Fa(),Fa()}if(2&t){const t=Ka(2);Cr(1),Ra(\"ngIf\",t.mapConfigService.restrictedAreas$.value)}}function fst(t,e){if(1&t){const t=$a();La(0,\"button\",26),Ga(\"click\",function(){return Fe(t),Ka(2).mapRestrictionService.startSelectingArea()}),xl(1,\" S\\xe9lectionner une zone \"),Fa()}}function mst(t,e){if(1&t){const t=$a();La(0,\"h5\"),xl(1,\"Intervalle de rafraichissement des derni\\xe8res positions des navires\"),Fa(),La(2,\"div\"),xl(3,\"En vue temps r\\xe9el, les positions des navires sont rafraichies selon cet intervalle.\"),Fa(),La(4,\"mat-form-field\"),La(5,\"mat-select\",5),Ga(\"ngModelChange\",function(e){return Fe(t),Ka().mapConfigService.updateShipRefreshInterval(e)}),oa(6,ust,2,2,\"mat-option\",6),Fa(),Fa(),La(7,\"h5\"),xl(8,\"Restriction de la carte\"),Fa(),La(9,\"p\"),xl(10,\" Cette option permet de limiter la r\\xe9cup\\xe9ration des navires \\xe0 une zone de la carte. Notez que la zone restreinte va d\\xe9signer les tuiles de donn\\xe9es \\xe0 charger. Il est donc normal que la zone charg\\xe9e soit un peu plus grande que la zone choisie. \"),Fa(),La(11,\"div\",18),oa(12,pst,8,1,\"ng-template\",4),oa(13,fst,2,0,\"button\",19),Fa()}if(2&t){const t=Ka();Cr(5),Ra(\"ngModel\",t.mapConfigService.shipRefreshInterval$.value),Cr(1),Ra(\"ngForOf\",t.shipRefreshIntervals),Cr(6),Ra(\"ngIf\",t.mapConfigService.restrictedAreas$.value),Cr(1),Ra(\"ngIf\",!t.mapConfigService.restrictedAreas$.value)}}function gst(t,e){if(1&t&&(La(0,\"mat-option\",20),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.key),Cr(1),Cl(\" \",t.label,\" \")}}function Ast(t,e){if(1&t&&(La(0,\"mat-option\",20),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t.key),Cr(1),Cl(\" \",t.label,\" \")}}function vst(t,e){1&t&&(La(0,\"mat-error\"),xl(1,\"La longitude est invalide\"),Fa())}const _st=[{label:\"30 secondes\",value:3e4},{label:\"1 minute\",value:6e4},{label:\"2 minutes\",value:12e4},{label:\"5 minutes\",value:3e5},{label:\"10 minutes\",value:6e5},{label:\"20 minutes\",value:12e5},{label:\"D\\xe9sactiv\\xe9\",value:2147483647}];let bst=(()=>{class t{constructor(t,e,i){this.configService=t,this.mapConfigService=e,this.mapRestrictionService=i,this.shipRefreshIntervals=_st,this.availableTimeRanges=RU.filter(t=>!t.isCustom),this.coordinateSystems=H$}}return t.\\u0275fac=function(e){return new(e||t)(Oa(WU),Oa(qU),Oa(Mnt))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-settings-dialog\"]],decls:93,vars:23,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[\"color\",\"primary\",1,\"d-block\",3,\"ngModel\",\"ngModelChange\"],[3,\"ngIf\"],[3,\"ngModel\",\"ngModelChange\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[1,\"my-3\"],[\"color\",\"primary\",\"title\",\"Ce param\\xe8tre permet d'afficher des hexagones plus petits lors de la s\\xe9lection de zones.\",1,\"d-block\",3,\"ngModel\",\"ngModelChange\"],[\"color\",\"primary\",\"title\",\"Ce param\\xe8tre permet d'afficher les traces des navires traduites en arcs dirig\\xe9s dans la grille hexagonale.\",1,\"d-block\",3,\"ngModel\",\"ngModelChange\"],[1,\"d-flex-center\",\"my-2\"],[1,\"mr-2\"],[\"color\",\"primary\",\"thumbLabel\",\"true\",2,\"width\",\"300px\",3,\"min\",\"max\",\"step\",\"tickInterval\",\"value\",\"change\"],[\"gid\",\"coordinate-system\",\"date\",\"2021-10-13\"],[1,\"d-inline\"],[\"type\",\"number\",\"matInput\",\"\",\"appLongitude\",\"\",3,\"ngModel\",\"ngModelChange\"],[\"longitudeCenter\",\"ngModel\"],[4,\"ngIf\"],[1,\"d-flex-center\"],[\"mat-raised-button\",\"\",3,\"click\",4,\"ngIf\"],[3,\"value\"],[1,\"d-inline\",\"mr-2\"],[\"color\",\"primary\",\"selected\",\"\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"warn\",\"title\",\"Supprimer la zone de restriction\",3,\"click\"],[\"mat-button\",\"\",\"title\",\"Mettre \\xe0 jour la zone de restriction\",3,\"click\"],[\"color\",\"primary\",\"selected\",\"\"],[\"mat-raised-button\",\"\",3,\"click\"]],template:function(t,e){if(1&t&&(La(0,\"h1\",0),xl(1,\" Param\\xe8tres g\\xe9n\\xe9raux \"),Na(2,\"div\",1),La(3,\"button\",2),La(4,\"mat-icon\"),xl(5,\"close\"),Fa(),Fa(),Fa(),La(6,\"div\"),La(7,\"h3\"),xl(8,\"Bande passante\"),Fa(),La(9,\"p\"),xl(10,\" Ces param\\xe8tres peuvent \\xeatre utilis\\xe9s pour r\\xe9duire la bande passante utilis\\xe9e quand le d\\xe9bit de la connexion internet est faible (par exemple dans un avion ou un navire). \"),Fa(),La(11,\"h5\"),xl(12,\"Chargement manuel\"),Fa(),La(13,\"p\"),xl(14,\" Par d\\xe9faut, les donn\\xe9es navires et a\\xe9ronefs sont charg\\xe9s par tuiles \\xe0 chaque d\\xe9placement de carte, et rafraichis r\\xe9guli\\xe8rement. Le chargement manuel d\\xe9sactive la r\\xe9cup\\xe9ration automatique des donn\\xe9es et permet \\xe0 l'utilisateur de d\\xe9clencher manuellement cette r\\xe9cup\\xe9ration. \"),Fa(),La(15,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateManualMapFetch(t)}),xl(16,\" Chargement manuel actif \"),Fa(),oa(17,mst,14,4,\"ng-template\",4),La(18,\"h5\"),xl(19,\"P\\xe9riode de temps par d\\xe9faut\"),Fa(),La(20,\"div\"),xl(21,\"Cette p\\xe9riode de temps permet d'afficher l'historique des traces et des alertes affich\\xe9 lorsque l'on visualise le d\\xe9tail d'un navire.\"),Fa(),La(22,\"mat-form-field\"),La(23,\"mat-select\",5),Ga(\"ngModelChange\",function(t){return e.configService.set(\"defaultTimeRange\",t)}),oa(24,gst,2,2,\"mat-option\",6),Fa(),Fa(),La(25,\"h5\"),xl(26,\"Limite de zoom minimum\"),Fa(),La(27,\"div\"),xl(28,\"Par d\\xe9faut le zoom minimum est limit\\xe9 afin de r\\xe9duire la consommation r\\xe9seau et m\\xe9moire de l'application. Si vous d\\xe9sactivez cette option, vous pourrez alors d\\xe9zoomer mais cela aura un co\\xfbt en termes de bande passante et de capacit\\xe9s de traitement (CPU et m\\xe9moire). Il se peut que votre navigateur se bloque si vous n'avez pas assez de m\\xe9moire !\"),Fa(),La(29,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateLimitMinimumZoom(t)}),xl(30,\" Limite de zoom active \"),Fa(),Na(31,\"mat-divider\",7),La(32,\"h3\"),xl(33,\"Affichage\"),Fa(),La(34,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updatePreloadMapTiles(t)}),La(35,\"div\"),xl(36,\"Pr\\xe9charger les tuiles du fond de carte (affichage plus rapide mais bande passante x2 environ)\"),Fa(),Fa(),La(37,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateZoomOnLocationEvents(t)}),xl(38,\" Zoomer sur la carte lors d'\\xe9v\\xe9nements de localisation \"),Fa(),La(39,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateHidePositionsInLowZooms(t)}),xl(40,\" Masquer les points des traces quand le zoom est bas \"),Fa(),La(41,\"mat-slide-toggle\",8),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateHighHexagonsResolution(t)}),xl(42,\" Utiliser des hexagones de haute r\\xe9solution \"),Fa(),La(43,\"mat-slide-toggle\",9),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateDebugH3Trace(t)}),xl(44,\" Voir l'analyse des traces des navires dans la grille hexagonale (fonction de Debug) \"),Fa(),La(45,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateShowMarineTrafficPhotos(t)}),xl(46,\" Afficher les photos de Marine Traffic dans la fiche navire \"),Fa(),La(47,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateShowMarineTrafficDeparture(t)}),xl(48,\" Afficher le bouton pour r\\xe9cup\\xe9rer la provenance de Marine Traffic \"),Fa(),La(49,\"div\",10),La(50,\"label\",11),xl(51,\"Transparence des \\xe9tiquettes et infobulles :\"),Fa(),xl(52,\" Transparent \"),La(53,\"mat-slider\",12),Ga(\"change\",function(t){return e.mapConfigService.updateTooltipsOpacity(t.value)}),Fa(),xl(54,\" Opaque \"),Fa(),La(55,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateUseUTCDates(t)}),xl(56,\" Afficher les dates en UTC \"),Fa(),La(57,\"app-glitter\",13),La(58,\"div\",14),La(59,\"label\",11),xl(60,\"Syst\\xe8me de coordonn\\xe9es : \"),Fa(),La(61,\"mat-form-field\"),La(62,\"mat-select\",5),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateCoordinateSystem(t)}),oa(63,Ast,2,2,\"mat-option\",6),Fa(),Fa(),Fa(),Fa(),La(64,\"h5\"),xl(65,\"D\\xe9calage de longitude\"),Fa(),La(66,\"div\"),xl(67,\" Par d\\xe9faut, les donn\\xe9es sont affich\\xe9es de la longitude -180 \\xe0 la longitude +180. Or cet affichage occasionne une coupure de l'affichage au milieu de l'oc\\xe9an pacifique. Si vous travaillez r\\xe9guli\\xe8rement sur cette zone, alors pour pouvez d\\xe9caler le centre afin de d\\xe9placer la coupure \\xe0 un endroit moins important pour vous. \"),Fa(),La(68,\"mat-form-field\"),La(69,\"mat-label\"),xl(70,\"Longitude\"),Fa(),La(71,\"input\",15,16),Ga(\"ngModelChange\",function(t){return e.mapConfigService.updateLongitudeCenter(t)}),Fa(),oa(73,vst,2,0,\"mat-error\",17),Fa(),Na(74,\"mat-divider\",7),La(75,\"h3\"),xl(76,\"G\\xe9olocalisation\"),Fa(),La(77,\"div\"),xl(78,\"L'option ci-dessous permet d'afficher une position en temps-r\\xe9el sur la carte, en utilisant un point de r\\xe9f\\xe9rence, l'API navigateur, ou bien un serveur HTTP en local.\"),Fa(),La(79,\"div\"),xl(80,\"Si vous \\xeates dans un avion ou dans un navire, cette option permet par exemple d'afficher la position de l'avion ou du navire embarquant ANAIS.\"),Fa(),La(81,\"div\"),xl(82,\"Notez bien que cette information de position est utilis\\xe9e localement pour \\xeatre affich\\xe9e sur la carte.\"),Fa(),La(83,\"div\"),xl(84,\"Cette position n'est \"),La(85,\"strong\"),xl(86,\"jamais\"),Fa(),xl(87,\" envoy\\xe9e sur internet (serveur ANAIS ou autre)\"),Fa(),Na(88,\"app-geolocation-settings\"),La(89,\"h3\"),xl(90,\"Zone dangereuse\"),Fa(),La(91,\"mat-slide-toggle\",3),Ga(\"ngModelChange\",function(){return e.mapConfigService.toggleEnableWebsockets()}),xl(92,\" D\\xe9sactiver les websockets \"),Fa(),Fa()),2&t){const t=aa(72);Cr(15),Ra(\"ngModel\",e.mapConfigService.manualMapFetch$.value),Cr(2),Ra(\"ngIf\",!e.mapConfigService.manualMapFetch$.value),Cr(6),Ra(\"ngModel\",e.configService.defaultTimeRange),Cr(1),Ra(\"ngForOf\",e.availableTimeRanges),Cr(5),Ra(\"ngModel\",e.mapConfigService.limitMinimumZoom$.value),Cr(5),Ra(\"ngModel\",e.mapConfigService.preloadMapTiles$.value),Cr(3),Ra(\"ngModel\",e.mapConfigService.zoomOnLocationEvents$.value),Cr(2),Ra(\"ngModel\",e.mapConfigService.hidePositionsInLowZooms$.value),Cr(2),Ra(\"ngModel\",e.mapConfigService.highHexagonsResolution$.value),Cr(2),Ra(\"ngModel\",e.mapConfigService.debugH3Trace$.value),Cr(2),Ra(\"ngModel\",e.mapConfigService.showMarineTrafficPhotos$.value),Cr(2),Ra(\"ngModel\",e.mapConfigService.showMarineTrafficDeparture$.value),Cr(6),Ra(\"min\",0)(\"max\",1)(\"step\",.1)(\"tickInterval\",1)(\"value\",e.mapConfigService.tooltipsOpacity$.value),Cr(2),Ra(\"ngModel\",e.mapConfigService.useUTCDates$.value),Cr(7),Ra(\"ngModel\",e.mapConfigService.coordinateSystem$.value),Cr(1),Ra(\"ngForOf\",e.coordinateSystems),Cr(8),Ra(\"ngModel\",e.mapConfigService.longitudeCenter$.value),Cr(2),Ra(\"ngIf\",t.invalid&&t.errors.invalidLongitude),Cr(18),Ra(\"ngModel\",!e.mapConfigService.enableWebsockets$.value)}},directives:[rk,Ly,sk,uE,b1,Sw,nx,Vd,AS,qT,Bd,Xq,Dnt,Gnt,aS,ox,ES,Gy,Wnt,hst,ky,u0,r0,eS],styles:[\"\"]}),t})(),yst=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.titleService=t,this.router=e,this.dialog=i,this.mapService=n,this.routeService=s,this.uiService=r}ngOnInit(){this.titleService.setTitle(\"Param\\xe8tres - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(this.uiService.drawingMode$.pipe(Tf()).subscribe(t=>{t?this.dialogRef&&(this.dialogRef.close(!1),this.dialogRef=null):this.dialogRef||this.createDialog()}))}createDialog(){this.dialogRef=this.dialog.open(bst,{height:\"90vh\",width:\"90vw\",maxWidth:\"90vw\",closeOnNavigation:!0}),this.dialogRef.afterClosed().subscribe((t=!0)=>Hp(this,void 0,void 0,function*(){if(t){const t=this.routeService.previousUrl||\"\";yield this.router.navigateByUrl(t)}}))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(pL),Oa(ik),Oa(Pj),Oa(Nj),Oa(_H))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-settings-loader\"]],features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();var wst=(()=>(function(t){t.HIGH=\"Urgente\",t.NORMAL=\"Normale\",t.LOW=\"Basse\"}(wst||(wst={})),wst))();function xst(t,e){if(1&t&&(La(0,\"mat-option\",13),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t),Cr(1),Cl(\" \",t,\" \")}}function Sst(t,e){1&t&&Na(0,\"mat-spinner\",14),2&t&&Ra(\"diameter\",70)}function Cst(t,e){if(1&t){const t=$a();La(0,\"button\",15),Ga(\"click\",function(){return Fe(t),Ka().onValidation()}),La(1,\"mat-icon\",16),xl(2,\"post_add\"),Fa(),La(3,\"span\"),xl(4,\"Valider le ticket\"),Fa(),Fa()}2&t&&Ra(\"disabled\",Ka().ticketForms.invalid)}let kst=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o){super(),this.titleService=t,this.mapService=e,this.uiService=i,this.workerService=n,this.fb=s,this.errorHandler=r,this.dialogRef=o,this.ticketId=0,this.errorMessage=\"\",this.awaitingResponse=!1,this.priorities=Object.values(wst)}ngOnInit(){this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.titleService.setTitle(\"Cr\\xe9ation d'un ticket d'incident - ANAIS\"),this.ticketForms=this.fb.group({ticketTitle:[\"\",Xy.compose([Xy.required,Xy.maxLength(255)])],ticketPriority:[\"\",Xy.required],ticketDescription:[\"\",Xy.required]})}onValidation(){return Hp(this,void 0,void 0,function*(){this.ticketId=0;const t={title:this.ticketForms.controls.ticketTitle.value,priority:this.ticketForms.controls.ticketPriority.value,description:this.ticketForms.controls.ticketDescription.value};this.awaitingResponse=!0;try{yield this.workerService.tickets.uploadTicket(t),this.uiService.success(\"Le ticket a correctement \\xe9t\\xe9 cr\\xe9\\xe9.\",5e3),this.ticketForms.reset()}finally{this.awaitingResponse=!1}this.dialogRef.close(!1)})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(Pj),Oa(_H),Oa(sH),Oa(Lx),Oa(Rs),Oa(ZC))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ticket-creation-panel\"]],features:[Uo],decls:31,vars:4,consts:[[\"mat-dialog-title\",\"\",1,\"d-flex\"],[1,\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Fermer le panneau\",3,\"mat-dialog-close\"],[3,\"formGroup\"],[1,\"ticket-creation-panel__text-input\"],[\"matInput\",\"\",\"required\",\"\",\"maxlength\",\"255\",\"type\",\"text\",\"formControlName\",\"ticketTitle\",\"name\",\"ticketTitle\"],[1,\"ticket-creation-panel__select\"],[\"required\",\"\",\"formControlName\",\"ticketPriority\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[\"required\",\"\",\"matInput\",\"\",\"formControlName\",\"ticketDescription\",1,\"ticket-creation-panel__text-input-long\"],[1,\"d-flex-center\"],[\"class\",\"ticket-creation-panel__spinner\",3,\"diameter\",4,\"ngIf\"],[\"class\",\"ticket-creation-panel__margin\",\"mat-stroked-button\",\"\",3,\"disabled\",\"click\",4,\"ngIf\"],[3,\"value\"],[1,\"ticket-creation-panel__spinner\",3,\"diameter\"],[\"mat-stroked-button\",\"\",1,\"ticket-creation-panel__margin\",3,\"disabled\",\"click\"],[1,\"mr-1\"]],template:function(t,e){1&t&&(La(0,\"h1\",0),xl(1,\" Cr\\xe9ation de tickets d'incident \"),Na(2,\"div\",1),La(3,\"button\",2),La(4,\"mat-icon\"),xl(5,\"close\"),Fa(),Fa(),Fa(),La(6,\"div\",3),La(7,\"div\"),xl(8,\" Entrez le titre de l'incident \"),Fa(),La(9,\"mat-form-field\",4),La(10,\"mat-label\"),xl(11,\"Titre du ticket:\"),Fa(),Na(12,\"input\",5),Fa(),La(13,\"div\"),xl(14,\" Entrez la priorit\\xe9 du ticket \"),Fa(),La(15,\"mat-form-field\",6),La(16,\"mat-label\"),xl(17,\"Priorit\\xe9 du ticket\"),Fa(),La(18,\"mat-select\",7),oa(19,xst,2,2,\"mat-option\",8),Fa(),Fa(),La(20,\"div\"),xl(21,\" Entrez les d\\xe9tails de l'incident rencontr\\xe9 \"),Fa(),La(22,\"mat-form-field\",4),La(23,\"mat-label\"),xl(24,\" Description du ticket: \"),Fa(),La(25,\"textarea\",9),xl(26,\"    \"),Fa(),Fa(),Na(27,\"mat-divider\"),La(28,\"div\",10),oa(29,Sst,1,1,\"mat-spinner\",11),oa(30,Cst,5,1,\"button\",12),Fa(),Fa()),2&t&&(Cr(6),Ra(\"formGroup\",e.ticketForms),Cr(13),Ra(\"ngForOf\",e.priorities),Cr(10),Ra(\"ngIf\",e.awaitingResponse),Cr(1),Ra(\"ngIf\",!e.awaitingResponse))},directives:[rk,Ly,sk,uE,Cw,dx,AS,aS,ES,Gy,Ex,Px,Sw,_x,qT,Bd,Xq,Vd,ky,KJ],styles:[\".ticket-creation-panel[_ngcontent-%COMP%]{min-width:270px}.ticket-creation-panel__text-input[_ngcontent-%COMP%]{width:90%;margin:.5em .5em .5em 0;font-size:16px}.ticket-creation-panel__text-input-long[_ngcontent-%COMP%]{padding-right:0;min-height:250px}.ticket-creation-panel__select[_ngcontent-%COMP%]{width:40%}.ticket-creation-panel__spinner[_ngcontent-%COMP%]{display:block!important;margin:1.5em auto auto}.ticket-creation-panel__margin[_ngcontent-%COMP%]{margin:1.5em auto auto}\"]}),t})();function Est(t,e){1&t&&Na(0,\"mat-spinner\",3)}function Mst(t,e){1&t&&(La(0,\"mat-error\",19),xl(1,\" Ce champ ne peut \\xeatre vide. \"),Fa())}function Tst(t,e){if(1&t&&(La(0,\"mat-option\",20),xl(1),Fa()),2&t){const t=e.$implicit;Ra(\"value\",t),Cr(1),Cl(\" \",t,\" \")}}const Ist=function(t,e){return{\"ticket-details-panel__comment-text__user\":t,\"ticket-details-panel__comment-text__support\":e}},Pst=function(t,e){return{\"ticket-details-panel__timestamp__user\":t,\"ticket-details-panel__timestamp__support\":e}};function Ost(t,e){if(1&t&&(La(0,\"div\",21),La(1,\"p\",22),xl(2),Fa(),La(3,\"div\",23),ch(4,\"timeago\"),La(5,\"mat-icon\",24),xl(6,\"access_time\"),Fa(),xl(7),ch(8,\"date\"),Fa(),Na(9,\"div\",25),Fa()),2&t){const t=e.$implicit,i=Ka(3);Ra(\"ngClass\",nh(12,Ist,t.author===i.currentUserID,t.author!==i.currentUserID)),Cr(2),Cl(\" \",t.author===i.currentUserID?\"Vous\":t.author,\"\"),Cr(1),tl(\"title\",hh(4,6,t.time)),Ra(\"ngClass\",nh(15,Pst,t.author===i.currentUserID,t.author!==i.currentUserID)),Cr(4),Cl(\" \",dh(8,8,t.time,\"yyyy-MM-dd HH:mm:ss z\",i.useUTCDates&&\"+00\"),\" \"),Cr(2),Ra(\"innerHTML\",t.message,xs)}}function Rst(t,e){if(1&t){const t=$a();Ba(0,6),La(1,\"div\",7),La(2,\"mat-form-field\",8),Na(3,\"input\",9),oa(4,Mst,2,0,\"mat-error\",10),Fa(),La(5,\"button\",11),La(6,\"mat-icon\"),xl(7,\"check\"),Fa(),Fa(),La(8,\"button\",12),Ga(\"click\",function(){return Fe(t),Ka(2).switchEditMode()}),La(9,\"mat-icon\"),xl(10,\"clear\"),Fa(),Fa(),Fa(),La(11,\"div\",13),La(12,\"mat-form-field\",14),La(13,\"mat-label\"),xl(14,\"Priorit\\xe9 du ticket\"),Fa(),La(15,\"mat-select\",15),oa(16,Tst,2,2,\"mat-option\",16),Fa(),Fa(),La(17,\"mat-form-field\",14),La(18,\"mat-label\"),xl(19,\" Entrer la description du ticket: \"),Fa(),La(20,\"textarea\",17),xl(21,\"              \"),Fa(),Fa(),Na(22,\"mat-divider\"),oa(23,Ost,10,18,\"div\",18),Fa(),za()}if(2&t){const t=Ka(2);Ra(\"formGroup\",t.ticketForms),Cr(4),Ra(\"ngIf\",null==t.ticketForms.controls.title.errors?null:t.ticketForms.controls.title.errors.required),Cr(1),Ra(\"app-async-action\",t.updateTicket)(\"disabled\",!t.ticketForms.controls.title.valid),Cr(10),Ra(\"value\",t.ticket.priority),Cr(1),Ra(\"ngForOf\",t.priorities),Cr(7),Ra(\"ngForOf\",t.ticket.dataFlow)}}function Dst(t,e){if(1&t&&(La(0,\"div\",21),La(1,\"p\",22),xl(2),Fa(),La(3,\"div\",23),ch(4,\"timeago\"),La(5,\"mat-icon\",24),xl(6,\"access_time\"),Fa(),xl(7),ch(8,\"date\"),Fa(),Na(9,\"div\",25),Fa()),2&t){const t=e.$implicit,i=Ka(3);Ra(\"ngClass\",nh(12,Ist,t.author===i.currentUserID,t.author!==i.currentUserID)),Cr(2),Cl(\" \",t.author===i.currentUserID?\"Vous\":t.author,\"\"),Cr(1),tl(\"title\",hh(4,6,t.time)),Ra(\"ngClass\",nh(15,Pst,t.author===i.currentUserID,t.author!==i.currentUserID)),Cr(4),Cl(\" \",dh(8,8,t.time,\"yyyy-MM-dd HH:mm:ss z\",i.useUTCDates&&\"+00\"),\" \"),Cr(2),Ra(\"innerHTML\",t.message,xs)}}function Lst(t,e){if(1&t){const t=$a();La(0,\"div\",7),La(1,\"h2\",26),xl(2),Fa(),La(3,\"button\",27),Ga(\"click\",function(){return Fe(t),Ka(2).switchEditMode()}),La(4,\"mat-icon\"),xl(5,\" create \"),Fa(),Fa(),La(6,\"button\",28),Ga(\"click\",function(){return Fe(t),Ka(2).reloadDataEvent.emit(!0)}),La(7,\"mat-icon\"),xl(8,\"replay\"),Fa(),Fa(),Fa(),La(9,\"div\",13),La(10,\"h3\",26),xl(11,\" Description de l'incident: \"),Na(12,\"br\"),Fa(),La(13,\"div\",29),ch(14,\"timeago\"),La(15,\"mat-icon\",30),xl(16,\"access_time\"),Fa(),xl(17),ch(18,\"date\"),Fa(),Na(19,\"div\",31),Na(20,\"br\"),Na(21,\"mat-divider\"),La(22,\"h3\",26),xl(23,\" Commentaires: \"),Fa(),oa(24,Dst,10,18,\"div\",18),Ba(25,6),La(26,\"mat-form-field\",14),La(27,\"mat-label\"),xl(28,\" Ajouter votre commentaire: \"),Fa(),La(29,\"textarea\",32),xl(30,\"              \"),Fa(),Fa(),La(31,\"button\",33),xl(32,\" Envoyer \"),La(33,\"mat-icon\"),xl(34,\"check\"),Fa(),Fa(),za(),Fa()}if(2&t){const t=Ka(2);Cr(2),Sl(t.ticket.title),Cr(11),tl(\"title\",hh(14,8,t.ticket.createdAt)),Cr(4),Cl(\" \",dh(18,10,t.ticket.createdAt,\"yyyy-MM-dd HH:mm:ss z\",t.useUTCDates&&\"+00\"),\" \"),Cr(2),Ra(\"innerHTML\",t.ticket.description,xs),Cr(5),Ra(\"ngForOf\",t.ticket.dataFlow),Cr(1),Ra(\"formGroup\",t.ticketForms),Cr(6),Ra(\"app-async-action\",t.addComment)(\"disabled\",!t.ticketForms.controls.userComment.value)}}function Fst(t,e){if(1&t&&(La(0,\"ng-form\",4,5),oa(2,Rst,24,7,\"ng-template\",2),oa(3,Lst,35,14,\"ng-template\",2),Fa()),2&t){const t=Ka();Cr(2),Ra(\"ngIf\",t.editMode),Cr(1),Ra(\"ngIf\",!t.editMode)}}let Nst=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.titleService=t,this.mapService=e,this.mapConfigService=i,this.authenticationService=n,this.workerService=s,this.reloadDataEvent=new gh,this.editMode=!1,this.priorities=Object.values(wst),this.useUTCDates=!1,this.addComment=()=>Hp(this,void 0,void 0,function*(){yield this.workerService.tickets.publishComment(this.ticketForms.controls.userComment.value,this.ticket.id),this.ticketForms.controls.userComment.reset(),this.reloadDataEvent.emit(!0)}),this.updateTicket=()=>Hp(this,void 0,void 0,function*(){if(!this.ticketForms)throw new Error(\"Impossible d'envoyer les nouvelles informations\");yield this.workerService.tickets.updateTicket({id:this.ticket.id,createdAt:this.ticket.createdAt,title:this.ticketForms.controls.title.value,priority:this.ticketForms.controls.priority.value,description:this.ticketForms.controls.description.value,dataFlow:this.ticket.dataFlow}),yield this.switchEditMode(),this.reloadDataEvent.emit(!0)})}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t})),this.currentUserID=this.authenticationService.user$.value.id,this.titleService.setTitle(this.editMode?\"Mise \\xe0 jour d'un ticket d'incident - ANAIS\":\"D\\xe9tails d'un ticket d'incident - ANAIS\"),yield this.fetchTicketDetails()})}fetchTicketDetails(){return Hp(this,void 0,void 0,function*(){if(!this.ticket)throw new Error(\"Impossible de retrouver les d\\xe9tails du ticket\");this.ticketForms=new Zw({title:new Yw(this.ticket.title,Xy.maxLength(255)),priority:new Yw(this.ticket.priority),description:new Yw(this.ticket.description),userComment:new Yw(\"\")})})}switchEditMode(){return Hp(this,void 0,void 0,function*(){this.editMode=!this.editMode,yield this.fetchTicketDetails()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(Pj),Oa(qU),Oa(rH),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ticket-details-panel\"]],inputs:{ticket:\"ticket\"},outputs:{reloadDataEvent:\"reloadDataEvent\"},features:[Uo],decls:3,vars:2,consts:[[1,\"u-flex\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[3,\"ngIf\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"name\",\"form\",1,\"d-flex-column\",\"unscrollable\"],[\"form\",\"ngForm\"],[3,\"formGroup\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"ticket-details-panel__name-input\"],[\"matInput\",\"\",\"name\",\"title\",\"formControlName\",\"title\",\"placeholder\",\"Titre du ticket\",\"required\",\"\",\"maxlength\",\"255\"],[\"class\",\"input-error\",4,\"ngIf\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Enregistrer les changements\",3,\"app-async-action\",\"disabled\"],[\"mat-button\",\"\",\"title\",\"Annuler l'\\xe9dition\",3,\"click\"],[\"mat-dialog-content\",\"\",1,\"d-flex-column\",\"scrollable\",\"ticket-details-panel__text-input\"],[1,\"ticket-details-panel__text-input\"],[\"required\",\"\",\"formControlName\",\"priority\",3,\"value\"],[3,\"value\",4,\"ngFor\",\"ngForOf\"],[\"formControlName\",\"description\",\"name\",\"ticketDescription\",\"required\",\"\",\"matInput\",\"\"],[\"class\",\"u-flex ticket-details-panel__comment-text\",3,\"ngClass\",4,\"ngFor\",\"ngForOf\"],[1,\"input-error\"],[3,\"value\"],[1,\"u-flex\",\"ticket-details-panel__comment-text\",3,\"ngClass\"],[1,\"ticket-details-panel__comment-title\"],[3,\"title\",\"ngClass\"],[\"title\",\"Date de l'alerte\",1,\"mini-icon\",\"ticket-details-panel__timestamp__icon\",\"mr1\"],[3,\"innerHTML\"],[1,\"panel__title\",\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Modifier\",3,\"click\"],[\"mat-button\",\"\",\"color\",\"white\",\"title\",\"Rafraichir les informations\",1,\"ma-2\",3,\"click\"],[1,\"ticket-details-panel__timestamp__icon\",3,\"title\"],[\"title\",\"Date de l'alerte\",1,\"mr-1\"],[1,\"ticket-details-panel__comment-text\",3,\"innerHTML\"],[\"formControlName\",\"userComment\",\"name\",\"userComment\",\"matInput\",\"\"],[\"mat-button\",\"\",\"color\",\"primary\",\"title\",\"Envoyer le commentaire au support\",1,\"d-flex\",3,\"app-async-action\",\"disabled\"]],template:function(t,e){1&t&&(La(0,\"div\",0),oa(1,Est,1,0,\"mat-spinner\",1),oa(2,Fst,4,2,\"ng-template\",2),Fa()),2&t&&(Cr(1),Ra(\"ngIf\",!e.ticket),Cr(1),Ra(\"ngIf\",e.ticket))},directives:[Vd,KJ,Jw,Cw,dx,AS,ES,Gy,Sw,_x,Ex,Px,Ly,Jq,uE,ok,aS,qT,Bd,Xq,eS,ky,Fd],pipes:[$F,ip],styles:[\"[_nghost-%COMP%]     hr{border:1px!important;width:96%;background-color:#000;height:1px}.ticket-details-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.ticket-details-panel__name-input[_ngcontent-%COMP%]{margin-left:.5em;margin-top:.5em;flex:1;font-size:20px}.ticket-details-panel__text-input[_ngcontent-%COMP%]{margin-left:.5em;margin-top:.5em;font-size:16px;width:95%}.ticket-details-panel__comment-title[_ngcontent-%COMP%]{font-size:18px;margin:4px 0}.ticket-details-panel__comment-text[_ngcontent-%COMP%]{font-size:14px;padding-left:5px;padding-right:5px;margin-top:10px;border-radius:15px}.ticket-details-panel__comment-text__user[_ngcontent-%COMP%]{margin-left:auto;border:2px solid #41a8d1;background-color:#41a8d1;text-align:right}.ticket-details-panel__comment-text__support[_ngcontent-%COMP%]{margin-right:auto;border:2px solid #a7e47f;background-color:#a7e47f}.ticket-details-panel__timestamp__icon[_ngcontent-%COMP%]{vertical-align:text-top}.ticket-details-panel__timestamp__user[_ngcontent-%COMP%]{margin-left:auto;align-items:center}.ticket-details-panel__timestamp__support[_ngcontent-%COMP%]{margin-right:auto;align-items:center}\"]}),t})();function Bst(t,e){1&t&&(La(0,\"p\",12),xl(1,\"Aucun ticket\"),Fa())}function zst(t,e){1&t&&Na(0,\"mat-spinner\",13)}function Vst(t,e){if(1&t){const t=$a();La(0,\"div\",15),La(1,\"div\"),ch(2,\"lowercase\"),La(3,\"button\",16),Ga(\"click\",function(){const e=Fe(t).$implicit;return Ka(2).showTicket(e.id)}),xl(4),La(5,\"em\"),xl(6),Fa(),La(7,\"div\"),La(8,\"mat-icon\",17),xl(9,\" access_time \"),Fa(),xl(10),ch(11,\"date\"),Fa(),Fa(),Fa(),Fa()}if(2&t){const t=e.$implicit,i=Ka(2);Cr(1),Tl(\"priority priority__\",hh(2,9,t.priority),\"\"),Cr(2),tl(\"title\",t.title),Ra(\"@fadeAnimation\",void 0),Cr(1),Cl(\" \",t.title,\" \"),Cr(2),kl(\"(\",t.dataFlow.length,\" commentaire\",t.dataFlow.length>1?\"s\":\"\",\")\"),Cr(4),Cl(\" \",dh(11,11,t.createdAt,\"yyyy-MM-dd HH:mm:ss z\",i.useUTCDates&&\"+00\"),\" \")}}function $st(t,e){if(1&t&&(La(0,\"div\"),oa(1,Vst,12,15,\"div\",14),Fa()),2&t){const t=Ka();Cr(1),Ra(\"ngForOf\",t.ticketsList)}}function Ust(t,e){if(1&t){const t=$a();La(0,\"mat-paginator\",18),Ga(\"page\",function(e){return Fe(t),Ka().showTicketsPage(e.pageIndex)}),Fa()}if(2&t){const t=Ka();Ra(\"pageIndex\",t.currentTicketsPageIndex)(\"length\",t.ticketsTotal)(\"pageSize\",t.ticketsPageSize)}}function jst(t,e){if(1&t){const t=$a();La(0,\"div\",19),La(1,\"app-ticket-details-panel\",20),Ga(\"reloadDataEvent\",function(){return Fe(t),Ka().reloadTicketDetails()}),Fa(),Fa()}if(2&t){const t=Ka();Cr(1),Ra(\"ticket\",t.selectedTicket)}}let Hst=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.authenticationService=t,this.titleService=e,this.mapService=i,this.mapConfigService=n,this.workerService=s,this.ticketsList=[],this.currentTicketsPageIndex=0,this.ticketsPageSize=10,this.ticketsTotal=0,this.selectedTicket=null,this.ready=!1}ngOnInit(){return Hp(this,void 0,void 0,function*(){this.titleService.setTitle(\"Liste des tickets d'incident - ANAIS\"),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView(),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t})),this.currentUserID=this.authenticationService.user$.value.id,yield this.updateTicketList()})}showTicket(t){return Hp(this,void 0,void 0,function*(){const e=this.ticketsList.find(e=>e.id===t);this.selectedTicket=e===this.selectedTicket?null:e})}reloadTicketDetails(){return Hp(this,void 0,void 0,function*(){yield this.updateTicketList(),yield this.showTicket(this.selectedTicket.id)})}showTicketsPage(t){return Hp(this,void 0,void 0,function*(){this.currentTicketsPageIndex=t,yield this.updateTicketList(this.currentTicketsPageIndex)})}updateTicketList(t=this.currentTicketsPageIndex){return Hp(this,void 0,void 0,function*(){this.ready=!1;const e=yield this.workerService.tickets.fetchTicketsPage(t);this.ticketsTotal=e.total,this.ticketsList=e.incidents,this.ready=!0})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(rH),Oa(jp),Oa(Pj),Oa(qU),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ticket-list-panel\"]],hostAttrs:[1,\"d-flex\"],features:[Uo],decls:20,vars:6,consts:[[1,\"u-flex\"],[1,\"panel__header\",\"panel__header--blue\"],[1,\"panel__title\",\"u-flex\"],[\"mat-button\",\"\",\"title\",\"Rafraichir la liste\",3,\"click\"],[\"mat-button\",\"\",\"title\",\"Fermer la fen\\xeatre\",3,\"mat-dialog-close\"],[1,\"ticket-list-panel\"],[\"mat-stroked-button\",\"\",\"color\",\"primary\",\"routerLink\",\"/tickets/new\",1,\"ma-2\",3,\"mat-dialog-close\"],[\"class\",\"px-3\",4,\"ngIf\"],[\"class\",\"spinner\",\"strokeWidth\",\"4\",\"diameter\",\"80\",4,\"ngIf\"],[4,\"ngIf\"],[\"showFirstLastButtons\",\"\",\"hidePageSize\",\"\",3,\"pageIndex\",\"length\",\"pageSize\",\"page\",4,\"ngIf\"],[\"class\",\"scrollable\",4,\"ngIf\"],[1,\"px-3\"],[\"strokeWidth\",\"4\",\"diameter\",\"80\",1,\"spinner\"],[\"class\",\"ticket-list-panel__ticket\",4,\"ngFor\",\"ngForOf\"],[1,\"ticket-list-panel__ticket\"],[\"mat-button\",\"\",1,\"ticket-list-panel__ellipsis\",3,\"title\",\"click\"],[\"title\",\"Date de creation\",1,\"mr-1\"],[\"showFirstLastButtons\",\"\",\"hidePageSize\",\"\",3,\"pageIndex\",\"length\",\"pageSize\",\"page\"],[1,\"scrollable\"],[3,\"ticket\",\"reloadDataEvent\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"h2\",2),xl(3,\"Liste des incidents\"),Fa(),La(4,\"button\",3),Ga(\"click\",function(){return e.updateTicketList()}),La(5,\"mat-icon\"),xl(6,\"replay\"),Fa(),Fa(),La(7,\"button\",4),La(8,\"mat-icon\"),xl(9,\"close\"),Fa(),Fa(),Fa(),La(10,\"div\",5),La(11,\"button\",6),La(12,\"mat-icon\"),xl(13,\"add\"),Fa(),xl(14,\" Nouvel incident \"),Fa(),oa(15,Bst,2,0,\"p\",7),oa(16,zst,1,0,\"mat-spinner\",8),oa(17,$st,2,1,\"div\",9),oa(18,Ust,1,3,\"mat-paginator\",10),Fa(),Fa(),oa(19,jst,2,1,\"div\",11)),2&t&&(Cr(11),Ra(\"mat-dialog-close\",!1),Cr(4),Ra(\"ngIf\",0===e.ticketsList.length&&e.ready),Cr(1),Ra(\"ngIf\",!e.ready),Cr(1),Ra(\"ngIf\",e.ready),Cr(1),Ra(\"ngIf\",e.ready),Cr(1),Ra(\"ngIf\",e.selectedTicket))},directives:[Ly,uE,sk,mL,Vd,KJ,Bd,II,Nst],pipes:[ep,ip],styles:[\".ticket-list-panel[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.ticket-list-panel__tickets-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;overflow:hidden}.ticket-list-panel__ticket[_ngcontent-%COMP%]{flex:1;display:flex;transition:2s ease-out background-color;max-height:82px;text-align:center}.ticket-list-panel__ellipsis[_ngcontent-%COMP%]{max-width:500px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.priority[_ngcontent-%COMP%]{margin:auto;padding-left:10px;padding-right:10px;border-left:10px solid;border-right:10px solid;overflow:hidden!important;white-space:pre-wrap!important;line-height:normal;min-height:2em;width:100%}.priority__urgente[_ngcontent-%COMP%]{border-left-color:#b33f3d;border-right-color:#b33f3d}.priority__normale[_ngcontent-%COMP%]{border-left-color:#ffba30;border-right-color:#ffba30}.priority__basse[_ngcontent-%COMP%]{border-left-color:#1b95f2;border-right-color:#1b95f2}\"],data:{animation:[h5]}}),t})(),Gst=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.titleService=t,this.router=e,this.dialog=i,this.mapService=n,this.routeService=s}ngOnInit(){this.titleService.setTitle(\"Cr\\xe9ation d'un ticket d'incident - ANAIS\"),\"/tickets/new\"===this.router.url?(this.dialogComponent=kst,this.dialogRefCreate||this.createDialog()):(this.dialogComponent=Hst,this.dialogRefList||this.createDialog()),this.mapService.hasBooted$.value||this.mapService.resetToDefaultView()}createDialog(){this.dialogComponent===Hst?(this.dialogRefList=this.dialog.open(Hst,{height:\"85vh\",width:\"70vw\",maxWidth:\"70vw\",closeOnNavigation:!0,panelClass:[\"no-border-dialog\"]}),this.dialogRefList.afterClosed().subscribe((t=!0)=>Hp(this,void 0,void 0,function*(){if(t){const t=\"/tickets/new\"===this.routeService.previousUrl?\"\":this.routeService.previousUrl||\"\";yield this.router.navigateByUrl(t)}}))):(this.dialogRefCreate=this.dialog.open(kst,{height:\"85vh\",width:\"70vw\",maxWidth:\"70vw\",closeOnNavigation:!0}),this.dialogRefCreate.afterClosed().subscribe((t=!0)=>Hp(this,void 0,void 0,function*(){if(t){const t=this.routeService.previousUrl||\"\";yield this.router.navigateByUrl(t)}})))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(jp),Oa(pL),Oa(ik),Oa(Pj),Oa(Nj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ticket-creation-loader\"]],features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();function Wst(t){return e=>e.lift(new qst(t))}class qst{constructor(t){this.value=t}call(t,e){return e.subscribe(new Yst(t,this.value))}}class Yst extends g{constructor(t,e){super(t),this.value=e}_next(t){this.destination.next(this.value)}}const Zst=[\"*\"];function Kst(t,e){if(1&t){const t=$a();La(0,\"div\",2),Ga(\"click\",function(){return Fe(t),Ka()._onBackdropClicked()}),Fa()}2&t&&hl(\"mat-drawer-shown\",Ka()._isShowingBackdrop())}function Xst(t,e){1&t&&(La(0,\"mat-drawer-content\"),Ja(1,2),Fa())}const Qst=[[[\"mat-drawer\"]],[[\"mat-drawer-content\"]],\"*\"],Jst=[\"mat-drawer\",\"mat-drawer-content\",\"*\"],trt={transformDrawer:BA(\"transform\",[UA(\"open, open-instant\",$A({transform:\"none\",visibility:\"visible\"})),UA(\"void\",$A({\"box-shadow\":\"none\",visibility:\"hidden\"})),HA(\"void => open-instant\",zA(\"0ms\")),HA(\"void <=> open, open-instant => void\",zA(\"400ms cubic-bezier(0.25, 0.8, 0.25, 1)\"))])},ert=new Ji(\"MAT_DRAWER_DEFAULT_AUTOSIZE\",{providedIn:\"root\",factory:function(){return!1}}),irt=new Ji(\"MAT_DRAWER_CONTAINER\");let nrt=(()=>{class t extends Hg{constructor(t,e,i,n,s){super(i,n,s),this._changeDetectorRef=t,this._container=e}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(at(()=>rrt)),Oa(ic),Oa(jg),Oa(nu))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-drawer-content\"]],hostAttrs:[1,\"mat-drawer-content\"],hostVars:4,hostBindings:function(t,e){2&t&&cl(\"margin-left\",e._container._contentMargins.left,\"px\")(\"margin-right\",e._container._contentMargins.right,\"px\")},features:[Uo],ngContentSelectors:Zst,decls:1,vars:0,template:function(t,e){1&t&&(Qa(),Ja(0))},encapsulation:2,changeDetection:0}),t})(),srt=(()=>{class t{constructor(t,e,i,n,s,r,o){this._elementRef=t,this._focusTrapFactory=e,this._focusMonitor=i,this._platform=n,this._ngZone=s,this._doc=r,this._container=o,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position=\"start\",this._mode=\"over\",this._disableClose=!1,this._opened=!1,this._animationStarted=new C,this._animationEnd=new C,this._animationState=\"void\",this.openedChange=new gh(!0),this._openedStream=this.openedChange.pipe(Af(t=>t),M(()=>{})),this.openedStart=this._animationStarted.pipe(Af(t=>t.fromState!==t.toState&&0===t.toState.indexOf(\"open\")),Wst(void 0)),this._closedStream=this.openedChange.pipe(Af(t=>!t),M(()=>{})),this.closedStart=this._animationStarted.pipe(Af(t=>t.fromState!==t.toState&&\"void\"===t.toState),Wst(void 0)),this._destroyed=new C,this.onPositionChanged=new gh,this._modeChanged=new C,this.openedChange.subscribe(t=>{t?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus()}),this._ngZone.runOutsideAngular(()=>{qm(this._elementRef.nativeElement,\"keydown\").pipe(Af(t=>27===t.keyCode&&!this.disableClose&&!ef(t)),Of(this._destroyed)).subscribe(t=>this._ngZone.run(()=>{this.close(),t.stopPropagation(),t.preventDefault()}))}),this._animationEnd.pipe(Tf((t,e)=>t.fromState===e.fromState&&t.toState===e.toState)).subscribe(t=>{const{fromState:e,toState:i}=t;(0===i.indexOf(\"open\")&&\"void\"===e||\"void\"===i&&0===e.indexOf(\"open\"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(t){(t=\"end\"===t?\"end\":\"start\")!=this._position&&(this._position=t,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=Lf(t)}get autoFocus(){const t=this._autoFocus;return null==t?\"side\"!==this.mode:t}set autoFocus(t){this._autoFocus=Lf(t)}get opened(){return this._opened}set opened(t){this.toggle(Lf(t))}_takeFocus(){!this.autoFocus||!this._focusTrap||this._focusTrap.focusInitialElementWhenReady().then(t=>{!t&&\"function\"==typeof this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()})}_restoreFocus(){!this.autoFocus||(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,this._openedVia):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null,this._openedVia=null)}_isFocusWithinDrawer(){var t;const e=null===(t=this._doc)||void 0===t?void 0:t.activeElement;return!!e&&this._elementRef.nativeElement.contains(e)}ngAfterContentInit(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState()}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){this._focusTrap&&this._focusTrap.destroy(),this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0)}toggle(t=!this.opened,e){return this._setOpen(t,!t&&this._isFocusWithinDrawer(),e)}_setOpen(t,e,i=\"program\"){return this._opened=t,t?(this._animationState=this._enableAnimations?\"open\":\"open-instant\",this._openedVia=i):(this._animationState=\"void\",e&&this._restoreFocus()),this._updateFocusTrapState(),new Promise(t=>{this.openedChange.pipe(xf(1)).subscribe(e=>t(e?\"open\":\"close\"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&\"side\"!==this.mode)}_animationStartListener(t){this._animationStarted.next(t)}_animationDoneListener(t){this._animationEnd.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(ic),Oa(km),Oa(Vm),Oa(Hf),Oa(nu),Oa(Fu,8),Oa(irt,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-drawer\"]],hostAttrs:[\"tabIndex\",\"-1\",1,\"mat-drawer\"],hostVars:12,hostBindings:function(t,e){1&t&&Wa(\"@transform.start\",function(t){return e._animationStartListener(t)})(\"@transform.done\",function(t){return e._animationDoneListener(t)}),2&t&&(ia(\"align\",null),Pl(\"@transform\",e._animationState),hl(\"mat-drawer-end\",\"end\"===e.position)(\"mat-drawer-over\",\"over\"===e.mode)(\"mat-drawer-push\",\"push\"===e.mode)(\"mat-drawer-side\",\"side\"===e.mode)(\"mat-drawer-opened\",e.opened))},inputs:{position:\"position\",mode:\"mode\",disableClose:\"disableClose\",autoFocus:\"autoFocus\",opened:\"opened\"},outputs:{openedChange:\"openedChange\",_openedStream:\"opened\",openedStart:\"openedStart\",_closedStream:\"closed\",closedStart:\"closedStart\",onPositionChanged:\"positionChanged\"},exportAs:[\"matDrawer\"],ngContentSelectors:Zst,decls:2,vars:0,consts:[[\"cdkScrollable\",\"\",1,\"mat-drawer-inner-container\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0),Ja(1),Fa())},directives:[Hg],encapsulation:2,data:{animation:[trt.transformDrawer]},changeDetection:0}),t})(),rrt=(()=>{class t{constructor(t,e,i,n,s,r=!1,o){this._dir=t,this._element=e,this._ngZone=i,this._changeDetectorRef=n,this._animationMode=o,this._drawers=new vh,this.backdropClick=new gh,this._destroyed=new C,this._doCheckSubject=new C,this._contentMargins={left:null,right:null},this._contentMarginChanges=new C,t&&t.change.pipe(Of(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),s.change().pipe(Of(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=r}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=Lf(t)}get hasBackdrop(){return null==this._backdropOverride?!this._start||\"side\"!==this._start.mode||!this._end||\"side\"!==this._end.mode:this._backdropOverride}set hasBackdrop(t){this._backdropOverride=null==t?null:Lf(t)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe(hg(this._allDrawers),Of(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(t=>!t._container||t._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe(hg(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe(pf(10),Of(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,e=0;if(this._left&&this._left.opened)if(\"side\"==this._left.mode)t+=this._left._getWidth();else if(\"push\"==this._left.mode){const i=this._left._getWidth();t+=i,e-=i}if(this._right&&this._right.opened)if(\"side\"==this._right.mode)e+=this._right._getWidth();else if(\"push\"==this._right.mode){const i=this._right._getWidth();e+=i,t-=i}t=t||null,e=e||null,(t!==this._contentMargins.left||e!==this._contentMargins.right)&&(this._contentMargins={left:t,right:e},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe(Af(t=>t.fromState!==t.toState),Of(this._drawers.changes)).subscribe(t=>{\"open-instant\"!==t.toState&&\"NoopAnimations\"!==this._animationMode&&this._element.nativeElement.classList.add(\"mat-drawer-transition\"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),\"side\"!==t.mode&&t.openedChange.pipe(Of(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){!t||t.onPositionChanged.pipe(Of(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe(xf(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(t){t&&t._modeChanged.pipe(Of(q(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){const e=this._element.nativeElement.classList,i=\"mat-drawer-container-has-open\";t?e.add(i):e.remove(i)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{\"end\"==t.position?this._end=t:this._start=t}),this._right=this._left=null,this._dir&&\"rtl\"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&\"over\"!=this._start.mode||this._isDrawerOpen(this._end)&&\"over\"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._canHaveBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(t){return\"side\"!==t.mode||!!this._backdropOverride}_isDrawerOpen(t){return null!=t&&t.opened}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Eg,8),Oa(ic),Oa(nu),Oa(Mc),Oa(Gg),Oa(ert),Oa(wb,8))},t.\\u0275cmp=Gt({type:t,selectors:[[\"mat-drawer-container\"]],contentQueries:function(t,e,i){if(1&t&&(Ih(i,nrt,5),Ih(i,srt,5)),2&t){let t;Mh(t=Ph())&&(e._content=t.first),Mh(t=Ph())&&(e._allDrawers=t)}},viewQuery:function(t,e){if(1&t&&Th(nrt,5),2&t){let t;Mh(t=Ph())&&(e._userContent=t.first)}},hostAttrs:[1,\"mat-drawer-container\"],hostVars:2,hostBindings:function(t,e){2&t&&hl(\"mat-drawer-container-explicit-backdrop\",e._backdropOverride)},inputs:{autosize:\"autosize\",hasBackdrop:\"hasBackdrop\"},outputs:{backdropClick:\"backdropClick\"},exportAs:[\"matDrawerContainer\"],features:[Yl([{provide:irt,useExisting:t}])],ngContentSelectors:Jst,decls:4,vars:2,consts:[[\"class\",\"mat-drawer-backdrop\",3,\"mat-drawer-shown\",\"click\",4,\"ngIf\"],[4,\"ngIf\"],[1,\"mat-drawer-backdrop\",3,\"click\"]],template:function(t,e){1&t&&(Qa(Qst),oa(0,Kst,1,2,\"div\",0),Ja(1),Ja(2,1),oa(3,Xst,2,0,\"mat-drawer-content\",1)),2&t&&(Ra(\"ngIf\",e.hasBackdrop),Cr(3),Ra(\"ngIf\",!e._content))},directives:[Vd,nrt],styles:[\".mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\\n\"],encapsulation:2,changeDetection:0}),t})(),ort=(()=>{class t{}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275mod=Zt({type:t}),t.\\u0275inj=gt({imports:[[np,Fb,Gf,Kg],Kg,Fb]}),t})();class art extends fB{constructor(t,e,i){super(t),this.element=e,this.index=i}}var lrt=class extends r${constructor(t,e){if(super(),this.unique_=!!(e=e||{}).unique,this.array_=t||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(\"length\")}insertAt(t,e){if(t<0||t>this.getLength())throw new Error(\"Index out of bounds: \"+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new art(\"add\",e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new art(\"remove\",e,t)),e}setAt(t,e){if(t>=this.getLength())return void this.insertAt(t,e);if(t<0)throw new Error(\"Index out of bounds: \"+t);this.unique_&&this.assertUnique_(e,t);const i=this.array_[t];this.array_[t]=e,this.dispatchEvent(new art(\"remove\",i,t)),this.dispatchEvent(new art(\"add\",e,t))}updateLength_(){this.set(\"length\",this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new nz(58)}};function crt(t,e,i,n){const s=t.getZoom();if(void 0===s)return;const r=t.getConstrainedZoom(s+e),o=t.getResolutionForZoom(r);t.getAnimating()&&t.cancelAnimations(),t.animate({resolution:o,anchor:i,duration:void 0!==n?n:250,easing:IB})}var hrt=class extends r${constructor(t){super(),t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(\"active\")}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(\"active\",t)}setMap(t){this.map_=t}},urt={SINGLECLICK:\"singleclick\",CLICK:\"click\",DBLCLICK:\"dblclick\",POINTERDRAG:\"pointerdrag\",POINTERMOVE:\"pointermove\",POINTERDOWN:\"pointerdown\",POINTERUP:\"pointerup\",POINTEROVER:\"pointerover\",POINTEROUT:\"pointerout\",POINTERENTER:\"pointerenter\",POINTERLEAVE:\"pointerleave\",POINTERCANCEL:\"pointercancel\"},drt=class extends hrt{constructor(t){super(),this.delta_=(t=t||{}).delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:250}handleEvent(t){let e=!1;if(t.type==urt.DBLCLICK){const i=t.originalEvent,n=t.coordinate,s=i.shiftKey?-this.delta_:this.delta_;crt(t.map.getView(),s,n,this.duration_),i.preventDefault(),e=!0}return!e}};function prt(t){const e=t.length;let i=0,n=0;for(let s=0;s<e;s++)i+=t[s].clientX,n+=t[s].clientY;return[i/e,n/e]}var frt=class extends hrt{constructor(t){super(t=t||{}),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==urt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==urt.POINTERUP){const e=this.handleUpEvent(t);this.handlingDownUpSequence=e&&this.targetPointers.length>0}}else if(t.type==urt.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==urt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}};function mrt(t){const e=arguments;return function(t){let i=!0;for(let n=0,s=e.length;n<s&&(i=i&&e[n](t),i);++n);return i}}const grt=function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Art=function(t){return!t.map.getTargetElement().hasAttribute(\"tabindex\")||function(t){const e=t.map.getTargetElement(),i=t.map.getOwnerDocument().activeElement;return e.contains(i)}(t)},vrt=bB,_rt=function(t){const e=t.originalEvent;return 0==e.button&&!(NB&&BB&&e.ctrlKey)},brt=yB,yrt=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},wrt=function(t){const e=t.originalEvent;return!e.altKey&&(BB?e.metaKey:e.ctrlKey)&&!e.shiftKey},xrt=function(t){const e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Srt=function(t){const e=t.originalEvent,i=e.target.tagName;return\"INPUT\"!==i&&\"SELECT\"!==i&&\"TEXTAREA\"!==i&&!e.target.isContentEditable},Crt=function(t){const e=t.originalEvent;return sz(void 0!==e,56),\"mouse\"==e.pointerType},krt=function(t){const e=t.originalEvent;return sz(void 0!==e,56),e.isPrimary&&0===e.button};var Ert=class extends frt{constructor(t){super({stopDown:yB}),this.kinetic_=(t=t||{}).kinetic,this.lastCentroid=null,this.panning_=!1;const e=t.condition?t.condition:mrt(yrt,krt);this.condition_=t.onFocusOnly?mrt(Art,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=prt(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const e=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],n=t.map.getView();(function(t,e){t[0]*=e,t[1]*=e})(e,n.getResolution()),pV(e,n.getRotation()),n.adjustCenterInternal(e)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const t=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),s=i.getCenterInternal(),r=e.getPixelFromCoordinateInternal(s),o=e.getCoordinateFromPixelInternal([r[0]-t*Math.cos(n),r[1]-t*Math.sin(n)]);i.animateInternal({center:i.getConstrainedCenter(o),duration:500,easing:IB})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const e=t.map.getView();return this.lastCentroid=null,e.getAnimating()&&e.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}};function Mrt(t){if(void 0!==t)return 0}function Trt(t){if(void 0!==t)return t}var Irt=class extends frt{constructor(t){t=t||{},super({stopDown:yB}),this.condition_=t.condition?t.condition:grt,this.lastAngle_=void 0,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){if(!Crt(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Mrt)return;const n=e.getSize(),s=t.pixel,r=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);void 0!==this.lastAngle_&&i.adjustRotationInternal(-(r-this.lastAngle_)),this.lastAngle_=r}handleUpEvent(t){return!Crt(t)||(t.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(t){return!!(Crt(t)&&_rt(t)&&this.condition_(t))&&(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0)}},Prt=class extends pB{constructor(t){super(),this.geometry_=null,this.element_=document.createElement(\"div\"),this.element_.style.position=\"absolute\",this.element_.style.pointerEvents=\"auto\",this.element_.className=\"ol-box \"+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i=\"px\",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left=\"inherit\",t.top=\"inherit\",t.width=\"inherit\",t.height=\"inherit\"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);i[4]=i[0].slice(),this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new tW([i])}getGeometry(){return this.geometry_}};class Ort extends fB{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}var Rrt=class extends frt{constructor(t){super(),this.box_=new Prt((t=t||{}).className||\"ol-dragbox\"),this.minArea_=void 0!==t.minArea?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:_rt,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],s=i[1]-e[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ort(\"boxdrag\",t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Ort(e?\"boxend\":\"boxcancel\",t.coordinate,t)),!1}handleDownEvent(t){return!!this.condition_(t)&&(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ort(\"boxstart\",t.coordinate,t)),!0)}onBoxEnd(t){}},Drt=class extends Rrt{constructor(t){super({condition:(t=t||{}).condition?t.condition:xrt,className:t.className||\"ol-dragzoom\",minArea:t.minArea}),this.duration_=void 0!==t.duration?t.duration:200,this.out_=void 0!==t.out&&t.out}onBoxEnd(t){const e=this.getMap().getView();let i=this.getGeometry();if(this.out_){const t=e.rotatedExtentForGeometry(i),n=e.getResolutionForExtentInternal(t),s=e.getResolution()/n;i=i.clone(),i.scale(s*s)}e.fitInternal(i,{duration:this.duration_,easing:IB})}},Lrt=class extends hrt{constructor(t){super(),t=t||{},this.defaultCondition_=function(t){return yrt(t)&&Srt(t)},this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_,this.duration_=void 0!==t.duration?t.duration:100,this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128}handleEvent(t){let e=!1;if(\"keydown\"==t.type){const i=t.originalEvent,n=i.keyCode;if(this.condition_(t)&&(40==n||37==n||39==n||38==n)){const s=t.map.getView(),r=s.getResolution()*this.pixelDelta_;let o=0,a=0;40==n?a=-r:37==n?o=-r:39==n?o=r:a=r;const l=[o,a];pV(l,s.getRotation()),function(t,e,i){const n=t.getCenterInternal();n&&t.animateInternal({duration:void 0!==i?i:250,easing:OB,center:t.getConstrainedCenter([n[0]+e[0],n[1]+e[1]])})}(s,l,this.duration_),i.preventDefault(),e=!0}}return!e}},Frt=class extends hrt{constructor(t){super(),this.condition_=(t=t||{}).condition?t.condition:Srt,this.delta_=t.delta?t.delta:1,this.duration_=void 0!==t.duration?t.duration:100}handleEvent(t){let e=!1;if(\"keydown\"==t.type||\"keypress\"==t.type){const i=t.originalEvent,n=i.charCode;if(this.condition_(t)&&(n==\"+\".charCodeAt(0)||n==\"-\".charCodeAt(0))){const s=t.map,r=n==\"+\".charCodeAt(0)?this.delta_:-this.delta_;crt(s.getView(),r,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}},Nrt=class extends hrt{constructor(t){super(t=t||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==t.maxDelta?t.maxDelta:1,this.duration_=void 0!==t.duration?t.duration:250,this.timeout_=void 0!==t.timeout?t.timeout:80,this.useAnchor_=void 0===t.useAnchor||t.useAnchor,this.constrainResolution_=void 0!==t.constrainResolution&&t.constrainResolution;const e=t.condition?t.condition:vrt;this.condition_=t.onFocusOnly?mrt(Art,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.mode_=void 0,this.trackpadEventGap_=400,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();t&&t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||\"wheel\"!==t.type)return!0;const e=t.map,i=t.originalEvent;let n;if(i.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate),\"wheel\"==t.type&&(n=i.deltaY,LB&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(n/=zB),i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n*=40)),0===n)return!1;this.lastDelta_=n;const s=Date.now();void 0===this.startTime_&&(this.startTime_=s),(!this.mode_||s-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(n)<4?\"trackpad\":\"wheel\");const r=e.getView();if(\"trackpad\"===this.mode_&&!r.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(r.getAnimating()&&r.cancelAnimations(),r.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),r.adjustZoom(-n/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=s,!1;this.totalDelta_+=n;const o=Math.max(this.timeout_-(s-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,e),o),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-tV(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),crt(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}},Brt=class extends frt{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=yB),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==t.threshold?t.threshold:.3,this.duration_=void 0!==t.duration?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(void 0!==this.lastAngle_){const t=s-this.lastAngle_;this.rotationDelta_+=t,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=t}this.lastAngle_=s;const r=t.map,o=r.getView();if(o.getConstraints().rotation===Mrt)return;const a=r.getViewport().getBoundingClientRect(),l=prt(this.targetPointers);l[0]-=a.left,l[1]-=a.top,this.anchor_=r.getCoordinateFromPixelInternal(l),this.rotating_&&(r.render(),o.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return!(this.targetPointers.length<2&&(t.map.getView().endInteraction(this.duration_),1))}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},zrt=class extends frt{constructor(t){const e=t=t||{};e.stopDown||(e.stopDown=yB),super(e),this.anchor_=null,this.duration_=void 0!==t.duration?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,r=i.clientY-n.clientY,o=Math.sqrt(s*s+r*r);void 0!==this.lastDistance_&&(e=this.lastDistance_/o),this.lastDistance_=o;const a=t.map,l=a.getView();1!=e&&(this.lastScaleDelta_=e);const c=a.getViewport().getBoundingClientRect(),h=prt(this.targetPointers);h[0]-=c.left,h[1]-=c.top,this.anchor_=a.getCoordinateFromPixelInternal(h),a.render(),l.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){return!(this.targetPointers.length<2)||(t.map.getView().endInteraction(this.duration_,this.lastScaleDelta_>1?1:-1),!1)}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}};function Vrt(t){t=t||{};const e=new lrt,i=new class{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const s=this.points_[e]-this.points_[i],r=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(r,s),this.initialVelocity_=Math.sqrt(s*s+r*r)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}(-.005,.05,100);return(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&e.push(new Irt),(void 0===t.doubleClickZoom||t.doubleClickZoom)&&e.push(new drt({delta:t.zoomDelta,duration:t.zoomDuration})),(void 0===t.dragPan||t.dragPan)&&e.push(new Ert({onFocusOnly:t.onFocusOnly,kinetic:i})),(void 0===t.pinchRotate||t.pinchRotate)&&e.push(new Brt),(void 0===t.pinchZoom||t.pinchZoom)&&e.push(new zrt({duration:t.zoomDuration})),(void 0===t.keyboard||t.keyboard)&&(e.push(new Lrt),e.push(new Frt({delta:t.zoomDelta,duration:t.zoomDuration}))),(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&e.push(new Nrt({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration})),(void 0===t.shiftDragZoom||t.shiftDragZoom)&&e.push(new Drt({duration:t.zoomDuration})),e}var $rt=class extends r${constructor(t){super(),this.background_=t.background;const e=Object.assign({},t);\"object\"==typeof t.properties&&(delete e.properties,Object.assign(e,t.properties)),e.opacity=void 0!==t.opacity?t.opacity:1,sz(\"number\"==typeof e.opacity,64),e.visible=void 0===t.visible||t.visible,e.zIndex=t.zIndex,e.maxResolution=void 0!==t.maxResolution?t.maxResolution:1/0,e.minResolution=void 0!==t.minResolution?t.minResolution:0,e.minZoom=void 0!==t.minZoom?t.minZoom:-1/0,e.maxZoom=void 0!==t.maxZoom?t.maxZoom:1/0,this.className_=void 0!==e.className?e.className:\"ol-layer\",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:void 0===t||t},i=this.getZIndex();return e.opacity=tV(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==i||e.managed?i:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return kB()}getLayerStatesArray(t){return kB()}getExtent(){return this.get(\"extent\")}getMaxResolution(){return this.get(\"maxResolution\")}getMinResolution(){return this.get(\"minResolution\")}getMinZoom(){return this.get(\"minZoom\")}getMaxZoom(){return this.get(\"maxZoom\")}getOpacity(){return this.get(\"opacity\")}getSourceState(){return kB()}getVisible(){return this.get(\"visible\")}getZIndex(){return this.get(\"zIndex\")}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(\"extent\",t)}setMaxResolution(t){this.set(\"maxResolution\",t)}setMinResolution(t){this.set(\"minResolution\",t)}setMaxZoom(t){this.set(\"maxZoom\",t)}setMinZoom(t){this.set(\"minZoom\",t)}setOpacity(t){sz(\"number\"==typeof t,64),this.set(\"opacity\",t)}setVisible(t){this.set(\"visible\",t)}setZIndex(t){this.set(\"zIndex\",t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}};function Urt(t,e){if(!t.visible)return!1;const i=e.resolution;if(i<t.minResolution||i>=t.maxResolution)return!1;const n=e.zoom;return n>t.minZoom&&n<=t.maxZoom}var jrt=class extends $rt{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(\"source\",this.handleSourcePropertyChange_),this.setSource(t.source?t.source:null)}getLayersArray(t){return(t=t||[]).push(this),t}getLayerStatesArray(t){return(t=t||[]).push(this.getLayerState()),t}getSource(){return this.get(\"source\")||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():\"undefined\"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(QB(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=KB(t,\"change\",this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(t=>t([]))}getData(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}render(t,e){const i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(\"map\",t)}getMapInternal(){return this.get(\"map\")}setMap(t){this.mapPrecomposeKey_&&(QB(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(QB(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=KB(t,\"precompose\",function(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);sz(!e.some(function(t){return t.layer===i.layer}),67),e.push(i)},this),this.mapRenderKey_=KB(this,\"change\",t.render,t),this.changed())}setSource(t){this.set(\"source\",t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}},Hrt=class extends jrt{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.setPreload(void 0!==t.preload?t.preload:0),this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError)}getPreload(){return this.get(\"preload\")}setPreload(t){this.set(\"preload\",t)}getUseInterimTilesOnError(){return this.get(\"useInterimTilesOnError\")}setUseInterimTilesOnError(t){this.set(\"useInterimTilesOnError\",t)}getData(t){return super.getData(t)}},Grt=class extends n${constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return kB()}getData(t){return null}prepareFrame(t){return kB()}renderFrame(t,e){return kB()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(function(n,s){const r=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,s,r)}).bind(this)}forEachFeatureAtCoordinate(t,e,i,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){2===t.target.getState()&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return 2!=e&&3!=e&&t.addEventListener(\"change\",this.boundHandleImageChange_),0==e&&(t.load(),e=t.getState()),2==e}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&\"ready\"===t.getSourceState()&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}},Wrt=class extends fB{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}};const qrt=[];let Yrt=null;var Zrt=class extends Grt{constructor(t){super(t),this.container=null,this.tempTransform=[1,0,0,1,0,0],this.pixelTransform=[1,0,0,1,0,0],this.inversePixelTransform=[1,0,0,1,0,0],this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){let n;Yrt||function(){const t=document.createElement(\"canvas\");t.width=1,t.height=1,Yrt=t.getContext(\"2d\")}(),Yrt.clearRect(0,0,1,1);try{Yrt.drawImage(t,e,i,1,1,0,0,1,1),n=Yrt.getImageData(0,0,1,1).data}catch(s){return Yrt=null,null}return n}getBackground(t){let e=this.getLayer().getBackground();return\"function\"==typeof e&&(e=e(t.viewState.resolution)),e||void 0}useContainer(t,e,i){const n=this.getLayer().getClassName();let s,r;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&_B(y8(t.style.backgroundColor),y8(i)))){const e=t.firstElementChild;e instanceof HTMLCanvasElement&&(r=e.getContext(\"2d\"))}if(r&&r.canvas.style.transform===e?(this.container=t,this.context=r,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){s=document.createElement(\"div\"),s.className=n;let t=s.style;t.position=\"absolute\",t.width=\"100%\",t.height=\"100%\",r=jB();const e=r.canvas;s.appendChild(e),t=e.style,t.position=\"absolute\",t.left=\"0\",t.transformOrigin=\"top left\",this.container=s,this.context=r}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const n=Oz(i),s=Rz(i),r=Cz(i),o=Sz(i);pG(e.coordinateToPixelTransform,n),pG(e.coordinateToPixelTransform,s),pG(e.coordinateToPixelTransform,r),pG(e.coordinateToPixelTransform,o);const a=this.inversePixelTransform;pG(a,n),pG(a,s),pG(a,r),pG(a,o),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const s=new Wrt(t,this.inversePixelTransform,i,e);n.dispatchEvent(s)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(\"prerender\",t,e)}postRender(t,e){this.dispatchRenderEvent_(\"postrender\",t,e)}getRenderTransform(t,e,i,n,s,r,o){const a=n/e;return mG(this.tempTransform,s/2,r/2,a,-a,-i,-t[0]+o,-t[1])}disposeInternal(){delete this.frameState,super.disposeInternal()}},Krt=class extends Zrt{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedProjection=null,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=[1/0,1/0,-1/0,-1/0],this.tmpTileRange_=new h$(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return 2==i||4==i||3==i&&!n}getTile(t,e,i,n){const s=n.pixelRatio,r=n.viewState.projection,o=this.getLayer();let a=o.getSource().getTile(t,e,i,s,r);return 3==a.getState()&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=pG(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!cz(s,n))return null;const r=e.pixelRatio,o=e.viewState.projection,a=e.viewState,l=i.getRenderSource(),c=l.getTileGridForProjection(a.projection),h=l.getTilePixelRatio(e.pixelRatio);for(let u=c.getZForResolution(a.resolution);u>=c.getMinZoom();--u){const t=c.getTileCoordForCoordAndZ(n,u),e=l.getTile(u,t[1],t[2],r,o);if(!(e instanceof tz||e instanceof KV)||e instanceof KV&&4===e.getState())return null;if(2!==e.getState())continue;const i=c.getOrigin(u),s=y$(c.getTileSize(u)),d=c.getResolution(u),p=Math.floor(h*((n[0]-i[0])/d-t[1]*s[0])),f=Math.floor(h*((i[1]-n[1])/d-t[2]*s[1])),m=Math.round(h*l.getGutterForProjection(a.projection));return this.getImageData(e.getImage(),p+m,f+m)}return null}loadedTileCallback(t,e,i){return!!this.isDrawableTile(i)&&super.loadedTileCallback(t,e,i)}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,s=n.projection,r=n.resolution,o=n.center,a=n.rotation,l=t.pixelRatio,c=this.getLayer(),h=c.getSource(),u=h.getRevision(),d=h.getTileGridForProjection(s),p=d.getZForResolution(r,h.zDirection),f=d.getResolution(p);let m=t.extent;const g=t.viewState.resolution,A=h.getTilePixelRatio(l),v=Math.round(Dz(m)/g*l),_=Math.round(Iz(m)/g*l),b=i.extent&&jV(i.extent);b&&(m=Pz(m,jV(i.extent)));const y=f*v/2/A,w=f*_/2/A,x=[o[0]-y,o[1]-w,o[0]+y,o[1]+w],S=d.getTileRangeForExtentAndZ(m,p),C={};C[p]={};const k=this.createLoadedTileFinder(h,s,C),E=this.tmpExtent,M=this.tmpTileRange_;this.newTiles_=!1;const T=a?Tz(n.center,g,a,t.size):void 0;for(let B=S.minX;B<=S.maxX;++B)for(let e=S.minY;e<=S.maxY;++e){if(a&&!d.tileCoordIntersectsViewport([p,B,e],T))continue;const n=this.getTile(p,B,e,t);if(this.isDrawableTile(n)){const e=MB(this);if(2==n.getState()){C[p][n.tileCoord.toString()]=n;let t=n.inTransition(e);t&&1!==i.opacity&&(n.endTransition(e),t=!1),!this.newTiles_&&(t||!this.renderedTiles.includes(n))&&(this.newTiles_=!0)}if(1===n.getAlpha(e,t.time))continue}const s=d.getTileCoordChildTileRange(n.tileCoord,M,E);let r=!1;s&&(r=k(p+1,s)),r||d.forEachTileCoordParentTileRange(n.tileCoord,k,M,E)}const I=f/r*l/A;mG(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/l,1/l,a,-v/2,-_/2);const P=vG(this.pixelTransform);this.useContainer(e,P,this.getBackground(t));const O=this.context,R=O.canvas;gG(this.inversePixelTransform,this.pixelTransform),mG(this.tempTransform,v/2,_/2,I,I,0,-v/2,-_/2),R.width!=v||R.height!=_?(R.width=v,R.height=_):this.containerReused||O.clearRect(0,0,v,_),b&&this.clipUnrotated(O,t,b),h.getInterpolate()||(O.imageSmoothingEnabled=!1),this.preRender(O,t),this.renderedTiles.length=0;let D,L,F,N=Object.keys(C).map(Number);N.sort(mB),1!==i.opacity||this.containerReused&&!h.getOpaque(t.viewState.projection)?(D=[],L=[]):N=N.reverse();for(let B=N.length-1;B>=0;--B){const e=N[B],i=h.getTilePixelSize(e,l,s),n=d.getResolution(e)/f,r=i[0]*n*I,o=i[1]*n*I,a=d.getTileCoordForCoordAndZ(Oz(x),e),c=d.getTileCoordExtent(a),u=pG(this.tempTransform,[A*(c[0]-x[0])/f,A*(x[3]-c[3])/f]),m=A*h.getGutterForProjection(s),g=C[e];for(const s in g){const i=g[s],n=i.tileCoord,l=a[1]-n[1],c=Math.round(u[0]-(l-1)*r),d=a[2]-n[2],f=Math.round(u[1]-(d-1)*o),A=Math.round(u[0]-l*r),v=Math.round(u[1]-d*o),_=c-A,b=f-v,y=p===e,w=y&&1!==i.getAlpha(MB(this),t.time);let x=!1;if(!w)if(D){F=[A,v,A+_,v,A+_,v+b,A,v+b];for(let t=0,i=D.length;t<i;++t)if(p!==e&&e<L[t]){const e=D[t];Lz([A,v,A+_,v+b],[e[0],e[3],e[4],e[7]])&&(x||(O.save(),x=!0),O.beginPath(),O.moveTo(F[0],F[1]),O.lineTo(F[2],F[3]),O.lineTo(F[4],F[5]),O.lineTo(F[6],F[7]),O.moveTo(e[6],e[7]),O.lineTo(e[4],e[5]),O.lineTo(e[2],e[3]),O.lineTo(e[0],e[1]),O.clip())}D.push(F),L.push(e)}else O.clearRect(A,v,_,b);this.drawTileImage(i,t,A,v,_,b,m,y),D&&!w?(x&&O.restore(),this.renderedTiles.unshift(i)):this.renderedTiles.push(i),this.updateUsedTiles(t.usedTiles,h,i)}}return this.renderedRevision=u,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Az(this.renderedExtent_,x),this.renderedExtent_=x,this.renderedPixelRatio=l,this.renderedProjection=s,this.manageTilePyramid(t,h,d,l,s,m,p,c.getPreload()),this.scheduleExpireCache(t,h),this.postRender(O,t),i.extent&&O.restore(),O.imageSmoothingEnabled=!0,P!==R.style.transform&&(R.style.transform=P),this.container}drawTileImage(t,e,i,n,s,r,o,a){const l=this.getTileImage(t);if(!l)return;const c=MB(this),h=e.layerStatesArray[e.layerIndex],u=h.opacity*(a?t.getAlpha(c,e.time):1),d=u!==this.context.globalAlpha;d&&(this.context.save(),this.context.globalAlpha=u),this.context.drawImage(l,o,o,l.width-2*o,l.height-2*o,i,n,s,r),d&&this.context.restore(),u!==h.opacity?e.animate=!0:a&&t.endTransition(c)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=(function(t,e,i){const n=MB(t);n in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[n])}).bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=MB(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,s,r,o,a,l){const c=MB(e);c in t.wantedTiles||(t.wantedTiles[c]={});const h=t.wantedTiles[c],u=t.tileQueue,d=i.getMinZoom(),p=t.viewState.rotation,f=p?Tz(t.viewState.center,t.viewState.resolution,p,t.size):void 0;let m,g,A,v,_,b,y=0;for(b=d;b<=o;++b)for(g=i.getTileRangeForExtentAndZ(r,b,g),A=i.getResolution(b),v=g.minX;v<=g.maxX;++v)for(_=g.minY;_<=g.maxY;++_)p&&!i.tileCoordIntersectsViewport([b,v,_],f)||(o-b<=a?(++y,m=e.getTile(b,v,_,n,s),0==m.getState()&&(h[m.getKey()]=!0,u.isKeyQueued(m.getKey())||u.enqueue([m,c,i.getTileCoordCenter(m.tileCoord),A])),void 0!==l&&l(m)):e.useTile(b,v,_,s));e.updateCacheSize(y,s)}},Xrt=class extends Hrt{constructor(t){super(t)}createRenderer(){return new Krt(this)}};function Qrt(t,e){C8.expire()}var Jrt=class extends pB{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){kB()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;mG(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),gG(n,i)}forEachFeatureAtCoordinate(t,e,i,n,s,r,o,a){let l;const c=e.viewState;function h(t,e,i,n){return s.call(r,e,t?i:null,n)}const u=c.projection,d=gV(t.slice(),u),p=[[0,0]];if(u.canWrapX()&&n){const t=Dz(u.getExtent());p.push([-t,0],[t,0])}const f=e.layerStatesArray,m=f.length,g=[],A=[];for(let _=0;_<p.length;_++)for(let n=m-1;n>=0;--n){const s=f[n],r=s.layer;if(r.hasRenderer()&&Urt(s,c)&&o.call(a,r)){const n=r.getRenderer(),o=r.getSource();if(n&&o){const r=o.getWrapX()?d:t,a=h.bind(null,s.managed);A[0]=r[0]+p[_][0],A[1]=r[1]+p[_][1],l=n.forEachFeatureAtCoordinate(A,e,i,a,g)}if(l)return l}}if(0===g.length)return;const v=1/g.length;return g.forEach((t,e)=>t.distanceSq+=e*v),g.sort((t,e)=>t.distanceSq-e.distanceSq),g.some(t=>l=t.callback(t.feature,t.layer,t.geometry)),l}hasFeatureAtCoordinate(t,e,i,n,s,r){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,n,bB,this,s,r)}getMap(){return this.map_}renderFrame(t){kB()}scheduleExpireIconCache(t){C8.canExpireCache()&&t.postRenderFunctions.push(Qrt)}},tot=class extends Jrt{constructor(t){super(t),this.fontChangeListenerKey_=KB(o7,\"propertychange\",t.redrawText.bind(t)),this.element_=document.createElement(\"div\");const e=this.element_.style;e.position=\"absolute\",e.width=\"100%\",e.height=\"100%\",e.zIndex=\"0\",this.element_.className=G8+\" ol-layers\";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new Wrt(t,void 0,e);i.dispatchEvent(n)}}disposeInternal(){QB(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t)return void(this.renderedVisible_&&(this.element_.style.display=\"none\",this.renderedVisible_=!1));this.calculateMatrices2D(t),this.dispatchRenderEvent(\"precompose\",t);const e=t.layerStatesArray.sort(function(t,e){return t.zIndex-e.zIndex}),i=t.viewState;this.children_.length=0;const n=[];let s=null;for(let r=0,o=e.length;r<o;++r){const o=e[r];t.layerIndex=r;const a=o.layer,l=a.getSourceState();if(!Urt(o,i)||\"ready\"!=l&&\"undefined\"!=l){a.unrender();continue}const c=a.render(t,s);!c||(c!==s&&(this.children_.push(c),s=c),\"getDeclutter\"in a&&n.push(a))}for(let r=n.length-1;r>=0;--r)n[r].renderDeclutter(t);(function(t,e){const i=t.childNodes;for(let n=0;;++n){const s=i[n],r=e[n];if(!s&&!r)break;if(s!==r){if(!s){t.appendChild(r);continue}if(!r){t.removeChild(s),--n;continue}t.insertBefore(r,s)}}})(this.element_,this.children_),this.dispatchRenderEvent(\"postcompose\",t),this.renderedVisible_||(this.element_.style.display=\"\",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}};class eot extends fB{constructor(t,e){super(t),this.layer=e}}class iot extends $rt{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(\"layers\",this.handleLayersChanged_),i?Array.isArray(i)?i=new lrt(i.slice(),{unique:!0}):sz(\"function\"==typeof i.getArray,43):i=new lrt(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(QB),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(KB(t,\"add\",this.handleLayersAdd_,this),KB(t,\"remove\",this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(QB);xB(this.listenerKeys_);const e=t.getArray();for(let i=0,n=e.length;i<n;i++){const t=e[i];this.registerLayerListeners_(t),this.dispatchEvent(new eot(\"addlayer\",t))}this.changed()}registerLayerListeners_(t){const e=[KB(t,\"propertychange\",this.handleLayerChange_,this),KB(t,\"change\",this.handleLayerChange_,this)];t instanceof iot&&e.push(KB(t,\"addlayer\",this.handleLayerGroupAdd_,this),KB(t,\"removelayer\",this.handleLayerGroupRemove_,this)),this.listenerKeys_[MB(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new eot(\"addlayer\",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new eot(\"removelayer\",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new eot(\"addlayer\",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=MB(e);this.listenerKeys_[i].forEach(QB),delete this.listenerKeys_[i],this.dispatchEvent(new eot(\"removelayer\",e)),this.changed()}getLayers(){return this.get(\"layers\")}setLayers(t){const e=this.getLayers();if(e){const t=e.getArray();for(let e=0,i=t.length;e<i;++e)this.dispatchEvent(new eot(\"removelayer\",t[e]))}this.set(\"layers\",t)}getLayersArray(t){return t=void 0!==t?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});const n=this.getLayerState();let s=n.zIndex;!t&&void 0===n.zIndex&&(s=0);for(let r=i,o=e.length;r<o;r++){const t=e[r];t.opacity*=n.opacity,t.visible=t.visible&&n.visible,t.maxResolution=Math.min(t.maxResolution,n.maxResolution),t.minResolution=Math.max(t.minResolution,n.minResolution),t.minZoom=Math.max(t.minZoom,n.minZoom),t.maxZoom=Math.min(t.maxZoom,n.maxZoom),void 0!==n.extent&&(t.extent=void 0!==t.extent?Pz(t.extent,n.extent):n.extent),void 0===t.zIndex&&(t.zIndex=s)}return e}getSourceState(){return\"ready\"}}var not=iot,sot=class extends fB{constructor(t,e,i){super(t),this.map=e,this.frameState=void 0!==i?i:null}},rot=class extends sot{constructor(t,e,i,n,s,r){super(t,e,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==n&&n,this.activePointers=r}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),\"preventDefault\"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),\"stopPropagation\"in this.originalEvent&&this.originalEvent.stopPropagation()}},oot=class extends CB{constructor(t,e){super(t),this.map_=t,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===e?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=KB(i,\"pointerdown\",this.handlePointerDown_,this),this.relayedListenerKey_=KB(i,\"pointermove\",this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(\"touchmove\",this.boundHandleTouchMove_,!!UB&&{passive:!1})}emulateClick_(t){let e=new rot(urt.CLICK,this.map_,t);this.dispatchEvent(e),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new rot(urt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;const e=new rot(urt.SINGLECLICK,this.map_,t);this.dispatchEvent(e)}).bind(this),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==urt.POINTERUP||e.type==urt.POINTERCANCEL){delete this.trackedTouches_[i];for(const t in this.trackedTouches_)if(this.trackedTouches_[t].target!==e.target){delete this.trackedTouches_[t];break}}else(e.type==urt.POINTERDOWN||e.type==urt.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new rot(urt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(QB),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return 0===t.button}handlePointerDown_(t){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(t);const e=new rot(urt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const i in t){const e=t[i];this.down_[i]=\"function\"==typeof e?wB:e}if(0===this.dragListenerKeys_.length){const t=this.map_.getOwnerDocument();this.dragListenerKeys_.push(KB(t,urt.POINTERMOVE,this.handlePointerMove_,this),KB(t,urt.POINTERUP,this.handlePointerUp_,this),KB(this.element_,urt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==t&&this.dragListenerKeys_.push(KB(this.element_.getRootNode(),urt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new rot(urt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new rot(urt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(\"boolean\"!=typeof t.cancelable||!0===t.cancelable)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(QB(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(\"touchmove\",this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(QB(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(QB),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}};const aot=1/0;var lot={CENTER:\"center\",RESOLUTION:\"resolution\",ROTATION:\"rotation\"};function cot(t,e,i){return function(n,s,r,o,a){if(!n)return;if(!s&&!e)return n;const l=e?0:r[0]*s,c=e?0:r[1]*s,h=a?a[0]:0,u=a?a[1]:0;let d=t[0]+l/2+h,p=t[2]-l/2+h,f=t[1]+c/2+u,m=t[3]-c/2+u;d>p&&(d=(p+d)/2,p=d),f>m&&(f=(m+f)/2,m=f);let g=tV(n[0],d,p),A=tV(n[1],f,m);if(o&&i&&s){const t=30*s;g+=-t*Math.log(1+Math.max(0,d-n[0])/t)+t*Math.log(1+Math.max(0,n[0]-p)/t),A+=-t*Math.log(1+Math.max(0,f-n[1])/t)+t*Math.log(1+Math.max(0,n[1]-m)/t)}return[g,A]}}function hot(t){return t}function uot(t,e,i,n){const s=Dz(e)/i[0],r=Iz(e)/i[1];return n?Math.min(t,Math.max(s,r)):Math.min(t,Math.min(s,r))}function dot(t,e,i){let n=Math.min(t,e);return n*=Math.log(1+50*Math.max(0,t/e-1))/50+1,i&&(n=Math.max(n,i),n/=Math.log(1+50*Math.max(0,i/t-1))/50+1),tV(n,i/2,2*e)}function pot(t,e,i,n,s){return i=void 0===i||i,function(r,o,a,l){if(void 0!==r){const o=n?uot(t,n,a,s):t;return i&&l?dot(r,o,e):tV(r,e,o)}}}function fot(t,e){setTimeout(function(){t(e)},0)}function mot(t){return!(t.sourceCenter&&t.targetCenter&&!dV(t.sourceCenter,t.targetCenter)||t.sourceResolution!==t.targetResolution||t.sourceRotation!==t.targetRotation)}function got(t,e,i,n,s){const r=Math.cos(-s);let o=Math.sin(-s),a=t[0]*r-t[1]*o,l=t[1]*r+t[0]*o;return a+=(e[0]/2-i[0])*n,l+=(i[1]-e[1]/2)*n,o=-o,[a*r-l*o,l*r+a*o]}var Aot=class extends r${constructor(t){super(),t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.projection_=IV(t.projection,\"EPSG:3857\"),this.viewportSize_=[100,100],this.targetCenter_=null,this.nextCenter_=null,this.cancelAnchor_=void 0,t.projection&&xV(),t.center&&(t.center=$V(t.center)),t.extent&&(t.extent=jV(t.extent)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const o in lot)delete e[o];this.setProperties(e,!0);const i=function(t){let e,i,n;let s=void 0!==t.minZoom?t.minZoom:0,r=void 0!==t.maxZoom?t.maxZoom:28;const o=void 0!==t.zoomFactor?t.zoomFactor:2,a=void 0!==t.multiWorld&&t.multiWorld,l=void 0===t.smoothResolutionConstraint||t.smoothResolutionConstraint,c=void 0!==t.showFullExtent&&t.showFullExtent,h=IV(t.projection,\"EPSG:3857\"),u=h.getExtent();let d=t.constrainOnlyCenter,p=t.extent;if(!a&&!p&&h.isGlobal()&&(d=!1,p=u),void 0!==t.resolutions){const o=t.resolutions;i=o[s],n=void 0!==o[r]?o[r]:o[o.length-1],e=t.constrainResolution?function(t,e,i,n){return e=void 0===e||e,function(s,r,o,a){if(void 0!==s){const l=t[0],c=t[t.length-1],h=i?uot(l,i,o,n):l;if(a)return e?dot(s,h,c):tV(s,c,h);const u=Math.min(h,s),d=Math.floor(gB(t,u,r));return t[d]>h&&d<t.length-1?t[d+1]:t[d]}}}(o,l,!d&&p,c):pot(i,n,l,!d&&p,c)}else{const a=(u?Math.max(Dz(u),Iz(u)):360*Bz.degrees/h.getMetersPerUnit())/256/Math.pow(2,0),f=a/Math.pow(2,28);i=t.maxResolution,void 0!==i?s=0:i=a/Math.pow(o,s),n=t.minResolution,void 0===n&&(n=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(o,r):a/Math.pow(o,r):f),r=s+Math.floor(Math.log(i/n)/Math.log(o)),n=i/Math.pow(o,r-s),e=t.constrainResolution?function(t,e,i,n,s,r){return n=void 0===n||n,i=void 0!==i?i:0,function(o,a,l,c){if(void 0!==o){const h=s?uot(e,s,l,r):e;if(c)return n?dot(o,h,i):tV(o,i,h);const u=1e-9,d=Math.ceil(Math.log(e/h)/Math.log(t)-u),p=-a*(.5-u)+.5,f=Math.min(h,o),m=Math.floor(Math.log(e/f)/Math.log(t)+p),g=Math.max(d,m);return tV(e/Math.pow(t,g),i,h)}}}(o,i,n,l,!d&&p,c):pot(i,n,l,!d&&p,c)}return{constraint:e,maxResolution:i,minResolution:n,minZoom:s,zoomFactor:o}}(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const n=function(t){if(void 0!==t.extent)return cot(t.extent,t.constrainOnlyCenter,void 0===t.smoothExtentConstraint||t.smoothExtentConstraint);const e=IV(t.projection,\"EPSG:3857\");if(!0!==t.multiWorld&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,cot(t,!1,!1)}return hot}(t),s=i.constraint,r=function(t){if(void 0===t.enableRotation||t.enableRotation){const e=t.constrainRotation;return void 0===e||!0===e?function(t){return t=t||sV(5),function(e,i){return i?e:void 0!==e?Math.abs(e)<=t?0:e:void 0}}():!1===e?Trt:\"number\"==typeof e?function(t){const e=2*Math.PI/t;return function(t,i){return i?t:void 0!==t?t=Math.floor(t/e+.5)*e:void 0}}(e):Trt}return Mrt}(t);this.constraints_={center:n,resolution:s,rotation:r},this.setRotation(void 0!==t.rotation?t.rotation:0),this.setCenterInternal(void 0!==t.center?t.center:null),void 0!==t.resolution?this.setResolution(t.resolution):void 0!==t.zoom&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenter();if(i){const n=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution();this.setCenterInternal([i[0]+s/2*(n[3]-e[3]+e[1]-n[1]),i[1]-s/2*(n[0]-e[0]+e[2]-n[2])])}}getUpdatedOptions_(t){const e=this.getProperties();return void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let t=arguments[i];t.center&&(t=Object.assign({},t),t.center=$V(t.center,this.getProjection())),t.anchor&&(t=Object.assign({},t),t.anchor=$V(t.anchor,this.getProjection())),e[i]=t}this.animateInternal.apply(this,e)}animateInternal(t){let e,i=arguments.length;i>1&&\"function\"==typeof arguments[i-1]&&(e=arguments[i-1],--i);let n=0;for(;n<i&&!this.isDef();++n){const t=arguments[n];t.center&&this.setCenterInternal(t.center),void 0!==t.zoom?this.setZoom(t.zoom):t.resolution&&this.setResolution(t.resolution),void 0!==t.rotation&&this.setRotation(t.rotation)}if(n===i)return void(e&&fot(e,!0));let s=Date.now(),r=this.targetCenter_.slice(),o=this.targetResolution_,a=this.targetRotation_;const l=[];for(;n<i;++n){const t=arguments[n],i={start:s,complete:!1,anchor:t.anchor,duration:void 0!==t.duration?t.duration:1e3,easing:t.easing||PB,callback:e};if(t.center&&(i.sourceCenter=r,i.targetCenter=t.center.slice(),r=i.targetCenter),void 0!==t.zoom?(i.sourceResolution=o,i.targetResolution=this.getResolutionForZoom(t.zoom),o=i.targetResolution):t.resolution&&(i.sourceResolution=o,i.targetResolution=t.resolution,o=i.targetResolution),void 0!==t.rotation){i.sourceRotation=a;const e=rV(t.rotation-a+Math.PI,2*Math.PI)-Math.PI;i.targetRotation=a+e,a=i.targetRotation}mot(i)?i.complete=!0:s+=i.duration,l.push(i)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let t;this.setHint(0,-this.hints_[0]);for(let e=0,i=this.animations_.length;e<i;++e){const i=this.animations_[e];if(i[0].callback&&fot(i[0].callback,!1),!t)for(let e=0,n=i.length;e<n;++e){const n=i[e];if(!n.complete){t=n.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let s=!0;for(let i=0,r=n.length;i<r;++i){const r=n[i];if(r.complete)continue;const o=t-r.start;let a=r.duration>0?o/r.duration:1;a>=1?(r.complete=!0,a=1):s=!1;const l=r.easing(a);if(r.sourceCenter){const t=r.sourceCenter[0],e=r.sourceCenter[1],i=r.targetCenter[0],n=r.targetCenter[1];this.nextCenter_=r.targetCenter,this.targetCenter_=[t+l*(i-t),e+l*(n-e)]}if(r.sourceResolution&&r.targetResolution){const t=1===l?r.targetResolution:r.sourceResolution+l*(r.targetResolution-r.sourceResolution);if(r.anchor){const e=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(t,0,e,!0);this.targetCenter_=this.calculateCenterZoom(i,r.anchor)}this.nextResolution_=r.targetResolution,this.targetResolution_=t,this.applyTargetState_(!0)}if(void 0!==r.sourceRotation&&void 0!==r.targetRotation){const t=1===l?rV(r.targetRotation+Math.PI,2*Math.PI)-Math.PI:r.sourceRotation+l*(r.targetRotation-r.sourceRotation);if(r.anchor){const e=this.constraints_.rotation(t,!0);this.targetCenter_=this.calculateCenterRotate(e,r.anchor)}this.nextRotation_=r.targetRotation,this.targetRotation_=t}if(this.applyTargetState_(!0),e=!0,!r.complete)break}if(s){this.animations_[i]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const t=n[0].callback;t&&fot(t,!0)}}this.animations_=this.animations_.filter(Boolean),e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenterInternal();return void 0!==n&&(i=[n[0]-e[0],n[1]-e[1]],pV(i,t-this.getRotation()),function(t,e){t[0]+=+e[0],t[1]+=+e[1]}(i,e)),i}calculateCenterZoom(t,e){let i;const n=this.getCenterInternal(),s=this.getResolution();return void 0!==n&&void 0!==s&&(i=[e[0]-t*(e[0]-n[0])/s,e[1]-t*(e[1]-n[1])/s]),i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&VV(t,this.getProjection())}getCenterInternal(){return this.get(lot.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get(\"constrainResolution\")}getHints(t){return void 0!==t?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){return UV(this.calculateExtentInternal(t),this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();sz(e,1);const i=this.getResolution();sz(void 0!==i,2);const n=this.getRotation();return sz(void 0!==n,3),Mz(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(lot.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(jV(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Dz(t)/e[0],n=Iz(t)/e[1];return Math.max(i,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=Math.log(e/this.minResolution_)/Math.log(t);return function(n){return e/Math.pow(t,n*i)}}getRotation(){return this.get(lot.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=Math.log(i/this.minResolution_)/e;return function(t){return Math.log(i/t)/e/n}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const s=this.padding_;if(s){const t=this.getViewportSizeMinusPadding_();n=got(n,this.getViewportSize_(),[t[0]/2+s[3],t[1]/2+s[0]],e,i)}return{center:n.slice(0),projection:void 0!==t?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return void 0!==e&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e,i,n=this.minZoom_||0;if(this.resolutions_){const s=gB(this.resolutions_,t,1);n=s,e=this.resolutions_[s],i=s==this.resolutions_.length-1?2:e/this.resolutions_[s+1]}else e=this.maxResolution_,i=this.zoomFactor_;return n+Math.log(e/t)/Math.log(i)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=tV(Math.floor(t),0,this.resolutions_.length-2);return this.resolutions_[e]/Math.pow(this.resolutions_[e]/this.resolutions_[e+1],tV(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(sz(Array.isArray(t)||\"function\"==typeof t.getSimplifiedGeometry,24),Array.isArray(t))sz(!Fz(t),25),i=iW(jV(t,this.getProjection()));else if(\"Circle\"===t.getType()){const e=jV(t.getExtent(),this.getProjection());i=iW(e),i.rotate(this.getRotation(),kz(e))}else{const e=zV();i=e?t.clone().transform(e,this.getProjection()):t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),s=t.getFlatCoordinates(),r=t.getStride();let o=1/0,a=1/0,l=-1/0,c=-1/0;for(let h=0,u=s.length;h<u;h+=r){const t=s[h]*i-s[h+1]*n,e=s[h]*n+s[h+1]*i;o=Math.min(o,t),a=Math.min(a,e),l=Math.max(l,t),c=Math.max(c,e)}return[o,a,l,c]}fitInternal(t,e){let i=(e=e||{}).size;i||(i=this.getViewportSizeMinusPadding_());const n=void 0!==e.padding?e.padding:[0,0,0,0],s=void 0!==e.nearest&&e.nearest;let r;r=void 0!==e.minResolution?e.minResolution:void 0!==e.maxZoom?this.getResolutionForZoom(e.maxZoom):0;const o=this.rotatedExtentForGeometry(t);let a=this.getResolutionForExtentInternal(o,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);a=isNaN(a)?r:Math.max(a,r),a=this.getConstrainedResolution(a,s?0:1);const l=this.getRotation(),c=Math.sin(l),h=Math.cos(l),u=kz(o);u[0]+=(n[1]-n[3])/2*a,u[1]+=(n[0]-n[2])/2*a;const d=this.getConstrainedCenter([u[0]*h-u[1]*c,u[1]*h+u[0]*c],a),p=e.callback?e.callback:wB;void 0!==e.duration?this.animateInternal({resolution:a,center:d,duration:e.duration,easing:e.easing},p):(this.targetResolution_=a,this.targetCenter_=d,this.applyTargetState_(!1,!0),fot(p,!0))}centerOn(t,e,i){this.centerOnInternal($V(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(got(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let s;const r=this.padding_;if(r&&t){const o=this.getViewportSizeMinusPadding_(-i),a=got(t,n,[o[0]/2+r[3],o[1]/2+r[0]],e,i);s=[t[0]-a[0],t[1]-a[1]]}return s}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(t){const e=VV(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&$V(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=$V(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&$V(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(n),r=this.constraints_.resolution(this.targetResolution_,0,s,i),o=this.constraints_.center(this.targetCenter_,r,s,i,this.calculateCenterShift(this.targetCenter_,r,n,s));this.get(lot.ROTATION)!==n&&this.set(lot.ROTATION,n),this.get(lot.RESOLUTION)!==r&&(this.set(lot.RESOLUTION,r),this.set(\"zoom\",this.getZoom(),!0)),(!o||!this.get(lot.CENTER)||!dV(this.get(lot.CENTER),o))&&this.set(lot.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=void 0!==t?t:200;const n=e||0,s=this.constraints_.rotation(this.targetRotation_),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,n,r),a=this.constraints_.center(this.targetCenter_,o,r,!1,this.calculateCenterShift(this.targetCenter_,o,s,r));if(0===t&&!this.cancelAnchor_)return this.targetResolution_=o,this.targetRotation_=s,this.targetCenter_=a,void this.applyTargetState_();i=i||(0===t?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==s||!this.getCenterInternal()||!dV(this.getCenterInternal(),a))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:a,resolution:o,duration:t,easing:IB,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(t,e,i){i=i&&$V(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(1,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}},vot=class extends r${constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents=\"auto\"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){YB(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&YB(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)QB(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==wB&&this.listenerKeys.push(KB(t,\"postrender\",this.render,this)),t.render())}render(t){}setTarget(t){this.target_=\"string\"==typeof t?document.getElementById(t):t}},_ot=class extends vot{constructor(t){t=t||{},super({element:document.createElement(\"div\"),render:t.render,target:t.target}),this.ulElement_=document.createElement(\"ul\"),this.collapsed_=void 0===t.collapsed||t.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==t.collapsible,this.collapsible_=void 0===t.collapsible||t.collapsible,this.collapsible_||(this.collapsed_=!1);const e=void 0!==t.className?t.className:\"ol-attribution\",i=void 0!==t.tipLabel?t.tipLabel:\"Attributions\",n=void 0!==t.expandClassName?t.expandClassName:e+\"-expand\",s=void 0!==t.collapseLabel?t.collapseLabel:\"\\u203a\",r=void 0!==t.collapseClassName?t.collapseClassName:e+\"-collapse\";\"string\"==typeof s?(this.collapseLabel_=document.createElement(\"span\"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=r):this.collapseLabel_=s;const o=void 0!==t.label?t.label:\"i\";\"string\"==typeof o?(this.label_=document.createElement(\"span\"),this.label_.textContent=o,this.label_.className=n):this.label_=o;const a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement(\"button\"),this.toggleButton_.setAttribute(\"type\",\"button\"),this.toggleButton_.setAttribute(\"aria-expanded\",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(a),this.toggleButton_.addEventListener(\"click\",this.handleClick_.bind(this),!1);const l=this.element;l.className=e+\" \"+G8+\" \"+W8+(this.collapsed_&&this.collapsible_?\" \"+q8:\"\")+(this.collapsible_?\"\":\" ol-uncollapsible\"),l.appendChild(this.toggleButton_),l.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[];let n=!0;const s=t.layerStatesArray;for(let r=0,o=s.length;r<o;++r){const o=s[r];if(!Urt(o,t.viewState))continue;const a=o.layer.getSource();if(!a)continue;const l=a.getAttributions();if(!l)continue;const c=l(t);if(c)if(n=n&&!1!==a.getAttributionsCollapsible(),Array.isArray(c))for(let t=0,n=c.length;t<n;++t)c[t]in e||(i.push(c[t]),e[c[t]]=!0);else c in e||(i.push(c),e[c]=!0)}return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(t){if(!t)return void(this.renderedVisible_&&(this.element.style.display=\"none\",this.renderedVisible_=!1));const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?\"\":\"none\",this.renderedVisible_=i),!_B(e,this.renderedAttributions_)){ZB(this.ulElement_);for(let t=0,i=e.length;t<i;++t){const i=document.createElement(\"li\");i.innerHTML=e[t],this.ulElement_.appendChild(i)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(q8),this.collapsed_?qB(this.collapseLabel_,this.label_):qB(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute(\"aria-expanded\",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle(\"ol-uncollapsible\"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}},bot=class extends vot{constructor(t){t=t||{},super({element:document.createElement(\"div\"),render:t.render,target:t.target});const e=void 0!==t.className?t.className:\"ol-rotate\",i=void 0!==t.label?t.label:\"\\u21e7\",n=void 0!==t.compassClassName?t.compassClassName:\"ol-compass\";this.label_=null,\"string\"==typeof i?(this.label_=document.createElement(\"span\"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const s=t.tipLabel?t.tipLabel:\"Reset rotation\",r=document.createElement(\"button\");r.className=e+\"-reset\",r.setAttribute(\"type\",\"button\"),r.title=s,r.appendChild(this.label_),r.addEventListener(\"click\",this.handleClick_.bind(this),!1);const o=this.element;o.className=e+\" \"+G8+\" \"+W8,o.appendChild(r),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=void 0!==t.duration?t.duration:250,this.autoHide_=void 0===t.autoHide||t.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(H8)}handleClick_(t){t.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const e=t.getRotation();void 0!==e&&(this.duration_>0&&e%(2*Math.PI)!=0?t.animate({rotation:0,duration:this.duration_,easing:IB}):t.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const t=\"rotate(\"+i+\"rad)\";if(this.autoHide_){const t=this.element.classList.contains(H8);t||0!==i?t&&0!==i&&this.element.classList.remove(H8):this.element.classList.add(H8)}this.label_.style.transform=t}this.rotation_=i}},yot=class extends vot{constructor(t){t=t||{},super({element:document.createElement(\"div\"),target:t.target});const e=void 0!==t.className?t.className:\"ol-zoom\",i=void 0!==t.delta?t.delta:1,n=void 0!==t.zoomInClassName?t.zoomInClassName:e+\"-in\",s=void 0!==t.zoomOutClassName?t.zoomOutClassName:e+\"-out\",r=void 0!==t.zoomInLabel?t.zoomInLabel:\"+\",o=void 0!==t.zoomOutLabel?t.zoomOutLabel:\"\\u2013\",a=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:\"Zoom in\",l=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:\"Zoom out\",c=document.createElement(\"button\");c.className=n,c.setAttribute(\"type\",\"button\"),c.title=a,c.appendChild(\"string\"==typeof r?document.createTextNode(r):r),c.addEventListener(\"click\",this.handleClick_.bind(this,i),!1);const h=document.createElement(\"button\");h.className=s,h.setAttribute(\"type\",\"button\"),h.title=l,h.appendChild(\"string\"==typeof o?document.createTextNode(o):o),h.addEventListener(\"click\",this.handleClick_.bind(this,-i),!1);const u=this.element;u.className=e+\" \"+G8+\" \"+W8,u.appendChild(c),u.appendChild(h),this.duration_=void 0!==t.duration?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const e=this.getMap().getView();if(!e)return;const i=e.getZoom();if(void 0!==i){const n=e.getConstrainedZoom(i+t);this.duration_>0?(e.getAnimating()&&e.cancelAnimations(),e.animate({zoom:n,duration:this.duration_,easing:IB})):e.setZoom(n)}}};function wot(t){t instanceof jrt?t.setMapInternal(null):t instanceof not&&t.getLayers().forEach(wot)}function xot(t,e){if(t instanceof jrt)t.setMapInternal(e);else if(t instanceof not){const i=t.getLayers().getArray();for(let t=0,n=i.length;t<n;++t)xot(i[t],e)}}var Sot=class extends r${constructor(t){super();const e=function(t){let e=null;void 0!==t.keyboardEventTarget&&(e=\"string\"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);const i={},n=t.layers&&\"function\"==typeof t.layers.getLayers?t.layers:new not({layers:t.layers});let s,r,o;return i.layergroup=n,i.target=t.target,i.view=t.view instanceof Aot?t.view:new Aot,void 0!==t.controls&&(Array.isArray(t.controls)?s=new lrt(t.controls.slice()):(sz(\"function\"==typeof t.controls.getArray,47),s=t.controls)),void 0!==t.interactions&&(Array.isArray(t.interactions)?r=new lrt(t.interactions.slice()):(sz(\"function\"==typeof t.interactions.getArray,48),r=t.interactions)),void 0!==t.overlays?Array.isArray(t.overlays)?o=new lrt(t.overlays.slice()):(sz(\"function\"==typeof t.overlays.getArray,49),o=t.overlays):o=new lrt,{controls:s,interactions:r,keyboardEventTarget:e,overlays:o,values:i}}(t=t||{});this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16,this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:zB,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=[1,0,0,1,0,0],this.pixelToCoordinateTransform_=[1,0,0,1,0,0],this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement(\"div\"),this.viewport_.className=\"ol-viewport\"+(\"ontouchstart\"in window?\" ol-touch\":\"\"),this.viewport_.style.position=\"relative\",this.viewport_.style.overflow=\"hidden\",this.viewport_.style.width=\"100%\",this.viewport_.style.height=\"100%\",this.overlayContainer_=document.createElement(\"div\"),this.overlayContainer_.style.position=\"absolute\",this.overlayContainer_.style.zIndex=\"0\",this.overlayContainer_.style.width=\"100%\",this.overlayContainer_.style.height=\"100%\",this.overlayContainer_.style.pointerEvents=\"none\",this.overlayContainer_.className=\"ol-overlaycontainer\",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement(\"div\"),this.overlayContainerStopEvent_.style.position=\"absolute\",this.overlayContainerStopEvent_.style.zIndex=\"0\",this.overlayContainerStopEvent_.style.width=\"100%\",this.overlayContainerStopEvent_.style.height=\"100%\",this.overlayContainerStopEvent_.style.pointerEvents=\"none\",this.overlayContainerStopEvent_.className=\"ol-overlaycontainer-stopevent\",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=e.controls||function(t){t=t||{};const e=new lrt;return(void 0===t.zoom||t.zoom)&&e.push(new yot(t.zoomOptions)),(void 0===t.rotate||t.rotate)&&e.push(new bot(t.rotateOptions)),(void 0===t.attribution||t.attribution)&&e.push(new _ot(t.attributionOptions)),e}(),this.interactions=e.interactions||Vrt({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new class extends class{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,xB(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){sz(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=aot&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(t){return 2*t+1}getRightChildIndex_(t){return 2*t+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return 0===this.elements_.length}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,s=e[t],r=i[t],o=t;for(;t<n>>1;){const s=this.getLeftChildIndex_(t),r=this.getRightChildIndex_(t),o=r<n&&i[r]<i[s]?r:s;e[t]=e[o],i[t]=i[o],t=o}e[t]=s,i[t]=r,this.siftDown_(o,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,s=i[e],r=n[e];for(;e>t;){const t=this.getParentIndex_(e);if(!(n[t]>r))break;i[e]=i[t],n[e]=n[t],e=t}i[e]=s,n[e]=r}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const s=e.length;let r,o,a;for(o=0;o<s;++o)r=e[o],a=t(r),a==aot?delete this.queuedElements_[this.keyFunction_(r)]:(i[n]=a,e[n++]=r);e.length=n,i.length=n,this.heapify_()}}{constructor(t,e){super(function(e){return t.apply(null,e)},function(t){return t[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(\"change\",this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(2===i||3===i||4===i){3!==i&&e.removeEventListener(\"change\",this.boundHandleTileChange_);const t=e.getKey();t in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[t],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i,n,s,r=0;for(;this.tilesLoading_<t&&r<e&&this.getCount()>0;)n=this.dequeue()[0],s=n.getKey(),i=n.getState(),0===i&&!(s in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[s]=!0,++this.tilesLoading_,++r,n.load())}}(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(\"layergroup\",this.handleLayerGroupChanged_),this.addChangeListener(\"view\",this.handleViewChanged_),this.addChangeListener(\"size\",this.handleSizeChanged_),this.addChangeListener(\"target\",this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof Aot)&&t.view.then(function(t){i.setView(new Aot(t))}),this.controls.addEventListener(\"add\",(function(t){t.element.setMap(this)}).bind(this)),this.controls.addEventListener(\"remove\",(function(t){t.element.setMap(null)}).bind(this)),this.interactions.addEventListener(\"add\",(function(t){t.element.setMap(this)}).bind(this)),this.interactions.addEventListener(\"remove\",(function(t){t.element.setMap(null)}).bind(this)),this.overlays_.addEventListener(\"add\",(function(t){this.addOverlayInternal_(t.element)}).bind(this)),this.overlays_.addEventListener(\"remove\",(function(t){const e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()],t.element.setMap(null)}).bind(this)),this.controls.forEach((function(t){t.setMap(this)}).bind(this)),this.interactions.forEach((function(t){t.setMap(this)}).bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){xot(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(t);return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance:0,!1!==i.checkWrapped,e,null,void 0!==i.layerFilter?i.layerFilter:bB,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(t){i.push(t)},e),i}getAllLayers(){const t=[];return function e(i){i.forEach(function(i){i instanceof not?e(i.getLayers()):t.push(i)})}(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,void 0!==(e=void 0!==e?e:{}).hitTolerance?e.hitTolerance:0,!1!==e.checkWrapped,void 0!==e.layerFilter?e.layerFilter:bB,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i=\"changedTouches\"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]}getTarget(){return this.get(\"target\")}getTargetElement(){const t=this.getTarget();return void 0!==t?\"string\"==typeof t?document.getElementById(t):t:null}getCoordinateFromPixel(t){return VV(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?pG(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(\"layergroup\")}setLayers(t){const e=this.getLayerGroup();if(t instanceof lrt)return void e.setLayers(t);const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e];if(!i.visible)continue;const n=i.layer.getRenderer();if(n&&!n.ready)return!0;const s=i.layer.getSource();if(s&&s.loading)return!0}return!1}getPixelFromCoordinate(t){const e=$V(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?pG(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(\"size\")}getView(){return this.get(\"view\")}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return function(t,e,i,n,s){if(!t||!(i in t.wantedTiles)||!t.wantedTiles[i][e.getKey()])return aot;const r=t.viewState.center,o=n[0]-r[0],a=n[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}(this.frameState_,t,e,i,n)}handleBrowserEvent(t,e){const i=new rot(e=e||t.type,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(\"pointerdown\"===i||\"wheel\"===i||\"keydown\"===i){const t=this.getOwnerDocument(),i=this.viewport_.getRootNode?this.viewport_.getRootNode():t,n=e.target;if(this.overlayContainerStopEvent_.contains(n)||!(i===t?t.documentElement:i).contains(n))return}if(t.frameState=this.frameState_,!1!==this.dispatchEvent(t)){const e=this.getInteractions().getArray().slice();for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.getMap()===this&&n.getActive()&&this.getTargetElement()&&(!n.handleEvent(t)||t.propagationStopped))break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let i=this.maxTilesLoading_,n=i;if(t){const e=t.viewHints;if(e[0]||e[1]){const e=Date.now()-t.time>8;i=e?0:8,n=e?0:2}}e.getTilesLoading()<i&&(e.reprioritize(),e.loadMoreTiles(i,n))}t&&this.renderer_&&!t.animate&&(!0===this.renderComplete_?(this.hasListener(\"rendercomplete\")&&this.renderer_.dispatchRenderEvent(\"rendercomplete\",t),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new sot(\"loadend\",this,t)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new sot(\"loadstart\",this,t))));const i=this.postRenderFunctions_;for(let n=0,s=i.length;n<s;++n)i[n](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)QB(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(\"contextmenu\",this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(\"wheel\",this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,YB(this.viewport_)}const t=this.getTargetElement();if(t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new tot(this)),this.mapBrowserEventHandler_=new oot(this,this.moveTolerance_);for(const t in urt)this.mapBrowserEventHandler_.addEventListener(urt[t],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(\"contextmenu\",this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(\"wheel\",this.boundHandleBrowserEvent_,!!UB&&{passive:!1});const e=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[KB(i,\"keydown\",this.handleBrowserEvent,this),KB(i,\"keypress\",this.handleBrowserEvent,this),KB(e,\"resize\",this.updateSize,this)]}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(QB(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(QB(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=KB(t,\"propertychange\",this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=KB(t,\"change\",this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(QB),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new eot(\"addlayer\",t)),this.layerGroupPropertyListenerKeys_=[KB(t,\"propertychange\",this.render,this),KB(t,\"change\",this.render,this),KB(t,\"addlayer\",this.handleLayerAdd_,this),KB(t,\"removelayer\",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const i=t[e].layer;i.hasRenderer()&&i.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){wot(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let s=null;if(void 0!==e&&_$(e)&&i&&i.isDef()){const n=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),r=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Mz(r.center,r.resolution,r.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:r,viewHints:n,wantedTiles:{},mapId:MB(this),renderTargets:{}},r.nextCenter&&r.nextResolution){const t=isNaN(r.nextRotation)?r.rotation:r.nextRotation;s.nextExtent=Mz(r.nextCenter,r.nextResolution,t,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!Fz(this.previousExtent_)&&!Az(s.extent,this.previousExtent_))&&(this.dispatchEvent(new sot(\"movestart\",this,n)),this.previousExtent_=fz(this.previousExtent_)),this.previousExtent_&&!s.viewHints[0]&&!s.viewHints[1]&&!Az(s.extent,this.previousExtent_)&&(this.dispatchEvent(new sot(\"moveend\",this,s)),az(s.extent,this.previousExtent_))),this.dispatchEvent(new sot(\"postrender\",this,s)),this.renderComplete_=this.hasListener(\"loadstart\")||this.hasListener(\"loadend\")||this.hasListener(\"rendercomplete\")?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new eot(\"removelayer\",e)),this.set(\"layergroup\",t)}setSize(t){this.set(\"size\",t)}setTarget(t){this.set(\"target\",t)}setView(t){if(!t||t instanceof Aot)return void this.set(\"view\",t);this.set(\"view\",new Aot);const e=this;t.then(function(t){e.setView(new Aot(t))})}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),s=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(n)&&!isNaN(s)&&(e=[n,s],!_$(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn(\"No map visible because the map container's width or height are 0.\"))}this.setSize(e),this.updateViewportSize_()}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}},Cot=(()=>(function(t){t[t.z0=0]=\"z0\",t[t.z10=10]=\"z10\",t[t.z20=20]=\"z20\",t[t.z40=40]=\"z40\",t[t.z60=60]=\"z60\",t[t.z80=80]=\"z80\",t[t.z100=100]=\"z100\"}(Cot||(Cot={})),Cot))();class kot{constructor(t){Object.assign(this,t)}static fromOLView(t){return new kot({zoom:t.getZoom(),center:t.getProperties().center,extent:t.calculateExtent(),resolution:t.getResolution(),minResolution:t.getMinResolution(),maxResolution:t.getMaxResolution(),projection:t.getProjection(),viewportSize:t.viewportSize_})}toURL(){const t=OV(this.center);return`@${t[1].toFixed(7)},${t[0].toFixed(7)},${this.zoom}z`}toLocateEvent(){return new ZU({center:this.center,zoom:this.zoom})}}const Eot=[\"root\"],Mot=[\"*\"];let Tot=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o){super(),this.ngZone=t,this.changeDetectionRef=e,this.mapService=i,this.mapConfigService=n,this.mapStateService=s,this.offlineService=r,this.workerService=o,this.horizontalCenterShiftPixels=0,this.cursor=\"default\",this.viewChange$=new C,this.animatingMinimumZoom=!1}ngOnInit(){this.changeDetectionRef.detach(),this.mapService.init(),this.mapService.locateEvents$.pipe(FO(),Oj(0)).subscribe(t=>{this.ngZone.runOutsideAngular(()=>{if(!function(){const e=document.createElement(\"canvas\");for(const i of Iot)try{const t=e.getContext(i);if(t)return t.getExtension(\"WEBGL_lose_context\").loseContext(),!0}catch(t){}return!1}())throw new Error(\"Impossible de r\\xe9cup\\xe9rer le contexte WebGL. Veuillez rafraichir l'onglet ou fermer puis r\\xe9ouvrir votre navigateur.\");this.createMap(t.center,t.zoom)})}),this.subscriptions.push(this.workerService.applicationHealth$.pipe(M(t=>!!(null==t?void 0:t.maintenance)),Tf(),kf(1)).subscribe(t=>{this.map.updateSize()}))}ngOnDestroy(){super.ngOnDestroy(),this.mapService.destroy()}createMap(t,e){let i=1;this.mapStateService.minimumZoom$.pipe(FO()).subscribe(t=>{i=t});const n=new Aot({minZoom:i,maxZoom:20,smoothResolutionConstraint:!1}),s=this.computeRealCenter(new ZU({center:t,zoom:e}),n);n.setCenter(s.center),n.setZoom(s.zoom);const r=new Xrt({zIndex:Cot.z0});this.map=new Sot({target:this.rootElement.nativeElement,view:n,layers:[r],controls:[],interactions:Vrt({keyboard:!1,doubleClickZoom:!1,pinchRotate:!1,shiftDragZoom:!1})}),n.on(\"change\",()=>this.viewChange$.next()),n.on(\"change:resolution\",()=>this.viewChange$.next()),this.map.on(\"pointerdrag\",()=>this.viewChange$.next()),this.subscriptions.push(this.mapStateService.defaultCursorHandling$.subscribe(t=>{var e,i;t?(this.pointerMoveSubscription=qm(this.map,\"pointermove\").pipe(FM(16,uf,{leading:!1,trailing:!0})).subscribe(t=>{t.dragging?\"grabbing\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"grabbing\"):(this.mapService.emitPointerMoveEvent(t),this.map.hasFeatureAtPixel(this.map.getEventPixel(t.originalEvent),{hitTolerance:3,layerFilter:t=>t.selectable})?\"pointer\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"pointer\"):\"default\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"default\"))}),this.pointerUpSubscription=qm(this.map.getTargetElement(),\"mouseup\").subscribe(()=>{\"default\"!==this.cursor&&(this.cursor=this.map.getTargetElement().style.cursor=\"default\")})):(this.cursor=\"custom\",null===(e=this.pointerMoveSubscription)||void 0===e||e.unsubscribe(),null===(i=this.pointerUpSubscription)||void 0===i||i.unsubscribe())}),this.mapService.locateEvents$.subscribe(t=>{n.cancelAnimations(),n.animate(this.computeRealCenter(t,n))}),this.mapService.flyToEvents$.subscribe(t=>{n.cancelAnimations();const e=this.computeRealCenter(t,n);cz(n.calculateExtent(),e.center)?n.animate(e):function(t,e){Hp(this,void 0,void 0,function*(){return new Promise(i=>{const n=2e3,s=t.getZoom();let r=2,o=!1;function a(t){--r,!o&&(0===r||!t)&&(o=!0,i(t))}t.animate({center:e,duration:n},a),t.animate({zoom:s-2,duration:n/2},{zoom:s,duration:n/2},a)})})}(n,e.center)}),this.mapService.fitEvents$.subscribe(t=>{n.cancelAnimations(),n.fit(t.polygon,{duration:t.duration,padding:[100,100,100,100+this.horizontalCenterShiftPixels]})}),this.mapService.zoomEvents$.subscribe(t=>{const e=n.getConstrainedResolution(n.getResolutionForZoom(n.getZoom()+t));n.cancelAnimations();const i=n.getCenter();n.animate({resolution:e,center:[i[0]+this.horizontalCenterShiftPixels/2*(t>0?1:-.5)*e,i[1]],duration:250,easing:IB})}),this.mapConfigService.preloadMapTiles$.subscribe(t=>{r.setPreload(t?1/0:0)}),this.mapConfigService.baseLayer$.subscribe(t=>{r.setSource(t.source),r.once(\"prerender\",e=>{r.getRenderer().container.className=t.layerClass?t.layerClass:\"ol-layer\"})}),this.offlineService.offlineConfig$.subscribe(t=>{t?(r.setExtent(t.mercatorExtent),r.getSource().tileGrid=C$({minZoom:t.minZoom,maxZoom:t.maxZoom})):(r.setExtent(null),r.getSource().tileGrid=C$())}),this.mapStateService.minimumZoom$.pipe(kf(1),pf(60)).subscribe(t=>{t!==n.getMinZoom()&&(n.getZoom()<t?(this.animatingMinimumZoom=!0,n.cancelAnimations(),n.animate({zoom:t,duration:250,easing:IB}),setTimeout(()=>{n.setMinZoom(t),this.animatingMinimumZoom=!1,this.viewChange$.next()},250)):n.setMinZoom(t))}),this.viewChange$.pipe(Af(()=>!this.animatingMinimumZoom),FM(50,uf,{leading:!1,trailing:!0})).subscribe(()=>{this.mapService.updateViewState(kot.fromOLView(this.map.getView()))}));const o=Wq(10).subscribe(()=>{this.map.isRendered()?(this.viewChange$.next(),o.unsubscribe()):this.map.updateSize()})}onWindowResize(){this.map&&this.viewChange$.next()}computeRealCenter(t,e){const i=t.zoom?e.getResolutionForZoom(t.zoom):e.getResolution();return t.center[0]-=this.horizontalCenterShiftPixels/2*i,t}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(Mc),Oa(Pj),Oa(qU),Oa(Fq),Oa(MY),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-map\"]],viewQuery:function(t,e){if(1&t&&Th(Eot,7),2&t){let t;Mh(t=Ph())&&(e.rootElement=t.first)}},hostBindings:function(t,e){1&t&&Ga(\"resize\",function(){return e.onWindowResize()},!1,Ls)},inputs:{horizontalCenterShiftPixels:\"horizontalCenterShiftPixels\"},exportAs:[\"map\"],features:[Uo],ngContentSelectors:Mot,decls:3,vars:0,consts:[[1,\"map\"],[\"root\",\"\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",0,1),Ja(2),Fa())},styles:[\".map[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;overflow:hidden}\"],changeDetection:0}),t})();const Iot=[\"experimental-webgl\",\"webgl\",\"webkit-3d\",\"moz-webgl\"];function Pot(t,e){if(1&t&&(La(0,\"div\",10),La(1,\"mat-icon\",11),xl(2,\"access_time\"),Fa(),La(3,\"div\",12),ch(4,\"timeago\"),xl(5),ch(6,\"date\"),Fa(),Fa()),2&t){const t=Ka();Cr(3),tl(\"title\",hh(4,2,1e3*t.aircraft.timestamp)),Cr(2),Cl(\" \",dh(6,4,1e3*t.aircraft.timestamp,\"yyyy-MM-dd HH:mm:ss z\",t.useUTCDates&&\"+00\"),\" \")}}let Oot=(()=>{class t extends Gq{constructor(t,e){super(),this.changeDetectorRef=t,this.mapConfigService=e,this.showTimestamp=!1,this.useUTCDates=!1}ngOnInit(){this.ensureMandatoryInputParams(\"aircraft\"),this.subscriptions.push(this.mapConfigService.useUTCDates$.subscribe(t=>{this.useUTCDates=t,this.changeDetectorRef.markForCheck()}))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(qU))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-aircraft-item-small\"]],inputs:{aircraft:\"aircraft\",showTimestamp:\"showTimestamp\"},features:[Uo],decls:23,vars:8,consts:[[1,\"aircraft-item\"],[1,\"aircraft-item__col1\"],[1,\"u-flex\",\"d-flex-center\"],[1,\"aircraft-item__flag\",3,\"flag\"],[1,\"d-flex-column\"],[1,\"aircraft-item__name\"],[1,\"aircraft-item__type\"],[\"class\",\"aircraft-item__timestamp\",\"title\",\"Derni\\xe8re r\\xe9ception\",4,\"ngIf\"],[1,\"aircraft-item__col2\"],[1,\"aircraft-item__label\"],[\"title\",\"Derni\\xe8re r\\xe9ception\",1,\"aircraft-item__timestamp\"],[1,\"mini-icon\",\"mr-1\"],[3,\"title\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),La(2,\"div\",2),Na(3,\"app-flag\",3),La(4,\"div\",4),La(5,\"strong\",5),xl(6),Fa(),La(7,\"small\",6),xl(8),Fa(),Fa(),Fa(),oa(9,Pot,7,8,\"div\",7),Fa(),La(10,\"div\",8),La(11,\"div\"),La(12,\"span\",9),xl(13,\"ICAO\"),Fa(),xl(14),Fa(),La(15,\"div\"),La(16,\"span\",9),xl(17,\"Reg\"),Fa(),xl(18),Fa(),La(19,\"div\"),La(20,\"span\",9),xl(21,\"Callsign\"),Fa(),xl(22),Fa(),Fa(),Fa()),2&t&&(Cr(3),Ra(\"flag\",e.aircraft.country.flag),Cr(3),kl(\"\",e.aircraft.callsign||\"?\",\" / \",e.aircraft.icao,\"\"),Cr(2),Sl(e.aircraft.type||\"?\"),Cr(1),Ra(\"ngIf\",e.showTimestamp),Cr(5),Cl(\" \",e.aircraft.icao,\"\"),Cr(4),Cl(\" \",e.aircraft.registration||\"?\",\"\"),Cr(4),Cl(\" \",e.aircraft.callsign||\"?\",\"\"))},directives:[MJ,Vd,uE],pipes:[$F,ip],styles:[\"[_nghost-%COMP%]{flex:1;display:block;position:relative}.aircraft-item[_ngcontent-%COMP%]{font-size:12px;line-height:16px;display:flex}.aircraft-item__col1[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}.aircraft-item__col2[_ngcontent-%COMP%]{display:flex;flex-direction:column;text-align:right}.aircraft-item__flag[_ngcontent-%COMP%]{margin-right:4px}.aircraft-item__name[_ngcontent-%COMP%]{font-size:14px}.aircraft-item__type[_ngcontent-%COMP%]{line-height:1em;font-size:11px}.aircraft-item__timestamp[_ngcontent-%COMP%]{margin-top:4px;display:flex;align-items:center;color:gray}.aircraft-item__timestamp[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{font-size:1em;height:1em;width:1em;margin-right:.3em;margin-left:.3em}.aircraft-item__label[_ngcontent-%COMP%]{color:gray;font-size:10px}\"],changeDetection:0}),t})();function Rot(t,e){1&t&&(La(0,\"div\",9),xl(1,\" Chargement en cours... \"),Fa())}function Dot(t,e){if(1&t&&(La(0,\"div\",10),xl(1),Fa()),2&t){const t=Ka(2);Cr(1),Cl(\" \",t.entitySelection.error,\" \")}}function Lot(t,e){if(1&t&&(oa(0,Rot,2,0,\"div\",7),oa(1,Dot,2,1,\"div\",8)),2&t){const t=Ka();Ra(\"ngIf\",!t.entitySelection.error),Cr(1),Ra(\"ngIf\",t.entitySelection.error)}}function Fot(t,e){1&t&&Na(0,\"app-ship-item-small\",13),2&t&&Ra(\"ship\",Ka(2).entitySelection.entity)(\"showTimestamp\",!0)}function Not(t,e){1&t&&Na(0,\"app-aircraft-item-small\",14),2&t&&Ra(\"aircraft\",Ka(2).entitySelection.entity)(\"showTimestamp\",!0)}function Bot(t,e){if(1&t&&(oa(0,Fot,1,2,\"app-ship-item-small\",11),oa(1,Not,1,2,\"app-aircraft-item-small\",12)),2&t){const t=Ka();Ra(\"ngIf\",t.entitySelection.type===t.EntityType.Ship),Cr(1),Ra(\"ngIf\",t.entitySelection.type===t.EntityType.Aircraft)}}const zot=function(t,e){return[t,e]};let Vot=(()=>{class t extends Gq{constructor(t,e){super(),this.mapService=t,this.selectionService=e,this.EntityType=NH,this.hasPosition=!0}ngOnChanges(t){var e,i,n,s;t.entitySelection&&(this.hasPosition=gU(null===(i=null===(e=t.entitySelection.currentValue)||void 0===e?void 0:e.entity)||void 0===i?void 0:i.lon)&&gU(null===(s=null===(n=t.entitySelection.currentValue)||void 0===n?void 0:n.entity)||void 0===s?void 0:s.lat))}locate(){this.mapService.pingLocation([this.entitySelection.entity.lon,this.entitySelection.entity.lat]),this.mapService.centerOnLonLat([this.entitySelection.entity.lon,this.entitySelection.entity.lat])}locateAndZoom(){this.mapService.locate([this.entitySelection.entity.lon,this.entitySelection.entity.lat])}removeSelection(){this.selectionService.toggleSelection(this.entitySelection.type,this.entitySelection.id)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj),Oa(IY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-entity-selection\"]],inputs:{entitySelection:\"entitySelection\"},features:[Uo,he],decls:15,vars:9,consts:[[1,\"entity-selection\",\"mat-elevation-z8\"],[1,\"entity-selection__background-icon\"],[3,\"ngIf\"],[1,\"d-flex\"],[\"mat-button\",\"\",1,\"entity-selection__action\",3,\"title\",\"disabled\",\"click\",\"dblclick\"],[\"mat-button\",\"\",\"title\",\"Ouvrir la fiche d\\xe9taill\\xe9e\",1,\"entity-selection__action\",3,\"routerLink\"],[\"mat-button\",\"\",\"title\",\"Supprimer de la s\\xe9lection\",1,\"entity-selection__action\",3,\"click\"],[\"class\",\"pa-3 u-relative u-flex\",4,\"ngIf\"],[\"class\",\"pa-1 u-relative u-flex error-message mat-small\",4,\"ngIf\"],[1,\"pa-3\",\"u-relative\",\"u-flex\"],[1,\"pa-1\",\"u-relative\",\"u-flex\",\"error-message\",\"mat-small\"],[\"class\",\"pa-1\",3,\"ship\",\"showTimestamp\",4,\"ngIf\"],[\"class\",\"pa-1\",3,\"aircraft\",\"showTimestamp\",4,\"ngIf\"],[1,\"pa-1\",3,\"ship\",\"showTimestamp\"],[1,\"pa-1\",3,\"aircraft\",\"showTimestamp\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"mat-icon\",1),xl(2),Fa(),oa(3,Lot,2,2,\"ng-template\",2),oa(4,Bot,2,2,\"ng-template\",2),La(5,\"div\",3),La(6,\"button\",4),Ga(\"click\",function(){return e.locate()})(\"dblclick\",function(){return e.locateAndZoom()}),La(7,\"mat-icon\"),xl(8,\"center_focus_strong\"),Fa(),Fa(),La(9,\"button\",5),La(10,\"mat-icon\"),xl(11,\"info\"),Fa(),Fa(),La(12,\"button\",6),Ga(\"click\",function(){return e.removeSelection()}),La(13,\"mat-icon\"),xl(14,\"close\"),Fa(),Fa(),Fa(),Fa()),2&t&&(Cr(2),Sl(e.entitySelection.type===e.EntityType.Ship?\"directions_boat\":\"flight\"),Cr(1),Ra(\"ngIf\",!e.entitySelection.entity),Cr(1),Ra(\"ngIf\",e.entitySelection.entity),Cr(2),Ra(\"title\",e.hasPosition?\"Centrer la vue (double-clic = zoom)\":\"Ce navire n'a pas de position\")(\"disabled\",!e.entitySelection.entity||!e.hasPosition),Cr(3),Ra(\"routerLink\",nh(6,zot,e.entitySelection.type+\"s\",e.entitySelection.id)))},directives:[uE,Vd,Ly,mL,c4,Oot],styles:[\"[_nghost-%COMP%]{display:block;position:relative;overflow:hidden}.entity-selection[_ngcontent-%COMP%]{background-color:#f7f7f7;width:292px;min-height:93px;margin-bottom:8px;position:relative;overflow:hidden;display:flex;flex-direction:column;pointer-events:all}.entity-selection__background-icon[_ngcontent-%COMP%]{position:absolute;font-size:136px;left:-64px;color:#ededed;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.entity-selection__action[_ngcontent-%COMP%]{flex:1;min-width:inherit;padding:inherit}\"],changeDetection:0}),t})();var $ot=i(3078),Uot=class{constructor(t){this.rbush_=new $ot(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[MB(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,s=e.length;n<s;n++){const s=t[n],r=e[n],o={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:r};i[n]=o,this.items_[MB(r)]=o}this.rbush_.load(i)}remove(t){const e=MB(t),i=this.items_[e];return delete this.items_[e],null!==this.rbush_.remove(i)}update(t,e){const i=this.items_[MB(e)];Az([i.minX,i.minY,i.maxX,i.maxY],t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(t){return this.rbush_.search({minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}).map(function(t){return t.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,s=t.length;n<s;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return SB(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return pz(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}};function jot(t){return new S7({fill:Hot(t,\"\"),stroke:Got(t,\"\"),text:Wot(t),image:qot(t)})}function Hot(t,e){const i=t[e+\"fill-color\"];if(i)return new h8({color:i})}function Got(t,e){const i=t[e+\"stroke-width\"],n=t[e+\"stroke-color\"];if(i||n)return new U8({width:i,color:n,lineCap:t[e+\"stroke-line-cap\"],lineJoin:t[e+\"stroke-line-join\"],lineDash:t[e+\"stroke-line-dash\"],lineDashOffset:t[e+\"stroke-line-dash-offset\"],miterLimit:t[e+\"stroke-miter-limit\"]})}function Wot(t){const e=t[\"text-value\"];return e?new k7({text:e,font:t[\"text-font\"],maxAngle:t[\"text-max-angle\"],offsetX:t[\"text-offset-x\"],offsetY:t[\"text-offset-y\"],overflow:t[\"text-overflow\"],placement:t[\"text-placement\"],scale:t[\"text-scale\"],rotateWithView:t[\"text-rotate-with-view\"],rotation:t[\"text-rotation\"],textAlign:t[\"text-align\"],justify:t[\"text-justify\"],textBaseline:t[\"text-baseline\"],padding:t[\"text-padding\"],fill:Hot(t,\"text-\"),backgroundFill:Hot(t,\"text-background-\"),stroke:Got(t,\"text-\"),backgroundStroke:Got(t,\"text-background-\")}):void 0}function qot(t){const e=t[\"icon-src\"],i=t[\"icon-img\"];if(e||i)return new T8({src:e,img:i,imgSize:t[\"icon-img-size\"],anchor:t[\"icon-anchor\"],anchorOrigin:t[\"icon-anchor-origin\"],anchorXUnits:t[\"icon-anchor-x-units\"],anchorYUnits:t[\"icon-anchor-y-units\"],color:t[\"icon-color\"],crossOrigin:t[\"icon-cross-origin\"],offset:t[\"icon-offset\"],displacement:t[\"icon-displacement\"],opacity:t[\"icon-opacity\"],scale:t[\"icon-scale\"],rotation:t[\"icon-rotation\"],rotateWithView:t[\"icon-rotate-with-view\"],size:t[\"icon-size\"],declutterMode:t[\"icon-declutter-mode\"]});const n=t[\"shape-points\"];if(n){const e=\"shape-\";return new g7({points:n,fill:Hot(t,e),stroke:Got(t,e),radius:t[\"shape-radius\"],radius1:t[\"shape-radius1\"],radius2:t[\"shape-radius2\"],angle:t[\"shape-angle\"],displacement:t[\"shape-displacement\"],rotation:t[\"shape-rotation\"],rotateWithView:t[\"shape-rotate-with-view\"],scale:t[\"shape-scale\"],declutterMode:t[\"shape-declutter-mode\"]})}const s=t[\"circle-radius\"];if(s){const e=\"circle-\";return new v7({radius:s,fill:Hot(t,e),stroke:Got(t,e),displacement:t[\"circle-displacement\"],scale:t[\"circle-scale\"],rotation:t[\"circle-rotation\"],rotateWithView:t[\"circle-rotate-with-view\"],declutterMode:t[\"circle-declutter-mode\"]})}}var Yot=class extends jrt{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=void 0!==t.declutter&&t.declutter,this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating,this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(\"renderOrder\")}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new $ot(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(\"renderOrder\",t)}setStyle(t){let e;if(void 0===t)e=y7;else if(null===t)e=null;else if(\"function\"==typeof t)e=t;else if(t instanceof S7)e=t;else if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let e=0;e<i;++e){const i=t[e];n[e]=i instanceof S7?i:jot(i)}e=n}else e=jot(t);this.style_=e,this.styleFunction_=null===t?void 0:function(t){let e;if(\"function\"==typeof t)e=t;else{let i;Array.isArray(t)?i=t:(sz(\"function\"==typeof t.getZIndex,41),i=[t]),e=function(){return i}}return e}(this.style_),this.changed()}};const Zot={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Kot=[Zot.FILL],Xot=[Zot.STROKE],Qot=[Zot.BEGIN_PATH],Jot=[Zot.CLOSE_PATH];var tat=Zot,eat=class{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}},iat=class extends eat{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let r=s.length;for(let o=0,a=t.length;o<a;o+=e)n[0]=t[o],n[1]=t[o+1],cz(i,n)&&(s[r++]=n[0],s[r++]=n[1]);return r}appendFlatLineCoordinates(t,e,i,n,s,r){const o=this.coordinates;let a=o.length;const l=this.getBufferedMaxExtent();r&&(e+=n);let c=t[e],h=t[e+1];const u=this.tmpCoordinate_;let d,p,f,m=!0;for(d=e+n;d<i;d+=n)u[0]=t[d],u[1]=t[d+1],f=dz(l,u),f!==p?(m&&(o[a++]=c,o[a++]=h,m=!1),o[a++]=u[0],o[a++]=u[1]):1===f?(o[a++]=u[0],o[a++]=u[1],m=!1):m=!0,c=u[0],h=u[1],p=f;return(s&&m||d===e+n)&&(o[a++]=c,o[a++]=h),a}drawCustomCoordinates_(t,e,i,n,s){for(let r=0,o=i.length;r<o;++r){const o=i[r],a=this.appendFlatLineCoordinates(t,e,o,n,!1,!1);s.push(a),e=o}return e}drawCustom(t,e,i,n){this.beginGeometry(t,e);const s=t.getType(),r=t.getStride(),o=this.coordinates.length;let a,l,c,h,u;switch(s){case\"MultiPolygon\":a=t.getOrientedFlatCoordinates(),h=[];const e=t.getEndss();u=0;for(let t=0,i=e.length;t<i;++t){const i=[];u=this.drawCustomCoordinates_(a,u,e[t],r,i),h.push(i)}this.instructions.push([tat.CUSTOM,o,h,t,i,VG]),this.hitDetectionInstructions.push([tat.CUSTOM,o,h,t,n||i,VG]);break;case\"Polygon\":case\"MultiLineString\":c=[],a=\"Polygon\"==s?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(a,0,t.getEnds(),r,c),this.instructions.push([tat.CUSTOM,o,c,t,i,zG]),this.hitDetectionInstructions.push([tat.CUSTOM,o,c,t,n||i,zG]);break;case\"LineString\":case\"Circle\":a=t.getFlatCoordinates(),l=this.appendFlatLineCoordinates(a,0,a.length,r,!1,!1),this.instructions.push([tat.CUSTOM,o,l,t,i,BG]),this.hitDetectionInstructions.push([tat.CUSTOM,o,l,t,n||i,BG]);break;case\"MultiPoint\":a=t.getFlatCoordinates(),l=this.appendFlatPointCoordinates(a,r),l>o&&(this.instructions.push([tat.CUSTOM,o,l,t,i,BG]),this.hitDetectionInstructions.push([tat.CUSTOM,o,l,t,n||i,BG]));break;case\"Point\":a=t.getFlatCoordinates(),this.coordinates.push(a[0],a[1]),l=this.coordinates.length,this.instructions.push([tat.CUSTOM,o,l,t,i]),this.hitDetectionInstructions.push([tat.CUSTOM,o,l,t,n||i])}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[tat.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[tat.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;let e;t.reverse();const i=t.length;let n,s,r=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==tat.END_GEOMETRY?r=e:s==tat.BEGIN_GEOMETRY&&(n[2]=e,AB(this.hitDetectionInstructions,r,e),r=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const e=t.getColor();i.fillStyle=j8(e||Q8)}else i.fillStyle=void 0;if(e){const t=e.getColor();i.strokeStyle=j8(t||i7);const n=e.getLineCap();i.lineCap=void 0!==n?n:J8;const s=e.getLineDash();i.lineDash=s?s.slice():t7;const r=e.getLineDashOffset();i.lineDashOffset=r||0;const o=e.getLineJoin();i.lineJoin=void 0!==o?o:e7;const a=e.getWidth();i.lineWidth=void 0!==a?a:1;const l=e.getMiterLimit();i.miterLimit=void 0!==l?l:10,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[tat.SET_FILL_STYLE,e];return\"string\"!=typeof e&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[tat.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(\"string\"!=typeof i||t.currentFillStyle!=i)&&(void 0!==i&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,s=t.lineDash,r=t.lineDashOffset,o=t.lineJoin,a=t.lineWidth,l=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!_B(t.currentLineDash,s)||t.currentLineDashOffset!=r||t.currentLineJoin!=o||t.currentLineWidth!=a||t.currentMiterLimit!=l)&&(void 0!==i&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=r,t.currentLineJoin=o,t.currentLineWidth=a,t.currentMiterLimit=l)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[tat.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){return!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=az(this.maxExtent),this.maxLineWidth>0)&&oz(this.bufferedMaxExtent_,this.resolution*(this.maxLineWidth+1)/2,this.bufferedMaxExtent_),this.bufferedMaxExtent_}},nat=class extends iat{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const s=this.state,r=void 0!==s.fillStyle,o=void 0!==s.strokeStyle,a=i.length;this.instructions.push(Qot),this.hitDetectionInstructions.push(Qot);for(let l=0;l<a;++l){const s=i[l],r=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,s,n,!0,!o),c=[tat.MOVE_TO_LINE_TO,r,a];this.instructions.push(c),this.hitDetectionInstructions.push(c),o&&(this.instructions.push(Jot),this.hitDetectionInstructions.push(Jot)),e=s}return r&&(this.instructions.push(Kot),this.hitDetectionInstructions.push(Kot)),o&&(this.instructions.push(Xot),this.hitDetectionInstructions.push(Xot)),e}drawCircle(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([tat.SET_FILL_STYLE,Q8]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([tat.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const n=t.getFlatCoordinates(),s=t.getStride(),r=this.coordinates.length;this.appendFlatLineCoordinates(n,0,n.length,s,!1,!1);const o=[tat.CIRCLE,r];this.instructions.push(Qot,o),this.hitDetectionInstructions.push(Qot,o),void 0!==i.fillStyle&&(this.instructions.push(Kot),this.hitDetectionInstructions.push(Kot)),void 0!==i.strokeStyle&&(this.instructions.push(Xot),this.hitDetectionInstructions.push(Xot)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([tat.SET_FILL_STYLE,Q8]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([tat.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const n=t.getEnds(),s=t.getOrientedFlatCoordinates(),r=t.getStride();this.drawFlatCoordinatess_(s,0,n,r),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state;if(void 0===i.fillStyle&&void 0===i.strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==i.fillStyle&&this.hitDetectionInstructions.push([tat.SET_FILL_STYLE,Q8]),void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([tat.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const n=t.getEndss(),s=t.getOrientedFlatCoordinates(),r=t.getStride();let o=0;for(let a=0,l=n.length;a<l;++a)o=this.drawFlatCoordinatess_(s,o,n[a],r);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(0!==t){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=LG(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}};function sat(t,e,i,n,s){let r,o,a,l,c,h,u,d,p,f,m=i,g=i,A=0,v=0,_=i;for(o=i;o<n;o+=s){const i=e[o],n=e[o+1];void 0!==c&&(p=i-c,f=n-h,l=Math.sqrt(p*p+f*f),void 0!==u&&(v+=a,r=Math.acos((u*p+d*f)/(a*l)),r>t&&(v>A&&(A=v,m=_,g=o),v=0,_=o-s)),a=l,u=p,d=f),c=i,h=n}return v+=l,v>A?[_,o]:[m,g]}const rat={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},oat={Circle:nat,Default:iat,Image:class extends iat{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,r=this.appendFlatPointCoordinates(i,n);this.instructions.push([tat.DRAW_IMAGE,s,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([tat.DRAW_IMAGE,s,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,r=this.appendFlatPointCoordinates(i,n);this.instructions.push([tat.DRAW_IMAGE,s,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([tat.DRAW_IMAGE,s,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},LineString:class extends iat{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const s=this.coordinates.length,r=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),o=[tat.MOVE_TO_LINE_TO,s,r];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([tat.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,t7,0],Qot);const n=t.getFlatCoordinates(),s=t.getStride();this.drawFlatCoordinates_(n,0,n.length,s),this.hitDetectionInstructions.push(Xot),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state;if(void 0===i.strokeStyle||void 0===i.lineWidth)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([tat.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Qot);const n=t.getEnds(),s=t.getFlatCoordinates(),r=t.getStride();let o=0;for(let a=0,l=n.length;a<l;++a)o=this.drawFlatCoordinates_(s,o,n[a],r);this.hitDetectionInstructions.push(Xot),this.endGeometry(e)}finish(){const t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Xot),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Xot),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Qot)}},Polygon:nat,Text:class extends iat{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_=\"\",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_=\"\",this.fillKey_=\"\",this.strokeKey_=\"\",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textState_;if(\"\"===this.text_||!i||!this.textFillState_&&!this.textStrokeState_)return;const n=this.coordinates;let s=n.length;const r=t.getType();let o=null,a=t.getStride();if(\"line\"!==i.placement||\"LineString\"!=r&&\"MultiLineString\"!=r&&\"Polygon\"!=r&&\"MultiPolygon\"!=r){let l=i.overflow?null:[];switch(r){case\"Point\":case\"MultiPoint\":o=t.getFlatCoordinates();break;case\"LineString\":o=t.getFlatMidpoint();break;case\"Circle\":o=t.getCenter();break;case\"MultiLineString\":o=t.getFlatMidpoints(),a=2;break;case\"Polygon\":o=t.getFlatInteriorPoint(),i.overflow||l.push(o[2]/this.resolution),a=3;break;case\"MultiPolygon\":const e=t.getFlatInteriorPoints();o=[];for(let t=0,n=e.length;t<n;t+=3)i.overflow||l.push(e[t+2]/this.resolution),o.push(e[t],e[t+1]);if(0===o.length)return;a=2}const c=this.appendFlatPointCoordinates(o,a);if(c===s)return;if(l&&(c-s)/2!=o.length/a){let t=s/2;l=l.filter((e,i)=>{const s=n[2*(t+i)]===o[i*a]&&n[2*(t+i)+1]===o[i*a+1];return s||--t,s})}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let h=i.padding;if(h!=r7&&(i.scale[0]<0||i.scale[1]<0)){let t=i.padding[0],e=i.padding[1],n=i.padding[2],s=i.padding[3];i.scale[0]<0&&(e=-e,s=-s),i.scale[1]<0&&(t=-t,n=-n),h=[t,e,n,s]}const u=this.pixelRatio;this.instructions.push([tat.DRAW_IMAGE,s,c,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,h==r7?r7:h.map(function(t){return t*u}),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]);const d=1/u;this.hitDetectionInstructions.push([tat.DRAW_IMAGE,s,c,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[d,d],NaN,void 0,this.declutterImageWithText_,h,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,l]),this.endGeometry(e)}else{if(!Lz(this.getBufferedMaxExtent(),t.getExtent()))return;let l;if(o=t.getFlatCoordinates(),\"LineString\"==r)l=[o.length];else if(\"MultiLineString\"==r)l=t.getEnds();else if(\"Polygon\"==r)l=t.getEnds().slice(0,1);else if(\"MultiPolygon\"==r){const e=t.getEndss();l=[];for(let t=0,i=e.length;t<i;++t)l.push(e[t][0])}this.beginGeometry(t,e);const c=i.textAlign;let h,u=0;for(let t=0,e=l.length;t<e;++t){if(null==c){const e=sat(i.maxAngle,o,u,l[t],a);u=e[0],h=e[1]}else h=l[t];for(let t=u;t<h;t+=a)n.push(o[t],o[t+1]);const e=n.length;u=l[t],this.drawChars_(s,e),s=e}this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||n7,justify:e.justify,textBaseline:e.textBaseline||s7,scale:e.scale});const r=this.fillKey_;i&&(r in this.fillStates||(this.fillStates[r]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,r=this.textKey_,o=this.fillKey_;this.saveTextStates_();const a=this.pixelRatio,l=rat[n.textBaseline],c=this.textOffsetY_*a,h=this.text_,u=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([tat.DRAW_CHARS,t,e,l,n.overflow,o,n.maxAngle,a,c,s,u*a,h,r,1]),this.hitDetectionInstructions.push([tat.DRAW_CHARS,t,e,l,n.overflow,o,n.maxAngle,1,c,s,u,h,r,1/a])}setTextStyle(t,e){let i,n,s;if(t){const e=t.getFill();e?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=j8(e.getColor()||Q8)):(n=null,this.textFillState_=n);const r=t.getStroke();if(r){s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const t=r.getLineDash(),e=r.getLineDashOffset(),i=r.getWidth(),n=r.getMiterLimit();s.lineCap=r.getLineCap()||J8,s.lineDash=t?t.slice():t7,s.lineDashOffset=void 0===e?0:e,s.lineJoin=r.getLineJoin()||e7,s.lineWidth=void 0===i?1:i,s.miterLimit=void 0===n?10:n,s.strokeStyle=j8(r.getColor()||i7)}else s=null,this.textStrokeState_=s;i=this.textState_;const o=t.getFont()||X8;h7(o);const a=t.getScaleArray();i.overflow=t.getOverflow(),i.font=o,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||s7,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||r7,i.scale=void 0===a?[1,1]:a;const l=t.getOffsetX(),c=t.getOffsetY(),h=t.getRotateWithView(),u=t.getRotation();this.text_=t.getText()||\"\",this.textOffsetX_=void 0===l?0:l,this.textOffsetY_=void 0===c?0:c,this.textRotateWithView_=void 0!==h&&h,this.textRotation_=void 0===u?0:u,this.strokeKey_=s?(\"string\"==typeof s.strokeStyle?s.strokeStyle:MB(s.strokeStyle))+s.lineCap+s.lineDashOffset+\"|\"+s.lineWidth+s.lineJoin+s.miterLimit+\"[\"+s.lineDash.join()+\"]\":\"\",this.textKey_=i.font+i.scale+(i.textAlign||\"?\")+(i.justify||\"?\")+(i.textBaseline||\"?\"),this.fillKey_=n?\"string\"==typeof n.fillStyle?n.fillStyle:\"|\"+MB(n.fillStyle):\"\"}else this.text_=\"\";this.declutterImageWithText_=e}}};var aat=class{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){const i=void 0!==t?t.toString():\"0\";let n=this.buildersByZIndex_[i];void 0===n&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];return void 0===s&&(s=new(0,oat[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s),s}};function lat(t,e,i,n,s,r,o,a,l,c,h,u){let d=t[e],p=t[e+1],f=0,m=0,g=0,A=0;function v(){f=d,m=p,d=t[e+=n],p=t[e+1],A+=g,g=Math.sqrt((d-f)*(d-f)+(p-m)*(p-m))}do{v()}while(e<i-n&&A+g<r);let _=0===g?0:(r-A)/g;const b=oV(f,d,_),y=oV(m,p,_),w=e-n,x=A,S=r+a*l(c,s,h);for(;e<i-n&&A+g<S;)v();_=0===g?0:(S-A)/g;const C=oV(f,d,_),k=oV(m,p,_);let E;if(u){const t=[b,y,C,k];bG(t,0,4,2,u,t,t),E=t[0]>t[2]}else E=b>C;const M=Math.PI,T=[],I=w+n===e;let P;if(g=0,A=x,d=t[e=w],p=t[e+1],I)return v(),P=Math.atan2(p-m,d-f),E&&(P+=P>0?-M:M),T[0]=[(C+b)/2,(k+y)/2,(S-r)/2,P,s],T;for(let O=0,R=(s=s.replace(/\\n/g,\" \")).length;O<R;){v();let t=Math.atan2(p-m,d-f);if(E&&(t+=t>0?-M:M),void 0!==P){let e=t-P;if(e+=e>M?-2*M:e<-M?2*M:0,Math.abs(e)>o)return null}P=t;const u=O;let b=0;for(;O<R;++O){const t=a*l(c,s[E?R-O-1:O],h);if(e+n<i&&A+g<r+b+t/2)break;b+=t}if(O===u)continue;const y=E?s.substring(R-u,R-O):s.substring(u,O);_=0===g?0:(r+b/2-A)/g;const w=oV(f,d,_),x=oV(m,p,_);T.push([w,x,b/2,t,y]),r+=b}return T}const cat=[1/0,1/0,-1/0,-1/0],hat=[],uat=[],dat=[],pat=[];function fat(t){return t[3].declutterBox}const mat=new RegExp(\"[\"+String.fromCharCode(1425)+\"-\"+String.fromCharCode(2303)+String.fromCharCode(64285)+\"-\"+String.fromCharCode(65023)+String.fromCharCode(65136)+\"-\"+String.fromCharCode(65276)+String.fromCharCode(67584)+\"-\"+String.fromCharCode(69631)+String.fromCharCode(124928)+\"-\"+String.fromCharCode(126975)+\"]\");function gat(t,e){return(\"start\"===e||\"end\"===e)&&!mat.test(t)&&(e=\"start\"===e?\"left\":\"right\"),rat[e]}function Aat(t,e,i){return i>0&&t.push(\"\\n\",\"\"),t.push(e,\"\"),t}var vat=class{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,n){const s=t+e+i+n;if(this.labels_[s])return this.labels_[s];const r=n?this.strokeStates[n]:null,o=i?this.fillStates[i]:null,a=this.textStates[e],l=this.pixelRatio,c=[a.scale[0]*l,a.scale[1]*l],h=Array.isArray(t),u=a.justify?rat[a.justify]:gat(Array.isArray(t)?t[0]:t,a.textAlign||n7),d=n&&r.lineWidth?r.lineWidth:0,p=h?t:t.split(\"\\n\").reduce(Aat,[]),{width:f,height:m,widths:g,heights:A,lineWidths:v}=function(t,e){const i=[],n=[],s=[];let r=0,o=0,a=0,l=0;for(let c=0,h=e.length;c<=h;c+=2){const u=e[c];if(\"\\n\"===u||c===h){r=Math.max(r,o),s.push(o),o=0,a+=l;continue}const d=e[c+1]||t.font,p=p7(d,u);i.push(p),o+=p;const f=u7(d);n.push(f),l=Math.max(l,f)}return{width:r,height:a,widths:i,heights:n,lineWidths:s}}(a,p),_=f+d,b=[],y=(_+2)*c[0],w=(m+d)*c[1],x={width:y<0?Math.floor(y):Math.ceil(y),height:w<0?Math.floor(w):Math.ceil(w),contextInstructions:b};(1!=c[0]||1!=c[1])&&b.push(\"scale\",c),n&&(b.push(\"strokeStyle\",r.strokeStyle),b.push(\"lineWidth\",d),b.push(\"lineCap\",r.lineCap),b.push(\"lineJoin\",r.lineJoin),b.push(\"miterLimit\",r.miterLimit),b.push(\"setLineDash\",[r.lineDash]),b.push(\"lineDashOffset\",r.lineDashOffset)),i&&b.push(\"fillStyle\",o.fillStyle),b.push(\"textBaseline\",\"middle\"),b.push(\"textAlign\",\"center\");const S=.5-u;let C=u*_+S*d;const k=[],E=[];let M,T=0,I=0,P=0,O=0;for(let R=0,D=p.length;R<D;R+=2){const t=p[R];if(\"\\n\"===t){I+=T,T=0,C=u*_+S*d,++O;continue}const e=p[R+1]||a.font;e!==M&&(n&&k.push(\"font\",e),i&&E.push(\"font\",e),M=e),T=Math.max(T,A[P]);const s=[t,C+S*g[P]+u*(g[P]-v[O]),.5*(d+T)+I];C+=g[P],n&&k.push(\"strokeText\",s),i&&E.push(\"fillText\",s),++P}return Array.prototype.push.apply(b,k),Array.prototype.push.apply(b,E),this.labels_[s]=x,x}replayTextBackground_(t,e,i,n,s,r,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),r&&(this.alignFill_=r[2],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,r,o,a,l,c,h,u,d,p,f,m){let g=i-(o*=u[0]),A=n-(a*=u[1]);const v=s+l>t?t-l:s,_=r+c>e?e-c:r,b=p[3]+v*u[0]+p[1],y=p[0]+_*u[1]+p[2],w=g-p[3],x=A-p[0];let S;return(f||0!==h)&&(hat[0]=w,pat[0]=w,hat[1]=x,uat[1]=x,uat[0]=w+b,dat[0]=uat[0],dat[1]=x+y,pat[1]=dat[1]),0!==h?(S=mG([1,0,0,1,0,0],i,n,1,1,h,-i,-n),pG(S,hat),pG(S,uat),pG(S,dat),pG(S,pat),pz(Math.min(hat[0],uat[0],dat[0],pat[0]),Math.min(hat[1],uat[1],dat[1],pat[1]),Math.max(hat[0],uat[0],dat[0],pat[0]),Math.max(hat[1],uat[1],dat[1],pat[1]),cat)):pz(Math.min(w,w+b),Math.min(x,x+y),Math.max(w,w+b),Math.max(x,x+y),cat),d&&(g=Math.round(g),A=Math.round(A)),{drawImageX:g,drawImageY:A,drawImageW:v,drawImageH:_,originX:l,originY:c,declutterBox:{minX:cat[0],minY:cat[1],maxX:cat[2],maxY:cat[3],value:m},canvasTransform:S,scale:u}}replayImageOrLabel_(t,e,i,n,s,r,o){const a=n.declutterBox,l=t.canvas,c=o?o[2]*n.scale[0]/2:0;return a.minX-c<=l.width/e&&a.maxX+c>=0&&a.minY-c<=l.height/e&&a.maxY+c>=0&&(!(!r&&!o)&&this.replayTextBackground_(t,hat,uat,dat,pat,r,o),function(t,e,i,n,s,r,o,a,l,c,h){t.save(),1!==i&&(t.globalAlpha*=i),e&&t.setTransform.apply(t,e),n.contextInstructions?(t.translate(l,c),t.scale(h[0],h[1]),function(t,e){const i=t.contextInstructions;for(let n=0,s=i.length;n<s;n+=2)Array.isArray(i[n+1])?e[i[n]].apply(e,i[n+1]):e[i[n]]=i[n+1]}(n,t)):h[0]<0||h[1]<0?(t.translate(l,c),t.scale(h[0],h[1]),t.drawImage(n,s,r,o,a,0,0,o,a)):t.drawImage(n,s,r,o,a,l,c,o*h[0],a*h[1]),t.restore()}(t,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){if(this.alignFill_){const e=pG(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const s=this.textStates[e],r=this.createLabel(t,e,n,i),o=this.strokeStates[i],a=this.pixelRatio,l=gat(Array.isArray(t)?t[0]:t,s.textAlign||n7),c=rat[s.textBaseline||s7],h=o&&o.lineWidth?o.lineWidth:0;return{label:r,anchorX:l*(r.width/a-2*s.scale[0])+2*(.5-l)*h,anchorY:c*r.height/a+2*(.5-c)*h}}execute_(t,e,i,n,s,r,o,a){let l;this.pixelCoordinates_&&_B(i,this.renderedTransform_)?l=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),l=_G(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5]}(this.renderedTransform_,i));let c=0;const h=n.length;let u,d,p,f,m,g,A,v,_,b,y,w,x=0,S=0,C=0,k=null,E=null;const M=this.coordinateCache_,T=this.viewRotation_,I=Math.round(1e12*Math.atan2(-i[1],i[0]))/1e12,P={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:T},O=this.instructions!=n||this.overlaps?0:200;let R,D,L,F;for(;c<h;){const i=n[c];switch(i[0]){case tat.BEGIN_GEOMETRY:R=i[1],F=i[3],R.getGeometry()?void 0===o||Lz(o,F.getExtent())?++c:c=i[2]+1:c=i[2];break;case tat.BEGIN_PATH:S>O&&(this.fill_(t),S=0),C>O&&(t.stroke(),C=0),!S&&!C&&(t.beginPath(),f=NaN,m=NaN),++c;break;case tat.CIRCLE:x=i[1];const n=l[x],h=l[x+1],N=l[x+2]-n,B=l[x+3]-h,z=Math.sqrt(N*N+B*B);t.moveTo(n+z,h),t.arc(n,h,z,0,2*Math.PI,!0),++c;break;case tat.CLOSE_PATH:t.closePath(),++c;break;case tat.CUSTOM:x=i[1],u=i[2];const V=i[4],$=6==i.length?i[5]:void 0;P.geometry=i[3],P.feature=R,c in M||(M[c]=[]);const U=M[c];$?$(l,x,u,2,U):(U[0]=l[x],U[1]=l[x+1],U.length=2),V(U,P),++c;break;case tat.DRAW_IMAGE:x=i[1],u=i[2],v=i[3],d=i[4],p=i[5];let j=i[6];const H=i[7],G=i[8],W=i[9],q=i[10];let Y=i[11];const Z=i[12];let K=i[13];const X=i[14],Q=i[15];if(!v&&i.length>=20){_=i[19],b=i[20],y=i[21],w=i[22];const t=this.drawLabelWithPointPlacement_(_,b,y,w);v=t.label,i[3]=v,d=(t.anchorX-i[23])*this.pixelRatio,i[4]=d,p=(t.anchorY-i[24])*this.pixelRatio,i[5]=p,j=v.height,i[6]=j,K=v.width,i[13]=K}let J,tt,et,it;i.length>25&&(J=i[25]),i.length>17?(tt=i[16],et=i[17],it=i[18]):(tt=r7,et=!1,it=!1),q&&I?Y+=T:!q&&!I&&(Y-=T);let nt=0;for(;x<u;x+=2){if(J&&J[nt++]<K/this.pixelRatio)continue;const i=this.calculateImageOrLabelDimensions_(v.width,v.height,l[x],l[x+1],K,j,d,p,G,W,Y,Z,s,tt,et||it,R),n=[t,e,v,i,H,et?k:null,it?E:null];if(a){if(\"none\"===X)continue;if(\"obstacle\"===X){a.insert(i.declutterBox);continue}{let t,e;if(Q){const i=u-x;if(!Q[i]){Q[i]=n;continue}if(t=Q[i],delete Q[i],e=fat(t),a.collides(e))continue}if(a.collides(i.declutterBox))continue;t&&(a.insert(e),this.replayImageOrLabel_.apply(this,t)),a.insert(i.declutterBox)}}this.replayImageOrLabel_.apply(this,n)}++c;break;case tat.DRAW_CHARS:const st=i[1],rt=i[2],ot=i[3],at=i[4];w=i[5];const lt=i[6],ct=i[7],ht=i[8];y=i[9];const ut=i[10];_=i[11],b=i[12];const dt=[i[13],i[13]],pt=this.textStates[b],ft=pt.font,mt=[pt.scale[0]*ct,pt.scale[1]*ct];let gt;ft in this.widths_?gt=this.widths_[ft]:(gt={},this.widths_[ft]=gt);const At=O8(l,st,rt,2),vt=Math.abs(mt[0])*f7(ft,_,gt);if(at||vt<=At){const i=lat(l,st,rt,2,_,(At-vt)*rat[this.textStates[b].textAlign],lt,Math.abs(mt[0]),f7,ft,gt,I?0:this.viewRotation_);t:if(i){const n=[];let s,r,o,l,c;if(y)for(s=0,r=i.length;s<r;++s){c=i[s],o=c[4],l=this.createLabel(o,b,\"\",y),d=c[2]+(mt[0]<0?-ut:ut),p=ot*l.height+2*(.5-ot)*ut*mt[1]/mt[0]-ht;const r=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,d,p,0,0,c[3],dt,!1,r7,!1,R);if(a&&a.collides(r.declutterBox))break t;n.push([t,e,l,r,1,null,null])}if(w)for(s=0,r=i.length;s<r;++s){c=i[s],o=c[4],l=this.createLabel(o,b,w,\"\"),d=c[2],p=ot*l.height-ht;const r=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,d,p,0,0,c[3],dt,!1,r7,!1,R);if(a&&a.collides(r.declutterBox))break t;n.push([t,e,l,r,1,null,null])}a&&a.load(n.map(fat));for(let t=0,e=n.length;t<e;++t)this.replayImageOrLabel_.apply(this,n[t])}}++c;break;case tat.END_GEOMETRY:if(void 0!==r){R=i[1];const t=r(R,F);if(t)return t}++c;break;case tat.FILL:O?S++:this.fill_(t),++c;break;case tat.MOVE_TO_LINE_TO:for(x=i[1],u=i[2],D=l[x],L=l[x+1],g=D+.5|0,A=L+.5|0,(g!==f||A!==m)&&(t.moveTo(D,L),f=g,m=A),x+=2;x<u;x+=2)D=l[x],L=l[x+1],g=D+.5|0,A=L+.5|0,(x==u-2||g!==f||A!==m)&&(t.lineTo(D,L),f=g,m=A);++c;break;case tat.SET_FILL_STYLE:k=i,this.alignFill_=i[2],S&&(this.fill_(t),S=0,C&&(t.stroke(),C=0)),t.fillStyle=i[1],++c;break;case tat.SET_STROKE_STYLE:E=i,C&&(t.stroke(),C=0),this.setStrokeStyle_(t,i),++c;break;case tat.STROKE:O?C++:t.stroke(),++c;break;default:++c}}S&&this.fill_(t),C&&t.stroke()}execute(t,e,i,n,s,r){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,r)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,s)}};const _at=[\"Polygon\",\"Circle\",\"LineString\",\"Image\",\"Text\",\"Default\"],bat={};var yat=class{constructor(t,e,i,n,s,r){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=r,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(s)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];void 0===i&&(i={},this.executorsByZIndex_[e]=i);const n=t[e];for(const t in n)i[t]=new vat(this.resolution_,this.pixelRatio_,this.overlaps_,n[t])}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let e=0,n=t.length;e<n;++e)if(t[e]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,r){const o=2*(n=Math.round(n))+1,a=mG(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=jB(o,o));const c=this.hitDetectionContext_;let h;c.canvas.width!==o||c.canvas.height!==o?(c.canvas.width=o,c.canvas.height=o):l||c.clearRect(0,0,o,o),void 0!==this.renderBuffer_&&(h=[1/0,1/0,-1/0,-1/0],_z(h,t),oz(h,e*(this.renderBuffer_+n),h));const u=function(t){if(void 0!==bat[t])return bat[t];const e=2*t+1,i=t*t,n=new Array(i+1);for(let r=0;r<=t;++r)for(let s=0;s<=t;++s){const o=r*r+s*s;if(o>i)break;let a=n[o];a||(a=[],n[o]=a),a.push(4*((t+r)*e+(t+s))+3),r>0&&a.push(4*((t-r)*e+(t+s))+3),s>0&&(a.push(4*((t+r)*e+(t-s))+3),r>0&&a.push(4*((t-r)*e+(t-s))+3))}const s=[];for(let r=0,o=n.length;r<o;++r)n[r]&&s.push(...n[r]);return bat[t]=s,s}(n);let d;function p(t,e){const i=c.getImageData(0,0,o,o).data;for(let a=0,l=u.length;a<l;a++)if(i[u[a]]>0){if(!r||\"Image\"!==d&&\"Text\"!==d||r.includes(t)){const i=(u[a]-3)/4,r=n-i%o,l=n-(i/o|0),c=s(t,e,r*r+l*l);if(c)return c}c.clearRect(0,0,o,o);break}}const f=Object.keys(this.executorsByZIndex_).map(Number);let m,g,A,v,_;for(f.sort(mB),m=f.length-1;m>=0;--m){const t=f[m].toString();for(A=this.executorsByZIndex_[t],g=_at.length-1;g>=0;--g)if(d=_at[g],v=A[d],void 0!==v&&(_=v.executeHitDetection(c,a,i,p,h),_))return _}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],s=e[2],r=e[3],o=[i,n,i,r,s,r,s,n];return _G(o,0,8,2,t,o),o}isEmpty(){return SB(this.executorsByZIndex_)}execute(t,e,i,n,s,r,o){const a=Object.keys(this.executorsByZIndex_).map(Number);let l,c,h,u,d,p;for(a.sort(mB),this.maxExtent_&&(t.save(),this.clip(t,i)),r=r||_at,o&&a.reverse(),l=0,c=a.length;l<c;++l){const c=a[l].toString();for(d=this.executorsByZIndex_[c],h=0,u=r.length;h<u;++h)p=d[r[h]],void 0!==p&&p.execute(t,e,i,n,s,o)}this.maxExtent_&&t.restore()}},wat=class extends eat{constructor(t,e,i,n,s,r,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.viewRotation_=s,this.squaredTolerance_=r,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_=\"\",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=[1,0,0,1,0,0]}drawImages_(t,e,i,n){if(!this.image_)return;const s=_G(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_,o=this.tmpLocalTransform_,a=r.globalAlpha;1!=this.imageOpacity_&&(r.globalAlpha=a*this.imageOpacity_);let l=this.imageRotation_;this.imageRotateWithView_&&(l+=this.viewRotation_);for(let c=0,h=s.length;c<h;c+=2){const t=s[c]-this.imageAnchorX_,e=s[c+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const i=t+this.imageAnchorX_,n=e+this.imageAnchorY_;mG(o,i,n,1,1,l,-i,-n),r.setTransform.apply(r,o),r.translate(i,n),r.scale(this.imageScale_[0],this.imageScale_[1]),r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),r.setTransform(1,0,0,1,0,0)}else r.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,t,e,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(r.globalAlpha=a)}drawText_(t,e,i,n){if(!this.textState_||\"\"===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=_G(t,e,i,n,this.transform_,this.pixelCoordinates_),r=this.context_;let o=this.textRotation_;for(this.textRotateWithView_&&(o+=this.viewRotation_);e<i;e+=n){const t=s[e]+this.textOffsetX_,i=s[e+1]+this.textOffsetY_;0!==o||1!=this.textScale_[0]||1!=this.textScale_[1]?(r.translate(t-this.textOffsetX_,i-this.textOffsetY_),r.rotate(o),r.translate(this.textOffsetX_,this.textOffsetY_),r.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&r.strokeText(this.text_,0,0),this.textFillState_&&r.fillText(this.text_,0,0),r.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&r.strokeText(this.text_,t,i),this.textFillState_&&r.fillText(this.text_,t,i))}}moveToLineTo_(t,e,i,n,s){const r=this.context_,o=_G(t,e,i,n,this.transform_,this.pixelCoordinates_);r.moveTo(o[0],o[1]);let a=o.length;s&&(a-=2);for(let l=2;l<a;l+=2)r.lineTo(o[l],o[l+1]);return s&&r.closePath(),i}drawRings_(t,e,i,n){for(let s=0,r=i.length;s<r;++s)e=this.moveToLineTo_(t,e,i[s],n,!0);return e}drawCircle(t){if(Lz(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=function(t,e,i){const n=t.getFlatCoordinates();if(n){const s=t.getStride();return _G(n,0,n.length,s,e,i)}return null}(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(i*i+n*n),r=this.context_;r.beginPath(),r.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&r.fill(),this.strokeState_&&r.stroke()}\"\"!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case\"Point\":this.drawPoint(t);break;case\"LineString\":this.drawLineString(t);break;case\"Polygon\":this.drawPolygon(t);break;case\"MultiPoint\":this.drawMultiPoint(t);break;case\"MultiLineString\":this.drawMultiLineString(t);break;case\"MultiPolygon\":this.drawMultiPolygon(t);break;case\"GeometryCollection\":this.drawGeometryCollection(t);break;case\"Circle\":this.drawCircle(t)}}drawFeature(t,e){const i=e.getGeometryFunction()(t);!i||!Lz(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),\"\"!==this.text_&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),\"\"!==this.text_&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Lz(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(\"\"!==this.text_){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Lz(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();let n=0;const s=t.getEnds(),r=t.getStride();e.beginPath();for(let t=0,o=s.length;t<o;++t)n=this.moveToLineTo_(i,n,s[t],r,!1);e.stroke()}if(\"\"!==this.text_){const e=t.getFlatMidpoints();this.drawText_(e,0,e.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Lz(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(\"\"!==this.text_){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Lz(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const s=t.getEndss(),r=t.getStride();e.beginPath();for(let t=0,o=s.length;t<o;++t)n=this.drawRings_(i,n,s[t],r);this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(\"\"!==this.text_){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),_B(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:n7;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(t){const e=t.getColor();this.fillState_={fillStyle:j8(e||Q8)}}else this.fillState_=null;if(e){const t=e.getColor(),i=e.getLineCap(),n=e.getLineDash(),s=e.getLineDashOffset(),r=e.getLineJoin(),o=e.getWidth(),a=e.getMiterLimit(),l=n||t7;this.strokeState_={lineCap:void 0!==i?i:J8,lineDash:1===this.pixelRatio_?l:l.map(t=>t*this.pixelRatio_),lineDashOffset:(s||0)*this.pixelRatio_,lineJoin:void 0!==r?r:e7,lineWidth:(void 0!==o?o:1)*this.pixelRatio_,miterLimit:void 0!==a?a:10,strokeStyle:j8(t||i7)}}else this.strokeState_=null}setImageStyle(t){let e;if(!t||!(e=t.getSize()))return void(this.image_=null);const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const r=t.getScaleArray();this.imageScale_=[r[0]*this.pixelRatio_/i,r[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(t){const e=t.getFill();if(e){const t=e.getColor();this.textFillState_={fillStyle:j8(t||Q8)}}else this.textFillState_=null;const i=t.getStroke();if(i){const t=i.getColor(),e=i.getLineCap(),n=i.getLineDash(),s=i.getLineDashOffset(),r=i.getLineJoin(),o=i.getWidth(),a=i.getMiterLimit();this.textStrokeState_={lineCap:void 0!==e?e:J8,lineDash:n||t7,lineDashOffset:s||0,lineJoin:void 0!==r?r:e7,lineWidth:void 0!==o?o:1,miterLimit:void 0!==a?a:10,strokeStyle:j8(t||i7)}}else this.textStrokeState_=null;const n=t.getFont(),s=t.getOffsetX(),r=t.getOffsetY(),o=t.getRotateWithView(),a=t.getRotation(),l=t.getScaleArray(),c=t.getText(),h=t.getTextAlign(),u=t.getTextBaseline();this.textState_={font:void 0!==n?n:X8,textAlign:void 0!==h?h:n7,textBaseline:void 0!==u?u:s7},this.text_=void 0!==c?Array.isArray(c)?c.reduce((t,e,i)=>t+(i%2?\" \":e),\"\"):c:\"\",this.textOffsetX_=void 0!==s?this.pixelRatio_*s:0,this.textOffsetY_=void 0!==r?this.pixelRatio_*r:0,this.textRotateWithView_=void 0!==o&&o,this.textRotation_=void 0!==a?a:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=\"\"}};const xat=.5,Sat={Point:function(t,e,i,n,s){const r=i.getImage(),o=i.getText();let a;if(r){if(2!=r.getImageState())return;let l=t;if(s){const c=r.getDeclutterMode();if(\"none\"!==c)if(l=s,\"obstacle\"===c){const s=t.getBuilder(i.getZIndex(),\"Image\");s.setImageStyle(r,a),s.drawPoint(e,n)}else o&&o.getText()&&(a={})}const c=l.getBuilder(i.getZIndex(),\"Image\");c.setImageStyle(r,a),c.drawPoint(e,n)}if(o&&o.getText()){let r=t;s&&(r=s);const l=r.getBuilder(i.getZIndex(),\"Text\");l.setTextStyle(o,a),l.drawText(e,n)}},LineString:function(t,e,i,n,s){const r=i.getStroke();if(r){const s=t.getBuilder(i.getZIndex(),\"LineString\");s.setFillStrokeStyle(null,r),s.drawLineString(e,n)}const o=i.getText();if(o&&o.getText()){const r=(s||t).getBuilder(i.getZIndex(),\"Text\");r.setTextStyle(o),r.drawText(e,n)}},Polygon:function(t,e,i,n,s){const r=i.getFill(),o=i.getStroke();if(r||o){const s=t.getBuilder(i.getZIndex(),\"Polygon\");s.setFillStrokeStyle(r,o),s.drawPolygon(e,n)}const a=i.getText();if(a&&a.getText()){const r=(s||t).getBuilder(i.getZIndex(),\"Text\");r.setTextStyle(a),r.drawText(e,n)}},MultiPoint:function(t,e,i,n,s){const r=i.getImage(),o=i.getText();let a;if(r){if(2!=r.getImageState())return;let l=t;if(s){const c=r.getDeclutterMode();if(\"none\"!==c)if(l=s,\"obstacle\"===c){const s=t.getBuilder(i.getZIndex(),\"Image\");s.setImageStyle(r,a),s.drawMultiPoint(e,n)}else o&&o.getText()&&(a={})}const c=l.getBuilder(i.getZIndex(),\"Image\");c.setImageStyle(r,a),c.drawMultiPoint(e,n)}if(o&&o.getText()){let r=t;s&&(r=s);const l=r.getBuilder(i.getZIndex(),\"Text\");l.setTextStyle(o,a),l.drawText(e,n)}},MultiLineString:function(t,e,i,n,s){const r=i.getStroke();if(r){const s=t.getBuilder(i.getZIndex(),\"LineString\");s.setFillStrokeStyle(null,r),s.drawMultiLineString(e,n)}const o=i.getText();if(o&&o.getText()){const r=(s||t).getBuilder(i.getZIndex(),\"Text\");r.setTextStyle(o),r.drawText(e,n)}},MultiPolygon:function(t,e,i,n,s){const r=i.getFill(),o=i.getStroke();if(o||r){const s=t.getBuilder(i.getZIndex(),\"Polygon\");s.setFillStrokeStyle(r,o),s.drawMultiPolygon(e,n)}const a=i.getText();if(a&&a.getText()){const r=(s||t).getBuilder(i.getZIndex(),\"Text\");r.setTextStyle(a),r.drawText(e,n)}},GeometryCollection:function(t,e,i,n,s){const r=e.getGeometriesArray();let o,a;for(o=0,a=r.length;o<a;++o)Sat[r[o].getType()](t,r[o],i,n,s)},Circle:function(t,e,i,n,s){const r=i.getFill(),o=i.getStroke();if(r||o){const s=t.getBuilder(i.getZIndex(),\"Circle\");s.setFillStrokeStyle(r,o),s.drawCircle(e,n)}const a=i.getText();if(a&&a.getText()){const r=(s||t).getBuilder(i.getZIndex(),\"Text\");r.setTextStyle(a),r.drawText(e,n)}}};function Cat(t,e){return parseInt(MB(t),10)-parseInt(MB(e),10)}function kat(t,e){const i=Eat(t,e);return i*i}function Eat(t,e){return.5*t/e}function Mat(t,e,i,n,s,r,o){let a=!1;const l=i.getImage();if(l){const t=l.getImageState();2==t||3==t?l.unlistenImageChange(s):(0==t&&l.load(),l.listenImageChange(s),a=!0)}return function(t,e,i,n,s,r){const o=i.getGeometryFunction()(e);if(!o)return;const a=o.simplifyTransformed(n,s);i.getRenderer()?Tat(t,a,i,e):Sat[a.getType()](t,a,i,e,r)}(t,e,i,n,r,o),a}function Tat(t,e,i,n){if(\"GeometryCollection\"!=e.getType())t.getBuilder(i.getZIndex(),\"Default\").drawCustom(e,n,i.getRenderer(),i.getHitDetectionRenderer());else{const s=e.getGeometries();for(let e=0,r=s.length;e<r;++e)Tat(t,s[e],i,n)}}var Iat=class extends Zrt{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=[1/0,1/0,-1/0,-1/0],this.wrappedRenderedExtent_=[1/0,1/0,-1/0,-1/0],this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,s=e.viewState,r=s.center,o=s.resolution,a=s.projection,l=s.rotation,c=a.getExtent(),h=this.getLayer().getSource(),u=e.pixelRatio,d=e.viewHints,p=!(d[0]||d[1]),f=this.compositionContext_,m=Math.round(e.size[0]*u),g=Math.round(e.size[1]*u),A=h.getWrapX()&&a.canWrapX(),v=A?Dz(c):null,_=A?Math.ceil((n[2]-c[2])/v)+1:1;let b=A?Math.floor((n[0]-c[0])/v):0;do{const e=this.getRenderTransform(r,o,l,u,m,g,b*v);t.execute(f,1,e,l,p,void 0,i)}while(++b<_)}setupCompositionContext_(){if(1!==this.opacity_){const t=jB(this.context.canvas.width,this.context.canvas.height,qrt);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,HB(this.compositionContext_),qrt.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];(function(t,e,i){dG(t,e,0,0,i,0,0)})(this.pixelTransform,1/i,1/i),gG(this.inversePixelTransform,this.pixelTransform);const s=vG(this.pixelTransform);this.useContainer(e,s,this.getBackground(t));const r=this.context,o=r.canvas,a=this.replayGroup_,l=this.declutterExecutorGroup;if((!a||a.isEmpty())&&(!l||l.isEmpty()))return null;const c=Math.round(t.size[0]*i),h=Math.round(t.size[1]*i);o.width!=c||o.height!=h?(o.width=c,o.height=h,o.style.transform!==s&&(o.style.transform=s)):this.containerReused||r.clearRect(0,0,c,h),this.preRender(r,t);const u=t.viewState;this.opacity_=n.opacity,this.setupCompositionContext_();let d=!1,p=!0;if(n.extent&&this.clipping){const e=jV(n.extent);p=Lz(e,t.extent),d=p&&!hz(e,t.extent),d&&this.clipUnrotated(this.compositionContext_,t,e)}return p&&this.renderWorlds(a,t),d&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(r,t),this.renderedRotation_!==u.rotation&&(this.renderedRotation_=u.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise((function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const t=[this.context.canvas.width,this.context.canvas.height];pG(this.pixelTransform,t);const e=this.renderedCenter_,i=this.renderedResolution_,n=this.renderedRotation_,s=this.renderedProjection_,r=this.wrappedRenderedExtent_,o=this.getLayer(),a=[],l=t[0]*xat,c=t[1]*xat;a.push(this.getRenderTransform(e,i,n,xat,l,c,0).slice());const h=o.getSource(),u=s.getExtent();if(h.getWrapX()&&s.canWrapX()&&!hz(u,r)){let t=r[0];const s=Dz(u);let o,h=0;for(;t<u[0];)--h,o=s*h,a.push(this.getRenderTransform(e,i,n,xat,l,c,o).slice()),t+=s;for(h=0,t=r[2];t>u[2];)++h,o=s*h,a.push(this.getRenderTransform(e,i,n,xat,l,c,o).slice()),t-=s}this.hitDetectionImageData_=function(t,e,i,n,s,r,o){const a=jB(t[0]*xat,t[1]*xat);a.imageSmoothingEnabled=!1;const l=a.canvas,c=new wat(a,xat,s,null,o),h=i.length,u=Math.floor(16777215/h),d={};for(let f=1;f<=h;++f){const t=i[f-1],e=t.getStyleFunction()||n;if(!n)continue;let o=e(t,r);if(!o)continue;Array.isArray(o)||(o=[o]);const a=\"#\"+(\"000000\"+(f*u).toString(16)).slice(-6);for(let i=0,n=o.length;i<n;++i){const e=o[i],n=e.getGeometryFunction()(t);if(!n||!Lz(s,n.getExtent()))continue;const r=e.clone(),l=r.getFill();l&&l.setColor(a);const c=r.getStroke();c&&(c.setColor(a),c.setLineDash(null)),r.setText(void 0);const h=e.getImage();if(h&&0!==h.getOpacity()){const t=h.getImageSize();if(!t)continue;const e=jB(t[0],t[1],void 0,{alpha:!1}),i=e.canvas;e.fillStyle=a,e.fillRect(0,0,i.width,i.height),r.setImage(new T8({img:i,imgSize:t,anchor:h.getAnchor(),anchorXUnits:\"pixels\",anchorYUnits:\"pixels\",offset:h.getOrigin(),opacity:1,size:h.getSize(),scale:h.getScale(),rotation:h.getRotation(),rotateWithView:h.getRotateWithView()}))}const u=r.getZIndex()||0;let p=d[u];p||(p={},d[u]=p,p.Polygon=[],p.Circle=[],p.LineString=[],p.Point=[]),p[n.getType().replace(\"Multi\",\"\")].push(n,r)}}const p=Object.keys(d).map(Number).sort(mB);for(let f=0,m=p.length;f<m;++f){const t=d[p[f]];for(const i in t){const n=t[i];for(let t=0,i=n.length;t<i;t+=2){c.setStyle(n[t+1]);for(let i=0,s=e.length;i<s;++i)c.setTransform(e[i]),c.drawGeometry(n[t])}}}return a.getImageData(0,0,l.width,l.height)}(t,a,this.renderedFeatures_,o.getStyleFunction(),r,i,n)}e(function(t,e,i){const n=[];if(i){const s=Math.floor(Math.round(t[0])*xat),r=Math.floor(Math.round(t[1])*xat),o=4*(tV(s,0,i.width-1)+tV(r,0,i.height-1)*i.width),a=i.data[o+2]+256*(i.data[o+1]+256*i.data[o]),l=Math.floor(16777215/e.length);a&&a%l==0&&n.push(e[a/l-1])}return n}(t,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))}forEachFeatureAtCoordinate(t,e,i,n,s){if(!this.replayGroup_)return;const r=e.viewState.resolution,o=e.viewState.rotation,a=this.getLayer(),l={},c=function(t,e,i){const r=MB(t),o=l[r];if(o){if(!0!==o&&i<o.distanceSq){if(0===i)return l[r]=!0,s.splice(s.lastIndexOf(o),1),n(t,a,e);o.geometry=e,o.distanceSq=i}}else{if(0===i)return l[r]=!0,n(t,a,e);s.push(l[r]={feature:t,layer:a,geometry:e,distanceSq:i,callback:n})}};let h;const u=[this.replayGroup_];return this.declutterExecutorGroup&&u.push(this.declutterExecutorGroup),u.some(n=>h=n.forEachFeatureAtCoordinate(t,r,o,i,c,n===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(t=>t.value):null)),h}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[0],s=t.viewHints[1],r=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!r&&n||!o&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const a=t.extent,l=t.viewState,c=l.projection,h=l.resolution,u=t.pixelRatio,d=e.getRevision(),p=e.getRenderBuffer();let f=e.getRenderOrder();void 0===f&&(f=Cat);const m=l.center.slice(),g=oz(a,p*h),A=g.slice(),v=[g.slice()],_=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!hz(_,t.extent)){const t=Dz(_),e=Math.max(Dz(g)/2,t);g[0]=_[0]-e,g[2]=_[2]+e,gV(m,c);const i=Nz(v[0],c);i[0]<_[0]&&i[2]<_[2]?v.push([i[0]+t,i[1],i[2]+t,i[3]]):i[0]>_[0]&&i[2]>_[2]&&v.push([i[0]-t,i[1],i[2]-t,i[3]])}if(this.ready&&this.renderedResolution_==h&&this.renderedRevision_==d&&this.renderedRenderOrder_==f&&hz(this.wrappedRenderedExtent_,g))return _B(this.renderedExtent_,A)||(this.hitDetectionImageData_=null,this.renderedExtent_=A),this.renderedCenter_=m,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const b=new aat(Eat(h,u),g,h,u);let y;this.getLayer().getDeclutter()&&(y=new aat(Eat(h,u),g,h,u));const w=zV();let x;if(w){for(let t=0,e=v.length;t<e;++t){const e=UV(v[t]);i.loadFeatures(e,HV(h),w)}x=DV(w,c)}else for(let P=0,O=v.length;P<O;++P)i.loadFeatures(v[P],h,c);const S=kat(h,u);let C=!0;const k=(function(t){let i;const n=t.getStyleFunction()||e.getStyleFunction();if(n&&(i=n(t,h)),i){const e=this.renderFeature(t,S,i,b,x,y);C=C&&!e}}).bind(this),E=UV(g),M=i.getFeaturesInExtent(E);f&&M.sort(f);for(let P=0,O=M.length;P<O;++P)k(M[P]);this.renderedFeatures_=M,this.ready=C;const T=b.finish(),I=new yat(g,h,u,i.getOverlaps(),T,e.getRenderBuffer());return y&&(this.declutterExecutorGroup=new yat(g,h,u,i.getOverlaps(),y.finish(),e.getRenderBuffer())),this.renderedResolution_=h,this.renderedRevision_=d,this.renderedRenderOrder_=f,this.renderedExtent_=A,this.wrappedRenderedExtent_=g,this.renderedCenter_=m,this.renderedProjection_=c,this.replayGroup_=I,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s,r){if(!i)return!1;let o=!1;if(Array.isArray(i))for(let a=0,l=i.length;a<l;++a)o=Mat(n,t,i[a],e,this.boundHandleStyleImageChange_,s,r)||o;else o=Mat(n,t,i,e,this.boundHandleStyleImageChange_,s,r);return o}},Pat=class extends Yot{constructor(t){super(t)}createRenderer(){return new Iat(this)}};function Oat(t,e){return[[-1/0,-1/0,1/0,1/0]]}function Rat(t,e){return[t]}function Dat(t,e){return function(i,n,s,r,o){const a=this;!function(t,e,i,n,s,r,o){const a=new XMLHttpRequest;a.open(\"GET\",\"function\"==typeof t?t(i,n,s):t,!0),\"arraybuffer\"==e.getType()&&(a.responseType=\"arraybuffer\"),a.withCredentials=false,a.onload=function(t){if(!a.status||a.status>=200&&a.status<300){const t=e.getType();let n;\"json\"==t||\"text\"==t?n=a.responseText:\"xml\"==t?(n=a.responseXML,n||(n=(new DOMParser).parseFromString(a.responseText,\"application/xml\"))):\"arraybuffer\"==t&&(n=a.response),n?r(e.readFeatures(n,{extent:i,featureProjection:s}),e.readProjection(n)):o()}else o()},a.onerror=o,a.send()}(t,e,i,n,s,function(t,e){a.addFeatures(t),void 0!==r&&r(t)},o||wB)}}class Lat extends fB{constructor(t,e,i){super(t),this.feature=e,this.features=i}}var Fat=class extends a${constructor(t){super({attributions:(t=t||{}).attributions,interpolate:!0,projection:void 0,state:\"ready\",wrapX:void 0===t.wrapX||t.wrapX}),this.loader_=wB,this.format_=t.format,this.overlaps_=void 0===t.overlaps||t.overlaps,this.url_=t.url,void 0!==t.loader?this.loader_=t.loader:void 0!==this.url_&&(sz(this.format_,7),this.loader_=Dat(this.url_,this.format_)),this.strategy_=void 0!==t.strategy?t.strategy:Oat;const e=void 0===t.useSpatialIndex||t.useSpatialIndex;let i,n;this.featuresRtree_=e?new Uot:null,this.loadedExtentsRtree_=new Uot,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&void 0===i&&(i=new lrt(n)),void 0!==n&&this.addFeaturesInternal(n),void 0!==i&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=MB(t);if(!this.addToIndex_(e,t))return void(this.featuresCollection_&&this.featuresCollection_.remove(t));this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const e=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(e,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Lat(\"addfeature\",t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[KB(e,\"change\",this.handleFeatureChange_,this),KB(e,\"propertychange\",this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const n=e.getId();return void 0!==n&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(sz(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let s=0,r=t.length;s<r;s++){const e=t[s],n=MB(e);this.addToIndex_(n,e)&&i.push(e)}for(let s=0,r=i.length;s<r;s++){const t=i[s],r=MB(t);this.setupChangeEvents_(r,t);const o=t.getGeometry();if(o){const i=o.getExtent();e.push(i),n.push(t)}else this.nullGeometryFeatures_[r]=t}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(\"addfeature\"))for(let s=0,r=i.length;s<r;s++)this.dispatchEvent(new Lat(\"addfeature\",i[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(\"addfeature\",function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(\"removefeature\",function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(\"add\",(function(t){e||(e=!0,this.addFeature(t.element),e=!1)}).bind(this)),t.addEventListener(\"remove\",(function(t){e||(e=!0,this.removeFeature(t.element),e=!1)}).bind(this)),this.featuresCollection_=t}clear(t){if(t){for(const t in this.featureChangeKeys_)this.featureChangeKeys_[t].forEach(QB);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const t=(function(t){this.removeFeatureInternal(t)}).bind(this);this.featuresRtree_.forEach(t);for(const e in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[e])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Lat(\"clear\");this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){return this.forEachFeatureInExtent([t[0],t[1],t[0],t[1]],function(i){if(i.getGeometry().intersectsCoordinate(t))return e(i)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const t=e(i);if(t)return t}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),SB(this.nullGeometryFeatures_)||vB(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const i=function(t,e){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(t[0])||!isFinite(t[2]))return[[i[0],t[1],i[2],t[3]]];Nz(t,e);const n=Dz(i);if(Dz(t)>n)return[[i[0],t[1],i[2],t[3]]];if(t[0]<i[0])return[[t[0]+n,t[1],i[2],t[3]],[i[0],t[1],t[2],t[3]]];if(t[2]>i[2])return[[t[0],t[1],i[2],t[3]],[i[0],t[1],t[2]-n,t[3]]]}return[t]}(t,e);return[].concat(...i.map(t=>this.featuresRtree_.getInExtent(t)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let s=null;const r=[NaN,NaN];let o=1/0;const a=[-1/0,-1/0,1/0,1/0];return e=e||bB,this.featuresRtree_.forEachInExtent(a,function(t){if(e(t)){const e=t.getGeometry(),l=o;if(o=e.closestPointXY(i,n,r,o),o<l){s=t;const e=Math.sqrt(o);a[0]=i-e,a[1]=n-e,a[2]=i+e,a[3]=n+e}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return void 0!==e?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return void 0!==e?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=MB(e),n=e.getGeometry();if(n){const t=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(t,e)):this.featuresRtree_&&this.featuresRtree_.update(t,e)}else i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);const s=e.getId();if(void 0!==s){const t=s.toString();this.idIndex_[t]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[t]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Lat(\"changefeature\",e))}hasFeature(t){const e=t.getId();return void 0!==e?e in this.idIndex_:MB(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&SB(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,s=this.strategy_(t,e,i);for(let r=0,o=s.length;r<o;++r){const t=s[r];n.forEachInExtent(t,function(e){return hz(e.extent,t)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Lat(\"featuresloadstart\")),this.loader_.call(this,t,e,i,(function(t){--this.loadingExtentsCount_,this.dispatchEvent(new Lat(\"featuresloadend\",void 0,t))}).bind(this),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new Lat(\"featuresloaderror\"))}).bind(this)),n.insert(t,{extent:t.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(e){if(Az(e.extent,t))return i=e,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=MB(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=MB(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(QB),delete this.featureChangeKeys_[e];const n=t.getId();return void 0!==n&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Lat(\"removefeature\",t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){sz(this.format_,7),this.url_=t,this.setLoader(Dat(t,this.format_))}};const Nat=[0,0,0,0],Bat=[];class zat extends fB{constructor(t,e,i){super(t),this.features=e,this.mapBrowserEvent=i}}function Vat(t,e){return t.index-e.index}function $at(t,e,i){const n=e.geometry;if(\"Circle\"===n.getType()){let s=n;if(1===e.index){const e=zV();e&&(s=s.clone().transform(e,i));const n=fV(s.getCenter(),$V(t)),r=Math.sqrt(n)-s.getRadius();return r*r}}const s=$V(t);return Bat[0]=$V(e.segment[0]),Bat[1]=$V(e.segment[1]),function(t,e){return fV(t,uV(t,e))}(s,Bat)}function Uat(t,e,i){const n=e.geometry;if(\"Circle\"===n.getType()&&1===e.index){let e=n;const s=zV();return s&&(e=e.clone().transform(s,i)),VV(e.getClosestPoint($V(t)))}const s=$V(t);return Bat[0]=$V(e.segment[0]),Bat[1]=$V(e.segment[1]),VV(uV(s,Bat))}function jat(){const t=w7();return function(e,i){return t.Point}}var Hat=class extends frt{constructor(t){let e;if(super(t),this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=t.condition?t.condition:krt,this.defaultDeleteCondition_=function(t){return function(t){const e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey}(t)&&function(t){return t.type==urt.SINGLECLICK}(t)},this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:vrt,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Uot,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Pat({source:new Fat({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:jat(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,t.features?e=t.features:t.source&&(this.source_=t.source,e=new lrt(this.source_.getFeatures()),this.source_.addEventListener(\"addfeature\",this.handleSourceAdd_.bind(this)),this.source_.addEventListener(\"removefeature\",this.handleSourceRemove_.bind(this))),!e)throw new Error(\"The modify interaction requires features, a source or a layer\");t.hitDetection&&(this.hitDetection_=t.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(\"add\",this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(\"remove\",this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===t.snapToPointer?!this.hitDetection_:t.snapToPointer}addFeature_(t){const e=t.getGeometry();if(e){const i=this.SEGMENT_WRITERS_[e.getType()];i&&i(t,e)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),t.addEventListener(\"change\",this.boundHandleFeatureChange_)}willModifyFeatures_(t,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new lrt;const i=this.featuresBeingModified_.getArray();for(let t=0,n=e.length;t<n;++t){const n=e[t];for(let t=0,e=n.length;t<e;++t){const e=n[t].feature;e&&!i.includes(e)&&this.featuresBeingModified_.push(e)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new zat(\"modifystart\",this.featuresBeingModified_,t))}}removeFeature_(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(\"change\",this.boundHandleFeatureChange_)}removeFeatureSegmentData_(t){const e=this.rBush_,i=[];e.forEach(function(e){t===e.feature&&i.push(e)});for(let n=i.length-1;n>=0;--n){const t=i[n];for(let e=this.dragSegments_.length-1;e>=0;--e)this.dragSegments_[e][0]===t&&this.dragSegments_.splice(e,1);e.remove(t)}}setActive(t){this.vertexFeature_&&!t&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(t)}setMap(t){this.overlay_.setMap(t),super.setMap(t)}getOverlay(){return this.overlay_}handleSourceAdd_(t){t.feature&&this.features_.push(t.feature)}handleSourceRemove_(t){t.feature&&this.features_.remove(t.feature)}handleFeatureAdd_(t){this.addFeature_(t.element)}handleFeatureChange_(t){if(!this.changingFeature_){const e=t.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(t){this.removeFeature_(t.element)}writePointGeometry_(t,e){const i=e.getCoordinates(),n={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),n)}writeMultiPointGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n],r={feature:t,geometry:e,depth:[n],index:n,segment:[s,s]};this.rBush_.insert(e.getExtent(),r)}}writeLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length-1;n<s;++n){const s=i.slice(n,n+2),r={feature:t,geometry:e,index:n,segment:s};this.rBush_.insert(rz(s),r)}}writeMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n];for(let i=0,r=s.length-1;i<r;++i){const r=s.slice(i,i+2),o={feature:t,geometry:e,depth:[n],index:i,segment:r};this.rBush_.insert(rz(r),o)}}}writePolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n];for(let i=0,r=s.length-1;i<r;++i){const r=s.slice(i,i+2),o={feature:t,geometry:e,depth:[n],index:i,segment:r};this.rBush_.insert(rz(r),o)}}}writeMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const s=i[n];for(let i=0,r=s.length;i<r;++i){const r=s[i];for(let s=0,o=r.length-1;s<o;++s){const o=r.slice(s,s+2),a={feature:t,geometry:e,depth:[i,n],index:s,segment:o};this.rBush_.insert(rz(o),a)}}}}writeCircleGeometry_(t,e){const i=e.getCenter(),n={feature:t,geometry:e,index:0,segment:[i,i]},s={feature:t,geometry:e,index:1,segment:[i,i]},r=[n,s];n.featureSegments=r,s.featureSegments=r,this.rBush_.insert(mz(i),n);let o=e;const a=zV();if(a&&this.getMap()){const t=this.getMap().getView().getProjection();o=o.clone().transform(a,t),o=nW(o).transform(t,a)}this.rBush_.insert(o.getExtent(),s)}writeGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let n=0;n<i.length;++n){const e=i[n];this.SEGMENT_WRITERS_[e.getType()](t,e)}}createOrUpdateVertexFeature_(t,e,i){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(t):(n=new l8(new WG(t)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set(\"features\",e),n.set(\"geometries\",i),n}handleEvent(t){if(!t.originalEvent)return!0;let e;return this.lastPointerEvent_=t,!t.map.getView().getInteracting()&&t.type==urt.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(t),this.vertexFeature_&&this.deleteCondition_(t)&&(e=!(t.type!=urt.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),t.type==urt.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(t)&&!e}handleDragEvent(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t,this.dragSegments_);const e=[t.coordinate[0]+this.delta_[0],t.coordinate[1]+this.delta_[1]],i=[],n=[];for(let s=0,r=this.dragSegments_.length;s<r;++s){const r=this.dragSegments_[s],o=r[0],a=o.feature;i.includes(a)||i.push(a);const l=o.geometry;n.includes(l)||n.push(l);const c=o.depth;let h;const u=o.segment,d=r[1];for(;e.length<l.getStride();)e.push(u[d][e.length]);switch(l.getType()){case\"Point\":h=e,u[0]=e,u[1]=e;break;case\"MultiPoint\":h=l.getCoordinates(),h[o.index]=e,u[0]=e,u[1]=e;break;case\"LineString\":h=l.getCoordinates(),h[o.index+d]=e,u[d]=e;break;case\"MultiLineString\":case\"Polygon\":h=l.getCoordinates(),h[c[0]][o.index+d]=e,u[d]=e;break;case\"MultiPolygon\":h=l.getCoordinates(),h[c[1]][c[0]][o.index+d]=e,u[d]=e;break;case\"Circle\":if(u[0]=e,u[1]=e,0===o.index)this.changingFeature_=!0,l.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;const i=t.map.getView().getProjection();let n=mV($V(l.getCenter()),$V(e));const s=zV();if(s){const t=l.clone().transform(s,i);t.setRadius(n),n=t.transform(i,s).getRadius()}l.setRadius(n),this.changingFeature_=!1}}h&&this.setGeometryCoordinates_(l,h)}this.createOrUpdateVertexFeature_(e,i,n)}handleDownEvent(t){if(!this.condition_(t))return!1;const e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const n=t.map.getView().getProjection(),s=[],r=i.getGeometry().getCoordinates(),o=rz([r]),a=this.rBush_.getInExtent(o),l={};a.sort(Vat);for(let i=0,c=a.length;i<c;++i){const o=a[i],c=o.segment;let h=MB(o.geometry);const u=o.depth;if(u&&(h+=\"-\"+u.join(\"-\")),l[h]||(l[h]=new Array(2)),\"Circle\"!==o.geometry.getType()||1!==o.index)if(!dV(c[0],r)||l[h][0])if(!dV(c[1],r)||l[h][1])MB(c)in this.vertexSegments_&&!l[h][0]&&!l[h][1]&&this.insertVertexCondition_(t)&&s.push(o);else{if(l[h][0]&&0===l[h][0].index){let t=o.geometry.getCoordinates();switch(o.geometry.getType()){case\"LineString\":case\"MultiLineString\":continue;case\"MultiPolygon\":t=t[u[1]];case\"Polygon\":if(o.index!==t[u[0]].length-2)continue}}this.dragSegments_.push([o,1]),l[h][1]=o}else this.dragSegments_.push([o,0]),l[h][0]=o;else dV(Uat(e,o,n),r)&&!l[h][0]&&(this.dragSegments_.push([o,0]),l[h][0]=o)}s.length&&this.willModifyFeatures_(t,[s]);for(let t=s.length-1;t>=0;--t)this.insertVertex_(s[t],r)}return!!this.vertexFeature_}handleUpEvent(t){for(let e=this.dragSegments_.length-1;e>=0;--e){const i=this.dragSegments_[e][0],n=i.geometry;if(\"Circle\"===n.getType()){const e=n.getCenter(),s=i.featureSegments[0],r=i.featureSegments[1];s.segment[0]=e,s.segment[1]=e,r.segment[0]=e,r.segment[1]=e,this.rBush_.update(mz(e),s);let o=n;const a=zV();if(a){const e=t.map.getView().getProjection();o=o.clone().transform(a,e),o=nW(o).transform(e,a)}this.rBush_.update(o.getExtent(),r)}else this.rBush_.update(rz(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new zat(\"modifyend\",this.featuresBeingModified_,t)),this.featuresBeingModified_=null),!1}handlePointerMove_(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)}handlePointerAtPixel_(t,e,i){const n=i||e.getCoordinateFromPixel(t),s=e.getView().getProjection(),r=function(t,e){return $at(n,t,s)-$at(n,e,s)};let o,a;if(this.hitDetection_&&e.forEachFeatureAtPixel(t,(t,e,i)=>{if(\"Point\"===(i=i||t.getGeometry()).getType()&&this.features_.getArray().includes(t)){a=i;const e=i.getFlatCoordinates().slice(0,2);o=[{feature:t,geometry:i,segment:[e,e]}]}return!0},{layerFilter:\"object\"==typeof this.hitDetection_?t=>t===this.hitDetection_:void 0}),!o){const t=UV(oz(jV(mz(n,Nat)),e.getView().getResolution()*this.pixelTolerance_,Nat));o=this.rBush_.getInExtent(t)}if(o&&o.length>0){const i=o.sort(r)[0],l=i.segment;let c=Uat(n,i,s);const h=e.getPixelFromCoordinate(c);let u=mV(t,h);if(a||u<=this.pixelTolerance_){const t={};if(t[MB(l)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-n[0],this.delta_[1]=c[1]-n[1]),\"Circle\"===i.geometry.getType()&&1===i.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[i.feature],[i.geometry]);else{const n=e.getPixelFromCoordinate(l[0]),s=e.getPixelFromCoordinate(l[1]),r=fV(h,n),a=fV(h,s);u=Math.sqrt(Math.min(r,a)),this.snappedToVertex_=u<=this.pixelTolerance_,this.snappedToVertex_&&(c=r>a?l[1]:l[0]),this.createOrUpdateVertexFeature_(c,[i.feature],[i.geometry]);const d={};d[MB(i.geometry)]=!0;for(let e=1,i=o.length;e<i;++e){const i=o[e].segment;if(!(dV(l[0],i[0])&&dV(l[1],i[1])||dV(l[0],i[1])&&dV(l[1],i[0])))break;{const n=MB(o[e].geometry);n in d||(d[n]=!0,t[MB(i)]=!0)}}}return void(this.vertexSegments_=t)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(t,e){const i=t.segment,n=t.feature,s=t.geometry,r=t.depth,o=t.index;let a;for(;e.length<s.getStride();)e.push(0);switch(s.getType()){case\"MultiLineString\":case\"Polygon\":a=s.getCoordinates(),a[r[0]].splice(o+1,0,e);break;case\"MultiPolygon\":a=s.getCoordinates(),a[r[1]][r[0]].splice(o+1,0,e);break;case\"LineString\":a=s.getCoordinates(),a.splice(o+1,0,e);break;default:return}this.setGeometryCoordinates_(s,a);const l=this.rBush_;l.remove(t),this.updateSegmentIndices_(s,o,r,1);const c={segment:[i[0],e],feature:n,geometry:s,depth:r,index:o};l.insert(rz(c.segment),c),this.dragSegments_.push([c,1]);const h={segment:[e,i[1]],feature:n,geometry:s,depth:r,index:o+1};l.insert(rz(h.segment),h),this.dragSegments_.push([h,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=urt.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_);const e=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new zat(\"modifyend\",this.featuresBeingModified_,t)),this.featuresBeingModified_=null,e}return!1}removeVertex_(){const t=this.dragSegments_,e={};let i,n,s,r,o,a,l,c,h,u,d,p=!1;for(o=t.length-1;o>=0;--o)s=t[o],u=s[0],d=MB(u.feature),u.depth&&(d+=\"-\"+u.depth.join(\"-\")),d in e||(e[d]={}),0===s[1]?(e[d].right=u,e[d].index=u.index):1==s[1]&&(e[d].left=u,e[d].index=u.index+1);for(d in e){switch(h=e[d].right,l=e[d].left,a=e[d].index,c=a-1,u=void 0!==l?l:h,c<0&&(c=0),r=u.geometry,n=r.getCoordinates(),i=n,p=!1,r.getType()){case\"MultiLineString\":n[u.depth[0]].length>2&&(n[u.depth[0]].splice(a,1),p=!0);break;case\"LineString\":n.length>2&&(n.splice(a,1),p=!0);break;case\"MultiPolygon\":i=i[u.depth[1]];case\"Polygon\":i=i[u.depth[0]],i.length>4&&(a==i.length-1&&(a=0),i.splice(a,1),p=!0,0===a&&(i.pop(),i.push(i[0]),c=i.length-1))}if(p){this.setGeometryCoordinates_(r,n);const e=[];if(void 0!==l&&(this.rBush_.remove(l),e.push(l.segment[0])),void 0!==h&&(this.rBush_.remove(h),e.push(h.segment[1])),void 0!==l&&void 0!==h){const t={depth:u.depth,feature:u.feature,geometry:u.geometry,index:c,segment:e};this.rBush_.insert(rz(t.segment),t)}this.updateSegmentIndices_(r,a,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.length=0}}return p}setGeometryCoordinates_(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(t,e,i,n){this.rBush_.forEachInExtent(t.getExtent(),function(s){s.geometry===t&&(void 0===i||void 0===s.depth||_B(s.depth,i))&&s.index>e&&(s.index+=n)})}};class Gat extends CG{constructor(t,e,i){super(),void 0!==i&&void 0===e?this.setFlatCoordinates(i,t):this.setCenterAndRadius(t,e=e||0,i)}clone(){const t=new Gat(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const s=this.flatCoordinates,r=t-s[0],o=e-s[1],a=r*r+o*o;if(a<n){if(0===a)for(let t=0;t<this.stride;++t)i[t]=s[t];else{const t=this.getRadius()/Math.sqrt(a);i[0]=s[0]+t*r,i[1]=s[1]+t*o;for(let e=2;e<this.stride;++e)i[e]=s[e]}return i.length=this.stride,a}return n}containsXY(t,e){const i=this.flatCoordinates,n=t-i[0],s=e-i[1];return n*n+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return pz(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return\"Circle\"}intersectsExtent(t){if(Lz(t,this.getExtent())){const e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||t[1]<=e[1]&&t[3]>=e[1]||wz(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],n=t.slice();n[e]=n[0]+i;for(let s=1;s<e;++s)n[e+s]=t[s];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let s=PG(n,0,t);n[s++]=n[0]+e;for(let r=1,o=this.stride;r<o;++r)n[s++]=n[r];n.length=s,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),n=this.getStride();this.setCenter(bG(i,0,i.length,n,t,e,i)),this.changed()}translate(t,e){const i=this.getCenter(),n=this.getStride();this.setCenter(yG(i,0,i.length,n,t,e,i)),this.changed()}}var Wat=Gat;class qat extends fB{constructor(t,e){super(t),this.feature=e}}function Yat(t,e){return iV(t[0],t[1],e[0],e[1])}function Zat(t,e){const i=t.length;return e<0?t[e+i]:e>=i?t[e-i]:t[e]}function Kat(t,e,i){let n,s;e<i?(n=e,s=i):(n=i,s=e);const r=Math.ceil(n),o=Math.floor(s);if(r>o)return Yat(ilt(t,n),ilt(t,s));let a=0;n<r&&(a+=Yat(ilt(t,n),Zat(t,r))),o<s&&(a+=Yat(Zat(t,o),ilt(t,s)));for(let l=r;l<o-1;++l)a+=Yat(Zat(t,l),Zat(t,l+1));return a}function Xat(t,e,i){if(e instanceof D8)Jat(t,e.getCoordinates(),!1,i);else if(e instanceof F8){const n=e.getCoordinates();for(let e=0,s=n.length;e<s;++e)Jat(t,n[e],!1,i)}else if(e instanceof tW){const n=e.getCoordinates();for(let e=0,s=n.length;e<s;++e)Jat(t,n[e],!0,i)}else if(e instanceof V8){const n=e.getCoordinates();for(let e=0,s=n.length;e<s;++e){const s=n[e];for(let e=0,n=s.length;e<n;++e)Jat(t,s[e],!0,i)}}else if(e instanceof p8){const n=e.getGeometries();for(let e=0;e<n.length;++e)Xat(t,n[e],i)}}const Qat={index:-1,endIndex:NaN};function Jat(t,e,i,n){const s=t[0],r=t[1];for(let o=0,a=e.length-1;o<a;++o){const t=elt(s,r,e[o],e[o+1]);if(0===t.squaredDistance){const s=o+t.along;return void n.push({coordinates:e,ring:i,startIndex:s,endIndex:s})}}}const tlt={along:0,squaredDistance:0};function elt(t,e,i,n){const s=i[0],r=i[1],o=n[0]-s,a=n[1]-r;let l=0,c=s,h=r;return(0!==o||0!==a)&&(l=tV(((t-s)*o+(e-r)*a)/(o*o+a*a),0,1),c+=o*l,h+=a*l),tlt.along=l,tlt.squaredDistance=aV(iV(t,e,c,h),10),tlt}function ilt(t,e){const i=t.length;let n=Math.floor(e);const s=e-n;n>=i?n-=i:n<0&&(n+=i);let r=n+1;r>=i&&(r-=i);const o=t[n],a=o[0],l=o[1],c=t[r];return[a+(c[0]-a)*s,l+(c[1]-l)*s]}function nlt(){const t=w7();return function(e,i){return t[e.getGeometry().getType()]}}var slt=class extends frt{constructor(t){const e=t;e.stopDown||(e.stopDown=yB),super(e),this.shouldHandle_=!1,this.downPx_=null,this.freehand_=!1,this.source_=t.source?t.source:null,this.features_=t.features?t.features:null,this.snapTolerance_=t.snapTolerance?t.snapTolerance:12,this.type_=t.type,this.mode_=function(t){switch(t){case\"Point\":case\"MultiPoint\":return\"Point\";case\"LineString\":case\"MultiLineString\":return\"LineString\";case\"Polygon\":case\"MultiPolygon\":return\"Polygon\";case\"Circle\":return\"Circle\";default:throw new Error(\"Invalid type: \"+t)}}(this.type_),this.stopClick_=!!t.stopClick,this.minPoints_=t.minPoints?t.minPoints:\"Polygon\"===this.mode_?3:2,this.maxPoints_=\"Circle\"===this.mode_?2:t.maxPoints?t.maxPoints:1/0,this.finishCondition_=t.finishCondition?t.finishCondition:bB,this.geometryLayout_=t.geometryLayout?t.geometryLayout:\"XY\";let i=t.geometryFunction;if(!i){const t=this.mode_;if(\"Circle\"===t)i=function(t,e,i){const n=e||new Wat([NaN,NaN]),s=$V(t[0]),r=fV(s,$V(t[t.length-1]));n.setCenterAndRadius(s,Math.sqrt(r),this.geometryLayout_);const o=zV();return o&&n.transform(i,o),n};else{let e;\"Point\"===t?e=WG:\"LineString\"===t?e=D8:\"Polygon\"===t&&(e=tW),i=function(i,n,s){return n?n.setCoordinates(\"Polygon\"===t?i[0].length?[i[0].concat([i[0][0]])]:[]:i,this.geometryLayout_):n=new e(i,this.geometryLayout_),n}}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36,this.overlay_=new Pat({source:new Fat({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:nlt(),updateWhileInteracting:!0}),this.geometryName_=t.geometryName,this.condition_=t.condition?t.condition:yrt,this.freehandCondition_=t.freehand?vrt:t.freehandCondition?t.freehandCondition:xrt,this.setTrace(t.trace||!1),this.traceState_={active:!1},this.traceSource_=t.traceSource||t.source||null,this.addChangeListener(\"active\",this.updateState_)}setTrace(t){let e;e=t?!0===t?vrt:t:brt,this.traceCondition_=e}setMap(t){super.setMap(t),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(t){\"contextmenu\"===t.originalEvent.type&&t.originalEvent.preventDefault(),this.freehand_=\"Point\"!==this.mode_&&this.freehandCondition_(t);let e=t.type===urt.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&t.type===urt.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=t.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&t.type===urt.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(t.coordinate),i=!1):this.freehand_&&t.type===urt.POINTERDOWN?i=!1:e&&this.getPointerCount()<2?(i=t.type===urt.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(t),this.shouldHandle_&&t.originalEvent.preventDefault()):(\"mouse\"===t.originalEvent.pointerType||t.type===urt.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t)):t.type===urt.DBLCLICK&&(i=!1),super.handleEvent(t)&&i}handleDownEvent(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t.coordinate),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout((function(){this.handlePointerMove_(new rot(urt.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))}).bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(t){if(!this.traceSource_||!this.traceCondition_(t))return;if(this.traceState_.active)return void this.deactivateTrace_();const e=this.getMap(),i=rz([e.getCoordinateFromPixel([t.pixel[0]-this.snapTolerance_,t.pixel[1]+this.snapTolerance_]),e.getCoordinateFromPixel([t.pixel[0]+this.snapTolerance_,t.pixel[1]-this.snapTolerance_])]),n=this.traceSource_.getFeaturesInExtent(i);if(0===n.length)return;const s=function(t,e){const i=[];for(let n=0;n<e.length;++n)Xat(t,e[n].getGeometry(),i);return i}(t.coordinate,n);s.length&&(this.traceState_={active:!0,startPx:t.pixel.slice(),targets:s,targetIndex:-1})}addOrRemoveTracedCoordinates_(t,e){const i=t.startIndex<=t.endIndex;i===t.startIndex<=e?i&&e>t.endIndex||!i&&e<t.endIndex?this.addTracedCoordinates_(t,t.endIndex,e):(i&&e<t.endIndex||!i&&e>t.endIndex)&&this.removeTracedCoordinates_(e,t.endIndex):(this.removeTracedCoordinates_(t.startIndex,t.endIndex),this.addTracedCoordinates_(t,t.startIndex,e))}removeTracedCoordinates_(t,e){if(t===e)return;let i=0;if(t<e){const n=Math.ceil(t);let s=Math.floor(e);s===e&&(s-=1),i=s-n+1}else{const n=Math.floor(t);let s=Math.ceil(e);s===e&&(s+=1),i=n-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(t,e,i){if(e===i)return;const n=[];if(e<i){const s=Math.ceil(e);let r=Math.floor(i);r===i&&(r-=1);for(let e=s;e<=r;++e)n.push(Zat(t.coordinates,e))}else{const s=Math.floor(e);let r=Math.ceil(i);r===i&&(r+=1);for(let e=s;e>=r;--e)n.push(Zat(t.coordinates,e))}n.length&&this.appendCoordinates(n)}updateTrace_(t){const e=this.traceState_;if(!e.active||-1===e.targetIndex&&mV(e.startPx,t.pixel)<this.snapTolerance_)return;const i=function(t,e,i,n){const s=t[0],r=t[1];let o=1/0,a=-1,l=NaN;for(let u=0;u<e.targets.length;++u){const t=e.targets[u],i=t.coordinates;let n,c=1/0;for(let e=0;e<i.length-1;++e){const t=elt(s,r,i[e],i[e+1]);t.squaredDistance<c&&(c=t.squaredDistance,n=e+t.along)}c<o&&(o=c,t.ring&&e.targetIndex===u&&(t.endIndex>t.startIndex?n<t.startIndex&&(n+=i.length):t.endIndex<t.startIndex&&n>t.startIndex&&(n-=i.length)),l=n,a=u)}const c=e.targets[a];let h=c.ring;if(e.targetIndex===a&&h){const t=ilt(c.coordinates,l);mV(i.getPixelFromCoordinate(t),e.startPx)>n&&(h=!1)}if(h){const t=c.coordinates,e=t.length,i=c.startIndex,n=l;if(i<n){const s=Kat(t,i,n);Kat(t,i,n-e)<s&&(l-=e)}else{const s=Kat(t,i,n);Kat(t,i,n+e)<s&&(l+=e)}}return Qat.index=a,Qat.endIndex=l,Qat}(t.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==i.index){if(-1!==e.targetIndex){const t=e.targets[e.targetIndex];this.removeTracedCoordinates_(t.startIndex,t.endIndex)}const t=e.targets[i.index];this.addTracedCoordinates_(t,t.startIndex,i.endIndex)}else this.addOrRemoveTracedCoordinates_(e.targets[e.targetIndex],i.endIndex);e.targetIndex=i.index;const n=e.targets[e.targetIndex];n.endIndex=i.endIndex;const s=ilt(n.coordinates,n.endIndex),r=this.getMap().getPixelFromCoordinate(s);t.coordinate=s,t.pixel=[Math.round(r[0]),Math.round(r[1])]}handleUpEvent(t){let e=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);const i=this.traceState_.active;if(this.toggleTraceState_(t),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(t.coordinate),!n&&this.freehand_?this.finishDrawing():!this.freehand_&&(!n||\"Point\"===this.mode_)&&(this.atFinish_(t.pixel,i)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&t.preventDefault(),e}handlePointerMove_(t){if(this.pointerType_=t.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const e=this.downPx_,i=t.pixel,n=e[0]-i[0],s=e[1]-i[1],r=n*n+s*s;if(this.shouldHandle_=this.freehand_?r>this.squaredClickTolerance_:r<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(t),this.modifyDrawing_(t.coordinate)):this.createOrUpdateSketchPoint_(t.coordinate.slice())}atFinish_(t,e){let i=!1;if(this.sketchFeature_){let n=!1,s=[this.finishCoordinate_];const r=this.mode_;if(\"Point\"===r)i=!0;else if(\"Circle\"===r)i=2===this.sketchCoords_.length;else if(\"LineString\"===r)n=!e&&this.sketchCoords_.length>this.minPoints_;else if(\"Polygon\"===r){const t=this.sketchCoords_;n=t[0].length>this.minPoints_,s=[t[0][0],t[0][t[0].length-2]],s=e?[t[0][0]]:[t[0][0],t[0][t[0].length-2]]}if(n){const e=this.getMap();for(let n=0,r=s.length;n<r;n++){const r=s[n],o=e.getPixelFromCoordinate(r),a=t[0]-o[0],l=t[1]-o[1],c=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(a*a+l*l)<=c,i){this.finishCoordinate_=r;break}}}}return i}createOrUpdateSketchPoint_(t){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(t):(this.sketchPoint_=new l8(new WG(t)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(t){this.sketchLine_||(this.sketchLine_=new l8);const e=t.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),i.changed()):(i=new D8(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(t){const e=this.getMap().getView().getProjection(),i=SG(this.geometryLayout_);for(;t.length<i;)t.push(0);this.finishCoordinate_=t,\"Point\"===this.mode_?this.sketchCoords_=t.slice():\"Polygon\"===this.mode_?(this.sketchCoords_=[[t.slice(),t.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[t.slice(),t.slice()],this.sketchLineCoords_&&(this.sketchLine_=new l8(new D8(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new l8,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new qat(\"drawstart\",this.sketchFeature_))}modifyDrawing_(t){const e=this.getMap(),i=this.sketchFeature_.getGeometry(),n=e.getView().getProjection(),s=SG(this.geometryLayout_);let r,o;for(;t.length<s;)t.push(0);\"Point\"===this.mode_?o=this.sketchCoords_:\"Polygon\"===this.mode_?(r=this.sketchCoords_[0],o=r[r.length-1],this.atFinish_(e.getPixelFromCoordinate(t))&&(t=this.finishCoordinate_.slice())):(r=this.sketchCoords_,o=r[r.length-1]),o[0]=t[0],o[1]=t[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(t),\"Polygon\"===i.getType()&&\"Polygon\"!==this.mode_?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(t){const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,s;const r=this.mode_;\"LineString\"===r||\"Circle\"===r?(this.finishCoordinate_=t.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(t.slice()),this.geometryFunction_(s,e,i)):\"Polygon\"===r&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():n=!0),s.push(t.slice()),n&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,e,i)),this.createOrUpdateSketchPoint_(t.slice()),this.updateSketchFeatures_(),n&&this.finishDrawing()}removeLastPoints_(t){if(!this.sketchFeature_)return;const e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let s=0;s<t;++s){let t;if(\"LineString\"===n||\"Circle\"===n){if(t=this.sketchCoords_,t.splice(-2,1),t.length>=2){this.finishCoordinate_=t[t.length-2].slice();const e=this.finishCoordinate_.slice();t[t.length-1]=e,this.createOrUpdateSketchPoint_(e)}this.geometryFunction_(t,e,i),\"Polygon\"===e.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(\"Polygon\"===n){t=this.sketchCoords_[0],t.splice(-2,1);const n=this.sketchLine_.getGeometry();if(t.length>=2){const e=t[t.length-2].slice();t[t.length-1]=e,this.createOrUpdateSketchPoint_(e)}n.setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e,i)}if(1===t.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const t=this.abortDrawing_();if(!t)return;let e=this.sketchCoords_;const i=t.getGeometry(),n=this.getMap().getView().getProjection();\"LineString\"===this.mode_?(e.pop(),this.geometryFunction_(e,i,n)):\"Polygon\"===this.mode_&&(e[0].pop(),this.geometryFunction_(e,i,n),e=i.getCoordinates()),\"MultiPoint\"===this.type_?t.setGeometry(new B8([e])):\"MultiLineString\"===this.type_?t.setGeometry(new F8([e])):\"MultiPolygon\"===this.type_&&t.setGeometry(new V8([e])),this.dispatchEvent(new qat(\"drawend\",t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}abortDrawing_(){this.finishCoordinate_=null;const t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),t}abortDrawing(){const t=this.abortDrawing_();t&&this.dispatchEvent(new qat(\"drawabort\",t))}appendCoordinates(t){const e=this.mode_,i=!this.sketchFeature_;let n;if(i&&this.startDrawing_(t[0]),\"LineString\"===e||\"Circle\"===e)n=this.sketchCoords_;else{if(\"Polygon\"!==e)return;n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&n.shift(),n.pop();for(let r=0;r<t.length;r++)this.addToDrawing_(t[r]);const s=t[t.length-1];this.addToDrawing_(s),this.modifyDrawing_(s)}extend(t){const e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();const i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new l8(new WG(i)),this.updateSketchFeatures_(),this.dispatchEvent(new qat(\"drawstart\",this.sketchFeature_))}updateSketchFeatures_(){const t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);const e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)}updateState_(){const t=this.getMap(),e=this.getActive();(!t||!e)&&this.abortDrawing(),this.overlay_.setMap(e?t:null)}};function rlt(t){return t.feature?t.feature:t.element?t.element:void 0}const olt=[];var alt=class extends frt{constructor(t){const e=t=t||{};e.handleDownEvent||(e.handleDownEvent=bB),e.stopDown||(e.stopDown=yB),super(e),this.source_=t.source?t.source:null,this.vertex_=void 0===t.vertex||t.vertex,this.edge_=void 0===t.edge||t.edge,this.features_=t.features?t.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.rBush_=new Uot,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(t,e){e=void 0===e||e;const i=MB(t),n=t.getGeometry();if(n){const e=this.GEOMETRY_SEGMENTERS_[n.getType()];if(e){this.indexedFeaturesExtents_[i]=n.getExtent([1/0,1/0,-1/0,-1/0]);const s=[];if(e(s,n),1===s.length)this.rBush_.insert(rz(s[0]),{feature:t,segment:s[0]});else if(s.length>1){const e=s.map(t=>rz(t)),i=s.map(e=>({feature:t,segment:e}));this.rBush_.load(e,i)}}}e&&(this.featureChangeListenerKeys_[i]=KB(t,\"change\",this.handleFeatureChange_,this))}forEachFeatureAdd_(t){this.addFeature(t)}forEachFeatureRemove_(t){this.removeFeature(t)}getFeatures_(){let t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t}handleEvent(t){const e=this.snapTo(t.pixel,t.coordinate,t.map);return e&&(t.coordinate=e.vertex.slice(0,2),t.pixel=e.vertexPixel),super.handleEvent(t)}handleFeatureAdd_(t){const e=rlt(t);this.addFeature(e)}handleFeatureRemove_(t){const e=rlt(t);this.removeFeature(e)}handleFeatureChange_(t){const e=t.target;if(this.handlingDownUpSequence){const t=MB(e);t in this.pendingFeatures_||(this.pendingFeatures_[t]=e)}else this.updateFeature_(e)}handleUpEvent(t){const e=Object.values(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(t,e){const i=void 0===e||e,n=MB(t),s=this.indexedFeaturesExtents_[n];if(s){const e=this.rBush_,i=[];e.forEachInExtent(s,function(e){t===e.feature&&i.push(e)});for(let t=i.length-1;t>=0;--t)e.remove(i[t])}i&&(QB(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])}setMap(t){const e=this.getMap(),i=this.featuresListenerKeys_,n=this.getFeatures_();e&&(i.forEach(QB),i.length=0,n.forEach(this.forEachFeatureRemove_.bind(this))),super.setMap(t),t&&(this.features_?i.push(KB(this.features_,\"add\",this.handleFeatureAdd_,this),KB(this.features_,\"remove\",this.handleFeatureRemove_,this)):this.source_&&i.push(KB(this.source_,\"addfeature\",this.handleFeatureAdd_,this),KB(this.source_,\"removefeature\",this.handleFeatureRemove_,this)),n.forEach(this.forEachFeatureAdd_.bind(this)))}snapTo(t,e,i){const n=rz([i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),s=this.rBush_.getInExtent(n),r=s.length;if(0===r)return null;const o=i.getView().getProjection(),a=$V(e);let l,c=1/0;const h=this.pixelTolerance_*this.pixelTolerance_,u=()=>{if(l){const e=i.getPixelFromCoordinate(l);if(fV(t,e)<=h)return{vertex:l,vertexPixel:[Math.round(e[0]),Math.round(e[1])]}}return null};if(this.vertex_){for(let e=0;e<r;++e){const t=s[e];\"Circle\"!==t.feature.getGeometry().getType()&&t.segment.forEach(t=>{const e=$V(t),i=fV(a,e);i<c&&(l=t,c=i)})}const t=u();if(t)return t}if(this.edge_){for(let e=0;e<r;++e){let t=null;const i=s[e];if(\"Circle\"===i.feature.getGeometry().getType()){let e=i.feature.getGeometry();const n=zV();n&&(e=e.clone().transform(n,o)),t=VV(hV(a,e))}else{const[e,n]=i.segment;n&&(olt[0]=$V(e),olt[1]=$V(n),t=uV(a,olt))}if(t){const e=fV(a,t);e<c&&(l=t,c=e)}}const t=u();if(t)return t}return null}updateFeature_(t){this.removeFeature(t,!1),this.addFeature(t,!1)}segmentCircleGeometry_(t,e){const i=this.getMap().getView().getProjection();let n=e;const s=zV();s&&(n=n.clone().transform(s,i));const r=nW(n);s&&r.transform(i,s);const o=r.getCoordinates()[0];for(let a=0,l=o.length-1;a<l;++a)t.push(o.slice(a,a+2))}segmentGeometryCollectionGeometry_(t,e){const i=e.getGeometriesArray();for(let n=0;n<i.length;++n){const e=this.GEOMETRY_SEGMENTERS_[i[n].getType()];e&&e(t,i[n])}}segmentLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length-1;n<s;++n)t.push(i.slice(n,n+2))}segmentMultiLineStringGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const e=i[n];for(let i=0,n=e.length-1;i<n;++i)t.push(e.slice(i,i+2))}}segmentMultiPointGeometry_(t,e){e.getCoordinates().forEach(e=>{t.push([e])})}segmentMultiPolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const e=i[n];for(let i=0,n=e.length;i<n;++i){const n=e[i];for(let e=0,i=n.length-1;e<i;++e)t.push(n.slice(e,e+2))}}}segmentPointGeometry_(t,e){t.push([e.getCoordinates()])}segmentPolygonGeometry_(t,e){const i=e.getCoordinates();for(let n=0,s=i.length;n<s;++n){const e=i[n];for(let i=0,n=e.length-1;i<n;++i)t.push(e.slice(i,i+2))}}};function llt(t,e,i){e||(e=new p8([new tW([]),new WG(t[0])]));const n=e.getGeometries(),s=FV(t[0],i,\"EPSG:4326\"),r=vV(s,FV(t[1],i,\"EPSG:4326\")),o=eW(s,r,128);return o.transform(\"EPSG:4326\",i),n[0].setCoordinates(o.getCoordinates()),e.setGeometries(n),e.set(\"customGeom\",{type:\"Circle\",center:s,radius:r},!0),e}let clt=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.ngZone=t,this.annotationsService=e,this.interactionsService=i,this.mapService=n,this.mapStateService=s,this.tooltipsService=r,this.modifyCollection=new lrt,this.updatingGeomFromLayer=!1}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z80}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t}),this.annotationsService.annotations$.pipe(M(t=>t.filter(t=>t.visible))).subscribe(t=>{this.source.clear(!0),this.source.addFeatures(t.map(t=>new Pet(t)))}),JT([this.annotationsService.editedAnnotation$.pipe(M(t=>!!t),Tf()),this.annotationsService.editedAnnotationGeomType$]).pipe(pf(16)).subscribe(([t,e])=>{this.ngZone.runOutsideAngular(()=>{this.removeInteractions(),t&&this.createInteractions(e)})}),this.mapStateService.showAnnotationsLayer$.subscribe(t=>{this.layer.setVisible(t)})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}createInteractions(t){const e=this.annotationsService.editedAnnotation$.value;let i=this.source.forEachFeature(t=>{if(t.annotation.id===e.id)return t});i||(i=new Pet(e),this.source.addFeature(i)),i.setEditingStyle(),this.editedFeature=i,this.modifyCollection.clear(),this.modifyCollection.push(i);const n=this.map.getView().getProjection();this.modifyInteraction=new Hat({features:this.modifyCollection,style:t=>(t.get(\"features\").forEach(e=>{const i=e.get(\"modifyGeometry\");if(i){const s=t.getGeometry().getCoordinates(),r=e.getGeometry().getGeometries(),o=r[0].getCoordinates()[0],a=r[1].getCoordinates();let l,c,h;s[0]===a[0]&&s[1]===a[1]?(l=FV(o[0],n,\"EPSG:4326\"),c=FV(o[(o.length-1)/2],n,\"EPSG:4326\"),h=vV(l,c)/2):(l=FV(a,n,\"EPSG:4326\"),c=FV(s,n,\"EPSG:4326\"),h=vV(l,c));const u=eW(FV(a,n,\"EPSG:4326\"),h,128);u.transform(\"EPSG:4326\",n),r[0].setCoordinates(u.getCoordinates()),i.setGeometries(r),i.set(\"customGeom\",{type:\"Circle\",center:FV(a,n,\"EPSG:4326\"),radius:h},!0)}}),Eet),condition:krt}),this.map.addInteraction(this.modifyInteraction),this.modifyInteraction.on(\"modifystart\",t=>{t.features.forEach(function(t){const e=t.getGeometry();\"GeometryCollection\"===e.getType()&&t.set(\"modifyGeometry\",e.clone(),!0)})}),this.modifyInteraction.on(\"modifyend\",function(t){t.features.forEach(function(t){const e=t.get(\"modifyGeometry\");e&&(t.setGeometry(e),t.unset(\"modifyGeometry\",!0))})});const s=new lrt;this.drawInteraction=new slt({type:t,features:s,style:Eet,geometryFunction:\"Circle\"===t?llt:null,condition:krt}),this.map.addInteraction(this.drawInteraction),this.snapInteraction=new alt({features:this.modifyCollection,pixelTolerance:20}),this.map.addInteraction(this.snapInteraction),this.drawInteraction.on(\"drawstart\",t=>{sB({category:\"app\",message:\"annotation: drawstart\"}),this.modifyInteraction.setActive(!1),this.editedFeature.setGeometry(t.feature.getGeometry()),this.editedFeature.setEditingStyle(),this.updateEditedAnnotationGeometry(null)}),this.drawInteraction.on(\"drawend\",t=>{var e;sB({category:\"app\",message:\"annotation: drawend\"}),this.modifyInteraction.setActive(!0),this.updateEditedAnnotationGeometry(null===(e=t.feature)||void 0===e?void 0:e.getGeometry())}),this.drawInteraction.on(\"drawabort\",t=>{this.modifyInteraction.setActive(!0)}),this.modifyInteraction.on(\"modifyend\",t=>{var e;sB({category:\"app\",message:\"annotation: modifyend\"}),this.updateEditedAnnotationGeometry(null===(e=t.features.pop())||void 0===e?void 0:e.getGeometry())}),this.annotationsService.editedAnnotation$.pipe(kf(1),Qg(t=>!!t),M(t=>t.color),Tf()).subscribe(t=>{this.editedFeature.updateColor(t)}),this.annotationsService.editedAnnotation$.pipe(kf(1),Qg(t=>!!t),M(t=>t.name),Tf()).subscribe(t=>{this.editedFeature.updateName(t)}),this.annotationsService.editedAnnotation$.pipe(kf(1),Qg(t=>!!t),M(t=>t.geom),Tf(),Af(t=>!this.updatingGeomFromLayer&&\"Circle\"!==(null==t?void 0:t.type))).subscribe(t=>{this.editedFeature.setGeometry(yet.readGeometry(t)),this.editedFeature.setEditingStyle()})}updateEditedAnnotationGeometry(t){var e;this.updatingGeomFromLayer=!0,this.annotationsService.updateEditedAnnotationGeom(t?null!==(e=t.get(\"customGeom\"))&&void 0!==e?e:yet.writeGeometryObject(t):null),this.updatingGeomFromLayer=!1}removeInteractions(){this.editedFeature&&(this.editedFeature=null),this.drawInteraction&&this.map.removeInteraction(this.drawInteraction),this.modifyInteraction&&this.map.removeInteraction(this.modifyInteraction),this.snapInteraction&&this.map.removeInteraction(this.snapInteraction)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(NH.Annotation,t.annotation),!0),{layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,e=>{const[i,n]=OV(t.coordinate);return e.annotation.lon=i,e.annotation.lat=n,this.tooltipsService.hoverEntity(NH.Annotation,e.annotation),!0},{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(NH.Annotation,null))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(BH),Oa(DY),Oa(Pj),Oa(Fq),Oa(RY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-annotations-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();var hlt=class extends Zrt{constructor(t){super(t),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],i=t.pixelRatio,n=t.viewState,s=n.resolution,r=this.getLayer().getSource(),o=t.viewHints;let a=t.extent;if(void 0!==e.extent&&(a=Pz(a,jV(e.extent))),!o[0]&&!o[1]&&!Fz(a))if(r){const t=r.getImage(a,s,i,n.projection);t&&(this.loadImage(t)?this.image_=t:4===t.getState()&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=pG(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!cz(s,n))return null;const r=this.image_.getExtent(),o=this.image_.getImage(),a=Dz(r),l=Math.floor(o.width*((n[0]-r[0])/a));if(l<0||l>=o.width)return null;const c=Iz(r),h=Math.floor(o.height*((r[3]-n[1])/c));return h<0||h>=o.height?null:this.getImageData(o,l,h)}renderFrame(t,e){const i=this.image_,n=i.getExtent(),s=i.getResolution(),r=i.getPixelRatio(),o=t.layerStatesArray[t.layerIndex],a=t.pixelRatio,l=t.viewState,c=l.center,h=a*s/(l.resolution*r),u=t.extent,d=l.resolution,p=l.rotation,f=Math.round(Dz(u)/d*a),m=Math.round(Iz(u)/d*a);mG(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,p,-f/2,-m/2),gG(this.inversePixelTransform,this.pixelTransform);const g=vG(this.pixelTransform);this.useContainer(e,g,this.getBackground(t));const A=this.context,v=A.canvas;v.width!=f||v.height!=m?(v.width=f,v.height=m):this.containerReused||A.clearRect(0,0,f,m);let _=!1,b=!0;if(o.extent){const e=jV(o.extent);b=Lz(e,t.extent),_=b&&!hz(e,t.extent),_&&this.clipUnrotated(A,t,e)}const y=i.getImage(),w=mG(this.tempTransform,f/2,m/2,h,h,0,r*(n[0]-c[0])/s,r*(c[1]-n[3])/s);this.renderedResolution=s*a/r;const x=y.width*w[0],S=y.height*w[3];if(this.getLayer().getSource().getInterpolate()||(A.imageSmoothingEnabled=!1),this.preRender(A,t),b&&x>=.5&&S>=.5){const t=w[4],e=w[5],i=o.opacity;let n;1!==i&&(n=A.globalAlpha,A.globalAlpha=i),A.drawImage(y,0,0,+y.width,+y.height,t,e,x,S),1!==i&&(A.globalAlpha=n)}return this.postRender(A,t),_&&A.restore(),A.imageSmoothingEnabled=!0,g!==v.style.transform&&(v.style.transform=g),this.container}},ult=class extends CB{constructor(t,e,i,n){super(),this.extent=t,this.pixelRatio_=i,this.resolution=e,this.state=n}changed(){this.dispatchEvent(\"change\")}getExtent(){return this.extent}getImage(){return kB()}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){kB()}},dlt=class extends ult{constructor(t,e,i,n,s){super(t,e,i,void 0!==s?0:2),this.loader_=void 0!==s?s:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=3):this.state=2,this.changed()}load(){0==this.state&&(this.state=1,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}},plt=class extends hlt{constructor(t){super(t),this.vectorRenderer_=new Iat(t),this.layerImageRatio_=t.getImageRatio(),this.coordinateToVectorPixelTransform_=[1,0,0,1,0,0],this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(t){if(!this.vectorRenderer_)return new Promise(t=>t([]));const e=pG(this.coordinateToVectorPixelTransform_,pG(this.renderedPixelToCoordinateTransform_,t.slice()));return this.vectorRenderer_.getFeatures(e)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(t){const e=t.pixelRatio,i=t.viewState,n=i.resolution,s=t.viewHints,r=this.vectorRenderer_;let o=t.extent;1!==this.layerImageRatio_&&(o=o.slice(0),function(t,e){const i=(t[2]-t[0])/2*(e-1),n=(t[3]-t[1])/2*(e-1);t[0]-=i,t[2]+=i,t[1]-=n,t[3]+=n}(o,this.layerImageRatio_));const a=Dz(o)/n,l=Iz(o)/n;if(!s[0]&&!s[1]&&!Fz(o)){r.useContainer(null,null);const s=r.context,c=t.layerStatesArray[t.layerIndex];s.globalAlpha=c.opacity;const h=Object.assign({},c,{opacity:1}),u=Object.assign({},t,{declutterTree:new $ot(9),extent:o,size:[a,l],viewState:Object.assign({},t.viewState,{rotation:0}),layerStatesArray:[h],layerIndex:0});let d=!0;const p=new dlt(o,n,e,s.canvas,function(t){r.prepareFrame(u)&&r.replayGroupChanged&&(r.clipping=!1,r.renderFrame(u,null)&&(r.renderDeclutter(u),d=!1),t())});p.addEventListener(\"change\",(function(){if(2!==p.getState())return;this.image_=d?null:p;const t=p.getResolution(),n=p.getPixelRatio(),s=t*e/n;this.renderedResolution=s,this.coordinateToVectorPixelTransform_=mG(this.coordinateToVectorPixelTransform_,a/2,l/2,1/s,-1/s,0,-i.center[0],-i.center[1])}).bind(this)),p.load()}return this.image_&&(this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice()),!!this.image_}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(t,e,i,n,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,i,n,s):super.forEachFeatureAtCoordinate(t,e,i,n,s)}},flt=class extends Yot{constructor(t){t=t||{};const e=Object.assign({},t);delete e.imageRatio,super(e),this.imageRatio_=void 0!==t.imageRatio?t.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new plt(this)}};class mlt extends l8{constructor(t){super(),this.updateH3Index(t)}updateH3Index(t){this.h3index=t,super.setGeometry(oW(t))}}const glt=new S7({stroke:new U8({color:\"#cc0000\",width:1}),fill:new h8({color:\"#ff00001a\"})}),Alt=new S7({stroke:new U8({color:\"#ff0000\",width:1}),fill:new h8({color:\"#ff00004a\"})}),vlt=[\"#F1C40F\",\"#27AE60\",\"#9B59B6\",\"#3498DB\",\"#E74C3C\",\"#1ABC9C\",\"#E67E22\",\"#16A085\",\"#C0392B\",\"#8E44AD\",\"#2980B9\",\"#F39C12\",\"#2ECC71\",\"#D35400\"],_lt={1:1,2:1,3:1,4:2,5:3,6:3,7:4,8:5,9:5,10:6,11:7,12:7,13:8,14:8,15:9,16:9,17:10,18:11,19:12,20:12,21:12},blt={1:0,2:0,3:0,4:1,5:2,6:2,7:3,8:4,9:4,10:5,11:6,12:7,13:7,14:8,15:9,16:9,17:10,18:10,19:10,20:10,21:10},ylt=vlt.map(t=>new S7({stroke:new U8({color:t,width:1}),fill:new h8({color:\"rgba(0, 0, 255, 0)\"})}));let wlt=(()=>{class t extends Gq{constructor(t,e,i,n,s){super(),this.configService=t,this.drawingService=e,this.mapConfigService=i,this.mapService=n,this.mapStateService=s}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new flt({source:this.source,zIndex:Cot.z20}),this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.selectableHexagons$.subscribe(t=>{this.layer.selectable=t,!t&&this.hoveredHexagonFeature&&(this.hoveredHexagonFeature.setStyle(ylt[this.hexagonsResolution()]),this.hoveredHexagonFeature=null)}),this.mapStateService.showHexagonsLayer$.subscribe(t=>{this.layer.setVisible(t)}),JT([this.mapStateService.showHexagonsLayer$,this.mapService.view$]).pipe(kf(1),Af(([t,e])=>t&&!!e),pf(200)).subscribe(([t,e])=>this.refreshFeatures(e)),this.mapService.pointerMove$.pipe(Af(()=>this.layer.selectable)).subscribe(t=>{this.handleMoveEvent(t)})),this.eventListeners.push(this.map.on(\"click\",t=>this.handleClickEvent(t)))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}refreshFeatures(t){this.source.clear(!0);let e=this.hexagonsResolution();const i=MU.fromOLExtent(t.extent).scale(1.2);let n=this.generateFeatures(i,e);n.forEach(t=>{t.setStyle(ylt[e])}),this.source.addFeatures(n),this.mapConfigService.debugH3Trace$.value&&(e-=1,e>=1&&(n=this.generateFeatures(i,e),n.forEach(t=>{t.setStyle(ylt[e])}),this.source.addFeatures(n)),e-=1,e>=1&&(n=this.generateFeatures(i,e),n.forEach(t=>{t.setStyle(ylt[e])}),this.source.addFeatures(n)))}generateFeatures(t,e){return t.getBoundedPolygons().map(t=>wj(t,e,!0)).flat().map(t=>new mlt(t))}hexagonsResolution(){return(this.mapConfigService.highHexagonsResolution$.value?_lt:blt)[Math.round(this.map.getView().getZoom())]}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select hexagon\",t.h3index),this.drawingService.selectHexagon(t.h3index),!0),{layerFilter:t=>t===this.layer})}handleMoveEvent(t){const e=this.map.forEachFeatureAtPixel(t.pixel,t=>t,{layerFilter:t=>t===this.layer});e?e!==this.hoveredHexagonFeature&&(this.hoveredHexagonFeature&&this.hoveredHexagonFeature.setStyle(ylt[this.hexagonsResolution()]),e.setStyle(Alt),this.hoveredHexagonFeature=e):this.hoveredHexagonFeature&&(this.hoveredHexagonFeature.setStyle(ylt[this.hexagonsResolution()]),this.hoveredHexagonFeature=null)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(WU),Oa(zH),Oa(qU),Oa(Pj),Oa(Fq))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-hexagons-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class xlt extends l8{constructor(t){super(),this.edgeGroup=t,this.setGeometry(new tW(this.edgeGroup.edges.map(t=>lW(t).map(t=>PV(t))))),this.setStyle(new S7({stroke:new U8({color:this.edgeGroup.color,width:1}),fill:new h8({color:`${this.edgeGroup.color}9f`})}))}}const Slt=new U8({color:\"#ff0000aa\",width:4});class Clt extends l8{constructor(t,e){super(),this.h3index=t,this.color=e,this.setId(t),this.setGeometry(new tW([lW(t).map(t=>PV(t))])),this.resetStyle()}resetStyle(){this.setStyle(this.color?new S7({stroke:new U8({color:this.color,width:1}),fill:new h8({color:`${this.color}9f`})}):ylt[function(t){return parseInt(t.charAt(2),16)}(this.h3index)])}enableHighlightedStyle(){const t=[Alt,new S7({stroke:new U8({color:this.color,width:1}),fill:new h8({color:`${this.color}9f`})})],[e,i]=kj(this.h3index),n=new D8([PV(BU(_j(e))),PV(BU(_j(i)))]);n.applyTransform(t=>(Object.assign(t,function(t,e){if(4!==t.length)throw new Error(`Invalid line length. Expected 4, got ${t.length}`);const i=(t[2]-t[0])/2,n=(t[3]-t[1])/2,s=t[0]+i,r=t[1]+n;return[s-e*i,r-e*n,s+e*i,r+e*n]}(t,.5)),null)),t.push(new S7({geometry:n,stroke:Slt})),n.forEachSegment((e,i)=>{const n=i[0]-e[0],s=i[1]-e[1],r=Math.sqrt(n*n+s*s)/8,o=Math.atan2(s,n),a=new D8([i,[i[0]-1.5*r,i[1]+r]]);a.rotate(o,i);const l=new D8([i,[i[0]-1.5*r,i[1]-r]]);l.rotate(o,i),t.push(new S7({geometry:a,stroke:Slt})),t.push(new S7({geometry:l,stroke:Slt}))}),this.setStyle(t)}}const klt=sG.concat(sG,sG,sG,sG),Elt=Array(klt.length).fill(!0);function Mlt(t){const e=klt.findIndex(e=>e===t);Elt[e]=!0}class Tlt{constructor(t,e){this.edges=t,this.color=null!=e?e:function(){const t=Elt.findIndex(t=>t);return Elt[t]=!1,klt[t]}()}contains(t){return this.edges.includes(t)}remove(t){const e=this.edges.indexOf(t);if(-1!==e)return this.edges.splice(e,1);throw new Error(\"group cannot remove missing index\"+t)}shouldSplit(){const t=[new Tlt([this.edges[0]],this.color)];if(this.edges.slice(1).forEach(e=>{t.some(t=>t.addIfLinked(e))||t.push(new Tlt([e]))}),t.length>=2){let e=!1;for(;!e;){const i=hW(t.map(t=>t.edges.map(t=>Ej(t,!0)).flat()));i&&(t[i[0]].merge(t[i[1]]),Mlt(t.splice(i[1],1)[0].color)),e=!i}}return t.length>1&&t}addIfLinked(t){const e=Ej(t,!0),i=this.edges.map(t=>Ej(t,!0)).flat().some(t=>e.some(e=>zU(e,t)));return i&&this.edges.push(t),i}merge(t){this.edges.push(...t.edges)}}let Ilt=(()=>{class t{constructor(t){this.workerService=t,this.selectedEdgeGroups$=new Jp([]),this.searchQuery$=new Jp(null),this.searchResult$=new Jp(null)}toggleEdge(t){const e=this.selectedEdgeGroups$.value,i=e.findIndex(e=>e.contains(t));let n=null;if(-1!==i){const s=e[i];if(s.remove(t),0===s.edges.length)n=e.splice(i,1)[0];else if(s.edges.length>=2){const t=s.shouldSplit();t&&e.splice(i,1,...t)}}else if(e.some(e=>e.addIfLinked(t))){const t=hW(e.map(t=>t.edges.map(t=>Ej(t,!0)).flat()));t&&(e[t[0]].merge(e[t[1]]),n=e.splice(t[1],1)[0])}else e.push(new Tlt([t]));n&&Mlt(n.color),this.selectedEdgeGroups$.next(e)}resetEdgeGroups(){this.selectedEdgeGroups$.next([])}search(t){return Hp(this,void 0,void 0,function*(){this.searchResult$.next(null),this.searchResult$.next({query:uU(t),results:yield this.workerService.ships.searchForShipsPassages(this.selectedEdgeGroups$.value,_q(t.interval.start),_q(t.interval.end)+mq)})})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(sH))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Plt=(()=>{class t extends Gq{constructor(t,e,i,n){super(),this.configService=t,this.mapService=e,this.mapStateService=i,this.movesService=n}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.gridSource=new Fat({features:[]}),this.gridLayer=new flt({source:this.gridSource,zIndex:Cot.z80}),this.map.addLayer(this.gridLayer),this.gridLayer.selectable=!0,this.selectionSource=new Fat({features:[]}),this.selectionLayer=new flt({source:this.selectionSource,zIndex:Cot.z80}),this.map.addLayer(this.selectionLayer),this.subscriptions.push(this.movesService.selectedEdgeGroups$.subscribe(t=>{this.refreshSelectedEdgeGroupsFeatures(t)}),this.mapStateService.showEdgesLayer$.subscribe(t=>{this.gridLayer.setVisible(t)}),JT([this.mapStateService.showEdgesLayer$,this.mapService.view$]).pipe(kf(1),Af(([t,e])=>t&&!!e),pf(200)).subscribe(([t,e])=>this.refreshGridFeatures(e)),this.mapService.pointerMove$.pipe(Af(()=>this.gridLayer.getVisible())).subscribe(t=>{this.handleMoveEvent(t)})),this.eventListeners.push(this.map.on(\"click\",t=>this.handleClickEvent(t)))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.gridLayer),this.map.removeLayer(this.selectionLayer)}refreshGridFeatures(t){this.gridSource.clear(!0);const e=MU.fromOLExtent(t.extent).scale(t.zoom<=5?1.1:t.zoom<=9?1.5:2);let i=this.edgesResolution();const n=[this.generateFeatures(e,i)];i-=1,i>=1&&n.push(this.generateFeatures(e,i)),i-=1,i>=1&&t.zoom<8&&n.push(this.generateFeatures(e,i)),this.gridSource.addFeatures(n.flat())}refreshSelectedEdgeGroupsFeatures(t){this.selectionSource.clear(!0),this.selectionSource.addFeatures(t.map(t=>new xlt(t)))}generateFeatures(t,e){return t.getBoundedPolygons().map(t=>wj(t,e,!0)).flat().map(t=>function(t){var e=rj(t),i=e[0],n=e[1],s=KU._calloc(6,JU);QU.getH3UnidirectionalEdgesFromHexagon(i,n,s);var r=pj(s,6);return KU._free(s),r}(t)).flat().filter(t=>{const e=xj(t),i=Sj(t),n=vj(e),s=yj(e,n-1),r=yj(i,n-1);return 2===n||n>2&&s===r}).map(t=>new Clt(t))}edgesResolution(){return Math.min(_lt[Math.round(this.map.getView().getZoom())],6)}handleClickEvent(t){this.gridLayer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select h3 edge\",t.h3index),this.movesService.toggleEdge(t.h3index),!0),{layerFilter:t=>t===this.gridLayer})}handleMoveEvent(t){const e=this.map.forEachFeatureAtPixel(t.pixel,t=>t,{layerFilter:t=>t===this.gridLayer});e?e!==this.hoveredEdgeFeature&&(this.hoveredEdgeFeature&&this.hoveredEdgeFeature.resetStyle(),e.enableHighlightedStyle(),this.hoveredEdgeFeature=e):this.hoveredEdgeFeature&&(this.hoveredEdgeFeature.resetStyle(),this.hoveredEdgeFeature=null)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(WU),Oa(Pj),Oa(Fq),Oa(Ilt))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-edges-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class Olt extends l8{constructor(t){super({geometry:new V8(t.h3indexes.map(t=>oW(t)))}),this.zone=t}}const Rlt=sG.map(t=>new S7({stroke:new U8({color:t,width:1}),fill:new h8({color:`${t}1a`})})),Dlt=new S7({text:new k7({font:\"12px Calibri,sans-serif\",fill:new h8({color:\"#000\"}),stroke:new U8({color:\"#fff\",width:3})})});let Llt=(()=>{class t extends Gq{constructor(t){super(),this.zonesLayerService=t}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z40}),this.map.addLayer(this.layer),this.subscriptions.push(this.zonesLayerService.zones$.subscribe(t=>{this.source.clear(!0),this.source.addFeatures(t.map((t,e)=>{const i=new Olt(t);return i.setStyle(function(){return Dlt.getText().setText(t.name),[Rlt[e%Rlt.length],Dlt]}),i}))}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(LY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-zones-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();const Flt=34962,Nlt=[\"experimental-webgl\",\"webgl\",\"webkit-3d\",\"moz-webgl\"];function Blt(t,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!FB},e);const i=Nlt.length;for(let s=0;s<i;++s)try{const i=t.getContext(Nlt[s],e);if(i)return i}catch(n){}return null}function zlt(t){switch(t){case Flt:return Float32Array;case 34963:return Uint32Array;default:return Float32Array}}var Vlt=class{constructor(t,e){this.array=null,this.type=t,sz(t===Flt||34963===t,62),this.usage=void 0!==e?e:35044}ofSize(t){this.array=new(zlt(this.type))(t)}fromArray(t){this.array=zlt(this.type).from(t)}fromArrayBuffer(t){this.array=new(zlt(this.type))(t)}getType(){return this.type}getArray(){return this.array}getUsage(){return this.usage}getSize(){return this.array?this.array.length:0}},$lt=class{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer();const i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,t.vertexShader||\"\\n  precision mediump float;\\n  \\n  attribute vec2 a_position;\\n  varying vec2 v_texCoord;\\n  varying vec2 v_screenCoord;\\n  \\n  uniform vec2 u_screenSize;\\n   \\n  void main() {\\n    v_texCoord = a_position * 0.5 + 0.5;\\n    v_screenCoord = v_texCoord * u_screenSize;\\n    gl_Position = vec4(a_position, 0.0, 1.0);\\n  }\\n\"),e.compileShader(i);const n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t.fragmentShader||\"\\n  precision mediump float;\\n   \\n  uniform sampler2D u_image;\\n  uniform float u_opacity;\\n   \\n  varying vec2 v_texCoord;\\n   \\n  void main() {\\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\\n  }\\n\"),e.compileShader(n),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,i),e.attachShader(this.renderTargetProgram_,n),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,\"a_position\"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,\"u_screenSize\"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,\"u_opacity\"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,\"u_image\"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach((function(i){this.uniforms_.push({value:t.uniforms[i],location:e.getUniformLocation(this.renderTargetProgram_,i)})}).bind(this))}getGL(){return this.gl_}init(t){const e=this.getGL(),i=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.viewport(0,0,i[0],i[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==i[0]||this.renderTargetTextureSize_[1]!==i[1]){this.renderTargetTextureSize_=i;const t=0,n=e.RGBA,s=0,r=e.RGBA,o=e.UNSIGNED_BYTE,a=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,t,n,i[0],i[1],s,r,o,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}}apply(t,e,i,n){const s=this.getGL(),r=t.size;if(s.bindFramebuffer(s.FRAMEBUFFER,e?e.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!e){const e=MB(s.canvas);if(!t.renderTargets[e]){const i=s.getContextAttributes();i&&i.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT)),t.renderTargets[e]=!0}}s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,r[0],r[1]),s.uniform1i(this.renderTargetTextureLocation_,0),s.uniform1f(this.renderTargetOpacityLocation_,t.layerStatesArray[t.layerIndex].opacity),this.applyUniforms(t),i&&i(s,t),s.drawArrays(s.TRIANGLES,0,6),n&&n(s,t)}getFrameBuffer(){return this.frameBuffer_}applyUniforms(t){const e=this.getGL();let i,n=1;this.uniforms_.forEach(function(s){if(i=\"function\"==typeof s.value?s.value(t):s.value,i instanceof HTMLCanvasElement||i instanceof ImageData)s.texture||(s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${n}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,i.width,i.height,0,e.UNSIGNED_BYTE,new Uint8Array(i.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.uniform1i(s.location,n++);else if(Array.isArray(i))switch(i.length){case 2:return void e.uniform2f(s.location,i[0],i[1]);case 3:return void e.uniform3f(s.location,i[0],i[1],i[2]);case 4:return void e.uniform4f(s.location,i[0],i[1],i[2],i[3]);default:return}else\"number\"==typeof i&&e.uniform1f(s.location,i)})}};function Ult(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}const jlt={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},Hlt={};function Glt(t){return\"shared/\"+t}let Wlt=0;function qlt(t){switch(t){case jlt.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case jlt.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case jlt.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case jlt.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var Ylt=class extends pB{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?Glt(t.canvasCacheKey):function(){const t=\"unique/\"+Wlt;return Wlt+=1,t}(),this.canvas_=function(t){let e=Hlt[t];if(!e){const i=document.createElement(\"canvas\");i.style.position=\"absolute\",i.style.left=\"0\",e={users:0,canvas:i},Hlt[t]=e}return e.users+=1,e.canvas}(this.canvasCacheKey_),this.gl_=Blt(this.canvas_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.canvas_.addEventListener(\"webglcontextlost\",this.boundHandleWebGLContextLost_),this.canvas_.addEventListener(\"webglcontextrestored\",this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=[1,0,0,1,0,0],this.offsetScaleMatrix_=[1,0,0,1,0,0],this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.uniformLocations_={},this.attribLocations_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms);const e=this.getGL();this.postProcessPasses_=t.postProcesses?t.postProcesses.map(function(t){return new $lt({webGlContext:e,scaleRatio:t.scaleRatio,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms})}):[new $lt({webGlContext:e})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(t){this.uniforms_=[];for(const e in t)this.uniforms_.push({name:e,value:t[e]});this.uniformLocations_={}}canvasCacheKeyMatches(t){return this.canvasCacheKey_===Glt(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.getGL(),i=MB(t);let n=this.bufferCache_[i];n||(n={buffer:t,webGlBuffer:e.createBuffer()},this.bufferCache_[i]=n),e.bindBuffer(t.getType(),n.webGlBuffer)}flushBufferData(t){const e=this.getGL();this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=this.getGL(),i=MB(t),n=this.bufferCache_[i];n&&!e.isContextLost()&&e.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[i]}disposeInternal(){this.canvas_.removeEventListener(\"webglcontextlost\",this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(\"webglcontextrestored\",this.boundHandleWebGLContextRestored_),function(t){const e=Hlt[t];if(!e||(e.users-=1,e.users>0))return;const i=Blt(e.canvas).getExtension(\"WEBGL_lose_context\");i&&i.loseContext(),delete Hlt[t]}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_}prepareDraw(t,e){const i=this.getGL(),n=this.getCanvas(),s=t.size,r=t.pixelRatio;n.width=s[0]*r,n.height=s[1]*r,n.style.width=s[0]+\"px\",n.style.height=s[1]+\"px\";for(let o=this.postProcessPasses_.length-1;o>=0;o--)this.postProcessPasses_[o].init(t);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,e?i.ZERO:i.ONE_MINUS_SRC_ALPHA)}prepareDrawToRenderTarget(t,e,i){const n=this.getGL(),s=e.getSize();n.bindFramebuffer(n.FRAMEBUFFER,e.getFramebuffer()),n.viewport(0,0,s[0],s[1]),n.bindTexture(n.TEXTURE_2D,e.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,i?n.ZERO:n.ONE_MINUS_SRC_ALPHA)}drawElements(t,e){const i=this.getGL();this.getExtension(\"OES_element_index_uint\"),i.drawElements(i.TRIANGLES,e-t,i.UNSIGNED_INT,4*t)}finalizeDraw(t,e,i){for(let n=0,s=this.postProcessPasses_.length;n<s;n++)n===s-1?this.postProcessPasses_[n].apply(t,null,e,i):this.postProcessPasses_[n].apply(t,this.postProcessPasses_[n+1])}getCanvas(){return this.canvas_}getGL(){return this.gl_}applyFrameState(t){const e=t.size,i=t.viewState.rotation,n=t.pixelRatio,s=hG(this.offsetScaleMatrix_);!function(t,e,i){uG(t,dG(cG,e,0,0,i,0,0))}(s,2/e[0],2/e[1]);const r=hG(this.offsetRotateMatrix_);0!==i&&function(t,e){const i=Math.cos(e),n=Math.sin(e);uG(t,dG(cG,i,n,-n,i,0,0))}(r,-i),this.setUniformMatrixValue(\"u_offsetScaleMatrix\",Ult(this.tmpMat4_,s)),this.setUniformMatrixValue(\"u_offsetRotateMatrix\",Ult(this.tmpMat4_,r)),this.setUniformFloatValue(\"u_time\",.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(\"u_zoom\",t.viewState.zoom),this.setUniformFloatValue(\"u_resolution\",t.viewState.resolution),this.setUniformFloatValue(\"u_pixelRatio\",n),this.setUniformFloatVec2(\"u_sizePx\",[e[0],e[1]])}applyUniforms(t){const e=this.getGL();let i,n=0;this.uniforms_.forEach((function(s){if(i=\"function\"==typeof s.value?s.value(t):s.value,i instanceof HTMLCanvasElement||i instanceof HTMLImageElement||i instanceof ImageData)s.texture||(s.prevValue=void 0,s.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${n}`]),e.bindTexture(e.TEXTURE_2D,s.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),(!(i instanceof HTMLImageElement)||i.complete)&&s.prevValue!==i&&(s.prevValue=i,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)),e.uniform1i(this.getUniformLocation(s.name),n++);else if(Array.isArray(i)&&6===i.length)this.setUniformMatrixValue(s.name,Ult(this.tmpMat4_,i));else if(Array.isArray(i)&&i.length<=4)switch(i.length){case 2:return void e.uniform2f(this.getUniformLocation(s.name),i[0],i[1]);case 3:return void e.uniform3f(this.getUniformLocation(s.name),i[0],i[1],i[2]);case 4:return void e.uniform4f(this.getUniformLocation(s.name),i[0],i[1],i[2],i[3]);default:return}else\"number\"==typeof i&&e.uniform1f(this.getUniformLocation(s.name),i)}).bind(this))}useProgram(t,e){this.getGL().useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},this.applyFrameState(e),this.applyUniforms(e)}compileShader(t,e){const i=this.getGL(),n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}getProgram(t,e){const i=this.getGL(),n=this.compileShader(t,i.FRAGMENT_SHADER),s=this.compileShader(e,i.VERTEX_SHADER),r=i.createProgram();if(i.attachShader(r,n),i.attachShader(r,s),i.linkProgram(r),!i.getShaderParameter(n,i.COMPILE_STATUS)){const t=`Fragment shader compliation failed: ${i.getShaderInfoLog(n)}`;throw new Error(t)}if(i.deleteShader(n),!i.getShaderParameter(s,i.COMPILE_STATUS)){const t=`Vertex shader compilation failed: ${i.getShaderInfoLog(s)}`;throw new Error(t)}if(i.deleteShader(s),!i.getProgramParameter(r,i.LINK_STATUS)){const t=`GL program linking failed: ${i.getShaderInfoLog(s)}`;throw new Error(t)}return r}getUniformLocation(t){return void 0===this.uniformLocations_[t]&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]}getAttributeLocation(t){return void 0===this.attribLocations_[t]&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]}makeProjectionTransform(t,e){const i=t.size,n=t.viewState.rotation,s=t.viewState.resolution,r=t.viewState.center;return hG(e),mG(e,0,0,2/(s*i[0]),2/(s*i[1]),-n,-r[0],-r[1]),e}setUniformFloatValue(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.getGL().uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.getGL().uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)}enableAttributeArray_(t,e,i,n,s){const r=this.getAttributeLocation(t);r<0||(this.getGL().enableVertexAttribArray(r),this.getGL().vertexAttribPointer(r,e,i,!1,n,s))}enableAttributes(t){const e=function(t){let e=0;for(let i=0;i<t.length;i++){const n=t[i];e+=n.size*qlt(n.type)}return e}(t);let i=0;for(let n=0;n<t.length;n++){const s=t[n];this.enableAttributeArray_(s.name,s.size,s.type||5126,e,i),i+=s.size*qlt(s.type)}}handleWebGLContextLost(){xB(this.bufferCache_),this.currentProgram_=null}handleWebGLContextRestored(){}createTexture(t,e,i){const n=this.getGL();i=i||n.createTexture();const s=n.RGBA,r=n.RGBA,o=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,i),e?n.texImage2D(n.TEXTURE_2D,0,s,r,o,e):n.texImage2D(n.TEXTURE_2D,0,s,t[0],t[1],0,r,o,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),i}};class Zlt extends Grt{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=[1,0,0,1,0,0],this.pixelContext_=null,this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,t.addChangeListener(\"map\",this.removeHelper.bind(this)),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(\"precompose\")){const n=new Wrt(\"precompose\",void 0,e,t);i.dispatchEvent(n)}}dispatchPostComposeEvent(t,e){const i=this.getLayer();if(i.hasListener(\"postcompose\")){const n=new Wrt(\"postcompose\",void 0,e,t);i.dispatchEvent(n)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e,i=!0,n=-1;for(let r=0,o=t.layerStatesArray.length;r<o;r++){const s=t.layerStatesArray[r].layer,o=s.getRenderer();if(!(o instanceof Zlt)){i=!0;continue}const a=s.getClassName();if((i||a!==e)&&(n+=1,i=!1),e=a,o===this)break}const s=\"map/\"+t.mapId+\"/group/\"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s))&&(this.removeHelper(),this.helper=new Ylt({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),e&&(this.helper.getCanvas().className=e),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}disposeInternal(){this.removeHelper(),super.disposeInternal()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){mG(this.inversePixelTransform_,0,0,i.pixelRatio,-i.pixelRatio,0,0,-i.size[1]);const s=new Wrt(t,this.inversePixelTransform_,i,e);n.dispatchEvent(s)}}preRender(t,e){this.dispatchRenderEvent_(\"prerender\",t,e)}postRender(t,e){this.dispatchRenderEvent_(\"postrender\",t,e)}}var Klt=Zlt;const Xlt=new Uint8Array(4);function Qlt(t,e){const i=256,n=255;return(e=e||[])[0]=Math.floor(t/i/i/i)/n,e[1]=Math.floor(t/i/i)%i/n,e[2]=Math.floor(t/i)%i/n,e[3]=t%i/n,e}i(9205);var Jlt=class extends Klt{constructor(t,e){const i=e.uniforms||{},n=[1,0,0,1,0,0];i.u_projectionMatrix=n,super(t,{uniforms:i,postProcesses:e.postProcesses}),this.ready=!1,this.sourceRevision_=-1,this.verticesBuffer_=new Vlt(Flt,35048),this.hitVerticesBuffer_=new Vlt(Flt,35048),this.indicesBuffer_=new Vlt(34963,35048),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.hitDetectionEnabled_=!(!e.hitFragmentShader||!e.hitVertexShader),this.hitVertexShader_=e.hitVertexShader,this.hitFragmentShader_=e.hitFragmentShader;const s=e.attributes?e.attributes.map(function(t){return{name:\"a_\"+t.name,size:1,type:jlt.FLOAT}}):[];this.attributes=[{name:\"a_position\",size:2,type:jlt.FLOAT},{name:\"a_index\",size:1,type:jlt.FLOAT}].concat(s),this.hitDetectionAttributes=[{name:\"a_position\",size:2,type:jlt.FLOAT},{name:\"a_index\",size:1,type:jlt.FLOAT},{name:\"a_hitColor\",size:4,type:jlt.FLOAT},{name:\"a_featureUid\",size:1,type:jlt.FLOAT}].concat(s),this.customAttributes=e.attributes?e.attributes:[],this.previousExtent_=[1/0,1/0,-1/0,-1/0],this.currentTransform_=n,this.renderTransform_=[1,0,0,1,0,0],this.invertRenderTransform_=[1,0,0,1,0,0],this.renderInstructions_=new Float32Array(0),this.hitRenderInstructions_=new Float32Array(0),this.generateBuffersRun_=0,this.worker_=function(){const t='const e=\"GENERATE_POLYGON_BUFFERS\",t=\"GENERATE_POINT_BUFFERS\",n=\"GENERATE_LINE_STRING_BUFFERS\",r=\"undefined\"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():\"\";r.includes(\"firefox\");r.includes(\"safari\")&&!r.includes(\"chrom\")&&(r.includes(\"version/15.4\")||/cpu (os|iphone os) 15_4 like mac os x/.test(r)),r.includes(\"webkit\")&&r.includes(\"edge\"),r.includes(\"macintosh\"),\"undefined\"!=typeof WorkerGlobalScope&&\"undefined\"!=typeof OffscreenCanvas&&(self,WorkerGlobalScope),function(){let e=!1;try{const t=Object.defineProperty({},\"passive\",{get:function(){e=!0}});window.addEventListener(\"_\",null,t),window.removeEventListener(\"_\",null,t)}catch(e){}}();const o={1:\"The view center is not defined\",2:\"The view resolution is not defined\",3:\"The view rotation is not defined\",4:\"`image` and `src` cannot be provided at the same time\",5:\"`imgSize` must be set when `image` is provided\",7:\"`format` must be set when `url` is set\",8:\"Unknown `serverType` configured\",9:\"`url` must be configured or set using `#setUrl()`\",10:\"The default `geometryFunction` can only handle `Point` geometries\",11:\"`options.featureTypes` must be an Array\",12:\"`options.geometryName` must also be provided when `options.bbox` is set\",13:\"Invalid corner\",14:\"Invalid color\",15:\"Tried to get a value for a key that does not exist in the cache\",16:\"Tried to set a value for a key that is used already\",17:\"`resolutions` must be sorted in descending order\",18:\"Either `origin` or `origins` must be configured, never both\",19:\"Number of `tileSizes` and `resolutions` must be equal\",20:\"Number of `origins` and `resolutions` must be equal\",22:\"Either `tileSize` or `tileSizes` must be configured, never both\",24:\"Invalid extent or geometry provided as `geometry`\",25:\"Cannot fit empty extent provided as `geometry`\",26:\"Features must have an id set\",27:\"Features must have an id set\",28:\\'`renderMode` must be `\"hybrid\"` or `\"vector\"`\\',30:\"The passed `feature` was already added to the source\",31:\"Tried to enqueue an `element` that was already added to the queue\",32:\"Transformation matrix cannot be inverted\",33:\"Invalid units\",34:\"Invalid geometry layout\",36:\"Unknown SRS type\",37:\"Unknown geometry type found\",38:\"`styleMapValue` has an unknown type\",39:\"Unknown geometry type\",40:\"Expected `feature` to have a geometry\",41:\"Expected an `ol/style/Style` or an array of `ol/style/Style.js`\",42:\"Question unknown, the answer is 42\",43:\"Expected `layers` to be an array or a `Collection`\",47:\"Expected `controls` to be an array or an `ol/Collection`\",48:\"Expected `interactions` to be an array or an `ol/Collection`\",49:\"Expected `overlays` to be an array or an `ol/Collection`\",50:\"`options.featureTypes` should be an Array\",51:\"Either `url` or `tileJSON` options must be provided\",52:\"Unknown `serverType` configured\",53:\"Unknown `tierSizeCalculation` configured\",55:\"The {-y} placeholder requires a tile grid with extent\",56:\"mapBrowserEvent must originate from a pointer event\",57:\"At least 2 conditions are required\",59:\"Invalid command found in the PBF\",60:\"Missing or invalid `size`\",61:\"Cannot determine IIIF Image API version from provided image information JSON\",62:\"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`\",64:\"Layer opacity must be a number\",66:\"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`\",67:\"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both\",68:\"A VectorTile source can only be rendered if it has a projection compatible with the view projection\"};class i extends Error{constructor(e){const t=o[e];super(t),this.code=e,this.name=\"AssertionError\",this.message=t}}function s(e,t){const n=t[0],r=t[1];return t[0]=e[0]*n+e[2]*r+e[4],t[1]=e[1]*n+e[3]*r+e[5],t}function a(e,t){const n=(r=t)[0]*r[3]-r[1]*r[2];var r;!function(e,t){if(!e)throw new i(t)}(0!==n,32);const o=t[0],s=t[1],a=t[2],u=t[3],x=t[4],f=t[5];return e[0]=u/n,e[1]=-s/n,e[2]=-a/n,e[3]=o/n,e[4]=(a*f-u*x)/n,e[5]=-(o*f-s*x)/n,e}new Array(6);var u={exports:{}};function x(e,t,n){n=n||2;var r,o,i,s,a,u,x,y=t&&t.length,d=y?t[0]*n:e.length,h=f(e,0,d,n,!0),v=[];if(!h||h.next===h.prev)return v;if(y&&(h=function(e,t,n,r){var o,i,s,a=[];for(o=0,i=t.length;o<i;o++)(s=f(e,t[o]*r,o<i-1?t[o+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(w(s));for(a.sort(p),o=0;o<a.length;o++)n=l(n=g(a[o],n),n.next);return n}(e,t,h,n)),e.length>80*n){r=i=e[0],o=s=e[1];for(var b=n;b<d;b+=n)(a=e[b])<r&&(r=a),(u=e[b+1])<o&&(o=u),a>i&&(i=a),u>s&&(s=u);x=0!==(x=Math.max(i-r,s-o))?1/x:0}return c(h,v,n,r,o,x),v}function f(e,t,n,r,o){var i,s;if(o===B(e,t,n,r)>0)for(i=t;i<n;i+=r)s=U(i,e[i],e[i+1],s);else for(i=n-r;i>=t;i-=r)s=U(i,e[i],e[i+1],s);return s&&M(s,s.next)&&(z(s),s=s.next),s}function l(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!M(r,r.next)&&0!==Z(r.prev,r,r.next))r=r.next;else{if(z(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function c(e,t,n,r,o,i,s){if(e){!s&&i&&function(e,t,n,r){var o=e;do{null===o.z&&(o.z=m(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,r,o,i,s,a,u,x=1;do{for(n=e,e=null,i=null,s=0;n;){for(s++,r=n,a=0,t=0;t<x&&(a++,r=r.nextZ);t++);for(u=x;a>0||u>0&&r;)0!==a&&(0===u||!r||n.z<=r.z)?(o=n,n=n.nextZ,a--):(o=r,r=r.nextZ,u--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;n=r}i.nextZ=null,x*=2}while(s>1)}(o)}(e,r,o,i);for(var a,u,x=e;e.prev!==e.next;)if(a=e.prev,u=e.next,i?d(e,r,o,i):y(e))t.push(a.i/n),t.push(e.i/n),t.push(u.i/n),z(e),e=u.next,x=u.next;else if((e=u)===x){s?1===s?c(e=h(l(e),t,n),t,n,r,o,i,2):2===s&&v(e,t,n,r,o,i):c(l(e),t,n,r,o,i,1);break}}}function y(e){var t=e.prev,n=e,r=e.next;if(Z(t,n,r)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(A(t.x,t.y,n.x,n.y,r.x,r.y,o.x,o.y)&&Z(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function d(e,t,n,r){var o=e.prev,i=e,s=e.next;if(Z(o,i,s)>=0)return!1;for(var a=o.x<i.x?o.x<s.x?o.x:s.x:i.x<s.x?i.x:s.x,u=o.y<i.y?o.y<s.y?o.y:s.y:i.y<s.y?i.y:s.y,x=o.x>i.x?o.x>s.x?o.x:s.x:i.x>s.x?i.x:s.x,f=o.y>i.y?o.y>s.y?o.y:s.y:i.y>s.y?i.y:s.y,l=m(a,u,t,n,r),c=m(x,f,t,n,r),y=e.prevZ,d=e.nextZ;y&&y.z>=l&&d&&d.z<=c;){if(y!==e.prev&&y!==e.next&&A(o.x,o.y,i.x,i.y,s.x,s.y,y.x,y.y)&&Z(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,d!==e.prev&&d!==e.next&&A(o.x,o.y,i.x,i.y,s.x,s.y,d.x,d.y)&&Z(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;y&&y.z>=l;){if(y!==e.prev&&y!==e.next&&A(o.x,o.y,i.x,i.y,s.x,s.y,y.x,y.y)&&Z(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;d&&d.z<=c;){if(d!==e.prev&&d!==e.next&&A(o.x,o.y,i.x,i.y,s.x,s.y,d.x,d.y)&&Z(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function h(e,t,n){var r=e;do{var o=r.prev,i=r.next.next;!M(o,i)&&F(o,r,r.next,i)&&k(o,i)&&k(i,o)&&(t.push(o.i/n),t.push(r.i/n),t.push(i.i/n),z(r),z(r.next),r=e=i),r=r.next}while(r!==e);return l(r)}function v(e,t,n,r,o,i){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&E(s,a)){var u=S(s,a);return s=l(s,s.next),u=l(u,u.next),c(s,t,n,r,o,i),void c(u,t,n,r,o,i)}a=a.next}s=s.next}while(s!==e)}function p(e,t){return e.x-t.x}function g(e,t){var n=function(e,t){var n,r=t,o=e.x,i=e.y,s=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var a=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=o&&a>s){if(s=a,a===o){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(o===s)return n;var u,x=n,f=n.x,l=n.y,c=1/0;r=n;do{o>=r.x&&r.x>=f&&o!==r.x&&A(i<l?o:s,i,f,l,i<l?s:o,i,r.x,r.y)&&(u=Math.abs(i-r.y)/(o-r.x),k(r,e)&&(u<c||u===c&&(r.x>n.x||r.x===n.x&&b(n,r)))&&(n=r,c=u)),r=r.next}while(r!==x);return n}(e,t);if(!n)return t;var r=S(n,e),o=l(n,n.next);return l(r,r.next),t===n?o:t}function b(e,t){return Z(e.prev,e,t.prev)<0&&Z(t.next,e,e.next)<0}function m(e,t,n,r,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function w(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function A(e,t,n,r,o,i,s,a){return(o-s)*(t-a)-(e-s)*(i-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(i-a)-(o-s)*(r-a)>=0}function E(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&F(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(k(e,t)&&k(t,e)&&function(e,t){var n=e,r=!1,o=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&o<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Z(e.prev,e,t.prev)||Z(e,t.prev,t))||M(e,t)&&Z(e.prev,e,e.next)>0&&Z(t.prev,t,t.next)>0)}function Z(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function M(e,t){return e.x===t.x&&e.y===t.y}function F(e,t,n,r){var o=I(Z(e,t,n)),i=I(Z(e,t,r)),s=I(Z(n,r,e)),a=I(Z(n,r,t));return o!==i&&s!==a||(!(0!==o||!T(e,n,t))||(!(0!==i||!T(e,r,t))||(!(0!==s||!T(n,e,r))||!(0!==a||!T(n,t,r)))))}function T(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function I(e){return e>0?1:e<0?-1:0}function k(e,t){return Z(e.prev,e,e.next)<0?Z(e,t,e.next)>=0&&Z(e,e.prev,t)>=0:Z(e,t,e.prev)<0||Z(e,e.next,t)<0}function S(e,t){var n=new R(e.i,e.x,e.y),r=new R(t.i,t.x,t.y),o=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function U(e,t,n,r){var o=new R(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function z(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function R(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function B(e,t,n,r){for(var o=0,i=t,s=n-r;i<n;i+=r)o+=(e[s]-e[i])*(e[i+1]+e[s+1]),s=i;return o}u.exports=x,u.exports.default=x,x.deviation=function(e,t,n,r){var o=t&&t.length,i=o?t[0]*n:e.length,s=Math.abs(B(e,0,i,n));if(o)for(var a=0,u=t.length;a<u;a++){var x=t[a]*n,f=a<u-1?t[a+1]*n:e.length;s-=Math.abs(B(e,x,f,n))}var l=0;for(a=0;a<r.length;a+=3){var c=r[a]*n,y=r[a+1]*n,d=r[a+2]*n;l+=Math.abs((e[c]-e[d])*(e[y+1]-e[c+1])-(e[c]-e[y])*(e[d+1]-e[c+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},x.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var s=0;s<t;s++)n.vertices.push(e[o][i][s]);o>0&&(r+=e[o-1].length,n.holes.push(r))}return n};const P=[],C={vertexPosition:0,indexPosition:0};function N(e,t,n,r,o){e[t+0]=n,e[t+1]=r,e[t+2]=o}function _(e,t,n,r,o,i){const s=3+o,a=e[t+0],u=e[t+1],x=P;x.length=o;for(let n=0;n<x.length;n++)x[n]=e[t+2+n];let f=i?i.vertexPosition:0,l=i?i.indexPosition:0;const c=f/s;return N(n,f,a,u,0),x.length&&n.set(x,f+3),f+=s,N(n,f,a,u,1),x.length&&n.set(x,f+3),f+=s,N(n,f,a,u,2),x.length&&n.set(x,f+3),f+=s,N(n,f,a,u,3),x.length&&n.set(x,f+3),f+=s,r[l++]=c,r[l++]=c+1,r[l++]=c+3,r[l++]=c+1,r[l++]=c+2,r[l++]=c+3,C.vertexPosition=f,C.indexPosition=l,C}function L(e,t,n,r,o,i,a,u,x,f){const l=5+u.length,c=i.length/l,y=[e[t+0],e[t+1]],d=[e[n],e[n+1]],h=s(f,[...y]),v=s(f,[...d]);function p(e,t,n){const r=1e4;return Math.round(1500*t)+Math.round(1500*n)*r+e*r*r}function g(e,t,n){const r=Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])),o=[(t[0]-e[0])/r,(t[1]-e[1])/r],i=[-o[1],o[0]],s=Math.sqrt((n[0]-e[0])*(n[0]-e[0])+(n[1]-e[1])*(n[1]-e[1])),a=[(n[0]-e[0])/s,(n[1]-e[1])/s],u=0===r||0===s?0:Math.acos((x=a[0]*o[0]+a[1]*o[1],f=-1,l=1,Math.min(Math.max(x,f),l)));var x,f,l;return a[0]*i[0]+a[1]*i[1]>0?u:2*Math.PI-u}const b=null!==o;let m=0,w=0;if(null!==r){m=g(h,v,s(f,[...[e[r],e[r+1]]]))}if(b){w=g(v,h,s(f,[...[e[o],e[o+1]]]))}i.push(y[0],y[1],d[0],d[1],p(0,m,w)),i.push(...u),i.push(y[0],y[1],d[0],d[1],p(1,m,w)),i.push(...u),i.push(y[0],y[1],d[0],d[1],p(2,m,w)),i.push(...u),i.push(y[0],y[1],d[0],d[1],p(3,m,w)),i.push(...u),a.push(c,c+1,c+2,c+1,c+3,c+2)}function G(e,t,n,r,o){const i=2+o;let s=t;const a=e.slice(s,s+o);s+=o;const x=e[s++];let f=0;const l=new Array(x-1);for(let t=0;t<x;t++)f+=e[s++],t<x-1&&(l[t]=f);const c=e.slice(s,s+2*f),y=u.exports(c,l,2);for(let e=0;e<y.length;e++)r.push(y[e]+n.length/i);for(let e=0;e<c.length;e+=2)n.push(c[e],c[e+1],...a);return s+2*f}const O=self;O.onmessage=r=>{const o=r.data;switch(o.type){case t:{const e=3,t=2,n=o.customAttributesCount,r=t+n,i=new Float32Array(o.renderInstructions),s=i.length/r,a=4*s*(n+e),u=new Uint32Array(6*s),x=new Float32Array(a);let f;for(let e=0;e<i.length;e+=r)f=_(i,e,x,u,n,f);const l=Object.assign({vertexBuffer:x.buffer,indexBuffer:u.buffer,renderInstructions:i.buffer},o);O.postMessage(l,[x.buffer,u.buffer,i.buffer]);break}case n:{const e=[],t=[],n=o.customAttributesCount,r=2,i=new Float32Array(o.renderInstructions);let s=0;const u=o.renderInstructionsTransform,x=[1,0,0,1,0,0];let f,l;for(a(x,u);s<i.length;){l=Array.from(i.slice(s,s+n)),s+=n,f=i[s++];for(let n=0;n<f-1;n++)L(i,s+n*r,s+(n+1)*r,n>0?s+(n-1)*r:null,n<f-2?s+(n+2)*r:null,e,t,l,0,x);s+=f*r}const c=Uint32Array.from(t),y=Float32Array.from(e),d=Object.assign({vertexBuffer:y.buffer,indexBuffer:c.buffer,renderInstructions:i.buffer},o);O.postMessage(d,[y.buffer,c.buffer,i.buffer]);break}case e:{const e=[],t=[],n=o.customAttributesCount,r=new Float32Array(o.renderInstructions);let i=0;for(;i<r.length;)i=G(r,i,e,t,n);const s=Uint32Array.from(t),a=Float32Array.from(e),u=Object.assign({vertexBuffer:a.buffer,indexBuffer:s.buffer,renderInstructions:r.buffer},o);O.postMessage(u,[a.buffer,s.buffer,r.buffer]);break}}};';return new Worker(\"undefined\"==typeof Blob?\"data:application/javascript;base64,\"+Buffer.from(t,\"binary\").toString(\"base64\"):URL.createObjectURL(new Blob([t],{type:\"application/javascript\"})))}(),this.worker_.addEventListener(\"message\",(function(t){const e=t.data;if(\"GENERATE_POINT_BUFFERS\"===e.type){const i=e.projectionTransform;e.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(e.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(e.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(e.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=i,gG(this.invertRenderTransform_,this.renderTransform_),e.hitDetection?this.hitRenderInstructions_=new Float32Array(t.data.renderInstructions):(this.renderInstructions_=new Float32Array(t.data.renderInstructions),e.generateBuffersRun===this.generateBuffersRun_&&(this.ready=!0)),this.getLayer().changed()}}).bind(this)),this.featureCache_={},this.featureCount_=0;const r=this.getLayer().getSource();this.sourceListenKeys_=[KB(r,\"addfeature\",this.handleSourceFeatureAdded_,this),KB(r,\"changefeature\",this.handleSourceFeatureChanged_,this),KB(r,\"removefeature\",this.handleSourceFeatureDelete_,this),KB(r,\"clear\",this.handleSourceFeatureClear_,this)],r.forEachFeature((function(t){this.featureCache_[MB(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++}).bind(this))}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new class{constructor(t,e){this.helper_=t;const i=t.getGL();this.texture_=i.createTexture(),this.framebuffer_=i.createFramebuffer(),this.size_=e||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(t){_B(t,this.size_)||(this.size_[0]=t[0],this.size_[1]=t[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const t=this.size_,e=this.helper_.getGL();e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.readPixels(0,0,t[0],t[1],e.RGBA,e.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(t,e){if(t<0||e<0||t>this.size_[0]||e>=this.size_[1])return Xlt[0]=0,Xlt[1]=0,Xlt[2]=0,Xlt[3]=0,Xlt;this.readAll();const i=Math.floor(t)+(this.size_[1]-Math.floor(e)-1)*this.size_[0];return Xlt[0]=this.data_[4*i],Xlt[1]=this.data_[4*i+1],Xlt[2]=this.data_[4*i+2],Xlt[3]=this.data_[4*i+3],Xlt}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}updateSize_(){const t=this.size_,e=this.helper_.getGL();this.texture_=this.helper_.createTexture(t,null,this.texture_),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer_),e.viewport(0,0,t[0],t[1]),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture_,0),this.data_=new Uint8Array(t[0]*t[1]*4)}}(this.helper))}handleSourceFeatureAdded_(t){const e=t.feature;this.featureCache_[MB(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}handleSourceFeatureChanged_(t){const e=t.feature;this.featureCache_[MB(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()}}handleSourceFeatureDelete_(t){delete this.featureCache_[MB(t.feature)],this.featureCount_--}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(t){const e=this.helper.getGL();this.preRender(e,t);const i=t.viewState.projection,n=this.getLayer().getSource().getWrapX()&&i.canWrapX(),s=i.getExtent(),r=t.extent,o=n?Dz(s):null,a=n?Math.ceil((r[2]-s[2])/o)+1:1,l=n?Math.floor((r[0]-s[0])/o):0;let c=l;const h=this.indicesBuffer_.getSize();do{this.helper.makeProjectionTransform(t,this.currentTransform_),fG(this.currentTransform_,c*o,0),uG(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t),this.helper.drawElements(0,h)}while(++c<a);this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const u=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(t,l,a,o),this.hitRenderTarget_.clearCachedData()),this.postRender(e,t),u}prepareFrameInternal(t){const e=this.getLayer(),i=e.getSource(),n=t.viewState,s=!t.viewHints[0]&&!t.viewHints[1],r=!Az(this.previousExtent_,t.extent),o=this.sourceRevision_<i.getRevision();if(o&&(this.sourceRevision_=i.getRevision()),s&&(r||o)){const s=n.projection,r=n.resolution,o=e instanceof Yot?e.getRenderBuffer():0,a=oz(t.extent,o*r);i.loadFeatures(a,r,s),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()}return this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(t){const e=[1,0,0,1,0,0];this.helper.makeProjectionTransform(t,e);const i=(2+this.customAttributes.length)*this.featureCount_;if((!this.renderInstructions_||this.renderInstructions_.length!==i)&&(this.renderInstructions_=new Float32Array(i)),this.hitDetectionEnabled_){const t=(7+this.customAttributes.length)*this.featureCount_;(!this.hitRenderInstructions_||this.hitRenderInstructions_.length!==t)&&(this.hitRenderInstructions_=new Float32Array(t))}let n,s;const r=[],o=[];let a,l=0,c=0;for(const u in this.featureCache_){if(n=this.featureCache_[u],s=n.geometry,!s||\"Point\"!==s.getType())continue;let t;r[0]=s.getFlatCoordinates()[0],r[1]=s.getFlatCoordinates()[1],pG(e,r),a=Qlt(c+6,o),this.renderInstructions_[l++]=r[0],this.renderInstructions_[l++]=r[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[c++]=r[0],this.hitRenderInstructions_[c++]=r[1],this.hitRenderInstructions_[c++]=a[0],this.hitRenderInstructions_[c++]=a[1],this.hitRenderInstructions_[c++]=a[2],this.hitRenderInstructions_[c++]=a[3],this.hitRenderInstructions_[c++]=Number(u));for(let e=0;e<this.customAttributes.length;e++)t=this.customAttributes[e].callback(n.feature,n.properties),this.renderInstructions_[l++]=t,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[c++]=t)}const h={id:0,type:\"GENERATE_POINT_BUFFERS\",renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(h.projectionTransform=e,h.generateBuffersRun=++this.generateBuffersRun_,this.ready=!1,this.worker_.postMessage(h,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){const t={id:0,type:\"GENERATE_POINT_BUFFERS\",renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};t.projectionTransform=e,t.hitDetection=!0,this.worker_.postMessage(t,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}}forEachFeatureAtCoordinate(t,e,i,n,s){if(sz(this.hitDetectionEnabled_,66),!this.hitRenderInstructions_)return;const r=pG(e.coordinateToPixelTransform,t.slice()),o=this.hitRenderTarget_.readPixel(r[0]/2,r[1]/2),a=function(t){let e=0;const i=256,n=255;return e+=Math.round(t[0]*i*i*i*n),e+=Math.round(t[1]*i*i*n),e+=Math.round(t[2]*i*n),e+=Math.round(t[3]*n),e}([o[0]/255,o[1]/255,o[2]/255,o[3]/255]),l=Math.floor(this.hitRenderInstructions_[a]).toString(),c=this.getLayer().getSource().getFeatureByUid(l);return c?n(c,this.getLayer(),null):void 0}renderHitDetection(t,e,i,n){if(!this.hitVerticesBuffer_.getSize())return;let s=e;this.hitRenderTarget_.setSize([Math.floor(t.size[0]/2),Math.floor(t.size[1]/2)]),this.helper.useProgram(this.hitProgram_,t),this.helper.prepareDrawToRenderTarget(t,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);do{this.helper.makeProjectionTransform(t,this.currentTransform_),fG(this.currentTransform_,s*n,0),uG(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(t);const e=this.indicesBuffer_.getSize();this.helper.drawElements(0,e)}while(++s<i)}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach(function(t){QB(t)}),this.sourceListenKeys_=null,super.disposeInternal()}};const tct={};function ect(t){if(\"number\"==typeof t)return 1;if(\"boolean\"==typeof t)return 8;if(\"string\"==typeof t)return function(t){return A8.test(t)&&(t=_8(t)),g8.test(t)||t.startsWith(\"rgba(\")||t.startsWith(\"rgb(\")}(t)?6:2;if(!Array.isArray(t))throw new Error(`Unhandled value type: ${JSON.stringify(t)}`);const e=t;if(e.every(function(t){return\"number\"==typeof t}))return 3===e.length||4===e.length?20:16;if(\"string\"!=typeof e[0])throw new Error(`Expected an expression operator but received: ${JSON.stringify(e)}`);const i=tct[e[0]];if(void 0===i)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return i.getReturnType(e.slice(1))}function ict(t){const e=t.toString();return e.includes(\".\")?e:e+\".0\"}function nct(t){if(t.length<2||t.length>4)throw new Error(\"`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.\");return`vec${t.length}(${t.map(ict).join(\", \")})`}function sct(t,e){return void 0===t.stringLiteralsMap[e]&&(t.stringLiteralsMap[e]=Object.keys(t.stringLiteralsMap).length),t.stringLiteralsMap[e]}function rct(t,e,i){if(Array.isArray(e)&&\"string\"==typeof e[0]){const n=tct[e[0]];if(void 0===n)throw new Error(`Unrecognized expression operator: ${JSON.stringify(e)}`);return n.toGlsl(t,e.slice(1),i)}const n=ect(e);if((1&n)>0)return ict(e);if((8&n)>0)return e.toString();if((2&n)>0&&(void 0===i||2==i))return function(t,e){return ict(sct(t,e))}(t,e.toString());if((4&n)>0&&(void 0===i||4==i))return function(t){const e=y8(t).slice();return e.length<4&&e.push(1),nct(e.map(function(t,e){return e<3?t/255:t}))}(e);if((16&n)>0)return nct(e);throw new Error(`Unexpected expression ${e} (expected type ${i})`)}function oct(t){if(!(1&ect(t)))throw new Error(`A numeric value was expected, got ${JSON.stringify(t)} instead`)}function act(t){for(let e=0;e<t.length;e++)oct(t[e])}function lct(t){if(!(2&ect(t)))throw new Error(`A string value was expected, got ${JSON.stringify(t)} instead`)}function cct(t){if(!(8&ect(t)))throw new Error(`A boolean value was expected, got ${JSON.stringify(t)} instead`)}function hct(t,e){if(t.length!==e)throw new Error(`Exactly ${e} arguments were expected, got ${t.length} instead`)}function uct(t,e){if(t.length<e)throw new Error(`At least ${e} arguments were expected, got ${t.length} instead`)}function dct(t,e){if(t.length>e)throw new Error(`At most ${e} arguments were expected, got ${t.length} instead`)}function pct(t){if(t.length%2!=0)throw new Error(`An even amount of arguments was expected, got ${t} instead`)}function fct(t,e){if(!function(t){return Math.log2(t)%1==0}(e))throw new Error(`Could not infer only one type from the following expression: ${JSON.stringify(t)}`)}function mct(t){return\"u_var_\"+t}tct.get={getReturnType:function(t){return 31},toGlsl:function(t,e){hct(e,1),lct(e[0]);const i=e[0].toString();return t.attributes.includes(i)||t.attributes.push(i),(t.inFragmentShader?\"v_\":\"a_\")+i}},tct.var={getReturnType:function(t){return 31},toGlsl:function(t,e){hct(e,1),lct(e[0]);const i=e[0].toString();return t.variables.includes(i)||t.variables.push(i),mct(i)}},tct.palette={getReturnType:function(t){return 4},toGlsl:function(t,e){hct(e,2),oct(e[0]);const i=rct(t,e[0]),n=e[1];if(!Array.isArray(n))throw new Error(\"The second argument of palette must be an array\");const s=n.length,r=new Uint8Array(4*s);for(let l=0;l<s;l++){const t=n[l];let e;if(\"string\"==typeof t)e=b8(t);else{if(!Array.isArray(t))throw new Error(\"The second argument of palette must be an array of strings or colors\");const i=t.length;if(4===i)e=t;else{if(3!==i)throw new Error(`Expected palette color to have 3 or 4 values, got ${i}`);e=[t[0],t[1],t[2],1]}}const i=4*l;r[i]=e[0],r[i+1]=e[1],r[i+2]=e[2],r[i+3]=255*e[3]}t.paletteTextures||(t.paletteTextures=[]);const o=`u_paletteTextures[${t.paletteTextures.length}]`,a=new class{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}}(o,r);return t.paletteTextures.push(a),`texture2D(${o}, vec2((${i} + 0.5) / ${s}.0, 0.5))`}};const gct=\"getBandValue\";function Act(t){return{getReturnType:function(t){return 8},toGlsl:function(e,i){hct(i,2);let n=31;for(let t=0;t<i.length;t++)n&=ect(i[t]);if(0===n)throw new Error(`All arguments should be of compatible type, got ${JSON.stringify(i)} instead`);return n&=-5,`(${rct(e,i[0],n)} ${t} ${rct(e,i[1],n)})`}}}function vct(t){return{getReturnType:function(t){return 8},toGlsl:function(e,i){uct(i,2);for(let t=0;t<i.length;t++)cct(i[t]);let n=\"\";return n=i.map(t=>rct(e,t)).join(` ${t} `),n=`(${n})`,n}}}tct.band={getReturnType:function(t){return 1},toGlsl:function(t,e){uct(e,1),dct(e,3);const i=e[0];if(!(gct in t.functions)){let e=\"\";const i=t.bandCount||1;for(let t=0;t<i;t++){const n=Math.floor(t/4);let s=t%4;t===i-1&&1===s&&(s=3),e+=`\\n          if (band == ${t+1}.0) {\\n            return texture2D(u_tileTextures[${n}], v_textureCoord + vec2(dx, dy))[${s}];\\n          }\\n        `}t.functions[gct]=`\\n        float getBandValue(float band, float xOffset, float yOffset) {\\n          float dx = xOffset / u_texturePixelWidth;\\n          float dy = yOffset / u_texturePixelHeight;\\n          ${e}\\n        }\\n      `}const n=rct(t,i),s=rct(t,e[1]||0),r=rct(t,e[2]||0);return`${gct}(${n}, ${s}, ${r})`}},tct.time={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,0),\"u_time\"}},tct.zoom={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,0),\"u_zoom\"}},tct.resolution={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,0),\"u_resolution\"}},tct[\"*\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} * ${rct(t,e[1])})`}},tct[\"/\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} / ${rct(t,e[1])})`}},tct[\"+\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} + ${rct(t,e[1])})`}},tct[\"-\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} - ${rct(t,e[1])})`}},tct.clamp={getReturnType:function(t){return 1},toGlsl:function(t,e){hct(e,3),act(e);const i=rct(t,e[1]),n=rct(t,e[2]);return`clamp(${rct(t,e[0])}, ${i}, ${n})`}},tct[\"%\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,2),act(e),`mod(${rct(t,e[0])}, ${rct(t,e[1])})`}},tct[\"^\"]={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,2),act(e),`pow(${rct(t,e[0])}, ${rct(t,e[1])})`}},tct.abs={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,1),act(e),`abs(${rct(t,e[0])})`}},tct.floor={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,1),act(e),`floor(${rct(t,e[0])})`}},tct.round={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,1),act(e),`floor(${rct(t,e[0])} + 0.5)`}},tct.ceil={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,1),act(e),`ceil(${rct(t,e[0])})`}},tct.sin={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,1),act(e),`sin(${rct(t,e[0])})`}},tct.cos={getReturnType:function(t){return 1},toGlsl:function(t,e){return hct(e,1),act(e),`cos(${rct(t,e[0])})`}},tct.atan={getReturnType:function(t){return 1},toGlsl:function(t,e){return uct(e,1),dct(e,2),act(e),2===e.length?`atan(${rct(t,e[0])}, ${rct(t,e[1])})`:`atan(${rct(t,e[0])})`}},tct[\">\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} > ${rct(t,e[1])})`}},tct[\">=\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} >= ${rct(t,e[1])})`}},tct[\"<\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} < ${rct(t,e[1])})`}},tct[\"<=\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return hct(e,2),act(e),`(${rct(t,e[0])} <= ${rct(t,e[1])})`}},tct[\"==\"]=Act(\"==\"),tct[\"!=\"]=Act(\"!=\"),tct[\"!\"]={getReturnType:function(t){return 8},toGlsl:function(t,e){return hct(e,1),cct(e[0]),`(!${rct(t,e[0])})`}},tct.all=vct(\"&&\"),tct.any=vct(\"||\"),tct.between={getReturnType:function(t){return 8},toGlsl:function(t,e){hct(e,3),act(e);const i=rct(t,e[1]),n=rct(t,e[2]),s=rct(t,e[0]);return`(${s} >= ${i} && ${s} <= ${n})`}},tct.array={getReturnType:function(t){return 16},toGlsl:function(t,e){uct(e,2),dct(e,4),act(e);const i=e.map(function(e){return rct(t,e,1)});return`vec${e.length}(${i.join(\", \")})`}},tct.color={getReturnType:function(t){return 4},toGlsl:function(t,e){uct(e,3),dct(e,4),act(e),3===e.length&&e.push(1);const i=e.map(function(e,i){return rct(t,e,1)+(i<3?\" / 255.0\":\"\")});return`vec${e.length}(${i.join(\", \")})`}},tct.interpolate={getReturnType:function(t){let e=5;for(let i=3;i<t.length;i+=2)e&=ect(t[i]);return e},toGlsl:function(t,e,i){pct(e),uct(e,6);const n=e[0];let s;switch(n[0]){case\"linear\":s=1;break;case\"exponential\":s=n[1];break;default:s=null}if(!s)throw new Error(`Invalid interpolation type for \"interpolate\" operator, received: ${JSON.stringify(n)}`);i=void 0!==i?i:31;const r=tct.interpolate.getReturnType(e)&i;fct(e,r);const o=rct(t,e[1]),a=ict(s);let l=\"\";for(let c=2;c<e.length-2;c+=2){const i=rct(t,e[c]),n=l||rct(t,e[c+1],r),s=rct(t,e[c+2]);l=`mix(${n}, ${rct(t,e[c+3],r)}, pow(clamp((${o} - ${i}) / (${s} - ${i}), 0.0, 1.0), ${a}))`}return l}},tct.match={getReturnType:function(t){let e=31;for(let i=2;i<t.length;i+=2)e&=ect(t[i]);return e&=ect(t[t.length-1]),e},toGlsl:function(t,e,i){pct(e),uct(e,4),i=void 0!==i?i:31;const n=tct.match.getReturnType(e)&i;fct(e,n);const s=rct(t,e[0]),r=rct(t,e[e.length-1],n);let o=null;for(let a=e.length-3;a>=1;a-=2)o=`(${s} == ${rct(t,e[a])} ? ${rct(t,e[a+1],n)} : ${o||r})`;return o}},tct.case={getReturnType:function(t){let e=31;for(let i=1;i<t.length;i+=2)e&=ect(t[i]);return e&=ect(t[t.length-1]),e},toGlsl:function(t,e,i){(function(t){if(t.length%2==0)throw new Error(`An odd amount of arguments was expected, got ${t} instead`)})(e),uct(e,3),i=void 0!==i?i:31;const n=tct.case.getReturnType(e)&i;fct(e,n);for(let o=0;o<e.length-1;o+=2)cct(e[o]);const s=rct(t,e[e.length-1],n);let r=null;for(let o=e.length-3;o>=0;o-=2)r=`(${rct(t,e[o])} ? ${rct(t,e[o+1],n)} : ${r||s})`;return r}};class _ct{constructor(){this.uniforms=[],this.attributes=[],this.varyings=[],this.sizeExpression=\"vec2(1.0)\",this.rotationExpression=\"0.0\",this.offsetExpression=\"vec2(0.0)\",this.colorExpression=\"vec4(1.0)\",this.texCoordExpression=\"vec4(0.0, 0.0, 1.0, 1.0)\",this.discardExpression=\"false\",this.rotateWithView=!1}addUniform(t){return this.uniforms.push(t),this}addAttribute(t){return this.attributes.push(t),this}addVarying(t,e,i){return this.varyings.push({name:t,type:e,expression:i}),this}setSizeExpression(t){return this.sizeExpression=t,this}setRotationExpression(t){return this.rotationExpression=t,this}setSymbolOffsetExpression(t){return this.offsetExpression=t,this}setColorExpression(t){return this.colorExpression=t,this}setTextureCoordinateExpression(t){return this.texCoordExpression=t,this}setFragmentDiscardExpression(t){return this.discardExpression=t,this}setSymbolRotateWithView(t){return this.rotateWithView=t,this}getSizeExpression(){return this.sizeExpression}getOffsetExpression(){return this.offsetExpression}getColorExpression(){return this.colorExpression}getTextureCoordinateExpression(){return this.texCoordExpression}getFragmentDiscardExpression(){return this.discardExpression}getSymbolVertexShader(t){const e=this.rotateWithView?\"u_offsetScaleMatrix * u_offsetRotateMatrix\":\"u_offsetScaleMatrix\";let i=this.attributes,n=this.varyings;return t&&(i=i.concat(\"vec4 a_hitColor\"),n=n.concat({name:\"v_hitColor\",type:\"vec4\",expression:\"a_hitColor\"})),`precision mediump float;\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_time;\\nuniform float u_zoom;\\nuniform float u_resolution;\\n${this.uniforms.map(function(t){return\"uniform \"+t+\";\"}).join(\"\\n\")}\\nattribute vec2 a_position;\\nattribute float a_index;\\n${i.map(function(t){return\"attribute \"+t+\";\"}).join(\"\\n\")}\\nvarying vec2 v_texCoord;\\nvarying vec2 v_quadCoord;\\n${n.map(function(t){return\"varying \"+t.type+\" \"+t.name+\";\"}).join(\"\\n\")}\\nvoid main(void) {\\n  mat4 offsetMatrix = ${e};\\n  vec2 halfSize = ${this.sizeExpression} * 0.5;\\n  vec2 offset = ${this.offsetExpression};\\n  float angle = ${this.rotationExpression};\\n  float offsetX;\\n  float offsetY;\\n  if (a_index == 0.0) {\\n    offsetX = (offset.x - halfSize.x) * cos(angle) + (offset.y - halfSize.y) * sin(angle);\\n    offsetY = (offset.y - halfSize.y) * cos(angle) - (offset.x - halfSize.x) * sin(angle);\\n  } else if (a_index == 1.0) {\\n    offsetX = (offset.x + halfSize.x) * cos(angle) + (offset.y - halfSize.y) * sin(angle);\\n    offsetY = (offset.y - halfSize.y) * cos(angle) - (offset.x + halfSize.x) * sin(angle);\\n  } else if (a_index == 2.0) {\\n    offsetX = (offset.x + halfSize.x) * cos(angle) + (offset.y + halfSize.y) * sin(angle);\\n    offsetY = (offset.y + halfSize.y) * cos(angle) - (offset.x + halfSize.x) * sin(angle);\\n  } else {\\n    offsetX = (offset.x - halfSize.x) * cos(angle) + (offset.y + halfSize.y) * sin(angle);\\n    offsetY = (offset.y + halfSize.y) * cos(angle) - (offset.x - halfSize.x) * sin(angle);\\n  }\\n  vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\\n  vec4 texCoord = ${this.texCoordExpression};\\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;\\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;\\n  v_texCoord = vec2(u, v);\\n  u = a_index == 0.0 || a_index == 3.0 ? 0.0 : 1.0;\\n  v = a_index == 2.0 || a_index == 3.0 ? 0.0 : 1.0;\\n  v_quadCoord = vec2(u, v);\\n${n.map(function(t){return\"  \"+t.name+\" = \"+t.expression+\";\"}).join(\"\\n\")}\\n}`}getSymbolFragmentShader(t){const e=t?\"  if (gl_FragColor.a < 0.1) { discard; } gl_FragColor = v_hitColor;\":\"\";let i=this.varyings;return t&&(i=i.concat({name:\"v_hitColor\",type:\"vec4\",expression:\"a_hitColor\"})),`precision mediump float;\\nuniform float u_time;\\nuniform float u_zoom;\\nuniform float u_resolution;\\n${this.uniforms.map(function(t){return\"uniform \"+t+\";\"}).join(\"\\n\")}\\nvarying vec2 v_texCoord;\\nvarying vec2 v_quadCoord;\\n${i.map(function(t){return\"varying \"+t.type+\" \"+t.name+\";\"}).join(\"\\n\")}\\nvoid main(void) {\\n  if (${this.discardExpression}) { discard; }\\n  gl_FragColor = ${this.colorExpression};\\n  gl_FragColor.rgb *= gl_FragColor.a;\\n${e}\\n}`}}var bct=class extends jrt{constructor(t){super(Object.assign({},t)),this.parseResult_=function(t){const e=t.symbol,i=void 0!==e.size?e.size:1,n=e.color||\"white\",s=e.textureCoord||[0,0,1,1],r=e.offset||[0,0],o=void 0!==e.opacity?e.opacity:1,a=void 0!==e.rotation?e.rotation:0,l={inFragmentShader:!1,variables:[],attributes:[],stringLiteralsMap:{},functions:{}},c=rct(l,i,17),h=rct(l,r,16),u=rct(l,s,16),d=rct(l,a,1),p={inFragmentShader:!0,variables:l.variables,attributes:[],stringLiteralsMap:l.stringLiteralsMap,functions:{}},f=rct(p,n,4),m=rct(p,o,1);let g=\"1.0\";const A=`vec2(${rct(p,i,17)}).x`;switch(e.symbolType){case\"square\":case\"image\":break;case\"circle\":g=`(1.0-smoothstep(1.-4./${A},1.,dot(v_quadCoord-.5,v_quadCoord-.5)*4.))`;break;case\"triangle\":const t=\"(v_quadCoord*2.-1.)\",i=`(atan(${t}.x,${t}.y))`;g=`(1.0-smoothstep(.5-3./${A},.5,cos(floor(.5+${i}/2.094395102)*2.094395102-${i})*length(${t})))`;break;default:throw new Error(\"Unexpected symbol type: \"+e.symbolType)}const v=(new _ct).setSizeExpression(`vec2(${c})`).setRotationExpression(d).setSymbolOffsetExpression(h).setTextureCoordinateExpression(u).setSymbolRotateWithView(!!e.rotateWithView).setColorExpression(`vec4(${f}.rgb, ${f}.a * ${m} * ${g})`);if(t.filter){const e=rct(p,t.filter,8);v.setFragmentDiscardExpression(`!${e}`)}const _={};if(p.variables.forEach(function(e){const i=mct(e);v.addUniform(`float ${i}`),_[i]=function(){if(!t.variables||void 0===t.variables[e])throw new Error(`The following variable is missing from the style: ${e}`);let i=t.variables[e];return\"string\"==typeof i&&(i=sct(l,i)),void 0!==i?i:-9999999}}),\"image\"===e.symbolType&&e.src){const t=new Image;t.crossOrigin=void 0===e.crossOrigin?\"anonymous\":e.crossOrigin,t.src=e.src,v.addUniform(\"sampler2D u_texture\").setColorExpression(v.getColorExpression()+\" * texture2D(u_texture, v_texCoord)\"),_.u_texture=t}return p.attributes.forEach(function(t){l.attributes.includes(t)||l.attributes.push(t),v.addVarying(`v_${t}`,\"float\",`a_${t}`)}),l.attributes.forEach(function(t){v.addAttribute(`float a_${t}`)}),{builder:v,attributes:l.attributes.map(function(t){return{name:t,callback:function(e,i){let n=i[t];return\"string\"==typeof n&&(n=sct(l,n)),void 0!==n?n:-9999999}}}),uniforms:_}}(t.style),this.styleVariables_=t.style.variables||{},this.hitDetectionDisabled_=!!t.disableHitDetection}createRenderer(){return new Jlt(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitVertexShader:!this.hitDetectionDisabled_&&this.parseResult_.builder.getSymbolVertexShader(!0),hitFragmentShader:!this.hitDetectionDisabled_&&this.parseResult_.builder.getSymbolFragmentShader(!0),uniforms:this.parseResult_.uniforms,attributes:this.parseResult_.attributes})}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}};var yct,wct=function(t,e){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)},xct=function(t,e){return t[0]==e[0]&&t[1]==e[1]};!function(){function t(t,e){for(let i=t.length-1;i>0;i--)(t[i][0]>e&&t[i-1][0]<e||t[i][0]<e&&t[i-1][0]>e)&&t.splice(i,0,[e,(e-t[i][0])/(t[i-1][0]-t[i][0])*(t[i-1][1]-t[i][1])+t[i][1]])}function e(t,e){for(let i=t.length-1;i>0;i--)(t[i][1]>e&&t[i-1][1]<e||t[i][1]<e&&t[i-1][1]>e)&&t.splice(i,0,[(e-t[i][1])/(t[i-1][1]-t[i][1])*(t[i-1][0]-t[i][0])+t[i][0],e])}yct=function(i,n){var s=\"Polygon\"===n.getType();if(!s&&\"MultiPolygon\"!==n.getType())return null;var r=n.getCoordinates();return s&&(r=[r]),r.forEach(function(n){n.forEach(function(n){t(n,i[0]),t(n,i[2]),e(n,i[1]),e(n,i[3])})}),r.forEach(function(t){t.forEach(function(t){t.forEach(function(t){t[0]<i[0]?t[0]=i[0]:t[0]>i[2]&&(t[0]=i[2]),t[1]<i[1]?t[1]=i[1]:t[1]>i[3]&&(t[1]=i[3])})})}),s?new tW(r[0]):new V8(r)}}();var Sct=function(t,e,i,n){var s=[];!1!==n&&s.push(t);var r=wct(t,e);if(r){var o=Math.round(r/i);if(o>1)for(var a=(e[0]-t[0])/o,l=(e[1]-t[1])/o,c=1;c<o;c++)s.push([t[0]+a*c,t[1]+l*c])}return s.push(e),s};D8.prototype.sampleAt=function(t){for(var e=this.getCoordinates(),i=[],n=1;n<e.length;n++)i=i.concat(Sct(e[n-1],e[n],t,1===n));return new D8(i)},F8.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){for(var n=[],s=1;s<e.length;s++)n=n.concat(Sct(e[s-1],e[s],t,1===s));i.push(n)}),new F8(i)},tW.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){for(var n=[],s=1;s<e.length;s++)n=n.concat(Sct(e[s-1],e[s],t,1===s));i.push(n)}),new tW(i)},V8.prototype.sampleAt=function(t){var e=this.getCoordinates(),i=[];return e.forEach(function(e){var n=[];i.push(n),e.forEach(function(e){for(var i=[],s=1;s<e.length;s++)i=i.concat(Sct(e[s-1],e[s],t,1===s));n.push(i)})}),new V8(i)},Wat.prototype.intersection=function(t,e){if(t.sampleAt){var i=oz(this.getCenter().concat(this.getCenter()),this.getRadius());t=(t=yct(i,t)).simplify(e);var n=this.getCenter(),s=this.getRadius(),r=t.sampleAt(e).getCoordinates();switch(t.getType()){case\"Polygon\":r=[r];case\"MultiPolygon\":var o=!1,a=[];return r.forEach(function(t){var e=[];a.push(e),t.forEach(function(t){var i=[];e.push(i),t.forEach(function(t){var e=wct(n,t);e>s?(o=!0,i.push([n[0]+s/e*(t[0]-n[0]),n[1]+s/e*(t[1]-n[1])])):i.push(t)})})}),o?\"Polygon\"===t.getType()?new tW(a[0]):new V8(a):t}}else console.warn(\"[ol/geom/Circle~intersection] Unsupported geometry type: \"+t.getType());return t},D8.prototype.splitAt=function(t,e){var i;if(!t)return[this];if(e||(e=1e-10),t.length&&t[0].length){var n=[this];for(i=0;i<t.length;i++){for(var s=[],r=0;r<n.length;r++){var o=n[r].splitAt(t[i],e);s=s.concat(o)}n=s}return n}if(xct(t,this.getFirstCoordinate())||xct(t,this.getLastCoordinate()))return[this];var a=this.getCoordinates(),l=[a[0]],c=[];for(i=0;i<a.length-1;i++)if(!xct(a[i],a[i+1])){if(xct(t,a[i+1]))l.push(a[i+1]),c.push(new D8(l)),l=[];else if(!xct(t,a[i])){var h,u=!1;a[i][0]==a[i+1][0]?(h=(a[i][1]-t[1])/(a[i][1]-a[i+1][1]),u=a[i][0]==t[0]&&0<h&&h<=1):a[i][1]==a[i+1][1]?(h=(a[i][0]-t[0])/(a[i][0]-a[i+1][0]),u=a[i][1]==t[1]&&0<h&&h<=1):(h=(a[i][0]-t[0])/(a[i][0]-a[i+1][0]),u=Math.abs(h-(a[i][1]-t[1])/(a[i][1]-a[i+1][1]))<=e&&0<h&&h<=1),u&&(l.push(t),c.push(new D8(l)),l=[t])}l.push(a[i+1])}return l.length>1&&c.push(new D8(l)),c.length?c:[this]};var Cct=class extends S7{constructor(t){super({stroke:(t=t||{}).stroke,text:t.text,zIndex:t.zIndex,geometry:t.geometry}),this.setRenderer(this._render.bind(this)),this._visible=!1!==t.visible,\"function\"==typeof t.width?this._widthFn=t.width:this.setWidth(t.width),this.setWidth2(t.width2),\"function\"==typeof t.color?this._colorFn=t.color:this.setColor(t.color),this.setColor2(t.color2),this.setLineCap(t.lineCap),this.setArrow(t.arrow),this.setArrowSize(t.arrowSize),this.setArrowColor(t.arrowColor),this._offset=[0,0],this.setOffset(t.offset0,0),this.setOffset(t.offset1,1),this._noOverlap=t.noOverlap}setWidth(t){this._width=t||0}setWidth2(t){this._width2=t}getOffset(t){return this._offset[t]}setOffset(t,e){switch(t=Math.max(0,parseFloat(t)),e){case 0:this._offset[0]=t;break;case 1:this._offset[1]=t}}setLineCap(t){this._lineCap=\"round\"===t?\"round\":\"butt\"}getWidth(t,e){return this._widthFn?this._widthFn(t,e):this._width+((\"number\"==typeof this._width2?this._width2:this._width)-this._width)*e}setColor(t){try{this._color=y8(t)}catch(e){this._color=[0,0,0,1]}}setColor2(t){try{this._color2=y8(t)}catch(e){this._color2=null}}setArrowColor(t){try{this._acolor=v8(t)}catch(e){this._acolor=null}}getColor(t,e){if(this._colorFn)return v8(this._colorFn(t,e));var i=this._color,n=this._color2||this._color;return\"rgba(\"+ +Math.round(i[0]+(n[0]-i[0])*e)+\",\"+Math.round(i[1]+(n[1]-i[1])*e)+\",\"+Math.round(i[2]+(n[2]-i[2])*e)+\",\"+(i[3]+(n[3]-i[3])*e)+\")\"}getArrow(){return this._arrow}setArrow(t){this._arrow=parseInt(t),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)}getArrowSize(){return this._arrowSize||[16,16]}setArrowSize(t){Array.isArray(t)?this._arrowSize=t:\"number\"==typeof t&&(this._arrowSize=[t,t])}drawArrow(t,e,i,n,s){var r=this.getArrowSize()[0]*s,o=wct(e,i),a=(e[0]-i[0])/o,l=(e[1]-i[1])/o;n=Math.max(this.getArrowSize()[1]/2,n/2)*s,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[0]-r*a+n*l,e[1]-r*l-n*a),t.lineTo(e[0]-r*a-n*l,e[1]-r*l+n*a),t.lineTo(e[0],e[1]),t.fill()}_render(t,e){if(\"LineString\"===e.geometry.getType()){var i,n,s,r=e.context;if(!this._visible){var o=e.pixelRatio/e.resolution,a=Math.cos(e.rotation),l=Math.sin(e.rotation);n=e.geometry.getCoordinates();var c=t[0][0]-n[0][0]*o*a-n[0][1]*o*l,h=t[0][1]-n[0][0]*o*l+n[0][1]*o*a;for(t=[],i=0;s=n[i];i++)t[i]=[c+s[0]*o*a+s[1]*o*l,h+s[0]*o*l-s[1]*o*a,s[2]]}var u=this.getArrowSize()[0]*e.pixelRatio;r.save(),this.getOffset(0)&&this._splitAsize(t,this.getOffset(0)*e.pixelRatio),this.getOffset(1)&&this._splitAsize(t,this.getOffset(1)*e.pixelRatio,!0),t.length>1&&(-1===this.getArrow()||2===this.getArrow())&&(s=this._splitAsize(t,u),r.fillStyle=this._acolor?this._acolor:this.getColor(e.feature,0),this.drawArrow(r,s[0],s[1],this.getWidth(e.feature,0),e.pixelRatio)),t.length>1&&this.getArrow()>0&&(s=this._splitAsize(t,u,!0),r.fillStyle=this._acolor?this._acolor:this.getColor(e.feature,1),this.drawArrow(r,s[0],s[1],this.getWidth(e.feature,1),e.pixelRatio));var d=this._splitInto(t,255,2),p=0,f=d.length;if(r.lineJoin=\"round\",r.lineCap=this._lineCap||\"butt\",d.length>1)for(p=0;p<d.length;p++){var m=p/f;for(n=d[p],r.lineWidth=this.getWidth(e.feature,m)*e.pixelRatio,r.strokeStyle=this.getColor(e.feature,m),r.beginPath(),r.moveTo(n[0][0],n[0][1]),i=1;s=n[i];i++)r.lineTo(s[0],s[1]);r.stroke()}r.restore()}}_splitAsize(t,e,i){var n,s,r,o,a=0;for(n=r=i?t.pop():t.shift();t.length;){if(s=i?t.pop():t.shift(),a+(o=wct(n,s))>e){o=wct(n=[n[0]+(s[0]-n[0])*(e-a)/o,n[1]+(s[1]-n[1])*(e-a)/o],r),i?(t.push(s),t.push(n),t.push([n[0]+(r[0]-n[0])/o,n[1]+(r[1]-n[1])/o])):(t.unshift(s),t.unshift(n),t.unshift([n[0]+(r[0]-n[0])/o,n[1]+(r[1]-n[1])/o]));break}a+=o,n=s}return[r,n]}_splitInto(t,e,i){var n,s,r,o=this._noOverlap?1:.9,a=[],l=0;for(n=1;s=t[n];n++)l+=wct(t[n-1],s);var c=Math.max(i||2,l/(e||255)),h=t[0];l=0;var u=[h];for(n=1,s=t[1];n<t.length;){var d=s[0]-h[0],p=s[1]-h[1];if(l+(r=Math.sqrt(d*d+p*p))>c){var f=(c-l)/r;u.push([h[0]+d*f,h[1]+p*f]),a.push(u),u=[h=[h[0]+d*f*o,h[1]+p*f*o]],l=0}else l+=r,u.push(h=s),s=t[++n]}return a.push(u),a}};const kct=[13e3,12500,12e3,11500,11e3,10500,1e4,9500,9e3,8500,8500,7500,7e3,6500,6e3,5500,5e3,4500,4e3,3500,3e3,2500,2e3,1500,1200,1e3,800,600,400,300,200,100],Ect=[\"#ff0000\",\"#ff00e4\",\"#d800ff\",\"#ae00ff\",\"#9600ff\",\"#7800ff\",\"#6000ff\",\"#4e00ff\",\"#3600ff\",\"#2400ff\",\"#1200ff\",\"#0000ff\",\"#001eff\",\"#0030ff\",\"#0054ff\",\"#0078ff\",\"#0096ff\",\"#00a8ff\",\"#00c0ff\",\"#00eaff\",\"#00ffe4\",\"#00ffd2\",\"#00ff9c\",\"#00ff72\",\"#00ff36\",\"#00ff0c\",\"#1eff00\",\"#42ff00\",\"#ccff00\",\"#f0ff00\",\"#ffea00\",\"#ffe062\"],Mct=Ect.map(t=>IH(t));function Tct(t){return(t*=.3048)<=100?\"#ffffff\":Ect[kct.findIndex(e=>e<t)]}class Ict extends l8{constructor(t,e,i,n){super({geometry:new D8([PV(t),PV(e)])}),super.setStyle(new Cct({color:Tct(i),color2:Tct(n),width:2}))}}class Pct extends l8{constructor(t){super({geometry:new WG(PV([t.lon,t.lat]))}),this.position=t;const[e,i,n]=function(t){return(t*=.3048)<=100?[255,255,255]:Mct[kct.findIndex(e=>e<t)]}(t.altitude);this.set(\"red\",e,!0),this.set(\"green\",i,!0),this.set(\"blue\",n,!0)}}class Oct extends l8{constructor(t,e){super({geometry:new WG(PV([t.lon,t.lat]))}),this.position=t;const i=nG[e];this.set(\"red\",i[0],!0),this.set(\"green\",i[1],!0),this.set(\"blue\",i[2],!0)}}const Rct=iG.map(t=>new S7({stroke:new U8({color:t,width:2})})),Dct=iG.map(t=>new S7({stroke:new U8({color:t,lineDash:[5,15],width:2})}));class Lct extends l8{constructor(t,e,i){super({geometry:new D8([PV(t),PV(e)])}),super.setStyle(i)}}let Fct=(()=>{class t{constructor(t,e,i){this.eventsService=t,this.fleetsService=e,this.selectionService=i,this.trails$=new Jp([]),JT([this.eventsService.additionalShipTrail$,this.fleetsService.fleetTrails$,this.selectionService.trails$]).subscribe(([t,e,i])=>{this.trails$.next([t,...e,...i].filter(t=>!!t))})}clear(){this.trails$.next([])}}return t.\\u0275fac=function(e){return new(e||t)(Mn(FY),Mn(zY),Mn(IY))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),Nct=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.interactionsService=t,this.mapConfigService=e,this.mapService=i,this.mapStateService=n,this.tooltipsService=s,this.trailsLayerService=r,this.pointerMoveSubscription=new d,this.show=!1}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.positionsSource=new Fat({features:[]}),this.positionsLayer=new bct({source:this.positionsSource,zIndex:Cot.z60,style:{symbol:{symbolType:\"circle\",size:9,color:[\"color\",[\"get\",\"red\"],[\"get\",\"green\"],[\"get\",\"blue\"]],offset:[0,0]}}}),this.positionsLayer.selectable=!0,this.map.addLayer(this.positionsLayer),this.trailSource=new Fat({features:[],wrapX:!1}),this.trailsLayer=new Pat({source:this.trailSource,zIndex:Cot.z60,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.map.addLayer(this.trailsLayer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.positionsLayer.selectable=t})),this.subscriptions.push(this.mapStateService.showTrailsLayer$.subscribe(t=>{this.show=t,this.updatePositionsLayerVisibility(),this.trailsLayer.setVisible(this.show),this.show?this.pointerMoveSubscription=this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}):this.pointerMoveSubscription.unsubscribe()})),this.subscriptions.push(this.trailsLayerService.trails$.pipe(Tf((t,e)=>function(t,e){return t.length===e.length&&t.every((t,i)=>t===e[i])}(t,e))).subscribe(t=>{const e=[],i=[];t.filter(t=>{var e;return!!(null===(e=t[0])||void 0===e?void 0:e.ship)}).forEach((t,n)=>{e.push(...t.map(t=>new Oct(t,n%iG.length))),i.push(...function(t,e){if(t.length<2)return[];const i=[];for(let n=1;n<t.length;n++){const s=t[n-1],r=t[n];i.push(new Lct([s.lon,s.lat],[r.lon,r.lat],(t[n-1].gap?Dct:Rct)[e%iG.length]))}return i}(t,n))}),t.filter(t=>{var e;return!!(null===(e=t[0])||void 0===e?void 0:e.aircraft)}).forEach((t,n)=>{e.push(...t.map(t=>new Pct(t))),i.push(...function(t,e){if(t.length<2)return[];const i=[];for(let n=1;n<t.length;n++){const e=t[n-1],s=t[n];i.push(new Ict([e.lon,e.lat],[s.lon,s.lat],e.altitude,s.altitude))}return i}(t))}),this.trailSource.clear(!0),this.positionsSource.clear(!0),this.trailSource.addFeatures(i),this.positionsSource.addFeatures(e)})),this.subscriptions.push(this.mapService.view$.subscribe(()=>{this.updatePositionsLayerVisibility()})),this.eventListeners.push(this.map.on(\"click\",t=>this.handleClickEvent(t)))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.positionsLayer),this.map.removeLayer(this.trailsLayer),this.pointerMoveSubscription.unsubscribe()}handleClickEvent(t){this.positionsLayer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(t.position.ship?this.interactionsService.clickOnEntity(NH.ShipPosition,t.position):t.position.aircraft&&this.interactionsService.clickOnEntity(NH.AircraftPosition,t.position),!0),{hitTolerance:3,layerFilter:t=>t===this.positionsLayer})}handleMoveEvent(t){if(this.positionsLayer.selectable){let e=!1,i=!1;this.map.forEachFeatureAtPixel(t.pixel,t=>(t.position.ship?(e=!0,this.tooltipsService.hoverEntity(NH.ShipPosition,t.position)):t.position.aircraft&&(i=!0,this.tooltipsService.hoverEntity(NH.AircraftPosition,t.position)),!0),{hitTolerance:3,layerFilter:t=>t===this.positionsLayer}),e||this.tooltipsService.hoverEntity(NH.ShipPosition,null),i||this.tooltipsService.hoverEntity(NH.AircraftPosition,null)}}updatePositionsLayerVisibility(){const t=this.mapService.view$.value;this.positionsLayer.setVisible(this.show&&t&&(!this.mapConfigService.hidePositionsInLowZooms$.value||t.zoom>=8))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(DY),Oa(qU),Oa(Pj),Oa(Fq),Oa(RY),Oa(Fct))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-trails-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class Bct{constructor(t){if(this.hexCode={0:\"0000\",1:\"0001\",2:\"0010\",3:\"0011\",4:\"0100\",5:\"0101\",6:\"0110\",7:\"0111\",8:\"1000\",9:\"1001\",a:\"1010\",b:\"1011\",c:\"1100\",d:\"1101\",e:\"1110\",f:\"1111\"},this.bits=\"\",null!=t){15===t.length&&(this.bits+=\"0000\");for(let e=0;e<t.length;e++)this.bits+=this.hexCode[t[e]]}}getLiteral(){const t=this.getLiteralArr();let e=`${t[0]}`;for(let i=1;i<t.length;i++)(i-1)%3==0&&(e+=\"-\"),e+=`${t[i]}`;return e}getLiteralEdge(t){const e=this.getLiteralArr(),i=t.getLiteralArr();let n=`${e[0]}`;for(let s=1;s<e.length-1;s++)(s-1)%3==0&&(n+=\"-\"),n+=`${e[s]}`;return n+=` / ${e[e.length-1]}-${i[i.length-1]}`,n}getLiteralArr(){const t=[];t.push(this.getFaceNb());for(let e=1;e<=15;e++){const i=this.getCellNb(e);7!==i&&t.push(i)}return t}getFaceNb(){let t=\"\";for(let e=12;e<19;e++)t=this.bits[e]+t;return t=this.reverse(t),parseInt(t,2)}getCellNb(t){let e=\"\";const i=16+3*t;for(let n=i;n<i+3;n++)e=this.bits[n]+e;return e=this.reverse(e),parseInt(e,2)}reverse(t){return t.split(\"\").reverse().join(\"\")}}function zct(t){const e=t.getGeometry(),i=new U8({color:vlt[t.element.edge?t.element.res:t.element.res+1],lineCap:\"square\",width:4}),n=[new S7({stroke:i})];return t.element.edge&&e.forEachSegment((e,s)=>{const r=Math.atan2(s[1]-e[1],s[0]-e[0]),o=5+10*Math.pow(12-t.element.res,2),a=new D8([s,[s[0]-o,s[1]+o]]);a.rotate(r,s);const l=new D8([s,[s[0]-o,s[1]-o]]);l.rotate(r,s),n.push(new S7({geometry:a,stroke:i})),n.push(new S7({geometry:l,stroke:i}))}),n}class Vct extends l8{constructor(t,e){super({geometry:2===e.length?new D8(e):new tW(e)}),this.element=t,super.setStyle(zct)}static New(t){return new Vct(t,Vct.PointsArr(t))}static PointsArr(t){let e=[];if(Cj(t.h3index)){const i=xj(t.h3index),n=Sj(t.h3index),s=_j(i),r=_j(n);t.edge=!0,t.lat=r[0],t.lon=r[1];const o=new Bct(i),a=new Bct(n);t.literal=o.getLiteralEdge(a),e.push(PV([s[1],s[0]])),e.push(PV([r[1],r[0]])),t.shift&&Vct.shift(e,15-t.res)}else{const i=_j(t.h3index);t.edge=!1,t.lat=i[0],t.lon=i[1];const n=new Bct(t.h3index);t.literal=n.getLiteral(),e=[bj(t.h3index,!0).map(t=>PV(t))]}return e}static shift(t,e){const i=t[0],n=t[1],s=Math.atan2(n[1]-i[1],n[0]-i[0]),r=4*e,o=[Math.sin(s)*r+i[0],-Math.cos(s)*r+i[1]],a=[Math.sin(s)*r+n[0],-Math.cos(s)*r+n[1]];t[0]=o,t[1]=a}}class $ct{static reversedEdge(t){const e=kj(t);return function(t,e){var i=rj(t),n=i[0],s=i[1],r=rj(e);return hj(QU.getH3UnidirectionalEdge(n,s,r[0],r[1]))}(e[1],e[0])}}let Uct=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.h3TracesLayerService=t,this.interactionsService=e,this.tooltipsService=i,this.mapConfigService=n,this.mapService=s,this.mapStateService=r}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.h3ElementsSource=new Fat({features:[]}),this.h3ElementsLayer=new Pat({source:this.h3ElementsSource,zIndex:Cot.z20,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.h3ElementsLayer.selectable=!0,this.map.addLayer(this.h3ElementsLayer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.h3ElementsLayer.selectable=t})),this.subscriptions.push(this.mapService.view$.subscribe(t=>{t&&this.h3ElementsLayer.setVisible(!this.mapConfigService.hidePositionsInLowZooms$.value||t.zoom>=8)})),this.subscriptions.push(this.h3TracesLayerService.trails$.subscribe(t=>{this.h3ElementsSource.clear(!0),this.mapConfigService.debugH3Trace$.value&&this.h3ElementsSource.addFeatures(t.map(jct).flat())})),this.eventListeners.push(this.map.on(\"click\",t=>{this.handleClickEvent(t)})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.h3ElementsLayer)}handleClickEvent(t){this.h3ElementsLayer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(NH.H3Element,t.element),!0),{hitTolerance:3,layerFilter:t=>t===this.h3ElementsLayer})}handleMoveEvent(t){this.h3ElementsLayer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(NH.H3Element,t.element),!0),{hitTolerance:3,layerFilter:t=>t===this.h3ElementsLayer})||this.tooltipsService.hoverEntity(NH.H3Element,null))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(tG),Oa(DY),Oa(RY),Oa(qU),Oa(Pj),Oa(Fq))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-h3traces-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();function jct(t){const e=t.elements,i=[],n={};for(let s=1;s<e.length;s++){const t=e[s];Cj(t.h3index)&&(n[t.h3index]=1,n[$ct.reversedEdge(t.h3index)]&&(t.shift=!0)),i.push(Vct.New(t))}return i}class Hct extends Jlt{prepareFrameInternal(t){const e=this.getLayer(),i=e.getSource(),n=t.viewState,s=!t.viewHints[0]&&!t.viewHints[1],r=!Az(this.previousExtent_,t.extent),o=this.sourceRevision_<i.getRevision();return o&&(this.sourceRevision_=i.getRevision()),(s&&r||o)&&(clearTimeout(this.pendingBufferRefresh),this.pendingBufferRefresh=setTimeout(()=>{if(!this.helper)return;const s=n.projection,r=n.resolution,o=e instanceof Yot?e.getRenderBuffer():0,a=oz(t.extent,o*r);i.loadFeatures(a,r,s),this.rebuildBuffers_(t),this.previousExtent_=t.extent.slice()},300)),this.helper.useProgram(this.program_,t),this.helper.prepareDraw(t),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}}var Gct=(()=>(function(t){t[t.Ship=0]=\"Ship\",t[t.Point=1]=\"Point\",t[t.Beacon=2]=\"Beacon\",t[t.Helicopter=3]=\"Helicopter\"}(Gct||(Gct={})),Gct))();const Wct={aircraft:\"/assets/images/aircraft.png\",ship:\"/assets/images/ship.png\",point:\"/assets/images/point.png\",beacon:\"/assets/images/beacon.png\",helicopter:\"/assets/images/helicopter.png\"},qct={};let Yct=(()=>{class t{init(){return Hp(this,void 0,void 0,function*(){yield Promise.all(Object.entries(Wct).map(([t,e])=>Hp(this,void 0,void 0,function*(){qct[t]=yield function(t){return Hp(this,void 0,void 0,function*(){return new Promise(e=>{const i=new Image;i.src=t,i.onload=()=>{e(i)}})})}(e)})))})}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();class Zct extends jrt{createRenderer(){const t=new Hct(this,{attributes:[{name:\"angle\",callback:t=>t.ship.beacon?.4:t.ship.course},{name:\"red\",callback:t=>t.iconColor[0]},{name:\"green\",callback:t=>t.iconColor[1]},{name:\"blue\",callback:t=>t.iconColor[2]},{name:\"alpha\",callback:t=>t.ship.visible?t.ship.transparent?.5:1:0},{name:\"iconKey\",callback:t=>t.iconKey}],uniforms:{u_texture_point:qct.point,u_texture_ship:qct.ship,u_texture_beacon:qct.beacon,u_texture_helicopter:qct.helicopter,u_iconSize:12},vertexShader:\"\\nprecision mediump float;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_iconSize;\\n\\nattribute vec2 a_position;\\nattribute float a_index;\\nattribute float a_angle;\\nattribute float a_red;\\nattribute float a_green;\\nattribute float a_blue;\\nattribute float a_alpha;\\nattribute float a_iconKey;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_color;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  vec2 size = vec2(u_iconSize);\\n  mat4 offsetMatrix = u_offsetScaleMatrix;\\n  vec2 offset = vec2(0.0);\\n  float offsetX = a_index == 0.0 || a_index == 3.0 ? offset.x - size.x / 2.0 : offset.x + size.x / 2.0;\\n  float offsetY = a_index == 0.0 || a_index == 1.0 ? offset.y - size.y / 2.0 : offset.y + size.y / 2.0;\\n  vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\\n\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\\n\\n  vec4 texCoord = vec4(0.0, 0.0, 1.0, 1.0);\\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.q;\\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.p;\\n  v_texCoord = vec2(u, v);\\n\\n  if (a_iconKey != 1.0) {\\n    vec2 rotationVector = vec2(sin(a_angle), cos(a_angle));\\n    vec2 centeredTexCoord = v_texCoord - 0.5;\\n    vec2 rotatedPosition = vec2(\\n      centeredTexCoord.x * rotationVector.y + centeredTexCoord.y * rotationVector.x,\\n      centeredTexCoord.y * rotationVector.y - centeredTexCoord.x * rotationVector.x\\n    ) + 0.5;\\n    v_texCoord = rotatedPosition;\\n  }\\n\\n  v_color = vec4(a_red, a_green, a_blue, a_alpha);\\n  v_iconKey = a_iconKey;\\n  v_alpha = a_alpha;\\n}\\n\",fragmentShader:\"\\nprecision mediump float;\\n\\nuniform sampler2D u_texture_ship;\\nuniform sampler2D u_texture_point;\\nuniform sampler2D u_texture_beacon;\\nuniform sampler2D u_texture_helicopter;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_color;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  if (v_alpha == 0.0) {\\n    discard;\\n  }\\n  vec4 textureColor;\\n  if (v_iconKey == 0.0) {\\n    textureColor = texture2D(u_texture_ship, v_texCoord);\\n  } else if (v_iconKey == 1.0) {\\n    textureColor = texture2D(u_texture_point, v_texCoord);\\n  } else if (v_iconKey == 2.0) {\\n    textureColor = texture2D(u_texture_beacon, v_texCoord);\\n  } else if (v_iconKey == 3.0) {\\n    textureColor = texture2D(u_texture_helicopter, v_texCoord);\\n  } else {\\n    // error\\n  }\\n  gl_FragColor = v_color * textureColor;\\n  gl_FragColor.rgb *= gl_FragColor.a;\\n}\\n\",hitVertexShader:\"\\nprecision mediump float;\\n\\nuniform mat4 u_projectionMatrix;\\nuniform mat4 u_offsetScaleMatrix;\\nuniform mat4 u_offsetRotateMatrix;\\nuniform float u_iconSize;\\n\\nattribute vec2 a_position;\\nattribute float a_index;\\nattribute vec4 a_hitColor;\\nattribute float a_angle;\\nattribute float a_iconKey;\\nattribute float a_alpha;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_hitColor;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  float size = u_iconSize;\\n  mat4 offsetMatrix = u_offsetScaleMatrix;\\n  float offsetX = a_index == 0.0 || a_index == 3.0 ? -size / 2.0 : size / 2.0;\\n  float offsetY = a_index == 0.0 || a_index == 1.0 ? -size / 2.0 : size / 2.0;\\n  vec4 offsets = offsetMatrix * vec4(offsetX, offsetY, 0.0, 0.0);\\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\\n\\n  vec4 texCoord = vec4(0.0, 0.0, 1.0, 1.0);\\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.q;\\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.p;\\n  v_texCoord = vec2(u, v);\\n\\n  if (a_iconKey != 1.0) {\\n    vec2 rotationVector = vec2(sin(a_angle), cos(a_angle));\\n    vec2 centeredTexCoord = vec2(u, v) - 0.5;\\n    vec2 rotatedPosition = vec2(\\n      centeredTexCoord.x * rotationVector.y + centeredTexCoord.y * rotationVector.x,\\n      centeredTexCoord.y * rotationVector.y - centeredTexCoord.x * rotationVector.x\\n    ) + 0.5;\\n    v_texCoord = rotatedPosition;\\n  }\\n\\n  v_hitColor = a_hitColor;\\n  v_iconKey = a_iconKey;\\n  v_alpha = a_alpha;\\n}\\n\",hitFragmentShader:\"\\nprecision mediump float;\\n\\nuniform sampler2D u_texture_ship;\\nuniform sampler2D u_texture_point;\\nuniform sampler2D u_texture_beacon;\\nuniform sampler2D u_texture_helicopter;\\n\\nvarying vec2 v_texCoord;\\nvarying vec4 v_hitColor;\\nvarying float v_iconKey;\\nvarying float v_alpha;\\n\\nvoid main(void) {\\n  if (v_alpha == 0.0) {\\n    discard;\\n  }\\n  vec4 textureColor;\\n  if (v_iconKey == 0.0) {\\n    textureColor = texture2D(u_texture_ship, v_texCoord);\\n  } else if (v_iconKey == 1.0) {\\n    textureColor = texture2D(u_texture_point, v_texCoord);\\n  } else if (v_iconKey == 2.0) {\\n    textureColor = texture2D(u_texture_beacon, v_texCoord);\\n  } else if (v_iconKey == 3.0) {\\n    textureColor = texture2D(u_texture_helicopter, v_texCoord);\\n  } else {\\n    // error\\n  }\\n  if (textureColor.a < 0.1) {\\n    discard;\\n  }\\n\\n  gl_FragColor = v_hitColor;\\n}\\n\"});return t.renderDeclutter=function(){},t}disposeInternal(){this.renderer_.dispose(),super.disposeInternal()}}const Kct=TH(\"#000000\"),Xct=TH(\"#f31717\"),Qct=TH(\"#fddb21\"),Jct=TH(\"#3fd830\");class tht extends l8{constructor(t,e){super({geometry:new WG(PV(e>0?eht(t,e):[t.lon,t.lat]))}),this.ship=t}updateStyle(t){this.ship.visible?(this.iconColor=t.colorModeShipType?this.ship.shipType.rgbColor:this.ship.colorResultTimestamp>=t.absoluteImportantTimestamp?Xct:this.ship.colorResultTimestamp>=t.absoluteMinimumTimestamp?Qct:Jct,this.iconKey=this.ship.sarAircraft?Gct.Helicopter:this.ship.beacon?Gct.Beacon:this.ship.stationary?Gct.Point:Gct.Ship):this.iconColor=Kct}updateShip(t,e){e>0?this.extrapolatePosition(e):this.ship.lon!==t.lon&&this.ship.lat!==t.lat&&super.getGeometry().setCoordinates(PV([t.lon,t.lat])),this.ship=t}extrapolatePosition(t){t>0&&super.getGeometry().setCoordinates(PV(eht(this.ship,t)))}}function eht(t,e){const{lon:i,lat:n,course:s,numberSog:r,timestamp:o}=t,a=e-o;return a>0?function([t,e],i,n){const s=6378137;let r=e*Math.PI/180,o=t*Math.PI/180;return r=Math.asin(Math.sin(r)*Math.cos(i/s)+Math.cos(r)*Math.sin(i/s)*Math.cos(n)),o+=Math.atan2(Math.sin(n)*Math.sin(i/s)*Math.cos(r),Math.cos(i/s)-Math.sin(r)*Math.sin(r)),[180*o/Math.PI,180*r/Math.PI]}([i,n],a*r/1.944,s):[i,n]}let iht=(()=>{class t{constructor(t,e,i){this.fleetsService=t,this.mapConfigService=e,this.selectionService=i,this.selectedShips$=new Jp([]),JT([this.fleetsService.selectedFleet$.pipe(M(t=>t?t.ships:[])),this.selectionService.entities$.pipe(M(t=>t.filter(t=>!!t.entity&&t.type===NH.Ship).map(t=>t.entity)))]).subscribe(([t,e])=>{const i=function(t){const e={};for(const i of t)e[i.mmsi]=i;return Object.values(e)}([].concat(...t,...e));this.mapConfigService.updateSelectedShipsFilter(i.map(t=>t.mmsi)),this.selectedShips$.next(i)})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(zY),Mn(qU),Mn(IY))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),nht=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o,a,l,c,h,u,d){super(),this.ngZone=t,this.configService=e,this.exportService=i,this.historyService=n,this.interactionsService=s,this.mapConfigService=r,this.mapService=o,this.mapStateService=a,this.offlineService=l,this.selectedShipsService=c,this.shipsService=h,this.workerService=u,this.tooltipsService=d,this.shipFeaturesByArea=new Map,this.timestampByArea=new Map,this.oldTimestamp=-1,this.viewedAreas=[],this.chunkedFeedUpdateByArea=new Map,this.selectedShipsFeaturesByMMSI=new Map,this.rendererIconSizeUniform$=new C}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new Zct({source:this.source,zIndex:Cot.z80}),this.layer.selectable=!0,this.map.addLayer(this.layer);const t=()=>{if(this.layer.getRenderer().helper){this.layer.removeEventListener(\"change\",t);const e=this.layer.getRenderer().helper.uniforms_.find(t=>\"u_iconSize\"===t.name);this.rendererIconSizeUniform$.next(e),this.layer.getRenderer().helper.getCanvas().addEventListener(\"webglcontextlost\",t=>{if(this.mapService.hasBooted$.value)throw new Error(\"Le contexte WebGL a \\xe9t\\xe9 perdu (les navires et avions ne sont plus affichables). Veuillez rafraichir l'onglet ou fermer puis r\\xe9ouvrir votre navigateur.\")},{once:!0})}};this.layer.addEventListener(\"change\",t),this.subscriptions.push(JT([this.mapService.view$,this.rendererIconSizeUniform$]).subscribe(([t,e])=>{if(!t)return;const i=Math.min(Math.round((t.zoom-4)/12*16+12),28);i!==e.value&&(e.value=i,this.layer.changed()),this.viewedAreas=hB(MU.fromOLExtent(this.mapService.view$.value.extent).toLatLonExtent()).map(t=>t.id)}),this.mapStateService.showShipsLayer$.subscribe(t=>{t||(this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)),setTimeout(()=>{this.layer.setVisible(t)})}),this.mapStateService.showShipsLayer$.pipe(kf(1),Af(t=>t)).subscribe(()=>{for(const t of this.selectedShipsFeaturesByMMSI.values())this.source.hasFeature(t)||this.source.addFeature(t)}),this.offlineService.isOffline$.pipe(ug(),Af(([t,e])=>t!==e)).subscribe(()=>{this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)}),this.mapConfigService.manualMapFetch$.subscribe(()=>{this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)}),this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t}),this.mapConfigService.shipFilter$.subscribe(t=>{this.configService.devMode&&console.time(`ships-layer: update ${this.shipsService.shipsCount$.value} ship states`),this.source.forEachFeature(e=>{Iq(e.ship,t),e.updateStyle(t)}),this.configService.devMode&&console.timeEnd(`ships-layer: update ${this.shipsService.shipsCount$.value} ship states`),this.shipFilter=t,this.source.changed()}),this.mapConfigService.enableHistoryModeExtrapolation$.subscribe(t=>{if(t&&this.historyService.timestamp$.value>0){const t=this.historyService.timestamp$.value;this.source.forEachFeature(e=>{e.ship.stationary||e.extrapolatePosition(t)})}else this.source.forEachFeature(t=>{const{lon:e,lat:i}=t.ship;t.setGeometry(new WG(PV([e,i])))});this.source.changed()}),this.historyService.timestamp$.subscribe(t=>{(0===t&&this.oldTimestamp>0||t>0&&0===this.oldTimestamp)&&(this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0),0===t&&this.oldTimestamp>0&&this.source.addFeatures([...this.selectedShipsFeaturesByMMSI.values()])),this.oldTimestamp=t}),this.mapConfigService.restrictedAreaLonLat$.subscribe(()=>{this.shipFeaturesByArea.clear(),this.timestampByArea.clear(),this.source.clear(!0)}),this.workerService.areaShipsFeeds$.subscribe(t=>{if(!t.chunked||t.start){const e=(this.shipFeaturesByArea.get(t.area.id)||[]).reduce((t,e)=>(t[e.ship.mmsi]=e,t),{});this.chunkedFeedUpdateByArea.set(t.area.id,{featuresByMMSI:e,additions:[],updates:[]})}const e=this.chunkedFeedUpdateByArea.get(t.area.id);e||console.log(\"missing previous feedUpdate\",[...this.chunkedFeedUpdateByArea.keys()],`id=${t.area.id} chunked=${t.chunked} start=${t.start} end=${t.end} length=${t.data.length}`);let i=t.data;const n=!this.mapConfigService.manualMapFetch$.value&&this.mapConfigService.restrictedAreaLonLat$.value;if(n){const[t,e,s,r]=n;i=i.filter(i=>t<=i.lon&&i.lon<=s&&e<=i.lat&&i.lat<=r)}const s=this.mapConfigService.enableHistoryModeExtrapolation$.value&&this.historyService.timestamp$.value>0?this.historyService.timestamp$.value:0,r=[];i.filter(t=>t.lon).forEach(t=>{Iq(t,this.shipFilter);let i=e.featuresByMMSI[t.mmsi];i?(i.updateShip(t,s),e.updates.push(i)):(i=new tht(t,s),r.push(i)),i.updateStyle(this.shipFilter),delete e.featuresByMMSI[t.mmsi]}),this.source.addFeatures(r),e.additions=e.additions.concat(r),(!t.chunked||t.end)&&(Object.values(e.featuresByMMSI).forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.shipFeaturesByArea.set(t.area.id,e.updates.concat(e.additions)),this.timestampByArea.set(t.area.id,Date.now()),this.chunkedFeedUpdateByArea.delete(t.area.id),this.refreshTotalShipsCount())}),this.selectedShipsService.selectedShips$.subscribe(t=>{const e=this.historyService.timestamp$.value;if(e>0)return;const i=[],n=[],s=new Map;t.forEach(t=>{Iq(t,this.shipFilter);let r=this.selectedShipsFeaturesByMMSI.get(t.mmsi);r?(r.updateShip(t,e),n.push(r)):(r=new tht(t,e),i.push(r)),s.set(t.mmsi,r),r.updateStyle(this.shipFilter),this.selectedShipsFeaturesByMMSI.delete(t.mmsi)}),[...this.selectedShipsFeaturesByMMSI.values()].forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.source.addFeatures(i),this.selectedShipsFeaturesByMMSI=s})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(JT([this.mapService.view$.pipe(kf(1),FM(500,uf,{leading:!1,trailing:!0})),this.mapConfigService.shipFilter$,this.workerService.areaShipsFeeds$.pipe(pf(300,Zm))]).subscribe(([t])=>{const e=this.source.getFeaturesInExtent(t.extent).filter(t=>t.ship.visible).map(t=>t.ship);if(e.length<200){const t=e.sort((t,e)=>t.mmsi<e.mmsi?-1:1);this.shipsService.shipsInView$.next(t)}else this.shipsService.shipsInView$.next([]);this.shipsService.shipsInViewCount$.next(e.length)}),this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}),Wq(6e4).pipe(Af(()=>!this.mapConfigService.manualMapFetch$.value&&!this.historyService.timestamp$.value&&!this.offlineService.isOffline$.value)).subscribe(()=>{sB({category:\"app\",message:\"ship-layer: cleanup\"});const t=Date.now();for(const[e,i]of this.timestampByArea.entries())this.viewedAreas.includes(e)||i<t-18e4&&((this.shipFeaturesByArea.get(e)||[]).forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.shipFeaturesByArea.delete(e),this.timestampByArea.delete(e))})),this.exportService.registerVisibleShipsCallback(t=>this.source.getFeaturesInExtent(null!=t?t:this.map.getView().calculateExtent()).map(t=>t.ship).filter(t=>t.visible))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select ship\",t.ship),this.interactionsService.clickOnEntity(NH.Ship,t.ship),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(NH.Ship,t.ship),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(NH.Ship,null))}refreshTotalShipsCount(){let t=0;for(const e of this.shipFeaturesByArea.values())t+=e.length;this.shipsService.shipsCount$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(WU),Oa(CY),Oa(Fj),Oa(DY),Oa(qU),Oa(Pj),Oa(Fq),Oa(MY),Oa(iht),Oa(TY),Oa(sH),Oa(RY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ships-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class sht extends l8{constructor(t){super({geometry:new WG(PV([t.lon,t.lat])),rotation:t.radiansTrack}),this.aircraft=t}updateAircraft(t){this.aircraft.lon!==t.lon&&this.aircraft.lat!==t.lat&&(super.getGeometry().setCoordinates(PV([t.lon,t.lat])),super.set(\"rotation\",t.radiansTrack)),this.aircraft=t}}let rht=(()=>{class t{constructor(){this.aircraftsInView$=new Jp([])}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),oht=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o,a,l,c,h,u){super(),this.changeDetectorRef=t,this.ngZone=e,this.aircraftsService=i,this.configService=n,this.exportService=s,this.historyService=r,this.interactionsService=o,this.mapService=a,this.mapConfigService=l,this.mapStateService=c,this.tooltipsService=h,this.workerService=u,this.aircraftsFeaturesByArea=new Map,this.oldTimestamp=-1}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.changeDetectorRef.detach(),this.source=new Fat({features:[]}),this.layer=new bct({source:this.source,zIndex:Cot.z80,style:{filter:[\"==\",[\"get\",\"visible\"],1],symbol:{symbolType:\"image\",src:\"assets/images/aircraft.png\",size:[\"interpolate\",[\"linear\"],[\"zoom\"],4,12,10,30],rotation:[\"get\",\"rotation\"],offset:[0,0]}}}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.showAircraftsLayer$.subscribe(t=>{t||(this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)),setTimeout(()=>{this.layer.setVisible(t)})}),this.mapConfigService.manualMapFetch$.subscribe(()=>{this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)}),this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t}),this.mapConfigService.aircraftFilter$.subscribe(t=>{this.configService.devMode&&console.time(\"aircrafts-layer: update aircraft states\"),this.source.forEachFeature(e=>{t.apply(e)}),this.configService.devMode&&console.timeEnd(\"aircrafts-layer: update aircraft states\"),this.aircraftFilter=t,this.source.changed()}),this.historyService.timestamp$.subscribe(t=>{(0===t&&this.oldTimestamp>0||t>0&&0===this.oldTimestamp)&&(this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)),this.oldTimestamp=t}),this.mapConfigService.restrictedAreaLonLat$.subscribe(()=>{this.aircraftsFeaturesByArea.clear(),this.source.clear(!0)}),this.workerService.areaAircraftsFeeds$.subscribe(t=>{const e=(this.aircraftsFeaturesByArea.get(t.area.id)||[]).reduce((t,e)=>(t[e.aircraft.icao]=e,t),{}),i=[],n=[];let s=t.data;const r=!this.mapConfigService.manualMapFetch$.value&&this.mapConfigService.restrictedAreaLonLat$.value;if(r){const[t,e,i,n]=r;s=s.filter(s=>t<=s.lon&&s.lon<=i&&e<=s.lat&&s.lat<=n)}s.forEach(t=>{let s=e[t.icao];s?(s.updateAircraft(t),n.push(s)):(s=new sht(t),i.push(s)),this.aircraftFilter.apply(s),delete e[t.icao]}),Object.values(e).forEach(t=>{this.source.hasFeature(t)&&this.source.removeFeature(t)}),this.source.addFeatures(i),this.aircraftsFeaturesByArea.set(t.area.id,n.concat(i)),this.source.changed()})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(JT([this.mapService.view$.pipe(kf(1),FM(500,uf,{leading:!1,trailing:!0})),this.workerService.areaAircraftsFeeds$.pipe(pf(16))]).subscribe(([t])=>{const e=this.source.getFeaturesInExtent(t.extent).filter(t=>t.aircraft.visible).map(t=>t.aircraft);if(e.length<200){const t=e.sort((t,e)=>t.icao<e.icao?-1:1);this.aircraftsService.aircraftsInView$.next(t)}else this.aircraftsService.aircraftsInView$.next([])}),this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)})),this.exportService.registerVisibleAircraftsCallback(t=>this.source.getFeaturesInExtent(null!=t?t:this.map.getView().calculateExtent()).map(t=>t.aircraft).filter(t=>t.visible))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.configService.devMode&&console.log(\"DEBUG: select aircraft\",JSON.stringify(t.aircraft,null,2)),this.interactionsService.clickOnEntity(NH.Aircraft,t.aircraft),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(NH.Aircraft,t.aircraft),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(NH.Aircraft,null))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(nu),Oa(rht),Oa(WU),Oa(CY),Oa(Fj),Oa(DY),Oa(Pj),Oa(qU),Oa(Fq),Oa(RY),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-aircrafts-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();class aht extends l8{constructor(t){super({geometry:new WG(PV([t.lon,t.lat]))}),this.alert=t,this.set(\"red\",t.rgbVecColor[0],!0),this.set(\"green\",t.rgbVecColor[1],!0),this.set(\"blue\",t.rgbVecColor[2],!0)}}let lht=(()=>{class t{constructor(t,e,i){this.alertsService=t,this.fleetsService=e,this.selectionService=i,this.alerts$=new Jp([]),JT([this.alertsService.alerts$,this.fleetsService.fleetAlerts$,this.selectionService.alerts$]).subscribe(([t,e,i])=>{this.alerts$.next([...t,...e,...i])})}}return t.\\u0275fac=function(e){return new(e||t)(Mn(LH),Mn(zY),Mn(IY))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})(),cht=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.ngZone=t,this.alertsLayerService=e,this.interactionsService=i,this.mapService=n,this.mapStateService=s,this.tooltipsService=r}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new bct({source:this.source,zIndex:Cot.z60,style:{symbol:{symbolType:\"triangle\",size:18,color:[\"color\",[\"get\",\"red\"],[\"get\",\"green\"],[\"get\",\"blue\"]],offset:[0,0]}}}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t})),this.subscriptions.push(this.alertsLayerService.alerts$.subscribe(t=>{const e=t.map(t=>new aht(t));this.source.clear(!0),this.source.addFeatures(e)}),this.mapStateService.showAlertsLayer$.subscribe(t=>{this.layer.setVisible(t)})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(NH.Alert,t.alert),!0),{layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(NH.Alert,t.alert),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(NH.Alert,null))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(lht),Oa(DY),Oa(Pj),Oa(Fq),Oa(RY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-alerts-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();const hht=$H.reduce((t,e)=>(t[e.key]=IH(e.color),t),{}),uht=IH(\"grey\");class dht extends l8{constructor(t){super({geometry:new WG(PV([t.lon,t.lat]))}),this.event=t;const e=hht[t.type]||uht;this.set(\"red\",e[0],!0),this.set(\"green\",e[1],!0),this.set(\"blue\",e[2],!0)}static New(t){return new dht(t)}}let pht=(()=>{class t extends Gq{constructor(t,e,i,n,s,r){super(),this.ngZone=t,this.eventsLayerService=e,this.interactionsService=i,this.mapService=n,this.mapStateService=s,this.tooltipsService=r}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new bct({source:this.source,zIndex:Cot.z60,style:{symbol:{symbolType:\"circle\",size:9,color:[\"color\",[\"get\",\"red\"],[\"get\",\"green\"],[\"get\",\"blue\"]],offset:[0,0]}}}),this.layer.selectable=!0,this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.featuresSelectable$.subscribe(t=>{this.layer.selectable=t})),this.subscriptions.push(this.eventsLayerService.events$.subscribe(t=>{const e=t.map(dht.New);this.source.clear(!0),this.source.addFeatures(e)}),this.mapStateService.showEventsLayer$.subscribe(t=>{this.layer.setVisible(t)})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.subscriptions.push(this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){this.layer.selectable&&this.map.forEachFeatureAtPixel(t.pixel,t=>(this.interactionsService.clickOnEntity(NH.Event,t.event),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})}handleMoveEvent(t){this.layer.selectable&&(this.map.forEachFeatureAtPixel(t.pixel,t=>(this.tooltipsService.hoverEntity(NH.Event,t.event),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||this.tooltipsService.hoverEntity(NH.Event,null))}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(JH),Oa(DY),Oa(Pj),Oa(Fq),Oa(RY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-events-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();class fht extends l8{constructor(t){super(),this.updatePort(t)}updatePort(t){this.port=t,this.name=`${t.label} - ${t.iso3.toUpperCase()}\\n${t.sourcesLabels||\"\"}`,super.setId(t.id),super.setGeometry(new V8(t.h3indexes.map(t=>oW(t)))),this.resetStyle()}resetStyle(){const t=mht[this.port.color];if(!t)throw new Error(`unknown port color ${this.port.color}`);super.setStyle(new S7({text:new k7({text:this.name,font:\"11px Calibri,sans-serif\",fill:new h8({color:\"#000\"}),stroke:new U8({color:\"#fff\",width:3})}),stroke:t.getStroke(),fill:t.getFill()}))}}const mht=sG.reduce((t,e)=>(t[e]=new S7({stroke:new U8({color:e,width:1}),fill:new h8({color:`${e}1a`})}),t),{});let ght=(()=>{class t extends Gq{constructor(t,e,i,n,s,r,o,a){super(),this.ngZone=t,this.configService=e,this.interactionsService=i,this.mapService=n,this.mapStateService=s,this.portsService=r,this.portsStateService=o,this.workerService=a,this.portsUpdated$=new C}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z40,visible:!1}),this.map.addLayer(this.layer),this.subscriptions.push(this.mapStateService.isPortsSelectable$.subscribe(t=>{this.layer.selectable=t}),JT([this.mapStateService.showPortsLayer$,this.mapService.view$]).pipe(M(([t,e])=>t&&e&&e.zoom>=9),Tf()).subscribe(t=>{this.layer.setVisible(t)}),this.portsService.ports$.pipe(Af(t=>null!==t),pf(300)).subscribe(t=>{this.source.clear(!0),this.source.addFeatures(t.map(t=>new fht(t))),this.portsUpdated$.next(null)}),JT([this.mapStateService.showPortsLayer$,this.mapService.view$]).pipe(FM(500,uf,{leading:!1,trailing:!0})).subscribe(([t,e])=>{if(t&&e&&e.zoom>=9){const t=this.portsStateService.excludedPortsIds$.value,i=this.source.getFeaturesInExtent(e.extent).map(t=>t.port).filter(e=>!t.includes(e.id));this.portsStateService.updateVisiblePorts(i)}else this.portsStateService.updateVisiblePorts([])})),this.eventListeners.push(this.map.on(\"click\",t=>{this.ngZone.run(()=>{this.handleClickEvent(t)})})),this.portsUpdated$.subscribe(()=>{this.subscriptions.push(q(tf([]),this.portsStateService.excludedPortsIds$).pipe(ug()).subscribe(([t,e])=>{const i=e.filter(e=>!t.includes(e)),n=t.filter(t=>!e.includes(t));i.forEach(t=>{const e=this.source.getFeatureById(t);e?e.setStyle(wet):console.warn(`Missing feature for port '${t}'`)}),n.forEach(t=>{const e=this.source.getFeatureById(t);e?e.resetStyle():console.warn(`Missing feature for port '${t}'`)})}))})}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}handleClickEvent(t){return Hp(this,void 0,void 0,function*(){if(this.layer.selectable){const e=this.map.getFeaturesAtPixel(t.pixel,{hitTolerance:3,layerFilter:t=>t===this.layer});if(e.length>0){this.configService.devMode&&console.log(\"DEBUG: select ports\",e.map(t=>t.port));const[i,n]=OV(t.coordinate),s={kind:NH.PortClickEvent,lon:i,lat:n,ports:e.map(t=>t.port)};this.interactionsService.clickOnEntity(NH.PortClickEvent,s)}}})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(WU),Oa(DY),Oa(Pj),Oa(Fq),Oa(lK),Oa(pW),Oa(sH))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ports-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();var Aht=class extends r${constructor(t){super(),this.options=t,this.id=t.id,this.insertFirst=void 0===t.insertFirst||t.insertFirst,this.stopEvent=void 0===t.stopEvent||t.stopEvent,this.element=document.createElement(\"div\"),this.element.className=void 0!==t.className?t.className:\"ol-overlay-container ol-selectable\",this.element.style.position=\"absolute\",this.element.style.pointerEvents=\"auto\",this.autoPan=!0===t.autoPan?{}:t.autoPan||void 0,this.rendered={transform_:\"\",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(\"element\",this.handleElementChanged),this.addChangeListener(\"map\",this.handleMapChanged),this.addChangeListener(\"offset\",this.handleOffsetChanged),this.addChangeListener(\"position\",this.handlePositionChanged),this.addChangeListener(\"positioning\",this.handlePositioningChanged),void 0!==t.element&&this.setElement(t.element),this.setOffset(void 0!==t.offset?t.offset:[0,0]),this.setPositioning(t.positioning||\"top-left\"),void 0!==t.position&&this.setPosition(t.position)}getElement(){return this.get(\"element\")}getId(){return this.id}getMap(){return this.get(\"map\")||null}getOffset(){return this.get(\"offset\")}getPosition(){return this.get(\"position\")}getPositioning(){return this.get(\"positioning\")}handleElementChanged(){ZB(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(YB(this.element),QB(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=KB(t,\"postrender\",this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(\"element\",t)}setMap(t){this.set(\"map\",t)}setOffset(t){this.set(\"offset\",t)}setPosition(t){this.set(\"position\",t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(\"position\"))return;const i=this.getRect(e.getTargetElement(),e.getSize()),n=this.getElement(),s=this.getRect(n,[GB(n),WB(n)]),r=void 0===(t=t||{}).margin?20:t.margin;if(!hz(i,s)){const n=s[0]-i[0],o=i[2]-s[2],a=s[1]-i[1],l=i[3]-s[3],c=[0,0];if(n<0?c[0]=n-r:o<0&&(c[0]=Math.abs(o)+r),a<0?c[1]=a-r:l<0&&(c[1]=Math.abs(l)+r),0!==c[0]||0!==c[1]){const i=e.getView().getCenterInternal(),n=e.getPixelFromCoordinateInternal(i);if(!n)return;const s=[n[0]+c[0],n[1]+c[1]],r=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(s),duration:r.duration,easing:r.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,s=i.top+window.pageYOffset;return[n,s,n+e[0],s+e[1]]}setPositioning(t){this.set(\"positioning\",t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?\"\":\"none\",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e)return void this.setVisible(!1);const i=t.getPixelFromCoordinate(e),n=t.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(t,e){const i=this.element.style,n=this.getOffset(),s=this.getPositioning();this.setVisible(!0);let r=\"0%\",o=\"0%\";\"bottom-right\"==s||\"center-right\"==s||\"top-right\"==s?r=\"-100%\":(\"bottom-center\"==s||\"center-center\"==s||\"top-center\"==s)&&(r=\"-50%\"),\"bottom-left\"==s||\"bottom-center\"==s||\"bottom-right\"==s?o=\"-100%\":(\"center-left\"==s||\"center-center\"==s||\"center-right\"==s)&&(o=\"-50%\");const a=`translate(${r}, ${o}) translate(${Math.round(t[0]+n[0])+\"px\"}, ${Math.round(t[1]+n[1])+\"px\"})`;this.rendered.transform_!=a&&(this.rendered.transform_=a,i.transform=a)}getOptions(){return this.options}};class vht extends l8{constructor(t){super({id:t.mmsi,geometry:new WG(PV(t.position))}),this.positionIndex=0,this.ship=t,this.setStyle(new S7({image:new T8({src:\"/assets/images/ship.png\",rotation:t.course,opacity:t.visible?1:0,color:t.shipType.color})}))}}const _ht=[\"root\"],bht=[\"*\"];function yht(t,e){const i=t.getBoundingClientRect(),n=i.left+window.pageXOffset,s=i.top+window.pageYOffset;return[n,s,n+e[0],s+e[1]]}const wht=[0,-20];let xht=(()=>{class t{constructor(){this.positioning=\"bottom-center\",this.className=\"\",this.offset=wht,this.stopEvent=!0,this.autoPositioning=!1,this.opacity=1,this.webMercatorCoordinates=!1}ngOnInit(){this.overlay=new Aht({element:this.rootElement.nativeElement,positioning:this.positioning,offset:this.offset,stopEvent:this.stopEvent,insertFirst:!1,className:`ol-overlay-container ol-selectable ${this.className} ${this.autoPositioning?\"overlay-hidden\":\"overlay-positioning-bottom-center\"}`,position:this.getPosition()}),this.map.addOverlay(this.overlay),this.autoPositioning&&setTimeout(()=>{this.updatePositioning(),this.overlay.getElement().parentElement.classList.remove(\"overlay-hidden\")})}ngOnChanges(t){this.overlay&&(t.positioning&&this.overlay.setPositioning(this.positioning),t.offset&&this.overlay.setOffset(this.offset),(t.latitude||t.longitude)&&(this.overlay.setPosition(this.getPosition()),this.autoPositioning&&this.updatePositioning()))}getPosition(){return this.webMercatorCoordinates?[this.longitude,this.latitude]:PV([this.longitude,this.latitude])}ngOnDestroy(){this.map.removeOverlay(this.overlay)}updatePositioning(){if(!this.map||!this.map.getTargetElement())return;const t=yht(this.map.getTargetElement(),this.map.getSize()),e=this.overlay.getElement(),i=yht(e,[GB(e),WB(e)]);if(e.parentElement.className=e.parentElement.className.replace(/ ?overlay-positioning-\\S+/g,\"\"),hz(t,i))this.overlay.setPositioning(\"bottom-center\"),this.overlay.setOffset(wht),e.parentElement.classList.add(\"overlay-positioning-bottom-center\");else{const n=i[0]-t[0],s=t[2]-i[2],r=i[1]-t[1],o=t[3]-i[3],a=[0,0];n<0?a[0]=n-20:s<0&&(a[0]=Math.abs(s)+20),r<0?a[1]=r-20:o<0&&(a[1]=Math.abs(o)+20);let l=\"bottom\",c=\"center\",h=0,u=0;if(0!==a[0]){if(l=\"center\",0===a[1]){const e=i[3]-i[1];i[3]+e/2+20>=t[3]&&(a[1]=e/2)}a[0]>0?(c=\"right\",u=-20):(c=\"left\",u=20)}0!==a[1]&&(a[1]>0?(l=\"bottom\",h=-20):(l=\"top\",h=20));const d=`${l}-${c}`;this.overlay.setPositioning(d),this.overlay.setOffset([u,h]),e.parentElement.classList.add(`overlay-positioning-${d}`)}}}return t.\\u0275fac=function(e){return new(e||t)},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-map-tooltip\"]],viewQuery:function(t,e){if(1&t&&Th(_ht,7),2&t){let t;Mh(t=Ph())&&(e.rootElement=t.first)}},inputs:{map:\"map\",latitude:\"latitude\",longitude:\"longitude\",positioning:\"positioning\",className:\"className\",offset:\"offset\",stopEvent:\"stopEvent\",autoPositioning:\"autoPositioning\",opacity:\"opacity\",webMercatorCoordinates:\"webMercatorCoordinates\"},features:[he],ngContentSelectors:bht,decls:3,vars:2,consts:[[\"root\",\"\"]],template:function(t,e){1&t&&(Qa(),La(0,\"div\",null,0),Ja(2),Fa()),2&t&&cl(\"opacity\",e.opacity)},styles:[\".overlay-hidden{opacity:0}\\n\"],encapsulation:2,changeDetection:0}),t})();const Sht=function(t){return{transform:t}};let Cht=(()=>{class t extends Gq{constructor(t,e){super(),this.mapConfigService=t,this.mapStateService=e,this.hdms=\"\"}ngOnInit(){this.ensureMandatoryInputParams(\"ship\",\"animationTimestamp\")}ngOnChanges(t){this.hdms=this.mapStateService.coordinateSystem$.value.format(this.ship.position)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(qU),Oa(Fq))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-playback-ship-tooltip\"]],inputs:{ship:\"ship\",animationTimestamp:\"animationTimestamp\"},features:[Uo,he],decls:48,vars:20,consts:[[1,\"ship-tooltip\"],[1,\"ship-tooltip__header\"],[1,\"ship-tooltip__flag\",3,\"flag\"],[1,\"ship-tooltip__title\"],[1,\"ship-tooltip__name\"],[1,\"ship-tooltip__type\"],[1,\"ship-tooltip__row\"],[1,\"ship-tooltip__info-cell\"],[1,\"ship-tooltip__info-label\"],[3,\"vertical\"],[1,\"d-flex-center\"],[1,\"ship-tooltip__course-icon\",3,\"ngStyle\"],[1,\"ship-tooltip__footer\"],[1,\"ship-tooltip__signal-label\"],[1,\"u-flex\"]],template:function(t,e){1&t&&(La(0,\"div\",0),La(1,\"div\",1),Na(2,\"app-flag\",2),La(3,\"div\",3),La(4,\"strong\",4),xl(5),Fa(),La(6,\"small\",5),xl(7),Fa(),Fa(),Fa(),La(8,\"div\",6),La(9,\"div\",7),La(10,\"div\",8),xl(11,\"MMSI\"),Fa(),La(12,\"strong\"),xl(13),Fa(),Fa(),Na(14,\"mat-divider\",9),La(15,\"div\",7),La(16,\"div\",8),xl(17,\"IMO\"),Fa(),La(18,\"strong\"),xl(19),Fa(),Fa(),Na(20,\"mat-divider\",9),La(21,\"div\",7),La(22,\"div\",8),xl(23,\"Callsign\"),Fa(),La(24,\"strong\"),xl(25),Fa(),Fa(),Fa(),Na(26,\"mat-divider\"),La(27,\"div\",6),La(28,\"div\",7),La(29,\"div\",8),xl(30,\"Vitesse / Cap\"),Fa(),La(31,\"strong\",10),xl(32),La(33,\"mat-icon\",11),xl(34,\"arrow_right_alt\"),Fa(),Fa(),Fa(),Na(35,\"mat-divider\",9),La(36,\"div\",7),La(37,\"div\",8),xl(38,\"Position\"),Fa(),La(39,\"strong\"),xl(40),Fa(),Fa(),Fa(),La(41,\"div\",12),La(42,\"span\",13),xl(43,\"R\\xe9ception (estim\\xe9e) :\\xa0\"),Fa(),La(44,\"strong\",14),La(45,\"span\"),xl(46),ch(47,\"date\"),Fa(),Fa(),Fa(),Fa()),2&t&&(Cr(2),Ra(\"flag\",e.ship.country.flag),Cr(3),Sl(e.ship.name||\"?\"),Cr(2),Sl(e.ship.shipType.label),Cr(6),Sl(e.ship.mmsi),Cr(1),Ra(\"vertical\",!0),Cr(5),Sl(e.ship.imo||\"?\"),Cr(1),Ra(\"vertical\",!0),Cr(5),Sl(e.ship.callsign||\"?\"),Cr(7),kl(\" \",e.ship.speed,\" kt / \",(180*e.ship.course/3.14159).toFixed(0),\"\\xb0 \"),Cr(1),Ra(\"ngStyle\",ih(18,Sht,\"rotate(\"+(e.ship.course-1.570795)+\"rad)\")),Cr(2),Ra(\"vertical\",!0),Cr(5),Sl(e.hdms),Cr(6),Sl(dh(47,14,1e3*e.animationTimestamp,\"yyyy-MM-dd HH:mm:ss z\",e.mapConfigService.useUTCDates$.value&&\"+00\")))},directives:[MJ,Xq,uE,qd],pipes:[ip],styles:['.ship-tooltip[_ngcontent-%COMP%]{min-width:365px;background-color:#e7ecf0;box-shadow:0 1px 3px rgba(0,0,0,.1),0 1px 2px rgba(0,0,0,.2);border-radius:2px}.ship-tooltip[_ngcontent-%COMP%]:after{content:\" \";position:absolute;border-width:12px;border-style:solid;border-color:transparent;pointer-events:none}.ship-tooltip__header[_ngcontent-%COMP%]{background-color:#cdd1d4;display:flex}.ship-tooltip__move-icon[_ngcontent-%COMP%]{cursor:move}.ship-tooltip__link[_ngcontent-%COMP%]{flex:1;padding:0;line-height:inherit;text-align:inherit;font-size:inherit;font-weight:inherit}.ship-tooltip__link[_ngcontent-%COMP%]     .mat-button-wrapper{display:flex}.ship-tooltip__flag[_ngcontent-%COMP%]{margin:5px}.ship-tooltip__title[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:5px 0;flex:1}.ship-tooltip__name[_ngcontent-%COMP%]{font-size:1.2em}.ship-tooltip__type[_ngcontent-%COMP%]{font-size:.9em;color:#555}.ship-tooltip__row[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;font-size:.9em}.ship-tooltip__info-cell[_ngcontent-%COMP%]{padding:.4em;text-align:center}.ship-tooltip__info-label[_ngcontent-%COMP%]{color:gray;font-weight:500;padding-bottom:.2em}.ship-tooltip__course-icon[_ngcontent-%COMP%]{line-height:.7em;height:.7em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ship-tooltip__footer[_ngcontent-%COMP%]{background-color:#cdd1d4;padding-left:.4em;display:flex;align-items:center;font-size:.85em;line-height:36px}.ship-tooltip__signal-label[_ngcontent-%COMP%]{font-weight:500;color:#595959}  .overlay-positioning-center-right .ship-tooltip:after{top:50%;left:100%;margin-top:-12px;border-left-color:#cdd1d4}  .overlay-positioning-center-left .ship-tooltip:after{top:50%;right:100%;margin-top:-12px;border-right-color:#cdd1d4}  .overlay-positioning-bottom-center .ship-tooltip:after{top:100%;left:50%;margin-left:-12px;border-top-color:#cdd1d4}  .overlay-positioning-top-center .ship-tooltip:after{bottom:100%;left:50%;margin-left:-12px;border-bottom-color:#cdd1d4}'],changeDetection:0}),t})();function kht(t,e){if(1&t&&(La(0,\"app-map-tooltip\",1),Na(1,\"app-playback-ship-tooltip\",2),Fa()),2&t){const t=Ka();Ra(\"map\",t.map)(\"latitude\",t.hoveredPosition[1])(\"longitude\",t.hoveredPosition[0])(\"stopEvent\",!1)(\"autoPositioning\",!0),Cr(1),Ra(\"ship\",t.hoveredShip)(\"animationTimestamp\",t.animationTimestamp)}}let Eht=(()=>{class t extends Gq{constructor(t,e,i,n){super(),this.ngZone=t,this.elementRef=e,this.mapService=i,this.playbackService=n,this.hoveredShip=null,this.animationTimestamp=-1,this.hoveredPosition=null,this.featuresByMMSI={},this.layerRenderListener=null}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[],useSpatialIndex:!1}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z80}),this.map.addLayer(this.layer),this.overlay=new Aht({element:this.elementRef.nativeElement,positioning:\"bottom-center\",offset:[0,-20],stopEvent:!0,insertFirst:!1,className:\"ol-overlay-container ol-selectable hover-tooltip mat-elevation-z16 overlay-positioning-bottom-center\"}),this.map.addOverlay(this.overlay),this.subscriptions.push(JT([this.playbackService.active$,this.playbackService.shipsByMMSI$.pipe(M(t=>!!t))]).pipe(pf(16),M(([t,e])=>t&&!e),Tf()).subscribe(t=>{t?(this.bboxFeature=new l8(new F8([])),this.updateBboxFeatureGeometry(),this.source.addFeature(this.bboxFeature),this.layerRenderListener=this.layer.on(\"prerender\",()=>{this.updateBboxFeatureGeometry()})):this.bboxFeature&&(this.source.removeFeature(this.bboxFeature),this.bboxFeature=null,i$(this.layerRenderListener))}),this.playbackService.shipsByMMSI$.subscribe(t=>Hp(this,void 0,void 0,function*(){if(!t)return this.featuresByMMSI={},this.source.clear(!0),this.bboxFeature=null,void i$(this.layerRenderListener);this.bboxFeature&&(this.source.removeFeature(this.bboxFeature),this.bboxFeature=null,i$(this.layerRenderListener));const e=Object.values(t).filter(t=>!this.featuresByMMSI[t.mmsi]).map(t=>this.featuresByMMSI[t.mmsi]=new vht(t));this.source.addFeatures(e)})),this.playbackService.animationTimestamp$.subscribe(t=>{this.animationTimestamp=t,this.source.forEachFeature(t=>{t.getGeometry().setCoordinates(PV(t.ship.position)),t.getStyle().getImage().setRotation(t.ship.course),t.getStyle().getImage().setOpacity(t.ship.visible?1:0)}),this.source.changed(),this.hoveredShip&&(this.hoveredPosition=this.hoveredShip.position)}),this.mapService.pointerMove$.subscribe(t=>{this.ngZone.run(()=>{this.handleMoveEvent(t)})}))}ngOnDestroy(){super.ngOnDestroy(),this.hoveredShip=null,this.map.removeOverlay(this.overlay),this.map.removeLayer(this.layer),i$(this.layerRenderListener)}handleMoveEvent(t){this.map.forEachFeatureAtPixel(t.pixel,t=>(this.hoveredShip=t.ship,this.hoveredPosition=OV(t.getGeometry().getCoordinates()),!0),{hitTolerance:3,layerFilter:t=>t===this.layer})||(this.hoveredShip=null)}updateBboxFeatureGeometry(){const t=this.getRestrictedBoundingBox(),e=aW(t.getPolygon()).map(t=>PV(t));UU(this.bboxFeature.getGeometry().getCoordinates()[0]||[],e)||(this.bboxFeature.getGeometry().setCoordinates([e]),this.playbackService.updateViewBox(t.toLatLonExtent()))}getRestrictedBoundingBox(){const t=kot.fromOLView(this.map.getView()),e=Math.min(t.extent[2]-t.extent[0],PV([20,0])[0])/2,i=t.center[0]-e,n=t.center[0]+e,s=Math.min(t.extent[3]-t.extent[1],function(t){const[,e]=OV(t.center),[,i]=PV([0,e+7.5]),[,n]=PV([0,e-7.5]);return i-n}(t))/2;return MU.fromOLExtent([i,t.center[1]-s,n,t.center[1]+s]).scale(.8)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(nu),Oa(ic),Oa(Pj),Oa(Rq))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-playback-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:1,vars:1,consts:[[\"className\",\"mat-elevation-z16\",3,\"map\",\"latitude\",\"longitude\",\"stopEvent\",\"autoPositioning\",4,\"ngIf\"],[\"className\",\"mat-elevation-z16\",3,\"map\",\"latitude\",\"longitude\",\"stopEvent\",\"autoPositioning\"],[3,\"ship\",\"animationTimestamp\"]],template:function(t,e){1&t&&oa(0,kht,2,7,\"app-map-tooltip\",0),2&t&&Ra(\"ngIf\",e.hoveredShip)},directives:[Vd,xht,Cht],encapsulation:2}),t})(),Mht=(()=>{class t extends Gq{constructor(t){super(),this.offlineService=t,this.layerRenderListener=null}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[],useSpatialIndex:!1}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z100}),this.map.addLayer(this.layer),this.subscriptions.push(this.offlineService.setupActive$.pipe(pf(16),M(t=>t),Tf()).subscribe(t=>{t?(this.bboxFeature=new l8(new F8([])),this.updateBboxFeatureGeometry(),this.source.addFeature(this.bboxFeature),this.layerRenderListener=this.layer.on(\"prerender\",()=>{this.updateBboxFeatureGeometry()})):this.bboxFeature&&(this.source.removeFeature(this.bboxFeature),this.bboxFeature=null,i$(this.layerRenderListener))}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer),i$(this.layerRenderListener)}updateBboxFeatureGeometry(){const t=this.getRestrictedBoundingBox(),e=aW(t.getPolygon()).map(t=>PV(t));UU(this.bboxFeature.getGeometry().getCoordinates()[0]||[],e)||(this.bboxFeature.getGeometry().setCoordinates([e]),this.offlineService.updateViewBox(t.toLatLonExtent()))}getRestrictedBoundingBox(){const t=kot.fromOLView(this.map.getView()),e=Math.min(t.extent[2]-t.extent[0],PV([20,0])[0])/2,i=t.center[0]-e,n=t.center[0]+e,s=Math.min(t.extent[3]-t.extent[1],function(t){const[,e]=OV(t.center),[,i]=PV([0,e+7.5]),[,n]=PV([0,e-7.5]);return i-n}(t))/2;return MU.fromOLExtent([i,t.center[1]-s,n,t.center[1]+s]).scale(.8)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(MY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-interaction-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();function Tht(t){return![\"INPUT\",\"TEXTAREA\"].includes(t.target.nodeName)}vlt.map(t=>new S7({stroke:new U8({color:t,width:1}),fill:new h8({color:\"rgba(0, 0, 255, 0)\"})}));const Iht=\"url('assets/images/cursor-hex-add.png'), auto\",Pht=\"url('assets/images/cursor-hex-remove.png'), auto\",Oht=\"url('assets/images/cursor-hex-toggle.png'), auto\";let Rht=(()=>{class t extends Gq{constructor(t,e){super(),this.mapService=t,this.modificationEditionService=e,this.isDrawing=!1,this.enableDrawMode=!1,this.cursorHasMoved=!1}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z40}),this.map.addLayer(this.layer),this.mapStyle=this.map.getTargetElement().style,this.subscriptions.push(this.modificationEditionService.portEdition$.pipe(M(t=>!!t),Tf()).subscribe(t=>{t?this.addPortEditionInteraction():this.map.removeInteraction(this.portEditionInteraction)}),JT([this.modificationEditionService.modification$,this.modificationEditionService.portEdition$,this.modificationEditionService.previewChanges$]).subscribe(([t,e,i])=>{if(this.layer.setVisible(!!t&&i),!t)return this.hoveredHexagonFeature=null,void this.source.clear(!0);t.data.forEach(t=>{this.createOrUpdateFeature(t)}),e?this.createOrUpdateFeature(e):(this.source.removeFeature(this.hoveredHexagonFeature),this.hoveredHexagonFeature=null);const n=t.data.map(t=>t.id).concat(e?[e.id]:[]);this.source.getFeatures().filter(t=>!n.includes(t.getId())&&t!==this.hoveredHexagonFeature).forEach(t=>{this.source.removeFeature(t)})}),this.mapService.view$.pipe(Af(t=>!!t),FM(500,uf,{leading:!1,trailing:!0})).subscribe(t=>{const e=this.source.getFeaturesInExtent(t.extent).filter(t=>t!==this.hoveredHexagonFeature).map(t=>t.port);this.modificationEditionService.updateVisiblePorts(e)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer),this.map.removeInteraction(this.portEditionInteraction)}addPortEditionInteraction(){this.portEditionInteraction=new frt({handleMoveEvent:t=>{const e=Dht(t);if(this.updateHoveredHexagon(e),!this.isDrawing){const t=this.modificationEditionService.portEdition$.value.h3indexes.includes(e);this.mapStyle.cursor=this.enableDrawMode?Oht:t?Pht:Iht}},handleDownEvent:t=>{const e=Dht(t);return this.enableDrawMode&&(this.isDrawing=!0,this.toggleHexagon(e)),this.cursorHasMoved=!1,!0},stopDown(){return this.isDrawing},handleUpEvent:t=>{const e=Dht(t);let i=this.modificationEditionService.portEdition$.value.h3indexes.includes(e);return!this.isDrawing&&!this.cursorHasMoved&&(this.toggleHexagon(e),i=!i),this.mapStyle.cursor=this.enableDrawMode?Oht:i?Pht:Iht,this.isDrawing=!1,!1},handleDragEvent:t=>{if(!this.isDrawing)return this.cursorHasMoved=!0,void(this.mapStyle.cursor=\"grabbing\");this.mapStyle.cursor=Oht;const e=Dht(t);this.hoveredHexagonFeature.h3index!==e&&(this.toggleHexagon(e),this.updateHoveredHexagon(e))}}),this.map.addInteraction(this.portEditionInteraction)}createOrUpdateFeature(t){const e=this.source.getFeatureById(t.id);\"port-deletion\"!==t.type?e?e.updatePort(t):this.source.addFeature(new fht(t)):this.source.removeFeature(e)}toggleHexagon(t){this.modificationEditionService.portEdition$.value.h3indexes.includes(t)?this.modificationEditionService.removeHexagonFromPort(t):this.modificationEditionService.addHexagonToPort(t)}updateHoveredHexagon(t){this.hoveredHexagonFeature?this.hoveredHexagonFeature.h3index!==t&&this.hoveredHexagonFeature.updateH3Index(t):(this.hoveredHexagonFeature=new mlt(t),this.hoveredHexagonFeature.setStyle(glt),this.source.addFeature(this.hoveredHexagonFeature))}onKeyboardDownEvents(t){Tht(t)&&\"Shift\"===t.key&&this.toggleDrawMode(!0)}onKeyboardUpEvents(t){Tht(t)&&\"Shift\"===t.key&&this.toggleDrawMode(!1)}toggleDrawMode(t){if(this.enableDrawMode=t,!this.modificationEditionService.portEdition$.value)return;const e=this.hoveredHexagonFeature&&this.modificationEditionService.portEdition$.value.h3indexes.includes(this.hoveredHexagonFeature.h3index);this.mapStyle.cursor=this.enableDrawMode||this.isDrawing?Oht:e?Pht:Iht}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj),Oa(fW))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-modifications-layer\"]],hostBindings:function(t,e){1&t&&Ga(\"keydown\",function(t){return e.onKeyboardDownEvents(t)},!1,Ls)(\"keyup\",function(t){return e.onKeyboardUpEvents(t)},!1,Ls)},inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();function Dht(t){const[e,i]=OV(t.coordinate);return function(t,e,i){var n=KU._malloc(tj);KU.HEAPF64.set([t,e].map(Mj),n/8);var s=hj(QU.geoToH3(n,i));return KU._free(n),s}(i,e,blt[Math.round(t.map.getView().getZoom())])}const Lht=Math.floor(10),Fht=new S7({image:new g7({stroke:new U8({color:\"#010a40\",lineDash:[Lht+4,16,2*Lht+4+1,18,2*Lht+4+1,16,2*Lht+4+1,18],width:4}),points:4,radius:30,angle:Math.PI/4})});class Nht extends l8{constructor(t){super({geometry:new WG(PV([t.lon,t.lat]))}),super.setStyle(Fht)}}let Bht=(()=>{class t extends Gq{constructor(t,e,i){super(),this.fleetsService=t,this.mapStateConfig=e,this.selectionService=i}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[]}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z100}),this.map.addLayer(this.layer),this.subscriptions.push(JT([this.fleetsService.selectedFleet$,this.selectionService.entities$.pipe(M(t=>t.map(t=>t.entity).filter(t=>!!t)))]).subscribe(([t,e])=>{this.layer.getSource().clear(!0);const i=[];t&&i.push(...t.ships.filter(t=>gU(t.lon)&&gU(t.lat)).map(t=>new EU(t.lon,t.lat))),e.length&&i.push(...e.filter(t=>gU(t.lon)&&gU(t.lat)).map(t=>new EU(t.lon,t.lat))),this.layer.getSource().addFeatures(i.map(t=>new Nht(t)))}),this.mapStateConfig.showSelectionMarkers$.subscribe(t=>{this.layer.setVisible(t)}))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}}return t.\\u0275fac=function(e){return new(e||t)(Oa(zY),Oa(Fq),Oa(IY))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-selection-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})();const zht=new S7({image:new v7});let Vht=(()=>{class t extends Gq{constructor(t){super(),this.mapService=t}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[],useSpatialIndex:!1}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z100}),this.map.addLayer(this.layer),this.subscriptions.push(this.mapService.pingLocation$.subscribe(t=>Hp(this,void 0,void 0,function*(){yield this.animatePing(t)})))}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.layer)}animatePing(t){return Hp(this,void 0,void 0,function*(){const e=new l8(new WG(PV(t)));e.setStyle(zht),this.source.addFeature(e),this.flash(e),yield hU(3500),this.source.removeFeature(e)})}flash(t){const e=(new Date).getTime();let i=null;const n=n=>{const s=n.frameState.time-e,r=s/3e3;if(s>3e3)return void i$(i);const o=150-145*IB(r),a=2*IB(1-r),l=2*Math.PI*o/8,c=new S7({image:new v7({radius:o,stroke:new U8({color:`rgba(255, 0, 0, ${a})`,lineDash:[1*l/3,2*l/3],lineDashOffset:6*r*o,width:1+a})})}),h=function(t){if(!(t.context instanceof CanvasRenderingContext2D))throw new Error(\"Only works for render events from Canvas 2D layers\");const e=t.inversePixelTransform[0],i=t.frameState,n=uG(t.inversePixelTransform.slice(),i.coordinateToPixelTransform),s=kat(i.viewState.resolution,e);let r;const o=zV();return o&&(r=DV(o,i.viewState.projection)),new wat(t.context,e,i.extent,n,i.viewState.rotation,s,r)}(n);h.setStyle(c),h.drawGeometry(t.getGeometry().clone()),this.map.render()};i=this.layer.on(\"postrender\",t=>{n(t)})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-ping-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},encapsulation:2,changeDetection:0}),t})(),$ht=(()=>{class t extends Gq{constructor(t,e){super(),this.mapService=t,this.measureService=e,this.pointerMoveSubscription=new d,this.createdTooltips=[]}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[],wrapX:!1}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z100}),this.map.addLayer(this.layer),this.subscriptions.push(this.measureService.active$.subscribe(t=>{t?(this.drawInteraction=this.createInteraction(),this.map.addInteraction(this.drawInteraction)):this.stopInteraction()}))}ngOnDestroy(){super.ngOnDestroy(),this.clear()}clear(){this.source.clear(!0),this.stopInteraction(),this.createdTooltips.forEach(t=>{this.map.removeOverlay(t)})}stopInteraction(){this.map.getViewport().removeEventListener(\"mouseout\",this.mouseOutListener),this.pointerMoveSubscription.unsubscribe(),i$(this.drawChangeListener),this.map.removeInteraction(this.drawInteraction),this.map.removeOverlay(this.helpTooltipOverlay),this.map.removeOverlay(this.measureTooltipOverlay)}createInteraction(){return this.drawInteraction=new slt({source:this.source,type:\"LineString\",style:Eet,condition:krt}),this.createMeasureTooltip(),this.createHelpTooltip(),this.drawInteraction.on(\"drawstart\",t=>{sB({category:\"app\",message:\"measure: drawstart\"}),this.sketchFeature=t.feature,this.sketchFeature.setStyle(this.getSketchFeatureStyle),this.drawChangeListener=this.sketchFeature.getGeometry().on(\"change\",t=>{const e=t.target;this.measureTooltipElement.innerHTML=det(e),this.measureTooltipOverlay.setPosition(e.getLastCoordinate())})}),this.drawInteraction.on(\"drawend\",()=>{sB({category:\"app\",message:\"measure: drawend\"});const t=this.measureTooltipOverlay,e=this.sketchFeature;this.measureTooltipOverlay.setOffset([0,-7]),this.sketchFeature.setStyle(this.getSketchFeatureStyle(this.sketchFeature)),this.sketchFeature=null;const i=function(){const t=document.createElement(\"button\");return t.className=\"material-icons mat-icon\",t.innerText=\"close\",t.title=\"Supprimer la mesure\",t.style.padding=\"0\",t.style.marginRight=\"-8px\",t.style.marginTop=\"-4px\",t.style.marginBottom=\"-4px\",t.style.borderTopRightRadius=\"4px\",t.style.borderBottomRightRadius=\"4px\",t.style.fontSize=\"1.5em\",t.style.marginLeft=\"4px\",t.style.color=\"inherit\",t.style.backgroundColor=\"rgba(0, 0, 0, 0)\",t.addEventListener(\"mouseover\",()=>{t.style.backgroundColor=\"rgba(0, 0, 0, 0.3)\"}),t.addEventListener(\"mouseout\",()=>{t.style.backgroundColor=\"rgba(0, 0, 0, 0)\"}),t}();i.addEventListener(\"click\",()=>{this.map.removeOverlay(t),this.source.removeFeature(e)}),this.measureTooltipElement.appendChild(i),this.createdTooltips.push(this.measureTooltipOverlay),this.measureTooltipElement=null,this.createMeasureTooltip(),i$(this.drawChangeListener)}),this.pointerMoveSubscription=this.mapService.pointerMove$.subscribe(t=>{this.handleMoveEvent(t)}),this.mouseOutListener=()=>{this.helpTooltipElement.classList.add(\"measure-layer__tooltip--hidden\")},this.map.getViewport().addEventListener(\"mouseout\",this.mouseOutListener),this.drawInteraction}createHelpTooltip(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement(\"div\"),this.helpTooltipElement.className=\"measure-layer__tooltip\",this.helpTooltipOverlay=new Aht({element:this.helpTooltipElement,className:\"measure-layer__unselectable\",offset:[15,0],positioning:\"center-left\"}),this.map.addOverlay(this.helpTooltipOverlay)}createMeasureTooltip(){this.measureTooltipElement&&this.measureTooltipElement.parentNode.removeChild(this.measureTooltipElement),this.measureTooltipElement=document.createElement(\"div\"),this.measureTooltipElement.className=\"measure-layer__tooltip measure-layer__tooltip--measure\",this.measureTooltipOverlay=new Aht({element:this.measureTooltipElement,offset:[0,-15],positioning:\"bottom-center\",stopEvent:!0}),this.map.addOverlay(this.measureTooltipOverlay)}handleMoveEvent(t){if(t.dragging)return;let e=\"Cliquer pour d\\xe9marrer la mesure\";this.sketchFeature&&(e=this.drawInteraction.atFinish_(t)?\"Cliquer pour terminer la mesure\":\"Cliquer pour ajouter un point\"),this.helpTooltipElement.innerHTML=e,this.helpTooltipOverlay.setPosition(t.coordinate),this.helpTooltipElement.classList.remove(\"measure-layer__tooltip--hidden\")}getSketchFeatureStyle(t){const e=t.getGeometry(),i=[new S7({stroke:new U8({color:\"rgba(0, 0, 0, 0.8)\",lineDash:[10,10],width:2})})];return e.forEachSegment((t,e)=>{i.push(new S7({geometry:new D8([t,e]),text:new k7({text:fet(t,e),font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",overflow:!0,fill:new h8({color:\"#000000\"})})}))}),i}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Pj),Oa(eG))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-measure-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},styles:['.measure-layer__tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px}.measure-layer__tooltip--measure{display:flex;align-items:center}.measure-layer__tooltip--measure:before{border-top:6px solid rgba(0,0,0,.7);border-right:6px solid transparent;border-left:6px solid transparent;content:\"\";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.measure-layer__tooltip--hidden{display:none}.measure-layer__unselectable{pointer-events:none;touch-action:none}\\n'],encapsulation:2,changeDetection:0}),t})();var Uht=class extends Hat{handleFeatureChange_(){}};class jht extends alt{handleEvent(t){const e=[...t.pixel],i=super.handleEvent(t);return(t.pixel[0]!==e[0]||t.pixel[1]!==e[1])&&(t.snapped=!0),i}}const Hht=new U8({color:\"rgba(0, 0, 0, 0.8)\",lineDash:[10,10],width:2}),Ght=new S7({stroke:Hht}),Wht=[\"root\"];let qht=(()=>{class t extends Gq{constructor(){super(...arguments),this.remove=new gh}ngOnDestroy(){super.ngOnDestroy(),this.map.removeOverlay(this.overlay)}ngOnChanges(t){if(t.tooltip){t.tooltip.firstChange&&(this.overlay=new Aht({element:this.rootElement.nativeElement,offset:[0,-15],positioning:\"bottom-center\",stopEvent:!0}),this.map.addOverlay(this.overlay));const e=t.tooltip.previousValue,i=t.tooltip.currentValue;(!e||i.coordinates[0]!==e.coordinates[0]||i.coordinates[1]!==e.coordinates[1])&&this.overlay.setPosition(this.tooltip.coordinates)}}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-waypoint-tooltip\"]],viewQuery:function(t,e){if(1&t&&Th(Wht,7),2&t){let t;Mh(t=Ph())&&(e.rootElement=t.first)}},inputs:{map:\"map\",tooltip:\"tooltip\"},outputs:{remove:\"remove\"},features:[Uo,he],decls:5,vars:1,consts:[[1,\"waypoint-tooltip\"],[\"root\",\"\"],[1,\"waypoint-tooltip__remove-btn\",\"material-icons\",\"mat-icon\",3,\"click\"]],template:function(t,e){1&t&&(La(0,\"div\",0,1),xl(2),La(3,\"button\",2),Ga(\"click\",function(){return e.remove.next()}),xl(4,\"close\"),Fa(),Fa()),2&t&&(Cr(2),Cl(\" \",e.tooltip.label,\" \"))},styles:['.waypoint-tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px;display:flex;align-items:center}  .waypoint-tooltip:before{border-top:6px solid rgba(0,0,0,.7);border-right:6px solid transparent;border-left:6px solid transparent;content:\"\";position:absolute;bottom:-6px;margin-left:-7px;left:50%}  .waypoint-tooltip__remove-btn{padding:0;border-top-right-radius:4px;border-bottom-right-radius:4px;font-size:1.5em;margin:-4px -8px -4px 4px;color:inherit;background-color:rgba(0,0,0,0)}  .waypoint-tooltip__remove-btn:hover{background-color:rgba(0,0,0,.3)}'],changeDetection:0}),t})();function Yht(t,e){if(1&t){const t=$a();La(0,\"app-waypoint-tooltip\",1),Ga(\"remove\",function(){const e=Fe(t).index;return Ka().emitRemoveEvent(e)}),Fa()}if(2&t){const t=e.$implicit;Ra(\"map\",Ka().map)(\"tooltip\",t)}}let Zht=(()=>{class t extends Gq{constructor(){super(...arguments),this.remove=new gh,this.waypointTooltips=[]}ngOnDestroy(){super.ngOnDestroy()}ngOnChanges(t){t.pim&&this.buildWaypointTooltipsAndSegmentsLabels()}buildWaypointTooltipsAndSegmentsLabels(){const t=this.pim.feature.getGeometry().getCoordinates();if(t.length<2)throw new Error(\"PIM invalide (2 points n\\xe9cessaires)\");const e=this.pim.waypoints;if(e.length<1)throw new Error(\"PIM invalide (1 \\xe9tape n\\xe9cessaire)\");let i=this.pim.waypoints[0].timestamp;this.waypointTooltips=[{coordinates:t[0],label:Kht(i)}];const n=[];for(let s=1;s<t.length;s++){const r=t[s-1],o=t[s],a=e[s-1],l=pet(r,o),c=Math.round(i+l/a.speed*3600),h=vq(c-i);i=c,this.waypointTooltips.push({coordinates:o,label:`ETA: ${Kht(i)}`}),n.push(`${a.speed} kt - ${h}\\n${fet(r,o)}`)}this.pim.feature.setStyle(function(t,e){const i=[Ght];let n=0;return t.forEachSegment((t,s)=>{const[r,o]=e[n].split(\"\\n\");i.push(new S7({geometry:new D8([t,s]),text:new k7({text:` ${r}\\n`,font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",overflow:!0,fill:ket})})),i.push(new S7({geometry:new D8([t,s]),text:new k7({text:o,font:\"12px sans-serif\",placement:\"line\",textBaseline:\"bottom\",overflow:!0,fill:ket})}));const a=s[0]-t[0],l=s[1]-t[1];if(0!==a||0!==l){const t=Math.atan2(l,a);i.push(new S7({geometry:new WG(s),image:new T8({src:\"assets/images/arrow-chevron.png\",anchor:[.6,.5],rotateWithView:!0,rotation:-t})}))}n++}),i}(this.pim.feature.getGeometry(),n))}trackByIndex(t){return t}emitRemoveEvent(t){this.remove.next({pim:this.pim,index:t})}}return t.\\u0275fac=function(){let e;return function(i){return(e||(e=Wi(t)))(i||t)}}(),t.\\u0275cmp=Gt({type:t,selectors:[[\"app-pim\"]],inputs:{map:\"map\",pim:\"pim\"},outputs:{remove:\"remove\"},features:[Uo,he],decls:1,vars:2,consts:[[3,\"map\",\"tooltip\",\"remove\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"map\",\"tooltip\",\"remove\"]],template:function(t,e){1&t&&oa(0,Yht,1,2,\"app-waypoint-tooltip\",0),2&t&&Ra(\"ngForOf\",e.waypointTooltips)(\"ngForTrackBy\",e.trackByIndex)},directives:[Bd,qht],styles:[\"\"],changeDetection:0}),t})();function Kht(t){return pq(1e3*t,\"yyyy-MM-dd HH:mm\")}function Xht(t,e){if(1&t){const t=$a();La(0,\"app-pim\",1),Ga(\"remove\",function(e){return Fe(t),Ka().handleRemoveEvent(e)}),Fa()}if(2&t){const t=e.$implicit;Ra(\"map\",Ka().map)(\"pim\",t)}}var Qht=(()=>(function(t){t.Idle=\"idle\",t.Draw=\"draw\",t.Modify=\"modify\"}(Qht||(Qht={})),Qht))();let Jht=(()=>{class t extends Gq{constructor(t,e){super(),this.changeDetectorRef=t,this.pimService=e,this.pims=[],this.pointerMoveSubscription=new d,this.currentMode=Qht.Idle,this.lastFeatureSegmentsCount=1,this.isUpdatingPIMGeometry=!1,this.updatedPIMOriginalGeometryCoordinates=null,this.mouseOutListener=()=>{this.helpTooltipOverlay.setPosition(null)}}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.source=new Fat({features:[],wrapX:!1}),this.layer=new Pat({source:this.source,updateWhileAnimating:!0,updateWhileInteracting:!0,zIndex:Cot.z100}),this.map.addLayer(this.layer),this.subscriptions.push(this.pimService.active$.subscribe(t=>{t?this.createInteractions():this.removeInteractions()}),this.pimService.nextStartDate$.subscribe(t=>{if(this.currentMode===Qht.Draw){const e=this.pims[this.pims.length-1];e.waypoints[0].timestamp=t,this.updatePIMReference(e)}}),this.pimService.nextSpeed$.subscribe(t=>{if(this.currentMode===Qht.Draw){const e=this.pims[this.pims.length-1],i=e.waypoints;i[i.length-1].speed=t,this.updatePIMReference(e)}}))}ngOnDestroy(){super.ngOnDestroy(),this.clear()}clear(){this.source.clear(!0),this.removeInteractions()}createInteractions(){this.createModifyInteraction(),this.createDrawInteraction(),this.snapInteraction=new jht({source:this.source,pixelTolerance:20}),this.map.addInteraction(this.snapInteraction),this.createHelpTooltip(),this.map.getViewport().addEventListener(\"mouseout\",this.mouseOutListener)}removeInteractions(){this.map.getViewport().removeEventListener(\"mouseout\",this.mouseOutListener),this.pointerMoveSubscription.unsubscribe(),i$(this.featureGeomChangeListener),this.map.removeInteraction(this.drawInteraction),this.map.removeInteraction(this.modifyInteraction),this.map.removeInteraction(this.snapInteraction),this.map.removeOverlay(this.helpTooltipOverlay)}createDrawInteraction(){this.drawInteraction=new slt({type:\"LineString\",source:this.source,style:Eet,condition:krt}),this.map.addInteraction(this.drawInteraction),this.drawInteraction.on(\"drawstart\",t=>{sB({category:\"app\",message:\"pim: drawstart\"}),this.currentMode=Qht.Draw,this.map.removeInteraction(this.snapInteraction),this.modifyInteraction.setActive(!1);const e=t.feature,i={feature:e,waypoints:[{timestamp:this.pimService.nextStartDate$.value,speed:this.pimService.nextSpeed$.value}]};e.pim=i,this.pims.push(i),this.listenForDrawedGeometryChanges(e)}),this.drawInteraction.on(\"drawend\",()=>{sB({category:\"app\",message:\"pim: drawend\"}),this.currentMode=Qht.Idle,this.map.addInteraction(this.snapInteraction),this.modifyInteraction.setActive(!0),i$(this.featureGeomChangeListener)}),this.drawInteraction.on(\"drawabort\",()=>{sB({category:\"app\",message:\"pim: drawabort\"}),this.currentMode=Qht.Idle,this.map.addInteraction(this.snapInteraction),this.modifyInteraction.setActive(!0),i$(this.featureGeomChangeListener),this.pims.splice(this.pims.length-1,1)}),this.pointerMoveSubscription=qm(this.map,\"pointermove\").pipe(sf(t=>{this.helpTooltipOverlay.setPosition(t.coordinate)}),Oj(0)).subscribe(t=>{this.handleMoveEvent(t),this.changeDetectorRef.detectChanges()})}createModifyInteraction(){this.modifyInteraction=new Uht({source:this.source,style:Eet,condition:krt}),this.map.addInteraction(this.modifyInteraction),this.modifyInteraction.on(\"modifystart\",t=>{sB({category:\"app\",message:\"pim: modifystart\"}),this.currentMode=Qht.Modify,this.map.removeInteraction(this.snapInteraction);const e=t.features.item(0);this.listenForGeometryChanges(e)}),this.modifyInteraction.on(\"modifyend\",t=>{sB({category:\"app\",message:\"pim: modifyend\"}),this.currentMode=Qht.Idle,this.map.addInteraction(this.snapInteraction),i$(this.featureGeomChangeListener)})}listenForGeometryChanges(t){this.updatedPIMOriginalGeometryCoordinates=t.getGeometry().getCoordinates(),this.lastFeatureSegmentsCount=this.updatedPIMOriginalGeometryCoordinates.length-1,this.featureGeomChangeListener=t.getGeometry().on(\"change\",()=>{const e=t.pim,i=t.getGeometry().getCoordinates(),n=i.length-1;if(n===this.lastFeatureSegmentsCount+1){for(let t=1;t<n;t++){const[n,s]=i[t],[r,o]=this.updatedPIMOriginalGeometryCoordinates[t];if(n!==r||s!==o){e.waypoints.splice(t,0,{speed:this.pimService.nextSpeed$.value});break}}this.lastFeatureSegmentsCount=n,this.handleMoveEvent(this.lastMoveEvent)}this.updatePIMReference(e)})}listenForDrawedGeometryChanges(t){this.updatedPIMOriginalGeometryCoordinates=t.getGeometry().getCoordinates(),this.lastFeatureSegmentsCount=this.updatedPIMOriginalGeometryCoordinates.length-1,this.featureGeomChangeListener=t.getGeometry().on(\"change\",()=>{const e=t.pim,i=t.getGeometry().getCoordinates().length-1;i!==this.lastFeatureSegmentsCount&&(this.isUpdatingPIMGeometry||(i>this.lastFeatureSegmentsCount?(e.waypoints.push({speed:this.pimService.nextSpeed$.value}),sB({category:\"app\",message:\"pim: add waypoint\"})):(e.waypoints.splice(e.waypoints.length-1,1),sB({category:\"app\",message:\"pim: remove waypoint\"}))),this.lastFeatureSegmentsCount=i,this.handleMoveEvent(this.lastMoveEvent)),this.isUpdatingPIMGeometry||this.updatePIMReference(e)})}createHelpTooltip(){this.helpTooltipElement&&this.helpTooltipElement.parentNode.removeChild(this.helpTooltipElement),this.helpTooltipElement=document.createElement(\"div\"),this.helpTooltipElement.className=\"help-tooltip\",this.helpTooltipOverlay=new Aht({element:this.helpTooltipElement,offset:[15,0],className:\"help-tooltip__overlay\",stopEvent:!1,positioning:\"center-left\"}),this.map.addOverlay(this.helpTooltipOverlay)}handleMoveEvent(t){this.lastMoveEvent=t;let e=\"\";if(this.currentMode===Qht.Modify&&t.dragging)e=\"D\\xe9placer pour modifier l'\\xe9tape\";else if(t.snapped)switch(this.currentMode===Qht.Idle&&this.drawInteraction.getActive()&&this.drawInteraction.setActive(!1),this.currentMode){case Qht.Idle:e=\"Cliquer et maintenir pour ajouter une \\xe9tape\";break;case Qht.Modify:e=\"D\\xe9placer pour modifier l'\\xe9tape\"}else switch(this.currentMode===Qht.Idle&&!this.drawInteraction.getActive()&&this.drawInteraction.setActive(!0),this.currentMode){case Qht.Idle:e=\"Cliquer pour d\\xe9marrer un PIM\";break;case Qht.Draw:e=this.drawInteraction.atFinish_(t.pixel)?\"Cliquer pour terminer le PIM\":\"Cliquer pour ajouter une \\xe9tape\"}this.helpTooltipElement.innerHTML=e}trackByIndex(t){return t}removePIM(t){if(this.source.hasFeature(t.feature)){this.source.removeFeature(t.feature);const e=this.pims.findIndex(e=>e===t);this.pims.splice(e,1)}else this.drawInteraction.abortDrawing()}handleRemoveEvent(t){const e=t.pim,i=t.index;if(0===i||1===e.waypoints.length)return this.removePIM(e),void sB({category:\"app\",message:\"pim: remove pim\"});if(this.currentMode===Qht.Draw&&this.pims[this.pims.length-1]===e&&i===e.waypoints.length)return;sB({category:\"app\",message:\"pim: remove waypoint\"}),e.waypoints.splice(i===e.waypoints.length?i-1:i,1);const n=e.feature.getGeometry(),s=n.getCoordinates();s.splice(i,1),this.isUpdatingPIMGeometry=!0,n.setCoordinates(s),this.isUpdatingPIMGeometry=!1,this.pims[this.pims.length-1]===e&&this.currentMode===Qht.Draw&&(this.drawInteraction.sketchCoords_=s,this.drawInteraction.finishCoordinate_=s[i-1]),this.updatePIMReference(e),this.pimService.active$.value&&(this.map.removeInteraction(this.modifyInteraction),this.createModifyInteraction())}updatePIMReference(t){const e=this.pims.findIndex(e=>e===t);if(-1===e)throw console.warn(\"PIM non trouv\\xe9\",t,this.pims),new Error(\"PIM non trouv\\xe9\");const i=Object.assign({},t);t.feature.pim=i,this.pims[e]=i}}return t.\\u0275fac=function(e){return new(e||t)(Oa(Mc),Oa(xq))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-pim-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:1,vars:2,consts:[[3,\"map\",\"pim\",\"remove\",4,\"ngFor\",\"ngForOf\",\"ngForTrackBy\"],[3,\"map\",\"pim\",\"remove\"]],template:function(t,e){1&t&&oa(0,Xht,1,2,\"app-pim\",0),2&t&&Ra(\"ngForOf\",e.pims)(\"ngForTrackBy\",e.trackByIndex)},directives:[Bd,Zht],styles:[\".help-tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px}  .help-tooltip__overlay{pointer-events:none!important;touch-action:none}\"]}),t})();const tut=\"1.3.0\";function eut(t,e){const i=[];Object.keys(e).forEach(function(t){null!=e[t]&&i.push(t+\"=\"+encodeURIComponent(e[t]))});const n=i.join(\"&\");return t=t.replace(/[?&]$/,\"\"),(t+=t.includes(\"?\")?\"&\":\"?\")+n}var iut=class extends F${constructor(t){t=t||{};const e=Object.assign({},t.params);super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:!(!(\"TRANSPARENT\"in e)||e.TRANSPARENT),projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.gutter_=void 0!==t.gutter?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=void 0===t.hidpi||t.hidpi,this.tmpExtent_=[1/0,1/0,-1/0,-1/0],this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,i,n){const s=EV(i),r=this.getProjection();let o=this.getTileGrid();o||(o=this.getTileGridForProjection(s));const a=o.getZForResolution(e,this.zDirection),l=o.getTileCoordForCoordAndZ(t,a);if(o.getResolutions().length<=l[0])return;let c=o.getResolution(l[0]),h=o.getTileCoordExtent(l,this.tmpExtent_),u=y$(o.getTileSize(l[0]),this.tmpSize);const d=this.gutter_;0!==d&&(u=v$(u,d,this.tmpSize),h=oz(h,c*d,h)),r&&r!==s&&(c=ZV(r,s,t,c),h=NV(h,s,r),t=FV(t,s,r));const p={SERVICE:\"WMS\",VERSION:tut,REQUEST:\"GetFeatureInfo\",FORMAT:\"image/png\",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};Object.assign(p,this.params_,n);const f=Math.floor((t[0]-h[0])/c),m=Math.floor((h[3]-t[1])/c);return p[this.v13_?\"I\":\"X\"]=f,p[this.v13_?\"J\":\"Y\"]=m,this.getRequestUrl_(l,u,h,1,r||s,p)}getLegendUrl(t,e){if(void 0===this.urls[0])return;const i={SERVICE:\"WMS\",VERSION:tut,REQUEST:\"GetLegendGraphic\",FORMAT:\"image/png\"};if(void 0===e||void 0===e.LAYER){const t=this.params_.LAYERS;if(Array.isArray(t)&&1!==t.length)return;i.LAYER=t}if(void 0!==t){const e=this.getProjection()?this.getProjection().getMetersPerUnit():1;i.SCALE=t*e/28e-5}return Object.assign(i,e),eut(this.urls[0],i)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,i,n,s,r){const o=this.urls;if(!o)return;if(r.WIDTH=e[0],r.HEIGHT=e[1],r[this.v13_?\"CRS\":\"SRS\"]=s.getCode(),\"STYLES\"in this.params_||(r.STYLES=\"\"),1!=n)switch(this.serverType_){case\"geoserver\":const t=90*n+.5|0;\"FORMAT_OPTIONS\"in r?r.FORMAT_OPTIONS+=\";dpi:\"+t:r.FORMAT_OPTIONS=\"dpi:\"+t;break;case\"mapserver\":r.MAP_RESOLUTION=90*n;break;case\"carmentaserver\":case\"qgis\":r.DPI=90*n;break;default:sz(!1,52)}const a=s.getAxisOrientation(),l=i;if(this.v13_&&\"ne\"==a.substr(0,2)){let t;t=i[0],l[0]=i[1],l[1]=t,t=i[2],l[2]=i[3],l[3]=t}let c;return r.BBOX=l.join(\",\"),c=1==o.length?o[0]:o[rV(t$(t),o.length)],eut(c,r)}getTilePixelRatio(t){return this.hidpi_&&void 0!==this.serverType_?t:1}getKeyForParams_(){let t=0;const e=[];for(const i in this.params_)e[t++]=i+\"-\"+this.params_[i];return e.join(\"/\")}updateParams(t){Object.assign(this.params_,t),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){this.v13_=function(t,e){const i=(\"\"+t).split(\".\"),n=\"1.3\".split(\".\");for(let s=0;s<Math.max(i.length,n.length);s++){const t=parseInt(i[s]||\"0\",10),e=parseInt(n[s]||\"0\",10);if(t>e)return 1;if(e>t)return-1}return 0}(this.params_.VERSION||tut)>=0}tileUrlFunction(t,e,i){let n=this.getTileGrid();if(n||(n=this.getTileGridForProjection(i)),n.getResolutions().length<=t[0])return;1!=e&&(!this.hidpi_||void 0===this.serverType_)&&(e=1);const s=n.getResolution(t[0]);let r=n.getTileCoordExtent(t,this.tmpExtent_),o=y$(n.getTileSize(t[0]),this.tmpSize);const a=this.gutter_;0!==a&&(o=v$(o,a,this.tmpSize),r=oz(r,s*a,r)),1!=e&&(o=b$(o,e,this.tmpSize));const l={SERVICE:\"WMS\",VERSION:tut,REQUEST:\"GetMap\",FORMAT:\"image/png\",TRANSPARENT:!0};return Object.assign(l,this.params_),this.getRequestUrl_(t,o,r,e,i,l)}};function nut(t){var e;return Hp(this,void 0,void 0,function*(){const i=yield fetch(t);if(\"ANAIS-UI\"!==(null===(e=i.headers)||void 0===e?void 0:e.get(\"x-server\"))){const t=i.headers.get(\"content-type\");throw new Error(`Le serveur n'a pas bien r\\xe9pondu${\"application/json\"!==t?` (re\\xe7u: ${t}, attendu: application/json)`:\"\"}. Votre acc\\xe8s \\xe0 internet est-il bloqu\\xe9 par un proxy ?`)}try{return yield i.json()}catch(n){throw new Error(`Donn\\xe9es corrompues pour le fichier ${t}. JSON probablement malform\\xe9 (${n.message})`)}})}const sut=[{url:\"assets/geo/UK_6M_Limit.geojson\",style:new S7({stroke:new U8({width:2,color:\"#7a7a7a\"})})},{url:\"assets/geo/UK_12M_Limit.geojson\",style:new S7({stroke:new U8({width:2,color:\"#579f6f\"})})}],rut={limits36Nq:{assets:[{url:\"assets/geo/Limite_3milles_peche_WGS84_EPSG4326.geojson\",style:new S7({stroke:new U8({width:2,color:\"#ed791a\"})})},{url:\"assets/geo/Limite_6milles_bande_cotiere_peche_WGS84_EPSG4326.geojson\",style:new S7({stroke:new U8({width:2,color:\"#7a7a7a\"})})}],transformFeature:t=>{t.title=t.get(\"nature\"),t.hoverable=!0}},ukLimits612Nq:{assets:sut,transformFeature:t=>{t.title=t.get(\"nature_of_\")?\"Limite 6 nautiques UK\":\"Limite 12 nautiques UK\",t.hoverable=!0}},maritimeBoundaries:{assets:[{url:\"assets/geo/Delim_accord_WGS84.geojson\",style:new S7({stroke:new U8({width:2,color:\"#090df6\"})})},{url:\"assets/geo/Lignes_base_droites_WGS84.geojson\",style:new S7({stroke:new U8({width:2,color:\"#000000\"})})},{url:\"assets/geo/Lim_ext_MT_WGS84.geojson\",style:new S7({stroke:new U8({width:2,color:\"#e31a1c\"})})},{url:\"assets/geo/Lim_ext_PC_WGS84.geojson\",style:new S7({stroke:new U8({width:2,color:\"#732d2f\"})})},{url:\"assets/geo/Lim_ext_ZC_WGS84.geojson\",style:new S7({stroke:new U8({width:2,color:\"#c36812\"})})},{url:\"assets/geo/Lim_ext_ZEE_WGS84.geojson\",style:new S7({stroke:new U8({width:2,color:\"#d60af5\"})})},{url:\"assets/geo/Lim_sans_accord_WGS84.geojson\",style:new S7({stroke:new U8({lineDash:[2,5],width:2,color:\"#000000\"})})}],transformFeature:t=>{t.title=t.get(\"nature\"),t.hoverable=!0}},mrcc:{assets:[{url:\"assets/geo/mrcc_2020-08-03.geojson\",style:new S7({image:new T8({src:\"/assets/images/lifeline.png\"})})}],transformFeature:t=>{t.title=t.get(\"name\"),t.hoverable=!0}},searchAndRescue:{assets:[{url:\"assets/geo/sar_2020-08-03.geojson\",style:new S7({stroke:new U8({width:2,color:\"#d9161e\"})})}],transformFeature:t=>{t.title=t.get(\"name\"),t.hoverable=!0}},searchAndRescueRegions:{assets:[{url:\"assets/geo/french-srr.geojson\",style:new S7({stroke:new U8({width:2,color:\"#d95716\"})})}],transformFeature:t=>{t.title=t.get(\"name\"),t.hoverable=!0}},shootingAreas:{assets:[{url:\"assets/geo/zonex.atlan.tirs.2021.corrected.geojson\",style:new S7({stroke:new U8({width:2,color:\"#6500b7\"}),fill:new h8({color:\"#6500b710\"})})}],transformFeature:t=>{t.title=t.get(\"zonex\"),t.hoverable=!1;const e=t.getStyle().clone();e.setText(new k7({text:t.title,font:\"12px sans-serif\",placement:\"point\",fill:ket})),t.setStyle(e)}}};let out=(()=>{class t extends Gq{constructor(t,e,i){super(),this.mapConfigService=t,this.mapService=e,this.zonexService=i,this.featuresLoaded$=new C,this.assetsFeaturesByType={},this.previousHoveredFeatures=[]}ngOnInit(){this.ensureMandatoryInputParams(\"map\"),this.geoJSONReader=new bet({featureProjection:this.map.getView().getProjection().getCode()}),this.pointsSource=new Fat({features:[]}),this.pointsLayer=new Pat({source:this.pointsSource,zIndex:Cot.z40,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.map.addLayer(this.pointsLayer),this.linesSource=new Fat({features:[]}),this.linesLayer=new flt({source:this.linesSource,zIndex:Cot.z40}),this.map.addLayer(this.linesLayer),this.eezLayer=new Xrt({source:new iut({url:\"https://geo.vliz.be/geoserver/gwc/service/wms\",params:{SRS:\"EPSG:3857\",LAYERS:\"MarineRegions:eez_boundaries\"}}),zIndex:Cot.z40,visible:!1}),this.map.addLayer(this.eezLayer),this.subscriptions.push(JT([this.mapConfigService.showMaritimeBoundariesLayer$,this.mapConfigService.show36NqLimitsLayer$,this.mapConfigService.showUK612NqLimitsLayer$,this.mapConfigService.showMRCCLayer$,this.mapConfigService.showSARLayer$,this.mapConfigService.showSRRLayer$,this.mapConfigService.showShootingAreasLayer$]).pipe(Af(([t,e,i,n,s,r,o])=>t||e||i||n||s||r||o),FO()).subscribe(()=>Hp(this,void 0,void 0,function*(){yield this.fetchFeatures()})),this.featuresLoaded$.pipe(FO()).subscribe(()=>{this.subscriptions.push(JT([this.mapConfigService.showMaritimeBoundariesLayer$,this.mapConfigService.show36NqLimitsLayer$,this.mapConfigService.showUK612NqLimitsLayer$,this.mapConfigService.showMRCCLayer$,this.mapConfigService.showSARLayer$,this.mapConfigService.showSRRLayer$,this.mapConfigService.showShootingAreasLayer$]).subscribe(([t,e,i,n,s,r,o])=>{this.pointsSource.clear(!0),this.linesSource.clear(!0),t&&this.linesSource.addFeatures(this.assetsFeaturesByType.maritimeBoundaries),e&&this.linesSource.addFeatures(this.assetsFeaturesByType.limits36Nq),i&&this.linesSource.addFeatures(this.assetsFeaturesByType.ukLimits612Nq),n&&this.pointsSource.addFeatures(this.assetsFeaturesByType.mrcc),s&&this.linesSource.addFeatures(this.assetsFeaturesByType.searchAndRescue),r&&this.linesSource.addFeatures(this.assetsFeaturesByType.searchAndRescueRegions),o&&this.linesSource.addFeatures(this.assetsFeaturesByType.shootingAreas)}))}),this.mapConfigService.showEEZLayer$.subscribe(t=>{this.eezLayer.setVisible(t)}),this.mapService.pointerMove$.subscribe(t=>{(this.pointsSource.getFeatures().length||this.linesSource.getFeatures().length)&&this.handleMoveEvent(t)}),this.zonexService.isConfiguringZonex$.subscribe(t=>{this.pointsLayer.setVisible(!t),this.linesLayer.setVisible(!t),this.eezLayer.setVisible(!t&&this.mapConfigService.showEEZLayer$.value)})),this.createTooltip()}ngOnDestroy(){super.ngOnDestroy(),this.map.removeLayer(this.pointsLayer),this.map.removeLayer(this.linesLayer),this.map.removeLayer(this.eezLayer),this.map.removeOverlay(this.tooltipOverlay)}createTooltip(){this.tooltipElement&&this.tooltipElement.parentNode.removeChild(this.tooltipElement),this.tooltipElement=document.createElement(\"div\"),this.tooltipElement.className=\"additional-features-layer__tooltip\",this.tooltipOverlay=new Aht({element:this.tooltipElement,offset:[0,-10],positioning:\"bottom-center\"}),this.map.addOverlay(this.tooltipOverlay)}handleMoveEvent(t){const e=[];this.map.forEachFeatureAtPixel(t.pixel,t=>(t.hoverable&&e.push(t),!1),{hitTolerance:3,layerFilter:t=>t===this.pointsLayer||t===this.linesLayer});const i=e.filter(t=>!this.previousHoveredFeatures.includes(t)),n=this.previousHoveredFeatures.filter(t=>!e.includes(t));if(i.length>0||n.length>0){const t=e.map(t=>t.title);this.tooltipElement.innerHTML=t.join('<hr class=\"additional-features-layer__separator\">'),this.previousHoveredFeatures=e}e.length>0?(this.tooltipOverlay.setPosition(t.coordinate),this.tooltipElement.classList.remove(\"additional-features-layer__tooltip--hidden\")):this.tooltipElement.classList.add(\"additional-features-layer__tooltip--hidden\")}fetchFeatures(){return Hp(this,void 0,void 0,function*(){yield Promise.all(Object.entries(rut).map(([t,e])=>Hp(this,void 0,void 0,function*(){const i=yield Promise.all(e.assets.map(t=>Hp(this,void 0,void 0,function*(){return{collection:yield nut(t.url),style:t.style}})));this.assetsFeaturesByType[t]=i.flatMap(t=>{const i=this.geoJSONReader.readFeatures(t.collection);return i.forEach(i=>{i.setStyle(t.style),e.transformFeature(i)}),i})}))),this.featuresLoaded$.next(!0)})}}return t.\\u0275fac=function(e){return new(e||t)(Oa(qU),Oa(Pj),Oa(Lq))},t.\\u0275cmp=Gt({type:t,selectors:[[\"app-additional-features-layer\"]],inputs:{map:\"map\"},features:[Uo],decls:0,vars:0,template:function(t,e){},styles:['.additional-features-layer__tooltip{position:relative;background:rgba(0,0,0,.7);border-radius:4px;color:#fff;padding:4px 8px;opacity:.8;white-space:nowrap;font-size:12px;pointer-events:none;touch-action:none}.additional-features-layer__tooltip:before{border-top:6px solid rgba(0,0,0,.7);border-right:6px solid transparent;border-left:6px solid transparent;content:\"\";position:absolute;bottom:-6px;margin-left:-7px;left:50%}.additional-features-layer__tooltip--hidden{display:none}.additional-features-layer__separator{background-color:#fff}\\n'],encapsulation:2,changeDetection:0}),t})();const aut=\"http://www.opengis.net/gml\",lut=/^\\s*$/;class cut extends t9{constructor(t){super(),this.featureType=(t=t||{}).featureType,this.featureNS=t.featureNS,this.srsName=t.srsName,this.schemaLocation=\"\",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:N7(this.readFeaturesInternal),featureMembers:B7(this.readFeaturesInternal)},this.supportedMediaTypes=[\"application/gml+xml\"]}readFeaturesInternal(t,e){const i=t.localName;let n=null;if(\"FeatureCollection\"==i)n=Y7([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if(\"featureMembers\"==i||\"featureMember\"==i||\"member\"==i){const s=e[0];let r=s.featureType,o=s.featureNS;const a=\"p\",l=\"p0\";if(!r&&t.childNodes){r=[],o={};for(let e=0,i=t.childNodes.length;e<i;++e){const i=t.childNodes[e];if(1===i.nodeType){const t=i.nodeName.split(\":\").pop();if(!r.includes(t)){let e=\"\",n=0;const s=i.namespaceURI;for(const t in o){if(o[t]===s){e=t;break}++n}e||(e=a+n,o[e]=s),r.push(e+\":\"+t)}}}\"featureMember\"!=i&&(s.featureType=r,s.featureNS=o)}if(\"string\"==typeof o){const t=o;o={},o[l]=t}const c={},h=Array.isArray(r)?r:[r];for(const t in o){const e={};for(let n=0,s=h.length;n<s;++n)(h[n].includes(\":\")?h[n].split(\":\")[0]:l)===t&&(e[h[n].split(\":\").pop()]=\"featureMembers\"==i?N7(this.readFeatureElement,this):B7(this.readFeatureElement,this));c[o[t]]=e}n=Y7(\"featureMember\"==i||\"member\"==i?void 0:[],c,t,e)}return null===n&&(n=[]),n}readGeometryOrExtent(t,e){const i=e[0];return i.srsName=t.firstElementChild.getAttribute(\"srsName\"),i.srsDimension=t.firstElementChild.getAttribute(\"srsDimension\"),Y7(null,this.GEOMETRY_PARSERS,t,e,this)}readExtentElement(t,e){const i=e[0],n=this.readGeometryOrExtent(t,e);return n?T7(n,i):void 0}readGeometryElement(t,e){const i=e[0],n=this.readGeometryOrExtent(t,e);return n?M7(n,!1,i):void 0}readFeatureElementInternal(t,e,i){let n;const s={};for(let r=t.firstElementChild;r;r=r.nextElementSibling){let t;const o=r.localName;0===r.childNodes.length||1===r.childNodes.length&&(3===r.firstChild.nodeType||4===r.firstChild.nodeType)?(t=O7(r,!1),lut.test(t)&&(t=void 0)):(i&&(t=\"boundedBy\"===o?this.readExtentElement(r,e):this.readGeometryElement(r,e)),t?\"boundedBy\"!==o&&(n=o):t=this.readFeatureElementInternal(r,e,!1));const a=r.attributes.length;if(a>0){t={_content_:t};for(let e=0;e<a;e++)t[r.attributes[e].name]=r.attributes[e].value}s[o]?(s[o]instanceof Array||(s[o]=[s[o]]),s[o].push(t)):s[o]=t}if(i){const e=new l8(s);n&&e.setGeometryName(n);const i=t.getAttribute(\"fid\")||function(t,e,i){return t.getAttributeNS(e,\"id\")||\"\"}(t,this.namespace);return i&&e.setId(i),e}return s}readFeatureElement(t,e){return this.readFeatureElementInternal(t,e,!0)}readPoint(t,e){const i=this.readFlatCoordinatesFromNode(t,e);if(i)return new WG(i,\"XYZ\")}readMultiPoint(t,e){const i=Y7([],this.MULTIPOINT_PARSERS,t,e,this);if(i)return new B8(i)}readMultiLineString(t,e){const i=Y7([],this.MULTILINESTRING_PARSERS,t,e,this);if(i)return new F8(i)}readMultiPolygon(t,e){const i=Y7([],this.MULTIPOLYGON_PARSERS,t,e,this);if(i)return new V8(i)}pointMemberParser(t,e){q7(this.POINTMEMBER_PARSERS,t,e,this)}lineStringMemberParser(t,e){q7(this.LINESTRINGMEMBER_PARSERS,t,e,this)}polygonMemberParser(t,e){q7(this.POLYGONMEMBER_PARSERS,t,e,this)}readLineString(t,e){const i=this.readFlatCoordinatesFromNode(t,e);if(i)return new D8(i,\"XYZ\")}readFlatLinearRing(t,e){const i=Y7(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this);if(i)return i}readLinearRing(t,e){const i=this.readFlatCoordinatesFromNode(t,e);if(i)return new HG(i,\"XYZ\")}readPolygon(t,e){const i=Y7([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(i&&i[0]){const t=i[0],e=[t.length];let n,s;for(n=1,s=i.length;n<s;++n)vB(t,i[n]),e.push(t.length);return new tW(t,\"XYZ\",e)}}readFlatCoordinatesFromNode(t,e){return Y7(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}readGeometryFromNode(t,e){return this.readGeometryElement(t,[this.getReadOptions(t,e||{})])||null}readFeaturesFromNode(t,e){const i={featureType:this.featureType,featureNS:this.featureNS};return i&&Object.assign(i,this.getReadOptions(t,e)),this.readFeaturesInternal(t,[i])||[]}readProjectionFromNode(t){return EV(this.srsName?this.srsName:t.firstElementChild.getAttribute(\"srsName\"))}}cut.prototype.namespace=aut,cut.prototype.FLAT_LINEAR_RINGS_PARSERS={\"http://www.opengis.net/gml\":{}},cut.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={\"http://www.opengis.net/gml\":{}},cut.prototype.GEOMETRY_PARSERS={\"http://www.opengis.net/gml\":{}},cut.prototype.MULTIPOINT_PARSERS={\"http://www.opengis.net/gml\":{pointMember:N7(cut.prototype.pointMemberParser),pointMembers:N7(cut.prototype.pointMemberParser)}},cut.prototype.MULTILINESTRING_PARSERS={\"http://www.opengis.net/gml\":{lineStringMember:N7(cut.prototype.lineStringMemberParser),lineStringMembers:N7(cut.prototype.lineStringMemberParser)}},cut.prototype.MULTIPOLYGON_PARSERS={\"http://www.opengis.net/gml\":{polygonMember:N7(cut.prototype.polygonMemberParser),polygonMembers:N7(cut.prototype.polygonMemberParser)}},cut.prototype.POINTMEMBER_PARSERS={\"http://www.opengis.net/gml\":{Point:N7(cut.prototype.readFlatCoordinatesFromNode)}},cut.prototype.LINESTRINGMEMBER_PARSERS={\"http://www.opengis.net/gml\":{LineString:N7(cut.prototype.readLineString)}},cut.prototype.POLYGONMEMBER_PARSERS={\"http://www.opengis.net/gml\":{Polygon:N7(cut.prototype.readPolygon)}},cut.prototype.RING_PARSERS={\"http://www.opengis.net/gml\":{LinearRing:B7(cut.prototype.readFlatLinearRing)}};var hut=cut;const uut={MultiLineString:\"lineStringMember\",MultiCurve:\"curveMember\",MultiPolygon:\"polygonMember\",MultiSurface:\"surfaceMember\"};class dut extends hut{constructor(t){super(t=t||{}),this.FEATURE_COLLECTION_PARSERS[aut].featureMember=N7(this.readFeaturesInternal),this.schemaLocation=t.schemaLocation?t.schemaLocation:\"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd\"}readFlatCoordinates(t,e){const i=O7(t,!1).replace(/^\\s*|\\s*$/g,\"\"),n=e[0].srsName;let s=\"enu\";if(n){const t=EV(n);t&&(s=t.getAxisOrientation())}const r=i.trim().split(/\\s+/),o=[];for(let a=0,l=r.length;a<l;a++){const t=r[a].split(/,+/),e=parseFloat(t[0]),i=parseFloat(t[1]),n=3===t.length?parseFloat(t[2]):0;\"en\"===s.substr(0,2)?o.push(e,i,n):o.push(i,e,n)}return o}readBox(t,e){const i=Y7([null],this.BOX_PARSERS_,t,e,this);return pz(i[1][0],i[1][1],i[1][3],i[1][4])}innerBoundaryIsParser(t,e){const i=Y7(void 0,this.RING_PARSERS,t,e,this);i&&e[e.length-1].push(i)}outerBoundaryIsParser(t,e){const i=Y7(void 0,this.RING_PARSERS,t,e,this);i&&(e[e.length-1][0]=i)}GEOMETRY_NODE_FACTORY_(t,e,i){const n=e[e.length-1],s=n.multiSurface,r=n.surface,o=n.multiCurve;return Array.isArray(t)?i=\"Envelope\":\"MultiPolygon\"===(i=t.getType())&&!0===s?i=\"MultiSurface\":\"Polygon\"===i&&!0===r?i=\"Surface\":\"MultiLineString\"===i&&!0===o&&(i=\"MultiCurve\"),P7(\"http://www.opengis.net/gml\",i)}writeFeatureElement(t,e,i){const n=e.getId();n&&t.setAttribute(\"fid\",n);const s=i[i.length-1],r=s.featureNS,o=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[r]={});const a=[],l=[];if(e.hasProperties()){const t=e.getProperties();for(const e in t){const i=t[e];null!==i&&(a.push(e),l.push(i),e==o||\"function\"==typeof i.getSimplifiedGeometry?e in s.serializers[r]||(s.serializers[r][e]=$7(this.writeGeometryElement,this)):e in s.serializers[r]||(s.serializers[r][e]=$7(h9)))}}const c=Object.assign({},s);c.node=t,K7(c,s.serializers,j7(void 0,r),l,i,a)}writeCurveOrLineString(t,e,i){const n=i[i.length-1].srsName;if(\"LineStringSegment\"!==t.nodeName&&n&&t.setAttribute(\"srsName\",n),\"LineString\"===t.nodeName||\"LineStringSegment\"===t.nodeName){const n=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(n),this.writeCoordinates_(n,e,i)}else if(\"Curve\"===t.nodeName){const n=P7(t.namespaceURI,\"segments\");t.appendChild(n),this.writeCurveSegments_(n,e,i)}}writeLineStringOrCurveMember(t,e,i){const n=this.GEOMETRY_NODE_FACTORY_(e,i);n&&(t.appendChild(n),this.writeCurveOrLineString(n,e,i))}writeMultiCurveOrLineString(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName,o=n.curve;r&&t.setAttribute(\"srsName\",r);const a=e.getLineStrings();K7({node:t,hasZ:s,srsName:r,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)}writeGeometryElement(t,e,i){const n=i[i.length-1],s=Object.assign({},n);let r;s.node=t,r=Array.isArray(e)?T7(e,n):M7(e,!0,n),K7(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[r],i,void 0,this)}createCoordinatesNode_(t){const e=P7(t,\"coordinates\");return e.setAttribute(\"decimal\",\".\"),e.setAttribute(\"cs\",\",\"),e.setAttribute(\"ts\",\" \"),e}writeCoordinates_(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName,o=e.getCoordinates(),a=o.length,l=new Array(a);for(let c=0;c<a;++c)l[c]=this.getCoords_(o[c],r,s);h9(t,l.join(\" \"))}writeCurveSegments_(t,e,i){const n=P7(t.namespaceURI,\"LineStringSegment\");t.appendChild(n),this.writeCurveOrLineString(n,e,i)}writeSurfaceOrPolygon(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName;if(\"PolygonPatch\"!==t.nodeName&&r&&t.setAttribute(\"srsName\",r),\"Polygon\"===t.nodeName||\"PolygonPatch\"===t.nodeName){const n=e.getLinearRings();K7({node:t,hasZ:s,srsName:r},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,n,i,void 0,this)}else if(\"Surface\"===t.nodeName){const n=P7(t.namespaceURI,\"patches\");t.appendChild(n),this.writeSurfacePatches_(n,e,i)}}RING_NODE_FACTORY_(t,e,i){const n=e[e.length-1],s=n.node,r=n.exteriorWritten;return void 0===r&&(n.exteriorWritten=!0),P7(s.namespaceURI,void 0!==r?\"innerBoundaryIs\":\"outerBoundaryIs\")}writeSurfacePatches_(t,e,i){const n=P7(t.namespaceURI,\"PolygonPatch\");t.appendChild(n),this.writeSurfaceOrPolygon(n,e,i)}writeRing(t,e,i){const n=P7(t.namespaceURI,\"LinearRing\");t.appendChild(n),this.writeLinearRing(n,e,i)}getCoords_(t,e,i){let n=\"enu\";e&&(n=EV(e).getAxisOrientation());let s=\"en\"===n.substr(0,2)?t[0]+\",\"+t[1]:t[1]+\",\"+t[0];return i&&(s+=\",\"+(t[2]||0)),s}writePoint(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName;r&&t.setAttribute(\"srsName\",r);const o=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(o);const a=e.getCoordinates();h9(o,this.getCoords_(a,r,s))}writeMultiPoint(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName;r&&t.setAttribute(\"srsName\",r);const o=e.getPoints();K7({node:t,hasZ:s,srsName:r},this.POINTMEMBER_SERIALIZERS,j7(\"pointMember\"),o,i,void 0,this)}writePointMember(t,e,i){const n=P7(t.namespaceURI,\"Point\");t.appendChild(n),this.writePoint(n,e,i)}writeLinearRing(t,e,i){const n=i[i.length-1].srsName;n&&t.setAttribute(\"srsName\",n);const s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s),this.writeCoordinates_(s,e,i)}writeMultiSurfaceOrPolygon(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName,o=n.surface;r&&t.setAttribute(\"srsName\",r);const a=e.getPolygons();K7({node:t,hasZ:s,srsName:r,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)}writeSurfaceOrPolygonMember(t,e,i){const n=this.GEOMETRY_NODE_FACTORY_(e,i);n&&(t.appendChild(n),this.writeSurfaceOrPolygon(n,e,i))}writeEnvelope(t,e,i){const n=i[i.length-1].srsName;n&&t.setAttribute(\"srsName\",n),K7({node:t},this.ENVELOPE_SERIALIZERS,H7,[e[0]+\" \"+e[1],e[2]+\" \"+e[3]],i,[\"lowerCorner\",\"upperCorner\"],this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,i){return P7(\"http://www.opengis.net/gml\",uut[e[e.length-1].node.nodeName])}}dut.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={\"http://www.opengis.net/gml\":{coordinates:B7(dut.prototype.readFlatCoordinates)}},dut.prototype.FLAT_LINEAR_RINGS_PARSERS={\"http://www.opengis.net/gml\":{innerBoundaryIs:dut.prototype.innerBoundaryIsParser,outerBoundaryIs:dut.prototype.outerBoundaryIsParser}},dut.prototype.BOX_PARSERS_={\"http://www.opengis.net/gml\":{coordinates:N7(dut.prototype.readFlatCoordinates)}},dut.prototype.GEOMETRY_PARSERS={\"http://www.opengis.net/gml\":{Point:B7(hut.prototype.readPoint),MultiPoint:B7(hut.prototype.readMultiPoint),LineString:B7(hut.prototype.readLineString),MultiLineString:B7(hut.prototype.readMultiLineString),LinearRing:B7(hut.prototype.readLinearRing),Polygon:B7(hut.prototype.readPolygon),MultiPolygon:B7(hut.prototype.readMultiPolygon),Box:B7(dut.prototype.readBox)}},dut.prototype.GEOMETRY_SERIALIZERS={\"http://www.opengis.net/gml\":{Curve:$7(dut.prototype.writeCurveOrLineString),MultiCurve:$7(dut.prototype.writeMultiCurveOrLineString),Point:$7(dut.prototype.writePoint),MultiPoint:$7(dut.prototype.writeMultiPoint),LineString:$7(dut.prototype.writeCurveOrLineString),MultiLineString:$7(dut.prototype.writeMultiCurveOrLineString),LinearRing:$7(dut.prototype.writeLinearRing),Polygon:$7(dut.prototype.writeSurfaceOrPolygon),MultiPolygon:$7(dut.prototype.writeMultiSurfaceOrPolygon),Surface:$7(dut.prototype.writeSurfaceOrPolygon),MultiSurface:$7(dut.prototype.writeMultiSurfaceOrPolygon),Envelope:$7(dut.prototype.writeEnvelope)}},dut.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={\"http://www.opengis.net/gml\":{lineStringMember:$7(dut.prototype.writeLineStringOrCurveMember),curveMember:$7(dut.prototype.writeLineStringOrCurveMember)}},dut.prototype.RING_SERIALIZERS={\"http://www.opengis.net/gml\":{outerBoundaryIs:$7(dut.prototype.writeRing),innerBoundaryIs:$7(dut.prototype.writeRing)}},dut.prototype.POINTMEMBER_SERIALIZERS={\"http://www.opengis.net/gml\":{pointMember:$7(dut.prototype.writePointMember)}},dut.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={\"http://www.opengis.net/gml\":{surfaceMember:$7(dut.prototype.writeSurfaceOrPolygonMember),polygonMember:$7(dut.prototype.writeSurfaceOrPolygonMember)}},dut.prototype.ENVELOPE_SERIALIZERS={\"http://www.opengis.net/gml\":{lowerCorner:$7(h9),upperCorner:$7(h9)}};var put=dut;const fut={MultiLineString:\"lineStringMember\",MultiCurve:\"curveMember\",MultiPolygon:\"polygonMember\",MultiSurface:\"surfaceMember\"};class mut extends hut{constructor(t){super(t=t||{}),this.surface_=void 0!==t.surface&&t.surface,this.curve_=void 0!==t.curve&&t.curve,this.multiCurve_=void 0===t.multiCurve||t.multiCurve,this.multiSurface_=void 0===t.multiSurface||t.multiSurface,this.schemaLocation=t.schemaLocation?t.schemaLocation:\"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd\",this.hasZ=void 0!==t.hasZ&&t.hasZ}readMultiCurve(t,e){const i=Y7([],this.MULTICURVE_PARSERS,t,e,this);if(i)return new F8(i)}readFlatCurveRing(t,e){const i=Y7([],this.MULTICURVE_PARSERS,t,e,this),n=[];for(let s=0,r=i.length;s<r;++s)vB(n,i[s].getFlatCoordinates());return n}readMultiSurface(t,e){const i=Y7([],this.MULTISURFACE_PARSERS,t,e,this);if(i)return new V8(i)}curveMemberParser(t,e){q7(this.CURVEMEMBER_PARSERS,t,e,this)}surfaceMemberParser(t,e){q7(this.SURFACEMEMBER_PARSERS,t,e,this)}readPatch(t,e){return Y7([null],this.PATCHES_PARSERS,t,e,this)}readSegment(t,e){return Y7([],this.SEGMENTS_PARSERS,t,e,this)}readPolygonPatch(t,e){return Y7([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)}readLineStringSegment(t,e){return Y7([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)}interiorParser(t,e){const i=Y7(void 0,this.RING_PARSERS,t,e,this);i&&e[e.length-1].push(i)}exteriorParser(t,e){const i=Y7(void 0,this.RING_PARSERS,t,e,this);i&&(e[e.length-1][0]=i)}readSurface(t,e){const i=Y7([null],this.SURFACE_PARSERS,t,e,this);if(i&&i[0]){const t=i[0],e=[t.length];let n,s;for(n=1,s=i.length;n<s;++n)vB(t,i[n]),e.push(t.length);return new tW(t,\"XYZ\",e)}}readCurve(t,e){const i=Y7([null],this.CURVE_PARSERS,t,e,this);if(i)return new D8(i,\"XYZ\")}readEnvelope(t,e){const i=Y7([null],this.ENVELOPE_PARSERS,t,e,this);return pz(i[1][0],i[1][1],i[2][0],i[2][1])}readFlatPos(t,e){let i=O7(t,!1);const n=/^\\s*([+\\-]?\\d*\\.?\\d+(?:[eE][+\\-]?\\d+)?)\\s*/,s=[];let r;for(;r=n.exec(i);)s.push(parseFloat(r[1])),i=i.substr(r[0].length);if(\"\"!==i)return;const o=e[0].srsName;let a=\"enu\";if(o&&(a=EV(o).getAxisOrientation()),\"neu\"===a){let t,e;for(t=0,e=s.length;t<e;t+=3){const e=s[t];s[t]=s[t+1],s[t+1]=e}}const l=s.length;return 2==l&&s.push(0),0!==l?s:void 0}readFlatPosList(t,e){const i=O7(t,!1).replace(/^\\s*|\\s*$/g,\"\"),n=e[0],s=n.srsName,r=n.srsDimension;let o=\"enu\";s&&(o=EV(s).getAxisOrientation());const a=i.split(/\\s+/);let l,c,h,u=2;t.getAttribute(\"srsDimension\")?u=r9(t.getAttribute(\"srsDimension\")):t.getAttribute(\"dimension\")?u=r9(t.getAttribute(\"dimension\")):t.parentNode.getAttribute(\"srsDimension\")?u=r9(t.parentNode.getAttribute(\"srsDimension\")):r&&(u=r9(r));const d=[];for(let p=0,f=a.length;p<f;p+=u)l=parseFloat(a[p]),c=parseFloat(a[p+1]),h=3===u?parseFloat(a[p+2]):0,\"en\"===o.substr(0,2)?d.push(l,c,h):d.push(c,l,h);return d}writePos_(t,e,i){const n=i[i.length-1],s=n.hasZ;t.setAttribute(\"srsDimension\",s?\"3\":\"2\");const r=n.srsName;let o=\"enu\";r&&(o=EV(r).getAxisOrientation());const a=e.getCoordinates();let l;l=\"en\"===o.substr(0,2)?a[0]+\" \"+a[1]:a[1]+\" \"+a[0],s&&(l+=\" \"+(a[2]||0)),h9(t,l)}getCoords_(t,e,i){let n=\"enu\";e&&(n=EV(e).getAxisOrientation());let s=\"en\"===n.substr(0,2)?t[0]+\" \"+t[1]:t[1]+\" \"+t[0];return i&&(s+=\" \"+(t[2]||0)),s}writePosList_(t,e,i){const n=i[i.length-1],s=n.hasZ;t.setAttribute(\"srsDimension\",s?\"3\":\"2\");const r=n.srsName,o=e.getCoordinates(),a=o.length,l=new Array(a);let c;for(let h=0;h<a;++h)c=o[h],l[h]=this.getCoords_(c,r,s);h9(t,l.join(\" \"))}writePoint(t,e,i){const n=i[i.length-1].srsName;n&&t.setAttribute(\"srsName\",n);const s=P7(t.namespaceURI,\"pos\");t.appendChild(s),this.writePos_(s,e,i)}writeEnvelope(t,e,i){const n=i[i.length-1].srsName;n&&t.setAttribute(\"srsName\",n),K7({node:t},this.ENVELOPE_SERIALIZERS,H7,[e[0]+\" \"+e[1],e[2]+\" \"+e[3]],i,[\"lowerCorner\",\"upperCorner\"],this)}writeLinearRing(t,e,i){const n=i[i.length-1].srsName;n&&t.setAttribute(\"srsName\",n);const s=P7(t.namespaceURI,\"posList\");t.appendChild(s),this.writePosList_(s,e,i)}RING_NODE_FACTORY_(t,e,i){const n=e[e.length-1],s=n.node,r=n.exteriorWritten;return void 0===r&&(n.exteriorWritten=!0),P7(s.namespaceURI,void 0!==r?\"interior\":\"exterior\")}writeSurfaceOrPolygon(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName;if(\"PolygonPatch\"!==t.nodeName&&r&&t.setAttribute(\"srsName\",r),\"Polygon\"===t.nodeName||\"PolygonPatch\"===t.nodeName){const n=e.getLinearRings();K7({node:t,hasZ:s,srsName:r},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,n,i,void 0,this)}else if(\"Surface\"===t.nodeName){const n=P7(t.namespaceURI,\"patches\");t.appendChild(n),this.writeSurfacePatches_(n,e,i)}}writeCurveOrLineString(t,e,i){const n=i[i.length-1].srsName;if(\"LineStringSegment\"!==t.nodeName&&n&&t.setAttribute(\"srsName\",n),\"LineString\"===t.nodeName||\"LineStringSegment\"===t.nodeName){const n=P7(t.namespaceURI,\"posList\");t.appendChild(n),this.writePosList_(n,e,i)}else if(\"Curve\"===t.nodeName){const n=P7(t.namespaceURI,\"segments\");t.appendChild(n),this.writeCurveSegments_(n,e,i)}}writeMultiSurfaceOrPolygon(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName,o=n.surface;r&&t.setAttribute(\"srsName\",r);const a=e.getPolygons();K7({node:t,hasZ:s,srsName:r,surface:o},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)}writeMultiPoint(t,e,i){const n=i[i.length-1],s=n.srsName,r=n.hasZ;s&&t.setAttribute(\"srsName\",s);const o=e.getPoints();K7({node:t,hasZ:r,srsName:s},this.POINTMEMBER_SERIALIZERS,j7(\"pointMember\"),o,i,void 0,this)}writeMultiCurveOrLineString(t,e,i){const n=i[i.length-1],s=n.hasZ,r=n.srsName,o=n.curve;r&&t.setAttribute(\"srsName\",r);const a=e.getLineStrings();K7({node:t,hasZ:s,srsName:r,curve:o},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)}writeRing(t,e,i){const n=P7(t.namespaceURI,\"LinearRing\");t.appendChild(n),this.writeLinearRing(n,e,i)}writeSurfaceOrPolygonMember(t,e,i){const n=this.GEOMETRY_NODE_FACTORY_(e,i);n&&(t.appendChild(n),this.writeSurfaceOrPolygon(n,e,i))}writePointMember(t,e,i){const n=P7(t.namespaceURI,\"Point\");t.appendChild(n),this.writePoint(n,e,i)}writeLineStringOrCurveMember(t,e,i){const n=this.GEOMETRY_NODE_FACTORY_(e,i);n&&(t.appendChild(n),this.writeCurveOrLineString(n,e,i))}writeSurfacePatches_(t,e,i){const n=P7(t.namespaceURI,\"PolygonPatch\");t.appendChild(n),this.writeSurfaceOrPolygon(n,e,i)}writeCurveSegments_(t,e,i){const n=P7(t.namespaceURI,\"LineStringSegment\");t.appendChild(n),this.writeCurveOrLineString(n,e,i)}writeGeometryElement(t,e,i){const n=i[i.length-1],s=Object.assign({},n);let r;s.node=t,r=Array.isArray(e)?T7(e,n):M7(e,!0,n),K7(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[r],i,void 0,this)}writeFeatureElement(t,e,i){const n=e.getId();n&&t.setAttribute(\"fid\",n);const s=i[i.length-1],r=s.featureNS,o=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[r]={});const a=[],l=[];if(e.hasProperties()){const t=e.getProperties();for(const e in t){const i=t[e];null!==i&&(a.push(e),l.push(i),e==o||\"function\"==typeof i.getSimplifiedGeometry?e in s.serializers[r]||(s.serializers[r][e]=$7(this.writeGeometryElement,this)):e in s.serializers[r]||(s.serializers[r][e]=$7(h9)))}}const c=Object.assign({},s);c.node=t,K7(c,s.serializers,j7(void 0,r),l,i,a)}writeFeatureMembers_(t,e,i){const n=i[i.length-1],s=n.featureType,r=n.featureNS,o={};o[r]={},o[r][s]=$7(this.writeFeatureElement,this);const a=Object.assign({},n);a.node=t,K7(a,o,j7(s,r),e,i)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(t,e,i){return P7(this.namespace,fut[e[e.length-1].node.nodeName])}GEOMETRY_NODE_FACTORY_(t,e,i){const n=e[e.length-1],s=n.multiSurface,r=n.surface,o=n.curve,a=n.multiCurve;return Array.isArray(t)?i=\"Envelope\":\"MultiPolygon\"===(i=t.getType())&&!0===s?i=\"MultiSurface\":\"Polygon\"===i&&!0===r?i=\"Surface\":\"LineString\"===i&&!0===o?i=\"Curve\":\"MultiLineString\"===i&&!0===a&&(i=\"MultiCurve\"),P7(this.namespace,i)}writeGeometryNode(t,e){e=this.adaptOptions(e);const i=P7(this.namespace,\"geom\"),n={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&Object.assign(n,e),this.writeGeometryElement(i,t,[n]),i}writeFeaturesNode(t,e){e=this.adaptOptions(e);const i=P7(this.namespace,\"featureMembers\");i.setAttributeNS(I7,\"xsi:schemaLocation\",this.schemaLocation);const n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&Object.assign(n,e),this.writeFeatureMembers_(i,t,[n]),i}}mut.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={\"http://www.opengis.net/gml\":{pos:B7(mut.prototype.readFlatPos),posList:B7(mut.prototype.readFlatPosList),coordinates:B7(put.prototype.readFlatCoordinates)}},mut.prototype.FLAT_LINEAR_RINGS_PARSERS={\"http://www.opengis.net/gml\":{interior:mut.prototype.interiorParser,exterior:mut.prototype.exteriorParser}},mut.prototype.GEOMETRY_PARSERS={\"http://www.opengis.net/gml\":{Point:B7(hut.prototype.readPoint),MultiPoint:B7(hut.prototype.readMultiPoint),LineString:B7(hut.prototype.readLineString),MultiLineString:B7(hut.prototype.readMultiLineString),LinearRing:B7(hut.prototype.readLinearRing),Polygon:B7(hut.prototype.readPolygon),MultiPolygon:B7(hut.prototype.readMultiPolygon),Surface:B7(mut.prototype.readSurface),MultiSurface:B7(mut.prototype.readMultiSurface),Curve:B7(mut.prototype.readCurve),MultiCurve:B7(mut.prototype.readMultiCurve),Envelope:B7(mut.prototype.readEnvelope)}},mut.prototype.MULTICURVE_PARSERS={\"http://www.opengis.net/gml\":{curveMember:N7(mut.prototype.curveMemberParser),curveMembers:N7(mut.prototype.curveMemberParser)}},mut.prototype.MULTISURFACE_PARSERS={\"http://www.opengis.net/gml\":{surfaceMember:N7(mut.prototype.surfaceMemberParser),surfaceMembers:N7(mut.prototype.surfaceMemberParser)}},mut.prototype.CURVEMEMBER_PARSERS={\"http://www.opengis.net/gml\":{LineString:N7(hut.prototype.readLineString),Curve:N7(mut.prototype.readCurve)}},mut.prototype.SURFACEMEMBER_PARSERS={\"http://www.opengis.net/gml\":{Polygon:N7(hut.prototype.readPolygon),Surface:N7(mut.prototype.readSurface)}},mut.prototype.SURFACE_PARSERS={\"http://www.opengis.net/gml\":{patches:B7(mut.prototype.readPatch)}},mut.prototype.CURVE_PARSERS={\"http://www.opengis.net/gml\":{segments:B7(mut.prototype.readSegment)}},mut.prototype.ENVELOPE_PARSERS={\"http://www.opengis.net/gml\":{lowerCorner:N7(mut.prototype.readFlatPosList),upperCorner:N7(mut.prototype.readFlatPosList)}},mut.prototype.PATCHES_PARSERS={\"http://www.opengis.net/gml\":{PolygonPatch:B7(mut.prototype.readPolygonPatch)}},mut.prototype.SEGMENTS_PARSERS={\"http://www.opengis.net/gml\":{LineStringSegment:F7(mut.prototype.readLineStringSegment)}},hut.prototype.RING_PARSERS={\"http://www.opengis.net/gml\":{LinearRing:B7(hut.prototype.readFlatLinearRing),Ring:B7(mut.prototype.readFlatCurveRing)}},mut.prototype.RING_SERIALIZERS={\"http://www.opengis.net/gml\":{exterior:$7(mut.prototype.writeRing),interior:$7(mut.prototype.writeRing)}},mut.prototype.ENVELOPE_SERIALIZERS={\"http://www.opengis.net/gml\":{lowerCorner:$7(h9),upperCorner:$7(h9)}},mut.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={\"http://www.opengis.net/gml\":{surfaceMember:$7(mut.prototype.writeSurfaceOrPolygonMember),polygonMember:$7(mut.prototype.writeSurfaceOrPolygonMember)}},mut.prototype.POINTMEMBER_SERIALIZERS={\"http://www.opengis.net/gml\":{pointMember:$7(mut.prototype.writePointMember)}},mut.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={\"http://www.opengis.net/gml\":{lineStringMember:$7(mut.prototype.writeLineStringOrCurveMember),curveMember:$7(mut.prototype.writeLineStringOrCurveMember)}},mut.prototype.GEOMETRY_SERIALIZERS={\"http://www.opengis.net/gml\":{Curve:$7(mut.prototype.writeCurveOrLineString),MultiCurve:$7(mut.prototype.writeMultiCurveOrLineString),Point:$7(mut.prototype.writePoint),MultiPoint:$7(mut.prototype.writeMultiPoint),LineString:$7(mut.prototype.writeCurveOrLineString),MultiLineString:$7(mut.prototype.writeMultiCurveOrLineString),LinearRing:$7(mut.prototype.writeLinearRing),Polygon:$7(mut.prototype.writeSurfaceOrPolygon),MultiPolygon:$7(mut.prototype.writeMultiSurfaceOrPolygon),Surface:$7(mut.prototype.writeSurfaceOrPolygon),MultiSurface:$7(mut.prototype.writeMultiSurfaceOrPolygon),Envelope:$7(mut.prototype.writeEnvelope)}};var gut=mut;class Aut extends x${constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}var vut=class extends F${constructor(t){const e=void 0!==t.requestEncoding?t.requestEncoding:\"KVP\",i=t.tileGrid;let n=t.urls;void 0===n&&void 0!==t.url&&(n=O$(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:n,wrapX:void 0!==t.wrapX&&t.wrapX,transition:t.transition,zDirection:t.zDirection}),this.version_=void 0!==t.version?t.version:\"1.0.0\",this.format_=void 0!==t.format?t.format:\"image/jpeg\",this.dimensions_=void 0!==t.dimensions?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=P$(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join(\"\\n\");this.setTileUrlFunction(P$(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){let t=0;const e=[];for(const i in this.dimensions_)e[t++]=i+\"-\"+this.dimensions_[i];return e.join(\"/\")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};\"KVP\"==e&&Object.assign(i,{Service:\"WMTS\",Request:\"GetTile\",Version:this.version_,Format:this.format_}),t=\"KVP\"==e?eut(t,i):t.replace(/\\{(\\w+?)\\}/g,function(t,e){return e.toLowerCase()in i?i[e.toLowerCase()]:t});const n=this.tileGrid,s=this.dimensions_;return function(i,r,o){if(i){const r={TileMatrix:n.getMatrixId(i[0]),TileCol:i[1],TileRow:i[2]};Object.assign(r,s);let o=t;return o=\"KVP\"==e?eut(o,r):o.replace(/\\{(\\w+?)\\}/g,function(t,e){return r[e]}),o}}}};function _ut(t,e,i,n,s,r,o){try{var a=t[r](o),l=a.value}catch(c){return void i(c)}a.done?e(l):Promise.resolve(l).then(n,s)}function but(t){return function(){var e=this,i=arguments;return new Promise(function(n,s){var r=t.apply(e,i);function o(t){_ut(r,n,s,o,a,\"next\",t)}function a(t){_ut(r,n,s,o,a,\"throw\",t)}o(void 0)})}}let yut=0;function wut(t,e,i){return new Promise((n,s)=>{const r=yut++,o={requestId:r,taskName:t,params:i};null===e?window.dispatchEvent(new CustomEvent(\"ogc-client.request\",{detail:o})):e.postMessage(o);const a=({detail:t,data:i})=>{const o=t||i;o.requestId===r&&(null===e?window.removeEventListener(\"message\",a):e.removeEventListener(\"message\",a),\"error\"in o?s(o.error):n(o.response))};null===e?window.addEventListener(\"ogc-client.response\",a):e.addEventListener(\"message\",a)})}function xut(t,e,i){const n=\"undefined\"!=typeof WorkerGlobalScope,s=function(){var s=but(function*({detail:s,data:r}){const o=s||r;if(o.taskName===t){let s,r;try{s=yield i(o.params)}catch(a){r=a}const l=po(po({taskName:t,requestId:o.requestId},s&&{response:s}),r&&{error:r});n?e.postMessage(l):e.dispatchEvent(new CustomEvent(\"ogc-client.response\",{detail:l}))}});return function(t){return s.apply(this,arguments)}}();e.addEventListener(n?\"message\":\"ogc-client.request\",s)}let Sut;function Cut(){return Sut||(Sut=new Worker(URL.createObjectURL(new Blob(['function t(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function e(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function r(t){return function(){var r=this,n=arguments;return new Promise((function(o,i){var a=t.apply(r,n);function c(t){e(a,o,i,c,u,\"next\",t)}function u(t){e(a,o,i,c,u,\"throw\",t)}c(void 0)}))}}function n(t){return n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t},n(t)}var o={exports:{}};!function(t){var e=function(t){var e,r=Object.prototype,o=r.hasOwnProperty,i=\"function\"==typeof Symbol?Symbol:{},a=i.iterator||\"@@iterator\",c=i.asyncIterator||\"@@asyncIterator\",u=i.toStringTag||\"@@toStringTag\";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},\"\")}catch(t){s=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o=e&&e.prototype instanceof y?e:y,i=Object.create(o.prototype),a=new j(n||[]);return i._invoke=function(t,e,r){var n=h;return function(o,i){if(n===v)throw new Error(\"Generator is already running\");if(n===m){if(\"throw\"===o)throw i;return T()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var c=k(a,r);if(c){if(c===d)continue;return c}}if(\"next\"===r.method)r.sent=r._sent=r.arg;else if(\"throw\"===r.method){if(n===h)throw n=m,r.arg;r.dispatchException(r.arg)}else\"return\"===r.method&&r.abrupt(\"return\",r.arg);n=v;var u=l(t,e,r);if(\"normal\"===u.type){if(n=r.done?m:p,u.arg===d)continue;return{value:u.arg,done:r.done}}\"throw\"===u.type&&(n=m,r.method=\"throw\",r.arg=u.arg)}}}(t,r,a),i}function l(t,e,r){try{return{type:\"normal\",arg:t.call(e,r)}}catch(t){return{type:\"throw\",arg:t}}}t.wrap=f;var h=\"suspendedStart\",p=\"suspendedYield\",v=\"executing\",m=\"completed\",d={};function y(){}function g(){}function b(){}var S={};S[a]=function(){return this};var E=Object.getPrototypeOf,O=E&&E(E(G([])));O&&O!==r&&o.call(O,a)&&(S=O);var w=b.prototype=y.prototype=Object.create(S);function P(t){[\"next\",\"throw\",\"return\"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(i,a,c,u){var s=l(t[i],t,a);if(\"throw\"!==s.type){var f=s.arg,h=f.value;return h&&\"object\"===n(h)&&o.call(h,\"__await\")?e.resolve(h.__await).then((function(t){r(\"next\",t,c,u)}),(function(t){r(\"throw\",t,c,u)})):e.resolve(h).then((function(t){f.value=t,c(f)}),(function(t){return r(\"throw\",t,c,u)}))}u(s.arg)}var i;this._invoke=function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}}function k(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,\"throw\"===r.method){if(t.iterator.return&&(r.method=\"return\",r.arg=e,k(t,r),\"throw\"===r.method))return d;r.method=\"throw\",r.arg=new TypeError(\"The iterator does not provide a \\'throw\\' method\")}return d}var o=l(n,t.iterator,r.arg);if(\"throw\"===o.type)return r.method=\"throw\",r.arg=o.arg,r.delegate=null,d;var i=o.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,\"return\"!==r.method&&(r.method=\"next\",r.arg=e),r.delegate=null,d):i:(r.method=\"throw\",r.arg=new TypeError(\"iterator result is not an object\"),r.delegate=null,d)}function R(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type=\"normal\",delete e.arg,t.completion=e}function j(t){this.tryEntries=[{tryLoc:\"root\"}],t.forEach(R,this),this.reset(!0)}function G(t){if(t){var r=t[a];if(r)return r.call(t);if(\"function\"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function r(){for(;++n<t.length;)if(o.call(t,n))return r.value=t[n],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}return{next:T}}function T(){return{value:e,done:!0}}return g.prototype=w.constructor=b,b.constructor=g,g.displayName=s(b,u,\"GeneratorFunction\"),t.isGeneratorFunction=function(t){var e=\"function\"==typeof t&&t.constructor;return!!e&&(e===g||\"GeneratorFunction\"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,\"GeneratorFunction\")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},P(x.prototype),x.prototype[c]=function(){return this},t.AsyncIterator=x,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new x(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},P(w),s(w,u,\"Generator\"),w[a]=function(){return this},w.toString=function(){return\"[object Generator]\"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=G,j.prototype={constructor:j,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=e,this.tryEntries.forEach(C),!t)for(var r in this)\"t\"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if(\"throw\"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return c.type=\"throw\",c.arg=t,r.next=n,o&&(r.method=\"next\",r.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if(\"root\"===a.tryLoc)return n(\"end\");if(a.tryLoc<=this.prev){var u=o.call(a,\"catchLoc\"),s=o.call(a,\"finallyLoc\");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error(\"try statement without catch or finally\");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,\"finallyLoc\")&&this.prev<n.finallyLoc){var i=n;break}}i&&(\"break\"===t||\"continue\"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method=\"next\",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if(\"throw\"===t.type)throw t.arg;return\"break\"===t.type||\"continue\"===t.type?this.next=t.arg:\"return\"===t.type?(this.rval=this.arg=t.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),C(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if(\"throw\"===n.type){var o=n.arg;C(r)}return o}}throw new Error(\"illegal catch attempt\")},delegateYield:function(t,r,n){return this.delegate={iterator:G(t),resultName:r,nextLoc:n},\"next\"===this.method&&(this.arg=e),d}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function(\"r\",\"regeneratorRuntime = r\")(e)}}(o);var i=o.exports;function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(t,e,n){var o=\"undefined\"!=typeof WorkerGlobalScope,a=function(){var a=r(i.mark((function r(a){var u,s,f,l,h,p;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=a.detail,s=a.data,(f=u||s).taskName!==t){r.next=14;break}return r.prev=3,r.next=6,n(f.params);case 6:l=r.sent,r.next=12;break;case 9:r.prev=9,r.t0=r.catch(3),h=r.t0;case 12:p=c(c({taskName:t,requestId:f.requestId},l&&{response:l}),h&&{error:h}),o?e.postMessage(p):e.dispatchEvent(new CustomEvent(\"ogc-client.response\",{detail:p}));case 14:case\"end\":return r.stop()}}),r,null,[[3,9]])})));return function(t){return a.apply(this,arguments)}}();o?e.addEventListener(\"message\",a):e.addEventListener(\"ogc-client.request\",a)}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function f(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if(\"string\"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===r&&t.constructor&&(r=t.constructor.name),\"Map\"===r||\"Set\"===r?Array.from(t):\"Arguments\"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function l(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}function p(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}function v(t,e){return!e||\"object\"!==n(e)&&\"function\"!=typeof e?function(t){if(void 0===t)throw new ReferenceError(\"this hasn\\'t been initialised - super() hasn\\'t been called\");return t}(t):e}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}function d(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function y(t,e,r){return y=d()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&h(o,r.prototype),o},y.apply(null,arguments)}function g(t){var e=\"function\"==typeof Map?new Map:void 0;return g=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf(\"[native code]\")))return t;var r;if(\"function\"!=typeof t)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return y(t,arguments,m(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),h(n,t)},g(t)}function b(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,e,r){return e&&b(t.prototype,e),r&&b(t,r),t}var E=function(){function t(e){l(this,t),this.chars=f(e),this.charCount=this.chars.length,this.charIndex=0,this.charsToBytes=new Array(this.charCount),this.multiByteMode=!1,this.string=e;var r=this.chars,n=this.charCount,o=this.charsToBytes;if(n===e.length)for(var i=0;i<n;++i)o[i]=i;else{for(var a=0,c=0;c<n;++c)o[c]=a,a+=r[c].length;this.multiByteMode=!0}}return S(t,[{key:\"isEnd\",get:function(){return this.charIndex>=this.charCount}},{key:\"_charLength\",value:function(t){var e=t.length;return e<2||!this.multiByteMode?e:t.replace(/[\\\\uD800-\\\\uDBFF][\\\\uDC00-\\\\uDFFF]/g,\"_\").length}},{key:\"advance\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.charIndex=Math.min(this.charCount,this.charIndex+t)}},{key:\"consume\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.peek(t);return this.advance(t),e}},{key:\"consumeMatch\",value:function(t){if(!t.sticky)throw new Error(\\'`regex` must have a sticky flag (\"y\")\\');t.lastIndex=this.charsToBytes[this.charIndex];var e=t.exec(this.string);if(null===e)return\"\";var r=e[0];return this.advance(this._charLength(r)),r}},{key:\"consumeMatchFn\",value:function(t){for(var e=this.charIndex;!this.isEnd&&t(this.peek());)this.advance();return this.charIndex>e?this.string.slice(this.charsToBytes[e],this.charsToBytes[this.charIndex]):\"\"}},{key:\"consumeString\",value:function(t){if(this.consumeStringFast(t))return t;if(!this.multiByteMode)return\"\";var e=t.length,r=this._charLength(t);return r!==e&&t===this.peek(r)?(this.advance(r),t):\"\"}},{key:\"consumeStringFast\",value:function(t){if(this.peek()===t[0]){var e=t.length;if(1===e)return this.advance(),t;if(this.peek(e)===t)return this.advance(e),t}return\"\"}},{key:\"consumeUntilMatch\",value:function(t){if(!t.global)throw new Error(\\'`regex` must have a global flag (\"g\")\\');var e=this.charsToBytes[this.charIndex];t.lastIndex=e;var r=t.exec(this.string);if(null===r||r.index===e)return\"\";var n=this.string.slice(e,r.index);return this.advance(this._charLength(n)),n}},{key:\"consumeUntilString\",value:function(t){var e=this.charIndex,r=this.charsToBytes,n=this.string,o=r[e],i=n.indexOf(t,o);if(i<=0)return\"\";var a=n.slice(o,i);return this.advance(this._charLength(a)),a}},{key:\"peek\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.charIndex>=this.charCount)return\"\";if(1===t)return this.chars[this.charIndex];var e=this.charsToBytes,r=this.charIndex;return this.string.slice(e[r],e[r+t])}},{key:\"reset\",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.charIndex=t>=0?Math.min(this.charCount,t):Math.max(0,this.charIndex+t)}}]),t}(),O=E,w={},P=Object.freeze(Object.assign(Object.create(null),{amp:\"&\",apos:\"\\'\",gt:\">\",lt:\"<\",quot:\\'\"\\'}));function x(t){if(k(t))return!0;var e=C(t);return 45===e||46===e||e>=48&&e<=57||183===e||e>=768&&e<=879||e>=8255&&e<=8256}function k(t){var e=C(t);return 58===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=192&&e<=214||e>=216&&e<=246||e>=248&&e<=767||e>=880&&e<=893||e>=895&&e<=8191||e>=8204&&e<=8205||e>=8304&&e<=8591||e>=11264&&e<=12271||e>=12289&&e<=55295||e>=63744&&e<=64975||e>=65008&&e<=65533||e>=65536&&e<=983039}function R(t){var e=C(t);return 9===e||10===e||13===e||e>=32&&e<=55295||e>=57344&&e<=65533||e>=65536&&e<=1114111}function C(t){return t.codePointAt(0)||-1}w.predefinedEntities=P,w.isNameChar=x,w.isNameStartChar=k,w.isNotXmlChar=function(t){return!R(t)},w.isReferenceChar=function(t){return\"#\"===t||x(t)},w.isWhitespace=function(t){var e=C(t);return 32===e||9===e||10===e||13===e},w.isXmlChar=R;var j=function(){function t(){l(this,t),this.parent=null}return S(t,[{key:\"document\",get:function(){return this.parent?this.parent.document:null}},{key:\"isRootNode\",get:function(){return!!this.parent&&this.parent===this.document}},{key:\"preserveWhitespace\",get:function(){return Boolean(this.parent&&this.parent.preserveWhitespace)}},{key:\"type\",get:function(){return\"\"}},{key:\"toJSON\",value:function(){var t={type:this.type};return this.isRootNode&&(t.isRootNode=!0),this.preserveWhitespace&&(t.preserveWhitespace=!0),t}}]),t}();j.TYPE_CDATA=\"cdata\",j.TYPE_COMMENT=\"comment\",j.TYPE_DOCUMENT=\"document\",j.TYPE_ELEMENT=\"element\",j.TYPE_PROCESSING_INSTRUCTION=\"pi\",j.TYPE_TEXT=\"text\";var G=j;function T(t){var e=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}var N=G,F=function(t){p(r,N);var e=T(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\";return l(this,r),(t=e.call(this)).text=n,t}return S(r,[{key:\"type\",get:function(){return N.TYPE_TEXT}},{key:\"toJSON\",value:function(){return Object.assign(N.prototype.toJSON.call(this),{text:this.text})}}]),r}(),L=F;function A(t){var e=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}var I=G,M=L,B=function(t){p(r,M);var e=A(r);function r(){return l(this,r),e.apply(this,arguments)}return S(r,[{key:\"type\",get:function(){return I.TYPE_CDATA}}]),r}(),_=B;function U(t){var e=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}var D=G,W=function(t){p(r,D);var e=U(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"\";return l(this,r),(t=e.call(this)).content=n,t}return S(r,[{key:\"type\",get:function(){return D.TYPE_COMMENT}},{key:\"toJSON\",value:function(){return Object.assign(D.prototype.toJSON.call(this),{content:this.content})}}]),r}(),X=W;function Y(t){var e=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}var q=G,J=function(t){p(r,q);var e=Y(r);function r(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.create(null),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return l(this,r),(n=e.call(this)).name=t,n.attributes=o,n.children=i,n}return S(r,[{key:\"isEmpty\",get:function(){return 0===this.children.length}},{key:\"preserveWhitespace\",get:function(){for(var t=this;t instanceof r;){if(\"xml:space\"in t.attributes)return\"preserve\"===t.attributes[\"xml:space\"];t=t.parent}return!1}},{key:\"text\",get:function(){return this.children.map((function(t){return\"text\"in t?t.text:\"\"})).join(\"\")}},{key:\"type\",get:function(){return q.TYPE_ELEMENT}},{key:\"toJSON\",value:function(){return Object.assign(q.prototype.toJSON.call(this),{name:this.name,attributes:this.attributes,children:this.children.map((function(t){return t.toJSON()}))})}}]),r}(),V=J;function $(t){var e=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}var K=V,z=G,H=function(t){p(r,z);var e=$(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(this,r),(t=e.call(this)).children=n,t}return S(r,[{key:\"document\",get:function(){return this}},{key:\"root\",get:function(){return this.children.find((function(t){return t instanceof K}))||null}},{key:\"text\",get:function(){return this.children.map((function(t){return\"text\"in t?t.text:\"\"})).join(\"\")}},{key:\"type\",get:function(){return z.TYPE_DOCUMENT}},{key:\"toJSON\",value:function(){return Object.assign(z.prototype.toJSON.call(this),{children:this.children.map((function(t){return t.toJSON()}))})}}]),r}(),Q=H;function Z(t){var e=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}var tt=G,et=function(t){p(r,tt);var e=Z(r);function r(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"\";return l(this,r),(n=e.call(this)).name=t,n.content=o,n}return S(r,[{key:\"type\",get:function(){return tt.TYPE_PROCESSING_INSTRUCTION}},{key:\"toJSON\",value:function(){return Object.assign(tt.prototype.toJSON.call(this),{name:this.name,content:this.content})}}]),r}(),rt=et;function nt(t,e){var r;if(\"undefined\"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if(\"string\"==typeof t)return ot(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===r&&t.constructor&&(r=t.constructor.name);if(\"Map\"===r||\"Set\"===r)return Array.from(t);if(\"Arguments\"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ot(t,e)}(t))||e&&t&&\"number\"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var i,a=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var it=O,at=w,ct=_,ut=X,st=Q,ft=V,lt=rt,ht=L,pt=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(l(this,t),this.document=new st,this.currentNode=this.document,this.options=r,this.scanner=new it(vt(e)),this.consumeProlog(),this.consumeElement()||this.error(\"Root element is missing or invalid\");this.consumeMisc(););this.scanner.isEnd||this.error(\"Extra content at the end of the document\")}return S(t,[{key:\"addNode\",value:function(t){t.parent=this.currentNode,this.currentNode.children.push(t)}},{key:\"addText\",value:function(t){var e=this.currentNode.children;if(e.length>0){var r=e[e.length-1];if(r instanceof ht)return void(r.text+=t)}this.addNode(new ht(t))}},{key:\"consumeAttributeValue\",value:function(){var t,e=this.scanner,r=e.peek();if(\\'\"\\'!==r&&\"\\'\"!==r)return!1;e.advance();var n=!1,o=\"\",i=\\'\"\\'===r?new RegExp(\\'[^\"&<]+\\',\"y\"):new RegExp(\"[^\\'&<]+\",\"y\");t:for(;!e.isEnd;){switch((t=e.consumeMatch(i))&&(this.validateChars(t),o+=t.replace(/[\\\\t\\\\r\\\\n]/g,\" \")),e.peek()){case r:n=!0;break t;case\"&\":o+=this.consumeReference();continue;case\"<\":this.error(\"Unescaped `<` is not allowed in an attribute value\");break;case\"\":this.error(\"Unclosed attribute\")}}return n||this.error(\"Unclosed attribute\"),e.advance(),o}},{key:\"consumeCdataSection\",value:function(){var t=this.scanner;if(!t.consumeStringFast(\"<![CDATA[\"))return!1;var e=t.consumeUntilString(\"]]>\");return this.validateChars(e),t.consumeStringFast(\"]]>\")||this.error(\"Unclosed CDATA section\"),this.options.preserveCdata?this.addNode(new ct(e)):this.addText(e),!0}},{key:\"consumeCharData\",value:function(){var t=this.scanner,e=t.consumeUntilMatch(/<|&|]]>/g);return!!e&&(this.validateChars(e),\"]\"===t.peek()&&\"]]>\"===t.peek(3)&&this.error(\"Element content may not contain the CDATA section close delimiter `]]>`\"),this.addText(e),!0)}},{key:\"consumeComment\",value:function(){var t=this.scanner;if(!t.consumeStringFast(\"\\\\x3c!--\"))return!1;var e=t.consumeUntilString(\"--\");return this.validateChars(e),t.consumeStringFast(\"--\\\\x3e\")||(\"--\"===t.peek(2)?this.error(\"The string `--` isn\\'t allowed inside a comment\"):this.error(\"Unclosed comment\")),this.options.preserveComments&&this.addNode(new ut(e.trim())),!0}},{key:\"consumeContentReference\",value:function(){var t=this.consumeReference();return!!t&&(this.addText(t),!0)}},{key:\"consumeDoctypeDeclaration\",value:function(){var t=this.scanner;return!(!t.consumeStringFast(\"<!DOCTYPE\")||!this.consumeWhitespace())&&(t.consumeMatch(new RegExp(\"[^[>]+\",\"y\")),t.consumeMatch(new RegExp(\"\\\\\\\\[[\\\\\\\\s\\\\\\\\S]+?\\\\\\\\][\\\\\\\\x20\\\\\\\\t\\\\\\\\r\\\\\\\\n]*>\",\"y\"))||t.consumeStringFast(\">\")||this.error(\"Unclosed doctype declaration\"),!0)}},{key:\"consumeElement\",value:function(){var t=this.scanner,e=t.charIndex;if(\"<\"!==t.peek())return!1;t.advance();var r=this.consumeName();if(!r)return t.reset(e),!1;for(var n=Object.create(null);this.consumeWhitespace();){var o=this.consumeName();if(o){var i=this.consumeEqual()&&this.consumeAttributeValue();!1===i&&this.error(\"Attribute value expected\"),o in n&&this.error(\"Duplicate attribute: \".concat(o)),\"xml:space\"===o&&\"default\"!==i&&\"preserve\"!==i&&this.error(\\'Value of the `xml:space` attribute must be \"default\" or \"preserve\"\\'),n[o]=i}}if(this.options.sortAttributes){for(var a=Object.keys(n).sort(),c=Object.create(null),u=0;u<a.length;++u){var s=a[u];c[s]=n[s]}n=c}var f=Boolean(t.consumeStringFast(\"/>\")),l=new ft(r,n);if(l.parent=this.currentNode,!f){for(t.consumeStringFast(\">\")||this.error(\"Unclosed start tag for element `\".concat(r,\"`\")),this.currentNode=l,this.consumeCharData();this.consumeElement()||this.consumeContentReference()||this.consumeCdataSection()||this.consumeProcessingInstruction()||this.consumeComment();)this.consumeCharData();var h,p=t.charIndex;t.consumeStringFast(\"</\")&&(h=this.consumeName())&&h===r||(t.reset(p),this.error(\"Missing end tag for element \".concat(r))),this.consumeWhitespace(),t.consumeStringFast(\">\")||this.error(\"Unclosed end tag for element \".concat(r)),this.currentNode=l.parent}return this.addNode(l),!0}},{key:\"consumeEqual\",value:function(){return this.consumeWhitespace(),!!this.scanner.consumeStringFast(\"=\")&&(this.consumeWhitespace(),!0)}},{key:\"consumeMisc\",value:function(){return this.consumeComment()||this.consumeProcessingInstruction()||this.consumeWhitespace()}},{key:\"consumeName\",value:function(){return at.isNameStartChar(this.scanner.peek())?this.scanner.consumeMatchFn(at.isNameChar):\"\"}},{key:\"consumeProcessingInstruction\",value:function(){var t=this.scanner,e=t.charIndex;if(!t.consumeStringFast(\"<?\"))return!1;var r=this.consumeName();if(r?\"xml\"===r.toLowerCase()&&(t.reset(e),this.error(\"XML declaration isn\\'t allowed here\")):this.error(\"Invalid processing instruction\"),!this.consumeWhitespace()){if(t.consumeStringFast(\"?>\"))return this.addNode(new lt(r)),!0;this.error(\"Whitespace is required after a processing instruction name\")}var n=t.consumeUntilString(\"?>\");return this.validateChars(n),t.consumeStringFast(\"?>\")||this.error(\"Unterminated processing instruction\"),this.addNode(new lt(r,n)),!0}},{key:\"consumeProlog\",value:function(){var t=this.scanner,e=t.charIndex;for(this.consumeXmlDeclaration();this.consumeMisc(););if(this.consumeDoctypeDeclaration())for(;this.consumeMisc(););return e<t.charIndex}},{key:\"consumeReference\",value:function(){var t=this.scanner;if(\"&\"!==t.peek())return!1;t.advance();var e,r=t.consumeMatchFn(at.isReferenceChar);if(\";\"!==t.consume()&&this.error(\"Unterminated reference (a reference must end with `;`)\"),\"#\"===r[0]){var o=\"x\"===r[1]?parseInt(r.slice(2),16):parseInt(r.slice(1),10);isNaN(o)&&this.error(\"Invalid character reference\"),e=String.fromCodePoint(o),at.isXmlChar(e)||this.error(\"Character reference resolves to an invalid character\")}else if(void 0===(e=at.predefinedEntities[r])){var i=this.options,a=i.ignoreUndefinedEntities,c=i.resolveUndefinedEntity,u=\"&\".concat(r,\";\");if(c){var s=c(u);if(null!=s){var f=n(s);if(\"string\"!==f)throw new TypeError(\"`resolveUndefinedEntity()` must return a string, `null`, or `undefined`, but returned a value of type \".concat(f));return s}}if(a)return u;t.reset(-u.length),this.error(\"Named entity isn\\'t defined: \".concat(u))}return e}},{key:\"consumeSystemLiteral\",value:function(){var t=this.scanner,e=t.consumeStringFast(\\'\"\\')||t.consumeStringFast(\"\\'\");if(!e)return!1;var r=t.consumeUntilString(e);return this.validateChars(r),t.consumeStringFast(e)||this.error(\"Missing end quote\"),r}},{key:\"consumeWhitespace\",value:function(){return Boolean(this.scanner.consumeMatchFn(at.isWhitespace))}},{key:\"consumeXmlDeclaration\",value:function(){var t=this.scanner;if(!t.consumeStringFast(\"<?xml\"))return!1;this.consumeWhitespace()||this.error(\"Invalid XML declaration\");var e=Boolean(t.consumeStringFast(\"version\"))&&this.consumeEqual()&&this.consumeSystemLiteral();if(!1===e?this.error(\"XML version is missing or invalid\"):/^1\\\\.[0-9]+$/.test(e)||this.error(\"Invalid character in version number\"),this.consumeWhitespace()){Boolean(t.consumeStringFast(\"encoding\"))&&this.consumeEqual()&&this.consumeSystemLiteral()&&this.consumeWhitespace();var r=Boolean(t.consumeStringFast(\"standalone\"))&&this.consumeEqual()&&this.consumeSystemLiteral();r&&(\"yes\"!==r&&\"no\"!==r&&this.error(\\'Only \"yes\" and \"no\" are permitted as values of `standalone`\\'),this.consumeWhitespace())}return t.consumeStringFast(\"?>\")||this.error(\"Invalid or unclosed XML declaration\"),!0}},{key:\"error\",value:function(t){for(var e=this.scanner,r=e.charIndex,n=e.string,o=1,i=\"\",a=1,c=0;c<r;++c){var u=n[c];\"\\\\n\"===u?(o=1,i=\"\",a+=1):(o+=1,i+=u)}var s=n.indexOf(\"\\\\n\",r),f=0;(i+=-1===s?n.slice(r):n.slice(r,s)).length>50&&(o<40?i=i.slice(0,50):(f=o-20,i=i.slice(f,o+30)));var l=new Error(\"\".concat(t,\" (line \").concat(a,\", column \").concat(o,\")\\\\n\")+\"  \".concat(i,\"\\\\n\")+\" \".repeat(o-f+1)+\"^\\\\n\");throw Object.assign(l,{column:o,excerpt:i,line:a,pos:r}),l}},{key:\"validateChars\",value:function(t){var e,r=0,n=nt(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;at.isNotXmlChar(o)&&(this.scanner.reset(-(f(t).length-r)),this.error(\"Invalid character\")),r+=1}}catch(t){n.e(t)}finally{n.f()}}}]),t}();function vt(t){return\"\\\\ufeff\"===t[0]&&(t=t.slice(1)),t.replace(/\\\\r\\\\n?/g,\"\\\\n\")}var mt=pt,dt=_,yt=X,gt=Q,bt=V,St=G,Et=rt,Ot=L;function wt(t,e){return new mt(t,e).document}wt.XmlCdata=dt,wt.XmlComment=yt,wt.XmlDocument=gt,wt.XmlElement=bt,wt.XmlNode=St,wt.XmlProcessingInstruction=Et,wt.XmlText=Ot;var Pt=wt;function xt(t){var e=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=m(t);if(e){var o=m(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return v(this,r)}}var kt=function(t){p(r,g(Error));var e=xt(r);function r(t){return l(this,r),e.call(this,t)}return r}();function Rt(t){return t.children[0]}function Ct(t){var e=t.indexOf(\":\");return e>-1?t.substr(e+1):t}function jt(t){return t.name||\"\"}function Gt(t,e,r){var n=Ct(e);return t&&Array.isArray(t.children)?t.children.reduce((function t(e,o){return Ct(jt(o))===n&&e.push(o),r&&Array.isArray(o.children)?[].concat(f(e),f(o.children.reduce(t,[]))):e}),[]):[]}function Tt(t,e,r){return Gt(t,e,r)[0]||null}function Nt(t){return t&&Array.isArray(t.children)?f(t.children.filter((function(t){return\"XmlElement\"===t.constructor.name}))):[]}function Ft(t){var e=t&&Array.isArray(t.children)?t.children.find((function(t){return\"text\"===t.type})):null;return e?e.text:\"\"}function Lt(t,e){return t&&t.attributes[e]||\"\"}var At=function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];l(this,t),this.message=e,this.httpStatus=r,this.isCrossOriginRelated=n};function It(t,e){var r;if(\"undefined\"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if(\"string\"==typeof t)return Mt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);\"Object\"===r&&t.constructor&&(r=t.constructor.name);if(\"Map\"===r||\"Set\"===r)return Array.from(t);if(\"Arguments\"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Mt(t,e)}(t))||e&&t&&\"number\"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var i,a=!0,c=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw i}}}}function Mt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Bt=new Map;function _t(t){return function(t){if(Bt.has(t))return Bt.get(t);var e=fetch(t);return e.finally((function(){return Bt.delete(t)})),Bt.set(t,e),e}(t).catch((function(){return fetch(t,{method:\"HEAD\",mode:\"no-cors\"}).catch((function(t){throw new At(\"Fetching the document failed either due to network errors or unreachable host, error is: \".concat(t.message),0,!1)})).then((function(){throw new At(\"The document could not be fetched due to CORS limitations\",0,!0)}))})).then(function(){var t=r(i.mark((function t(e){var r;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.text();case 2:if(r=t.sent,e.ok){t.next=5;break}throw new At(\"Received an error with code \".concat(e.status,\": \").concat(r),e.status,!1);case 5:return t.abrupt(\"return\",r);case 6:case\"end\":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((function(t){return function(t){var e=null;try{e=Pt(t)}catch(t){throw new kt(t.message)}return e}(t)}))}function Ut(t,e){var r=t.match(/(https?%3A%2F%2F[^/]+)$/);if(r){var n=r[1],o=Ut(decodeURIComponent(n),e);return t.replace(n,encodeURIComponent(o))}var i,a=new URL(t),c=Object.keys(e),u=c.map((function(t){return t.toLowerCase()})),s=[],f=It(a.searchParams.keys());try{for(f.s();!(i=f.n()).done;){var l=i.value;u.indexOf(l.toLowerCase())>-1&&s.push(l)}}catch(t){f.e(t)}finally{f.f()}return s.map((function(t){return a.searchParams.delete(t)})),c.forEach((function(t){return a.searchParams.set(t,!0===e[t]?\"\":e[t])})),a.toString()}var Dt=[\"EPSG:4046\",\"EPSG:4075\",\"EPSG:4120\",\"EPSG:4122\",\"EPSG:4124\",\"EPSG:4126\",\"EPSG:4149\",\"EPSG:4151\",\"EPSG:4153\",\"EPSG:4155\",\"EPSG:4157\",\"EPSG:4159\",\"EPSG:4161\",\"EPSG:4163\",\"EPSG:4165\",\"EPSG:4167\",\"EPSG:4169\",\"EPSG:4171\",\"EPSG:4173\",\"EPSG:4175\",\"EPSG:4178\",\"EPSG:4180\",\"EPSG:4182\",\"EPSG:4184\",\"EPSG:4188\",\"EPSG:4190\",\"EPSG:4191\",\"EPSG:4196\",\"EPSG:4198\",\"EPSG:4202\",\"EPSG:4210\",\"EPSG:4211\",\"EPSG:4214\",\"EPSG:4226\",\"EPSG:4229\",\"EPSG:4231\",\"EPSG:4233\",\"EPSG:4236\",\"EPSG:4238\",\"EPSG:4240\",\"EPSG:4242\",\"EPSG:4244\",\"EPSG:4246\",\"EPSG:4248\",\"EPSG:4250\",\"EPSG:4252\",\"EPSG:4255\",\"EPSG:4258\",\"EPSG:4261\",\"EPSG:4264\",\"EPSG:4267\",\"EPSG:4270\",\"EPSG:4273\",\"EPSG:4276\",\"EPSG:4279\",\"EPSG:4281\",\"EPSG:4284\",\"EPSG:4286\",\"EPSG:4288\",\"EPSG:4292\",\"EPSG:4295\",\"EPSG:4297\",\"EPSG:4299\",\"EPSG:4302\",\"EPSG:4324\",\"EPSG:4326\"];function Wt(t){return Dt.indexOf(Xt(t))>-1}function Xt(t){if(/^urn:(?:x-)?ogc:def:crs:epsg:/.test(t.toLowerCase())){var e=/([0-9]+)$/.exec(t)[1];return\"EPSG:\".concat(e)}return t}function Yt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function qt(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?Yt(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jt(t){return Rt(t).attributes.version}function Vt(t){var e=Jt(t);return Gt(Tt(Rt(t),\"Capability\"),\"Layer\").map((function(t){return $t(t,e)}))}function $t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=\"1.3.0\"===r?\"CRS\":\"SRS\",c=Gt(e,a).map(Ft),u=c.length>0?c:n,s=Gt(e,\"Style\").map(Kt),f=s.length>0?s:o;function l(t){return(Wt(Lt(t,a))&&\"1.3.0\"===r?[\"miny\",\"minx\",\"maxy\",\"maxx\"]:[\"minx\",\"miny\",\"maxx\",\"maxy\"]).map((function(e){return Lt(t,e)}))}var h=Tt(e,\"Attribution\"),p=null!==h?zt(h):i,v=Gt(e,\"Layer\").map((function(t){return $t(t,r,u,f,p)}));return qt({name:Ft(Tt(e,\"Name\")),title:Ft(Tt(e,\"Title\")),abstract:Ft(Tt(e,\"Abstract\")),availableCrs:u,styles:f,attribution:p,boundingBoxes:Gt(e,\"BoundingBox\").reduce((function(e,r){return qt(qt({},e),{},t({},Lt(r,a),l(r)))}),{})},v.length&&{children:v})}function Kt(t){var e=Lt(Tt(Tt(t,\"LegendURL\"),\"OnlineResource\"),\"xlink:href\");return qt({name:Ft(Tt(t,\"Name\")),title:Ft(Tt(t,\"Title\"))},e&&{legendUrl:e})}function zt(t){var e=Lt(Tt(Tt(t,\"LogoURL\"),\"OnlineResource\"),\"xlink:href\"),r=Lt(Tt(t,\"OnlineResource\"),\"xlink:href\"),n=Ft(Tt(t,\"Title\"));return qt(qt(qt({},n&&{title:n}),r&&{url:r}),e&&{logoUrl:e})}function Ht(t){return Rt(t).attributes.version}function Qt(t){var e;if(Ht(t).startsWith(\"1.0\")){var r=Tt(Tt(Tt(Rt(t),\"Capability\"),\"Request\"),\"GetFeature\");e=Nt(Tt(r,\"ResultFormat\")).map(jt)}else{var n=Gt(Tt(Rt(t),\"OperationsMetadata\"),\"Operation\").find((function(t){return\"GetFeature\"===Lt(t,\"name\")})),o=Gt(n,\"Parameter\").find((function(t){return\"outputFormat\"===Lt(t,\"name\")}));e=Gt(o,\"Value\",!0).map(Ft)}return e}function Zt(t){var e=Ht(t),r=Qt(t);return Gt(Tt(Rt(t),\"FeatureTypeList\"),\"FeatureType\").map((function(t){return function(t,e,r){var n=e.startsWith(\"2.\")?\"CRS\":\"SRS\",o=e.startsWith(\"1.0\")?\"SRS\":\"Default\".concat(n);function i(){var e=Tt(t,\"LatLongBoundingBox\");return[\"minx\",\"miny\",\"maxx\",\"maxy\"].map((function(t){return Lt(e,t)})).map(parseFloat)}function a(){var e=Tt(t,\"WGS84BoundingBox\");return[\"LowerCorner\",\"UpperCorner\"].map((function(t){return Tt(e,t)})).map((function(t){return Ft(t).split(\" \")})).reduce((function(t,e){return[].concat(f(t),f(e))})).map(parseFloat)}var c=e.startsWith(\"1.0\")?[]:Gt(t,\"Other\".concat(n)).map(Ft).map(Xt),u=e.startsWith(\"1.0\")?[]:Gt(Tt(t,\"OutputFormats\"),\"Format\").map(Ft);return{name:Ft(Tt(t,\"Name\")),title:Ft(Tt(t,\"Title\")),abstract:Ft(Tt(t,\"Abstract\")),defaultCrs:Xt(Ft(Tt(t,o))),otherCrs:c,outputFormats:u.length>0?u:r,latLonBoundingBox:e.startsWith(\"1.0\")?i():a()}}(t,e,r)}))}function te(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?te(Object(n),!0).forEach((function(r){t(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e,r,n){var o,i=Rt(e);if(n.startsWith(\"2.0\"))o=Gt(i,\"member\").map((function(t){return Nt(t)[0]}));else{var a=Tt(i,\"featureMembers\");o=a?Nt(a):Gt(i,\"featureMember\").map((function(t){return Nt(t)[0]}))}var c=\"1.0.0\"===n?\"fid\":\"gml:id\";function u(e){return Nt(e).filter((function(t){return Ct(jt(t))in r.properties})).reduce((function(e,n){var o=Ct(jt(n));return ee(ee({},e),{},t({},o,function(t,e){switch(r.properties[t]){case\"integer\":return parseInt(e);case\"float\":return parseFloat(e);case\"boolean\":return\"true\"===e;default:return e}}(o,Ft(n))))}),{})}return o.map((function(t){return{id:Lt(t,c),properties:u(t)}}))}function ne(e,r,n,o,i,a,c,u,s,f){var l=\"2.0.0\"===r?\"COUNT\":\"MAXFEATURES\",h=t({SERVICE:\"WFS\",REQUEST:\"GetFeature\",VERSION:r},\"2.0.0\"===r?\"TYPENAMES\":\"TYPENAME\",n);if(void 0!==o&&(h.OUTPUTFORMAT=o),void 0!==a&&(h.PROPERTYNAME=a.join(\",\")),c?(h.RESULTTYPE=\"hits\",h[l]=\"1\"):void 0!==i&&(h[l]=i.toString(10)),u&&(h.SRSNAME=u),s){var p=s.join(\",\");h.BBOX=f?\"\".concat(p,\",\").concat(f):p}return Ut(e,h)}u(\"parseWmsCapabilities\",self,(function(t){return _t(t.url).then((function(t){return{info:(e=t,r=Tt(Rt(e),\"Service\"),n=Gt(Tt(r,\"KeywordList\"),\"Keyword\").map(Ft).filter((function(t,e,r){return r.indexOf(t)===e})),{title:Ft(Tt(r,\"Title\")),name:Ft(Tt(r,\"Name\")),abstract:Ft(Tt(r,\"Abstract\")),fees:Ft(Tt(r,\"Fees\")),constraints:Ft(Tt(r,\"AccessConstraints\")),keywords:n}),layers:Vt(t),version:Jt(t)};var e,r,n}))})),u(\"parseWfsCapabilities\",self,(function(t){return _t(t.url).then((function(t){return{info:(e=t,n=Ht(e),o=n.startsWith(\"1.0\")?\"Service\":\"ServiceIdentification\",i=n.startsWith(\"1.0\")?\"Name\":\"ServiceType\",a=Tt(Rt(e),o),r=n.startsWith(\"1.0\")?Ft(Tt(a,\"Keywords\")).split(\",\").map((function(t){return t.trim()})):Gt(Tt(a,\"Keywords\"),\"Keyword\").map(Ft),{title:Ft(Tt(a,\"Title\")),name:Ft(Tt(a,i)),abstract:Ft(Tt(a,\"Abstract\")),fees:Ft(Tt(a,\"Fees\")),constraints:Ft(Tt(a,\"AccessConstraints\")),keywords:r,outputFormats:Qt(e)}),featureTypes:Zt(t),version:Ht(t)};var e,r,n,o,i,a}))})),u(\"queryWfsFeatureTypeDetails\",self,(function(t){var e=t.url,r=t.serviceVersion,n=t.featureTypeFull;return _t(ne(e,r,n.name,void 0,Object.keys(n.properties))).then((function(t){return{props:(e=re(t,n,r),e.reduce((function(t,e){var r=function(r){var n=e.properties[r];r in t||(t[r]={uniqueValues:[]});var o=t[r].uniqueValues.find((function(t){return t.value===n}));o?o.count++:t[r].uniqueValues.push({value:n,count:1})};for(var n in e.properties)r(n);return t}),{}))};var e}))}));\\n'],{type:\"application/javascript\"})),{type:\"module\"})),Sut}var kut=i(1186),Eut=i.n(kut);class Mut extends Error{constructor(t){super(t)}}function Tut(t){return t.children[0]}function Iut(t){const e=t.indexOf(\":\");return e>-1?t.substr(e+1):t}function Put(t){return t.name||\"\"}function Out(t,e,i){const n=Iut(e);return t&&Array.isArray(t.children)?t.children.reduce(function t(e,s){return Iut(Put(s))===n&&e.push(s),i&&Array.isArray(s.children)?[...e,...s.children.reduce(t,[])]:e},[]):[]}function Rut(t,e,i){return Out(t,e,i)[0]||null}function Dut(t){return t&&Array.isArray(t.children)?[...t.children.filter(t=>\"XmlElement\"===t.constructor.name)]:[]}function Lut(t){const e=t&&Array.isArray(t.children)?t.children.find(t=>\"text\"===t.type):null;return e?e.text:\"\"}function Fut(t,e){return t&&t.attributes[e]||\"\"}class Nut{constructor(t,e=0,i=!1){this.message=t,this.httpStatus=e,this.isCrossOriginRelated=i}}const But=new Map;function zut(t){return function(t){if(But.has(t))return But.get(t);const e=fetch(t);return e.finally(()=>But.delete(t)),But.set(t,e),e}(t).catch(()=>fetch(t,{method:\"HEAD\",mode:\"no-cors\"}).catch(t=>{throw new Nut(`Fetching the document failed either due to network errors or unreachable host, error is: ${t.message}`,0,!1)}).then(()=>{throw new Nut(\"The document could not be fetched due to CORS limitations\",0,!0)})).then(function(){var t=but(function*(t){const e=yield t.text();if(!t.ok)throw new Nut(`Received an error with code ${t.status}: ${e}`,t.status,!1);return e});return function(e){return t.apply(this,arguments)}}()).then(t=>function(t){let e=null;try{e=Eut()(t)}catch(i){throw new Mut(i.message)}return e}(t))}function Vut(t,e){const i=t.match(/(https?%3A%2F%2F[^/]+)$/);if(i){const n=i[1],s=Vut(decodeURIComponent(n),e);return t.replace(n,encodeURIComponent(s))}const n=new URL(t),s=Object.keys(e),r=s.map(t=>t.toLowerCase()),o=[];for(const a of n.searchParams.keys())r.indexOf(a.toLowerCase())>-1&&o.push(a);return o.map(t=>n.searchParams.delete(t)),s.forEach(t=>n.searchParams.set(t,!0===e[t]?\"\":e[t])),n.toString()}function $ut(t){switch(t.indexOf(\":\")>-1?t.substr(t.indexOf(\":\")+1):t){case\"string\":return\"string\";case\"boolean\":return\"boolean\";case\"float\":case\"double\":case\"decimal\":return\"float\";case\"long\":case\"byte\":case\"integer\":case\"int\":case\"positiveInteger\":case\"negativeInteger\":case\"nonPositiveInteger\":case\"nonNegativeInteger\":case\"short\":case\"unsignedLong\":case\"unsignedInt\":case\"unsignedShort\":case\"unsignedByte\":return\"integer\";default:return\"string\"}}const Uut=\"caches\"in self?caches.open(\"ogc-client\"):null;function jut(t){return Hut.apply(this,arguments)}function Hut(){return(Hut=but(function*(t,...e){if(!Uut)return;const i=\"https://cache/\"+e.join(\"/\");yield(yield Uut).put(i,new Response(JSON.stringify(t),{headers:{\"x-expiry\":(Date.now()+36e5).toString(10)}}))})).apply(this,arguments)}function Gut(){return Wut.apply(this,arguments)}function Wut(){return(Wut=but(function*(...t){if(!Uut)return!1;const e=\"https://cache/\"+t.join(\"/\");return(yield Uut).match(e).then(t=>!!t&&parseInt(t.headers.get(\"x-expiry\"))>Date.now())})).apply(this,arguments)}function qut(){return Yut.apply(this,arguments)}function Yut(){return(Yut=but(function*(...t){if(!Uut)return null;const e=\"https://cache/\"+t.join(\"/\"),i=yield(yield Uut).match(e);return i?i.clone().json():null})).apply(this,arguments)}const Zut=new Map;function Kut(t){return Xut.apply(this,arguments)}function Xut(){return(Xut=but(function*(t,...e){if(yield Qut(),yield Gut(...e))return qut(...e);const i=e.join(\"#\");if(Zut.has(i))return Zut.get(i);const n=t();n instanceof Promise&&(n.then(()=>Zut.delete(i)),Zut.set(i,n));const s=yield n;return yield jut(s,...e),s})).apply(this,arguments)}function Qut(){return Jut.apply(this,arguments)}function Jut(){return(Jut=but(function*(){if(!Uut)return;const t=yield Uut,e=yield t.keys();for(let i of e){const e=yield t.match(i);parseInt(e.headers.get(\"x-expiry\"))<=Date.now()&&(yield t.delete(i))}})).apply(this,arguments)}function tdt(t,e,i,n,s,r,o,a,l,c){const h=\"2.0.0\"===e?\"COUNT\":\"MAXFEATURES\",u={SERVICE:\"WFS\",REQUEST:\"GetFeature\",VERSION:e,[\"2.0.0\"===e?\"TYPENAMES\":\"TYPENAME\"]:i};if(void 0!==n&&(u.OUTPUTFORMAT=n),void 0!==r&&(u.PROPERTYNAME=r.join(\",\")),o?(u.RESULTTYPE=\"hits\",u[h]=\"1\"):void 0!==s&&(u[h]=s.toString(10)),a&&(u.SRSNAME=a),l){const t=l.join(\",\");u.BBOX=c?`${t},${c}`:t}return Vut(t,u)}class edt{constructor(t){this._capabilitiesUrl=Vut(t,{SERVICE:\"WFS\",REQUEST:\"GetCapabilities\"}),this._capabilitiesPromise=Kut(()=>function(t){return wut(\"parseWfsCapabilities\",Cut(),{url:t})}(this._capabilitiesUrl),\"WFS\",\"CAPABILITIES\",this._capabilitiesUrl).then(({info:t,featureTypes:e,version:i})=>{this._info=t,this._featureTypes=e,this._version=i}),this._info=null,this._featureTypes=null,this._version=null}isReady(){return this._capabilitiesPromise.then(()=>this)}getServiceInfo(){return this._info}getFeatureTypes(){return this._featureTypes.map(t=>po(po(po({name:t.name},\"title\"in t&&{title:t.title}),\"abstract\"in t&&{abstract:t.abstract}),\"latLonBoundingBox\"in t&&{boundingBox:t.latLonBoundingBox}))}_getFeatureTypeByName(t){if(!this._featureTypes)return null;const e=Iut(t)!==t;return this._featureTypes.find(i=>e?i.name===t:Iut(i.name)===t)||null}getFeatureTypeSummary(t){const e=this._getFeatureTypeByName(t);return e?M0(po(po(po({name:e.name},\"title\"in e&&{title:e.title}),\"abstract\"in e&&{abstract:e.abstract}),\"latLonBoundingBox\"in e&&{boundingBox:e.latLonBoundingBox}),{defaultCrs:e.defaultCrs,otherCrs:e.otherCrs,outputFormats:e.outputFormats}):null}getFeatureTypeFull(t){const e=this._getFeatureTypeByName(t);return e?Kut(()=>{const i=function(t,e,i){return Vut(t,{SERVICE:\"WFS\",REQUEST:\"DescribeFeatureType\",VERSION:e,[\"2.0.0\"===e?\"TYPENAMES\":\"TYPENAME\"]:i})}(this._capabilitiesUrl,this._version,t),n=tdt(this._capabilitiesUrl,this._version,t,void 0,void 0,void 0,!0);return Promise.all([zut(i),zut(n)]).then(([t,i])=>function(t,e,i,n){const{name:s,title:r,abstract:o,defaultCrs:a,otherCrs:l,outputFormats:c,latLonBoundingBox:h}=t,u=n.startsWith(\"2.0\")?\"numberMatched\":\"numberOfFeatures\",d=parseInt(Fut(Tut(i),u)),p=Out(Tut(e),\"complexType\",!0)[0],f=Out(p,\"element\",!0),m=f.filter(t=>Fut(t,\"type\").startsWith(\"xsd:\")).reduce((t,e)=>M0(po({},t),{[Fut(e,\"name\")]:$ut(Fut(e,\"type\"))}),{}),g=f.filter(t=>Fut(t,\"type\").startsWith(\"gml:\"))[0],A=g?Fut(g,\"name\"):void 0,v=g?function(t){switch(t.indexOf(\":\")>-1?t.substr(t.indexOf(\":\")+1):t){case\"PointPropertyType\":return\"point\";case\"MultiPointPropertyType\":return\"multipoint\";case\"CurvePropertyType\":case\"LineStringPropertyType\":return\"linestring\";case\"MultiCurvePropertyType\":case\"MultiLineStringPropertyType\":return\"linestring\";case\"PolygonPropertyType\":case\"SurfacePropertyType\":return\"polygon\";case\"MultiPolygonPropertyType\":case\"MultiSurfacePropertyType\":return\"multipolygon\";default:return\"unknown\"}}(Fut(g,\"type\")):void 0;return po(po(po(M0(po(po(po(po(po(po({name:s},r&&{title:r}),o&&{abstract:o}),h&&{boundingBox:h}),a&&{defaultCrs:a}),l&&{otherCrs:l}),c&&{outputFormats:c}),{properties:m}),A&&{geometryName:A}),v&&{geometryType:v}),!Number.isNaN(d)&&{objectCount:d})}(e,t,i,this._version))},\"WFS\",\"FEATURETYPEINFO\",this._capabilitiesUrl,t):null}getFeatureTypePropDetails(t){var e=this;return but(function*(){const i=yield e.getFeatureTypeFull(t);return null===i?null:Kut(()=>function(t,e,i){return wut(\"queryWfsFeatureTypeDetails\",Cut(),{url:t,serviceVersion:e,featureTypeFull:i})}(e._capabilitiesUrl,e._version,i).then(t=>t.props),\"WFS\",\"FEATURETYPEPROPDETAILS\",e._capabilitiesUrl,t)})()}getVersion(){return this._version}_getJsonCompatibleOutputFormat(t){const e=this._getFeatureTypeByName(t);if(!e)throw new Error(`The following feature type was not found in the service: ${t}`);const i=e.outputFormats.filter(t=>t.toLowerCase().indexOf(\"json\")>-1);return i.length?i[0]:null}supportsJson(t){return this._featureTypes?!!this._getJsonCompatibleOutputFormat(t):null}getFeatureUrl(t,e){if(!this._featureTypes)return null;const{maxFeatures:i,asJson:n,outputFormat:s,outputCrs:r,extent:o,extentCrs:a}=e||{},l=this._getFeatureTypeByName(t);if(!l)throw new Error(`The following feature type was not found in the service: ${t}`);let c=s;if(n){if(c=this._getJsonCompatibleOutputFormat(t)||void 0,!c)throw new Error(`The endpoint does not appear to support GeoJSON for the feature type ${l.name}`)}else if(s&&-1===l.outputFormats.indexOf(s))throw new Error(`The following output format type was not found in the feature type ${l.name}: ${s}`);return tdt(this._capabilitiesUrl,this._version,l.name,c,i,void 0,void 0,r,o,a)}}class idt{constructor(t){const e=Vut(t,{SERVICE:\"WMS\",REQUEST:\"GetCapabilities\"});this._capabilitiesPromise=Kut(()=>function(t){return wut(\"parseWmsCapabilities\",Cut(),{url:t})}(e),\"WMS\",\"CAPABILITIES\",e).then(({info:t,layers:e,version:i})=>{this._info=t,this._layers=e,this._version=i}),this._info=null,this._layers=null,this._version=null}isReady(){return this._capabilitiesPromise.then(()=>this)}getServiceInfo(){return this._info}getLayers(){return this._layers.map(function t(e){return po({title:e.title,name:e.name,abstract:e.abstract},\"children\"in e&&{children:e.children.map(t)})})}getLayerByName(t){let e=null;return this._layers.map(function i(n){if(null===e){if(n.name===t)return void(e=n);\"children\"in n&&n.children.map(i)}}),e}getVersion(){return this._version}}const ndt=[\"EPSG:4046\",\"EPSG:4075\",\"EPSG:4120\",\"EPSG:4122\",\"EPSG:4124\",\"EPSG:4126\",\"EPSG:4149\",\"EPSG:4151\",\"EPSG:4153\",\"EPSG:4155\",\"EPSG:4157\",\"EPSG:4159\",\"EPSG:4161\",\"EPSG:4163\",\"EPSG:4165\",\"EPSG:4167\",\"EPSG:4169\",\"EPSG:4171\",\"EPSG:4173\",\"EPSG:4175\",\"EPSG:4178\",\"EPSG:4180\",\"EPSG:4182\",\"EPSG:4184\",\"EPSG:4188\",\"EPSG:4190\",\"EPSG:4191\",\"EPSG:4196\",\"EPSG:4198\",\"EPSG:4202\",\"EPSG:4210\",\"EPSG:4211\",\"EPSG:4214\",\"EPSG:4226\",\"EPSG:4229\",\"EPSG:4231\",\"EPSG:4233\",\"EPSG:4236\",\"EPSG:4238\",\"EPSG:4240\",\"EPSG:4242\",\"EPSG:4244\",\"EPSG:4246\",\"EPSG:4248\",\"EPSG:4250\",\"EPSG:4252\",\"EPSG:4255\",\"EPSG:4258\",\"EPSG:4261\",\"EPSG:4264\",\"EPSG:4267\",\"EPSG:4270\",\"EPSG:4273\",\"EPSG:4276\",\"EPSG:4279\",\"EPSG:4281\",\"EPSG:4284\",\"EPSG:4286\",\"EPSG:4288\",\"EPSG:4292\",\"EPSG:4295\",\"EPSG:4297\",\"EPSG:4299\",\"EPSG:4302\",\"EPSG:4324\",\"EPSG:4326\"];function sdt(t){return/^urn:(?:x-)?ogc:def:crs:epsg:/.test(t.toLowerCase())?`EPSG:${/([0-9]+)$/.exec(t)[1]}`:t}function rdt(t){return Tut(t).attributes.version}function odt(t){const e=rdt(t);return Out(Rut(Tut(t),\"Capability\"),\"Layer\").map(t=>ldt(t,e))}function adt(t){const e=Rut(Tut(t),\"Service\"),i=Out(Rut(e,\"KeywordList\"),\"Keyword\").map(Lut).filter((t,e,i)=>i.indexOf(t)===e);return{title:Lut(Rut(e,\"Title\")),name:Lut(Rut(e,\"Name\")),abstract:Lut(Rut(e,\"Abstract\")),fees:Lut(Rut(e,\"Fees\")),constraints:Lut(Rut(e,\"AccessConstraints\")),keywords:i}}function ldt(t,e,i=[],n=[],s=null){const r=\"1.3.0\"===e?\"CRS\":\"SRS\",o=Out(t,r).map(Lut),a=o.length>0?o:i,l=Out(t,\"Style\").map(cdt),c=l.length>0?l:n;function h(t){return(function(t){return ndt.indexOf(sdt(t))>-1}(Fut(t,r))&&\"1.3.0\"===e?[\"miny\",\"minx\",\"maxy\",\"maxx\"]:[\"minx\",\"miny\",\"maxx\",\"maxy\"]).map(e=>Fut(t,e))}const u=Rut(t,\"Attribution\"),d=null!==u?function(t){const e=Fut(Rut(Rut(t,\"LogoURL\"),\"OnlineResource\"),\"xlink:href\"),i=Fut(Rut(t,\"OnlineResource\"),\"xlink:href\"),n=Lut(Rut(t,\"Title\"));return po(po(po({},n&&{title:n}),i&&{url:i}),e&&{logoUrl:e})}(u):s,p=Out(t,\"Layer\").map(t=>ldt(t,e,a,c,d));return po({name:Lut(Rut(t,\"Name\")),title:Lut(Rut(t,\"Title\")),abstract:Lut(Rut(t,\"Abstract\")),availableCrs:a,styles:c,attribution:d,boundingBoxes:Out(t,\"BoundingBox\").reduce((t,e)=>M0(po({},t),{[Fut(e,r)]:h(e)}),{})},p.length&&{children:p})}function cdt(t){const e=Fut(Rut(Rut(t,\"LegendURL\"),\"OnlineResource\"),\"xlink:href\");return po({name:Lut(Rut(t,\"Name\")),title:Lut(Rut(t,\"Title\"))},e&&{legendUrl:e})}function hdt(t){return Tut(t).attributes.version}function udt(t){let e;if(hdt(t).startsWith(\"1.0\")){const i=Rut(Rut(Rut(Tut(t),\"Capability\"),\"Request\"),\"GetFeature\");e=Dut(Rut(i,\"ResultFormat\")).map(Put)}else{const i=Out(Rut(Tut(t),\"OperationsMetadata\"),\"Operation\").find(t=>\"GetFeature\"===Fut(t,\"name\")),n=Out(i,\"Parameter\").find(t=>\"outputFormat\"===Fut(t,\"name\"));e=Out(n,\"Value\",!0).map(Lut)}return e}function ddt(t){const e=hdt(t),i=e.startsWith(\"1.0\")?\"Service\":\"ServiceIdentification\",n=e.startsWith(\"1.0\")?\"Name\":\"ServiceType\",s=Rut(Tut(t),i);let r;return r=e.startsWith(\"1.0\")?Lut(Rut(s,\"Keywords\")).split(\",\").map(t=>t.trim()):Out(Rut(s,\"Keywords\"),\"Keyword\").map(Lut),{title:Lut(Rut(s,\"Title\")),name:Lut(Rut(s,n)),abstract:Lut(Rut(s,\"Abstract\")),fees:Lut(Rut(s,\"Fees\")),constraints:Lut(Rut(s,\"AccessConstraints\")),keywords:r,outputFormats:udt(t)}}function pdt(t){const e=hdt(t),i=udt(t);return Out(Rut(Tut(t),\"FeatureTypeList\"),\"FeatureType\").map(t=>function(t,e,i){const n=e.startsWith(\"2.\")?\"CRS\":\"SRS\",s=e.startsWith(\"1.0\")?\"SRS\":`Default${n}`;const r=e.startsWith(\"1.0\")?[]:Out(t,`Other${n}`).map(Lut).map(sdt),o=e.startsWith(\"1.0\")?[]:Out(Rut(t,\"OutputFormats\"),\"Format\").map(Lut);return{name:Lut(Rut(t,\"Name\")),title:Lut(Rut(t,\"Title\")),abstract:Lut(Rut(t,\"Abstract\")),defaultCrs:sdt(Lut(Rut(t,s))),otherCrs:r,outputFormats:o.length>0?o:i,latLonBoundingBox:e.startsWith(\"1.0\")?function(){const e=Rut(t,\"LatLongBoundingBox\");return[\"minx\",\"miny\",\"maxx\",\"maxy\"].map(t=>Fut(e,t)).map(parseFloat)}():function(){const e=Rut(t,\"WGS84BoundingBox\");return[\"LowerCorner\",\"UpperCorner\"].map(t=>Rut(e,t)).map(t=>Lut(t).split(\" \")).reduce((t,e)=>[...t,...e]).map(parseFloat)}()}}(t,e,i))}function fdt(t,e,i){const n=Tut(t);let s;if(i.startsWith(\"2.0\"))s=Out(n,\"member\").map(t=>Dut(t)[0]);else{const t=Rut(n,\"featureMembers\");s=t?Dut(t):Out(n,\"featureMember\").map(t=>Dut(t)[0])}const r=\"1.0.0\"===i?\"fid\":\"gml:id\";function o(t,i){switch(e.properties[t]){case\"integer\":return parseInt(i);case\"float\":return parseFloat(i);case\"boolean\":return\"true\"===i;default:return i}}function a(t){return Dut(t).filter(t=>function(t){return t in e.properties}(Iut(Put(t)))).reduce((t,e)=>{const i=Iut(Put(e));return M0(po({},t),{[i]:o(i,Lut(e))})},{})}return s.map(t=>({id:Fut(t,r),properties:a(t)}))}function mdt(t){return t.reduce((t,e)=>{for(const i in e.properties){const n=e.properties[i];i in t||(t[i]={uniqueValues:[]});const s=t[i].uniqueValues.find(t=>t.value===n);s?s.count++:t[i].uniqueValues.push({value:n,count:1})}return t},{})}xut(\"parseWmsCapabilities\",self,({url:t})=>zut(t).then(t=>({info:adt(t),layers:odt(t),version:rdt(t)}))),xut(\"parseWfsCapabilities\",self,({url:t})=>zut(t).then(t=>({info:ddt(t),featureTypes:pdt(t),version:hdt(t)}))),xut(\"queryWfsFeatureTypeDetails\",self,({url:t,serviceVersion:e,featureTypeFull:i})=>zut(tdt(t,e,i.name,void 0,Object.keys(i.properties))).then(t=>({props:mdt(fdt(t,i,e))})));class gdt{constructor(t){Object.assign(this,t),this.id=`${this.endPointURL}:${this.endPointType}:${this.name}`}getCleanObject(){return{endPointURL:this.endPointURL,endPointType:this.endPointType,name:this.name,title:this.title,visible:this.visible,opacity:this.opacity,order:this.order,showLegend:this.showLegend}}}var Adt=class{read(t){if(t){if(\"string\"==typeof t){const e=L7(t);return this.readFromDocument(e)}return D7(t)?this.readFromDocument(t):this.readFromNode(t)}return null}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){}};function vdt(t){return t.getAttributeNS(\"http://www.w3.org/1999/xlink\",\"href\")}const _dt=[null,\"http://www.opengis.net/ows/1.1\"],bdt=W7(_dt,{ServiceIdentification:V7(function(t,e){return Y7({},Odt,t,e)}),ServiceProvider:V7(function(t,e){return Y7({},Rdt,t,e)}),OperationsMetadata:V7(function(t,e){return Y7({},Mdt,t,e)})}),ydt=W7(_dt,{DeliveryPoint:V7(o9),City:V7(o9),AdministrativeArea:V7(o9),PostalCode:V7(o9),Country:V7(o9),ElectronicMailAddress:V7(o9)}),wdt=W7(_dt,{Value:z7(function(t,e){return o9(t)})}),xdt=W7(_dt,{AllowedValues:V7(function(t,e){return Y7({},wdt,t,e)})}),Sdt=W7(_dt,{Phone:V7(function(t,e){return Y7({},Tdt,t,e)}),Address:V7(function(t,e){return Y7({},ydt,t,e)})}),Cdt=W7(_dt,{HTTP:V7(function(t,e){return Y7({},kdt,t,e)})}),kdt=W7(_dt,{Get:z7(function(t,e){const i=vdt(t);if(i)return Y7({href:i},Idt,t,e)}),Post:void 0}),Edt=W7(_dt,{DCP:V7(function(t,e){return Y7({},Cdt,t,e)})}),Mdt=W7(_dt,{Operation:function(t,e){const i=t.getAttribute(\"name\"),n=Y7({},Edt,t,e);n&&(e[e.length-1][i]=n)}}),Tdt=W7(_dt,{Voice:V7(o9),Facsimile:V7(o9)}),Idt=W7(_dt,{Constraint:z7(function(t,e){const i=t.getAttribute(\"name\");if(i)return Y7({name:i},xdt,t,e)})}),Pdt=W7(_dt,{IndividualName:V7(o9),PositionName:V7(o9),ContactInfo:V7(function(t,e){return Y7({},Sdt,t,e)})}),Odt=W7(_dt,{Abstract:V7(o9),AccessConstraints:V7(o9),Fees:V7(o9),Title:V7(o9),ServiceTypeVersion:V7(o9),ServiceType:V7(o9)}),Rdt=W7(_dt,{ProviderName:V7(o9),ProviderSite:V7(vdt),ServiceContact:V7(function(t,e){return Y7({},Pdt,t,e)})});var Ddt=class extends Adt{constructor(){super()}readFromNode(t){return Y7({},bdt,t,[])||null}};const Ldt=[null,\"http://www.opengis.net/wmts/1.0\"],Fdt=[null,\"http://www.opengis.net/ows/1.1\"],Ndt=W7(Ldt,{Contents:V7(function(t,e){return Y7({},Bdt,t,e)})}),Bdt=W7(Ldt,{Layer:z7(function(t,e){return Y7({},zdt,t,e)}),TileMatrixSet:z7(function(t,e){return Y7({},Wdt,t,e)})}),zdt=W7(Ldt,{Style:z7(function(t,e){const i=Y7({},Vdt,t,e);if(!i)return;const n=\"true\"===t.getAttribute(\"isDefault\");return i.isDefault=n,i}),Format:z7(o9),TileMatrixSetLink:z7(function(t,e){return Y7({},$dt,t,e)}),Dimension:z7(function(t,e){return Y7({},Hdt,t,e)}),ResourceURL:z7(function(t,e){const i=t.getAttribute(\"format\"),n=t.getAttribute(\"template\"),s=t.getAttribute(\"resourceType\"),r={};return i&&(r.format=i),n&&(r.template=n),s&&(r.resourceType=s),r})},W7(Fdt,{Title:V7(o9),Abstract:V7(o9),WGS84BoundingBox:V7(Ydt),Identifier:V7(o9)})),Vdt=W7(Ldt,{LegendURL:z7(function(t,e){const i={};return i.format=t.getAttribute(\"format\"),i.href=vdt(t),i})},W7(Fdt,{Title:V7(o9),Identifier:V7(o9)})),$dt=W7(Ldt,{TileMatrixSet:V7(o9),TileMatrixSetLimits:V7(function(t,e){return Y7([],Udt,t,e)})}),Udt=W7(Ldt,{TileMatrixLimits:N7(function(t,e){return Y7({},jdt,t,e)})}),jdt=W7(Ldt,{TileMatrix:V7(o9),MinTileRow:V7(s9),MaxTileRow:V7(s9),MinTileCol:V7(s9),MaxTileCol:V7(s9)}),Hdt=W7(Ldt,{Default:V7(o9),Value:z7(o9)},W7(Fdt,{Identifier:V7(o9)})),Gdt=W7(Fdt,{LowerCorner:N7(Zdt),UpperCorner:N7(Zdt)}),Wdt=W7(Ldt,{WellKnownScaleSet:V7(o9),TileMatrix:z7(function(t,e){return Y7({},qdt,t,e)})},W7(Fdt,{SupportedCRS:V7(o9),Identifier:V7(o9),BoundingBox:V7(Ydt)})),qdt=W7(Ldt,{TopLeftCorner:V7(Zdt),ScaleDenominator:V7(n9),TileWidth:V7(s9),TileHeight:V7(s9),MatrixWidth:V7(s9),MatrixHeight:V7(s9)},W7(Fdt,{Identifier:V7(o9)}));function Ydt(t,e){const i=Y7([],Gdt,t,e);if(2==i.length)return rz(i)}function Zdt(t,e){const i=o9(t).split(/\\s+/);if(!i||2!=i.length)return;const n=+i[0],s=+i[1];return isNaN(n)||isNaN(s)?void 0:[n,s]}const Kdt=new class extends Adt{constructor(){super(),this.owsParser_=new Ddt}readFromNode(t){let e=t.getAttribute(\"version\");e&&(e=e.trim());let i=this.owsParser_.readFromNode(t);return i?(i.version=e,i=Y7(i,Ndt,t,[]),i||null):null}},Xdt=window.__anaisSettings.CORS_PROXY_URL;class Qdt{constructor(t){this.capabilities=null,this.capabilitiesLoading=this.loadCapabilities(t)}loadCapabilities(t){var e,i,n;return Hp(this,void 0,void 0,function*(){const s=yield(yield fetch(`${t}?SERVICE=WMTS&VERSION=1.0.0&REQUEST=GetCapabilities`)).text();this.capabilities=Kdt.read(s);for(const t of Object.values(this.capabilities.OperationsMetadata))\"\"!==(null===(n=null===(i=null===(e=null==t?void 0:t.DCP)||void 0===e?void 0:e.HTTP)||void 0===i?void 0:i.Get[0])||void 0===n?void 0:n.href)&&(t.DCP.HTTP.Get[0].href=`${Xdt}${t.DCP.HTTP.Get[0].href}`)})}isReady(){return Hp(this,void 0,void 0,function*(){return yield this.capabilitiesLoading,this})}getLayers(){return this.capabilities.Contents.Layer.map(t=>({name:t.Identifier,abstract:t.Abstract,title:t.Title}))}getServiceInfo(){return{title:this.capabilities.ServiceIdentification.Title}}getCapabilities(){return this.capabilities}}const Jdt=window.__anaisSettings.CORS_PROXY_URL;let tpt=(()=>{class t{constructor(t){this.configService=t,this.activeLayers$=new Jp([]),this.webServices$=new Jp([]),this.loadConfig(),JT([this.webServices$,this.activeLayers$]).pipe(kf(1),pf(300)).subscribe(()=>{this.saveConfig()})}clear(){this.webServices$.next([]),this.activeLayers$.next([])}saveConfig(){this.configService.set(\"customLayersConfig\",{webServices:this.webServices$.value.map(t=>({title:t.title,url:t.url,type:t.type})),activeLayers:this.activeLayers$.value.map(t=>t.getCleanObject())})}loadConfig(){return Hp(this,void 0,void 0,function*(){const t=this.configService.customLayersConfig;if(t&&(gU(t.webServices)&&(yield this.initWebServices(t.webServices)),gU(t.activeLayers))){const e=t.activeLayers.map(t=>new gdt(t)),i=this.webServices$.value;e.forEach(t=>{t.legends=npt(i.find(e=>e.type===t.endPointType&&e.url===t.endPointURL).layers.find(e=>e.name===t.name)),\"wmts\"===t.endPointType&&(t.wmtsCapabilities=i.find(e=>\"wmts\"===e.type&&e.url===t.endPointURL).endpoint.getCapabilities())}),this.activeLayers$.next(e)}})}initWebServices(t){return Hp(this,void 0,void 0,function*(){this.webServices$.next(t.map(t=>Object.assign(Object.assign({},t),{status:\"loading\"}))),yield Promise.all(this.webServices$.value.map(t=>Hp(this,void 0,void 0,function*(){yield this.loadWebService(t);const e=this.webServices$.value.indexOf(t);-1!==e&&this.webServices$.next([...this.webServices$.value.slice(0,e),Object.assign({},t),...this.webServices$.value.slice(e+1)])})))})}addWebService(t,e){return Hp(this,void 0,void 0,function*(){const i=ipt(e),n=yield new i(`${Jdt}${t}`).isReady(),s={title:n.getServiceInfo().title,type:e,url:t,endpoint:n,layers:[],status:\"ready\"};this.webServices$.next([...this.webServices$.value,s]),yield this.loadWebService(s),this.webServices$.value.splice(this.webServices$.value.length-1,1),this.webServices$.value.push(Object.assign({},s)),this.webServices$.next(this.webServices$.value)})}removeWebService(t){this.webServices$.next(this.webServices$.value.filter(e=>e!==t)),this.activeLayers$.next(this.activeLayers$.value.filter(e=>e.endPointURL!==t.url||e.endPointType!==t.type))}loadWebService(t){return Hp(this,void 0,void 0,function*(){try{const e=ipt(t.type),i=yield new e(`${Jdt}${t.url}`).isReady();if(t.title=i.getServiceInfo().title,t.endpoint=i,t.layers=ept(function(t,e){switch(t){case\"wfs\":return e.getFeatureTypes();case\"wms\":return e._layers;case\"wmts\":return e.getLayers()}}(t.type,i)),0===t.layers.length)throw new Error(\"Aucune donn\\xe9e disponible\");1===t.layers.length&&t.layers[0].children.length>0&&(t.layers=t.layers[0].children),t.error=\"\",t.status=\"ready\"}catch(e){t.status=\"error\",t.error=e.message.length<=60?e.message:`${e.message.substring(0,60)}... (tronqu\\xe9)`}})}addLayer(t,e){this.activeLayers$.next([...this.activeLayers$.value,new gdt(Object.assign(Object.assign(Object.assign({},e),{endPointURL:t.url,endPointType:t.type,visible:!0,opacity:1,order:this.activeLayers$.value.length,showLegend:!0,legends:npt(e)}),\"wmts\"===t.type?{wmtsCapabilities:t.endpoint.getCapabilities()}:{}))])}removeLayer(t){this.activeLayers$.next(this.activeLayers$.value.filter(e=>e!==t))}toggleLayerVisibility(t){t.visible=!t.visible,this.activeLayers$.next(this.activeLayers$.value)}updateLayerOpacity(t,e){t.opacity=e,this.activeLayers$.next(this.activeLayers$.value)}toggleLayerLegendVisibility(t){t.showLegend=!t.showLegend,this.activeLayers$.next(this.activeLayers$.value)}updateActiveLayers(t){t.forEach((t,e)=>{t.order=e}),this.activeLayers$.next(t)}}return t.\\u0275fac=function(e){return new(e||t)(Mn(WU))},t.\\u0275prov=mt({token:t,factory:t.\\u0275fac,providedIn:\"root\"}),t})();function ept(t){return t.forEach(t=>{t.children&&ept(t.children)}),t.sort((t,e)=>t.title<e.title?-1:1)}function ipt(t){switch(t){case\"wfs\":return edt;case\"wms\":return idt;case\"wmts\":return Qdt}}function npt(t){var e;return(null===(e=t.styles)||void 0===e?void 0:e.filter(t=>![\"normal\",\"nolegend\"].includes(t.name)&&!!t.legendUrl).map(t=>({url:`${Jdt}${t.legendUrl.replace(\"http://\",\"https://\")}`,title:t.title})))||[]}const spt={openSeaMap:new N$({url:window.__anaisSettings.OPENSEAMAP_URL,crossOrigin:\"anonymous\",attributions:'\\xa9 "
						},
						{
							"uri": "https://anais.beta.gouv.fr/main-es5.6e0e8695b5111d8b337a.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<a>>>0;)i=i+1|0;if((0|(o=o+1|0))==(0|s))break e}}o=0|gt(0|t,0|e,52),w(),o&=15;t:do{if(o){i=1;n:for(;;){switch(h=0|gt(0|t,0|e,3*(15-i|0)|0),w(),7&h){case 1:break n;case 0:break;default:break t}if(!(i>>>0<o>>>0))break t;i=i+1|0}if(0|V(a,0|r[u>>2]))for(i=1;c=0|yt(7,0,0|(u=3*(15-i|0)|0)),h=e&~(0|w()),e=0|gt(0|t,0|e,0|u),w(),t=t&~c|(e=0|yt(0|le(7&e),0,0|u)),e=0|h|w(),i>>>0<o>>>0;)i=i+1|0;else for(i=1;u=0|gt(0|t,0|e,0|(h=3*(15-i|0)|0)),w(),c=0|yt(7,0,0|h),e&=~(0|w()),t=t&~c|(h=0|yt(0|se(7&u),0,0|h)),e=0|e|w(),i>>>0<o>>>0;)i=i+1|0}}while(0);if((0|s)>0){i=0;do{t=0|Re(t,e),e=0|w(),i=i+1|0}while((0|i)!=(0|s))}}else t=0,e=0}while(0);return h=t,k(0|(c=e)),I=n,0|h}(n,t),e=0|w()):(e=0,t=0),k(0|e),I=i,0|t}function Ne(e,t,n){var i,a=0,o=0,s=0;if(i=4+(n|=0)|0,o=0|gt(0|(e|=0),0|(t|=0),52),w(),o&=15,s=0|gt(0|e,0|t,45),w(),a=0==(0|o),0|F(127&s)){if(a)return 1;a=1}else{if(a)return 0;a=0==(0|r[i>>2])&&0==(0|r[n+8>>2])?0!=(0|r[n+12>>2])&1:1}for(n=1;1&n?ne(i):ie(i),s=0|gt(0|e,0|t,3*(15-n|0)|0),w(),re(i,7&s),n>>>0<o>>>0;)n=n+1|0;return 0|a}function Be(e,t,n){n|=0;var i,a,o=0,s=0,l=0,u=0,c=0,h=0;a=I,I=I+16|0,i=a,h=0|gt(0|(e|=0),0|(t|=0),45),w(),h&=127;e:do{if(0!=(0|F(h))&&(l=0|gt(0|e,0|t,52),w(),0!=(0|(l&=15)))){o=1;t:for(;;){switch(c=0|gt(0|e,0|t,3*(15-o|0)|0),w(),7&c){case 5:break t;case 0:break;default:o=t;break e}if(!(o>>>0<l>>>0)){o=t;break e}o=o+1|0}for(s=1,o=t;u=0|yt(7,0,0|(t=3*(15-s|0)|0)),c=o&~(0|w()),o=0|gt(0|e,0|o,0|t),w(),e=e&~u|(o=0|yt(0|le(7&o),0,0|t)),o=0|c|w(),s>>>0<l>>>0;)s=s+1|0}else o=t}while(0);if(r[n>>2]=r[(c=7728+(28*h|0)|0)>>2],r[n+4>>2]=r[c+4>>2],r[n+8>>2]=r[c+8>>2],r[n+12>>2]=r[c+12>>2],0|Ne(e,o,n)){if(r[i>>2]=r[(u=n+4|0)>>2],r[i+4>>2]=r[u+4>>2],r[i+8>>2]=r[u+8>>2],l=0|gt(0|e,0|o,52),w(),c=15&l,1&l?(ie(u),l=c+1|0):l=c,0|F(h)){e:do{if(c)for(t=1;;){if(s=0|gt(0|e,0|o,3*(15-t|0)|0),w(),0|(s&=7)){o=s;break e}if(!(t>>>0<c>>>0)){o=0;break}t=t+1|0}else o=0}while(0);o=4==(0|o)&1}else o=0;if(0|ge(n,l,o,0)){if(0|F(h))do{}while(0!=(0|ge(n,l,0,0)));(0|l)!=(0|c)&&te(u)}else(0|l)!=(0|c)&&(r[u>>2]=r[i>>2],r[u+4>>2]=r[i+4>>2],r[u+8>>2]=r[i+8>>2]);I=a}else I=a}function ze(e,t,n){var i,a;n|=0,i=I,I=I+16|0,Be(e|=0,t|=0,a=i),t=0|gt(0|e,0|t,52),w(),function(e,t,n){var i,a;t|=0,n|=0,i=I,I=I+16|0,Z(4+(e|=0)|0,a=i),pe(a,0|r[e>>2],t,0,n),I=i}(a,15&t,n),I=i}function Ve(e,t,n){n|=0;var i,r,a=0,o=0;r=I,I=I+16|0,Be(e|=0,t|=0,i=r),a=0|gt(0|e,0|t,45),w(),a=0==(0|F(127&a)),o=0|gt(0|e,0|t,52),w(),o&=15;e:do{if(!a){if(0|o)for(a=1;;){if(!(0==((0|yt(7,0,3*(15-a|0)|0))&e|0)&0==((0|w())&t|0)))break e;if(!(a>>>0<o>>>0))break;a=a+1|0}return ve(i,o,0,5,n),void(I=r)}}while(0);Ae(i,o,0,6,n),I=r}function Ue(e,t){t|=0;var n,i=0,a=0,o=0,s=0,l=0,u=0;if(yt(0|(e|=0),0,52),n=134225919|w(),(0|e)<1){a=0,i=0;do{0|F(a)&&(yt(0|a,0,45),l=0|n|w(),r[(e=t+(i<<3)|0)>>2]=-1,r[e+4>>2]=l,i=i+1|0),a=a+1|0}while(122!=(0|a))}else{l=0,i=0;do{if(0|F(l)){for(yt(0|l,0,45),a=1,o=-1,s=0|n|w();o&=~(u=0|yt(7,0,3*(15-a|0)|0)),s&=~(0|w()),(0|a)!=(0|e);)a=a+1|0;r[(u=t+(i<<3)|0)>>2]=o,r[u+4>>2]=s,i=i+1|0}l=l+1|0}while(122!=(0|l))}}function je(e,t,n,i){var a,o,s=0,l=0,u=0,c=0;if(a=I,I=I+64|0,o=a,(0|(e|=0))==(0|(n|=0))&(0|(t|=0))==(0|(i|=0))|!1|134217728!=(2013265920&t|0)|!1|134217728!=(2013265920&i|0)||(s=0|gt(0|e,0|t,52),w(),s&=15,l=0|gt(0|n,0|i,52),w(),(0|s)!=(15&l|0)))return I=a,0;if(l=s+-1|0,s>>>0>1&&(c=0|Ee(e,t,l),u=0|w(),(0|c)==(0|(l=0|Ee(n,i,l)))&(0|u)==(0|w()))&&(s=0|gt(0|e,0|t,0|(l=3*(15^s)|0)),w(),s&=7,l=0|gt(0|n,0|i,0|l),w(),0==(0|s)|0==(0|(l&=7))||(0|r[21136+(s<<2)>>2])==(0|l)||(0|r[21168+(s<<2)>>2])==(0|l)))return I=a,1;l=(s=o)+56|0;do{r[s>>2]=0,s=s+4|0}while((0|s)<(0|l));return R(e,t,1,o),s=(0|r[(c=o)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=o+8|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=o+16|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=o+24|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=o+32|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)||(0|r[(c=o+40|0)>>2])==(0|n)&&(0|r[c+4>>2])==(0|i)?1:1&((0|r[(s=o+48|0)>>2])==(0|n)?(0|r[s+4>>2])==(0|i):0),I=a,0|s}function He(e,t,n){n|=0;var i,a,o,s,l=0;if(o=I,I=I+16|0,a=o,l=0|gt(0|(e|=0),0|(t|=0),56),w(),-1==(0|(t=0|function(e,t,n){n|=0;var i=0,a=0;return i=0|Te(e|=0,t|=0),(n+-1|0)>>>0>5||1==(0|n)&(a=0!=(0|i))?0|(n=-1):(i=0|function(e,t){var n,i,a,o=0,s=0,l=0,u=0,c=0;if(a=I,I=I+32|0,i=a,Be(e|=0,t|=0,n=a+16|0),l=0|Se(e,t),c=0|Ie(e,t),function(e,t){r[(t|=0)>>2]=r[(e=7728+(28*(e|=0)|0)|0)>>2],r[t+4>>2]=r[e+4>>2],r[t+8>>2]=r[e+8>>2],r[t+12>>2]=r[e+12>>2]}(l,i),t=0|function(e,t){e|=0;var n=0,i=0;if((t|=0)>>>0>20)return-1;do{if((0|r[11152+(216*t|0)>>2])!=(0|e))if((0|r[11152+(216*t|0)+8>>2])!=(0|e))if((0|r[11152+(216*t|0)+16>>2])!=(0|e))if((0|r[11152+(216*t|0)+24>>2])!=(0|e))if((0|r[11152+(216*t|0)+32>>2])!=(0|e))if((0|r[11152+(216*t|0)+40>>2])!=(0|e))if((0|r[11152+(216*t|0)+48>>2])!=(0|e))if((0|r[11152+(216*t|0)+56>>2])!=(0|e))if((0|r[11152+(216*t|0)+64>>2])!=(0|e))if((0|r[11152+(216*t|0)+72>>2])!=(0|e))if((0|r[11152+(216*t|0)+80>>2])!=(0|e))if((0|r[11152+(216*t|0)+88>>2])!=(0|e))if((0|r[11152+(216*t|0)+96>>2])!=(0|e))if((0|r[11152+(216*t|0)+104>>2])!=(0|e))if((0|r[11152+(216*t|0)+112>>2])!=(0|e))if((0|r[11152+(216*t|0)+120>>2])!=(0|e))if((0|r[11152+(216*t|0)+128>>2])!=(0|e)){if((0|r[11152+(216*t|0)+136>>2])!=(0|e)){if((0|r[11152+(216*t|0)+144>>2])==(0|e)){e=0,n=2,i=0;break}if((0|r[11152+(216*t|0)+152>>2])==(0|e)){e=0,n=2,i=1;break}if((0|r[11152+(216*t|0)+160>>2])==(0|e)){e=0,n=2,i=2;break}if((0|r[11152+(216*t|0)+168>>2])==(0|e)){e=1,n=2,i=0;break}if((0|r[11152+(216*t|0)+176>>2])==(0|e)){e=1,n=2,i=1;break}if((0|r[11152+(216*t|0)+184>>2])==(0|e)){e=1,n=2,i=2;break}if((0|r[11152+(216*t|0)+192>>2])==(0|e)){e=2,n=2,i=0;break}if((0|r[11152+(216*t|0)+200>>2])==(0|e)){e=2,n=2,i=1;break}if((0|r[11152+(216*t|0)+208>>2])==(0|e)){e=2,n=2,i=2;break}return-1}e=2,n=1,i=2}else e=2,n=1,i=1;else e=2,n=1,i=0;else e=1,n=1,i=2;else e=1,n=1,i=1;else e=1,n=1,i=0;else e=0,n=1,i=2;else e=0,n=1,i=1;else e=0,n=1,i=0;else e=2,n=0,i=2;else e=2,n=0,i=1;else e=2,n=0,i=0;else e=1,n=0,i=2;else e=1,n=0,i=1;else e=1,n=0,i=0;else e=0,n=0,i=2;else e=0,n=0,i=1;else e=0,n=0,i=0}while(0);return 0|r[11152+(216*t|0)+(72*n|0)+(24*e|0)+(i<<3)+4>>2]}(l,0|r[n>>2]),!(0|F(l)))return I=a,0|t;switch(0|l){case 4:e=0,o=14;break;case 14:e=1,o=14;break;case 24:e=2,o=14;break;case 38:e=3,o=14;break;case 49:e=4,o=14;break;case 58:e=5,o=14;break;case 63:e=6,o=14;break;case 72:e=7,o=14;break;case 83:e=8,o=14;break;case 97:e=9,o=14;break;case 107:e=10,o=14;break;case 117:e=11,o=14;break;default:u=0,s=0}return 14==(0|o)&&(u=0|r[22096+(24*e|0)+8>>2],s=0|r[22096+(24*e|0)+16>>2]),(0|(e=0|r[n>>2]))!=(0|r[i>>2])&&(l=0|N(l))|(0|(e=0|r[n>>2]))==(0|s)&&(t=(t+1|0)%6|0),3==(0|c)&(0|e)==(0|s)?(I=a,0|(c=(t+5|0)%6|0)):5==(0|c)&(0|e)==(0|u)?(I=a,0|(c=(t+1|0)%6|0)):(I=a,0|(c=t))}(e,t),a?0|(n=(5-i+(0|r[22384+(n<<2)>>2])|0)%5|0):0|(n=(6-i+(0|r[22416+(n<<2)>>2])|0)%6|0))}(i=(s=!0&268435456==(2013265920&t|0))?e:0,e=s?-2130706433&t|134217728:0,7&l))))return r[n>>2]=0,void(I=o);Be(i,e,a),l=0|gt(0|i,0|e,52),w(),l&=15,0|Te(i,e)?ve(a,l,t,2,n):Ae(a,l,t,2,n),I=o}function Ge(e){e|=0;var t,n,i=0;return(t=0|ft(1,12))||x(22691,22646,49,22704),0|(i=0|r[(n=e+4|0)>>2])?(r[(i=i+8|0)>>2]=t,r[n>>2]=t,0|t):(0|r[e>>2]&&x(22721,22646,61,22744),r[(i=e)>>2]=t,r[n>>2]=t,0|t)}function $e(e,t){var n,i;return e|=0,t|=0,(i=0|ht(24))||x(22758,22646,78,22772),r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],r[i+12>>2]=r[t+12>>2],r[i+16>>2]=0,0|(n=0|r[(t=e+4|0)>>2])?(r[n+16>>2]=i,r[t>>2]=i,0|i):(0|r[e>>2]&&x(22787,22646,82,22772),r[e>>2]=i,r[t>>2]=i,0|i)}function We(e){var t,n,i=0,o=0,s=0,u=0,c=0,h=0,d=0,f=0,p=0,v=0,m=0,g=0,y=0,A=0,_=0,b=0,k=0,w=0,S=0,C=0,E=0,M=0,T=0,I=0,R=0,P=0,O=0,D=0,L=0,F=0;if(0|r[(u=8+(e|=0)|0)>>2])return 1;if(!(s=0|r[e>>2]))return 0;i=s,o=0;do{o=o+1|0,i=0|r[i+8>>2]}while(0!=(0|i));if(o>>>0<2)return 0;(n=0|ht(o<<2))||x(22807,22646,317,22826),(t=0|ht(o<<5))||x(22848,22646,321,22826),r[e>>2]=0,r[(M=e+4|0)>>2]=0,r[u>>2]=0,o=0,D=0,E=0,m=0;e:for(;;){if(v=0|r[s>>2]){c=0,h=v;do{if(i=h,+l(+((f=+a[h+8>>3])-(d=+a[(u=(p=0==(0|(h=0|r[h+16>>2])))?v:h)+8>>3])))>3.141592653589793){F=14;break}c+=(d-f)*(+a[i>>3]+ +a[u>>3])}while(!p);if(14==(0|F)){F=0,c=0,i=v;do{c+=(+a[i>>3]+ +a[(P=0==(0|(P=0|r[(O=i+16|0)>>2]))?v:P)>>3])*(((S=+a[P+8>>3])<0?S+6.283185307179586:S)-((C=+a[i+8>>3])<0?C+6.283185307179586:C)),i=0|r[(0==(0|i)?s:O)>>2]}while(0!=(0|i))}c>0?(r[n+(D<<2)>>2]=s,D=D+1|0,u=E,i=m):F=19}else F=19;if(19==(0|F)){F=0;do{if(!o){if(m){u=M,h=m+8|0,i=s,o=e;break}if(0|r[e>>2]){F=27;break e}u=M,h=e,i=s,o=e;break}if(0|r[(i=o+8|0)>>2]){F=21;break e}if(!(o=0|ft(1,12))){F=23;break e}r[i>>2]=o,u=o+4|0,h=o,i=m}while(0);if(r[h>>2]=s,r[u>>2]=s,h=t+(E<<5)|0,p=0|r[s>>2]){for(a[(v=t+(E<<5)+8|0)>>3]=17976931348623157e292,a[(m=t+(E<<5)+24|0)>>3]=17976931348623157e292,a[h>>3]=-17976931348623157e292,a[(g=t+(E<<5)+16|0)>>3]=-17976931348623157e292,k=17976931348623157e292,w=-17976931348623157e292,u=0,y=p,f=17976931348623157e292,_=17976931348623157e292,b=-17976931348623157e292,d=-17976931348623157e292;c=+a[y>>3],C=+a[y+8>>3],S=+a[((A=0==(0|(y=0|r[y+16>>2])))?p:y)+8>>3],c<f&&(a[v>>3]=c,f=c),C<_&&(a[m>>3]=C,_=C),c>b?a[h>>3]=c:c=b,C>d&&(a[g>>3]=C,d=C),k=C>0&C<k?C:k,w=C<0&C>w?C:w,u|=+l(+(C-S))>3.141592653589793,!A;)b=c;u&&(a[g>>3]=w,a[m>>3]=k)}else r[h>>2]=0,r[h+4>>2]=0,r[h+8>>2]=0,r[h+12>>2]=0,r[h+16>>2]=0,r[h+20>>2]=0,r[h+24>>2]=0,r[h+28>>2]=0;u=E+1|0}if(s=0|r[(O=s+8|0)>>2],r[O>>2]=0,!s){F=45;break}E=u,m=i}if(21==(0|F))x(22624,22646,35,22658);else if(23==(0|F))x(22678,22646,37,22658);else if(27==(0|F))x(22721,22646,61,22744);else if(45==(0|F)){e:do{if((0|D)>0){for(O=0==(0|u),R=u<<2,P=0==(0|e),I=0,i=0;;){if(T=0|r[n+(I<<2)>>2],O)F=73;else{if(!(E=0|ht(R))){F=50;break}if(!(M=0|ht(R))){F=52;break}t:do{if(P)o=0;else{for(u=0,o=0,h=e;0|qe(0|r[h>>2],s=t+(u<<5)|0,0|r[T>>2])?(r[E+(o<<2)>>2]=h,r[M+(o<<2)>>2]=s,A=o+1|0):A=o,h=0|r[h+8>>2];)u=u+1|0,o=A;if((0|A)>0)if(s=0|r[E>>2],1==(0|A))o=s;else for(g=0,y=-1,o=s,m=s;;){for(p=0|r[m>>2],s=0,h=0;v=(0|(u=0|r[r[E+(h<<2)>>2]>>2]))==(0|p)?s:s+(1&(0|qe(u,0|r[M+(h<<2)>>2],0|r[p>>2])))|0,(0|(h=h+1|0))!=(0|A);)s=v;if(o=(u=(0|v)>(0|y))?m:o,(0|(s=g+1|0))==(0|A))break t;g=s,y=u?v:y,m=0|r[E+(s<<2)>>2]}else o=0}}while(0);if(dt(E),dt(M),o){if(s=0|r[(u=o+4|0)>>2])o=s+8|0;else if(0|r[o>>2]){F=70;break}r[o>>2]=T,r[u>>2]=T}else F=73}if(73==(0|F)){if(F=0,0|(i=0|r[T>>2]))do{M=i,i=0|r[i+16>>2],dt(M)}while(0!=(0|i));dt(T),i=2}if((0|(I=I+1|0))>=(0|D)){L=i;break e}}50==(0|F)?x(22863,22646,249,22882):52==(0|F)?x(22901,22646,252,22882):70==(0|F)&&x(22721,22646,61,22744)}else L=0}while(0);return dt(n),dt(t),0|L}return 0}function qe(e,t,n){e|=0;var i=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0;if(!(0|G(t|=0,n|=0)&&(t=0|H(t),h=+a[n>>3],i=+a[n+8>>3],i=t&i<0?i+6.283185307179586:i,e=0|r[e>>2],e)))return 0;if(t){t=0,n=e;e:for(;;){for(;l=+a[n>>3],c=+a[n+8>>3],o=+a[(d=0==(0|(d=0|r[(n=n+16|0)>>2]))?e:d)+8>>3],l>(s=+a[d>>3])?(u=l,l=c):(u=s,s=l,l=o,o=c),h<s|h>u;)if(!(n=0|r[n>>2])){n=22;break e}if(i=(l=l<0?l+6.283185307179586:l)==i|(c=o<0?o+6.283185307179586:o)==i?i+-2220446049250313e-31:i,((c+=(h-s)/(u-s)*(l-c))<0?c+6.283185307179586:c)>i&&(t^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|t}else{t=0,n=e;e:for(;;){for(;l=+a[n>>3],c=+a[n+8>>3],o=+a[(d=0==(0|(d=0|r[(n=n+16|0)>>2]))?e:d)+8>>3],l>(s=+a[d>>3])?(u=l,l=c):(u=s,s=l,l=o,o=c),h<s|h>u;)if(!(n=0|r[n>>2])){n=22;break e}if(o+(h-s)/(u-s)*(l-o)>(i=l==i|o==i?i+-2220446049250313e-31:i)&&(t^=1),!(n=0|r[n>>2])){n=22;break}}if(22==(0|n))return 0|t}return 0}function Ye(e,t,n,a,o){n|=0,a|=0,o|=0;var s,l,u,c,h,d=0,f=0,p=0,v=0,m=0,g=0,y=0,A=0,_=0;if(c=I,I=I+32|0,h=c+16|0,u=c,d=0|gt(0|(e|=0),0|(t|=0),52),w(),d&=15,y=0|gt(0|n,0|a,52),w(),(0|d)!=(15&y|0))return I=c,1;if(m=0|gt(0|e,0|t,45),w(),m&=127,g=0|gt(0|n,0|a,45),w(),y=(0|m)!=(0|(g&=127))){if(7==(0|(p=0|j(m,g))))return I=c,2;7==(0|(v=0|j(g,m)))?x(22925,22949,151,22959):(A=p,f=v)}else A=0,f=0;s=0|F(m),l=0|F(g),r[h>>2]=0,r[h+4>>2]=0,r[h+8>>2]=0,r[h+12>>2]=0;do{if(A){if(p=(0|(g=0|r[4304+(28*m|0)+(A<<2)>>2]))>0,l)if(p){m=0,v=n,p=a;do{v=0|Oe(v,p),p=0|w(),1==(0|(f=0|le(f)))&&(f=0|le(1)),m=m+1|0}while((0|m)!=(0|g));g=f,m=v,v=p}else g=f,m=n,v=a;else if(p){m=0,v=n,p=a;do{v=0|De(v,p),p=0|w(),f=0|le(f),m=m+1|0}while((0|m)!=(0|g));g=f,m=v,v=p}else g=f,m=n,v=a;if(Ne(m,v,h),y||x(22972,22949,181,22959),(p=0!=(0|s))&(f=0!=(0|l))&&x(22999,22949,182,22959),p){if(f=0|Ie(e,t),0|i[22032+(7*f|0)+A>>0]){d=3;break}m=v=0|r[21200+(28*f|0)+(A<<2)>>2],_=26}else if(f){if(f=0|Ie(m,v),0|i[22032+(7*f|0)+g>>0]){d=4;break}m=0,v=0|r[21200+(28*g|0)+(f<<2)>>2],_=26}else f=0;if(26==(0|_))if((0|v)<=-1&&x(23030,22949,212,22959),(0|m)<=-1&&x(23053,22949,213,22959),(0|v)>0){p=h+4|0,f=0;do{oe(p),f=f+1|0}while((0|f)!=(0|v));f=m}else f=m;if(r[u>>2]=0,r[u+4>>2]=0,r[u+8>>2]=0,re(u,A),0|d)for(;0|Le(d)?ne(u):ie(u),(0|d)>1;)d=d+-1|0;if((0|f)>0){d=0;do{oe(u),d=d+1|0}while((0|d)!=(0|f))}K(_=h+4|0,u,_),Y(_),_=50}else if(Ne(n,a,h),0!=(0|s)&0!=(0|l))if((0|g)!=(0|m)&&x(23077,22949,243,22959),f=0|Ie(e,t),d=0|Ie(n,a),0|i[22032+(7*f|0)+d>>0])d=5;else if((0|(f=0|r[21200+(28*f|0)+(d<<2)>>2]))>0){p=h+4|0,d=0;do{oe(p),d=d+1|0}while((0|d)!=(0|f));_=50}else _=50;else _=50}while(0);return 50==(0|_)&&(r[o>>2]=r[(d=h+4|0)>>2],r[o+4>>2]=r[d+4>>2],r[o+8>>2]=r[d+8>>2],d=0),I=c,0|d}function Ze(e,t,n,i){n|=0,i|=0;var a,o,s=0,l=0,u=0,c=0,h=0,d=0,f=0,p=0,v=0,m=0,g=0,y=0,A=0;if(o=I,I=I+48|0,u=o+36|0,c=o+24|0,h=o+12|0,d=o,l=0|gt(0|(e|=0),0|(t|=0),52),w(),l&=15,p=0|gt(0|e,0|t,45),w(),a=0|F(p&=127),yt(0|l,0,52),g=134225919|w(),r[(m=i)>>2]=-1,r[m+4>>2]=g,!l)return(0|r[n>>2])>1||(0|r[n+4>>2])>1||(0|r[n+8>>2])>1||127==(0|(s=0|U(p,0|J(n))))?(I=o,0|(g=1)):(v=0|yt(0|s,0,45),m=0|w(),m|=-1040385&r[(p=i)+4>>2],r[(g=i)>>2]=r[p>>2]|v,r[g+4>>2]=m,I=o,0|(g=0));for(r[u>>2]=r[n>>2],r[u+4>>2]=r[n+4>>2],r[u+8>>2]=r[n+8>>2];r[c>>2]=r[u>>2],r[c+4>>2]=r[u+4>>2],r[c+8>>2]=r[u+8>>2],0|Le(l)?(ee(u),r[h>>2]=r[u>>2],r[h+4>>2]=r[u+4>>2],r[h+8>>2]=r[u+8>>2],ne(h)):(te(u),r[h>>2]=r[u>>2],r[h+4>>2]=r[u+4>>2],r[h+8>>2]=r[u+8>>2],ie(h)),X(c,h,d),Y(d),y=0|r[(m=i)>>2],m=0|r[m+4>>2],n=0|yt(7,0,0|(A=3*(15-l|0)|0)),m&=~(0|w()),A=0|yt(0|J(d),0,0|A),m=0|w()|m,r[(g=i)>>2]=A|y&~n,r[g+4>>2]=m,(0|l)>1;)l=l+-1|0;e:do{if((0|r[u>>2])<=1&&(0|r[u+4>>2])<=1&&(0|r[u+8>>2])<=1){d=127==(0|(c=0|U(p,l=0|J(u))))?0:0|F(c);t:do{if(l){if(a){if(u=21408+(28*(0|Ie(e,t))|0)+(l<<2)|0,(0|(u=0|r[u>>2]))>0){n=0;do{l=0|se(l),n=n+1|0}while((0|n)!=(0|u))}if(1==(0|l)){s=3;break e}127==(0|(n=0|U(p,l)))&&x(23104,22949,376,23134),0|F(n)?x(23147,22949,377,23134):(v=u,f=l,s=n)}else v=0,f=l,s=c;if((0|(h=0|r[4304+(28*p|0)+(f<<2)>>2]))<=-1&&x(23178,22949,384,23134),!d){if((0|v)<=-1&&x(23030,22949,417,23134),0|v){l=0,n=0|r[(u=i)>>2],u=0|r[u+4>>2];do{n=0|Pe(n,u),u=0|w(),r[(A=i)>>2]=n,r[A+4>>2]=u,l=l+1|0}while((0|l)<(0|v))}if((0|h)<=0){l=54;break}for(l=0,n=0|r[(u=i)>>2],u=0|r[u+4>>2];;)if(n=0|Pe(n,u),u=0|w(),r[(A=i)>>2]=n,r[A+4>>2]=u,(0|(l=l+1|0))==(0|h)){l=54;break t}}if(7==(0|(c=0|j(s,p)))&&x(22925,22949,393,23134),n=0|r[(l=i)>>2],l=0|r[l+4>>2],(0|h)>0){u=0;do{n=0|Pe(n,l),l=0|w(),r[(A=i)>>2]=n,r[A+4>>2]=l,u=u+1|0}while((0|u)!=(0|h))}if(n=0|Ie(n,l),A=0|N(s),(0|(n=0|r[(A?21824:21616)+(28*c|0)+(n<<2)>>2]))<=-1&&x(23030,22949,412,23134),n){l=0,u=0|r[(c=i)>>2],c=0|r[c+4>>2];do{u=0|Re(u,c),c=0|w(),r[(A=i)>>2]=u,r[A+4>>2]=c,l=l+1|0}while((0|l)<(0|n));l=54}else l=54}else if(0!=(0|a)&0!=(0|d))if(l=21408+(28*(A=0|Ie(e,t))|0)+((0|Ie(0|r[(l=i)>>2],0|r[l+4>>2]))<<2)|0,(0|(l=0|r[l>>2]))<=-1&&x(23201,22949,433,23134),l){s=0,n=0|r[(u=i)>>2],u=0|r[u+4>>2];do{n=0|Pe(n,u),u=0|w(),r[(A=i)>>2]=n,r[A+4>>2]=u,s=s+1|0}while((0|s)<(0|l));s=c,l=54}else s=c,l=55;else s=c,l=54}while(0);if(54==(0|l)&&d&&(l=55),55==(0|l)&&1==(0|Ie(0|r[(A=i)>>2],0|r[A+4>>2]))){s=4;break}g=0|r[(A=i)>>2],A=-1040385&r[A+4>>2],y=0|yt(0|s,0,45),A=0|A|w(),r[(s=i)>>2]=g|y,r[s+4>>2]=A,s=0}else s=2}while(0);return I=o,0|s}function Ke(e,t){var n=0;if(!(t|=0))return 1;n=e|=0,e=1;do{e=0|A(0==(1&t|0)?1:n,e),t>>=1,n=0|A(n,n)}while(0!=(0|t));return 0|e}function Xe(e,t,n){e|=0;var i,o=0,s=0,l=0,u=0,c=0,h=0,d=0,f=0,p=0;if(!(0|G(t|=0,n|=0))||(t=0|H(t),p=+a[n>>3],o=t&(o=+a[n+8>>3])<0?o+6.283185307179586:o,(0|(f=0|r[e>>2]))<=0))return 0;if(i=0|r[e+4>>2],t){t=0,n=-1,e=0;e:for(;;){for(d=e;h=+a[i+(d<<4)+8>>3],s=+a[i+((e=(n+2|0)%(0|f)|0)<<4)+8>>3],(u=+a[i+(d<<4)>>3])>(l=+a[i+(e<<4)>>3])?(c=u,u=h):(c=l,l=u,u=s,s=h),p<l|p>c;){if(!((0|(n=d+1|0))<(0|f))){n=22;break e}e=d,d=n,n=e}if(o=(u=u<0?u+6.283185307179586:u)==o|(h=s<0?s+6.283185307179586:s)==o?o+-2220446049250313e-31:o,((h+=(p-l)/(c-l)*(u-h))<0?h+6.283185307179586:h)>o&&(t^=1),(0|(e=d+1|0))>=(0|f)){n=22;break}n=d}if(22==(0|n))return 0|t}else{t=0,n=-1,e=0;e:for(;;){for(d=e;h=+a[i+(d<<4)+8>>3],s=+a[i+((e=(n+2|0)%(0|f)|0)<<4)+8>>3],(u=+a[i+(d<<4)>>3])>(l=+a[i+(e<<4)>>3])?(c=u,u=h):(c=l,l=u,u=s,s=h),p<l|p>c;){if(!((0|(n=d+1|0))<(0|f))){n=22;break e}e=d,d=n,n=e}if(s+(p-l)/(c-l)*(u-s)>(o=u==o|s==o?o+-2220446049250313e-31:o)&&(t^=1),(0|(e=d+1|0))>=(0|f)){n=22;break}n=d}if(22==(0|n))return 0|t}return 0}function Qe(e,t){t|=0;var n,i,o,s,u=0,c=0,h=0,d=0,f=0,p=0,v=0,m=0,g=0,y=0,A=0,_=0,b=0;if(!(n=0|r[(e|=0)>>2]))return r[t>>2]=0,r[t+4>>2]=0,r[t+8>>2]=0,r[t+12>>2]=0,r[t+16>>2]=0,r[t+20>>2]=0,r[t+24>>2]=0,void(r[t+28>>2]=0);if(a[(i=t+8|0)>>3]=17976931348623157e292,a[(o=t+24|0)>>3]=17976931348623157e292,a[t>>3]=-17976931348623157e292,a[(s=t+16|0)>>3]=-17976931348623157e292,!((0|n)<=0)){for(A=0|r[e+4>>2],m=17976931348623157e292,g=-17976931348623157e292,y=0,e=-1,d=17976931348623157e292,f=17976931348623157e292,v=-17976931348623157e292,c=-17976931348623157e292,_=0;p=+a[A+(_<<4)+8>>3],h=+a[A+(((0|(e=e+2|0))==(0|n)?0:e)<<4)+8>>3],(u=+a[A+(_<<4)>>3])<d&&(a[i>>3]=u,d=u),p<f&&(a[o>>3]=p,f=p),u>v?a[t>>3]=u:u=v,p>c&&(a[s>>3]=p,c=p),m=p>0&p<m?p:m,g=p<0&p>g?p:g,y|=+l(+(p-h))>3.141592653589793,(0|(e=_+1|0))!=(0|n);)b=_,v=u,_=e,e=b;!y||(a[s>>3]=g,a[o>>3]=m)}}function Je(e,t,n){var i,a=0;if(!(0|Xe(e|=0,t|=0,n|=0)))return 0;if((0|r[(i=e+8|0)>>2])<=0)return 1;for(a=e+12|0,e=0;;){if(0|Xe((0|r[a>>2])+(e<<3)|0,t+((e=e+1|0)<<5)|0,n)){e=0,a=6;break}if((0|e)>=(0|r[i>>2])){e=1,a=6;break}}return 6==(0|a)?0|e:0}function et(e,t,n,i,r){var o,s,l,u,c,h,d,f=0;a[(r|=0)>>3]=(u=+a[(e|=0)>>3])+(l=+a[(t|=0)>>3]-u)*(f=((f=+a[(i|=0)>>3]-(h=+a[(n|=0)>>3]))*((s=+a[e+8>>3])-(d=+a[n+8>>3]))-(u-h)*(c=+a[i+8>>3]-d))/(l*c-(o=+a[t+8>>3]-s)*f)),a[r+8>>3]=s+o*f}function tt(e,t){return+a[(e|=0)>>3]!=+a[(t|=0)>>3]?0|(t=0):0|(t=+a[e+8>>3]==+a[t+8>>3])}function nt(e,t){var n,i,r;return+((r=+a[(e|=0)>>3]-+a[(t|=0)>>3])*r+(i=+a[e+8>>3]-+a[t+8>>3])*i+(n=+a[e+16>>3]-+a[t+16>>3])*n)}function it(e,t,n){e|=0,n|=0;var i=0;(0|(t|=0))>0?(i=0|ft(t,4),r[e>>2]=i,i||x(23230,23253,40,23267)):r[e>>2]=0,r[e+4>>2]=t,r[e+8>>2]=0,r[e+12>>2]=n}function rt(e){var t,n,i,o=0,s=0,u=0,h=0;t=4+(e|=0)|0,n=e+12|0,i=e+8|0;e:for(;;){for(s=0|r[t>>2],o=0;;){if((0|o)>=(0|s))break e;if(h=0|r[(u=0|r[e>>2])+(o<<2)>>2])break;o=o+1|0}o=u+(~~(+l(+ +c(10,+ +(15-(0|r[n>>2])|0))*(+a[h>>3]+ +a[h+8>>3]))%+(0|s))>>>0<<2)|0,s=0|r[o>>2];t:do{if(0|s){if(u=h+32|0,(0|s)==(0|h))r[o>>2]=r[u>>2];else{if(!(o=0|r[(s=s+32|0)>>2]))break;for(;(0|o)!=(0|h);)if(!(o=0|r[(s=o+32|0)>>2]))break t;r[s>>2]=r[u>>2]}dt(h),r[i>>2]=(0|r[i>>2])-1}}while(0)}dt(0|r[e>>2])}function at(e){var t,n=0,i=0;for(t=0|r[4+(e|=0)>>2],i=0;;){if((0|i)>=(0|t)){n=0,i=4;break}if(n=0|r[(0|r[e>>2])+(i<<2)>>2]){i=4;break}i=i+1|0}return 4==(0|i)?0|n:0}function ot(e,t){t|=0;var n=0,i=0,o=0,s=0;if(n=~~(+l(+ +c(10,+ +(15-(0|r[12+(e|=0)>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|r[e+4>>2]))>>>0,!(i=0|r[(n=(0|r[e>>2])+(n<<2)|0)>>2]))return 1;s=t+32|0;do{if((0|i)!=(0|t)){if(!(n=0|r[i+32>>2]))return 1;for(o=n;;){if((0|o)==(0|t)){o=8;break}if(!(n=0|r[o+32>>2])){n=1,o=10;break}i=o,o=n}if(8==(0|o)){r[i+32>>2]=r[s>>2];break}if(10==(0|o))return 0|n}else r[n>>2]=r[s>>2]}while(0);return dt(t),r[(s=e+8|0)>>2]=(0|r[s>>2])-1,0}function st(e,t,n){e|=0,t|=0,n|=0;var i,o=0,s=0,u=0;(i=0|ht(40))||x(23283,23253,98,23296),r[i>>2]=r[t>>2],r[i+4>>2]=r[t+4>>2],r[i+8>>2]=r[t+8>>2],r[i+12>>2]=r[t+12>>2],r[(s=i+16|0)>>2]=r[n>>2],r[s+4>>2]=r[n+4>>2],r[s+8>>2]=r[n+8>>2],r[s+12>>2]=r[n+12>>2],r[i+32>>2]=0,s=~~(+l(+ +c(10,+ +(15-(0|r[e+12>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|r[e+4>>2]))>>>0,o=0|r[(s=(0|r[e>>2])+(s<<2)|0)>>2];do{if(o){for(;!(0|ke(o,t)&&0|ke(o+16|0,n));)if(!(0|r[(o=0==(0|(s=0|r[o+32>>2]))?o:s)+32>>2])){u=10;break}if(10==(0|u)){r[o+32>>2]=i;break}return dt(i),0|o}r[s>>2]=i}while(0);return r[(u=e+8|0)>>2]=1+(0|r[u>>2]),0|i}function lt(e,t,n){t|=0,n|=0;var i=0,o=0;if(o=~~(+l(+ +c(10,+ +(15-(0|r[12+(e|=0)>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|r[e+4>>2]))>>>0,!(o=0|r[(0|r[e>>2])+(o<<2)>>2]))return 0;if(!n){for(e=o;;){if(0|ke(e,t)){i=10;break}if(!(e=0|r[e+32>>2])){e=0,i=10;break}}if(10==(0|i))return 0|e}for(e=o;;){if(0|ke(e,t)&&0|ke(e+16|0,n)){i=10;break}if(!(e=0|r[e+32>>2])){e=0,i=10;break}}return 10==(0|i)?0|e:0}function ut(e,t){t|=0;var n;if(n=~~(+l(+ +c(10,+ +(15-(0|r[12+(e|=0)>>2])|0))*(+a[t>>3]+ +a[t+8>>3]))%+(0|r[e+4>>2]))>>>0,!(e=0|r[(0|r[e>>2])+(n<<2)>>2]))return 0;for(;;){if(0|ke(e,t)){t=5;break}if(!(e=0|r[e+32>>2])){e=0,t=5;break}}return 5==(0|t)?0|e:0}function ct(e){return 0|~~+function(e){return+ +wt(+(e=+e))}(e=+e)}function ht(e){e|=0;var t,n=0,i=0,a=0,o=0,s=0,l=0,u=0,c=0,h=0,d=0,f=0,p=0,v=0,m=0,g=0,y=0,A=0,_=0,b=0,k=0;t=I,I=I+16|0,p=t;do{if(e>>>0<245){if(3&(i=(f=0|r[5829])>>>(e=(h=e>>>0<11?16:e+11&-8)>>>3))|0)return(0|(s=0|r[(o=8+(a=0|r[(i=8+(e=23356+((n=(1&i^1)+e|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|e)?r[5829]=f&~(1<<n):(r[s+12>>2]=e,r[i>>2]=s),r[a+4>>2]=3|(k=n<<3),r[(k=a+k+4|0)>>2]=1|r[k>>2],I=t,0|o;if(h>>>0>(d=0|r[5831])>>>0){if(0|i)return n=((n=i<<e&((n=2<<e)|0-n))&0-n)-1|0,(0|(i=0|r[(u=8+(s=0|r[(e=8+(n=23356+((a=((i=(n>>>=u=n>>>12&16)>>>5&8)|u|(s=(n>>>=i)>>>2&4)|(e=(n>>>=s)>>>1&2)|(a=(n>>>=e)>>>1&1))+(n>>>a)|0)<<1<<2)|0)|0)>>2])|0)>>2]))==(0|n)?r[5829]=e=f&~(1<<a):(r[i+12>>2]=n,r[e>>2]=i,e=f),l=(k=a<<3)-h|0,r[s+4>>2]=3|h,r[4+(o=s+h|0)>>2]=1|l,r[s+k>>2]=l,0|d&&(a=0|r[5834],i=23356+((n=d>>>3)<<1<<2)|0,e&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[5829]=e|n,n=i,e=i+8|0),r[e>>2]=a,r[n+12>>2]=a,r[a+8>>2]=n,r[a+12>>2]=i),r[5831]=l,r[5834]=o,I=t,0|u;if(s=0|r[5830]){for(i=(s&0-s)-1|0,i=c=0|r[23620+(((a=(i>>>=o=i>>>12&16)>>>5&8)|o|(l=(i>>>=a)>>>2&4)|(u=(i>>>=l)>>>1&2)|(c=(i>>>=u)>>>1&1))+(i>>>c)<<2)>>2],u=c,c=(-8&r[c+4>>2])-h|0;(e=0|r[i+16>>2])||(e=0|r[i+20>>2]);)i=e,u=(o=(l=(-8&r[e+4>>2])-h|0)>>>0<c>>>0)?e:u,c=o?l:c;if((l=u+h|0)>>>0>u>>>0){o=0|r[u+24>>2],n=0|r[u+12>>2];do{if((0|n)==(0|u)){if(!(n=0|r[(e=u+20|0)>>2])&&!(n=0|r[(e=u+16|0)>>2])){i=0;break}for(;;)if(i=0|r[(a=n+20|0)>>2])n=i,e=a;else{if(!(i=0|r[(a=n+16|0)>>2]))break;n=i,e=a}r[e>>2]=0,i=n}else r[12+(i=0|r[u+8>>2])>>2]=n,r[n+8>>2]=i,i=n}while(0);do{if(0|o){if((0|u)==(0|r[(e=23620+((n=0|r[u+28>>2])<<2)|0)>>2])){if(r[e>>2]=i,!i){r[5830]=s&~(1<<n);break}}else if(r[((0|r[(k=o+16|0)>>2])==(0|u)?k:o+20|0)>>2]=i,!i)break;r[i+24>>2]=o,0|(n=0|r[u+16>>2])&&(r[i+16>>2]=n,r[n+24>>2]=i),0|(n=0|r[u+20>>2])&&(r[i+20>>2]=n,r[n+24>>2]=i)}}while(0);return c>>>0<16?(r[u+4>>2]=3|(k=c+h|0),r[(k=u+k+4|0)>>2]=1|r[k>>2]):(r[u+4>>2]=3|h,r[l+4>>2]=1|c,r[l+c>>2]=c,0|d&&(a=0|r[5834],i=23356+((n=d>>>3)<<1<<2)|0,(n=1<<n)&f?n=0|r[(e=i+8|0)>>2]:(r[5829]=n|f,n=i,e=i+8|0),r[e>>2]=a,r[n+12>>2]=a,r[a+8>>2]=n,r[a+12>>2]=i),r[5831]=c,r[5834]=l),I=t,0|u+8}f=h}else f=h}else f=h}else if(e>>>0<=4294967231)if(h=-8&(e=e+11|0),a=0|r[5830]){o=0-h|0,c=(e>>>=8)?h>>>0>16777215?31:h>>>(7+(c=14-((u=(520192+(g=e<<(f=(e+1048320|0)>>>16&8))|0)>>>16&4)|f|(c=(245760+(g<<=u)|0)>>>16&2))+(g<<c>>>15)|0)|0)&1|c<<1:0,i=0|r[23620+(c<<2)>>2];e:do{if(i)for(e=0,u=h<<(31==(0|c)?0:25-(c>>>1)|0),s=0;;){if((l=(-8&r[i+4>>2])-h|0)>>>0<o>>>0){if(!l){e=i,o=0,g=65;break e}e=i,o=l}if(s=0==(0|(g=0|r[i+20>>2]))|(0|g)==(0|(i=0|r[i+16+(u>>>31<<2)>>2]))?s:g,!i){i=s,g=61;break}u<<=1}else i=0,e=0,g=61}while(0);if(61==(0|g)){if(0==(0|i)&0==(0|e)){if(!(e=((e=2<<c)|0-e)&a)){f=h;break}f=(e&0-e)-1|0,e=0,i=0|r[23620+(((s=(f>>>=l=f>>>12&16)>>>5&8)|l|(u=(f>>>=s)>>>2&4)|(c=(f>>>=u)>>>1&2)|(i=(f>>>=c)>>>1&1))+(f>>>i)<<2)>>2]}i?g=65:(u=e,l=o)}if(65==(0|g))for(s=i;;){if(o=(i=(f=(-8&r[s+4>>2])-h|0)>>>0<o>>>0)?f:o,e=i?s:e,(i=0|r[s+16>>2])||(i=0|r[s+20>>2]),!i){u=e,l=o;break}s=i}if(0!=(0|u)&&l>>>0<((0|r[5831])-h|0)>>>0&&(d=u+h|0)>>>0>u>>>0){s=0|r[u+24>>2],n=0|r[u+12>>2];do{if((0|n)==(0|u)){if(!(n=0|r[(e=u+20|0)>>2])&&!(n=0|r[(e=u+16|0)>>2])){n=0;break}for(;;)if(i=0|r[(o=n+20|0)>>2])n=i,e=o;else{if(!(i=0|r[(o=n+16|0)>>2]))break;n=i,e=o}r[e>>2]=0}else r[12+(k=0|r[u+8>>2])>>2]=n,r[n+8>>2]=k}while(0);do{if(s){if((0|u)==(0|r[(i=23620+((e=0|r[u+28>>2])<<2)|0)>>2])){if(r[i>>2]=n,!n){r[5830]=a&=~(1<<e);break}}else if(r[((0|r[(k=s+16|0)>>2])==(0|u)?k:s+20|0)>>2]=n,!n)break;r[n+24>>2]=s,0|(e=0|r[u+16>>2])&&(r[n+16>>2]=e,r[e+24>>2]=n),(e=0|r[u+20>>2])&&(r[n+20>>2]=e,r[e+24>>2]=n)}}while(0);e:do{if(l>>>0<16)k=l+h|0,r[u+4>>2]=3|k,r[(k=u+k+4|0)>>2]=1|r[k>>2];else{if(r[u+4>>2]=3|h,r[d+4>>2]=1|l,r[d+l>>2]=l,n=l>>>3,l>>>0<256){i=23356+(n<<1<<2)|0,(e=0|r[5829])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[5829]=e|n,n=i,e=i+8|0),r[e>>2]=d,r[n+12>>2]=d,r[d+8>>2]=n,r[d+12>>2]=i;break}if(i=(n=l>>>8)?l>>>0>16777215?31:l>>>(7+(i=14-((_=(520192+(k=n<<(b=(n+1048320|0)>>>16&8))|0)>>>16&4)|b|(i=(245760+(k<<=_)|0)>>>16&2))+(k<<i>>>15)|0)|0)&1|i<<1:0,n=23620+(i<<2)|0,r[d+28>>2]=i,r[4+(e=d+16|0)>>2]=0,r[e>>2]=0,!(a&(e=1<<i))){r[5830]=a|e,r[n>>2]=d,r[d+24>>2]=n,r[d+12>>2]=d,r[d+8>>2]=d;break}n=0|r[n>>2];t:do{if((-8&r[n+4>>2]|0)!=(0|l)){for(a=l<<(31==(0|i)?0:25-(i>>>1)|0);e=0|r[(i=n+16+(a>>>31<<2)|0)>>2];){if((-8&r[e+4>>2]|0)==(0|l)){n=e;break t}a<<=1,n=e}r[i>>2]=d,r[d+24>>2]=n,r[d+12>>2]=d,r[d+8>>2]=d;break e}}while(0);r[12+(k=0|r[(b=n+8|0)>>2])>>2]=d,r[b>>2]=d,r[d+8>>2]=k,r[d+12>>2]=n,r[d+24>>2]=0}}while(0);return I=t,0|u+8}f=h}else f=h;else f=-1}while(0);if((i=0|r[5831])>>>0>=f>>>0)return e=0|r[5834],(n=i-f|0)>>>0>15?(r[5834]=k=e+f|0,r[5831]=n,r[k+4>>2]=1|n,r[e+i>>2]=n,r[e+4>>2]=3|f):(r[5831]=0,r[5834]=0,r[e+4>>2]=3|i,r[(k=e+i+4|0)>>2]=1|r[k>>2]),I=t,0|e+8;if((l=0|r[5832])>>>0>f>>>0)return r[5832]=_=l-f|0,r[5835]=b=(k=0|r[5835])+f|0,r[b+4>>2]=1|_,r[k+4>>2]=3|f,I=t,0|k+8;if(0|r[5947]?e=0|r[5949]:(r[5949]=4096,r[5948]=4096,r[5950]=-1,r[5951]=-1,r[5952]=0,r[5940]=0,r[5947]=-16&p^1431655768,e=4096),u=f+48|0,(h=(s=e+(c=f+47|0)|0)&(o=0-e|0))>>>0<=f>>>0||0|(e=0|r[5939])&&(p=(d=0|r[5937])+h|0)>>>0<=d>>>0|p>>>0>e>>>0)return I=t,0;e:do{if(4&r[5940])n=0,g=143;else{i=0|r[5835];t:do{if(i){for(a=23764;!((p=0|r[a>>2])>>>0<=i>>>0&&(p+(0|r[a+4>>2])|0)>>>0>i>>>0);){if(!(e=0|r[a+8>>2])){g=128;break t}a=e}if((n=s-l&o)>>>0<2147483647)if((0|(e=0|xt(0|n)))==((0|r[a>>2])+(0|r[a+4>>2])|0)){if(-1!=(0|e)){l=n,s=e,g=145;break e}}else a=e,g=136;else n=0}else g=128}while(0);do{if(128==(0|g))if(-1!=(0|(i=0|xt(0)))&&(m=(n=(0==((m=(v=0|r[5948])-1|0)&(n=i)|0)?0:(m+n&0-v)-n|0)+h|0)+(v=0|r[5937])|0,n>>>0>f>>>0&n>>>0<2147483647)){if(0|(p=0|r[5939])&&m>>>0<=v>>>0|m>>>0>p>>>0){n=0;break}if((0|(e=0|xt(0|n)))==(0|i)){l=n,s=i,g=145;break e}a=e,g=136}else n=0}while(0);do{if(136==(0|g)){if(i=0-n|0,!(u>>>0>n>>>0&n>>>0<2147483647&-1!=(0|a))){if(-1==(0|a)){n=0;break}l=n,s=a,g=145;break e}if((e=c-n+(e=0|r[5949])&0-e)>>>0>=2147483647){l=n,s=a,g=145;break e}if(-1==(0|xt(0|e))){xt(0|i),n=0;break}l=e+n|0,s=a,g=145;break e}}while(0);r[5940]=4|r[5940],g=143}}while(0);if((143==(0|g)&&h>>>0<2147483647?!(-1==(0|(_=0|xt(0|h)))|1^(A=(y=(m=0|xt(0))-_|0)>>>0>(f+40|0)>>>0)|_>>>0<m>>>0&-1!=(0|_)&-1!=(0|m)^1):0)&&(l=A?y:n,s=_,g=145),145==(0|g)){r[5937]=n=(0|r[5937])+l|0,n>>>0>(0|r[5938])>>>0&&(r[5938]=n),c=0|r[5835];e:do{if(c){for(n=23764;;){if((0|s)==((e=0|r[n>>2])+(i=0|r[n+4>>2])|0)){g=154;break}if(!(a=0|r[n+8>>2]))break;n=a}if(154==(0|g)&&(b=n+4|0,0==(8&r[n+12>>2]|0))&&s>>>0>c>>>0&e>>>0<=c>>>0){r[b>>2]=i+l,b=c+(_=0==(7&(_=c+8|0)|0)?0:0-_&7)|0,_=(k=(0|r[5832])+l|0)-_|0,r[5835]=b,r[5832]=_,r[b+4>>2]=1|_,r[c+k+4>>2]=40,r[5836]=r[5951];break}for(s>>>0<(0|r[5833])>>>0&&(r[5833]=s),i=s+l|0,n=23764;;){if((0|r[n>>2])==(0|i)){g=162;break}if(!(e=0|r[n+8>>2]))break;n=e}if(162==(0|g)&&0==(8&r[n+12>>2]|0)){r[n>>2]=s,r[(d=n+4|0)>>2]=(0|r[d>>2])+l,h=(d=s+(0==(7&(d=s+8|0)|0)?0:0-d&7)|0)+f|0,u=(n=i+(0==(7&(n=i+8|0)|0)?0:0-n&7)|0)-d-f|0,r[d+4>>2]=3|f;t:do{if((0|c)==(0|n))k=(0|r[5832])+u|0,r[5832]=k,r[5835]=h,r[h+4>>2]=1|k;else{if((0|r[5834])==(0|n)){r[5831]=k=(0|r[5831])+u|0,r[5834]=h,r[h+4>>2]=1|k,r[h+k>>2]=k;break}if(1==(3&(e=0|r[n+4>>2])|0)){l=-8&e,a=e>>>3;n:do{if(e>>>0<256){if((0|(i=0|r[n+12>>2]))==(0|(e=0|r[n+8>>2]))){r[5829]=r[5829]&~(1<<a);break}r[e+12>>2]=i,r[i+8>>2]=e;break}s=0|r[n+24>>2],e=0|r[n+12>>2];do{if((0|e)==(0|n)){if(e=0|r[(a=4+(i=n+16|0)|0)>>2])i=a;else if(!(e=0|r[i>>2])){e=0;break}for(;;)if(a=0|r[(o=e+20|0)>>2])e=a,i=o;else{if(!(a=0|r[(o=e+16|0)>>2]))break;e=a,i=o}r[i>>2]=0}else r[12+(k=0|r[n+8>>2])>>2]=e,r[e+8>>2]=k}while(0);if(!s)break;a=23620+((i=0|r[n+28>>2])<<2)|0;do{if((0|r[a>>2])==(0|n)){if(r[a>>2]=e,0|e)break;r[5830]=r[5830]&~(1<<i);break n}if(r[((0|r[(k=s+16|0)>>2])==(0|n)?k:s+20|0)>>2]=e,!e)break n}while(0);if(r[e+24>>2]=s,0|(a=0|r[(i=n+16|0)>>2])&&(r[e+16>>2]=a,r[a+24>>2]=e),!(i=0|r[i+4>>2]))break;r[e+20>>2]=i,r[i+24>>2]=e}while(0);n=n+l|0,o=l+u|0}else o=u;if(r[(n=n+4|0)>>2]=-2&r[n>>2],r[h+4>>2]=1|o,r[h+o>>2]=o,n=o>>>3,o>>>0<256){i=23356+(n<<1<<2)|0,(e=0|r[5829])&(n=1<<n)?n=0|r[(e=i+8|0)>>2]:(r[5829]=e|n,n=i,e=i+8|0),r[e>>2]=h,r[n+12>>2]=h,r[h+8>>2]=n,r[h+12>>2]=i;break}n=o>>>8;do{if(n){if(o>>>0>16777215){a=31;break}a=o>>>(7+(a=14-((_=(520192+(k=n<<(b=(n+1048320|0)>>>16&8))|0)>>>16&4)|b|(a=(245760+(k<<=_)|0)>>>16&2))+(k<"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.a6999adc4bcd02f5ccca.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<a>"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<noscript><link rel=\"stylesheet\" href=\"styles.c57454709e6ae053f58e.css\"></noscript>"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "<noscript><link rel=\"stylesheet\" href=\"styles.c57454709e6ae053f58e.css\"></noscript>"
						}
					],
					"count": "7",
					"solution": "<p>This is an informational alert and so no changes are required.</p>",
					"otherinfo": "<p>A noScript tag has been found, which is an indication that the application works differently with JavaScript enabled compared to when it is not.</p>",
					"reference": "",
					"cweid": "-1",
					"wascid": "-1",
					"sourceid": "1"
				},
				{
					"pluginid": "10049",
					"alertRef": "10049",
					"alert": "Non-Storable Content",
					"name": "Non-Storable Content",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>The response contents are not storable by caching components such as proxy servers. If the response does not contain sensitive, personal or user-specific information, it may benefit from being stored and cached, to improve performance.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/assets/settings.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "no-store"
						}
					],
					"count": "5",
					"solution": "<p>The content may be marked as storable by ensuring that the following conditions are satisfied:</p><p>The request method must be understood by the cache and defined as being cacheable (\"GET\", \"HEAD\", and \"POST\" are currently defined as cacheable)</p><p>The response status code must be understood by the cache (one of the 1XX, 2XX, 3XX, 4XX, or 5XX response classes are generally understood)</p><p>The \"no-store\" cache directive must not appear in the request or response header fields</p><p>For caching by \"shared\" caches such as \"proxy\" caches, the \"private\" response directive must not appear in the response</p><p>For caching by \"shared\" caches such as \"proxy\" caches, the \"Authorization\" header field must not appear in the request, unless the response explicitly allows it (using one of the \"must-revalidate\", \"public\", or \"s-maxage\" Cache-Control response directives)</p><p>In addition to the conditions above, at least one of the following conditions must also be satisfied by the response:</p><p>It must contain an \"Expires\" header field</p><p>It must contain a \"max-age\" response directive</p><p>For \"shared\" caches such as \"proxy\" caches, it must contain a \"s-maxage\" response directive</p><p>It must contain a \"Cache Control Extension\" that allows it to be cached</p><p>It must have a status code that is defined as cacheable by default (200, 203, 204, 206, 300, 301, 404, 405, 410, 414, 501).   </p>",
					"otherinfo": "",
					"reference": "<p>https://tools.ietf.org/html/rfc7234</p><p>https://tools.ietf.org/html/rfc7231</p><p>http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html (obsoleted by rfc7234)</p>",
					"cweid": "524",
					"wascid": "13",
					"sourceid": "1"
				},
				{
					"pluginid": "10015",
					"alertRef": "10015",
					"alert": "Re-examine Cache-control Directives",
					"name": "Re-examine Cache-control Directives",
					"riskcode": "0",
					"confidence": "1",
					"riskdesc": "Informational (Low)",
					"desc": "<p>The cache-control header has not been set properly or is missing, allowing the browser and proxies to cache content. For static assets like css, js, or image files this might be intended, however, the resources should be reviewed to ensure that no sensitive content will be cached.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr",
							"method": "GET",
							"param": "Cache-Control",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/",
							"method": "GET",
							"param": "Cache-Control",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/robots.txt",
							"method": "GET",
							"param": "Cache-Control",
							"attack": "",
							"evidence": "no-store"
						},
						{
							"uri": "https://anais.beta.gouv.fr/sitemap.xml",
							"method": "GET",
							"param": "Cache-Control",
							"attack": "",
							"evidence": "no-store"
						}
					],
					"count": "4",
					"solution": "<p>For secure content, ensure the cache-control HTTP header is set with \"no-cache, no-store, must-revalidate\". If an asset should be cached consider setting the directives \"public, max-age, immutable\".</p>",
					"otherinfo": "",
					"reference": "<p>https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html#web-content-caching</p><p>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control</p><p>https://grayduck.mn/2021/09/13/cache-control-recommendations/</p>",
					"cweid": "525",
					"wascid": "13",
					"sourceid": "1"
				},
				{
					"pluginid": "10049",
					"alertRef": "10049",
					"alert": "Storable and Cacheable Content",
					"name": "Storable and Cacheable Content",
					"riskcode": "0",
					"confidence": "2",
					"riskdesc": "Informational (Medium)",
					"desc": "<p>The response contents are storable by caching components such as proxy servers, and may be retrieved directly from the cache, rather than from the origin server by the caching servers, in response to similar requests from other users.  If the response data is sensitive, personal or user-specific, this may result in sensitive information being leaked. In some cases, this may even result in a user gaining complete control of the session of another user, depending on the configuration of the caching components in use in their environment. This is primarily an issue where \"shared\" caching servers such as \"proxy\" caches are configured on the local network. This configuration is typically found in corporate or educational environments, for instance.</p>",
					"instances":[ 
						{
							"uri": "https://anais.beta.gouv.fr/assets/images/favicon_anais.png",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=7200"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es2015.ec173abd055e5a8effac.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/polyfills-es5.a6999adc4bcd02f5ccca.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es2015.8b9bafcb46d0324464ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/runtime-es5.8b9bafcb46d0324464ba.js",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						},
						{
							"uri": "https://anais.beta.gouv.fr/styles.c57454709e6ae053f58e.css",
							"method": "GET",
							"param": "",
							"attack": "",
							"evidence": "max-age=2592000"
						}
					],
					"count": "6",
					"solution": "<p>Validate that the response does not contain sensitive, personal or user-specific information.  If it does, consider the use of the following HTTP response headers, to limit, or prevent the content being stored and retrieved from the cache by another user:</p><p>Cache-Control: no-cache, no-store, must-revalidate, private</p><p>Pragma: no-cache</p><p>Expires: 0</p><p>This configuration directs both HTTP 1.0 and HTTP 1.1 compliant caching servers to not store the response, and to not retrieve the response (without validation) from the cache, in response to a similar request. </p>",
					"otherinfo": "",
					"reference": "<p>https://tools.ietf.org/html/rfc7234</p><p>https://tools.ietf.org/html/rfc7231</p><p>http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html (obsoleted by rfc7234)</p>",
					"cweid": "524",
					"wascid": "13",
					"sourceid": "20"
				}
			]
		}
	]
}
